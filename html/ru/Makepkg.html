<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>makepkg (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Makepkg_Русский rootpage-Makepkg_Русский skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Настройка" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Настройка</div>
		</a>
		
			<button aria-controls="toc-Настройка-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Настройка subsection</span>
			</button>
		
		<ul id="toc-Настройка-sublist" class="vector-toc-list">
			<li id="toc-Информация_о_создателе_пакета" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%98%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8F_%D0%BE_%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D0%B5%D0%BB%D0%B5_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Информация о создателе пакета</div>
			</a>
			
			<ul id="toc-Информация_о_создателе_пакета-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Расположение_файлов_пакета" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A0%D0%B0%D1%81%D0%BF%D0%BE%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Расположение файлов пакета</div>
			</a>
			
			<ul id="toc-Расположение_файлов_пакета-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Проверка_цифровых_подписей" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D1%86%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D1%8B%D1%85_%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D0%B5%D0%B9">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Проверка цифровых подписей</div>
			</a>
			
			<ul id="toc-Проверка_цифровых_подписей-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Использование" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Использование</div>
		</a>
		
		<ul id="toc-Использование-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Советы_и_рекомендации" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A1%D0%BE%D0%B2%D0%B5%D1%82%D1%8B_%D0%B8_%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D0%B0%D1%86%D0%B8%D0%B8">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Советы и рекомендации</div>
		</a>
		
			<button aria-controls="toc-Советы_и_рекомендации-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Советы и рекомендации subsection</span>
			</button>
		
		<ul id="toc-Советы_и_рекомендации-sublist" class="vector-toc-list">
			<li id="toc-Снижение_времени_загрузки_и_извлечения_исходников" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%BD%D0%B8%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B2%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%B8_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8_%D0%B8_%D0%B8%D0%B7%D0%B2%D0%BB%D0%B5%D1%87%D0%B5%D0%BD%D0%B8%D1%8F_%D0%B8%D1%81%D1%85%D0%BE%D0%B4%D0%BD%D0%B8%D0%BA%D0%BE%D0%B2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Снижение времени загрузки и извлечения исходников</div>
			</a>
			
			<ul id="toc-Снижение_времени_загрузки_и_извлечения_исходников-sublist" class="vector-toc-list">
				<li id="toc-Расположение_исходных_файлов" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A0%D0%B0%D1%81%D0%BF%D0%BE%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B8%D1%81%D1%85%D0%BE%D0%B4%D0%BD%D1%8B%D1%85_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.1</span>Расположение исходных файлов</div>
			</a>
			
			<ul id="toc-Расположение_исходных_файлов-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Переопределение_флагов_git" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9F%D0%B5%D1%80%D0%B5%D0%BE%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%84%D0%BB%D0%B0%D0%B3%D0%BE%D0%B2_git">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.2</span>Переопределение флагов git</div>
			</a>
			
			<ul id="toc-Переопределение_флагов_git-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Оптимизация_двоичных_пакетов" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9E%D0%BF%D1%82%D0%B8%D0%BC%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F_%D0%B4%D0%B2%D0%BE%D0%B8%D1%87%D0%BD%D1%8B%D1%85_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Оптимизация двоичных пакетов</div>
			</a>
			
			<ul id="toc-Оптимизация_двоичных_пакетов-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Сокращение_времени_сборки" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%BE%D0%BA%D1%80%D0%B0%D1%89%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B2%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%B8_%D1%81%D0%B1%D0%BE%D1%80%D0%BA%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Сокращение времени сборки</div>
			</a>
			
			<ul id="toc-Сокращение_времени_сборки-sublist" class="vector-toc-list">
				<li id="toc-Параллельная_компиляция" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9F%D0%B0%D1%80%D0%B0%D0%BB%D0%BB%D0%B5%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D0%BA%D0%BE%D0%BC%D0%BF%D0%B8%D0%BB%D1%8F%D1%86%D0%B8%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.1</span>Параллельная компиляция</div>
			</a>
			
			<ul id="toc-Параллельная_компиляция-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Сборка_из_файлов_в_памяти" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A1%D0%B1%D0%BE%D1%80%D0%BA%D0%B0_%D0%B8%D0%B7_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D0%B2_%D0%BF%D0%B0%D0%BC%D1%8F%D1%82%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.2</span>Сборка из файлов в памяти</div>
			</a>
			
			<ul id="toc-Сборка_из_файлов_в_памяти-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Использование_кэша_компиляции" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BA%D1%8D%D1%88%D0%B0_%D0%BA%D0%BE%D0%BC%D0%BF%D0%B8%D0%BB%D1%8F%D1%86%D0%B8%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.3</span>Использование кэша компиляции</div>
			</a>
			
			<ul id="toc-Использование_кэша_компиляции-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Использование_компоновщика_mold" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BA%D0%BE%D0%BC%D0%BF%D0%BE%D0%BD%D0%BE%D0%B2%D1%89%D0%B8%D0%BA%D0%B0_mold">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.4</span>Использование компоновщика mold</div>
			</a>
			
			<ul id="toc-Использование_компоновщика_mold-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Вычисление_новых_контрольных_сумм" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%92%D1%8B%D1%87%D0%B8%D1%81%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BD%D0%BE%D0%B2%D1%8B%D1%85_%D0%BA%D0%BE%D0%BD%D1%82%D1%80%D0%BE%D0%BB%D1%8C%D0%BD%D1%8B%D1%85_%D1%81%D1%83%D0%BC%D0%BC">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4</span>Вычисление новых контрольных сумм</div>
			</a>
			
			<ul id="toc-Вычисление_новых_контрольных_сумм-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Применение_других_алгоритмов_сжатия" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B4%D1%80%D1%83%D0%B3%D0%B8%D1%85_%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC%D0%BE%D0%B2_%D1%81%D0%B6%D0%B0%D1%82%D0%B8%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.5</span>Применение других алгоритмов сжатия</div>
			</a>
			
			<ul id="toc-Применение_других_алгоритмов_сжатия-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Использование_нескольких_ядер_при_сжатии" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BD%D0%B5%D1%81%D0%BA%D0%BE%D0%BB%D1%8C%D0%BA%D0%B8%D1%85_%D1%8F%D0%B4%D0%B5%D1%80_%D0%BF%D1%80%D0%B8_%D1%81%D0%B6%D0%B0%D1%82%D0%B8%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.6</span>Использование нескольких ядер при сжатии</div>
			</a>
			
			<ul id="toc-Использование_нескольких_ядер_при_сжатии-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Вывод_списка_пакетов_по_имени_создателя" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%92%D1%8B%D0%B2%D0%BE%D0%B4_%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2_%D0%BF%D0%BE_%D0%B8%D0%BC%D0%B5%D0%BD%D0%B8_%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D0%B5%D0%BB%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.7</span>Вывод списка пакетов по имени создателя</div>
			</a>
			
			<ul id="toc-Вывод_списка_пакетов_по_имени_создателя-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Сборка_32-битных_пакетов_в_64-битной_системе" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%B1%D0%BE%D1%80%D0%BA%D0%B0_32-%D0%B1%D0%B8%D1%82%D0%BD%D1%8B%D1%85_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2_%D0%B2_64-%D0%B1%D0%B8%D1%82%D0%BD%D0%BE%D0%B9_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.8</span>Сборка 32-битных пакетов в 64-битной системе</div>
			</a>
			
			<ul id="toc-Сборка_32-битных_пакетов_в_64-битной_системе-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Magnet-ссылки" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Magnet-%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.9</span>Magnet-ссылки</div>
			</a>
			
			<ul id="toc-Magnet-ссылки-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Запуск_makepkg_в_контрольной_группе_systemd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_makepkg_%D0%B2_%D0%BA%D0%BE%D0%BD%D1%82%D1%80%D0%BE%D0%BB%D1%8C%D0%BD%D0%BE%D0%B9_%D0%B3%D1%80%D1%83%D0%BF%D0%BF%D0%B5_systemd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.10</span>Запуск makepkg в контрольной группе systemd</div>
			</a>
			
			<ul id="toc-Запуск_makepkg_в_контрольной_группе_systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Запуск_с_политикой_планировщика_idle" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_%D1%81_%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%BE%D0%B9_%D0%BF%D0%BB%D0%B0%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D1%89%D0%B8%D0%BA%D0%B0_idle">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.11</span>Запуск с политикой планировщика idle</div>
			</a>
			
			<ul id="toc-Запуск_с_политикой_планировщика_idle-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Решение_проблем" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A0%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Решение проблем</div>
		</a>
		
			<button aria-controls="toc-Решение_проблем-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Решение проблем subsection</span>
			</button>
		
		<ul id="toc-Решение_проблем-sublist" class="vector-toc-list">
			<li id="toc-Выбор_каталога_установки_при_сборке_в_QMake" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%92%D1%8B%D0%B1%D0%BE%D1%80_%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%D0%B0_%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8_%D0%BF%D1%80%D0%B8_%D1%81%D0%B1%D0%BE%D1%80%D0%BA%D0%B5_%D0%B2_QMake">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Выбор каталога установки при сборке в QMake</div>
			</a>
			
			<ul id="toc-Выбор_каталога_установки_при_сборке_в_QMake-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-WARNING:_Package_contains_reference_to_$srcdir" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#WARNING:_Package_contains_reference_to_$srcdir">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>WARNING: Package contains reference to $srcdir</div>
			</a>
			
			<ul id="toc-WARNING:_Package_contains_reference_to_$srcdir-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-makepkg_не_может_загрузить_зависимости_через_прокси" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#makepkg_%D0%BD%D0%B5_%D0%BC%D0%BE%D0%B6%D0%B5%D1%82_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%B8%D1%82%D1%8C_%D0%B7%D0%B0%D0%B2%D0%B8%D1%81%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8_%D1%87%D0%B5%D1%80%D0%B5%D0%B7_%D0%BF%D1%80%D0%BE%D0%BA%D1%81%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>makepkg не может загрузить зависимости через прокси</div>
			</a>
			
			<ul id="toc-makepkg_не_может_загрузить_зависимости_через_прокси-sublist" class="vector-toc-list">
				<li id="toc-Параметр_XferCommand_в_файле_/etc/pacman.conf" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9F%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80_XferCommand_%D0%B2_%D1%84%D0%B0%D0%B9%D0%BB%D0%B5_/etc/pacman.conf">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3.1</span>Параметр XferCommand в файле /etc/pacman.conf</div>
			</a>
			
			<ul id="toc-Параметр_XferCommand_в_файле_/etc/pacman.conf-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Параметр_env_keep_в_файле_/etc/sudoers" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9F%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80_env_keep_%D0%B2_%D1%84%D0%B0%D0%B9%D0%BB%D0%B5_/etc/sudoers">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3.2</span>Параметр env_keep в файле /etc/sudoers</div>
			</a>
			
			<ul id="toc-Параметр_env_keep_в_файле_/etc/sudoers-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-makepkg_не_работает,_но_make_завершается_успешно" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#makepkg_%D0%BD%D0%B5_%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82,_%D0%BD%D0%BE_make_%D0%B7%D0%B0%D0%B2%D0%B5%D1%80%D1%88%D0%B0%D0%B5%D1%82%D1%81%D1%8F_%D1%83%D1%81%D0%BF%D0%B5%D1%88%D0%BD%D0%BE">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>makepkg не работает, но make завершается успешно</div>
			</a>
			
			<ul id="toc-makepkg_не_работает,_но_make_завершается_успешно-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Смотрите_также" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Смотрите также</div>
		</a>
		
		<ul id="toc-Смотрите_также-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">makepkg (Русский)</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 6 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-6" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">6 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-en mw-list-item"><a href="../en/Makepkg.html" title="Makepkg – English" lang="en" hreflang="en" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/Makepkg.html" title="Makepkg – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-fr mw-list-item"><a href="../fr/Makepkg.html" title="Makepkg – français" lang="fr" hreflang="fr" class="interlanguage-link-target"><span>Français</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Makepkg" title="Makepkg – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/Makepkg.html" title="Makepkg – português" lang="pt" hreflang="pt" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Makepkg" title="Makepkg – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="ru" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/Makepkg.html" title="Makepkg">makepkg</a>. Дата последней синхронизации: 5 января 2024. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Makepkg&amp;diff=0&amp;oldid=796046">изменения</a>.</div>
<div class="archwiki-template-meta-related-articles">
<p>Ссылки по теме</p>
<ul>
<li><a href="../ru/Creating_packages.html" class="mw-redirect" title="Создание пакетов">Создание пакетов</a></li>
<li><a href="../ru/PKGBUILD.html" title="PKGBUILD (Русский)">PKGBUILD (Русский)</a></li>
<li><a href="../ru/.SRCINFO.html" title=".SRCINFO (Русский)">.SRCINFO (Русский)</a></li>
<li><a href="../ru/Arch_User_Repository.html" class="mw-redirect" title="Пользовательский репозиторий Arch">Пользовательский репозиторий Arch</a></li>
<li><a href="../ru/Pacman.html" title="Pacman (Русский)">pacman (Русский)</a></li>
<li><a href="../ru/Official_repositories.html" class="mw-redirect" title="Официальные репозитории">Официальные репозитории</a></li>
<li><a href="../ru/Arch_build_system.html" class="mw-redirect" title="Система сборки Arch">Система сборки Arch</a></li>
<li><a href="../ru/GnuPG.html" title="GnuPG (Русский)">GnuPG (Русский)</a></li>
<li><a href="../ru/OpenPGP.html" title="OpenPGP (Русский)">OpenPGP (Русский)</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/pacman/pacman/blob/master/scripts/makepkg.sh.in">makepkg</a> — скрипт для автоматизации сборки пакетов. Требования для работы — Unix-платформа с системой сборки и файл <a href="../ru/PKGBUILD.html" title="PKGBUILD (Русский)">PKGBUILD</a>.
</p>
<p><i>makepkg</i> входит в состав пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman">pacman</a></span>.
</p>
<meta property="mw:PageProp/toc">
<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0"></span><span class="mw-headline" id="Настройка">Настройка</span>
</h2>
<p>Параметры настройки <i>makepkg</i> подробно описаны в руководстве <span class="plainlinks archwiki-template-man" title="$ man 5 makepkg.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.conf.5">makepkg.conf(5)</a></span>.
</p>
<p>Общесистемные настройки хранятся в файле <code>/etc/makepkg.conf</code>, пользовательские — в <code>$XDG_CONFIG_HOME/pacman/makepkg.conf</code> или <code>~/.makepkg.conf</code>. Рекомендуется проверять настройки перед сборкой пакетов.
</p>
<h3>
<span id=".D0.98.D0.BD.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.86.D0.B8.D1.8F_.D0.BE_.D1.81.D0.BE.D0.B7.D0.B4.D0.B0.D1.82.D0.B5.D0.BB.D0.B5_.D0.BF.D0.B0.D0.BA.D0.B5.D1.82.D0.B0"></span><span class="mw-headline" id="Информация_о_создателе_пакета">Информация о создателе пакета</span>
</h3>
<p>Каждый пакет содержит метаданные, в том числе информацию о создателе пакета (packager). По умолчанию скомпилированный пакет создаётся с пометкой <code>Unknown Packager</code>. Однако если на одной системе компиляцией занимаются несколько пользователей или вы планируете распространять пакет среди других пользователей, то имеет смысл указать настоящие контактные данные, задав переменную <code>PACKAGER</code> в файле <code>makepkg.conf</code>.
</p>
<p>Создателя установленного пакета можно узнать командой:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ pacman -Qi <i>пакет</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Packager       : John Doe &lt;john@doe.com&gt;
...
</pre>
<p>Кроме того, если указать цифровую подпись создателя в параметре <code>GPGKEY</code>, то для пакетов будут автоматически создаваться подписи.
</p>
<h3>
<span id=".D0.A0.D0.B0.D1.81.D0.BF.D0.BE.D0.BB.D0.BE.D0.B6.D0.B5.D0.BD.D0.B8.D0.B5_.D1.84.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2_.D0.BF.D0.B0.D0.BA.D0.B5.D1.82.D0.B0"></span><span class="mw-headline" id="Расположение_файлов_пакета">Расположение файлов пакета</span>
</h3>
<p>По умолчанию <i>makepkg</i> создаёт tar-архивы пакетов в рабочем каталоге, а исходный код загружает в подкаталог <code>src/</code>. Целевые каталоги можно переназначить, например, чтобы все собранные пакеты хранились в <code>~/build/packages/</code>, а все исходные файлы — в <code>~/build/sources/</code>.
</p>
<p>Можно задать следующие значения в <code>makepkg.conf</code>:
</p>
<ul>
<li>
<code>PKGDEST</code> — каталог для собранных пакетов;</li>
<li>
<code>SRCDEST</code> — каталог для <a href="../ru/PKGBUILD.html#source" title="PKGBUILD (Русский)">исходных файлов</a> (в каталог <code>src/</code> будут помещаться символические ссылки на новое местоположение);</li>
<li>
<code>SRCPKGDEST</code> — каталог для пакетов исходных файлов, используемых для сборки пакетов (создаются командой <code>makepkg -S</code>).</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Каталог <code>PKGDEST</code> можно очистить, например, командой <code>paccache -c ~/build/packages/</code> (см. <a href="../ru/Pacman.html#%D0%9E%D1%87%D0%B8%D1%81%D1%82%D0%BA%D0%B0_%D0%BA%D1%8D%D1%88%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" title="Pacman (Русский)">pacman#Очистка кэша пакетов</a>).
</div>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D1.86.D0.B8.D1.84.D1.80.D0.BE.D0.B2.D1.8B.D1.85_.D0.BF.D0.BE.D0.B4.D0.BF.D0.B8.D1.81.D0.B5.D0.B9"></span><span class="mw-headline" id="Проверка_цифровых_подписей">Проверка цифровых подписей</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> При проверке цифровых подписей <i>makepkg</i> полагается исключительно на пользовательские связки ключей. Связки ключей <i>pacman</i> не используются <a rel="nofollow" class="external autonumber" href="http://allanmcrae.com/2015/01/two-pgp-keyrings-for-package-management-in-arch-linux/">[1]</a>.
</div>
<p>Файлы цифровых подписей имеют расширение <i>.sig</i> или <i>.asc</i> и указываются в параметре <code>source</code> файла <a href="../ru/PKGBUILD.html#source" title="PKGBUILD (Русский)">PKGBUILD</a>. Если <i>makepkg</i> встречает такой файл, то автоматически пытается <a href="../ru/GnuPG.html#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D0%B8" title="GnuPG (Русский)">проверить подпись</a>. Если пользовательская связка ключей не содержит нужный открытый ключ, то <i>makepkg</i> выведет сообщение о невозможности осуществить проверку PGP-ключа и прервёт установку.
</p>
<p>Если нужный открытый ключ отсутствует, то файл <a href="../ru/PKGBUILD.html" title="PKGBUILD (Русский)">PKGBUILD</a>, скорее всего, содержит пункт <a href="../ru/PKGBUILD.html#validpgpkeys" title="PKGBUILD (Русский)">validpgpkeys</a> с идентификаторами ключей. Ключи можно <a href="../ru/GnuPG.html#%D0%98%D0%BC%D0%BF%D0%BE%D1%80%D1%82_%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D0%BE%D0%B3%D0%BE_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0" title="GnuPG (Русский)">импортировать</a> вручную или же <a href="../ru/GnuPG.html#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9" title="GnuPG (Русский)">найти их на сервере ключей</a> и импортировать оттуда. Чтобы временно отключить проверку цифровых подписей, можно запустить <i>makepkg</i> с опцией <code>--skippgpcheck</code>.
</p>
<h2>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Использование">Использование</span>
</h2>
<p>Для корректной работы <i>makepkg</i> нужно установить <a href="../ru/Meta_package_and_package_group.html#%D0%A0%D0%B0%D0%B7%D0%BD%D0%B8%D1%86%D0%B0_%D0%BC%D0%B5%D0%B6%D0%B4%D1%83_%D0%BC%D0%B5%D1%82%D0%B0-%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%BC_%D0%B8_%D0%B3%D1%80%D1%83%D0%BF%D0%BF%D0%BE%D0%B9_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Мета-пакет">мета-пакет</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=base-devel">base-devel</a></span>. Зависимости этого пакета <b>не</b> нужно указывать в качестве зависимостей для сборки (<i>makedepends</i>) в файле <a href="../ru/PKGBUILD.html" title="PKGBUILD (Русский)">PKGBUILD</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Убедитесь, что утилита <a href="../ru/Sudo.html" title="Sudo (Русский)">sudo</a> настроена должным образом для команд, передаваемых <a href="../ru/Pacman.html" title="Pacman (Русский)">pacman</a>.</li>
<li>Запуск <i>makepkg</i> от root-пользователя <a rel="nofollow" class="external text" href="https://lists.archlinux.org/archives/list/pacman-dev@lists.archlinux.org/message/ZLRXMUGXULDHLTGSRYVGVWG3BVATV3OY/">запрещён</a>. <a rel="nofollow" class="external autonumber" href="https://gitlab.archlinux.org/pacman/pacman/blob/master/NEWS">[2]</a> Помимо того, что <code>PKGBUILD</code> может содержать произвольные команды, сборка пакетов под root-аккаунтом в целом считается небезопасной <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=67561">[3]</a>. Если у пользователя нет доступа к аккаунту обычного пользователя, то следует запускать <i>makepkg</i> от имени пользователя <a rel="nofollow" class="external text" href="http://allanmcrae.com/2015/01/replacing-makepkg-asroot/">nobody</a>.</li>
</ul>
</div>
<p>Чтобы собрать пакет, первым делом необходимо создать файл <a href="../ru/PKGBUILD.html" title="PKGBUILD (Русский)">PKGBUILD</a>, который представляет собой скрипт сборки. Написание скрипта описано в статье <a href="../ru/Creating_packages.html" class="mw-redirect" title="Создание пакетов">Создание пакетов</a>. Скрипты для существующих пакетов можно найти в дереве каталогов <a href="../ru/Arch_build_system.html" title="Arch build system (Русский)">системы сборки Arch</a>, а также в <a href="../ru/Arch_User_Repository.html" title="Arch User Repository (Русский)">AUR</a>. После того, как <code>PKGBUILD</code> получен, перейдите в каталог с ним и выполните команду сборки пакета:
</p>
<pre>$ makepkg
</pre>
<p>Если в системе не установлены необходимые зависимости, <i>makepkg</i> предупредит вас об этом и отменит сборку. Если задать флаг <code>-s</code>/<code>--syncdeps</code>, то <i>makepkg</i> самостоятельно установит недостающие зависимости и соберёт пакет.
</p>
<pre>$ makepkg --syncdeps
</pre>
<p>С флагом <code>-r</code>/<code>--rmdeps</code> <i>makepkg</i> после сборки удалит те зависимости, которые будут больше не нужны. Если вы постоянно занимаетесь сборкой пакетов и не хотите загрязнять систему пакетами-сиротами, то стоит также ознакомиться с разделом <a href="../ru/Pacman/Tips_and_tricks.html#%D0%A3%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BD%D0%B5%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D0%B5%D0%BC%D1%8B%D1%85_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Pacman/Советы и приёмы">pacman/Советы и приёмы#Удаление неиспользуемых пакетов</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Пакеты-зависимости должны быть доступны для установки из подключённых репозиториев; в статье <a href="../ru/Pacman.html#%D0%A0%D0%B5%D0%BF%D0%BE%D0%B7%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%B8_%D0%B8_%D0%B7%D0%B5%D1%80%D0%BA%D0%B0%D0%BB%D0%B0" title="Pacman (Русский)">pacman (Русский)#Репозитории и зеркала</a> описана настройка репозиториев. Кроме того, зависимости можно установить вручную командой <code>pacman -S --asdeps <i>зависимость1</i> <i>зависимость2</i></code>.</li>
<li>При установке зависимостей используются только глобальные значения переменных, то есть переопределить значения, например, внутри функции упаковки разделённого пакета (split package) не получится.</li>
</ul>
</div>
<p>Когда все зависимости установлены и сборка пакета завершилась успешно, в рабочем каталоге появится файл пакета (<code><i>имя-пакета</i>-<i>версия-пакета</i>.pkg.tar.zst</code>). Чтобы установить его в систему, используйте флаг <code>-i</code>/<code>--install</code> (работает аналогично команде <code>pacman -U <i>имя-пакета</i>-<i>версия-пакета</i>.pkg.tar.zst</code>):
</p>
<pre>$ makepkg --install
</pre>
<p>С флагом <code>-c</code>/<code>--clean</code> <i>makepkg</i> удалит оставшиеся после сборки промежуточные файлы и каталоги (например, распакованные в <code>$srcdir</code> файлы). Это полезно при многократных сборках одного и того же пакета или его обновления в одном рабочем каталоге. Это предотвратит добавление устаревших файлов в новые сборки:
</p>
<pre>$ makepkg --clean
</pre>
<p>Подробнее см. <span class="plainlinks archwiki-template-man" title="$ man 8 makepkg"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.8">makepkg(8)</a></span>.
</p>
<h2>
<span id=".D0.A1.D0.BE.D0.B2.D0.B5.D1.82.D1.8B_.D0.B8_.D1.80.D0.B5.D0.BA.D0.BE.D0.BC.D0.B5.D0.BD.D0.B4.D0.B0.D1.86.D0.B8.D0.B8"></span><span class="mw-headline" id="Советы_и_рекомендации">Советы и рекомендации</span>
</h2>
<h3>
<span id=".D0.A1.D0.BD.D0.B8.D0.B6.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B2.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.B8_.D0.B7.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.BA.D0.B8_.D0.B8_.D0.B8.D0.B7.D0.B2.D0.BB.D0.B5.D1.87.D0.B5.D0.BD.D0.B8.D1.8F_.D0.B8.D1.81.D1.85.D0.BE.D0.B4.D0.BD.D0.B8.D0.BA.D0.BE.D0.B2"></span><span class="mw-headline" id="Снижение_времени_загрузки_и_извлечения_исходников">Снижение времени загрузки и извлечения исходников</span>
</h3>
<h4>
<span id=".D0.A0.D0.B0.D1.81.D0.BF.D0.BE.D0.BB.D0.BE.D0.B6.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B8.D1.81.D1.85.D0.BE.D0.B4.D0.BD.D1.8B.D1.85_.D1.84.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2"></span><span class="mw-headline" id="Расположение_исходных_файлов">Расположение исходных файлов</span>
</h4>
<p>При многократной пересборке одного и того же пакета, особенно в случае <a href="../en/VCS_package_guidelines.html" title="VCS package guidelines">VCS</a>, используйте <code>SRCDEST</code>, чтобы сэкономить время на скачивание и распаковку файлов с исходным кодом.
</p>
<h4>
<span id=".D0.9F.D0.B5.D1.80.D0.B5.D0.BE.D0.BF.D1.80.D0.B5.D0.B4.D0.B5.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D1.84.D0.BB.D0.B0.D0.B3.D0.BE.D0.B2_git"></span><span class="mw-headline" id="Переопределение_флагов_git">Переопределение флагов git</span>
</h4>
<p>Значительно снизить время загрузки может частичное клонирование. Флаг <code>--filter=tree:0</code> позволяет обновлять дерево исходных текстов только по требованию. Передать его в <code>makepkg</code> можно с помощью переменной <code>GITFLAGS</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> В стабильной версии pacman 6.0.2 поддержка <code>GITFLAGS</code> ещё не появилась. Для её использования установите разрабатываемую версию (например, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pacman-git/">pacman-git</a></span><sup><small>AUR</small></sup>).</div>
<p>Пример:
</p>
<pre>$ GITFLAGS="--filter=tree:0" makepkg
</pre>
<p>Чтобы применить для каждой сборки:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">GITFLAGS="--filter=tree:0"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> По состоянию на 2023 год ещё не все git-серверы поддерживают этот флаг.</div>
<p>Также <code>--single-branch</code> в общем случае должен работать без проблем, но экономит не так много времени. Подробнее смотрите <span class="plainlinks archwiki-template-man" title="$ man 1 git-clone"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/git-clone.1">git-clone(1)</a></span>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Помните, что <b>любое</b> изменение флагов git может что-нибудь сломать. Скрипты PKGBUILD могут использовать git непредсказуемым образом, полагаясь на текущие значения Makepkg по умолчанию.
Иногда также предлагают использовать shallow clone (например, <code>--depth=1</code>), но это <b>точно</b> сломает <code>pkgver()</code> в VCS-пакетах и другие вещи. Это уже неоднократно обсуждалось, например, <a rel="nofollow" class="external text" href="https://lists.archlinux.org/archives/list/arch-general@lists.archlinux.org/thread/YTATAXLNOTE2X45CQMSSJHK3HNEUNN5P/">здесь</a>.</div>
<h3>
<span id=".D0.9E.D0.BF.D1.82.D0.B8.D0.BC.D0.B8.D0.B7.D0.B0.D1.86.D0.B8.D1.8F_.D0.B4.D0.B2.D0.BE.D0.B8.D1.87.D0.BD.D1.8B.D1.85_.D0.BF.D0.B0.D0.BA.D0.B5.D1.82.D0.BE.D0.B2"></span><span class="mw-headline" id="Оптимизация_двоичных_пакетов">Оптимизация двоичных пакетов</span>
</h3>
<p>Повысить производительность программ можно на этапе сборки пакета с помощью возможностей компилятора по оптимизации кода. Однако нужно иметь в виду, что двоичные файлы, скомпилированные под специфическую архитектуру процессора, не будут правильно работать на других машинах. Если говорить об архитектуре x86_64, то редко когда достигнутый эффект повышения производительности стоит затраченного на пересборку официальных пакетов времени.
</p>
<p>С другой стороны, <i>снизить</i> производительность, задав "нестандартные" флаги компилятора — проще простого. Чаще всего тонкая настройка компилятора приносит пользу лишь в определённой ситуации и не стоит применять её ко всем пакетам без разбора. Если вы не можете доказать повышение производительности путём тестов, то скорее всего его просто нет! Статьи из Gentoo-wiki <a href="https://wiki.gentoo.org/wiki/GCC_optimization" class="extiw" title="gentoo:GCC optimization">Оптимизации GCC</a> и <a href="https://wiki.gentoo.org/wiki/Safe_CFLAGS" class="extiw" title="gentoo:Safe CFLAGS">Safe CFLAGS</a> содержат больше информации по оптимизации компилятора.
</p>
<p>Опции, передаваемые компилятору C/C++ (например, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gcc">gcc</a></span> или <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=clang">clang</a></span>), задаются в переменных окружения <code>CFLAGS</code>, <code>CXXFLAGS</code> и <code>CPPFLAGS</code>. В <a href="../ru/Arch_build_system.html" title="Arch build system (Русский)">системе сборки Arch</a> <i>makepkg</i> извлекает их значения из опций в файле настроек <code>makepkg.conf</code>. Значения по умолчанию выбраны таким образом, чтобы создаваемые двоичные программы работали на широком диапазоне машин.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Следует помнить, что не все системы сборки используют переменные, указанные в файле <code>makepkg.conf</code>. Например, <i>cmake</i> игнорирует переменную <code>CPPFLAGS</code>. Как следствие, часто в файлах <a href="../ru/PKGBUILD.html" title="PKGBUILD (Русский)">PKGBUILD</a> можно увидеть различные обходные решения для систем сборки, используемых в собираемых программах.</li>
<li>Настройки в файле <code>Makefile</code> и аргументы в командах компиляции имеют приоритет над значениями в <code>makepkg.conf</code>, что может привести к их переопределению.</li>
</ul>
</div>
<p>Компилятор GCC может автоматически обнаруживать и включать безопасные оптимизации, доступные для текущей архитектуры. Чтобы использовать эту возможность, сначала удалите любые флаги <code>-march</code> и <code>-mtune</code>, а затем добавьте опцию <code>-march=native</code>. Например:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CFLAGS="<b>-march=native</b> -O2 -pipe ..."
CXXFLAGS="${CFLAGS} ..."</pre>
<p>Чтобы узнать, какие флаги разблокирует эта команда, выполните:
</p>
<pre>$ gcc -march=native -v -Q --help=target
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Если вы укажете значение, отличное от <code>-march=native</code>, то <code>-Q --help=target</code> не сработает <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?pid=1616694#p1616694">[4]</a>. Вам придётся пройти через фазу компиляции, чтобы узнать, какие опции на самом деле были включены. Подробнее см. <a href="https://wiki.gentoo.org/wiki/Safe_CFLAGS#Manual" class="extiw" title="gentoo:Safe CFLAGS">Gentoo:Safe CFLAGS#Manual</a>.</div>
<p>Начиная с <i>pacman</i> версии 5.2.2 файл <code>makepkg.conf</code> также содержит переменную окружения <code>RUSTFLAGS</code>, в которой можно указать флаги, передаваемые компилятору языка Rust. Если указать в переменной <code>RUSTFLAGS</code> значение <code>-C target-cpu=native</code>, компилятор включит доступные для текущей архитектуры алгоритмы оптимизации.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">RUSTFLAGS="-C opt-level=2 <b>-C target-cpu=native</b>"</pre>
<p>Чтобы узнать, какие возможности процессора можно включить этой настройкой, выполните:
</p>
<pre>$ rustc -C target-cpu=native --print cfg
</pre>
<p>Если в команде выше указать <code>--print cfg</code> без <code>-C target-cpu=native</code>, то будет выведена стандартная конфигурация. Можно также изменить значение параметра <code>opt-level</code> на <code>3</code>, <code>s</code> или <code>z</code>, подробнее см. <a rel="nofollow" class="external text" href="https://doc.rust-lang.org/rustc/codegen-options/index.html#opt-level">документацию компилятора Rust</a>.
</p>
<h3>
<span id=".D0.A1.D0.BE.D0.BA.D1.80.D0.B0.D1.89.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B2.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.B8_.D1.81.D0.B1.D0.BE.D1.80.D0.BA.D0.B8"></span><span class="mw-headline" id="Сокращение_времени_сборки">Сокращение времени сборки</span>
</h3>
<h4>
<span id=".D0.9F.D0.B0.D1.80.D0.B0.D0.BB.D0.BB.D0.B5.D0.BB.D1.8C.D0.BD.D0.B0.D1.8F_.D0.BA.D0.BE.D0.BC.D0.BF.D0.B8.D0.BB.D1.8F.D1.86.D0.B8.D1.8F"></span><span class="mw-headline" id="Параллельная_компиляция">Параллельная компиляция</span>
</h4>
<p>Для сборки пакетов с помощью <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=make">make</a></span> используется <a href="../ru/Environment_variables.html" title="Environment variables (Русский)">переменная окружения</a> <code>MAKEFLAGS</code>, которая определяет дополнительные опции для утилиты <i>make</i>. Установить значение этой переменной можно также в файле <code>makepkg.conf</code>.
</p>
<p>Пользователи с многоядерными/многопроцессорными системами могут указать количество одновременно запускаемых задач. Можно использовать утилиту <i>nproc</i> для определения количества доступных ядер, например <code>MAKEFLAGS="-j$(nproc)"</code>. Некоторые файлы <a href="../ru/PKGBUILD.html" title="PKGBUILD (Русский)">PKGBUILD</a> переопределяют это значение на <code>-j1</code>, чтобы избежать состояний гонки или просто потому что многопоточная работа не поддерживается изначально. Если сборка пакета завершилась неудачно из-за описанных выше изменений в <code>MAKEFLAGS</code>, то нужно создать <a href="../ru/Bug_reporting_guidelines.html" title="Bug reporting guidelines (Русский)">отчёт об ошибке</a> или, в случае пакета из <a href="../ru/Arch_User_Repository.html" class="mw-redirect" title="AUR (Русский)">AUR</a>, сообщить сопроводителю пакета.
</p>
<p>Другие возможные опции можно найти в руководстве <span class="plainlinks archwiki-template-man" title="$ man 1 make"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/make.1">make(1)</a></span>.
</p>
<h4>
<span id=".D0.A1.D0.B1.D0.BE.D1.80.D0.BA.D0.B0_.D0.B8.D0.B7_.D1.84.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2_.D0.B2_.D0.BF.D0.B0.D0.BC.D1.8F.D1.82.D0.B8"></span><span class="mw-headline" id="Сборка_из_файлов_в_памяти">Сборка из файлов в памяти</span>
</h4>
<p>Если компиляция требует много операций ввода-вывода и обработки маленьких файлов, перемещение рабочего каталога в <a href="../ru/Tmpfs.html" title="Tmpfs (Русский)">tmpfs</a> может сократить время компиляции.
</p>
<p>Чтобы временно использовать другой рабочий каталог <i>makepkg</i>, можно экспортировать <a href="../ru/Environment_variables.html" title="Environment variables (Русский)">переменную окружения</a> <code>BUILDDIR</code>. Пример использования стандартной точки монтирования tmpfs:
</p>
<pre>$ BUILDDIR=/tmp/makepkg makepkg
</pre>
<p>Чтобы сделать эту настройку постоянной, нужно раскомментировать опцию <code>BUILDDIR</code> файла настроек <code>/etc/makepkg.conf</code>. Если, к примеру, установить это значение <code>BUILDDIR=/tmp/makepkg</code>, то будет использоваться обычная временная файловая система Arch <code>/tmp</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Старайтесь не компилировать большие пакеты в tmpfs, чтобы не произошло исчерпания памяти.</li>
<li>Каталог tmpfs должен быть смонтирован без опции <code>noexec</code>, потому что иначе собранный двоичный пакет будет невозможно исполнить.</li>
<li>Также помните, что собранные в tmpfs пакеты будут удалены при перезагрузке. Задайте параметр <a href="#%D0%A0%D0%B0%D1%81%D0%BF%D0%BE%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%B0">PKGDEST</a>, чтобы собранный пакет автоматически перемещался в "постоянный" каталог.</li>
</ul>
</div>
<h4>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BA.D1.8D.D1.88.D0.B0_.D0.BA.D0.BE.D0.BC.D0.BF.D0.B8.D0.BB.D1.8F.D1.86.D0.B8.D0.B8"></span><span class="mw-headline" id="Использование_кэша_компиляции">Использование кэша компиляции</span>
</h4>
<p>Применение <a href="../en/Ccache.html" title="Ccache">ccache</a> сокращает время сборки за счёт многократного использования кэша компиляции.
</p>
<h4>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BA.D0.BE.D0.BC.D0.BF.D0.BE.D0.BD.D0.BE.D0.B2.D1.89.D0.B8.D0.BA.D0.B0_mold"></span><span class="mw-headline" id="Использование_компоновщика_mold">Использование компоновщика mold</span>
</h4>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mold">mold</a></span> — это прозрачная замена компоновщикам <a href="../ru/GNU_Compiler_Collection.html" title="GNU Compiler Collection (Русский)">ld</a>/<a href="../ru/LLVM.html" title="LLVM (Русский)">lld</a>, работающая значительно быстрее.
</p>
<p>Чтобы использовать <i>mold</i>, добавьте <code>-fuse-ld=mold</code> в <code>LDFLAGS</code>. Например:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">LDFLAGS="... -fuse-ld=mold"</pre>
<p>Чтобы использовать <i>mold</i> для Rust-программ, добавьте <code>-C link-arg=-fuse-ld=mold</code> в <code>RUSTFLAGS</code>. Например:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">RUSTFLAGS="... -C link-arg=-fuse-ld=mold"</pre>
<h3>
<span id=".D0.92.D1.8B.D1.87.D0.B8.D1.81.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BD.D0.BE.D0.B2.D1.8B.D1.85_.D0.BA.D0.BE.D0.BD.D1.82.D1.80.D0.BE.D0.BB.D1.8C.D0.BD.D1.8B.D1.85_.D1.81.D1.83.D0.BC.D0.BC"></span><span class="mw-headline" id="Вычисление_новых_контрольных_сумм">Вычисление новых контрольных сумм</span>
</h3>
<p>Установите пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman-contrib">pacman-contrib</a></span> и выполните следующую команду в каталоге с файлом <code>PKGBUILD</code>, чтобы сгенерировать новые контрольные суммы:
</p>
<pre>$ updpkgsums
</pre>
<p><code>updpkgsums</code> использует <code>makepkg --geninteg</code> для вычисления контрольных сумм. Подробнее см. <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1933763#p1933763">обсуждение на форуме</a>.
</p>
<p>Контрольные суммы также можно получить посредством команды <code>sha256sum</code>, после чего полученные значения следует вручную добавить к массиву <code>sha256sums</code> в файле <code>PKGBUILD</code>.
</p>
<h3>
<span id=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B4.D1.80.D1.83.D0.B3.D0.B8.D1.85_.D0.B0.D0.BB.D0.B3.D0.BE.D1.80.D0.B8.D1.82.D0.BC.D0.BE.D0.B2_.D1.81.D0.B6.D0.B0.D1.82.D0.B8.D1.8F"></span><span class="mw-headline" id="Применение_других_алгоритмов_сжатия">Применение других алгоритмов сжатия</span>
</h3>
<p>Создание и установку пакета можно ускорить, заплатив за это увеличением размера. Для этого нужно изменить переменную <code>PKGEXT</code>.
</p>
<p>Например, следующая команда создаст пакет в виде несжатого архива, благодаря чему не нужно будет выполнять его декомпрессию при <a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" title="Help:Reading (Русский)">установке</a>:
</p>
<pre>$ PKGEXT='.pkg.tar' makepkg
</pre>
<p>Другой пример с использованием алгоритма сжатия LZ4:
</p>
<pre>$ PKGEXT='.pkg.tar.lz4' makepkg
</pre>
<p>Чтобы сделать одну из этих настроек постоянной, нужно установить соответствующее значение <code>PKGEXT</code> в <code>/etc/makepkg.conf</code>.
</p>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BD.D0.B5.D1.81.D0.BA.D0.BE.D0.BB.D1.8C.D0.BA.D0.B8.D1.85_.D1.8F.D0.B4.D0.B5.D1.80_.D0.BF.D1.80.D0.B8_.D1.81.D0.B6.D0.B0.D1.82.D0.B8.D0.B8"></span><span class="mw-headline" id="Использование_нескольких_ядер_при_сжатии">Использование нескольких ядер при сжатии</span>
</h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=zstd">zstd</a></span> поддерживает <a href="https://en.wikipedia.org/wiki/ru:%D0%A1%D0%B8%D0%BC%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%BD%D0%B0%D1%8F_%D0%BC%D0%BD%D0%BE%D0%B3%D0%BE%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BE%D1%80%D0%BD%D0%BE%D1%81%D1%82%D1%8C" class="extiw" title="wikipedia:ru:Симметричная многопроцессорность">симметричную многопроцессорность (SMP)</a> посредством флага <code>--threads</code> для ускорения сжатия. Например, чтобы разрешить <i>makepkg</i> использовать все имеющиеся в наличии ядра для сжатия пакетов, отредактируйте массив <code>COMPRESSZST</code> в <code>/etc/makepkg.conf</code>:
</p>
<pre>COMPRESSZST=(zstd -c -z -q <b>--threads=0</b> -)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xz">xz</a></span> поддерживает <a href="https://en.wikipedia.org/wiki/ru:%D0%A1%D0%B8%D0%BC%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%BD%D0%B0%D1%8F_%D0%BC%D0%BD%D0%BE%D0%B3%D0%BE%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BE%D1%80%D0%BD%D0%BE%D1%81%D1%82%D1%8C" class="extiw" title="wikipedia:ru:Симметричная многопроцессорность">симметричную многопроцессорность (SMP)</a> посредством флага <code>--threads</code> для ускорения сжатия. Например, чтобы разрешить <i>makepkg</i> использовать все имеющиеся в наличии ядра для сжатия пакетов, отредактируйте массив <code>COMPRESSXZ</code> в <code>/etc/makepkg.conf</code>:
</p>
<pre>COMPRESSXZ=(xz -c -z --threads=0 -)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pigz">pigz</a></span> — параллельная реализация <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gzip">gzip</a></span>, по умолчанию использует все доступные ядра процессора. Если необходимо задействовать меньшее количество ядер, то используется флаг <code>-p</code>/<code>--processes</code>:
</p>
<pre>COMPRESSGZ=(pigz -c -f -n)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pbzip2">pbzip2</a></span> — параллельная реализация <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bzip2">bzip2</a></span>, также использует максимально возможное количество ядер по умолчанию. Флаг <code>-p#</code> используется для выбора меньшего количества ядер (примечание: между <code>-p</code> и числом ядер не должно быть пробелов):
</p>
<pre>COMPRESSBZ2=(pbzip2 -c -f)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lbzip2">lbzip2</a></span> — ещё одна параллельная реализация <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bzip2">bzip2</a></span>, также использует максимально возможное количество ядер по умолчанию. Флаг <code>-n</code> используется для выбора меньшего количества ядер.
</p>
<pre>COMPRESSBZ2=(<b>lbzip2</b> -c -f)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/plzip/">plzip</a></span><sup><small>AUR</small></sup> — многопоточная реализация <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lzip">lzip</a></span>, также использует максимально возможное количество ядер по умолчанию. Флаг <code>-n</code>/<code>--threads</code> используется для выбора меньшего количества ядер.
</p>
<pre>COMPRESSLZ=(<b>plzip</b> -c -f)
</pre>
<h3>
<span id=".D0.92.D1.8B.D0.B2.D0.BE.D0.B4_.D1.81.D0.BF.D0.B8.D1.81.D0.BA.D0.B0_.D0.BF.D0.B0.D0.BA.D0.B5.D1.82.D0.BE.D0.B2_.D0.BF.D0.BE_.D0.B8.D0.BC.D0.B5.D0.BD.D0.B8_.D1.81.D0.BE.D0.B7.D0.B4.D0.B0.D1.82.D0.B5.D0.BB.D1.8F"></span><span class="mw-headline" id="Вывод_списка_пакетов_по_имени_создателя">Вывод списка пакетов по имени создателя</span>
</h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=expac">expac</a></span> — программа для работы с базой данных pacman. Чтобы вывести список всех установленных пакетов, создателем которых является <i>создатель-пакета</i>, выполните:
</p>
<pre>$ expac "%n %p" | grep "<i>создатель-пакета</i>" | column -t
</pre>
<p>Команда для вывода списка пакетов, создатель которых указан в переменной <code>PACKAGER</code> файла <code>/etc/makepkg.conf</code> (покажет только пакеты из репозиториев, определённых в <code>/etc/pacman.conf</code>):
</p>
<pre>$ . /etc/makepkg.conf; grep -xvFf &lt;(pacman -Qqm) &lt;(expac "%n\t%p" | grep "$PACKAGER$" | cut -f1)
</pre>
<h3>
<span id=".D0.A1.D0.B1.D0.BE.D1.80.D0.BA.D0.B0_32-.D0.B1.D0.B8.D1.82.D0.BD.D1.8B.D1.85_.D0.BF.D0.B0.D0.BA.D0.B5.D1.82.D0.BE.D0.B2_.D0.B2_64-.D0.B1.D0.B8.D1.82.D0.BD.D0.BE.D0.B9_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D0.B5"></span><span class="mw-headline" id="Сборка_32-битных_пакетов_в_64-битной_системе">Сборка 32-битных пакетов в 64-битной системе</span>
</h3>
<p>Смотрите <a href="../en/32-bit_package_guidelines.html" title="32-bit package guidelines">32-bit package guidelines</a>.
</p>
<h3>
<span id="Magnet-.D1.81.D1.81.D1.8B.D0.BB.D0.BA.D0.B8"></span><span class="mw-headline" id="Magnet-ссылки">Magnet-ссылки</span>
</h3>
<p>Можно добавить поддержку magnet-ссылок (протокол <code>magnet://</code>) в массиве <code>source</code> с помощью <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/transmission-dlagent/">transmission-dlagent</a></span><sup><small>AUR</small></sup>.
</p>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_makepkg_.D0.B2_.D0.BA.D0.BE.D0.BD.D1.82.D1.80.D0.BE.D0.BB.D1.8C.D0.BD.D0.BE.D0.B9_.D0.B3.D1.80.D1.83.D0.BF.D0.BF.D0.B5_systemd"></span><span class="mw-headline" id="Запуск_makepkg_в_контрольной_группе_systemd">Запуск makepkg в контрольной группе systemd</span>
</h3>
<p>Если собираемый пакет требует слишком много ресурсов для сборки при использовании стандартных флагов <i>make</i>, которые в остальном работают нормально для большинства пакетов, можно попробовать запустить сборку в отдельной контрольной группе (<a href="../en/Cgroups.html" class="mw-redirect" title="Control group">control group</a>). <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/makepkg-cg/">makepkg-cg</a></span><sup><small>AUR</small></sup> — обёртка для makepkg, которая позволяет реализовать это через systemd control groups (смотрите <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.resource-control"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.resource-control.5">systemd.resource-control(5)</a></span>).
</p>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_.D1.81_.D0.BF.D0.BE.D0.BB.D0.B8.D1.82.D0.B8.D0.BA.D0.BE.D0.B9_.D0.BF.D0.BB.D0.B0.D0.BD.D0.B8.D1.80.D0.BE.D0.B2.D1.89.D0.B8.D0.BA.D0.B0_idle"></span><span class="mw-headline" id="Запуск_с_политикой_планировщика_idle">Запуск с политикой планировщика idle</span>
</h3>
<p>Процесс сборки пакетов может сильно нагружать процессор, особенно если включена <a href="#%D0%9F%D0%B0%D1%80%D0%B0%D0%BB%D0%BB%D0%B5%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D0%BA%D0%BE%D0%BC%D0%BF%D0%B8%D0%BB%D1%8F%D1%86%D0%B8%D1%8F">#Параллельная компиляция</a>. При этом работа остальной системы может сильно замедлиться даже с самым высоким значением <span class="plainlinks archwiki-template-man" title="$ man 1 nice"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nice.1">nice(1)</a></span> — вплоть до зависания пользовательского интерфейса.
</p>
<p>Чтобы до такого не доходило, можно перед запуском <i>makepkg</i> установить политику <code>SCHED_IDLE</code> (крайне низкий приоритет, ниже чем даже nice +19). Такой процесс не будет мешать выполнению обычных задач и будет использовать только свободное процессорное время.
</p>
<p>Изменить политику на <code>SCHED_IDLE</code> можно с помощью команды <span class="plainlinks archwiki-template-man" title="$ man 1 chrt"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/chrt.1">chrt(1)</a></span>, указав флаг <code>-i</code>, приоритет 0 (единственный допустимый приоритет для политики <code>SCHED_IDLE</code>) и PID текущей командной оболочки.
</p>
<p>В большинстве командных оболочек команда будет выглядеть так:
</p>
<pre>$ chrt -iap 0 $$
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Чтобы эта команда применялась при каждой сборке, можно добавить её в файл <code>makepkg.conf</code> (который технически является bash-скриптом).</div>
<p>В <a href="../ru/Fish.html" title="Fish (Русский)">fish</a>:
</p>
<pre>$ chrt -iap 0 %self
</pre>
<h2>
<span id=".D0.A0.D0.B5.D1.88.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC"></span><span class="mw-headline" id="Решение_проблем">Решение проблем</span>
</h2>
<h3>
<span id=".D0.92.D1.8B.D0.B1.D0.BE.D1.80_.D0.BA.D0.B0.D1.82.D0.B0.D0.BB.D0.BE.D0.B3.D0.B0_.D1.83.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B8_.D0.BF.D1.80.D0.B8_.D1.81.D0.B1.D0.BE.D1.80.D0.BA.D0.B5_.D0.B2_QMake"></span><span class="mw-headline" id="Выбор_каталога_установки_при_сборке_в_QMake">Выбор каталога установки при сборке в QMake</span>
</h3>
<p>QMake генерирует файл <code>makefile</code>, в котором для указания каталога установки используется переменная окружения <code>INSTALL_ROOT</code>. Например, вот как будет выглядеть функция <i>package</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">PKGBUILD</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
package() {
	cd "$srcdir/${pkgname%-git}"
	make INSTALL_ROOT="$pkgdir" install
}
...</pre>
<p>Обратите внимание, что qmake тоже должен быть настроен соответственно. К примеру, добавьте следующие строки в соответствующий <i>.pro</i>-файл.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">YourProject.pro</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
target.path = /usr/local/bin
INSTALLS += target
...</pre>
<h3>
<span id="WARNING:_Package_contains_reference_to_.24srcdir"></span><span class="mw-headline" id="WARNING:_Package_contains_reference_to_$srcdir">WARNING: Package contains reference to $srcdir</span>
</h3>
<p>Подобное предупреждение означает, что строковый литерал, указанный в переменных <code>$srcdir</code> или <code>$pkgdir</code>, каким-то образом оказался в одном или нескольких файлах пакета <a rel="nofollow" class="external autonumber" href="https://www.mail-archive.com/arch-general@archlinux.org/msg15561.html">[5]</a>.
</p>
<p>Чтобы определить, в каких именно файлах, выполните следующую команду в рабочем каталоге сборки:
</p>
<pre>$ grep -R "$PWD/src" pkg/
</pre>
<p>Одной из причин появления этого предупреждения может быть использование в коде C/C++ макроса <code>__FILE__</code>, который содержит полный путь к каталогу <code>$srcdir</code>.
</p>
<h3>
<span id="makepkg_.D0.BD.D0.B5_.D0.BC.D0.BE.D0.B6.D0.B5.D1.82_.D0.B7.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.B8.D1.82.D1.8C_.D0.B7.D0.B0.D0.B2.D0.B8.D1.81.D0.B8.D0.BC.D0.BE.D1.81.D1.82.D0.B8_.D1.87.D0.B5.D1.80.D0.B5.D0.B7_.D0.BF.D1.80.D0.BE.D0.BA.D1.81.D0.B8"></span><span class="mw-headline" id="makepkg_не_может_загрузить_зависимости_через_прокси">makepkg не может загрузить зависимости через прокси</span>
</h3>
<p>Когда <i>makepkg</i> проверяет зависимости, он вызывает <a href="../ru/Pacman.html" title="Pacman (Русский)">pacman</a> для установки недостающих пакетов, при этом запрашивая права администратора посредством <i>sudo</i>. Однако команда <i>sudo</i> не передаёт никакие <a href="../ru/Environment_variables.html" class="mw-redirect" title="Переменные окружения">переменные окружения</a> в привилегированное окружение, в том числе и относящиеся к настройкам прокси переменные <code>ftp_proxy</code>, <code>http_proxy</code>, <code>https_proxy</code> и <code>no_proxy</code>.
</p>
<p>Чтобы <i>makepkg</i> мог работать через прокси, воспользуйтесь одним из советов ниже.
</p>
<h4>
<span id=".D0.9F.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80_XferCommand_.D0.B2_.D1.84.D0.B0.D0.B9.D0.BB.D0.B5_.2Fetc.2Fpacman.conf"></span><span class="mw-headline" id="Параметр_XferCommand_в_файле_/etc/pacman.conf">Параметр XferCommand в файле /etc/pacman.conf</span>
</h4>
<p>Параметр <code>XferCommand</code> в файле <code>/etc/pacman.conf</code> позволяет настроить использование прокси. В этом параметре нужно указать URL прокси-сервера. Добавьте или раскомментируйте следующую строку:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
XferCommand = /usr/bin/curl --proxy http://username:password@proxy.proxyhost.com:80 --location --continue-at - --fail --output %o %u
...</pre>
<h4>
<span id=".D0.9F.D0.B0.D1.80.D0.B0.D0.BC.D0.B5.D1.82.D1.80_env_keep_.D0.B2_.D1.84.D0.B0.D0.B9.D0.BB.D0.B5_.2Fetc.2Fsudoers"></span><span class="mw-headline" id="Параметр_env_keep_в_файле_/etc/sudoers">Параметр env_keep в файле /etc/sudoers</span>
</h4>
<p>Опция <code>env_keep</code> в файле <code>/etc/sudoers</code> позволяет использовать упомянутые выше прокси-переменные в привилегированном окружении. Подробнее смотрите <a href="../ru/Pacman.html#pacman_%D0%B8%D0%B3%D0%BD%D0%BE%D1%80%D0%B8%D1%80%D1%83%D0%B5%D1%82_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8_%D0%BF%D1%80%D0%BE%D0%BA%D1%81%D0%B8" title="Pacman (Русский)">pacman (Русский)#pacman игнорирует настройки прокси</a>.
</p>
<h3>
<span id="makepkg_.D0.BD.D0.B5_.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D0.B0.D0.B5.D1.82.2C_.D0.BD.D0.BE_make_.D0.B7.D0.B0.D0.B2.D0.B5.D1.80.D1.88.D0.B0.D0.B5.D1.82.D1.81.D1.8F_.D1.83.D1.81.D0.BF.D0.B5.D1.88.D0.BD.D0.BE"></span><span class="mw-headline" id="makepkg_не_работает,_но_make_завершается_успешно">makepkg не работает, но make завершается успешно</span>
</h3>
<p>Если удаётся скомпилировать пакет командой <i>make</i>, но не получается командой <i>makepkg</i>, причиной могут быть несовместимые переменные компиляции в файле <code>/etc/makepkg.conf</code>. Попробуйте добавить следующие флаги к параметру <code>options</code> файла <code>PKGBUILD</code>:
</p>
<p><code>!buildflags</code> — для отключения значений по умолчанию <code>CPPFLAGS</code>, <code>CFLAGS</code>, <code>CXXFLAGS</code> и <code>LDFLAGS</code>.
</p>
<p><code>!makeflags</code> — для отключения <code>MAKEFLAGS</code>.
</p>
<p><code>!debug</code> — для отключения <code>DEBUG_CFLAGS</code> и <code>DEBUG_CXXFLAGS</code>, если вы собрали пакет для отладки.
</p>
<p>Если что-то из перечисленного выше решило проблему, выясните, какой именно флаг создавал проблему, и сообщите о баге разработчикам программы.
</p>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li><span class="plainlinks archwiki-template-man" title="$ man 8 makepkg"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.8">makepkg(8)</a></span></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 5 makepkg.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.conf.5">makepkg.conf(5)</a></span></li>
<li><a rel="nofollow" class="external text" href="https://gist.github.com/Earnestly/bebad057f40a662b5cc3">Краткое описание работы makepkg</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/pacman/pacman/blob/master/scripts/makepkg.sh.in">Исходный код makepkg</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../ru/Category:Package_development.html" title="Category:Package development (Русский)">Package development (Русский)</a></li>
<li><a href="../ru/Category:About_Arch.html" title="Category:About Arch (Русский)">About Arch (Русский)</a></li>
<li><a href="../ru/Category:Commands.html" title="Category:Commands (Русский)">Commands (Русский)</a></li>
<li><a href="../ru/Category:OpenPGP.html" title="Category:OpenPGP (Русский)">OpenPGP (Русский)</a></li>
</ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Makepkg_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=799297">https://wiki.archlinux.org/index.php?title=Makepkg_(Русский)&amp;oldid=799297</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 1 February 2024, at 18:07.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
