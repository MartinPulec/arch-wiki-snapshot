<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-zebra-design-disabled vector-feature-custom-font-size-clientpref-disabled vector-feature-client-preferences-disabled vector-feature-typography-survey-disabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Advanced Format (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.41.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Advanced_Format_Русский rootpage-Advanced_Format_Русский skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-main-menu-container">
		</div>
	<input type="checkbox" id="vector-toc-collapsed-checkbox" class="vector-menu-checkbox">
			<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark vector-sticky-pinned-container">
				<div id="vector-toc-pinned-container" class="vector-pinned-container">
				<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Изменение_размера_сектора" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%98%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%80%D0%B0_%D1%81%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%B0">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Изменение размера сектора</div>
		</a>
		
			<button aria-controls="toc-Изменение_размера_сектора-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Изменение размера сектора subsection</span>
			</button>
		
		<ul id="toc-Изменение_размера_сектора-sublist" class="vector-toc-list">
			<li id="toc-Жёсткие_диски_Advanced_Format" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%96%D1%91%D1%81%D1%82%D0%BA%D0%B8%D0%B5_%D0%B4%D0%B8%D1%81%D0%BA%D0%B8_Advanced_Format">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Жёсткие диски Advanced Format</div>
			</a>
			
			<ul id="toc-Жёсткие_диски_Advanced_Format-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-NVMe" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#NVMe">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>NVMe</div>
			</a>
			
			<ul id="toc-NVMe-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Использование_программ_производителя" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC_%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Использование программ производителя</div>
			</a>
			
			<ul id="toc-Использование_программ_производителя-sublist" class="vector-toc-list">
				<li id="toc-Intel" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Intel">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.1</span>Intel</div>
			</a>
			
			<ul id="toc-Intel-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Seagate" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Seagate">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.2</span>Seagate</div>
			</a>
			
			<ul id="toc-Seagate-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Выравнивание_разделов" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%92%D1%8B%D1%80%D0%B0%D0%B2%D0%BD%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%80%D0%B0%D0%B7%D0%B4%D0%B5%D0%BB%D0%BE%D0%B2">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Выравнивание разделов</div>
		</a>
		
		<ul id="toc-Выравнивание_разделов-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-dm-crypt" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#dm-crypt">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>dm-crypt</div>
		</a>
		
		<ul id="toc-dm-crypt-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Файловые_системы" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%A4%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D1%8B%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Файловые системы</div>
		</a>
		
		<ul id="toc-Файловые_системы-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Смотрите_также" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Смотрите также</div>
		</a>
		
		<ul id="toc-Смотрите_также-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

				</div>
	</nav>
		
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<label id="vector-toc-collapsed-button" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet vector-button-flush-left cdx-button--icon-only" for="vector-toc-collapsed-checkbox" role="button" aria-controls="vector-toc" tabindex="0" title="Table of Contents">
						<span class="vector-icon mw-ui-icon-wikimedia-listBullet"></span>
						<span>Toggle the table of contents</span>
					</label>
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Advanced Format (Русский)</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 5 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-5" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">5 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-en mw-list-item"><a href="../en/Advanced_Format.html" title="Advanced Format – English" lang="en" hreflang="en" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/Advanced_Format.html" title="Advanced Format – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Advanced_Format" title="Advanced Format – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-tr mw-list-item"><a href="../tr/Advanced_Format.html" title="Advanced Format – Türkçe" lang="tr" hreflang="tr" class="interlanguage-link-target"><span>Türkçe</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/%E5%85%88%E8%BF%9B%E6%A0%BC%E5%BC%8F%E5%8C%96" title="先进格式化 – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<nav class="vector-page-tools-landmark vector-sticky-pinned-container" aria-label="Page tools">
						<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
			
						</div>
	</nav>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="ru" dir="ltr">
<div class="mw-parser-output">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/Advanced_Format.html" title="Advanced Format">Advanced Format</a>. Дата последней синхронизации: 21 сентября 2023. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Advanced_Format&amp;diff=0&amp;oldid=787366">изменения</a>.</div>
<p>Минимальная физическая единица хранения данных на жёстком диске (HDD) называется <a href="https://en.wikipedia.org/wiki/ru:%D0%A1%D0%B5%D0%BA%D1%82%D0%BE%D1%80_%D0%B4%D0%B8%D1%81%D0%BA%D0%B0" class="extiw" title="wikipedia:ru:Сектор диска">сектор</a>. На твердотельных накопителях (SSD) его аналогом является страница.<a rel="nofollow" class="external autonumber" href="https://www.oo-software.com/en/docs/whitepaper/whitepaper_ssd.pdf">[1]</a> Прошивки накопителей абстрагируют физические сектора с помощью логических секторов, с которыми могут работать программы. Размер сектора соответствует размеру наименьшей адресуемой единицы на диске.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Программы и документация иногда используют слова «сектора» и «блоки» как взаимозаменяемые независимо от типа накопителя.</div>
<dl>
<dt>Размер физического сектора</dt>
<dd>Это наименьшая единица, которую накопитель может записать атомарно. Для жёстких дисков это фактический размер секторов на пластине. Раньше физический размер сектора у жёстких дисков обычно составлял 512 байт, то есть каждый сектор вмещал 512 байт данных. Однако с появлением <a href="https://en.wikipedia.org/wiki/ru:Advanced_Format" class="extiw" title="wikipedia:ru:Advanced Format">Advanced Format</a> размер физического сектора был увеличен до 4096 байт (4 КиБ), что позволило повысить плотность хранения данных и улучшить возможности коррекции ошибок. Твердотельные накопители не указывают реальный размер страницы флэш-памяти NAND, который обычно составляет от 4 до 16 КиБ, вместо они сообщают размер физического сектора, совпадающий с размером логического сектора. Для NVMe SSD используется значение параметра Atomic Write Unit Power Fail (AWUPF), если он доступен.</dd>
<dt>Размер логического сектора</dt>
<dd>Логический размер сектора, также известный как размер сектора операционной системы, — это размер секторов, с которыми работают операционная система и приложения. Именно этот размер сектора используется для чтения из накопителя и записи в него на программном уровне. Логический размер сектора может отличаться от физического размера сектора. Например, жёсткий диск Advanced Format с физическим размером сектора 4096 байт может иметь логический размер сектора 512 байт для совместимости со старыми системами и приложениями.</dd>
</dl>
<p>Разные «слои» (устройство / стековые блочные устройства / файловые системы) должны использовать один и тот же размер сектора для эффективной работы. Если размеры сектора не будут совпадать, будет выполняться преобразование из секторов файловой системы в физические сектора, что может снизить производительность.
</p>
<p>Текущие сообщаемые устройством размеры физического и логического секторов можно узнать несколькими способами (однако сообщаемый размер физического сектора может отличаться от реального, особенно на NVMe-накопителях). Например, с помощью <a href="../ru/Device_file.html#lsblk" title="Device file (Русский)">lsblk</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ lsblk -td</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME    ALIGNMENT MIN-IO OPT-IO PHY-SEC LOG-SEC ROTA SCHED       RQ-SIZE  RA WSAME
sda             0   4096      0    4096    4096    1 mq-deadline      64 128    0B
nvme1n1         0   4096      0    4096    4096    0 none           1023 128    0B
nvme0n1         0   4096      0    4096    4096    0 none           1023 128    0B
</pre>
<p>В столбце <code>PHY-SEC</code> указан размер физического сектора, а в <code>LOG-SEC</code> — логического.
</p>
<p>Другой способ — с помощью обращения к sysfs:
</p>
<pre>$ cat /sys/class/block/<i>устройство</i>/queue/physical_block_size
$ cat /sys/class/block/<i>устройство</i>/queue/logical_block_size
</pre>
<p>Информация о размерах секторов также есть в выводе программ <a href="../ru/Fdisk.html" title="Fdisk (Русский)">fdisk</a>, <a href="../ru/S.M.A.R.T..html#smartctl" title="S.M.A.R.T. (Русский)">smartctl</a> и <a href="../ru/Hdparm.html" title="Hdparm (Русский)">hdparm</a>.
</p>
<meta property="mw:PageProp/toc">
<h2>
<span id=".D0.98.D0.B7.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D1.80.D0.B0.D0.B7.D0.BC.D0.B5.D1.80.D0.B0_.D1.81.D0.B5.D0.BA.D1.82.D0.BE.D1.80.D0.B0"></span><span class="mw-headline" id="Изменение_размера_сектора">Изменение размера сектора</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Изменение размера сектора диска приведёт к необратимому стиранию всех данных на диске.</div>
<p>Некоторые накопители NVMe и «корпоративные» жёсткие диски SATA поддерживают изменение сообщаемого ими размера сектора с помощью стандартных команд NVMe (<code>Format NVM</code> из NVM Command Set Specification 1.0 или новее) или (<code>SET SECTOR CONFIGURATION EXT</code> from ATA Command Set - 4 или новее) соответственно. На жёстких дисках при этом изменяется логический размер сектора так, чтобы он соответствовал физическому размеру сектора для оптимальной производительности, а на NVMe SSD можно изменить как логический, так и физический размер сектора.
</p>
<p>Твердотельные накопители SATA, как правило, не поддерживают изменение размера сектора. Исключение составляют некоторые Intel SATA SSD, которые могут изменять сообщаемый ими физический размер сектора, но не логический.<a rel="nofollow" class="external autonumber" href="https://superuser.com/q/982680">[2]</a> Смотрите раздел <a href="#Intel">#Intel</a>.
</p>
<p>Изменение размера сектора диска — сложный процесс, требующий низкоуровневого форматирования. В качестве альтернативы можно вручную указать нужный размер сектора при создании файловых систем на диске для достижения оптимальной производительности. Смотрите разделы <a href="#dm-crypt">#dm-crypt</a> и <a href="#%D0%A4%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D1%8B%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B">#Файловые системы</a>.
</p>
<h3>
<span id=".D0.96.D1.91.D1.81.D1.82.D0.BA.D0.B8.D0.B5_.D0.B4.D0.B8.D1.81.D0.BA.D0.B8_Advanced_Format"></span><span class="mw-headline" id="Жёсткие_диски_Advanced_Format">Жёсткие диски Advanced Format</span>
</h3>
<p>Чтобы узнать, можно ли изменить размер сектора жёсткого диска Advanced Format, можно использовать <a href="../ru/Hdparm.html" title="Hdparm (Русский)">hdparm</a>:
</p>
<pre># hdparm -I /dev/sd<i>X</i> | grep 'Sector size:'
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Для накопителей, подключенных через USB, используемый USB-мост должен поддерживать SAT — <a href="https://en.wikipedia.org/wiki/SCSI_/_ATA_Translation" class="extiw" title="wikipedia:SCSI / ATA Translation">SCSI/ATA Translation</a> (ANSI INCITS 431-2007).</div>
<p>На дисках Advanced Format, в Sector Configuration Log которых указано несколько логических размеров секторов, будет показан их список:
</p>
<pre>        Logical  Sector size:                   512 bytes [ Supported: 512 4096 ]
        Physical Sector size:                  4096 bytes
</pre>
<p>Жёсткие диски, не поддерживающие несколько изменяемых размеров логических секторов, просто сообщают текущие размеры секторов. Например, диск Advanced Format 512e:
</p>
<pre>        Logical  Sector size:                   512 bytes
        Physical Sector size:                  4096 bytes
</pre>
<p>Для достижения оптимальной производительности на дисках такого типа убедитесь, что <a href="#dm-crypt">#dm-crypt</a> или <a href="#%D0%A4%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D1%8B%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B">#Файловые системы</a> имеют размер блока не менее 4096 байт и что соответствующие разделы выровнены по физическому размеру сектора.
</p>
<p>Диск Advanced Format 4Kn:
</p>
<pre>        Logical  Sector size:                  4096 bytes
        Physical Sector size:                  4096 bytes
</pre>
<p>Диски 4Kn уже изначально имеют оптимальную конфигурацию и не нуждаются в особом внимании при разметке разделов и форматировании. Их можно просто использовать как есть.
</p>
<p>Если жёсткий диск SATA поддерживает несколько размеров логических секторов и опциональную ATA-команду <code>SET SECTOR CONFIGURATION EXT</code> (например, диски Seagate, заявляющие поддержку FastFormat), то для переключения между поддерживаемыми размерами логических секторов можно использовать <i>hdparm</i>. Чтобы установить значение 4096 байт, то есть 4Kn, выполните команду:
</p>
<pre># hdparm --set-sector-size 4096 --please-destroy-my-drive /dev/sd<i>X</i>
</pre>
<p>После этого <i>hdparm</i> должен сообщить, что размер логического сектора составляет 4096 байт:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># hdparm -I /dev/sd<i>X</i> | grep 'Sector size:'</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">        Logical  Sector size:                  4096 bytes [ Supported: 512 4096 ]
        Physical Sector size:                  4096 bytes
</pre>
<h3><span class="mw-headline" id="NVMe">NVMe</span></h3>
<p>Большинство <a href="../ru/Solid_state_drive.html" title="Solid state drive (Русский)">твердотельных накопителей</a> (SSD) сообщают логический размер 512 байт, хотя физически они используют более крупные блоки — 4 КиБ, 8 КиБ или даже больше.
</p>
<p>Чтобы проверить размер логического блока (formatted logical block address size, FLBAS) на устройстве <a href="../en/Solid_state_drive/NVMe.html" class="mw-redirect" title="NVMe">NVMe</a>, используйте команду <i>Identify Namespace</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme id-ns -H /dev/nvme0n1 | grep "Relative Performance"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">LBA Format  0 : Metadata Size: 0   bytes - Data Size: 512 bytes - Relative Performance: 0x2 Good (in use)
LBA Format  1 : Metadata Size: 0   bytes - Data Size: 4096 bytes - Relative Performance: 0x1 Better
</pre>
<ul>
<li>
<code>Metadata Size</code> — это количество дополнительных байт метаданных, связанных с адресом логического блока (LBA). Это не очень хорошо поддерживается в Linux, поэтому лучше выбрать формат со значением 0.</li>
<li>
<code>Relative Performance</code> — указывает, какой формат обеспечит сниженную (<i>degraded</i>), хорошую (<i>good</i>), получше (<i>better</i>) или наилучшую (<i>best</i>) производительность.</li>
</ul>
<p><a href="../ru/S.M.A.R.T..html#smartctl" title="S.M.A.R.T. (Русский)">smartctl</a> также умеет показывать поддерживаемые размеры, но не предоставляет удобных для пользователя описаний:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># smartctl -c /dev/nvme0n1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Supported LBA Sizes (NSID 0x1)
Id Fmt  Data  Metadt  Rel_Perf
 0 +     512       0         2
 1 -    4096       0         1
</pre>
<p>Для изменения размера сектора выполните <code>nvme format</code> с указанием предпочтительного значения в параметре <code>--lbaf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme format --lbaf=1 /dev/nvme0n1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">You are about to format nvme0n1, namespace 0x1.
WARNING: Format may irrevocably delete this device's data.
You have 10 seconds to press Ctrl-C to cancel this operation.

Use the force [--force] option to suppress this warning.
Sending format operation ...
Success formatting namespace:1</pre>
<p>Это должно занять всего несколько секунд.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Обязательно соблюдайте <a href="#%D0%92%D1%8B%D1%80%D0%B0%D0%B2%D0%BD%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%80%D0%B0%D0%B7%D0%B4%D0%B5%D0%BB%D0%BE%D0%B2">#Выравнивание разделов</a> при разметке, иначе улучшения производительности не будет.</div>
<p>Некоторые старые накопители (до 2020 года) блокируют команду <code>Format NVM</code>, если прошивка системы отправляет им нестандартную команду «security freeze» после этапа POST.<a rel="nofollow" class="external autonumber" href="https://github.com/linux-nvme/nvme-cli/issues/816">[3]</a><a rel="nofollow" class="external autonumber" href="https://forums.lenovo.com/topic/findpost/1300/5043069/5167342">[4]</a> Если <code>nvme format</code> не работает, попробуйте <a href="../ru/Systemd.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D0%B8%D1%82%D0%B0%D0%BD%D0%B8%D0%B5%D0%BC" title="Systemd (Русский)">перевести систему в ждущий режим</a> (убедитесь, что <a href="../ru/Power_management/Suspend_and_hibernate.html#%D0%98%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D1%80%D0%B5%D0%B6%D0%B8%D0%BC%D0%B0_%D1%81%D0%BD%D0%B0" title="Power management (Русский)/Suspend and hibernate (Русский)">используется именно режим S3, а не S0ix</a>) и выполнить <code>nvme format</code> после пробуждения системы.<a rel="nofollow" class="external autonumber" href="https://github.com/linux-nvme/nvme-cli/issues/84">[5]</a><a rel="nofollow" class="external autonumber" href="https://community.wd.com/t/sn750-cannot-format-using-the-nvme-command/254374">[6]</a>
</p>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D0.BC_.D0.BF.D1.80.D0.BE.D0.B8.D0.B7.D0.B2.D0.BE.D0.B4.D0.B8.D1.82.D0.B5.D0.BB.D1.8F"></span><span class="mw-headline" id="Использование_программ_производителя">Использование программ производителя</span>
</h3>
<p>Если перечисленные выше универсальные инструменты не позволяют изменить размер сектора, возможно, его можно изменить с помощью инструмента от производителя диска.
</p>
<h4><span class="mw-headline" id="Intel">Intel</span></h4>
<p>Для Intel используйте <a rel="nofollow" class="external text" href="https://downloadcenter.intel.com/download/29337/Intel-Memory-and-Storage-Tool-CLI-Command-Line-Interface-?product=83425">Intel Memory and Storage (MAS) Tool</a> (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/intel-mas-cli-tool/">intel-mas-cli-tool</a></span><sup><small>AUR</small></sup>) с опцией <code>-set PhysicalSectorSize=4096</code>.
</p>
<h4><span class="mw-headline" id="Seagate">Seagate</span></h4>
<p>Для Seagate используйте <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/openseachest/">openseachest</a></span><sup><small>AUR</small></sup>.
</p>
<p>Просканируйте все диски, чтобы найти нужный, и выведите информацию о нём:
</p>
<pre># openSeaChest_Basics --scan
# openSeaChest_Basics -d /dev/sd<i>X</i> -i
</pre>
<p>Проверьте серийный номер.
</p>
<p>Проверьте размеры логических блоков, поддерживаемые диском:
</p>
<pre># openSeaChest_Format -d /dev/sd<i>X</i> --showSupportedFormats
</pre>
<p>Если в списке есть 4096, вы можете изменить размер логического сектора на него следующим образом:
</p>
<pre># openSeaChest_Format -d /dev/sd<i>X</i> --setSectorSize=4096 --confirm this-will-erase-data
</pre>
<p>Это займёт несколько минут, после чего ваш диск будет использовать размер сектора 4K.
</p>
<h2>
<span id=".D0.92.D1.8B.D1.80.D0.B0.D0.B2.D0.BD.D0.B8.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D1.80.D0.B0.D0.B7.D0.B4.D0.B5.D0.BB.D0.BE.D0.B2"></span><span class="mw-headline" id="Выравнивание_разделов">Выравнивание разделов</span>
</h2>
<p>Правильное выравнивание разделов позволяет избежать лишних циклов read-modify-write. Типичной практикой для персональных компьютеров является выравнивание начала и размера каждого раздела по числам, кратным 1 МиБ (1 048 576 байт). Это значение очень удобно, так как делится на все часто используемые размеры страницы и блока — 1 МиБ, 512 КиБ, 128 КиБ, 4 КиБ и 512 байт.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Невыровненные разделы помешают использовать размер сектора 4096 байт с dm-crypt/LUKS. <a rel="nofollow" class="external autonumber" href="https://lore.kernel.org/dm-crypt/fe8cd3b4-6d50-66d3-375c-254e278a6443@gmail.com/">[7]</a>
</div>
<ul>
<li>
<a href="../ru/Fdisk.html" title="Fdisk (Русский)">fdisk, cfdisk и sfdisk</a> выполняют выравнивание автоматически.</li>
<li>
<a href="../ru/GPT_fdisk.html" title="GPT fdisk (Русский)">gdisk и cgdisk</a> выполняют выравнивание автоматически.
<ul><li>
<i>sgdisk</i> по умолчанию выравнивает только начала разделов. Используйте опцию <code>-I</code>/<code>--align-end</code> для выравнивания размеров разделов.</li></ul>
</li>
<li>
<a href="../ru/Parted.html#%D0%92%D1%8B%D1%80%D0%B0%D0%B2%D0%BD%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5" title="Parted (Русский)">Parted</a> выравнивает только начало раздела, но не размер. При создании разделов обязательно указывайте конец раздела в мебибайтах или более крупной двоичной единице МЭК.</li>
</ul>
<h2><span class="mw-headline" id="dm-crypt">dm-crypt</span></h2>
<p>В <a href="../en/Dm-crypt/Device_encryption.html#Cryptsetup_usage" class="mw-redirect" title="Cryptsetup">Cryptsetup</a> 2.4.0 <code>luksFormat</code> автоматически определяет оптимальный размер сектора шифрования для формата LUKS2 <a rel="nofollow" class="external autonumber" href="https://mirrors.edge.kernel.org/pub/linux/utils/cryptsetup/v2.4/v2.4.0-ReleaseNotes">[8]</a>.
</p>
<p>Однако, чтобы это работало, устройство должно сообщать правильный размер сектора по умолчанию; смотрите раздел <a href="#%D0%98%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%80%D0%B0_%D1%81%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%B0">#Изменение размера сектора</a>.
</p>
<p>После использования <code>cryptsetup luksFormat</code> вы можете проверить размер сектора, используемого томом LUKS2, с помощью команды
</p>
<pre># cryptsetup luksDump <i>устройство</i> | grep sector
</pre>
<p>Если размер сектора оказался неверный, вы можете принудительно создать контейнер LUKS2, указав размер сектора 4K и оставив другие параметры со значениями по умолчанию:
</p>
<pre># cryptsetup luksFormat --sector-size=4096 <i>устройство</i>
</pre>
<p>Команда выдаст ошибку, если запрашиваемый размер не соответствует вашему устройству:
</p>
<pre># cryptsetup luksFormat --sector-size 4096 <i>устройство</i>
(...)
Verify passphrase:
Device size is not aligned to requested sector size.
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Смотрите <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/-/issues/585">cryptsetup issue 585</a> о том, почему команда может не сработать, если накопитель использует физические сектора 4K.</div>
<p>Если вы уже зашифровали устройство с неправильным размером сектора, устройство можно перешифровать командой:
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Находящаяся на нём файловая система должна использовать размер блока 4096 байт или кратный ему, иначе всё сломается.</div>
<pre># cryptsetup reencrypt --sector-size=4096 <i>устройство</i>
</pre>
<h2>
<span id=".D0.A4.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2.D1.8B.D0.B5_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D1.8B"></span><span class="mw-headline" id="Файловые_системы">Файловые системы</span>
</h2>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.btrfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.btrfs.8">mkfs.btrfs(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.jfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.jfs.8">mkfs.jfs(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.nilfs2"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.nilfs2.8">mkfs.nilfs2(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.reiserfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.reiserfs.8">mkfs.reiserfs(8)</a></span> и <span class="plainlinks archwiki-template-man" title="$ man 8 mkswap"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkswap.8">mkswap(8)</a></span> по умолчанию используют размер сектора 4096 байт.
</p>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.ext4"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.ext4.8">mkfs.ext4(8)</a></span> по умолчанию использует размер сектора 1024 байт для файловых систем меньше чем 512 МиБ и 4096 байт для 512 МиБ и больше.
</p>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.xfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.xfs.8">mkfs.xfs(8)</a></span> по умолчанию использует размер сектора 512 байт, но будет использовать 4096 для 512e и 4Kn дисков.
</p>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.f2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.f2fs.8">mkfs.f2fs(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.fat"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.fat.8">mkfs.fat(8)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.ntfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.ntfs.8">mkfs.ntfs(8)</a></span> и <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.udf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.udf.8">mkfs.udf(8)</a></span> используют логический размер сектора, сообщаемый устройством — то есть 512 байт для 512e и 4096 байт для 4Kn дисков.
</p>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 zpool-create">zpool-create(8)</span> (из <a href="../en/ZFS.html#Advanced_Format_disks" title="ZFS">ZFS</a>) по умолчанию использует размер сектора 512 (2⁹) байт, для использования другого размера его нужно явно указать во время создания пула с помощью параметра <code>-o ashift=12</code> (2¹², 4096 байт).
</p>
<p>Если накопитель не сообщает правильный размер сектора, можно явно указать нужный размер сектора при форматировании.
</p>
<p>В частности, для дисков с <i>черепичной магнитной записью</i> (Shingled Magnetic Recording, SMR), управляемых прошивкой, использование логического размера сектора 512 байт, если их физический размер сектора составляет 4096 байт, приводит к серьёзным негативным последствиям. Эти диски имеют зоны записи с разной производительностью, и перераспределение выполняется во время простоя, но во время активной записи (например, при ресинхронизации RAID, резервном копировании, записи множества небольших файлов, rsync и т. д.) другой размер сектора файловой системы может снизить скорость записи до единиц МиБ/с, так как более производительные зоны записи заканчиваются, а слой трансляции секторов перегружается.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> На системах x86_64 Linux не может монтировать файловые системы с размером блока более 4 КиБ. Подробности и текущий прогресс описаны на странице <a rel="nofollow" class="external text" href="https://kernelnewbies.org/KernelProjects/large-block-size">Large block sizes (LBS)</a>.</div>
<p>Примеры явной установки размера сектора 4096 байт:
</p>
<ul>
<li>
<a href="../en/Ext4.html" class="mw-redirect" title="Ext4 (Русский)">ext4</a>: <pre># mkfs.ext4 -b 4096 /dev/<i>устройство</i></pre>
</li>
<li>
<a href="../ru/XFS.html" title="XFS (Русский)">XFS</a>: <pre># mkfs.xfs -s size=4096 /dev/<i>устройство</i></pre>
</li>
<li>
<a href="../ru/FAT.html" title="FAT (Русский)">FAT</a>: <pre># mkfs.fat -S 4096 /dev/<i>устройство</i></pre>
</li>
<li>
<a href="../ru/NTFS-3G.html" title="NTFS-3G (Русский)">NTFS-3G</a>: <pre># mkfs.ntfs -Q -s 4096 /dev/<i>устройство</i></pre>
</li>
<li>UDF: <pre># mkfs.udf -b 4096 /dev/<i>устройство</i></pre>
</li>
<li>
<a href="../en/ZFS.html#Advanced_Format_disks" title="ZFS">ZFS</a>: <pre># zpool create -o ashift=12 <i>имя-пула</i> raidz <i>устройство0</i> … <i>устройствоN</i></pre>
</li>
</ul>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.anandtech.com/Show/Index/2888">Расширенный формат Western Digital: начинается переход на сектора 4K</a></li>
<li><a rel="nofollow" class="external text" href="https://www.wdc.com/wdproducts/library/WhitePapers/ENG/2579-771430.pdf">Белая книга под названием "Advanced Format Technology."</a></li>
<li>Несоблюдение правил обращения с жёстким диском приводит к ухудшению производительности чтения/записи. Смотрите <a rel="nofollow" class="external text" href="https://www.linuxconfig.org/linux-wd-ears-advanced-format">эту статью</a> для конкретных примеров.</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../ru/Category:Storage.html" title="Category:Storage (Русский)">Storage (Русский)</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Advanced_Format_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=795727">https://wiki.archlinux.org/index.php?title=Advanced_Format_(Русский)&amp;oldid=795727</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 1 January 2024, at 07:28.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
