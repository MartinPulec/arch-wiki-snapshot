<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Internet sharing (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.3">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Internet_sharing_Русский rootpage-Internet_sharing_Русский skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Системные_требования" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%BD%D1%8B%D0%B5_%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Системные требования</div>
		</a>
		
		<ul id="toc-Системные_требования-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Настройка" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Настройка</div>
		</a>
		
			<button aria-controls="toc-Настройка-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Настройка subsection</span>
			</button>
		
		<ul id="toc-Настройка-sublist" class="vector-toc-list">
			<li id="toc-Статический_IP_адрес" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D1%82%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_IP_%D0%B0%D0%B4%D1%80%D0%B5%D1%81">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Статический IP адрес</div>
			</a>
			
			<ul id="toc-Статический_IP_адрес-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Разрешите_пересылку_пакетов" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A0%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D0%B8%D1%82%D0%B5_%D0%BF%D0%B5%D1%80%D0%B5%D1%81%D1%8B%D0%BB%D0%BA%D1%83_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Разрешите пересылку пакетов</div>
			</a>
			
			<ul id="toc-Разрешите_пересылку_пакетов-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Включите_NAT" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D0%B5_NAT">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Включите NAT</div>
			</a>
			
			<ul id="toc-Включите_NAT-sublist" class="vector-toc-list">
				<li id="toc-С_помощью_iptables" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A1_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_iptables">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.1</span>С помощью iptables</div>
			</a>
			
			<ul id="toc-С_помощью_iptables-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-С_помощью_nftables" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A1_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_nftables">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.2</span>С помощью nftables</div>
			</a>
			
			<ul id="toc-С_помощью_nftables-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-С_помощью_firewalld" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A1_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_firewalld">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.3</span>С помощью firewalld</div>
			</a>
			
			<ul id="toc-С_помощью_firewalld-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Назначение_ip_адресов_клиентским_компьютерам" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_ip_%D0%B0%D0%B4%D1%80%D0%B5%D1%81%D0%BE%D0%B2_%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D1%81%D0%BA%D0%B8%D0%BC_%D0%BA%D0%BE%D0%BC%D0%BF%D1%8C%D1%8E%D1%82%D0%B5%D1%80%D0%B0%D0%BC">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4</span>Назначение ip адресов клиентским компьютерам</div>
			</a>
			
			<ul id="toc-Назначение_ip_адресов_клиентским_компьютерам-sublist" class="vector-toc-list">
				<li id="toc-Назначение_ip_адресов_вручную" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_ip_%D0%B0%D0%B4%D1%80%D0%B5%D1%81%D0%BE%D0%B2_%D0%B2%D1%80%D1%83%D1%87%D0%BD%D1%83%D1%8E">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4.1</span>Назначение ip адресов вручную</div>
			</a>
			
			<ul id="toc-Назначение_ip_адресов_вручную-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Решение_проблем" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%A0%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Решение проблем</div>
		</a>
		
			<button aria-controls="toc-Решение_проблем-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Решение проблем subsection</span>
			</button>
		
		<ul id="toc-Решение_проблем-sublist" class="vector-toc-list">
			<li id="toc-Клиенты_не_могут_получить_доступ_к_интернету_или_не_могут_подключиться" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9A%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D1%8B_%D0%BD%D0%B5_%D0%BC%D0%BE%D0%B3%D1%83%D1%82_%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF_%D0%BA_%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B5%D1%82%D1%83_%D0%B8%D0%BB%D0%B8_%D0%BD%D0%B5_%D0%BC%D0%BE%D0%B3%D1%83%D1%82_%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D1%8C%D1%81%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Клиенты не могут получить доступ к интернету или не могут подключиться</div>
			</a>
			
			<ul id="toc-Клиенты_не_могут_получить_доступ_к_интернету_или_не_могут_подключиться-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Смотрите_также" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Смотрите также</div>
		</a>
		
		<ul id="toc-Смотрите_также-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Internet sharing (Русский)</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 4 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-4" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">4 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-en mw-list-item"><a href="../en/Internet_sharing.html" title="Internet sharing – English" lang="en" hreflang="en" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-fr mw-list-item"><a href="../fr/Internet_sharing.html" title="Internet sharing – français" lang="fr" hreflang="fr" class="interlanguage-link-target"><span>Français</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%8D%E3%83%83%E3%83%88%E5%85%B1%E6%9C%89" title="インターネット共有 – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Internet_sharing" title="Internet sharing – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="ru" dir="ltr">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/Internet_sharing.html" title="Internet sharing">Internet sharing</a>. Дата последней синхронизации: 11 декабря 2022. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Internet_sharing&amp;diff=0&amp;oldid=756126">изменения</a>.</div>
<div class="archwiki-template-meta-related-articles">
<p>Ссылки по теме</p>
<ul>
<li><a href="../ru/Android_tethering.html" title="Android tethering (Русский)">Android tethering (Русский)</a></li>
<li><a href="../ru/Software_access_point.html" class="mw-redirect" title="Программная точка доступа">Программная точка доступа</a></li>
<li><a href="../en/Bridge_with_netctl.html" title="Bridge with netctl">Bridge with netctl</a></li>
<li><a href="../en/Ad-hoc_networking.html" title="Ad-hoc networking">Ad-hoc networking</a></li>
<li><a href="../en/Sharing_PPP_Connection.html" title="Sharing PPP Connection">Sharing PPP Connection</a></li>
<li><a href="../ru/Simple_stateful_firewall.html" class="mw-redirect" title="Настройка межсетевого экрана">Настройка межсетевого экрана</a></li>
<li><a href="../en/Router.html" title="Router">Router</a></li>
<li><a href="../en/Mobile_broadband_modem.html" class="mw-redirect" title="USB 3G-модем">USB 3G-модем</a></li>
</ul>
</div>
<p>Эта статья описывает, как раздать подключение к интернету от одного компьютера одному или нескольким другим компьютерам.
</p>
<meta property="mw:PageProp/toc">
<h2>
<span id=".D0.A1.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D0.BD.D1.8B.D0.B5_.D1.82.D1.80.D0.B5.D0.B1.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F"></span><span class="mw-headline" id="Системные_требования">Системные требования</span>
</h2>
<p>Компьютер, выполняющий роль сервера, должен иметь дополнительное сетевое устройство. На нём должно работать соединение <a href="https://en.wikipedia.org/wiki/ru:%D0%9A%D0%B0%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D1%83%D1%80%D0%BE%D0%B2%D0%B5%D0%BD%D1%8C" class="extiw" title="wikipedia:ru:Канальный уровень">канального уровня</a> с компьютером, который будет получать интернет:
</p>
<ul>
<li>Чтобы иметь возможность поделиться интернетом с несколькими компьютерами, можно использовать <a href="https://en.wikipedia.org/wiki/ru:%D0%A1%D0%B5%D1%82%D0%B5%D0%B2%D0%BE%D0%B9_%D0%BA%D0%BE%D0%BC%D0%BC%D1%83%D1%82%D0%B0%D1%82%D0%BE%D1%80" class="extiw" title="wikipedia:ru:Сетевой коммутатор">коммутатор</a>.</li>
<li>Можно раздавать интернет через беспроводную сеть; подробности в статье <a href="../ru/Software_access_point.html" class="mw-redirect" title="Программная точка доступа">Программная точка доступа</a>.</li>
<li>Если доступ предоставляется только одному компьютеру, достаточно <a href="https://en.wikipedia.org/wiki/ru:%D0%9A%D1%80%D0%BE%D1%81%D1%81-%D0%BA%D0%B0%D0%B1%D0%B5%D0%BB%D1%8C_Ethernet" class="extiw" title="wikipedia:ru:Кросс-кабель Ethernet">перекрёстного кабеля</a>. Если одна из сетевых карт поддерживает <a href="https://en.wikipedia.org/wiki/ru:Medium_Dependent_Interface#Auto_MDI-X" class="extiw" title="wikipedia:ru:Medium Dependent Interface">MDI-X</a>, перекрёстный кабель не нужен и можно использовать обычный Ethernet-кабель. Чтобы разобраться в этом, можно выполнить команду <code>ethtool <i>интерфейс</i> | grep MDI</code> от имени root.</li>
</ul>
<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0"></span><span class="mw-headline" id="Настройка">Настройка</span>
</h2>
<p>В этом разделе предполагается, что сетевой интерфейс, подсоединяемый к клиентскому компьютеру (компьютерам), называется <i><b>net0</b></i>, а сетевой интерфейс, подключенный к интернету называется <i><b>internet0</b></i>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Вы можете назвать ваши интерфейсы так же, используя <a href="../ru/Udev.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%BD%D1%8B%D1%85_%D0%B8%D0%BC%D0%B5%D0%BD_%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2" title="Udev (Русский)">udev (Русский)#Установка постоянных имен устройств</a>.</div>
<p>Вся настройка выполняется на компьютере, выполняющем роль сервера, за исключением последнего шага в разделе <a href="#%D0%9D%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_ip_%D0%B0%D0%B4%D1%80%D0%B5%D1%81%D0%BE%D0%B2_%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D1%81%D0%BA%D0%B8%D0%BC_%D0%BA%D0%BE%D0%BC%D0%BF%D1%8C%D1%8E%D1%82%D0%B5%D1%80%D0%B0%D0%BC">#Назначение ip адресов клиентским компьютерам</a>.
</p>
<h3>
<span id=".D0.A1.D1.82.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B9_IP_.D0.B0.D0.B4.D1.80.D0.B5.D1.81"></span><span class="mw-headline" id="Статический_IP_адрес">Статический IP адрес</span>
</h3>
<p>Назначьте статический IPv4 адрес интерфейсу, подключенному к другим компьютерам. Первые 3 байта этого адреса не могут быть такими же как у другого интерфейса.
</p>
<pre># ip link set up dev net0
# ip addr add 192.168.123.100/24 dev net0 # произвольный адрес
</pre>
<p>Чтобы статический ip был назначен при загрузке, можно использовать какой-нибудь <a href="../ru/Network_configuration.html#%D0%A1%D0%B5%D1%82%D0%B5%D0%B2%D1%8B%D0%B5_%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80%D1%8B" title="Network configuration (Русский)">сетевой менеджер</a>.
</p>
<h3>
<span id=".D0.A0.D0.B0.D0.B7.D1.80.D0.B5.D1.88.D0.B8.D1.82.D0.B5_.D0.BF.D0.B5.D1.80.D0.B5.D1.81.D1.8B.D0.BB.D0.BA.D1.83_.D0.BF.D0.B0.D0.BA.D0.B5.D1.82.D0.BE.D0.B2"></span><span class="mw-headline" id="Разрешите_пересылку_пакетов">Разрешите пересылку пакетов</span>
</h3>
<p>Проверьте текущие настройки перенаправления пакетов:
</p>
<pre># sysctl -a | grep forward
</pre>
<p>Вы заметите, что эта опция существует для управления переадресацией по умолчанию, на интерфейсе, а также отдельные опции для IPv4/IPv6 на интерфейсе.
</p>
<p>Введите следующую команду для временного разрешения пересылки пакетов во время выполнения:
</p>
<pre># sysctl net.ipv4.ip_forward=1
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Чтобы включить пересылку пакетов только на определённом интерфейсе, можно вместо этой команды использовать <code>sysctl net.ipv4.conf.<i>интерфейс</i>.forwarding=1</code>.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Если в системе используется <a href="../ru/Systemd-networkd.html" title="Systemd-networkd (Русский)">systemd-networkd</a> для управления сетевыми интерфейсами, настройка отдельных интерфейсов по IPv4 невозможна, так логика systemd будет использовать глобальную конфигурацию IPv4 на всех интерфейсах. Рекомендуемым обходным решением является использование межсетевого экрана для запрета пересылки на отдельных интерфейсах. Смотрите <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.network"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.network.5">systemd.network(5)</a></span> для более подробной информации. Семантика <code>IPForward=kernel</code>, введённая в старой версии systemd 220/221 для следования настройкам ядра, больше не применяется.<a rel="nofollow" class="external autonumber" href="https://github.com/poettering/systemd/commit/765afd5c4dbc71940d6dd6007ecc3eaa5a0b2aa1">[1]</a> <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/blob/a2088fd025deb90839c909829e27eece40f7fce4/NEWS">[2]</a>
</div>
<p>Чтобы разрешение на пересылку для всех интерфейсов осталось после перезагрузки, отредактируйте <code>/etc/sysctl.d/30-ipforward.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sysctl.d/30-ipforward.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">net.ipv4.ip_forward=1
net.ipv6.conf.default.forwarding=1
net.ipv6.conf.all.forwarding=1
</pre>
<p>После этого рекомендуется дважды проверить, что после перезагрузки пересылка работает как положено.
</p>
<h3>
<span id=".D0.92.D0.BA.D0.BB.D1.8E.D1.87.D0.B8.D1.82.D0.B5_NAT"></span><span class="mw-headline" id="Включите_NAT">Включите NAT</span>
</h3>
<h4>
<span id=".D0.A1_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_iptables"></span><span class="mw-headline" id="С_помощью_iptables">С помощью iptables</span>
</h4>
<p><a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">Установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iptables">iptables</a></span>. Используйте <a href="../ru/Iptables.html" title="Iptables (Русский)">iptables</a>, чтобы включить NAT:
</p>
<pre># iptables -t nat -A POSTROUTING -o internet0 -j MASQUERADE
# iptables -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
# iptables -A FORWARD -i net0 -o internet0 -j ACCEPT
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Разумеется, это тоже будет работать с мобильным широкополосном соединением (обычно называемом ppp0 на раздающем компьютере).</div>
<p>Используйте <code>-I DOCKER-USER</code> вместо <code>-A FORWARD</code>, если у вас установлен docker. <a rel="nofollow" class="external autonumber" href="https://docs.docker.com/network/iptables/">[3]</a>
</p>
<pre># iptables -t nat -A POSTROUTING -o internet0 -j MASQUERADE
# iptables -I DOCKER-USER 1 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
# iptables -I DOCKER-USER 2 -i net0 -o internet0 -j ACCEPT
</pre>
<p>При подключении через PPPoE уменьшите mss до pmtu, чтобы предотвратить фрагментацию:
</p>
<pre># iptables -t mangle -A FORWARD -o ppp0 -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu
</pre>
<p>Прочтите статью <a href="../ru/Iptables.html" title="Iptables (Русский)">iptables (Русский)</a> для дополнительной информации (в особенности о сохранении правил и их автоматическом применении при загрузке). Также есть отличная инструкция по iptables <a href="../ru/Simple_stateful_firewall.html" title="Simple stateful firewall (Русский)">Simple stateful firewall (Русский)</a>.
</p>
<h4>
<span id=".D0.A1_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_nftables"></span><span class="mw-headline" id="С_помощью_nftables">С помощью nftables</span>
</h4>
<p><a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">Установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nftables">nftables</a></span>. Для включения NAT с помощью <a href="../ru/Nftables.html" title="Nftables (Русский)">nftables</a> создайте цепочку <code>postrouting</code> в новой/существующей таблице:
</p>
<pre># nft add table inet nat
# nft add chain inet nat postrouting '{ type nat hook postrouting priority 100 ; }'
</pre>
<p>После этого включите маскарадинг адресов из интерфейса <code>net0</code> для интерфейса <code>internet0</code>:
</p>
<pre># nft add rule inet nat postrouting oifname internet0 masquerade
</pre>
<p>Возможно, вы захотите добавить ещё несколько ограничений межсетевого экрана на пересылку (при условии, что таблица фильтров уже существует и настроена как описано в разделе <a href="../ru/Nftables.html#%D0%A1%D0%B5%D1%80%D0%B2%D0%B5%D1%80" title="Nftables (Русский)">nftables (Русский)#Сервер</a>):
</p>
<pre># nft add chain inet filter forward '{ type filter hook forward priority 0; policy drop; }'
# nft add rule inet filter forward ct state related,established accept
# nft add rule inet filter forward iifname net0 oifname internet0 accept
</pre>
<p>Дополнительную информацию о NAT в nftables можно найти в <a rel="nofollow" class="external text" href="https://wiki.nftables.org/wiki-nftables/index.php/Performing_Network_Address_Translation_(NAT)">nftables Wiki</a>. Чтобы сделать изменения постоянными, следуйте инструкциям в статье <a href="../ru/Nftables.html" title="Nftables (Русский)">nftables (Русский)</a>.
</p>
<h4>
<span id=".D0.A1_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_firewalld"></span><span class="mw-headline" id="С_помощью_firewalld">С помощью firewalld</span>
</h4>
<p><a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">Установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=firewalld">firewalld</a></span>. <a href="../en/Firewalld.html" title="Firewalld">firewalld</a> — это демон межсетевого экрана, который полагается на <a href="../ru/Nftables.html" title="Nftables (Русский)">nftables</a> и <a href="../ru/Iptables.html" title="Iptables (Русский)">iptables</a>. Сначала измените зоны сетевых интерфейсов firewalld:
</p>
<pre># firewall-cmd --zone=external --change-interface=internet0 --permanent
# firewall-cmd --zone=internal --change-interface=net0 --permanent
</pre>
<p>Затем добавьте новую политику для пропуска трафика между внутренней и внешней зоной:
</p>
<pre># firewall-cmd --permanent --new-policy int2ext
# firewall-cmd --permanent --policy int2ext --add-ingress-zone internal
# firewall-cmd --permanent --policy int2ext --add-egress-zone external
# firewall-cmd --permanent --policy int2ext --set-target ACCEPT
# firewall-cmd --reload
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Вы можете использовать более строгие правила политики, чем просто <code>ACCEPT</code>, как показано в разделе <code>Firewall Rules</code> в документации firewalld.<a rel="nofollow" class="external autonumber" href="https://firewalld.org/documentation/concepts.html">[4]</a>
<p>Например, чтобы разрешить доступ в интернет только узлам <code>192.168.2.0/24</code>, выполните:
</p>
<p><code>firewall-cmd --permanent --policy int2ext --add-rich-rule='rule family=ipv4 source address=192.168.2.0/24 accept'</code>
Не забудьте потом перегрузить правила:
</p>
<code>firewall-cmd --reload</code>
</div>
<h3>
<span id=".D0.9D.D0.B0.D0.B7.D0.BD.D0.B0.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_ip_.D0.B0.D0.B4.D1.80.D0.B5.D1.81.D0.BE.D0.B2_.D0.BA.D0.BB.D0.B8.D0.B5.D0.BD.D1.82.D1.81.D0.BA.D0.B8.D0.BC_.D0.BA.D0.BE.D0.BC.D0.BF.D1.8C.D1.8E.D1.82.D0.B5.D1.80.D0.B0.D0.BC"></span><span class="mw-headline" id="Назначение_ip_адресов_клиентским_компьютерам">Назначение ip адресов клиентским компьютерам</span>
</h3>
<p>Если вы планируете регулярно подключать какие-то компьютеры для использования интернета через ваш компьютер, хорошей идеей будет установка <a href="https://en.wikipedia.org/wiki/ru:DHCP" class="extiw" title="wikipedia:ru:DHCP">dhcp сервера</a>.
В качестве DHCP-сервера можно использовать, например, <a href="../ru/Dhcpd.html" title="Dhcpd (Русский)">dhcpd (Русский)</a> или <a href="../en/Dnsmasq.html" class="mw-redirect" title="Dnsmasq (Русский)">dnsmasq</a>.
Затем установите DHCP-клиент (например, <a href="../ru/Dhcpcd.html" title="Dhcpcd (Русский)">dhcpcd</a>) на каждый клиентский компьютер.
</p>
<p>На стороне сервера должен быть разрешён приём пакетов на UDP-порт 67. Также нужно разрешить входящие соединения с UDP/TCP портом 53 для DNS запросов. Пример для <a href="../ru/Iptables.html" title="Iptables (Русский)">iptables</a>:
</p>
<pre># iptables -I INPUT -p udp --dport 67 -i net0 -j ACCEPT
# iptables -I INPUT -p udp --dport 53 -s 192.168.123.0/24 -j ACCEPT
# iptables -I INPUT -p tcp --dport 53 -s 192.168.123.0/24 -j ACCEPT
</pre>
<p>Если вы не планируете такое подключение на регулярной основе, вы можете задать ip адреса каждому клиенту вручную.
</p>
<h4>
<span id=".D0.9D.D0.B0.D0.B7.D0.BD.D0.B0.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_ip_.D0.B0.D0.B4.D1.80.D0.B5.D1.81.D0.BE.D0.B2_.D0.B2.D1.80.D1.83.D1.87.D0.BD.D1.83.D1.8E"></span><span class="mw-headline" id="Назначение_ip_адресов_вручную">Назначение ip адресов вручную</span>
</h4>
<p>Вместо использования DHCP можно вручную задать статический IP-адрес и маршрут по умолчанию через <code>192.168.123.100</code>. Существует множество инструментов для соответствующей настройки сети. Одним из ярких примеров такого инструмента является <span class="plainlinks archwiki-template-man" title="$ man 8 ip"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ip.8">ip(8)</a></span>, смотрите раздел <a href="../ru/Network_configuration.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D1%8B%D0%BC_%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5%D0%BC" class="mw-redirect" title="Настройка сети">Настройка сети#Управление сетевым подключением</a>. Или можно использовать файл <code>.network</code>, смотрите раздел <a href="../ru/Systemd-networkd.html#%D0%9F%D1%80%D0%BE%D0%B2%D0%BE%D0%B4%D0%BD%D0%BE%D0%B9_%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81_%D1%81%D0%BE_%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%BC_IP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81%D0%BE%D0%BC" title="Systemd-networkd (Русский)">systemd-networkd (Русский)#Проводной интерфейс со статическим IP-адресом</a> для настройки статического IP.
</p>
<p>Укажите DNS сервер на каждом клиентском компьютере. Смотрите <a href="../ru/Domain_name_resolution.html" class="mw-redirect" title="Resolv.conf (Русский)">resolv.conf</a> для дополнительной информации.
</p>
<p>Теперь клиентский компьютер должен иметь доступ в Internet.
</p>
<h2>
<span id=".D0.A0.D0.B5.D1.88.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC"></span><span class="mw-headline" id="Решение_проблем">Решение проблем</span>
</h2>
<p>Если вы можете подключить два компьютера, но не можете пересылать данные (например, если клиентский делает DHCP запрос к раздающему компьютеру, раздающий компьютер получает запрос и предлагает IP клиенту, но клиент не принимает его, а вместо этого происходит тайм аут), проверьте, что вы не имеете других <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1093208">интерферирующих</a> правил <a href="../ru/Iptables.html" title="Iptables (Русский)">iptables</a>.
</p>
<h3>
<span id=".D0.9A.D0.BB.D0.B8.D0.B5.D0.BD.D1.82.D1.8B_.D0.BD.D0.B5_.D0.BC.D0.BE.D0.B3.D1.83.D1.82_.D0.BF.D0.BE.D0.BB.D1.83.D1.87.D0.B8.D1.82.D1.8C_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF_.D0.BA_.D0.B8.D0.BD.D1.82.D0.B5.D1.80.D0.BD.D0.B5.D1.82.D1.83_.D0.B8.D0.BB.D0.B8_.D0.BD.D0.B5_.D0.BC.D0.BE.D0.B3.D1.83.D1.82_.D0.BF.D0.BE.D0.B4.D0.BA.D0.BB.D1.8E.D1.87.D0.B8.D1.82.D1.8C.D1.81.D1.8F"></span><span class="mw-headline" id="Клиенты_не_могут_получить_доступ_к_интернету_или_не_могут_подключиться">Клиенты не могут получить доступ к интернету или не могут подключиться</span>
</h3>
<p>Симптомы могут быть такие: клиенты получают сообщение <code>host is down</code>, когда пингуют хост, получают <code>no route to host</code>, когда пингуют устройства вне локальной сети (которые должны быть перенаправлены через NAT), DHCP-запросы не проходят через мост, ...
</p>
<p>Известно, что такие проблемы может вызывать <a href="../ru/Docker.html" title="Docker (Русский)">Docker</a>. Простое <a href="../ru/Systemd.html#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" title="Systemd (Русский)">отключение</a> юнитов <code>docker.service</code> и <code>docker.socket</code> решает проблему.
</p>
<p><a rel="nofollow" class="external text" href="https://github.com/moby/moby/issues/43719">docker github issue</a>.
</p>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://xyne.dev/notes/network/dhcp_with_dns.html">Xyne's guide and scripts for launching a subnet with DHCP and DNS</a></li>
<li>
<a href="../en/NetworkManager.html" class="mw-redirect" title="NetworkManager (Русский)">NetworkManager</a> также может раздавать интернет, если он используется для управления сетью.</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../ru/Category:Network_sharing.html" title="Category:Network sharing (Русский)">Network sharing (Русский)</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Internet_sharing_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=759956">https://wiki.archlinux.org/index.php?title=Internet_sharing_(Русский)&amp;oldid=759956</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 11 December 2022, at 20:28.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
