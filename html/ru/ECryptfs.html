<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>eCryptfs (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-ECryptfs_Русский rootpage-ECryptfs_Русский skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Основы" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D1%8B">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Основы</div>
		</a>
		
			<button aria-controls="toc-Основы-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Основы subsection</span>
			</button>
		
		<ul id="toc-Основы-sublist" class="vector-toc-list">
			<li id="toc-Недостатки" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B5%D0%B4%D0%BE%D1%81%D1%82%D0%B0%D1%82%D0%BA%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Недостатки</div>
			</a>
			
			<ul id="toc-Недостатки-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Установка_и_монтирование" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%B8_%D0%BC%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Установка и монтирование</div>
		</a>
		
			<button aria-controls="toc-Установка_и_монтирование-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Установка и монтирование subsection</span>
			</button>
		
		<ul id="toc-Установка_и_монтирование-sublist" class="vector-toc-list">
			<li id="toc-Инструменты_Ubuntu" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%98%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B_Ubuntu">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Инструменты Ubuntu</div>
			</a>
			
			<ul id="toc-Инструменты_Ubuntu-sublist" class="vector-toc-list">
				<li id="toc-Шифрование_каталога" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A8%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.1</span>Шифрование каталога</div>
			</a>
			
			<ul id="toc-Шифрование_каталога-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Шифрование_домашнего_каталога" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A8%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B3%D0%BE_%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.2</span>Шифрование домашнего каталога</div>
			</a>
			
			<ul id="toc-Шифрование_домашнего_каталога-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Монтирование" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9C%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.3</span>Монтирование</div>
			</a>
			
			<ul id="toc-Монтирование-sublist" class="vector-toc-list">
				<li id="toc-Вручную" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#%D0%92%D1%80%D1%83%D1%87%D0%BD%D1%83%D1%8E">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.3.1</span>Вручную</div>
			</a>
			
			<ul id="toc-Вручную-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Автомонтирование" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.3.2</span>Автомонтирование</div>
			</a>
			
			<ul id="toc-Автомонтирование-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-ecryptfs-simple" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ecryptfs-simple">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>ecryptfs-simple</div>
			</a>
			
			<ul id="toc-ecryptfs-simple-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Ручная_настройка" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A0%D1%83%D1%87%D0%BD%D0%B0%D1%8F_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Ручная настройка</div>
			</a>
			
			<ul id="toc-Ручная_настройка-sublist" class="vector-toc-list">
				<li id="toc-С_использованием_файлов_настроек" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A1_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%BC_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B5%D0%BA">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.1</span>С использованием файлов настроек</div>
			</a>
			
			<ul id="toc-С_использованием_файлов_настроек-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-С_использованием_команды_mount" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A1_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%D0%BC_%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4%D1%8B_mount">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.2</span>С использованием команды mount</div>
			</a>
			
			<ul id="toc-С_использованием_команды_mount-sublist" class="vector-toc-list">
				<li id="toc-Монтирование_2" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#%D0%9C%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.2.1</span>Монтирование</div>
			</a>
			
			<ul id="toc-Монтирование_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Автомонтирование_2" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.2.2</span>Автомонтирование</div>
			</a>
			
			<ul id="toc-Автомонтирование_2-sublist" class="vector-toc-list">
				<li id="toc-Дополнительный_шаг" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#%D0%94%D0%BE%D0%BF%D0%BE%D0%BB%D0%BD%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D1%88%D0%B0%D0%B3">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.2.2.1</span>Дополнительный шаг</div>
			</a>
			
			<ul id="toc-Дополнительный_шаг-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Использование" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Использование</div>
		</a>
		
			<button aria-controls="toc-Использование-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Использование subsection</span>
			</button>
		
		<ul id="toc-Использование-sublist" class="vector-toc-list">
			<li id="toc-Ссылка_в_зашифрованный_каталог" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D1%81%D1%8B%D0%BB%D0%BA%D0%B0_%D0%B2_%D0%B7%D0%B0%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B9_%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Ссылка в зашифрованный каталог</div>
			</a>
			
			<ul id="toc-Ссылка_в_зашифрованный_каталог-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Удаление_зашифрованного_каталога" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A3%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B7%D0%B0%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE_%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Удаление зашифрованного каталога</div>
			</a>
			
			<ul id="toc-Удаление_зашифрованного_каталога-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Резервное_копирование" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A0%D0%B5%D0%B7%D0%B5%D1%80%D0%B2%D0%BD%D0%BE%D0%B5_%D0%BA%D0%BE%D0%BF%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Резервное копирование</div>
			</a>
			
			<ul id="toc-Резервное_копирование-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Известные_проблемы" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%98%D0%B7%D0%B2%D0%B5%D1%81%D1%82%D0%BD%D1%8B%D0%B5_%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D1%8B">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Известные проблемы</div>
		</a>
		
			<button aria-controls="toc-Известные_проблемы-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Известные проблемы subsection</span>
			</button>
		
		<ul id="toc-Известные_проблемы-sublist" class="vector-toc-list">
			<li id="toc-При_подключении_через_Mosh_может_произойти_сбой_монтирования_на_удалённом_хосте" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%B8_%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B8_%D1%87%D0%B5%D1%80%D0%B5%D0%B7_Mosh_%D0%BC%D0%BE%D0%B6%D0%B5%D1%82_%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%BE%D0%B9%D1%82%D0%B8_%D1%81%D0%B1%D0%BE%D0%B9_%D0%BC%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_%D0%BD%D0%B0_%D1%83%D0%B4%D0%B0%D0%BB%D1%91%D0%BD%D0%BD%D0%BE%D0%BC_%D1%85%D0%BE%D1%81%D1%82%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>При подключении через Mosh может произойти сбой монтирования на удалённом хосте</div>
			</a>
			
			<ul id="toc-При_подключении_через_Mosh_может_произойти_сбой_монтирования_на_удалённом_хосте-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Смотрите_также" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Смотрите также</div>
		</a>
		
		<ul id="toc-Смотрите_также-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">eCryptfs (Русский)</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 2 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-2" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">2 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-en mw-list-item"><a href="../en/ECryptfs.html" title="ECryptfs – English" lang="en" hreflang="en" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/ECryptfs" title="ECryptfs – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="ru" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/ECryptfs.html" title="ECryptfs">eCryptfs</a>. Дата последней синхронизации: 24 июля 2022. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=ECryptfs&amp;diff=0&amp;oldid=738909">изменения</a>.</div>
<p>В статье описывается базовое использование <a rel="nofollow" class="external text" href="https://launchpad.net/ecryptfs">eCryptfs</a>. Статья проведёт вас через процесс установки зашифрованной домашней директории,
в которой вы можете хранить личные/секретные данные.
</p>
<p>Реализация eCryptfs отличается от реализации <a href="../en/Dm-crypt.html" class="mw-redirect" title="Dm-crypt (Русский)">dm-crypt</a>, которая предоставляет <i>слой шифрования блочного устройства</i>, в то время как eCryptfs является файловой системой — <a href="https://en.wikipedia.org/wiki/Filesystem-level_encryption" class="extiw" title="wikipedia:Filesystem-level encryption">стековая криптографическая файловая система</a>. О сравнении двух методов шифрования можно прочитать в статье <a href="../ru/Data-at-rest_encryption.html#%D0%A1%D1%80%D0%B0%D0%B2%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D1%82%D0%B8%D0%BF%D0%BE%D0%B2_%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F" title="Data-at-rest encryption (Русский)">Data-at-rest encryption (Русский)#Сравнение типов шифрования</a>. Отличительной особенностью eCryptfs является то, что шифрование работает поверх существующей файловой системы; eCryptfs может быть смонтирован на любой существующий каталог и не требует отдельного раздела (или предварительного выделения места).
</p>
<meta property="mw:PageProp/toc">
<h2>
<span id=".D0.9E.D1.81.D0.BD.D0.BE.D0.B2.D1.8B"></span><span class="mw-headline" id="Основы">Основы</span>
</h2>
<p>Как уже упоминалось выше, eCryptfs не требует создавать отдельный раздел или предварительно выделять место. Вместо этого вы можете смонтировать eCryptfs поверх любого отдельного каталога для его защиты. Это включает, например, весь домашний каталог пользователя или отдельные каталоги внутри него. Все метаданные, необходимые для работы с шифрованием, хранятся в заголовках файлов, поэтому зашифрованные данные можно легко перемещать, хранить для резервного копирования и восстанавливать. Есть и другие преимущества, но есть и недостатки, например, eCryptfs не подходит для шифрования разделов целиком, что также означает, что вы не можете с его помощью защитить подкачку (но вы, конечно, можете использовать его совместно с <a href="../en/Dm-crypt/Swap_encryption.html" title="Dm-crypt/Swap encryption">dm-crypt/Swap encryption</a>). Если вы только начинаете работать с шифрованием диска, шифрование подкачки и другие моменты, на которые стоит обратить внимание, рассматриваются в разделе <a href="../ru/Data-at-rest_encryption.html#%D0%9F%D0%BE%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0" title="Data-at-rest encryption (Русский)">Data-at-rest encryption (Русский)#Подготовка</a>.
</p>
<p>Несколько моментов для ознакомления с eCryptfs:
</p>
<ul>
<li>Так как eCryptfs это стековая ФС, монтирование eCryptfs означает монтирование зашифрованного каталога в другую <b>не</b>зашифрованную точку монтирования (каталог).</li>
<li>Существует возможность совместного использования зашифрованного каталога несколькими пользователями. Однако шифрование выполняется одним паролем, поэтому пароль тоже должен быть общим для всех. Также можно совместно использовать каталог с разными зашифрованными файлами (разные пароли).</li>
<li>Некоторые термины eCryptfs, используемые в документации:
<ul>
<li>В документации eCryptfs и в этой статье каталог, в котором хранятся данные в зашифрованном виде, называется <b>нижним</b> (lower), а каталог, в котором отображаются расшифрованные данные, — <b>верхним</b> (upper). Хотя это и не относится к данной статье, <a href="../ru/Overlay_filesystem.html" title="Overlay filesystem (Русский)">файловая система Overlay</a>, представленная в Linux 3.18, использует <a rel="nofollow" class="external text" href="https://docs.kernel.org/filesystems/overlayfs.html#upper-and-lower">то же обозначение верхних/нижних каталогов</a> для объединения файловых систем.</li>
<li>Пароль <b>монтирования</b> (mount passphrase или key) — это то, что даёт доступ к зашифрованным файлам, то есть выполняет разблокировку зашифрованных данных. eCryptfs использует термин «<b>wrapped</b> passphrase» для обозначения криптографически защищённого пароля монтирования.</li>
<li>
<code>FEKEK</code> означает <b>F</b>ile's <b>E</b>ncryption <b>K</b>ey <b>E</b>ncryption <b>K</b>ey — ключ шифрования, которым шифруются ключи шифрования файлов (смотрите <a rel="nofollow" class="external text" href="https://docs.kernel.org/security/keys/ecryptfs.html">документацию ядра</a>).</li>
<li>
<code>FNEK</code> означает <b>F</b>ile <b>N</b>ame <b>E</b>ncryption <b>K</b>ey, ключ для (опционального) шифрования имён файлов, хранящихся в зашифрованном каталоге.</li>
</ul>
</li>
</ul>
<p>Перед использованием eCryptfs проверьте применимость следующих недостатков.
</p>
<h3>
<span id=".D0.9D.D0.B5.D0.B4.D0.BE.D1.81.D1.82.D0.B0.D1.82.D0.BA.D0.B8"></span><span class="mw-headline" id="Недостатки">Недостатки</span>
</h3>
<ul><li>Простота использования</li></ul>
<dl><dd>Пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ecryptfs-utils">ecryptfs-utils</a></span> предоставляет несколько различных способов настройки eCryptfs. Высокоуровневые <a href="#%D0%98%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B_Ubuntu">#Инструменты Ubuntu</a> наиболее просты в использовании, но они жёстко кодируют путь к нижнему каталогу и другие настройки, что ограничивает их полезность. Пакет также включает низкоуровневые инструменты, которые полностью настраиваются, но они несколько сложнее в использовании по сравнению с альтернативами вроде <a href="../en/EncFS.html" class="mw-redirect" title="EncFS (Русский)">EncFS</a>.</dd></dl>
<ul><li>Длина имени файла</li></ul>
<dl><dd>Имена файлов длиной более 143 байт не могут быть зашифрованы (с опцией <code>FNEK</code>), если используется файловая система с максимальной длиной имени файла 255 байт.<a rel="nofollow" class="external autonumber" href="https://bugs.launchpad.net/ecryptfs/+bug/344878">[1]</a> Это может нарушить работу некоторых программ в вашем домашнем каталоге (например, кэширование <a href="https://en.wikipedia.org/wiki/ru:Symfony" class="extiw" title="wikipedia:ru:Symfony">Symfony</a>).</dd></dl>
<ul><li>Монтирование сетевых хранилищ</li></ul>
<dl><dd>eCryptfs имеет давние <a rel="nofollow" class="external text" href="https://bugs.launchpad.net/ecryptfs/+bug/277578">баги</a> при использовании поверх NFS и, возможно, других сетевых файловых систем, например, <a href="#%D0%9F%D1%80%D0%B8_%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B8_%D1%87%D0%B5%D1%80%D0%B5%D0%B7_Mosh_%D0%BC%D0%BE%D0%B6%D0%B5%D1%82_%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%BE%D0%B9%D1%82%D0%B8_%D1%81%D0%B1%D0%BE%D0%B9_%D0%BC%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_%D0%BD%D0%B0_%D1%83%D0%B4%D0%B0%D0%BB%D1%91%D0%BD%D0%BD%D0%BE%D0%BC_%D1%85%D0%BE%D1%81%D1%82%D0%B5">#При подключении через Mosh может произойти сбой монтирования на удалённом хосте</a>. Всегда можно использовать eCryptfs в локальном каталоге, а затем скопировать зашифрованные файлы из локального каталога на сетевой хост. Однако, если вы хотите установить eCryptfs непосредственно поверх NFS, без локальной копии файлов, eCryptfs может упасть или вести себя некорректно. Если вы сомневаетесь, <a href="../en/EncFS.html" class="mw-redirect" title="EncFS (Русский)">EncFS</a> может быть лучшим выбором в этом случае.</dd></dl>
<ul><li>Разрежённые файлы</li></ul>
<dl><dd>
<a href="https://en.wikipedia.org/wiki/ru:%D0%A0%D0%B0%D0%B7%D1%80%D0%B5%D0%B6%D1%91%D0%BD%D0%BD%D1%8B%D0%B9_%D1%84%D0%B0%D0%B9%D0%BB" class="extiw" title="wikipedia:ru:Разрежённый файл">Разрежённые файлы</a>, записанные в eCryptfs, будут создавать более крупные, не разрежённые зашифрованные файлы в нижнем каталоге. Например, в каталоге eCryptfs выполнение команды <code>truncate -s 1G file.img</code> создаст зашифрованный файл размером 1 ГБ в нижней файловой системе с соответствующими требованиями к ресурсам (дисковое пространство, пропускная способность). Если бы тот же файл был создан на незашифрованной файловой системе или файловой системе, использующей <a href="../ru/Data-at-rest_encryption.html#%D0%A8%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B1%D0%BB%D0%BE%D1%87%D0%BD%D0%BE%D0%B3%D0%BE_%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%B0" title="Data-at-rest encryption (Русский)">шифрование блочного устройства</a>, он занял бы всего несколько килобайт.</dd></dl>
<dl><dd>Это следует учитывать, прежде чем шифровать большие части структуры каталогов, хотя в большинстве случаев недостатки будут незначительными. Если вам необходимо использовать большие разрежённые файлы, вы можете обойти эту проблему, поместив разрежённые файлы в незашифрованный каталог или используя для них шифрование блочного устройства.</dd></dl>
<h2>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_.D0.B8_.D0.BC.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Установка_и_монтирование">Установка и монтирование</span>
</h2>
<p>Перед началом посмотрите <a rel="nofollow" class="external text" href="https://www.ecryptfs.org/documentation">документацию eCryptfs</a>.
</p>
<p>eCryptfs входит в ядро с версии 2.6.19, но для работы с ней, вам нужны дополнительные инструменты: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ecryptfs-utils">ecryptfs-utils</a></span> и <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=keyutils">keyutils</a></span>.
</p>
<p>После установки загрузите модуль ядра:
</p>
<pre># modprobe ecryptfs
</pre>
<p>Чтобы примонтировать eCryptfs, нужны пользовательские инструменты из пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ecryptfs-utils">ecryptfs-utils</a></span>. К сожалению, из-за плохого дизайна этих инструментов лучше выбирать один из следующих трёх способов настройки eCryptfs с различными компромиссами:
</p>
<ol>
<li>Высокоуровневые <a href="#%D0%98%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B_Ubuntu">#Инструменты Ubuntu</a>, которые настраивают всё автоматически, но требуют, чтобы нижний каталог был <code>~/.Private/</code>, и позволяют использовать только одну зашифрованную файловую систему на пользователя.</li>
<li>
<a href="#ecryptfs-simple">#ecryptfs-simple</a>, доступный в AUR, который является простым способом монтирования файловых систем eCryptfs, используя любой нижний каталог и верхний каталог.</li>
<li>
<a href="#%D0%A0%D1%83%D1%87%D0%BD%D0%B0%D1%8F_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">#Ручная настройка</a>, которая включает отдельные шаги для загрузки пароля и монтирования eCryptfs, но позволяет полностью контролировать каталоги и настройки шифрования.</li>
</ol>
<h3>
<span id=".D0.98.D0.BD.D1.81.D1.82.D1.80.D1.83.D0.BC.D0.B5.D0.BD.D1.82.D1.8B_Ubuntu"></span><span class="mw-headline" id="Инструменты_Ubuntu">Инструменты Ubuntu</span>
</h3>
<p>Большинство удобных инструментов, устанавливаемых пакетом <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ecryptfs-utils">ecryptfs-utils</a></span>, предполагают очень специфическую настройку eCryptfs, а именно ту, которая официально используется в Ubuntu (где она может быть выбрана в качестве опции при установке). К сожалению, эти варианты не просто заданы по умолчанию, а фактически жёстко закодированы в этих инструментах. Если эта настройка не соответствует вашим потребностям, то вы не сможете использовать удобные инструменты и вам придётся следовать шагам из раздела <a href="#%D0%A0%D1%83%D1%87%D0%BD%D0%B0%D1%8F_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">#Ручная настройка</a>.
</p>
<p>Настройка, используемая этими инструментами, выглядит следующим образом:
</p>
<ul>
<li>у каждого пользователя есть <b>только один зашифрованный каталог</b>, контролируемый этими инструментами:
<ul>
<li>или каталог <code>$HOME</code> полностью,</li>
<li>или один каталог с зашифрованными данными (по умолчанию <code>~/Private/</code>, но это можно изменить).</li>
</ul>
</li>
<li>
<b>нижний каталог</b> всегда <code>~/.Private/</code><br><small>(если шифруется домашний каталог целиком, это будет символическая ссылка на <code>/home/.ecryptfs/<i>пользователь</i>/.Private/</code>)</small>
</li>
<li>используемые <b>параметры шифрования</b>:
<ul>
<li>
<i>cipher:</i> AES</li>
<li>
<i>key length:</i> 16 bytes (128 bits)</li>
<li>
<i>key management scheme:</i> passphrase</li>
<li>
<i>plaintext passthrough:</i> enabled</li>
</ul>
</li>
<li>
<b>настройки</b> зашифрованного каталога хранятся в файлах внутри каталога <code>~/.ecryptfs/</code>:<br><small>(если шифруется домашний каталог целиком, это будет символическая ссылка на <code>/home/.ecryptfs/<i>пользователь</i>/.ecryptfs/</code>)</small>
<ul>
<li>
<code>Private.mnt</code> <i>[текстовый файл]</i> — содержит путь к верхнему каталогу (точке монтирования, например <code>/home/lucy</code> или <code>/home/lucy/Private</code>)</li>
<li>
<code>Private.sig</code> <i>[текстовый файл]</i> — содержит подпись, используемую для идентификации пароля монтирования в списке ключей ядра</li>
<li>
<code>wrapped-passphrase</code> <i>[бинарный файл]</i> — пароль монтирования, зашифрованный паролем пользователя</li>
<li>
<code>auto-mount</code>, <code>auto-umount</code> <i>[пустые файлы]</i> — если они существуют, то модуль <code>pam_ecryptfs.so</code> (если он загружен) будет автоматически монтировать/размонтировать зашифрованный каталог при входе/выходе пользователя</li>
</ul>
</li>
</ul>
<h4>
<span id=".D0.A8.D0.B8.D1.84.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BA.D0.B0.D1.82.D0.B0.D0.BB.D0.BE.D0.B3.D0.B0"></span><span class="mw-headline" id="Шифрование_каталога">Шифрование каталога</span>
</h4>
<p>Для шифрования домашнего каталога смотрите <a href="#%D0%A8%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B3%D0%BE_%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%D0%B0">#Шифрование домашнего каталога</a>.
</p>
<p>Перед настройкой шифрования решите, будет ли он монтироваться вручную или автоматически при входе пользователя в систему.
</p>
<p>Чтобы зашифровать один каталог и позже смонтировать его вручную, выполните:
</p>
<pre>$ ecryptfs-setup-private --nopwcheck --noautomount
</pre>
<p>и следуйте инструкциям. Опция <code>--nopwcheck</code> позволяет выбрать пароль, отличный от пароля входа пользователя, а опция <code>--noautomount</code> отключает автоматическое монтирование. Поэтому, если вы хотите в дальнейшем автоматически монтировать зашифрованный каталог при входе в систему, просто опустите обе опции.
</p>
<p>Скрипт автоматически создаст структуры каталогов <code>~/.Private/</code> и <code>~/.ecryptfs/</code>, как описано выше. Он также запросит два пароля:
</p>
<dl>
<dt>пароль пользователя (login passphrase)</dt>
<dd>Это пароль, который вам нужно будет вводить каждый раз, когда вы захотите смонтировать зашифрованный каталог. Если вы хотите, чтобы работало автоматическое монтирование при входе в систему, это должен быть тот же пароль, который вы используете для входа в свою учётную запись пользователя.</dd>
<dt>пароль монтирования (mount passphrase)</dt>
<dd>Из него генерируется фактический мастер-ключ, который будет использоваться для шифрования. Обычно вам не стоит придумывать здесь какой-то свой пароль; если вы не знаете, что делаете — просто нажмите Enter, чтобы позволить программе автоматически сгенерировать безопасный случайный пароль. Он будет зашифрован с использованием введённого вами пароля пользователя и сохранён в зашифрованном виде в файле <code>~/.ecryptfs/wrapped-passphrase</code>. Позже он будет автоматически расшифровываться («unwrap») в оперативной памяти по необходимости, так что вам никогда не придётся вводить его вручную. Не теряйте этот файл, иначе вы никогда больше не сможете получить доступ к своей зашифрованной папке! Вы можете запустить <code>ecryptfs-unwrap-passphrase</code>, чтобы посмотреть пароль монтирования в открытом виде, записать его на листе бумаги и положить в сейф (или другое надёжное место), чтобы использовать его для восстановления зашифрованных данных в случае случайной потери/повреждения файла <code>wrapped-passphrase</code> или если вы забудете пароль пользователя.</dd>
</dl>
<p>Точка монтирования («верхний каталог») по умолчанию <code>~/Private/</code>, но после настройки можно задать свой каталог с помощью следующих команд:
</p>
<pre>$ mv ~/Private <i>/путь/к/новому/каталогу</i>
$ echo <i>/путь/к/новому/каталогу</i> &gt; ~/.ecryptfs/Private.mnt
</pre>
<p>Для использования зашифрованного каталога его нужно примонтировать — смотрите раздел <a href="#%D0%9C%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">#Монтирование</a> ниже.
</p>
<h4>
<span id=".D0.A8.D0.B8.D1.84.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.B4.D0.BE.D0.BC.D0.B0.D1.88.D0.BD.D0.B5.D0.B3.D0.BE_.D0.BA.D0.B0.D1.82.D0.B0.D0.BB.D0.BE.D0.B3.D0.B0"></span><span class="mw-headline" id="Шифрование_домашнего_каталога">Шифрование домашнего каталога</span>
</h4>
<p>Скрипт-обёртка <code>ecryptfs-migrate-home</code> создаст зашифрованный домашний каталог для пользователя и позаботится о переносе всех существующих файлов из ещё не зашифрованного домашнего каталога.
</p>
<p>Для его запуска пользователь должен выйти из системы и не оставить никаких запущенных от его имени процессов. Лучший способ добиться этого — выйти из системы, войти в консоль как root и проверить, что команда <code>ps -U <i>пользователь</i></code> ничего не выводит. Также убедитесь, что у вас установлены <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=rsync">rsync</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lsof">lsof</a></span> и <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=which">which</a></span>. После того как все необходимые условия выполнены, выполните:
</p>
<pre># modprobe ecryptfs
# ecryptfs-migrate-home -u <i>пользователь</i>
</pre>
<p>и следуйте инструкциям. После завершения работы скрипта следуйте инструкциям по автомонтированию — смотрите раздел <a href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">#Автомонтирование</a> ниже. Пользователь должен обязательно войти в систему <i>перед</i> следующей перезагрузкой, чтобы завершить процесс.
</p>
<p>Когда всё заработает, можно и нужно удалить незашифрованную резервную копию домашнего каталога пользователя, сохранённую в <code>/home/<i>пользователь</i>.<i>случайные_символы</i></code>.
</p>
<h4>
<span id=".D0.9C.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Монтирование">Монтирование</span>
</h4>
<h5>
<span id=".D0.92.D1.80.D1.83.D1.87.D0.BD.D1.83.D1.8E"></span><span class="mw-headline" id="Вручную">Вручную</span>
</h5>
<p>Запустите скрипт-обёртку
</p>
<pre>$ ecryptfs-mount-private
</pre>
<p>И введите пароль пользователя, который вы задали при создании зашифрованного каталога. После этого зашифрованный каталог будет примонтирован в <i>верхний каталог</i> (по умолчанию <code>~/Private/</code>).
</p>
<p>Для размонтирования выполните:
</p>
<pre>$ ecryptfs-umount-private
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Если не требуется постоянный доступ к зашифрованным данным во время сеанса пользователя, можно создать какой-нибудь <a href="../ru/Bash.html#%D0%9F%D1%81%D0%B5%D0%B2%D0%B4%D0%BE%D0%BD%D0%B8%D0%BC%D1%8B" title="Bash (Русский)">псевдоним</a>, чтобы ускорить ручное выполнение команд.</div>
<p>В состав инструментов входит ещё один скрипт, который может быть очень удобен для доступа к зашифрованным данным <code>.Private</code> или домашнему каталогу. Выполнение <code>ecryptfs-recover-private</code> от имени root приведёт к поиску каталога в системе (или по опционально указанному пути), запросу пароля для него и монтированию каталога. Это может, например, использоваться с live-CD или другой системы для доступа к зашифрованным данным в случае восстановления. Обратите внимание, что при загрузке из Arch Linux ISO нужно сперва установить <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ecryptfs-utils">ecryptfs-utils</a></span>. Он может монтировать только каталоги <code>.Private</code>, созданные с помощью инструментов Ubuntu.
</p>
<h5>
<span id=".D0.90.D0.B2.D1.82.D0.BE.D0.BC.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Автомонтирование">Автомонтирование</span>
</h5>
<p>Стандартный способ автомонтирования — через <a href="../ru/Pam_mount.html" title="Pam mount (Русский)">PAM</a>. Смотрите <span class="plainlinks archwiki-template-man" title="$ man 8 pam_ecryptfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pam_ecryptfs.8">pam_ecryptfs(8)</a></span> и — для более подробной информации — 'PAM MODULE' в:
</p>
<pre>/usr/share/doc/ecryptfs-utils/README
</pre>
<p>Для автоматического монтирования необходимо, чтобы пароль для доступа к зашифрованному каталогу совпадал с паролем учётной записи пользователя.
</p>
<p>Ниже описаны шаги по его настройке:
</p>
<p>1. Проверьте, что файлы <code>~/.ecryptfs/auto-mount</code>, <code>~/.ecryptfs/auto-umount</code> и <code>~/.ecryptfs/wrapped-passphrase</code> существуют (их автоматически создаёт <i>ecryptfs-setup-private</i>).
</p>
<p>2. Добавьте <i>ecryptfs</i> в pam-стек в точности как описано ниже, чтобы обеспечить прозрачную дешифровку пароля монтирования при входе в систему:
</p>
<p>Откройте <code>/etc/pam.d/system-auth</code> и <i>после</i> строки, содержащей <code>auth required pam_unix.so</code> (или <code>auth [default=die] pam_faillock.so authfail</code> если есть), добавьте:
</p>
<pre>auth [success=1 default=ignore] pam_succeed_if.so service = systemd-user quiet
auth    required    pam_ecryptfs.so unwrap
</pre>
<p>Далее, <i>перед</i> строкой, содержащей <code>password required pam_unix.so</code> (или <code>-password [success=1 default=ignore] pam_systemd_home.so</code> если есть) добавьте:
</p>
<pre>password    optional    pam_ecryptfs.so
</pre>
<p>И, наконец, <i>после</i> строки <code>session required pam_unix.so</code> добавьте:
</p>
<pre>session [success=1 default=ignore] pam_succeed_if.so service = systemd-user quiet
session    optional    pam_ecryptfs.so unwrap
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Инструкции <code>pam_succeed_if.so</code> говорят процессу <i>пропустить следующую строку</i>, если сервисом, запрашивающим аутентификацию, является <code>systemd-user</code>, который работает параллельно с вашим сеансом и также аутентифицируется через PAM. Если домашний каталог будет смонтирован во второй раз, PAM не сможет его размонтировать. Это является <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=194509">нарушением</a> работы systemd, и есть связанные баги: <a rel="nofollow" class="external autonumber" href="https://bugs.freedesktop.org/show_bug.cgi?id=72759">[2]</a> <a rel="nofollow" class="external autonumber" href="https://nwrickert2.wordpress.com/2013/12/16/systemd-user-manager-ecryptfs-and-opensuse-13-1/">[3]</a><sup title="Статус последней проверки: 410">[<a href="https://en.wikipedia.org/wiki/ru:%D0%92%D0%B8%D0%BA%D0%B8%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F:%D0%9C%D1%91%D1%80%D1%82%D0%B2%D1%8B%D0%B5_%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8" class="extiw" title="wikipedia:ru:Википедия:Мёртвые ссылки">устаревшая ссылка</a> 2023-10-29 ⓘ]</sup> <a rel="nofollow" class="external autonumber" href="https://bugs.launchpad.net/ubuntu/+source/ecryptfs-utils/+bug/313812/comments/43">[4]</a> <a rel="nofollow" class="external autonumber" href="https://lists.alioth.debian.org/pipermail/pkg-systemd-maintainers/2014-October/004088.html">[5]</a>. Метод, описанный здесь, является обходным решением.</div>
<p>3. Перелогиньтесь и с помощью команды <i>mount</i> проверьте, появилась ли новая точка монтирования:
</p>
<pre>/home/<i>пользователь</i>/.Private on /home/<i>пользователь</i>/Private type ecryptfs (...)
</pre>
<p>Каталог <code>~/Private/</code> теперь должен содержать расшифрованные данные.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Вышеуказанные изменения в <code>system-auth</code> включают автомонтирование при обычном входе в систему. Если вы переключаете пользователей вместо этого с помощью <code>su -l</code>, нужно внести аналогичные изменения и в <code>/etc/pam.d/su-l</code>.</div>
<p>Каталог должен автоматически размонтироваться и становиться недоступным, когда пользователь выходит из системы.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Если вы используете <a href="../ru/Systemd/User.html#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_systemd_%D0%BE%D1%82_%D0%B8%D0%BC%D0%B5%D0%BD%D0%B8_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F" title="Systemd (Русский)/User (Русский)">автозапуск systemd от имени пользователя</a> или другие отдельные процессы, которые продолжают работать после вашего выхода из системы, ваш домашний каталог не будет размонтирован до их завершения. Так и задумано, потому что пользовательские процессы всегда должны иметь возможность сохранять своё состояние.</div>
<h3><span class="mw-headline" id="ecryptfs-simple">ecryptfs-simple</span></h3>
<p>Используйте <a rel="nofollow" class="external text" href="https://xyne.dev/projects/ecryptfs-simple/">ecryptfs-simple</a>, если вы просто хотите использовать eCryptfs для монтирования произвольных каталогов подобно <a href="../en/EncFS.html" class="mw-redirect" title="EncFS (Русский)">EncFS</a>. ecryptfs-simple не требует прав root или записей в <code>/etc/fstab</code>, а также не использует жёстко заданные каталоги вроде <code>~/.Private/</code>. Его можно <a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установить">установить</a> с помощью пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ecryptfs-simple/">ecryptfs-simple</a></span><sup><small>AUR</small></sup> или из <a rel="nofollow" class="external text" href="https://xyne.dev/repos/">репозиториев Xyne</a>.
</p>
<p>Как следует из названия, использование простое:
</p>
<p>Простое монтирование:
</p>
<pre>$ ecryptfs-simple /path/to/foo /path/to/bar
</pre>
<p>Автоматическое монтирование: запрашивает опции при первом монтировании каталога и записывает их в файл настроек, а при следующем монтировании считывает опции из ранее записанного файла:
</p>
<pre>$ ecryptfs-simple -a /path/to/foo /path/to/bar
</pre>
<p>Размонтирование по исходному каталогу:
</p>
<pre>$ ecryptfs-simple -u /path/to/foo
</pre>
<p>Размонтирование по точке монтирования:
</p>
<pre>$ ecryptfs-simple -u /path/to/bar
</pre>
<h3>
<span id=".D0.A0.D1.83.D1.87.D0.BD.D0.B0.D1.8F_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0"></span><span class="mw-headline" id="Ручная_настройка">Ручная настройка</span>
</h3>
<p>Ниже приведены инструкции по настройке зашифрованных каталогов eCryptfs вручную. Это включает в себя два этапа. Во-первых, пароль обрабатывается и загружается в список ключей ядра. Во-вторых, файловая система монтируется с использованием ключа из списка ключей.
</p>
<p>Есть два способа добавить пароль в список ключей ядра на первом этапе. Вариант попроще — <code>ecryptfs-add-passphrase</code>, который использует один пароль для шифрования файлов. Недостаток этого способа в том, что вы не сможете изменить пароль после шифрования. Это работает следующим образом:
</p>
<pre>$ ecryptfs-add-passphrase
Passphrase:
Inserted auth tok with sig [78c6f0645fe62da0] into the user session keyring
</pre>
<p>Также можно передать пароль в стандартный ввод команды <code>ecryptfs-add-passphrase -</code>. Помните, что если вы запишете свой пароль в каком-то файле, это, как правило, сделает всё шифрование бессмысленным.
</p>
<p>Вариант посложнее — использовать «wrapped passphrase», когда файлы шифруются с помощью случайно сгенерированного ключа, который в свою очередь зашифрован вашим паролем и хранится в файле. В этом случае вы без проблем можете изменить пароль, просто расшифровав файл ключа старым паролем и зашифровав его новым.
</p>
<p>Приведённый ниже скрипт <a rel="nofollow" class="external text" href="https://stackoverflow.com/a/3980713">запрашивает пароль</a>, генерирует ключ <a rel="nofollow" class="external text" href="https://bazaar.launchpad.net/~ecryptfs/ecryptfs/trunk/view/head:/src/utils/ecryptfs-setup-private#L96">подобно ecryptfs-setup-private</a>, шифрует его введённым вами паролем и записывает в файл <code>~/.ecryptfs/wrapped-passphrase</code>:
</p>
<pre>$ mkdir ~/.ecryptfs
$ ( stty -echo; printf "Passphrase: " 1&gt;&amp;2; read PASSWORD; stty echo; echo 1&gt;&amp;2; head -c 48 /dev/random | base64; echo "$PASSWORD"; ) \
  | ecryptfs-wrap-passphrase ~/.ecryptfs/wrapped-passphrase &gt;/dev/null
</pre>
<p>Пароль должен быть не длиннее 64 символов.
</p>
<p>Теперь можно расшифровать ключ паролем и загрузить его в ядро:
</p>
<pre>$ ( stty -echo; printf "Passphrase: " 1&gt;&amp;2; read PASSWORD; stty echo; echo $PASSWORD; ) | ecryptfs-insert-wrapped-passphrase-into-keyring ~/.ecryptfs/wrapped-passphrase -
Inserted auth tok with sig [7c5d3dd8a1b49db0] into the user session keyring
</pre>
<p>При любом из этих вариантов после успешного добавления ключа вы получите подпись (sig) вида <code>78c6f0645fe62da0</code>, которая пригодится в дальнейшем.
</p>
<p>Существует два способа ручного монтирования eCryptfs, описанных в следующих разделах. Первый способ, с использованием <code>mount.ecryptfs_private</code>, позволяет выполнить монтирование от имени обычного пользователя и предполагает настройку некоторых конфигурационных файлов. Этот способ не позволяет изменять параметры шифрования, например, размер ключа. Второй способ — использовать обычную команду <code>mount</code> напрямую, что даст полный контроль над всеми настройками, но требует либо запуска от имени root, либо добавления записи в <code>/etc/fstab</code>, которая разрешит монтирование обычному пользователю.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Примеры ниже подразумевают использование зашифрованного каталога <code>.secret</code>, что отличается от жёстко закодированного каталога <code>.Private</code> из инструментов Ubuntu. Это сделано специально, чтобы избежать проблем с ошибочным автомонтированием, когда в системе для этого настроен PAM, а также проблем с другими инструментами, использующими жёстко заданные значения по умолчанию.</div>
<h4>
<span id=".D0.A1_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5.D0.BC_.D1.84.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B5.D0.BA"></span><span class="mw-headline" id="С_использованием_файлов_настроек">С использованием файлов настроек</span>
</h4>
<p>Этот метод использует запуск команды <code>mount.ecryptfs_private</code> из пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ecryptfs-utils">ecryptfs-utils</a></span>, после предварительной загрузки пароля. Он не требует прав root.
</p>
<p>Сначала выберите имя для файлов настроек в <code>~/.ecryptfs/</code> и определитесь с нижней и верхней директориями. В данном примере используется имя <code>secret</code> для файлов конфигурации, зашифрованные данные находятся в <code>~/.secret/</code>, а расшифрованные файлы будут доступны в <code>~/secret/</code> после монтирования. Создайте все эти каталоги:
</p>
<pre>$ mkdir ~/.secret ~/secret ~/.ecryptfs
</pre>
<p>Теперь пропишите полные пути к ним в <code>~/.ecryptfs/secret.conf</code>. Формат похож на <code>/etc/fstab</code>, но без опций монтирования:
</p>
<pre>$ echo "$HOME/.secret $HOME/secret ecryptfs" &gt; ~/.ecryptfs/secret.conf
</pre>
<p>Запишите подпись ключа (sig), которую вам выдала команда <code>ecryptfs-add-passphrase</code> или <code>ecryptfs-insert-wrapped-passphrase-into-keyring</code> (смотрите выше), в файл <code>~/.ecryptfs/secret.sig</code>:
</p>
<pre>$ echo 78c6f0645fe62da0 &gt; ~/.ecryptfs/secret.sig
</pre>
<p>Если вы также хотите включить шифрование имён файлов, создайте ещё один пароль (или переиспользуйте предыдущий) и добавьте ещё одну подпись в файл <code>~/.ecryptfs/secret.sig</code>:
</p>
<pre> $ echo 326a6d3e2a5d444a &gt;&gt; ~/.ecryptfs/secret.sig
</pre>
<p>Наконец, примонтируйте <code>~/.secret/</code> в <code>~/secret/</code>:
</p>
<pre>$ mount.ecryptfs_private secret
</pre>
<p>После завершения работы размонтируйте:
</p>
<pre>$ umount.ecryptfs_private secret
</pre>
<h4>
<span id=".D0.A1_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5.D0.BC_.D0.BA.D0.BE.D0.BC.D0.B0.D0.BD.D0.B4.D1.8B_mount"></span><span class="mw-headline" id="С_использованием_команды_mount">С использованием команды mount</span>
</h4>
<p>Запуская команду <code>mount</code> вручную, вы получаете полный контроль над параметрами шифрования. Недостатком является то, что вам нужно либо запускать команду <code>mount</code> от имени root, либо добавить запись в <code>/etc/fstab</code> для каждого каталога eCryptfs, чтобы пользователи могли их монтировать.
</p>
<p>Сначала создайте личные каталоги. В этом примере используются те же каталоги, что и в предыдущем разделе:
</p>
<pre>$ mkdir -m 700 ~/.secret
$ mkdir -m 500 ~/secret
</pre>
<p>Вкратце:
</p>
<ul>
<li>Зашифрованные данные будут храниться в нижнем каталоге <code>~/.secret/</code>
</li>
<li>При монтировании расшифрованные данные станут доступны в каталоге <code>~/secret/</code>
<ul>
<li>Пока каталог не смонтирован, в него ничего нельзя записать</li>
<li>При монтировании он имеет те же права доступа, что и нижний каталог</li>
</ul>
</li>
</ul>
<p>Теперь, предполагая, что вы создали «wrapped passphrase» как описано <a href="#%D0%A0%D1%83%D1%87%D0%BD%D0%B0%D1%8F_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">в разделе выше</a>, вам нужно загрузить ключ шифрования обычного пользователя один раз в список ключей пользователя root:
</p>
<pre># ( stty -echo; printf "Passphrase: " 1&gt;&amp;2; read PASSWORD; stty echo; echo $PASSWORD; ) | ecryptfs-insert-wrapped-passphrase-into-keyring /home/<i>пользователь</i>/.ecryptfs/wrapped-passphrase -
Inserted auth tok with sig [7c5d3dd8a1b49db0] into the user session keyring
</pre>
<p>после чего следующая команда монтирования должна успешно сработать (не забудьте указать правильные подписи ключей):
</p>
<pre># mount <b>-i</b> -t ecryptfs /home/<i>пользователь</i>/.secret /home/<i>пользователь</i>/secret -o ecryptfs_sig=7c5d3dd8a1b49db0,ecryptfs_fnek_sig=7c5d3dd8a1b49db0,ecryptfs_cipher=aes,ecryptfs_key_bytes=32,ecryptfs_unlink_sigs
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> По состоянию на 2022 год эта команда не работает из-за бага в systemd (<a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/55943">FS#55943</a>). <a rel="nofollow" class="external text" href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=870126#10">Обходной путь</a> — выполнить <code>keyctl link @u @s</code> перед монтированием.</div>
<ul>
<li>
<code>ecryptfs_sig</code> — подпись ключа, которым шифруются данные.</li>
<li>
<code>ecryptfs_fnek_sig</code> — подпись ключа, которым шифруются имена файлов; если вам это не нужно, опцию можно опустить.</li>
<li>
<code>ecryptfs_key_bytes</code> может быть 16, 24 или 32 для изменения размера ключа шифрования.</li>
<li>
<code>ecryptfs_unlink_sigs</code> — удаляет ключи из списка ключей ядра при размонтировании, из-за чего вам нужно будет повторно загружать ключи при повторном монтировании.</li>
<li>Также доступны и другие опции; они описаны в документации <code>ecryptfs</code>.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Есть инструмент <code>mount.ecryptfs</code>, который можно запустить от имени root для интерактивного ввода настроек монтирования. После его использования можно глянуть <code>/etc/mtab</code>, чтобы узнать, какие опции использовались.</div>
<p>После того, как вы выбрали подходящие параметры монтирования, вы можете добавить запись в <code>/etc/fstab</code>, чтобы монтировать каталог мог обычный пользователь. Скопируйте параметры монтирования в новую запись <code>/etc/fstab</code> и добавьте параметры <code>user</code> и <code>noauto</code>. Полный текст записи будет выглядеть примерно так (добавления выделены жирным шрифтом):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/home/<i>пользователь</i>/.secret /home/<i>пользователь</i>/secret ecryptfs <b>noauto</b>,<b>user</b>,ecryptfs_sig=7c5d3dd8a1b49db0,ecryptfs_fnek_sig=7c5d3dd8a1b49db0,ecryptfs_cipher=aes,ecryptfs_key_bytes=32,ecryptfs_unlink_sigs <b>0 0</b></pre>
<ul>
<li>Параметр <code>noauto</code> важен, иначе systemd будет пытаться примонтировать зашифрованный каталог автоматически при загрузке системы.</li>
<li>Параметр <code>user</code> разрешает монтирование обычному пользователю без прав root.
<ul><li>Пользовательское монтирование по умолчанию выполняется с опцией <code>noexec</code>. Если вам нужно разрешить запуск исполняемых файлов из зашифрованного каталога, добавьте параметр <code>exec</code> в записи fstab.</li></ul>
</li>
</ul>
<p>Теперь настройка завершена, и каталог должен стать доступен для монтирования обычным пользователем.
</p>
<h5>
<span id=".D0.9C.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_2"></span><span class="mw-headline" id="Монтирование_2">Монтирование</span>
</h5>
<p>Чтобы смонтировать зашифрованный каталог от имени пользователя, нужно предварительно загрузить ключ, расшифровав его вашим паролем. Следуя приведённому выше примеру:
</p>
<pre>$ ecryptfs-insert-wrapped-passphrase-into-keyring ~/.ecryptfs/wrapped-passphrase
Passphrase:
Inserted auth tok with sig [7c5d3dd8a1b49db0] into the user session keyring
</pre>
<p>Теперь каталог может быть смонтирован без лишних вопросов:
</p>
<pre>$ mount <b>-i</b> ~/secret
</pre>
<p>и файлы, помещаемые в каталог <code>secret</code>, будут шифроваться. Эти два шага нужно выполнять каждый раз для ручного монтировния каталога.
</p>
<p>Размонтирование:
</p>
<pre>$ umount ~/secret
</pre>
<p>В завершение можно изменить пароль, которым шифруется ключ шифрования данных:
</p>
<pre>$ ecryptfs-rewrap-passphrase ~/.ecryptfs/wrapped-passphrase
Old wrapping passphrase:
New wrapping passphrase:
New wrapping passphrase (again):
</pre>
<p>Размонтирование должно автоматически очищать список ключей, но вы также можете проверить её состояние и очистить вручную:
</p>
<pre>$ keyctl list @u
$ keyctl clear @u
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Следует помнить, что <code>/etc/fstab</code> предназначен только для общесистемных разделов и обычно не должен использоваться для монтирования пользовательских разделов.</div>
<h5>
<span id=".D0.90.D0.B2.D1.82.D0.BE.D0.BC.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_2"></span><span class="mw-headline" id="Автомонтирование_2">Автомонтирование</span>
</h5>
<p>Для автоматического монтирования ранее определённого монтирования в <code>/etc/fstab</code> при входе в систему можно использовать различные методы. В качестве первого общего шага выполните пункты (1) и (2) раздела <a href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">#Автомонтирование</a>.
</p>
<p>Затем, если вы входите в систему через консоль, простым способом является использование <a href="#%D0%9C%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_2">интерактивных команд</a> <i>mount</i> и <i>umount</i> в настройках оболочки пользователя, например, <a href="../ru/Bash.html#%D0%A4%D0%B0%D0%B9%D0%BB%D1%8B_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B5%D0%BA" title="Bash (Русский)">Bash (Русский)#Файлы настроек</a>.
</p>
<p>Другой метод — автоматическое монтирование каталога eCryptfs при входе пользователя в систему с помощью <a href="../ru/Pam_mount.html" title="Pam mount (Русский)">pam_mount</a>. Для его настройки добавьте следующие строки в файл <code>/etc/security/pam_mount.conf.xml</code>:
</p>
<pre>&lt;luserconf name=".pam_mount.conf.xml" /&gt;
&lt;mntoptions require="" /&gt; 
&lt;lclmount&gt;mount -i %(VOLUME) "%(before=\"-o\" OPTIONS)"&lt;/lclmount&gt; 
</pre>
<p>Перепишите эти строки вручную, а не просто скопируйте/вставьте их (особенно строку lclmount), иначе вы можете получить некоторые поврежденные символы.
Пояснения:
</p>
<ul>
<li>первая строка указывает, где находится пользовательский файл конфигурации (в данном случае <code>~/.pam_mount.conf.xml</code>)</li>
<li>вторая строка очищает ненужные по умолчанию опции монтирования ("nosuid,nodev")</li>
<li>последняя строка указывает, какую команду монтирования нужно запустить (для eCryptfs нужна опция <code>-i</code>).</li>
</ul>
<p>Теперь создайте файл <code>~/.pam_mount.conf.xml</code> с описанием томов для монтирования:
</p>
<pre>&lt;pam_mount&gt;
    &lt;volume noroot="1" fstype="ecryptfs" path="/home/<i>пользователь</i>/.secret/" mountpoint="/home/<i>пользователь</i>/secret/" /&gt;
&lt;/pam_mount&gt;
</pre>
<p>"noroot" нужен, потому что ключ шифрования нужно добавлять в список ключей пользователя.
</p>
<p>Наконец, измените файл <code>/etc/pam.d/system-login</code> как описано в статье <a href="../ru/Pam_mount.html" title="Pam mount (Русский)">pam_mount</a>.
</p>
<h6>
<span id=".D0.94.D0.BE.D0.BF.D0.BE.D0.BB.D0.BD.D0.B8.D1.82.D0.B5.D0.BB.D1.8C.D0.BD.D1.8B.D0.B9_.D1.88.D0.B0.D0.B3"></span><span class="mw-headline" id="Дополнительный_шаг">Дополнительный шаг</span>
</h6>
<p>Чтобы не тратить время на ненужную расшифровку пароля, можно создать скрипт, который будет проверять количество открытых сеансов с помощью <i>pmvarrun</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/local/bin/doecryptfs</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh

exit $(/usr/sbin/pmvarrun -u$PAM_USER -o0)</pre>
<p>Затем добавьте следующую строку перед модулем eCryptfs unwrap в вашем стеке PAM:
</p>
<pre>auth    [success=ignore default=1]    pam_exec.so     quiet /usr/local/bin/doecryptfs
auth    required                      pam_ecryptfs.so unwrap
</pre>
<p>Статья предлагает добавить их в <code>/etc/pam.d/login</code>, но изменения нужно будет добавить во все другие места, где вы входите в систему, например, <code>/etc/pam.d/kde</code>.
</p>
<h2>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Использование">Использование</span>
</h2>
<h3>
<span id=".D0.A1.D1.81.D1.8B.D0.BB.D0.BA.D0.B0_.D0.B2_.D0.B7.D0.B0.D1.88.D0.B8.D1.84.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.BD.D1.8B.D0.B9_.D0.BA.D0.B0.D1.82.D0.B0.D0.BB.D0.BE.D0.B3"></span><span class="mw-headline" id="Ссылка_в_зашифрованный_каталог">Ссылка в зашифрованный каталог</span>
</h3>
<p>Помимо использования зашифрованного каталога в качестве хранилища конфиденциальных файлов и личных данных, его также можно использовать для защиты данных приложений. Например, в <a href="../ru/Firefox.html" title="Firefox (Русский)">Firefox</a> есть внутренний менеджер паролей, но история просмотров и кэш также могут быть конфиденциальными. Защитить их очень просто:
</p>
<pre>$ mv ~/.mozilla ~/Private/mozilla
$ ln -s ~/Private/mozilla ~/.mozilla
</pre>
<h3>
<span id=".D0.A3.D0.B4.D0.B0.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B7.D0.B0.D1.88.D0.B8.D1.84.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.BD.D0.BE.D0.B3.D0.BE_.D0.BA.D0.B0.D1.82.D0.B0.D0.BB.D0.BE.D0.B3.D0.B0"></span><span class="mw-headline" id="Удаление_зашифрованного_каталога">Удаление зашифрованного каталога</span>
</h3>
<p>Для удаления зашифрованного каталога никаких особых действий не требуется. Убедитесь, что он размонтирован, и удалите соответствующий нижний каталог (например, <code>~/.Private/</code>) вместе со всеми зашифрованными файлами внутри него. Затем нужно удалить каталог <code>~/.ecryptfs/</code> с настройками и ключами шифрования, и на этом всё.
</p>
<p>Если вы использовали <a href="#%D0%98%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B_Ubuntu">#Инструменты Ubuntu</a> для настройки, вы можете использовать команду:
</p>
<pre>$ ecryptfs-setup-private --undo
</pre>
<p>и следовать её инструкциям.
</p>
<h3>
<span id=".D0.A0.D0.B5.D0.B7.D0.B5.D1.80.D0.B2.D0.BD.D0.BE.D0.B5_.D0.BA.D0.BE.D0.BF.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Резервное_копирование">Резервное копирование</span>
</h3>
<p>Если вы хотите переместить файл из зашифрованного каталога наружу, просто переместите его как обычно из смонтированного каталога <code>~/Private/</code>.
</p>
<p>В eCryptfs криптографические метаданные хранятся в заголовках файлов. Варианты настройки, описанные в этой статье, отделяют каталог с зашифрованными данными от точки монтирования. Точка монтирования с расшифрованными данными полностью прозрачна и доступна для резервного копирования. Очевидно, что это необходимо учитывать при автоматическом резервном копировании, если нужно избежать утечки конфиденциальных незашифрованных данных в резервную копию.
</p>
<p>Можно делать резервные копии или инкрементные резервные копии непосредственно зашифрованного каталога (например, <code>~/.Private/</code>) так же, как и любого другого обычного каталога.
</p>
<p>Другие моменты, на которые следует обратить внимание:
</p>
<ul>
<li>Если вы выполнили <a href="#%D0%A8%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B4%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B3%D0%BE_%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%D0%B0">#Шифрование домашнего каталога</a> с помощью инструментов Ubuntu, имейте в виду, что нижний каталог с зашифрованными файлами находится вне домашнего каталога обычного пользователя: по адресу <code>/home/.ecryptfs/<i>пользователь</i>/.Private/</code>.</li>
<li>Следует убедиться, что для файлов настройки eCryptfs (обычно <code>~/.ecryptfs/</code>) тоже имеется резервная копия.</li>
<li>Если вы используете специальные опции монтирования файловой системы, например <code>ecryptfs_xattr</code>, проведите дополнительную проверку целостности резервной копии.</li>
</ul>
<h2>
<span id=".D0.98.D0.B7.D0.B2.D0.B5.D1.81.D1.82.D0.BD.D1.8B.D0.B5_.D0.BF.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC.D1.8B"></span><span class="mw-headline" id="Известные_проблемы">Известные проблемы</span>
</h2>
<h3>
<span id=".D0.9F.D1.80.D0.B8_.D0.BF.D0.BE.D0.B4.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B8_.D1.87.D0.B5.D1.80.D0.B5.D0.B7_Mosh_.D0.BC.D0.BE.D0.B6.D0.B5.D1.82_.D0.BF.D1.80.D0.BE.D0.B8.D0.B7.D0.BE.D0.B9.D1.82.D0.B8_.D1.81.D0.B1.D0.BE.D0.B9_.D0.BC.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F_.D0.BD.D0.B0_.D1.83.D0.B4.D0.B0.D0.BB.D1.91.D0.BD.D0.BD.D0.BE.D0.BC_.D1.85.D0.BE.D1.81.D1.82.D0.B5"></span><span class="mw-headline" id="При_подключении_через_Mosh_может_произойти_сбой_монтирования_на_удалённом_хосте">При подключении через Mosh может произойти сбой монтирования на удалённом хосте</span>
</h3>
<p>Это <a rel="nofollow" class="external text" href="https://github.com/mobile-shell/mosh/issues/529">известная проблема</a> сервера <a href="../ru/Mosh.html" title="Mosh (Русский)">Mosh</a>, который не оставляет смонтированным каталог eCryptfs <code>/home</code>.
</p>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://ecryptfs.org/documentation.html">eCryptfs</a> - сайт проекта и документация</li>
<li>
<a rel="nofollow" class="external text" href="https://defuse.ca/audits/ecryptfs.htm">Аудит безопасности</a> eCryptfs, выполненный Тейлором Хорнби (22 января 2014).</li>
<li>
<a rel="nofollow" class="external text" href="https://sysphere.org/~anrxc/j/articles/ecryptfs/index.html">eCryptfs and $HOME</a> by Adrian C. (anrxc) - Article with installation instructions and discussion of eCryptfs usage</li>
<li>
<a rel="nofollow" class="external text" href="https://www.chromium.org/chromium-os/chromiumos-design-docs/protecting-cached-user-data">Chromium data protection</a> (November 2009) - Design document detailing encryption options for Chromium OS, including explanation on its eCryptfs usage</li>
<li>
<a rel="nofollow" class="external text" href="https://ecryptfs.sourceforge.net/ecryptfs.pdf">eCryptfs design</a> by Michael Halcrow (May 2005) - Original design document detailing and discussing eCryptfs</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../ru/Category:Data-at-rest_encryption.html" title="Category:Data-at-rest encryption (Русский)">Data-at-rest encryption (Русский)</a></li>
<li><a href="../ru/Category:Stackable_file_systems.html" title="Category:Stackable file systems (Русский)">Stackable file systems (Русский)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=ECryptfs_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=813019">https://wiki.archlinux.org/index.php?title=ECryptfs_(Русский)&amp;oldid=813019</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 29 July 2024, at 06:11.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
