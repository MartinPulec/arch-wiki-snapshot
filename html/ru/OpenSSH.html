<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>OpenSSH (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-OpenSSH_Русский rootpage-OpenSSH_Русский skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Установка" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Установка</div>
		</a>
		
		<ul id="toc-Установка-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Клиент" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%9A%D0%BB%D0%B8%D0%B5%D0%BD%D1%82">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Клиент</div>
		</a>
		
			<button aria-controls="toc-Клиент-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Клиент subsection</span>
			</button>
		
		<ul id="toc-Клиент-sublist" class="vector-toc-list">
			<li id="toc-Настройка" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Настройка</div>
			</a>
			
			<ul id="toc-Настройка-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Сервер" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A1%D0%B5%D1%80%D0%B2%D0%B5%D1%80">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Сервер</div>
		</a>
		
			<button aria-controls="toc-Сервер-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Сервер subsection</span>
			</button>
		
		<ul id="toc-Сервер-sublist" class="vector-toc-list">
			<li id="toc-Настройка_2" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Настройка</div>
			</a>
			
			<ul id="toc-Настройка_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Управление_демоном" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B4%D0%B5%D0%BC%D0%BE%D0%BD%D0%BE%D0%BC">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Управление демоном</div>
			</a>
			
			<ul id="toc-Управление_демоном-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Безопасность" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%91%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Безопасность</div>
			</a>
			
			<ul id="toc-Безопасность-sublist" class="vector-toc-list">
				<li id="toc-Вход_только_по_открытому_ключу" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%92%D1%85%D0%BE%D0%B4_%D1%82%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE_%D0%BF%D0%BE_%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D0%BE%D0%BC%D1%83_%D0%BA%D0%BB%D1%8E%D1%87%D1%83">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.1</span>Вход только по открытому ключу</div>
			</a>
			
			<ul id="toc-Вход_только_по_открытому_ключу-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Двухфакторная_аутентификация_и_открытые_ключи" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%94%D0%B2%D1%83%D1%85%D1%84%D0%B0%D0%BA%D1%82%D0%BE%D1%80%D0%BD%D0%B0%D1%8F_%D0%B0%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F_%D0%B8_%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D1%8B%D0%B5_%D0%BA%D0%BB%D1%8E%D1%87%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.2</span>Двухфакторная аутентификация и открытые ключи</div>
			</a>
			
			<ul id="toc-Двухфакторная_аутентификация_и_открытые_ключи-sublist" class="vector-toc-list">
				<li id="toc-Программы_аутентификации" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D1%8B_%D0%B0%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.2.1</span>Программы аутентификации</div>
			</a>
			
			<ul id="toc-Программы_аутентификации-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Настройка_PAM" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_PAM">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.2.2</span>Настройка PAM</div>
			</a>
			
			<ul id="toc-Настройка_PAM-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Защита_от_атак_полным_перебором" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%97%D0%B0%D1%89%D0%B8%D1%82%D0%B0_%D0%BE%D1%82_%D0%B0%D1%82%D0%B0%D0%BA_%D0%BF%D0%BE%D0%BB%D0%BD%D1%8B%D0%BC_%D0%BF%D0%B5%D1%80%D0%B5%D0%B1%D0%BE%D1%80%D0%BE%D0%BC">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.3</span>Защита от атак полным перебором</div>
			</a>
			
			<ul id="toc-Защита_от_атак_полным_перебором-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Ограничение_входа_от_имени_суперпользователя" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9E%D0%B3%D1%80%D0%B0%D0%BD%D0%B8%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B2%D1%85%D0%BE%D0%B4%D0%B0_%D0%BE%D1%82_%D0%B8%D0%BC%D0%B5%D0%BD%D0%B8_%D1%81%D1%83%D0%BF%D0%B5%D1%80%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.4</span>Ограничение входа от имени суперпользователя</div>
			</a>
			
			<ul id="toc-Ограничение_входа_от_имени_суперпользователя-sublist" class="vector-toc-list">
				<li id="toc-Отключение" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#%D0%9E%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.4.1</span>Отключение</div>
			</a>
			
			<ul id="toc-Отключение-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Ограничение" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#%D0%9E%D0%B3%D1%80%D0%B0%D0%BD%D0%B8%D1%87%D0%B5%D0%BD%D0%B8%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.4.2</span>Ограничение</div>
			</a>
			
			<ul id="toc-Ограничение-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Защита_файла_authorized_keys" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%97%D0%B0%D1%89%D0%B8%D1%82%D0%B0_%D1%84%D0%B0%D0%B9%D0%BB%D0%B0_authorized_keys">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.5</span>Защита файла authorized_keys</div>
			</a>
			
			<ul id="toc-Защита_файла_authorized_keys-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Советы_и_рекомендации" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A1%D0%BE%D0%B2%D0%B5%D1%82%D1%8B_%D0%B8_%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D0%B0%D1%86%D0%B8%D0%B8">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Советы и рекомендации</div>
		</a>
		
			<button aria-controls="toc-Советы_и_рекомендации-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Советы и рекомендации subsection</span>
			</button>
		
		<ul id="toc-Советы_и_рекомендации-sublist" class="vector-toc-list">
			<li id="toc-Шифрованный_туннель_SOCKS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A8%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B9_%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D1%8C_SOCKS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Шифрованный туннель SOCKS</div>
			</a>
			
			<ul id="toc-Шифрованный_туннель_SOCKS-sublist" class="vector-toc-list">
				<li id="toc-Шаг_1:_установить_соединение" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A8%D0%B0%D0%B3_1:_%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D1%8C_%D1%81%D0%BE%D0%B5%D0%B4%D0%B8%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.1</span>Шаг 1: установить соединение</div>
			</a>
			
			<ul id="toc-Шаг_1:_установить_соединение-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Шаг_2_(вариант_А):_настроить_браузер_(или_другие_программы)" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A8%D0%B0%D0%B3_2_(%D0%B2%D0%B0%D1%80%D0%B8%D0%B0%D0%BD%D1%82_%D0%90):_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B8%D1%82%D1%8C_%D0%B1%D1%80%D0%B0%D1%83%D0%B7%D0%B5%D1%80_(%D0%B8%D0%BB%D0%B8_%D0%B4%D1%80%D1%83%D0%B3%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D1%8B)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.2</span>Шаг 2 (вариант А): настроить браузер (или другие программы)</div>
			</a>
			
			<ul id="toc-Шаг_2_(вариант_А):_настроить_браузер_(или_другие_программы)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Шаг_2_(вариант_Б):_настроить_TUN-интерфейс" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A8%D0%B0%D0%B3_2_(%D0%B2%D0%B0%D1%80%D0%B8%D0%B0%D0%BD%D1%82_%D0%91):_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B8%D1%82%D1%8C_TUN-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.3</span>Шаг 2 (вариант Б): настроить TUN-интерфейс</div>
			</a>
			
			<ul id="toc-Шаг_2_(вариант_Б):_настроить_TUN-интерфейс-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Проброс_X11" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B1%D1%80%D0%BE%D1%81_X11">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Проброс X11</div>
			</a>
			
			<ul id="toc-Проброс_X11-sublist" class="vector-toc-list">
				<li id="toc-Настройка_3" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_3">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.1</span>Настройка</div>
			</a>
			
			<ul id="toc-Настройка_3-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Использование" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.2</span>Использование</div>
			</a>
			
			<ul id="toc-Использование-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Проброс_других_портов" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B1%D1%80%D0%BE%D1%81_%D0%B4%D1%80%D1%83%D0%B3%D0%B8%D1%85_%D0%BF%D0%BE%D1%80%D1%82%D0%BE%D0%B2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Проброс других портов</div>
			</a>
			
			<ul id="toc-Проброс_других_портов-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Jump-хост" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Jump-%D1%85%D0%BE%D1%81%D1%82">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>Jump-хост</div>
			</a>
			
			<ul id="toc-Jump-хост-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Обратный_SSH_через_промежуточный_узел" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9E%D0%B1%D1%80%D0%B0%D1%82%D0%BD%D1%8B%D0%B9_SSH_%D1%87%D0%B5%D1%80%D0%B5%D0%B7_%D0%BF%D1%80%D0%BE%D0%BC%D0%B5%D0%B6%D1%83%D1%82%D0%BE%D1%87%D0%BD%D1%8B%D0%B9_%D1%83%D0%B7%D0%B5%D0%BB">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.5</span>Обратный SSH через промежуточный узел</div>
			</a>
			
			<ul id="toc-Обратный_SSH_через_промежуточный_узел-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Мультиплексирование" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9C%D1%83%D0%BB%D1%8C%D1%82%D0%B8%D0%BF%D0%BB%D0%B5%D0%BA%D1%81%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.6</span>Мультиплексирование</div>
			</a>
			
			<ul id="toc-Мультиплексирование-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Увеличение_скорости_SSH" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A3%D0%B2%D0%B5%D0%BB%D0%B8%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D1%81%D0%BA%D0%BE%D1%80%D0%BE%D1%81%D1%82%D0%B8_SSH">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.7</span>Увеличение скорости SSH</div>
			</a>
			
			<ul id="toc-Увеличение_скорости_SSH-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Монтирование_удалённых_файловых_систем_при_помощи_SSHFS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9C%D0%BE%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%83%D0%B4%D0%B0%D0%BB%D1%91%D0%BD%D0%BD%D1%8B%D1%85_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D1%8B%D1%85_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC_%D0%BF%D1%80%D0%B8_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D0%B8_SSHFS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.8</span>Монтирование удалённых файловых систем при помощи SSHFS</div>
			</a>
			
			<ul id="toc-Монтирование_удалённых_файловых_систем_при_помощи_SSHFS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Поддержание_подключения" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.9</span>Поддержание подключения</div>
			</a>
			
			<ul id="toc-Поддержание_подключения-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Автоматический_перезапуск_туннелей_SSH_с_помощью_systemd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%BF%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B5%D0%B9_SSH_%D1%81_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_systemd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.10</span>Автоматический перезапуск туннелей SSH с помощью systemd</div>
			</a>
			
			<ul id="toc-Автоматический_перезапуск_туннелей_SSH_с_помощью_systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Autossh_-_автоматический_перезапуск_сессий_и_туннелей_SSH" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Autossh_-_%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%BF%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_%D1%81%D0%B5%D1%81%D1%81%D0%B8%D0%B9_%D0%B8_%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B5%D0%B9_SSH">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.11</span>Autossh - автоматический перезапуск сессий и туннелей SSH</div>
			</a>
			
			<ul id="toc-Autossh_-_автоматический_перезапуск_сессий_и_туннелей_SSH-sublist" class="vector-toc-list">
				<li id="toc-Автозапуск_Autossh_при_загрузке_системы_при_помощи_systemd" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%90%D0%B2%D1%82%D0%BE%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_Autossh_%D0%BF%D1%80%D0%B8_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B_%D0%BF%D1%80%D0%B8_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D0%B8_systemd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.11.1</span>Автозапуск Autossh при загрузке системы при помощи systemd</div>
			</a>
			
			<ul id="toc-Автозапуск_Autossh_при_загрузке_системы_при_помощи_systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Альтернатива_на_случай_невозможности_запустить_демон_SSH" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%90%D0%BB%D1%8C%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%82%D0%B8%D0%B2%D0%B0_%D0%BD%D0%B0_%D1%81%D0%BB%D1%83%D1%87%D0%B0%D0%B9_%D0%BD%D0%B5%D0%B2%D0%BE%D0%B7%D0%BC%D0%BE%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D0%B8_%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D1%82%D0%B8%D1%82%D1%8C_%D0%B4%D0%B5%D0%BC%D0%BE%D0%BD_SSH">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.12</span>Альтернатива на случай невозможности запустить демон SSH</div>
			</a>
			
			<ul id="toc-Альтернатива_на_случай_невозможности_запустить_демон_SSH-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Настройка_цвета_фона_терминала_для_удалённого_хоста" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D1%86%D0%B2%D0%B5%D1%82%D0%B0_%D1%84%D0%BE%D0%BD%D0%B0_%D1%82%D0%B5%D1%80%D0%BC%D0%B8%D0%BD%D0%B0%D0%BB%D0%B0_%D0%B4%D0%BB%D1%8F_%D1%83%D0%B4%D0%B0%D0%BB%D1%91%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE_%D1%85%D0%BE%D1%81%D1%82%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.13</span>Настройка цвета фона терминала для удалённого хоста</div>
			</a>
			
			<ul id="toc-Настройка_цвета_фона_терминала_для_удалённого_хоста-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Настройка_для_работы_в_конкретной_сети" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%B4%D0%BB%D1%8F_%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B_%D0%B2_%D0%BA%D0%BE%D0%BD%D0%BA%D1%80%D0%B5%D1%82%D0%BD%D0%BE%D0%B9_%D1%81%D0%B5%D1%82%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.14</span>Настройка для работы в конкретной сети</div>
			</a>
			
			<ul id="toc-Настройка_для_работы_в_конкретной_сети-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Проверка_ключей_хостов_в_локальных_сетях" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9_%D1%85%D0%BE%D1%81%D1%82%D0%BE%D0%B2_%D0%B2_%D0%BB%D0%BE%D0%BA%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D1%85_%D1%81%D0%B5%D1%82%D1%8F%D1%85">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.15</span>Проверка ключей хостов в локальных сетях</div>
			</a>
			
			<ul id="toc-Проверка_ключей_хостов_в_локальных_сетях-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Выполнение_команд_во_время_входа" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%92%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4_%D0%B2%D0%BE_%D0%B2%D1%80%D0%B5%D0%BC%D1%8F_%D0%B2%D1%85%D0%BE%D0%B4%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.16</span>Выполнение команд во время входа</div>
			</a>
			
			<ul id="toc-Выполнение_команд_во_время_входа-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Проброс_SSH-агента" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B1%D1%80%D0%BE%D1%81_SSH-%D0%B0%D0%B3%D0%B5%D0%BD%D1%82%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.17</span>Проброс SSH-агента</div>
			</a>
			
			<ul id="toc-Проброс_SSH-агента-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Решение_проблем" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A0%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Решение проблем</div>
		</a>
		
			<button aria-controls="toc-Решение_проблем-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Решение проблем subsection</span>
			</button>
		
		<ul id="toc-Решение_проблем-sublist" class="vector-toc-list">
			<li id="toc-Проверка" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Проверка</div>
			</a>
			
			<ul id="toc-Проверка-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Подключение_отклонено_или_проблема_тайм-аута" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BE%D1%82%D0%BA%D0%BB%D0%BE%D0%BD%D0%B5%D0%BD%D0%BE_%D0%B8%D0%BB%D0%B8_%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D0%B0_%D1%82%D0%B0%D0%B9%D0%BC-%D0%B0%D1%83%D1%82%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Подключение отклонено или проблема тайм-аута</div>
			</a>
			
			<ul id="toc-Подключение_отклонено_или_проблема_тайм-аута-sublist" class="vector-toc-list">
				<li id="toc-Проброс_портов" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B1%D1%80%D0%BE%D1%81_%D0%BF%D0%BE%D1%80%D1%82%D0%BE%D0%B2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.1</span>Проброс портов</div>
			</a>
			
			<ul id="toc-Проброс_портов-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-SSH_запущен_и_прослушивает?" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#SSH_%D0%B7%D0%B0%D0%BF%D1%83%D1%89%D0%B5%D0%BD_%D0%B8_%D0%BF%D1%80%D0%BE%D1%81%D0%BB%D1%83%D1%88%D0%B8%D0%B2%D0%B0%D0%B5%D1%82?">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.2</span>SSH запущен и прослушивает?</div>
			</a>
			
			<ul id="toc-SSH_запущен_и_прослушивает?-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Имеются_ли_правила_фаервола,_блокирующие_соединения?" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%98%D0%BC%D0%B5%D1%8E%D1%82%D1%81%D1%8F_%D0%BB%D0%B8_%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB%D0%B0_%D1%84%D0%B0%D0%B5%D1%80%D0%B2%D0%BE%D0%BB%D0%B0,_%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D1%83%D1%8E%D1%89%D0%B8%D0%B5_%D1%81%D0%BE%D0%B5%D0%B4%D0%B8%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F?">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.3</span>Имеются ли правила фаервола, блокирующие соединения?</div>
			</a>
			
			<ul id="toc-Имеются_ли_правила_фаервола,_блокирующие_соединения?-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Трафик_доходит_до_вашего_компьютера?" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A2%D1%80%D0%B0%D1%84%D0%B8%D0%BA_%D0%B4%D0%BE%D1%85%D0%BE%D0%B4%D0%B8%D1%82_%D0%B4%D0%BE_%D0%B2%D0%B0%D1%88%D0%B5%D0%B3%D0%BE_%D0%BA%D0%BE%D0%BC%D0%BF%D1%8C%D1%8E%D1%82%D0%B5%D1%80%D0%B0?">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.4</span>Трафик доходит до вашего компьютера?</div>
			</a>
			
			<ul id="toc-Трафик_доходит_до_вашего_компьютера?-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Ваш_провайдер_или_кто-то_еще_блокирует_нужный_порт?" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%92%D0%B0%D1%88_%D0%BF%D1%80%D0%BE%D0%B2%D0%B0%D0%B9%D0%B4%D0%B5%D1%80_%D0%B8%D0%BB%D0%B8_%D0%BA%D1%82%D0%BE-%D1%82%D0%BE_%D0%B5%D1%89%D0%B5_%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D1%83%D0%B5%D1%82_%D0%BD%D1%83%D0%B6%D0%BD%D1%8B%D0%B9_%D0%BF%D0%BE%D1%80%D1%82?">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.5</span>Ваш провайдер или кто-то еще блокирует нужный порт?</div>
			</a>
			
			<ul id="toc-Ваш_провайдер_или_кто-то_еще_блокирует_нужный_порт?-sublist" class="vector-toc-list">
				<li id="toc-Диагностика" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#%D0%94%D0%B8%D0%B0%D0%B3%D0%BD%D0%BE%D1%81%D1%82%D0%B8%D0%BA%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.5.1</span>Диагностика</div>
			</a>
			
			<ul id="toc-Диагностика-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Возможное_решение" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#%D0%92%D0%BE%D0%B7%D0%BC%D0%BE%D0%B6%D0%BD%D0%BE%D0%B5_%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.5.2</span>Возможное решение</div>
			</a>
			
			<ul id="toc-Возможное_решение-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Read_from_socket_failed:_connection_reset_by_peer" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Read_from_socket_failed:_connection_reset_by_peer">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.6</span>Read from socket failed: connection reset by peer</div>
			</a>
			
			<ul id="toc-Read_from_socket_failed:_connection_reset_by_peer-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id='toc-"[ваша_командная_оболочка]:_No_such_file_or_directory"_/_ssh_exchange_identification_problem' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#"[%D0%B2%D0%B0%D1%88%D0%B0_%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4%D0%BD%D0%B0%D1%8F_%D0%BE%D0%B1%D0%BE%D0%BB%D0%BE%D1%87%D0%BA%D0%B0]:_No_such_file_or_directory"_/_ssh_exchange_identification_problem'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>"[ваша командная оболочка]: No such file or directory" / ssh_exchange_identification problem</div>
			</a>
			
			<ul id='toc-"[ваша_командная_оболочка]:_No_such_file_or_directory"_/_ssh_exchange_identification_problem-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-Ошибки_"Terminal_unknown"_и_"Error_opening_terminal"' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#%D0%9E%D1%88%D0%B8%D0%B1%D0%BA%D0%B8_"Terminal_unknown"_%D0%B8_"Error_opening_terminal"'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>Ошибки "Terminal unknown" и "Error opening terminal"</div>
			</a>
			
			<ul id='toc-Ошибки_"Terminal_unknown"_и_"Error_opening_terminal"-sublist' class="vector-toc-list">
				<li id="toc-Хак_$TERM" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A5%D0%B0%D0%BA_$TERM">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4.1</span>Хак $TERM</div>
			</a>
			
			<ul id="toc-Хак_$TERM-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Ошибка_Connection_closed_by_x.x.x.x_[preauth]" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9E%D1%88%D0%B8%D0%B1%D0%BA%D0%B0_Connection_closed_by_x.x.x.x_[preauth]">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5</span>Ошибка Connection closed by x.x.x.x [preauth]</div>
			</a>
			
			<ul id="toc-Ошибка_Connection_closed_by_x.x.x.x_[preauth]-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-id_dsa_не_используется_в_OpenSSH_7.0" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#id_dsa_%D0%BD%D0%B5_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D0%B5%D1%82%D1%81%D1%8F_%D0%B2_OpenSSH_7.0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.6</span>id_dsa не используется в OpenSSH 7.0</div>
			</a>
			
			<ul id="toc-id_dsa_не_используется_в_OpenSSH_7.0-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Не_удаётся_подобрать_способ_обмена_ключами_в_OpenSSH_7.0" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B5_%D1%83%D0%B4%D0%B0%D1%91%D1%82%D1%81%D1%8F_%D0%BF%D0%BE%D0%B4%D0%BE%D0%B1%D1%80%D0%B0%D1%82%D1%8C_%D1%81%D0%BF%D0%BE%D1%81%D0%BE%D0%B1_%D0%BE%D0%B1%D0%BC%D0%B5%D0%BD%D0%B0_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0%D0%BC%D0%B8_%D0%B2_OpenSSH_7.0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.7</span>Не удаётся подобрать способ обмена ключами в OpenSSH 7.0</div>
			</a>
			
			<ul id="toc-Не_удаётся_подобрать_способ_обмена_ключами_в_OpenSSH_7.0-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Сеанс_tmux/screen_прерывается_при_разрыве_соединения_SSH" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%B5%D0%B0%D0%BD%D1%81_tmux/screen_%D0%BF%D1%80%D0%B5%D1%80%D1%8B%D0%B2%D0%B0%D0%B5%D1%82%D1%81%D1%8F_%D0%BF%D1%80%D0%B8_%D1%80%D0%B0%D0%B7%D1%80%D1%8B%D0%B2%D0%B5_%D1%81%D0%BE%D0%B5%D0%B4%D0%B8%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F_SSH">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.8</span>Сеанс tmux/screen прерывается при разрыве соединения SSH</div>
			</a>
			
			<ul id="toc-Сеанс_tmux/screen_прерывается_при_разрыве_соединения_SSH-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Сеанс_SSH_не_отвечает" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%B5%D0%B0%D0%BD%D1%81_SSH_%D0%BD%D0%B5_%D0%BE%D1%82%D0%B2%D0%B5%D1%87%D0%B0%D0%B5%D1%82">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.9</span>Сеанс SSH не отвечает</div>
			</a>
			
			<ul id="toc-Сеанс_SSH_не_отвечает-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Broken_pipe" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Broken_pipe">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.10</span>Broken pipe</div>
			</a>
			
			<ul id="toc-Broken_pipe-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Демон_медленно_запускается_после_перезагрузки" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%94%D0%B5%D0%BC%D0%BE%D0%BD_%D0%BC%D0%B5%D0%B4%D0%BB%D0%B5%D0%BD%D0%BD%D0%BE_%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA%D0%B0%D0%B5%D1%82%D1%81%D1%8F_%D0%BF%D0%BE%D1%81%D0%BB%D0%B5_%D0%BF%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.11</span>Демон медленно запускается после перезагрузки</div>
			</a>
			
			<ul id="toc-Демон_медленно_запускается_после_перезагрузки-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Завершение_неотвечающего_SSH-соединения" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%97%D0%B0%D0%B2%D0%B5%D1%80%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BD%D0%B5%D0%BE%D1%82%D0%B2%D0%B5%D1%87%D0%B0%D1%8E%D1%89%D0%B5%D0%B3%D0%BE_SSH-%D1%81%D0%BE%D0%B5%D0%B4%D0%B8%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.12</span>Завершение неотвечающего SSH-соединения</div>
			</a>
			
			<ul id="toc-Завершение_неотвечающего_SSH-соединения-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-WARNING:_REMOTE_HOST_IDENTIFICATION_HAS_CHANGED!" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#WARNING:_REMOTE_HOST_IDENTIFICATION_HAS_CHANGED!">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.13</span>WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!</div>
			</a>
			
			<ul id="toc-WARNING:_REMOTE_HOST_IDENTIFICATION_HAS_CHANGED!-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Смотрите_также" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Смотрите также</div>
		</a>
		
		<ul id="toc-Смотрите_также-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">OpenSSH (Русский)</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 7 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-7" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">7 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-de mw-list-item"><a href="https://wiki.archlinux.de/title/SSH" title="SSH – Deutsch" lang="de" hreflang="de" class="interlanguage-link-target"><span>Deutsch</span></a></li>
<li class="interlanguage-link interwiki-en mw-list-item"><a href="../en/OpenSSH.html" title="OpenSSH – English" lang="en" hreflang="en" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/OpenSSH.html" title="OpenSSH – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-fr mw-list-item"><a href="../fr/OpenSSH.html" title="OpenSSH – français" lang="fr" hreflang="fr" class="interlanguage-link-target"><span>Français</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/OpenSSH" title="OpenSSH – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/Secure_Shell.html" title="Secure Shell – português" lang="pt" hreflang="pt" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/OpenSSH" title="OpenSSH – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="ru" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Ссылки по теме</p>
<ul>
<li><a href="../en/SSH_keys.html" class="mw-redirect" title="Ключи SSH">Ключи SSH</a></li>
<li><a href="../en/Pam_abl.html" title="Pam abl">Pam abl</a></li>
<li><a href="../ru/Fail2ban.html" title="Fail2ban (Русский)">fail2ban (Русский)</a></li>
<li><a href="../en/Sshguard.html" title="Sshguard">sshguard</a></li>
<li><a href="../ru/SSHFS.html" title="SSHFS (Русский)">SSHFS (Русский)</a></li>
<li><a href="../en/Syslog-ng.html" title="Syslog-ng">Syslog-ng</a></li>
<li><a href="../en/SFTP_chroot.html" title="SFTP chroot">SFTP chroot</a></li>
<li><a href="../en/SCP_and_SFTP.html" title="SCP and SFTP">SCP and SFTP</a></li>
<li><a href="../en/VPN_over_SSH.html" title="VPN over SSH">VPN over SSH</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/OpenSSH.html" title="OpenSSH">OpenSSH</a>. Дата последней синхронизации: 11 июля 2021. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=OpenSSH&amp;diff=0&amp;oldid=684344">изменения</a>.</div>
<p><a href="https://en.wikipedia.org/wiki/ru:OpenSSH" class="extiw" title="wikipedia:ru:OpenSSH">OpenSSH</a> (OpenBSD Secure Shell) — набор программ, предоставляющих шифрование сеансов связи в компьютерных сетях по протоколу SSH (<a href="../en/Secure_Shell.html" title="Secure Shell">Secure Shell</a>). OpenSSH разработан в рамках возглавляемого Тео де Раадтом (Theo de Raadt) проекта <a href="https://en.wikipedia.org/wiki/ru:OpenBSD" class="extiw" title="wikipedia:ru:OpenBSD">OpenBSD</a> как открытая альтернатива проприетарному Secure Shell компании SSH Communications Security.
</p>
<p>OpenSSH иногда путают с <a href="https://en.wikipedia.org/wiki/ru:OpenSSL" class="extiw" title="wikipedia:ru:OpenSSL">OpenSSL</a>; они разрабатываются разными командами и имеют различное назначение. Определённая схожесть в названиях возникла из-за приверженности обоих проектов принципам открытого программного обеспечения (open software).
</p>
<meta property="mw:PageProp/toc">
<h2>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0"></span><span class="mw-headline" id="Установка">Установка</span>
</h2>
<p><a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">Установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span>.
</p>
<h2>
<span id=".D0.9A.D0.BB.D0.B8.D0.B5.D0.BD.D1.82"></span><span class="mw-headline" id="Клиент">Клиент</span>
</h2>
<p>Чтобы установить соединение с сервером, выполните:
</p>
<pre>$ ssh -p <i>порт</i> <i>пользователь</i>@<i>адрес-сервера</i>
</pre>
<p>Если на сервере разрешена аутентификация только по открытому ключу, см. <a href="../en/SSH_keys.html" class="mw-redirect" title="Ключи SSH">Ключи SSH</a>.
</p>
<h3>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0"></span><span class="mw-headline" id="Настройка">Настройка</span>
</h3>
<p>Настройки клиента делятся на две категории: общие для всех исходящих соединений и относящиеся к соединениям только с определёнными хостами. Например:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.ssh/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># глобальные настройки
User <i>пользователь</i>

# настройки отдельного хоста
Host <i>мой-сервер</i>
    HostName <i>адрес-сервера</i>
    Port     <i>порт</i>
</pre>
<p>С такими настройками следующие команды будут иметь одинаковый эффект:
</p>
<pre>$ ssh -p <i>порт</i> <i>пользователь</i>@<i>адрес-сервера</i>
$ ssh <i>мой-сервер</i>
</pre>
<p>Подробнее см. руководство <span class="plainlinks archwiki-template-man" title="$ man 5 ssh_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh_config.5">ssh_config(5)</a></span>.
</p>
<p>Некоторые настройки не имеют флагов-аналогов для командной строки, но можно указать необходимые опции с помощью флага <code>-o</code>. Например, <code>-oKexAlgorithms=+diffie-hellman-group1-sha1</code>.
</p>
<h2>
<span id=".D0.A1.D0.B5.D1.80.D0.B2.D0.B5.D1.80"></span><span class="mw-headline" id="Сервер">Сервер</span>
</h2>
<p><code>sshd</code> — демон сервера OpenSSH, который управляется службой <code>sshd.service</code> в соответствии с настройками в файле <code>/etc/ssh/sshd_config</code>. Если вы собираетесь изменить настройки, то стоит сначала запустить <code>sshd</code> в тестовом режиме, чтобы убедиться, что демон запустится без проблем. Отсутствие вывода означает рабочую конфигурацию.
</p>
<pre># sshd -t
</pre>
<h3>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_2"></span><span class="mw-headline" id="Настройка_2">Настройка</span>
</h3>
<p>Чтобы изменить настройки, нужно отредактировать/добавить нужные строки в файле настроек, например:
</p>
<p>Предоставить доступ отдельным пользователям:
</p>
<pre>AllowUsers    <i>пользователь1 пользователь2</i>
</pre>
<p>Предоставить доступ группам пользователей:
</p>
<pre>AllowGroups   <i>группа1 группа2</i>
</pre>
<p>Параметр <code>Banner</code> позволяет настроить приветственное сообщение (например, сохранённое в файле <code>/etc/issue</code>):
</p>
<pre>Banner /etc/issue
</pre>
<p>Пары открытых и закрытых ключей генерируются <a href="#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B4%D0%B5%D0%BC%D0%BE%D0%BD%D0%BE%D0%BC">службой</a> <i>sshdgenkeys</i> и сохраняются в файле <code>/etc/ssh</code>. Если какие-то ключи отсустствуют, то они создаются заново, даже если опция <code>HostKeyAlgorithms</code> в файле <code>sshd_config</code> разрешает не все алгоритмы шифрования. Всего создаётся четыре пары ключей на основе алгоритмов <a href="../en/SSH_keys.html#Choosing_the_authentication_key_type" title="SSH keys">dsa, rsa, ecdsa и ed25519</a>. Чтобы sshd мог использовать конкретный ключ, укажите следующую опцию:
</p>
<pre>HostKey /etc/ssh/ssh_host_rsa_key
</pre>
<p>Если сервер находится в глобальной (WAN) сети, рекомендуется также сменить порт со стандартного 22 на случайное значение, например:
</p>
<pre>Port 39901
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> 
<ul>
<li>Альтернативный порт лучше выбирать из числа не занятых другими службами. Инфомацию о портах можно найти в файле <code>/etc/services</code>, а также в статье <a href="https://en.wikipedia.org/wiki/ru:%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BF%D0%BE%D1%80%D1%82%D0%BE%D0%B2_TCP_%D0%B8_UDP" class="extiw" title="wikipedia:ru:Список портов TCP и UDP">Список портов TCP и UDP</a>. Смена порта снизит количество попыток входа, выполняемых автоматизированными сканерами и скриптами, которые обычно ожидают SSH-соединение на порте 22. Чтобы полностью исключить такие попытки, можно настроить <a href="../en/Port_knocking.html" title="Port knocking">port knocking</a>.</li>
<li>В целях безопасности рекомендуется полностью <a href="#%D0%92%D1%85%D0%BE%D0%B4_%D1%82%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE_%D0%BF%D0%BE_%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D0%BE%D0%BC%D1%83_%D0%BA%D0%BB%D1%8E%D1%87%D1%83">отключить вход по паролю</a>. Другие полезные способы повышения защищённости SSH-соединения описаны в разделе <a href="#%D0%91%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C">#Безопасность</a>.</li>
<li>OpenSSH может прослушивать несколько портов одновременно. Для этого укажите несколько параметров <code>Port <i>номер-порта</i></code> в файле настроек.</li>
<li>Можно сгенерировать новые пары ключей в дополнение (или взамен) к тем, которые были созданы изначально. Удалите ненужные пары ключей из файлов в каталоге <code>/etc/ssh</code>, после чего выполните команду <code>ssh-keygen -A</code> с правами root.</li>
</ul>
</div>
<h3>
<span id=".D0.A3.D0.BF.D1.80.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B4.D0.B5.D0.BC.D0.BE.D0.BD.D0.BE.D0.BC"></span><span class="mw-headline" id="Управление_демоном">Управление демоном</span>
</h3>
<p><a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Запустите/включите">Запустите/включите</a> службу <code>sshd.service</code>. Демон SSH будет работать в фоновом режиме и выполнять форк (fork) для каждого входящего соединения <a rel="nofollow" class="external autonumber" href="https://github.com/archlinux/svntogit-packages/blob/packages/openssh/trunk/sshd.service">[1]</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> <code>sshd.socket</code> был удалён из <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span> в версии 8.0p1-3. Он использовал активацию сокета systemd, вследствие чего оказался уязвим к DoS-атакам (см. <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/62248">FS#62248</a>). Если <code>sshd.socket</code> будет включён во время обновления до <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span> 8.0p1-3, то юниты <code>sshd.socket</code> и <code>sshd@.service</code> будут скопированы в каталог <code>/etc/systed/system</code> и <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Включите заново">включены заново</a>. Это сделано с единственной целью — не поломать существующие конфигурации, в остальном же рекомендуется перейти на использование <code>sshd.service</code>.
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Если вы продолжаете использовать <code>sshd.socket</code>, обратите внимание на следующие моменты:
<ul>
<li>Юнит <code>sshd.socket</code> может внезапно прекратить работу (например, из-за исчерпания свободной памяти), а опцию <code>Restart=always</code> для юнитов сокетов задать нельзя <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/11553">[2]</a>.</li>
<li>Использовании активации сокета может привести к отказу в обслуживании (denial of service), если слишком большое количество соединений приведёт к невозможности новых запусков службы (см. <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/62248">FS#62248</a>).</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Для <code>sshd.socket</code> нельзя задать параметр <code>ListenAddress</code>, поэтому будут разрешены соединения с любых адресов. Для создания аналогичной <code>ListenAddress</code> настройки <a href="../ru/Systemd.html#%D0%A0%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Отредактируйте">отредактируйте</a> файл <code>sshd.socket</code>, указав порт и IP-адрес в параметре <code>ListenStream</code> (например, <code>ListenStream=192.168.1.100:22</code>). Также нужно добавить параметр <code>FreeBind=true</code> в раздел <code>[Socket]</code>, иначе проявится та же проблема, что и при задании <code>ListenAddress</code>: если сеть не успела вовремя включиться, сокет не запустится.
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> При использовании активации сокета для каждого соединения создаётся временный экземпляр <code>sshd@.service</code> (каждый со своим названием). Следовательно, ни <code>sshd.socket</code>, ни обычный <code>sshd.service</code> не будут логировать попытки установления соединения. Логи экземпляров сокетов можно просматривать командами <code>journalctl -u "sshd@*"</code> и <code>journalctl /usr/bin/sshd</code> с правами root.
</div>
<h3>
<span id=".D0.91.D0.B5.D0.B7.D0.BE.D0.BF.D0.B0.D1.81.D0.BD.D0.BE.D1.81.D1.82.D1.8C"></span><span class="mw-headline" id="Безопасность">Безопасность</span>
</h3>
<p>Удалённый вход в систему через SSH удобен для осуществления административных задач, но представляет определённую проблему с точки зрения безопаности. SSH часто подвергается атакам полным перебором и нуждается в соответствующей конфигурации, чтобы не дать посторонним войти в систему.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ssh-audit">ssh-audit</a></span> предлагает автоматизированный анализ серверных и клиентских настроек. Следующие статьи и инструменты могут также быть полезными:
</p>
<ul>
<li><a href="https://wiki.mozilla.org/Security/Guidelines/OpenSSH" class="extiw" title="mozillawiki:Security/Guidelines/OpenSSH">Статья Mozilla Infosec Team</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/mozilla/ssh_scan">Утилита ssh_scan</a></li>
<li><a rel="nofollow" class="external text" href="https://www.ssh-audit.com/hardening_guides.html">SSH Hardening Guides</a></li>
</ul>
<h4>
<span id=".D0.92.D1.85.D0.BE.D0.B4_.D1.82.D0.BE.D0.BB.D1.8C.D0.BA.D0.BE_.D0.BF.D0.BE_.D0.BE.D1.82.D0.BA.D1.80.D1.8B.D1.82.D0.BE.D0.BC.D1.83_.D0.BA.D0.BB.D1.8E.D1.87.D1.83"></span><span class="mw-headline" id="Вход_только_по_открытому_ключу">Вход только по открытому ключу</span>
</h4>
<p>Если клиент не может выполнить вход по открытому ключу, SSH-сервер по умолчанию предоставляет возможность аутентификации по паролю. Это позволяет злоумышленнику получить доступ с помощью <a href="#%D0%97%D0%B0%D1%89%D0%B8%D1%82%D0%B0_%D0%BE%D1%82_%D0%B0%D1%82%D0%B0%D0%BA_%D0%BF%D0%BE%D0%BB%D0%BD%D1%8B%D0%BC_%D0%BF%D0%B5%D1%80%D0%B5%D0%B1%D0%BE%D1%80%D0%BE%D0%BC">полного перебора</a> паролей. Самый надёжный способ защиты от такой атаки — полностью отключить вход по паролю и оставить только аутентификацию с помощью <a href="../en/SSH_keys.html" class="mw-redirect" title="SSH keys (Русский)">ключей SSH</a>. Для этого нужно отключить следующую опцию в файле настроек демона:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PasswordAuthentication no</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Перед заданием этой настройки следует убедиться, что аутентификация по открытому ключу включена для всех аккаунтов, которым может потребоваться SSH-доступ. Для этого используются файлы <code>authorized_keys</code>. Подробнее см. <a href="../en/SSH_keys.html#Copying_the_public_key_to_the_remote_server" title="SSH keys">SSH keys#Copying the public key to the remote server</a>.</div>
<h4>
<span id=".D0.94.D0.B2.D1.83.D1.85.D1.84.D0.B0.D0.BA.D1.82.D0.BE.D1.80.D0.BD.D0.B0.D1.8F_.D0.B0.D1.83.D1.82.D0.B5.D0.BD.D1.82.D0.B8.D1.84.D0.B8.D0.BA.D0.B0.D1.86.D0.B8.D1.8F_.D0.B8_.D0.BE.D1.82.D0.BA.D1.80.D1.8B.D1.82.D1.8B.D0.B5_.D0.BA.D0.BB.D1.8E.D1.87.D0.B8"></span><span class="mw-headline" id="Двухфакторная_аутентификация_и_открытые_ключи">Двухфакторная аутентификация и открытые ключи</span>
</h4>
<p>С помощью опции <code>AuthenticationMethods</code> можно настроить использование различных способов аутентификации, например, применение открытых ключей совместно с двухфакторной аутентификацией.
</p>
<h5>
<span id=".D0.9F.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D0.BC.D1.8B_.D0.B0.D1.83.D1.82.D0.B5.D0.BD.D1.82.D0.B8.D1.84.D0.B8.D0.BA.D0.B0.D1.86.D0.B8.D0.B8"></span><span class="mw-headline" id="Программы_аутентификации">Программы аутентификации</span>
</h5>
<p>В статье <a href="../en/Google_Authenticator.html" title="Google Authenticator">Google Authenticator</a> описана настройка Google Authenticator.
</p>
<p>Для <a rel="nofollow" class="external text" href="https://duo.com/">Duo</a> <a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">установите</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/duo_unix/">duo_unix</a></span><sup><small>AUR</small></sup>, в котором есть полная поддержка модуля <code>pam_duo.so</code>. Подробнее о настройке параметров доступа (Integration Key, Secret Key, API Hostname) см. <a rel="nofollow" class="external text" href="https://duo.com/docs/duounix">документацию Duo Unix</a>.
</p>
<h5>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_PAM"></span><span class="mw-headline" id="Настройка_PAM">Настройка PAM</span>
</h5>
<p>Для использования <a href="../en/PAM.html" title="PAM">PAM</a> с OpenSSH, отредактируйте следующий файл:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ChallengeResponseAuthentication yes
AuthenticationMethods publickey keyboard-interactive:pam
</pre>
<p>После этого можно будет выполнять вход в систему или по открытому ключу, <b>или</b> в соответствии настройками аутентификации PAM.
</p>
<p>Наоборот, если вы хотите настроить вход по открытому ключу <b>и</b> через PAM, используйте в качестве разделителя AuthenticationMethods запятую, а не пробел:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ChallengeResponseAuthentication yes
AuthenticationMethods publickey<b>,</b>keyboard-interactive:pam
</pre>
<p>При входе по ключу и PAM аутентификацию по паролю можно отключить:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/sshd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#отключение удалённного root
auth      required  pam_securetty.so

#требуется google authenticator
auth      required  pam_google_authenticator.so

#но пароль не нужен
#auth      include   system-remote-login
account   include   system-remote-login
password  include   system-remote-login
session   include   system-remote-login
</pre>
<h4>
<span id=".D0.97.D0.B0.D1.89.D0.B8.D1.82.D0.B0_.D0.BE.D1.82_.D0.B0.D1.82.D0.B0.D0.BA_.D0.BF.D0.BE.D0.BB.D0.BD.D1.8B.D0.BC_.D0.BF.D0.B5.D1.80.D0.B5.D0.B1.D0.BE.D1.80.D0.BE.D0.BC"></span><span class="mw-headline" id="Защита_от_атак_полным_перебором">Защита от атак полным перебором</span>
</h4>
<p>Принцип атаки полным перебором прост: атакующий многократно пытается выполнить вход на страницу или веб-сервер, используя большое количество случайных комбинаций имён пользователей и паролей.
</p>
<p>Подробнее см. <a href="../en/Uncomplicated_Firewall.html#Rate_limiting_with_ufw" class="mw-redirect" title="Ufw">ufw#Rate limiting with ufw</a> и <a href="../ru/Simple_stateful_firewall.html#%D0%90%D1%82%D0%B0%D0%BA%D0%B0_%D0%BF%D0%BE%D0%BB%D0%BD%D1%8B%D0%BC_%D0%BF%D0%B5%D1%80%D0%B5%D0%B1%D0%BE%D1%80%D0%BE%D0%BC" class="mw-redirect" title="Настройка межсетевого экрана">Настройка межсетевого экрана#Атака полным перебором</a> в случае экрана <a href="../ru/Iptables.html" title="Iptables (Русский)">iptables</a>
</p>
<p>Кроме того, программы вроде <a href="../ru/Fail2ban.html" title="Fail2ban (Русский)">fail2ban</a> или <a href="../en/Sshguard.html" title="Sshguard">sshguard</a> помогают защититься от атак перебором, блокируя попытки подбора паролей.
</p>
<ul>
<li>Разрешайте входящие SSH-соединения только для доверенных адресов</li>
<li>Используйте <a href="../ru/Fail2ban.html" title="Fail2ban (Русский)">fail2ban</a> или <a href="../en/Sshguard.html" title="Sshguard">sshguard</a> для автоматической блокировки IP-адресов, которые провалили попытку аутентификации слишком много раз.</li>
<li>Используйте <a rel="nofollow" class="external text" href="https://github.com/jtniehof/pam_shield">pam_shield</a> для блокировки IP-адресов, которые выполняют слишком большое количество попыток входа за определённый период времени. В отличие от <a href="../ru/Fail2ban.html" title="Fail2ban (Русский)">fail2ban</a> и <a href="../en/Sshguard.html" title="Sshguard">sshguard</a>, pam_shield не различает успешными и неудачными попытками входа.</li>
</ul>
<h4>
<span id=".D0.9E.D0.B3.D1.80.D0.B0.D0.BD.D0.B8.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B2.D1.85.D0.BE.D0.B4.D0.B0_.D0.BE.D1.82_.D0.B8.D0.BC.D0.B5.D0.BD.D0.B8_.D1.81.D1.83.D0.BF.D0.B5.D1.80.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8F"></span><span class="mw-headline" id="Ограничение_входа_от_имени_суперпользователя">Ограничение входа от имени суперпользователя</span>
</h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> В текущей версии OpenSSH вход от root отключён по умолчанию. Некоторые части этого раздела могут быть избыточны.
 (Discuss in <a rel="nofollow" class="external text" href="../ru/Talk:OpenSSH.html">Talk:OpenSSH (Русский)</a>)</div>
</div>
<p>Предоставление возможности входа через SSH от имени суперпользователя без какой-либо защиты считается плохой практикой. Существует два способа ограничения этой возможности для повышения безопасности.
</p>
<h5>
<span id=".D0.9E.D1.82.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Отключение">Отключение</span>
</h5>
<p>Утилита <a href="../ru/Sudo.html" title="Sudo (Русский)">sudo</a> выборочно предоставляет права суперпользователя для действий, которым они необходимы, без входа в учётную запись root. Благодаря этому можно заблокировать аккаунт root, чтобы отключить возможность входа в него через SSH. Это потенциально является средством защиты от атак перебором, поскольку атакующему придётся подбирать ещё и имя учётной записи в дополнение к паролю.
</p>
<p>Чтобы отключить вход от имени суперпользователя через SSH, получите его права и отредактируйте секцию "Authentication" файла <code>/etc/ssh/sshd_config</code>. Просто измените значение <code>#PermitRootLogin yes</code> на <code>no</code> и раскомментируйте строку:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PermitRootLogin no
...
</pre>
<p><a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">Перезапустите</a> демон SSH.
</p>
<p>Теперь вы не сможете войти в систему через SSH от имени суперпользователя, но по-прежнему будете иметь возможность входить от имени обычного пользователя и использовать команды <a href="../en/Su.html" title="Su">su</a> и <a href="../ru/Sudo.html" title="Sudo (Русский)">sudo</a> для администрирования.
</p>
<h5>
<span id=".D0.9E.D0.B3.D1.80.D0.B0.D0.BD.D0.B8.D1.87.D0.B5.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Ограничение">Ограничение</span>
</h5>
<p>Некоторые автоматические задачи, вроде удалённого резервного копирования системы, требуют полного root-доступа. Чтобы иметь возможность безопасно его использовать, вместо отключения укажите конкретные команды. Для этого отредактируйте файл <code>~root/.ssh/authorized_keys</code>, создав префиксы для соответствующих ключей, например:
</p>
<pre>command="/usr/lib/rsync/rrsync -ro /" ssh-rsa …
</pre>
<p>Теперь при входе с использованием соответствующего ключа пользователь получит права root, но сможет выполнять только те команды, которые перечислены между кавычками.
</p>
<p>При этом остаётся возможность входа в систему с использованием имени суперпользователя. Это можно исправить, добавив следующую строку в файл <code>sshd_config</code>:
</p>
<pre>PermitRootLogin forced-commands-only
</pre>
<p>Это не только ограничит список команд, которые могут выполняться через SSH от имени суперпользователя, но и отключит использование паролей, оставляя возможность входа в root-аккаунт только по ключу.
</p>
<p>Есть альтернатива, вводящая меньше ограничений, которая позволит выполнять любые команды от имени суперпользователя, но сделает невозможной атаку перебором благодаря отключению входа по паролю. Для этого пропишите:
</p>
<pre>PermitRootLogin prohibit-password
</pre>
<h4>
<span id=".D0.97.D0.B0.D1.89.D0.B8.D1.82.D0.B0_.D1.84.D0.B0.D0.B9.D0.BB.D0.B0_authorized_keys"></span><span class="mw-headline" id="Защита_файла_authorized_keys">Защита файла authorized_keys</span>
</h4>
<p>Для дополнительной защиты можно запретить пользователям добавлять новые открытые ключи, по которым можно будет выполнить соединение.
</p>
<p>Задайте файлу <code>authorized_keys</code> права только на чтение для владельца и отключите остальные:
</p>
<pre>$ chmod 400 ~/.ssh/authorized_keys
</pre>
<p>Чтобы не позволить пользователям вернуть разрешения, установите <a href="../en/File_permissions_and_attributes.html#File_attributes" title="File permissions and attributes">бит неизменяемости</a> на файл <code>authorized_keys</code>. После этого пользователь может попытаться перемеименовать каталог <code>~/.ssh</code> и создать новый каталог с таким же именем и файлом <code>authorized_keys</code>. Чтобы не дать ему это сделать, установите бит неизменяемости и на каталог <code>~/.ssh</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Если понадобится добавить новый ключ, то придётся удалить бит неизменяемости файла <code>authorized_keys</code> и дать ему права на запись. В конце нужно будет вернуть настройки обратно.
</div>
<h2>
<span id=".D0.A1.D0.BE.D0.B2.D0.B5.D1.82.D1.8B_.D0.B8_.D1.80.D0.B5.D0.BA.D0.BE.D0.BC.D0.B5.D0.BD.D0.B4.D0.B0.D1.86.D0.B8.D0.B8"></span><span class="mw-headline" id="Советы_и_рекомендации">Советы и рекомендации</span>
</h2>
<h3>
<span id=".D0.A8.D0.B8.D1.84.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.BD.D1.8B.D0.B9_.D1.82.D1.83.D0.BD.D0.BD.D0.B5.D0.BB.D1.8C_SOCKS"></span><span class="mw-headline" id="Шифрованный_туннель_SOCKS">Шифрованный туннель SOCKS</span>
</h3>
<p>Эта возможность будет полезна для обладателей ноутбуков, которые часто подключаются к небезопасным беспроводным сетям в общественных местах. Для создания туннеля необходимо предварительно запустить сервер SSH в каком-нибудь безопасном месте, например, дома или на работе. Также будет весьма кстати какая-нибудь служба динамического DNS вроде <a rel="nofollow" class="external text" href="https://dyn.com/dns/">DynDNS</a>, которая избавит вас от необходимости запоминать IP-адрес.
</p>
<h4>
<span id=".D0.A8.D0.B0.D0.B3_1:_.D1.83.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.B8.D1.82.D1.8C_.D1.81.D0.BE.D0.B5.D0.B4.D0.B8.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Шаг_1:_установить_соединение">Шаг 1: установить соединение</span>
</h4>
<p>Для установления соединения необходимо лишь выполнить команду:
</p>
<pre>$ ssh -TND 4711 <i>пользователь</i>@<i>хост</i>
</pre>
<p>где <code><i>пользователь</i></code> — ваше имя пользователя на сервере SSH, работающием на машине <code><i>хост</i></code>. Сервер запросит пароль, после чего будет установлено соединение. Флаг <code>N</code> отключает интерактивное приглашение командной строки, а флаг <code>D</code> позволяет пользователю выбрать локальный порт для прослушивания. Флаг <code>T</code> означает, что сервер не станет выделять псевдо-терминал для данного соединения.
</p>
<p>Также стоит указать флаг <code>-v</code>, который сделает вывод команды более многословным. В частности, по выводу можно будет понять, что соединение действительно было установлено.
</p>
<h4>
<span id=".D0.A8.D0.B0.D0.B3_2_.28.D0.B2.D0.B0.D1.80.D0.B8.D0.B0.D0.BD.D1.82_.D0.90.29:_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B8.D1.82.D1.8C_.D0.B1.D1.80.D0.B0.D1.83.D0.B7.D0.B5.D1.80_.28.D0.B8.D0.BB.D0.B8_.D0.B4.D1.80.D1.83.D0.B3.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D0.BC.D1.8B.29"></span><span class="mw-headline" id="Шаг_2_(вариант_А):_настроить_браузер_(или_другие_программы)">Шаг 2 (вариант А): настроить браузер (или другие программы)</span>
</h4>
<p>Чтобы установленное соединение (см. выше) было хоть как-то полезно, нужно настроить браузер и другие программы на использование туннеля SOCKS. В настоящее время SSH поддерживает как SOCKSv4, так и SOCKSv5, вы можете выбрать любой из них.
</p>
<ul><li>Для Firefox: <i>Preferences &gt; General &gt; Settings...</i>. В открывшемся окне выберите пункт <i>Manual proxy configuration</i>, введите <code>localhost</code> в поле <i>SOCKS host</i> и номер порта в поле <i>Port</i> (<code>4711</code> для примера выше).</li></ul>
<dl>
<dd>DNS-запросы Firefox автоматически посылаться через туннель не будут, что представляет собой некоторую уязвимость с точки зрения приватности. Чтобы это исправить, также выберите пункт <i>Proxy DNS when using SOCKS v5</i>. Очевидно, что это будет работать, только если вы выбрали пятую версию протокола SOCKS, а не четвёртую.</dd>
<dd>Перезапустите Firefox, чтобы настройки заработали.</dd>
</dl>
<ul><li>Для Chromium: SOCKS можно настроить через переменные окружения или опции командной строки. Например, выберите одну из следующих функций и добавьте её в файл <code>.bashrc</code>:</li></ul>
<pre>function secure_chromium {
    port=4711
    export SOCKS_SERVER=localhost:$port
    export SOCKS_VERSION=5
    chromium &amp;
    exit
}
</pre>
<p>или
</p>
<pre>function secure_chromium {
    port=4711
    chromium --proxy-server="socks://localhost:$port" &amp;
    exit
}
</pre>
<p>Теперь откройте терминал, выполните
</p>
<pre>$ secure_chromium
</pre>
<p>и наслаждайтесь защищённым туннелем!
</p>
<h4>
<span id=".D0.A8.D0.B0.D0.B3_2_.28.D0.B2.D0.B0.D1.80.D0.B8.D0.B0.D0.BD.D1.82_.D0.91.29:_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B8.D1.82.D1.8C_TUN-.D0.B8.D0.BD.D1.82.D0.B5.D1.80.D1.84.D0.B5.D0.B9.D1.81"></span><span class="mw-headline" id="Шаг_2_(вариант_Б):_настроить_TUN-интерфейс">Шаг 2 (вариант Б): настроить TUN-интерфейс</span>
</h4>
<p>Этот вариант выглядит несколько более запутанным по сравнению с предыдущим, но зато вам не придётся настраивать работу через SOCKS-прокси для каждого приложения по отдельности. Данное решение подразумевает настройку локального TUN-интерфейса и перенаправление всего трафика на него.
</p>
<p>Подробнее см. <a href="../en/VPN_over_SSH.html#Set_up_badvpn_and_tunnel_interface" title="VPN over SSH">VPN over SSH#Set up badvpn and tunnel interface</a>.
</p>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B1.D1.80.D0.BE.D1.81_X11"></span><span class="mw-headline" id="Проброс_X11">Проброс X11</span>
</h3>
<p>Проброс Х11 — механизм, который позволяет графическим интерфейсам программ удаленной машины-сервера отображаться на локальной машине-клиенте. При этом нет необходимости устанавливать на удаленном узле всю систему Х11, но надо установить хотя бы <i>xauth</i>. <i>xauth</i> — утилита, которая поддерживает конфигурации <code>Xauthority</code>, используемые сервером и клиентом для аутентификации сессии X11 <a rel="nofollow" class="external autonumber" href="https://www.xmodulo.com/how-to-enable-x11-forwarding-using-ssh.html">[3]</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Использование проброса X11 имеет важные последствия для безопасности. Изучите соответствующие разделы страниц справочных руководств <span class="plainlinks archwiki-template-man" title="$ man 1 ssh"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh.1">ssh(1)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 5 sshd_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sshd_config.5">sshd_config(5)</a></span> и <span class="plainlinks archwiki-template-man" title="$ man 5 ssh_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh_config.5">ssh_config(5)</a></span>, а также  <a rel="nofollow" class="external text" href="https://security.stackexchange.com/questions/14815/security-concerns-with-x11-forwarding">вопрос на StackExchange</a>
</div>
<h4>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_3"></span><span class="mw-headline" id="Настройка_3">Настройка</span>
</h4>
<p>На удалённой системе:
</p>
<ul>
<li>
<a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">Установите</a> пакеты <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xorg-xauth">xorg-xauth</a></span> и <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xorg-xhost">xorg-xhost</a></span>;</li>
<li>В файле <code>/etc/ssh/ssh<b>d</b>_config</code>:
<ul>
<li>Задайте для опции <code>X11Forwarding</code> значение <code>yes</code>;</li>
<li>Убедитесь, что заданы значения <code>AllowTcpForwarding yes</code>, <code>X11UseLocalhost yes</code> и <code>X11DisplayOffset 10</code> (значения по умолчанию, если ничего не менялось, см. <span class="plainlinks archwiki-template-man" title="$ man 5 sshd_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sshd_config.5">sshd_config(5)</a></span>);</li>
</ul>
</li>
<li>
<a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">Перезапустите</a> <a href="#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B4%D0%B5%D0%BC%D0%BE%D0%BD%D0%BE%D0%BC">службу <i>sshd</i></a>.</li>
</ul>
<p>На клиенте:
</p>
<ul>
<li>
<a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">Установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xorg-xauth">xorg-xauth</a></span>;</li>
<li>включите опцию <code>ForwardX11</code> либо добавив флаг <code>-X</code> в командной строке, либо задав в <a href="#%D0%9A%D0%BB%D0%B8%D0%B5%D0%BD%D1%82">файле настроек клиента</a> параметр <code>ForwardX11 yes</code>.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Если графический интерфейс отображается плохо или вы получаете сообщения об ошибках, включите опцию <code>ForwardX11Trusted</code> (в командной строке это флаг <code>-Y</code>). Это предотвратит управление пробросом Х11 со стороны <a rel="nofollow" class="external text" href="https://www.x.org/wiki/Development/Documentation/Security/">расширения безопасности X11</a>. Если вы будете использовать эту опцию, обязательно прочитайте <a href="#%D0%9F%D1%80%D0%BE%D0%B1%D1%80%D0%BE%D1%81_X11">предупреждение</a> в начале этого раздела</div>
<h4>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Использование">Использование</span>
</h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Команда <code>xhost</code> <a rel="nofollow" class="external text" href="https://unix.stackexchange.com/questions/12755/how-to-forward-x-over-ssh-from-ubuntu-machine#comment17148_12772">обычно не нужна</a>
 (Discuss in <a rel="nofollow" class="external text" href="../ru/Talk:OpenSSH.html">Talk:OpenSSH (Русский)</a>)</div>
</div>
<p>Выполните удалённый вход как обычно, добавив флаг <code>-X</code>, если опция <i>ForwardX11</i> не включена в конфигурационном файле клиента:
</p>
<pre>$ ssh -X <i>пользователь</i>@<i>хост</i>
</pre>
<p>Если вы получаете ошибки при запуске графических приложений, попробуйте опцию <i>ForwardX11Trusted</i>:
</p>
<pre>$ ssh -Y <i>пользователь</i>@<i>хост</i>
</pre>
<p>Теперь вы можете запустить любую программу с графическим интерфейсом пользователя на удаленном сервере, и ее вывод будет перенаправлен в вашу локальную сессию:
</p>
<pre>$ xclock
</pre>
<p>Если вы получите ошибки "Cannot open display", попробуйте выполнить следующую команду от имени обычного пользователя:
</p>
<pre>$ xhost +
</pre>
<p>эта команда позволит выполнять проброс приложений X11 любому пользователю. Чтобы ограничить проброс конкретным хостом:
</p>
<pre>$ xhost +<i>имя-хоста</i>
</pre>
<p>где <i>имя-хоста</i> - это имя конкретного хоста. Подробнее см. <span class="plainlinks archwiki-template-man" title="$ man 1 xhost"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/xhost.1">xhost(1)</a></span>.
</p>
<p>Будьте осторожны с некоторыми приложениями, так как они могут проверять локальную машину на предмет уже работающего приложения. Один из примеров - <a href="../ru/Firefox.html" title="Firefox (Русский)">Firefox</a>: либо закройте работающий Firefox, либо используйте следующий параметр запуска:
</p>
<pre>$ firefox --no-remote
</pre>
<p>Если вы получите ошибку <code>X11 forwarding request failed on channel 0</code> при подключении (и лог-файл сервера <code>/var/log/errors.log</code> будет содержать строку <code>Failed to allocate internet-domain X11 display socket</code>), удостоверьтесь, что пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xorg-xauth">xorg-xauth</a></span> установлен. Если его установка не поможет, попробуйте сделать одно из двух:
</p>
<ul>
<li>Включить опцию <code>AddressFamily any</code> в файле <code>ssh<b>d</b>_config</code> на сервере;</li>
<li>Задать опции <code>AddressFamily</code> в <code>ssh<b>d</b>_config</code> на сервере значение inet. Присвоение значения inet может исправить проблемы с клиентами Ubuntu при использовании IPv4.</li>
</ul>
<p>Для запуска приложений X от имени других пользователей на сервере SSH вам необходимо добавить (команда <code>xauth add</code>) строку аутентификации, взятую из вывода команды <code>xauth list</code> пользователя, вошедшего в систему.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Полезные ссылки при решении проблем с пробросом X11: <a rel="nofollow" class="external autonumber" href="https://unix.stackexchange.com/a/12772">[4]</a>, <a rel="nofollow" class="external autonumber" href="https://unix.stackexchange.com/a/46748">[5]</a>, <a rel="nofollow" class="external autonumber" href="https://superuser.com/a/805060">[6]</a>.
</div>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B1.D1.80.D0.BE.D1.81_.D0.B4.D1.80.D1.83.D0.B3.D0.B8.D1.85_.D0.BF.D0.BE.D1.80.D1.82.D0.BE.D0.B2"></span><span class="mw-headline" id="Проброс_других_портов">Проброс других портов</span>
</h3>
<p>В дополнение к встроенной поддержке SSH X11 также можно установить безопасный туннель для любого соединения TCP с использованием локального или удаленного проброса.
</p>
<p>Локальный проброс открывает на локальной машине порт, подключения к которому будут перенаправлены на удаленный хост, а оттуда - по заданному направлению. Очень часто этим направлением будет сам удаленный хост, предоставляющий secure shell и, например, безопасное соединение <a href="../en/List_of_applications/Internet.html#Remote_desktop" class="mw-redirect" title="VNC">VNC</a> для этой же машины. Локальный проброс осуществляется при помощи ключа <code>-L</code> и задания спецификации проброса в следующей форме: <code>&lt;порт туннеля&gt;:&lt;адрес назначения&gt;:&lt;порт назначения&gt;</code>.
</p>
<p>Например:
</p>
<pre>$ ssh -L 1000:mail.google.com:25 192.168.0.100
</pre>
<p>будет использовать SSH для входа в систему и открытия шелла на <code>192.168.0.100</code>, а также создаст туннель от порта 1000 локальной машины на порт 25 mail.google.com. В результате подключения к <code>localhost:1000</code> будут перенаправлены на порт Gmail SMTP. Для Google всё будет выглядеть так, будто соединение (но вовсе не обязательно — передаваемые по нему данные) исходит от <code>192.168.0.100</code>; данные будут в безопасности между локальной машиной и <code>192.168.0.100</code>, но не между <code>192.168.0.100</code> и Google, если не предпринять дополнительных мер.
</p>
<p>Также:
</p>
<pre>$ ssh -L 2000:192.168.0.100:6001 192.168.0.100
</pre>
<p>будет принимать подключения к <code>localhost:2000</code>, которые будут перенаправлены на порт 6001 удаленного хоста. Этот пример хорош для VNC-соединений с помощью утилиты vncserver. Утилита входит в пакет <a href="../en/TigerVNC.html" title="TigerVNC">TigerVNC</a>, и, несмотря на очевидную полезность, имеет некоторые проблемы с безопасностью.
</p>
<p>Удаленный проброс позволяет удаленному хосту подключаться к произвольному хосту через туннель SSH и локальную машину, предоставляя функционал, обратный локальному пробросу. Это полезно в ситуациях, когда, например, удаленный хост ограничен фаерволлом. Он включается ключом <code>-R</code> и заданием спецификаций проброса в следующей форме: <code>&lt;порт туннеля&gt;:&lt;адрес назначения&gt;:&lt;порт назначения&gt;</code>.
</p>
<p>Например:
</p>
<pre>$ ssh -R 3000:irc.libera.chat:6667 192.168.0.200
</pre>
<p>поднимет шелл на <code>192.168.0.200</code>, и соединения из <code>192.168.0.200</code> к своему же порту 3000 (т.е. <code>localhost:3000</code> удалённого хоста) будут посланы через туннель на локальную машину, а затем на irc.libera.chat, порт 6667, что в данном примере позволит использовать программы IRC на удаленном хосте, даже если обычно порт 6667 будет для них заблокирован.
</p>
<p>Оба вида проброса могут быть использованы для предоставления безопасного "шлюза", позволяющего другим компьютерам получить преимущества туннеля SSH без непосредственно работающего SSH или демона SSH, при использовании bind-адреса в начале туннеля как части спецификации проброса, например, <code>&lt;адрес туннеля&gt;:&lt;порт туннеля&gt;:&lt;адрес назначения&gt;:&lt;порт назначения&gt;</code>. <code>&lt;адрес туннеля&gt;</code> может быть любым адресом на машине, <code>localhost</code>, <code>*</code> (или blank), который, соответственно, пропускает соединения через заданный адрес, интерфейс loopback или любой интерфейс. По умолчанию проброс ограничен соединениями от машины в начале туннеля, <code>&lt;адрес туннеля&gt;</code> установлен в <code>localhost</code>. Локальный проброс не требует дополнительной настройки, в то время как удаленный проброс ограничен конфигурацией демона SSH удаленного сервера. Смотрите описание опции <code>GatewayPorts</code> на справочной странице <code>sshd_config(5)</code> и опции <code>-L address</code> в руководстве <span class="plainlinks archwiki-template-man" title="$ man 1 ssh"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh.1">ssh(1)</a></span> для получения дополнительной информации.
</p>
<h3>
<span id="Jump-.D1.85.D0.BE.D1.81.D1.82"></span><span class="mw-headline" id="Jump-хост">Jump-хост</span>
</h3>
<p>Может случиться так, что у вас не будет возможности установить связь с удалённой машиной напрямую. В этом случае используется <a href="https://en.wikipedia.org/wiki/ru:%D0%98%D0%BD%D1%81%D1%82%D0%B0%D0%BB%D0%BB%D1%8F%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D1%8B%D0%B9_%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80" class="extiw" title="wikipedia:ru:Инсталляционный сервер">jump-сервер</a> или <a href="https://en.wikipedia.org/wiki/ru:Bastion_host" class="extiw" title="wikipedia:ru:Bastion host">узел-бастион</a>. Следовательно, необходимо соединить два или более SSH-туннеля в цепочку. Разумеется, ваши ключи должны позволять выполнить авторизацию на каждом из серверов в цепи. Для этого SSH запускается с опциями пересылки аутентификационных данных (<code>-A</code>) и выделения псевдотерминала (<code>-t</code>):
</p>
<pre>$ ssh -A -t -l <i>пользователь1 бастион1</i> \
  ssh -A -t -l <i>пользователь2 промежуточный-узел2</i> \
  ssh -A -t -l <i>пользователь3 целевой-узел</i>
</pre>
<p>Несколько проще то же самое можно сделать с флагом <code>-J</code>:
</p>
<pre>$ ssh -J <i>пользователь1</i>@<i>бастион1</i>,<i>пользователь2</i>@<i>промежуточный-узел2</i> <i>пользователь3</i>@<i>целевой-узел</i>
</pre>
<p>Промежуточные хосты в директиве <code>-J</code> разделяются запятыми и располагаются в порядке установления соединения. Часть <code><i>пользователь...</i>@</code> необязательна. При работе с опцией <code>-J</code> используется стандартный файл настроек SSH, поэтому при необходимости в нём можно указать настройки соединения для каждого хоста в отдельности.
</p>
<p>Опция <code>ProxyJump</code> в файле настроек эквивалентyна флагу командной строки <code>-J</code>, см. <span class="plainlinks archwiki-template-man" title="$ man 5 ssh_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh_config.5">ssh_config(5)</a></span>.
</p>
<h3>
<span id=".D0.9E.D0.B1.D1.80.D0.B0.D1.82.D0.BD.D1.8B.D0.B9_SSH_.D1.87.D0.B5.D1.80.D0.B5.D0.B7_.D0.BF.D1.80.D0.BE.D0.BC.D0.B5.D0.B6.D1.83.D1.82.D0.BE.D1.87.D0.BD.D1.8B.D0.B9_.D1.83.D0.B7.D0.B5.D0.BB"></span><span class="mw-headline" id="Обратный_SSH_через_промежуточный_узел">Обратный SSH через промежуточный узел</span>
</h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> SSH-туннелирование давно известно, поэтому неплохо было бы добавить несколько ссылок с подробным описанием. Например, <a rel="nofollow" class="external autonumber" href="https://unix.stackexchange.com/questions/46235/how-does-reverse-ssh-tunneling-work/118650#118650">[7]</a>, где рассмотрены и некоторые другие варианты.
 (Discuss in <a rel="nofollow" class="external text" href="../ru/Talk:OpenSSH.html">Talk:OpenSSH (Русский)</a>)</div>
</div>
<p>Идея заключается в том, чтобы подключиться к серверу через промежуточный узел, причём сервер соединяется с этим узлом через обратный SSH-туннель. Например, это может быть полезно, когда сервер находится за NAT, а промежуточный узел представляет собой публичный SSH-сервер, используемый в качестве прокси. При этом:
</p>
<ul>
<li>у клиента должны быть ключи для авторизации и на промежуточном узле, и на целевом сервере;</li>
<li>у сервера должны быть ключи дла авторизации на промежуточном узле.</li>
</ul>
<p>Ниже приведён пример настройки соединения через промежуточный узел. Предполагается, что <i>пользователь1</i> — аккаунт на клиентской машине, <i>пользователь2</i> — на промежуточном узле и <i>пользователь3</i> — на сервере. Сначала необходимо создать обратный туннель:
</p>
<pre>ssh -R 2222:localhost:22 -N <i>пользователь2</i>@<i>промежуточный-узел</i>
</pre>
<p>Это действие можно автоматизировать с помощью скрипта, службы systemd или <a href="#Autossh_-_%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%BF%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_%D1%81%D0%B5%D1%81%D1%81%D0%B8%D0%B9_%D0%B8_%D1%82%D1%83%D0%BD%D0%BD%D0%B5%D0%BB%D0%B5%D0%B9_SSH">autossh</a>.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Объяснить, почему недостаточно команды <code>ssh user3@relay -p 2222</code>.
 (Discuss in <a rel="nofollow" class="external text" href="../ru/Talk:OpenSSH.html">Talk:OpenSSH (Русский)</a>)</div>
</div>
<p>Соединение со стороны клиента устанавливается командой:
</p>
<pre>ssh -t <i>пользователь1</i>@<i>промежуточный-узел</i> ssh <i>пользователь3</i>@localhost -p 2222
</pre>
<p>Удалённую команду для создания соединения с обратным туннелем можно добавить в файл <code>~/.ssh/authorized_keys</code> на промежуточном узле. Для этого воспользуйтесь полем <code>command</code>:
</p>
<pre>command="ssh <i>пользователь3</i>@localhost -p 2222" ssh-rsa KEY2 <i>пользователь1</i>@<i>клиент</i>
</pre>
<p>Тогда установить соединение можно командой:
</p>
<pre>ssh <i>пользователь2</i>@<i>промежуточный-узел</i>
</pre>
<p>Обратите внимание, что функция автодополнения <a href="https://en.wikipedia.org/wiki/ru:SCP" class="extiw" title="wikipedia:ru:SCP">SCP</a> в терминале клиента работать не будет, а на некоторых конфигурациях не будет работать и сама передача данных по протоколу SCP.
</p>
<h3>
<span id=".D0.9C.D1.83.D0.BB.D1.8C.D1.82.D0.B8.D0.BF.D0.BB.D0.B5.D0.BA.D1.81.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Мультиплексирование">Мультиплексирование</span>
</h3>
<p>Демон SSH обычно прослушивает порт 22. Однако трафик, который адресован не на стандартные порты HTTP/S (80 и 443 соответственно), на публичных серверах часто блокируется. Следовательно, в таком случае SSH-соединение невозможно. В качестве возможного решения можно указать демону <code>sshd</code> прослушивать один из портов в белом списке:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Port 22
Port 443
</pre>
<p>Поскольку порт 443 уже прослушивается веб-сервером в ожидании HTTPS-пакетов, в данном случае имеет смысл воспользоваться мультиплексором вроде <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sslh">sslh</a></span>. Он будет прослушивать мультиплексированный порт и переадресовывать пакеты разным сервисам в зависимости от их назначения.
</p>
<h3>
<span id=".D0.A3.D0.B2.D0.B5.D0.BB.D0.B8.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D1.81.D0.BA.D0.BE.D1.80.D0.BE.D1.81.D1.82.D0.B8_SSH"></span><span class="mw-headline" id="Увеличение_скорости_SSH">Увеличение скорости SSH</span>
</h3>
<p>Среди <a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">настроек клиента</a> есть некоторые, которые позволяют увеличить скорость соединения либо глобально, либо для отдельных хостов. Полное описание этих опций можно найти в руководстве <span class="plainlinks archwiki-template-man" title="$ man 5 ssh_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh_config.5">ssh_config(5)</a></span>.
</p>
<ul><li>
<i>Используйте быстрый алгоритм шифрования</i>: в современных процессорах с инструкциями AESNI алгоритмы <code>aes128-gcm@openssh.com</code> и <code>aes256-gcm@openssh.com</code> гораздо более производительны, чем стандартный алгоритм OpenSSH, <code>chacha20-poly1305@openssh.com</code>. Выбрать алгоритм можно флагом <code>-c</code>. Чтобы сделать изменения постоянными, добавьте пункт <code>Ciphers</code> в файл <code>~/.ssh/config</code>, перечислив алгоритмы в порядке уменьшения предпочтительности, например:
<dl><dd><pre>Ciphers aes128-gcm@openssh.com,aes256-gcm@openssh.com,chacha20-poly1305@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr</pre></dd></dl>
</li></ul>
<ul><li>
<i>Включите или выключите сжатие</i>: сжатие может увеличить скорость для медленных соединений, оно включается параметром <code>Compression yes</code> или флагом <code>-C</code>. Однако в качестве алгоритма сжатия используется относительно медленный <span class="plainlinks archwiki-template-man" title="$ man 1 gzip"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/gzip.1">gzip(1)</a></span>, который в быстрых сетях становится узким местом. Поэтому в локальных и быстрых сетях лучше отключить сжатие параметром <code>Compression no</code>.</li></ul>
<ul><li>
<i>Объединение соединений</i>: в случае нескольких одновременных сессий к одному хосту можно объединить их в одно соединение:
<dl><dd><pre>ControlMaster auto
ControlPersist yes
ControlPath ~/.ssh/sockets/socket-%r@%h:%p
</pre></dd></dl>
</li></ul>
<dl><dd>где вместо <code>~/.ssh/sockets</code> можно использовать любой каталог без прав на запись для остальных пользователей.</dd></dl>
<ul><li>Параметр <code>ControlPersist</code> позволяет задать время ожидания после момента разрыва исходного соединения. Возможны следующие значения:
<ul>
<li>
<code>no</code> — соединение разрывается сразу же после отключения предыдущего клиента;</li>
<li>время ожидания в секундах;</li>
<li>
<code>yes</code> — бесконечное ожидание, соединение автоматически разрываться не будет.</li>
</ul>
</li></ul>
<ul><li>Время входа можно сократить, если пропустить поиск заголовков IPv6. Для этого используйте опции <code>AddressFamily inet</code> или флаг <code>-4</code>.</li></ul>
<ul><li>Наконец, если вы собираетесь использовать SSH для SFTP или SCP, <a rel="nofollow" class="external text" href="https://www.psc.edu/index.php/hpn-ssh">High Performance SSH/SCP</a> поможет значительно увеличить пропускную способность с помощью динамического изменения размера буфера SSH. Установите пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/openssh-hpn-git/">openssh-hpn-git</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" class="mw-redirect" title="ArchWiki:Requests">ссылка недействительна</a>: package not found]</sup>, чтобы использовать OpenSSH с этим расширением.</li></ul>
<h3>
<span id=".D0.9C.D0.BE.D0.BD.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D1.83.D0.B4.D0.B0.D0.BB.D1.91.D0.BD.D0.BD.D1.8B.D1.85_.D1.84.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2.D1.8B.D1.85_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC_.D0.BF.D1.80.D0.B8_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D0.B8_SSHFS"></span><span class="mw-headline" id="Монтирование_удалённых_файловых_систем_при_помощи_SSHFS">Монтирование удалённых файловых систем при помощи SSHFS</span>
</h3>
<p>В статье <a href="../ru/SSHFS.html" title="SSHFS (Русский)">SSHFS</a> описано, как использовать SSH для монтирования удалённых файловых систем в локальный каталог, чтобы иметь возможность выполнять любые операции над смонтированными файлами (копирование, переименование, редактирование в vim и т.д.). Предпочтительнее использовать <i>sshfs</i>, а не <i>shfs</i>, поскольку последний не обновлялся с 2004 года.
</p>
<h3>
<span id=".D0.9F.D0.BE.D0.B4.D0.B4.D0.B5.D1.80.D0.B6.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BF.D0.BE.D0.B4.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D1.8F"></span><span class="mw-headline" id="Поддержание_подключения">Поддержание подключения</span>
</h3>
<p>По умолчанию сеанс связи SSH автоматически разрывается, если соединение не использовалось в течение какого-то времени. Чтобы сохранить сеанс, клиент может посылать сигналы серверу, если не было получено никаких данных за последнее время, или наоборот, сервер может посылать сообщения через определённые временные интервалы, если он не получал данных от клиента.
</p>
<ul>
<li>На <b>сервере</b> параметр <code>ClientAliveInterval</code> задаёт время ожидания в секундах, по истечении которого при отсутствии данных от клиента <i>sshd</i> пошлёт последнему запрос. Значение по умолчанию — 0, "не посылать сообщений". Например, чтобы запрашивать ответ от клиента каждые 60 секунд, задайте параметр <code>ClientAliveInterval 60</code> в <a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_2">настройках сервера</a>. Также обратите внимание на параметры <code>ClientAliveCountMax</code> и <code>TCPKeepAlive</code>.</li>
<li>На <b>клиенте</b> параметр <code>ServerAliveInterval</code> задаёт временной промежуток между запросами на сервер. Например, чтобы посылать запросы каждые 120 секунд, задайте параметр <code>ServerAliveInterval 120</code> в <a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">настройках клиента</a>. Также обратите внимание на параметры <code>ServerAliveCountMax</code> и <code>TCPKeepAlive</code>.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Чтобы сохранять соединение, достаточно настоить отправку запросов либо только на клиенте, либо только на сервере. Если вы под вашим управлением находится одновременно несколько серверов и клиентов, правильнее всего будет задать параметр <code>ServerAliveInterval</code> на клиентах, которым нужно сохранять сеансы, а настройки серверов и остальных клиентов оставить без изменений.
</div>
<h3>
<span id=".D0.90.D0.B2.D1.82.D0.BE.D0.BC.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B9_.D0.BF.D0.B5.D1.80.D0.B5.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA_.D1.82.D1.83.D0.BD.D0.BD.D0.B5.D0.BB.D0.B5.D0.B9_SSH_.D1.81_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_systemd"></span><span class="mw-headline" id="Автоматический_перезапуск_туннелей_SSH_с_помощью_systemd">Автоматический перезапуск туннелей SSH с помощью systemd</span>
</h3>
<p><a href="../ru/Systemd.html" title="Systemd (Русский)">systemd</a> может автоматически создавать SSH-соединения при загрузке/входе в систему, а также перезапускать их при внезапном разрыве соединения.
</p>
<p>Ниже представлен пример службы, которая будет создавать SSH-туннель в соответствии с <a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">настройками SSH</a>. Если соединение было по какой-то причине разорвано, служба подождёт 10 секунд и перезапустит его:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/tunnel.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=SSH tunnel to myserver

[Service]
Type=simple
Restart=always
RestartSec=10
ExecStart=/usr/bin/ssh -F %h/.ssh/config -N myserver
</pre>
<p><a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Запустите/включите">запустите/включите</a> <a href="../ru/Systemd/User.html" class="mw-redirect" title="Systemd/Пользователь">пользовательскую службу</a> systemd. В разделе <a href="#%D0%9F%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D1%8F">#Поддержание подключения</a> описано, как предотвратить разрыв соединения из-за превышения времени ожидания. Если вы захотите запускать туннель при загрузке системы, то придётся <a href="../ru/Systemd.html#%D0%9D%D0%B0%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" title="Systemd (Русский)">переписать юнит</a>, чтобы сделать его системным.
</p>
<h3>
<span id="Autossh_-_.D0.B0.D0.B2.D1.82.D0.BE.D0.BC.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B9_.D0.BF.D0.B5.D1.80.D0.B5.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA_.D1.81.D0.B5.D1.81.D1.81.D0.B8.D0.B9_.D0.B8_.D1.82.D1.83.D0.BD.D0.BD.D0.B5.D0.BB.D0.B5.D0.B9_SSH"></span><span class="mw-headline" id="Autossh_-_автоматический_перезапуск_сессий_и_туннелей_SSH">Autossh - автоматический перезапуск сессий и туннелей SSH</span>
</h3>
<p>Если сессия или туннель не может поддерживаться в активном состоянии, например, из-за плохого подключения к сети и связанных с ним отключений, используйте <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=autossh">autossh</a></span> для автоматического перезапуска.
</p>
<p>Примеры использования:
</p>
<pre>$ autossh -M 0 -o "ServerAliveInterval 45" -o "ServerAliveCountMax 2" <i>имя_пользователя</i>@example.com
</pre>
<p>Совместно с <a href="../ru/SSHFS.html" title="SSHFS (Русский)">SSHFS</a>:
</p>
<pre>$ sshfs -o reconnect,compression=yes,transform_symlinks,ServerAliveInterval=45,ServerAliveCountMax=2,ssh_command='autossh -M 0' <i>имя_пользователя</i>@example.com: /mnt/example
</pre>
<p>Подключение через SOCKS-прокси, сконфигурированный при помощи <a href="../en/Proxy_server.html" class="mw-redirect" title="Proxy settings">настроек proxy</a>:
</p>
<pre>$ autossh -M 0 -o "ServerAliveInterval 45" -o "ServerAliveCountMax 2" -NCD 8080 <i>имя_пользователя</i>@example.com
</pre>
<p>При помощи опции <code>-f</code> autossh может быть запущен в качестве фонового процесса. Однако, в этом случае вы не сможете вводить пароль в интерактивном режиме.
</p>
<p>Сессия будет завершена, как только вы введете команду <code>exit</code>, иначе процесс autossh получит сигнал SIGTERM, SIGINT или SIGKILL.
</p>
<h4>
<span id=".D0.90.D0.B2.D1.82.D0.BE.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA_Autossh_.D0.BF.D1.80.D0.B8_.D0.B7.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.BA.D0.B5_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D1.8B_.D0.BF.D1.80.D0.B8_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D0.B8_systemd"></span><span class="mw-headline" id="Автозапуск_Autossh_при_загрузке_системы_при_помощи_systemd">Автозапуск Autossh при загрузке системы при помощи systemd</span>
</h4>
<p>Если вы хотите, чтобы autossh запускался автоматически, вы можете использовать systemd. Например, вы можете создать файл юнита, подобный этому:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/autossh.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=AutoSSH service for port 2222
After=network.target

[Service]
Environment="AUTOSSH_GATETIME=0"
ExecStart=/usr/bin/autossh -M 0 -NL 2222:localhost:2222 -o TCPKeepAlive=yes foo@bar.com

[Install]
WantedBy=multi-user.target
</pre>
<p>Здесь <code>AUTOSSH_GATETIME=0</code> — это переменная окружения, указывающая, как долго ssh должен быть поднят, прежде чем  autossh утвердит успешное подключение. Установка значения 0 укажет autossh игнорировать неудачное подключение ssh. Это может быть полезно при добавлении autossh в автозагрузку. Другие переменные окружения доступны на справочной странице <span class="plainlinks archwiki-template-man" title="$ man 1 autossh"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/autossh.1">autossh(1)</a></span>. Конечно, вы можете сделать этот юнит более комплексным, если вам это необходимо (для получения дополнительных подробностей смотрите документацию systemd); очевидно, вы можете использовать ваши собственные опции для autossh, но учтите, что флаг <code>-f</code>, подразумевающий <code>AUTOSSH_GATETIME=0</code>, не работает с systemd. 
</p>
<p>Не забудьте <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Запустить">запустить</a> и/или <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Включить">включить</a> службу.
</p>
<p>Мы также можете отключить ControlMaster, например:
</p>
<pre>ExecStart=/usr/bin/autossh -M 0 -o ControlMaster=no -NL 2222:localhost:2222 -o TCPKeepAlive=yes foo@bar.com
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Можно создать несколько процессов autossh, если нужно поддерживать несколько туннелей. Просто создайте нужное количество файлов служб с разными именами.
</div>
<h3>
<span id=".D0.90.D0.BB.D1.8C.D1.82.D0.B5.D1.80.D0.BD.D0.B0.D1.82.D0.B8.D0.B2.D0.B0_.D0.BD.D0.B0_.D1.81.D0.BB.D1.83.D1.87.D0.B0.D0.B9_.D0.BD.D0.B5.D0.B2.D0.BE.D0.B7.D0.BC.D0.BE.D0.B6.D0.BD.D0.BE.D1.81.D1.82.D0.B8_.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D1.82.D0.B8.D1.82.D1.8C_.D0.B4.D0.B5.D0.BC.D0.BE.D0.BD_SSH"></span><span class="mw-headline" id="Альтернатива_на_случай_невозможности_запустить_демон_SSH">Альтернатива на случай невозможности запустить демон SSH</span>
</h3>
<p>Для удалённых или <a href="https://en.wikipedia.org/wiki/Headless_computer" class="extiw" title="wikipedia:Headless computer">headless</a>-серверов, которые полагаются исключительно на SSH, сбой запуска демона SSH (например, после обновления системы) может означать невозможность осуществлять администрирование. <a href="../ru/Systemd.html" title="Systemd (Русский)">Systemd</a> в этом случае может помочь, если воспользоваться опцией <code>OnFailure</code>.
</p>
<p>Предположим, что на сервере работает <code>sshd</code>, а качестве запасного варианта выбран <a href="../en/Telnet.html" title="Telnet">telnet</a>. Создайте файл, который показан ниже. <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Включите">Включать</a> <code>telnet.socket</code> <b>не надо</b>!
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/sshd.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
OnFailure=telnet.socket
</pre>
<p>Это всё. Telnet не будет работать, если запущен <code>sshd</code>. Если же <code>sshd</code> не запустится, то можно будет создать сеанс telnet для устранения неисправностей.
</p>
<h3>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D1.86.D0.B2.D0.B5.D1.82.D0.B0_.D1.84.D0.BE.D0.BD.D0.B0_.D1.82.D0.B5.D1.80.D0.BC.D0.B8.D0.BD.D0.B0.D0.BB.D0.B0_.D0.B4.D0.BB.D1.8F_.D1.83.D0.B4.D0.B0.D0.BB.D1.91.D0.BD.D0.BD.D0.BE.D0.B3.D0.BE_.D1.85.D0.BE.D1.81.D1.82.D0.B0"></span><span class="mw-headline" id="Настройка_цвета_фона_терминала_для_удалённого_хоста">Настройка цвета фона терминала для удалённого хоста</span>
</h3>
<p>Чтобы проще было понять, на каком хосте вы сейчас работаете, можно <a rel="nofollow" class="external text" href="https://bryangilbert.com/post/etc/term/dynamic-ssh-terminal-background-colors/">задать фон терминала для каждой машины</a>.
</p>
<p>К сожалению, это работает не для всех терминалов (только для <a href="../ru/Zsh.html" title="Zsh (Русский)">Zsh</a>).
</p>
<h3>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D0.B4.D0.BB.D1.8F_.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D1.8B_.D0.B2_.D0.BA.D0.BE.D0.BD.D0.BA.D1.80.D0.B5.D1.82.D0.BD.D0.BE.D0.B9_.D1.81.D0.B5.D1.82.D0.B8"></span><span class="mw-headline" id="Настройка_для_работы_в_конкретной_сети">Настройка для работы в конкретной сети</span>
</h3>
<p>С помощью параметра <code>Match exec</code> можно создавать настройки хостов для работы в конктретных сетях.
</p>
<p>Например, если используется <i>nmcli</i> и соединение настроено (вручную или с помощью DHCP) на использование search-domain:
</p>
<pre>Match exec "nmcli | grep domains: | grep example.com"
  CanonicalDomains example.com
  # Should you use a different username on this network
  #User username
  # Use a different known_hosts file (for private network or synchronisation)
  #UserKnownHostsFile &lt;network&gt;_known_hosts
</pre>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9_.D1.85.D0.BE.D1.81.D1.82.D0.BE.D0.B2_.D0.B2_.D0.BB.D0.BE.D0.BA.D0.B0.D0.BB.D1.8C.D0.BD.D1.8B.D1.85_.D1.81.D0.B5.D1.82.D1.8F.D1.85"></span><span class="mw-headline" id="Проверка_ключей_хостов_в_локальных_сетях">Проверка ключей хостов в локальных сетях</span>
</h3>
<p>У серверов, находящихся в разных приватных сетях, IP-адреса могут совпадать. Нужен какой-то способ их различать.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> "Лучшее решение" не должно представлять собой совет воспользоваться чем-то другим.
 (Discuss in <a rel="nofollow" class="external text" href="../ru/Talk:OpenSSH.html">Talk:OpenSSH (Русский)</a>)</div>
</div>
<p>Лучшим решением будет воспользоваться рекомендациями из раздела <a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%B4%D0%BB%D1%8F_%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B_%D0%B2_%D0%BA%D0%BE%D0%BD%D0%BA%D1%80%D0%B5%D1%82%D0%BD%D0%BE%D0%B9_%D1%81%D0%B5%D1%82%D0%B8">#Настройка для работы в конкретной сети</a> и использовать разные параметры <code>UserKnownHostsFile</code> для разных сетей. Второй способ лучше использовать, если вы работаете в новых или экспериментальных сетях — просто игнорируйте ключи хостов (hostkeys) для приватных сетей:
</p>
<pre>Host 10.* 192.168.*.* 172.31.* 172.30.* 172.2?.* 172.1?.*
    # Disable HostKey verification
    # Trust HostKey automatically
    StrictHostKeyChecking no
    # Do not save the HostKey
    UserKnownHostsFile=/dev/null
    # Do not display: "Warning: Permanently Added ..."
    LogLevel Error
</pre>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> В файл <code>known_hosts</code> записывается IP-адрес даже в том случае, если вы используете имя хоста для доступа на сервер.
 (Discuss in <a rel="nofollow" class="external text" href="../ru/Talk:OpenSSH.html">Talk:OpenSSH (Русский)</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> В рабочих сетях используйте только имя хоста для удалённого доступа к нему и/или используйте отдельный файл <code>known_hosts</code> для каждой сети.
</div>
<h3>
<span id=".D0.92.D1.8B.D0.BF.D0.BE.D0.BB.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BA.D0.BE.D0.BC.D0.B0.D0.BD.D0.B4_.D0.B2.D0.BE_.D0.B2.D1.80.D0.B5.D0.BC.D1.8F_.D0.B2.D1.85.D0.BE.D0.B4.D0.B0"></span><span class="mw-headline" id="Выполнение_команд_во_время_входа">Выполнение команд во время входа</span>
</h3>
<p>Если вы работаете в интерактивном сеансе, существует несколько способов выполнить команду при входе в систему:
</p>
<ul>
<li>отредактируйте файл <code>authorized_keys</code> на удалённом хосте (см. <span class="plainlinks archwiki-template-man" title="$ man 8 sshd"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sshd.8#AUTHORIZED_KEYS_FILE_FORMAT">sshd(8) § AUTHORIZED_KEYS FILE FORMAT</a></span>);</li>
<li>отредактируйте файл <code>~/.ssh/rc</code> на удалённом хосте, если сервер работает с включённой опцией <code>PermitUserRC</code>;</li>
<li>отредактируйте файл настроек командной оболочки, например, <code>.bashrc</code>.</li>
</ul>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B1.D1.80.D0.BE.D1.81_SSH-.D0.B0.D0.B3.D0.B5.D0.BD.D1.82.D0.B0"></span><span class="mw-headline" id="Проброс_SSH-агента">Проброс SSH-агента</span>
</h3>
<p>Проброс SSH-агента позволяет использовать ваши локальные ключи при подключении к серверу. Рекомендуется включать проброс агента только для отдельных хостов.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.ssh/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Host <i>мойсервер.com</i>
    ForwardAgent yes
</pre>
<p>После этого настройте <a href="../en/SSH_keys.html#SSH_agents" title="SSH keys">агент SSH</a> и добавьте ваши локальные ключи утилитой <i>ssh-add</i>.
</p>
<p>Теперь после подключения к удалённому серверу вы сможете работать с другими службами с помощью локальных ключей.
</p>
<h2>
<span id=".D0.A0.D0.B5.D1.88.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC"></span><span class="mw-headline" id="Решение_проблем">Решение проблем</span>
</h2>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0"></span><span class="mw-headline" id="Проверка">Проверка</span>
</h3>
<p>Проверьте следующие моменты, прежде чем искать решение проблем.
</p>
<ol>
<li>Каталог с настройками <code>~/.ssh</code> и его содержимое должно быть доступно только пользователю (проверьте и клиент, и сервер), а также права на запись в домашнем каталоге должны быть только у пользователя: <pre>$ chmod go-w ~
$ chmod 700 ~/.ssh
$ chmod 600 ~/.ssh/*
$ chown -R $USER ~/.ssh
</pre>
</li>
<li>Убедитесь, что открытый ключ клиента (например, <code>id_rsa.pub</code>) указан в файле <code>~/.ssh/authorized_keys</code> на сервере;</li>
<li>Убедитесь, что вы не ограничили доступ через SSH параметрами <code>AllowUsers</code> и <code>AllowGroups</code> в <a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_2">настройках сервера</a>;</li>
<li>Проверьте, установил ли пользователь пароль. Иногда новые пользователи не устанавливают пароль до первого входа в систему;</li>
<li>Добавьте параметр <code>LogLevel DEBUG</code> в файл <code>/etc/ssh/sshd_config</code>;</li>
<li>Изучите вывод команды <code>journalctl -xe</code> (запускается с правами root) на предмет сообщений об ошибках;</li>
<li>
<a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">Перезапустите</a> демон <code>sshd</code> и выполните выход/вход на клиенте и сервере.</li>
</ol>
<h3>
<span id=".D0.9F.D0.BE.D0.B4.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BE.D1.82.D0.BA.D0.BB.D0.BE.D0.BD.D0.B5.D0.BD.D0.BE_.D0.B8.D0.BB.D0.B8_.D0.BF.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC.D0.B0_.D1.82.D0.B0.D0.B9.D0.BC-.D0.B0.D1.83.D1.82.D0.B0"></span><span class="mw-headline" id="Подключение_отклонено_или_проблема_тайм-аута">Подключение отклонено или проблема тайм-аута</span>
</h3>
<h4>
<span id=".D0.9F.D1.80.D0.BE.D0.B1.D1.80.D0.BE.D1.81_.D0.BF.D0.BE.D1.80.D1.82.D0.BE.D0.B2"></span><span class="mw-headline" id="Проброс_портов">Проброс портов</span>
</h4>
<p>Если ваша машина находится за NAT или маршрутизатором (скорее всего так и есть, если речь не идёт о VPS или хосте с публичным IP-адресом), убедитесь, что маршрутизатор пробрасывает входящие SSH-соединения на неё. Узнайте внутренний IP-адрес сервера командой <code>ip addr</code> и настройте маршрутизатор пробрасывать TCP на SSH-порт этого адреса. Подробности смотри на <a rel="nofollow" class="external text" href="https://portforward.com">portforward.com</a>.
</p>
<h4>
<span id="SSH_.D0.B7.D0.B0.D0.BF.D1.83.D1.89.D0.B5.D0.BD_.D0.B8_.D0.BF.D1.80.D0.BE.D1.81.D0.BB.D1.83.D1.88.D0.B8.D0.B2.D0.B0.D0.B5.D1.82.3F"></span><span class="mw-headline" id="SSH_запущен_и_прослушивает?">SSH запущен и прослушивает?</span>
</h4>
<p>Утилита <i>ss</i> покажет все процессы, прослушивающие TCP-порты:
</p>
<pre>$ ss --tcp --listening
</pre>
<p>Если в выводе окажется, что система не прослушивает порт <code>ssh</code>, то SSH не запущен: проверьте <a href="../ru/Systemd/Journal.html" class="mw-redirect" title="Systemd/Журнал">журнал</a> на предмет сообщений об ошибках.
</p>
<h4>
<span id=".D0.98.D0.BC.D0.B5.D1.8E.D1.82.D1.81.D1.8F_.D0.BB.D0.B8_.D0.BF.D1.80.D0.B0.D0.B2.D0.B8.D0.BB.D0.B0_.D1.84.D0.B0.D0.B5.D1.80.D0.B2.D0.BE.D0.BB.D0.B0.2C_.D0.B1.D0.BB.D0.BE.D0.BA.D0.B8.D1.80.D1.83.D1.8E.D1.89.D0.B8.D0.B5_.D1.81.D0.BE.D0.B5.D0.B4.D0.B8.D0.BD.D0.B5.D0.BD.D0.B8.D1.8F.3F"></span><span class="mw-headline" id="Имеются_ли_правила_фаервола,_блокирующие_соединения?">Имеются ли правила фаервола, блокирующие соединения?</span>
</h4>
<p><a href="../ru/Iptables.html" title="Iptables (Русский)">Iptables</a> может блокировать подключения к порту <code>22</code>. Проверьте это следующей командой:
</p>
<pre># iptables -nvL
</pre>
<p>Просмотрите вывод на предмет правил, которые могут блокировать нужные вам пакеты (цепочка <code>INPUT</code>). Затем, если необходимо, разблокируйте порт командой вида:
</p>
<pre># iptables -I INPUT 1 -p tcp --dport 22 -j ACCEPT
</pre>
<p>Информацию по настройке межсетевых экранов можно найти в разделе <a href="../ru/Category:Firewalls.html" class="mw-redirect" title="Файрвол">Файрвол</a>.
</p>
<h4>
<span id=".D0.A2.D1.80.D0.B0.D1.84.D0.B8.D0.BA_.D0.B4.D0.BE.D1.85.D0.BE.D0.B4.D0.B8.D1.82_.D0.B4.D0.BE_.D0.B2.D0.B0.D1.88.D0.B5.D0.B3.D0.BE_.D0.BA.D0.BE.D0.BC.D0.BF.D1.8C.D1.8E.D1.82.D0.B5.D1.80.D0.B0.3F"></span><span class="mw-headline" id="Трафик_доходит_до_вашего_компьютера?">Трафик доходит до вашего компьютера?</span>
</h4>
<p>Запустите дамп трафика на компьютере, с которым возникли проблемы:
</p>
<pre># tcpdump -lnn -i any port ssh and tcp-syn
</pre>
<p>Будет показана некоторая базовая информация. Подождите совпадения. После этого попробуйте подключиться вновь. Если вы не видите никакого вывода команды, когда вы пытаетесь подключиться, это значит, что что-то вне вашего компьютера блокирует трафик (это может быть аппаратный фаерволл, роутер NAT и т.д.).
</p>
<h4>
<span id=".D0.92.D0.B0.D1.88_.D0.BF.D1.80.D0.BE.D0.B2.D0.B0.D0.B9.D0.B4.D0.B5.D1.80_.D0.B8.D0.BB.D0.B8_.D0.BA.D1.82.D0.BE-.D1.82.D0.BE_.D0.B5.D1.89.D0.B5_.D0.B1.D0.BB.D0.BE.D0.BA.D0.B8.D1.80.D1.83.D0.B5.D1.82_.D0.BD.D1.83.D0.B6.D0.BD.D1.8B.D0.B9_.D0.BF.D0.BE.D1.80.D1.82.3F"></span><span class="mw-headline" id="Ваш_провайдер_или_кто-то_еще_блокирует_нужный_порт?">Ваш провайдер или кто-то еще блокирует нужный порт?</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Пробуйте этот шаг в том случае, если вы <b>знаете</b>, что у вас не запущено никаких фаерволлов, и что вы настроили роутер на DMZ или проброс портов на компьютер. Здесь вы найдете рекомендации по диагностике и возможные решения.
</div>
<p>В некоторых случаях провайдер может блокировать порт по умолчанию (SSH порт 22). Чтобы это проверить, создайте сервер на всех интерфейсах (0.0.0.0) и подключитесь удаленно.
</p>
<p>Если вы получите сообщение об ошибке вроде этого:
</p>
<pre>ssh: connect to host www.inet.hr port 22: Connection refused
</pre>
<p>это означает, что порт <b>не</b> был заблокирован провайдером: просто на сервере не запущен SSH для этого порта (смотрите статью <a href="https://en.wikipedia.org/wiki/ru:%D0%91%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C_%D1%87%D0%B5%D1%80%D0%B5%D0%B7_%D0%BD%D0%B5%D1%8F%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C" class="extiw" title="wikipedia:ru:Безопасность через неясность">Безопасность через неясность</a>).
</p>
<p>Однако, если вы получите сообщение об ошибке вроде этого:
</p>
<pre>ssh: connect to host 111.222.333.444 port 22: Operation timed out 
</pre>
<p>это означает, что что-то отклоняет ваш трафик TCP, предназначенный для порта 22. Как правило, этот порт скрыт либо вашим фаерволлом, либо третьей стороной (например, провайдером, блокирующим и/или отклоняющим входящий трафик на порт 22). Если вы знаете, что фаерволл на вашем компьютере не запущен и Гремлины не размножаются на ваших роутерах и свитчах, это означает, что провайдер блокирует трафик.
</p>
<p>Чтобы убедиться в этом, вы можете запустить Wireshark на сервере и "прослушать" трафик, предназначенный для порта 22. Поскольку Wireshark является утилитой анализа трафика на уровне 2 , а TCP/UDP используют уровень 3 и выше (смотрите статью <a href="https://en.wikipedia.org/wiki/ru:TCP/IP" class="extiw" title="wikipedia:ru:TCP/IP">TCP/IP</a>), если вы ничего не получаете при создании удаленного подключения, вероятнее всего, что третья сторона блокирует трафик для этого порта на вашем сервере.
</p>
<h5>
<span id=".D0.94.D0.B8.D0.B0.D0.B3.D0.BD.D0.BE.D1.81.D1.82.D0.B8.D0.BA.D0.B0"></span><span class="mw-headline" id="Диагностика">Диагностика</span>
</h5>
<p><a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">Установите</a> либо <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tcpdump">tcpdump</a></span>, либо Wireshark из пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=wireshark-cli">wireshark-cli</a></span>.
</p>
<p>Для tcpdump:
</p>
<pre># tcpdump -ni <i>интерфейс</i> "port 22"
</pre>
<p>Для Wireshark:
</p>
<pre>$ tshark -f "tcp port 22" -i <i>интерфейс</i>
</pre>
<p>где <i>интерфейс</i> — сетевой интерфейс для соединения WAN (для проверки выполните <code>ip a</code>). Если вы не получаете никаких пакетов при попытке удаленного подключения, можете быть уверены, что ваш провайдер блокирует входящий на порт 22 трафик.
</p>
<h5>
<span id=".D0.92.D0.BE.D0.B7.D0.BC.D0.BE.D0.B6.D0.BD.D0.BE.D0.B5_.D1.80.D0.B5.D1.88.D0.B5.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Возможное_решение">Возможное решение</span>
</h5>
<p>Вы можете просто использовать другой порт, который провайдером не блокируется. Откройте файл <code>/etc/ssh/sshd_config</code> и укажите другой порт. Например, добавьте:
</p>
<pre>Port 22
Port 1234
</pre>
<p>Также удостоверьтесь, что другие строки "Port" закомментированы. Если просто закомментировать строку "Port 22" и прописать "Port 1234", проблема не будет решена, поскольку sshd будет прослушивать лишь порт 1234. Используйте обе строки для запуска сервера SSH на обоих портах.
</p>
<p><a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">Перезапустите</a> сервер <code>sshd.service</code>. Готово! Теперь вам необходимо настроить ваш(и) клиент(ы) на использование другого порта.
</p>
<h4><span class="mw-headline" id="Read_from_socket_failed:_connection_reset_by_peer">Read from socket failed: connection reset by peer</span></h4>
<p>Последние версии openssh иногда выдают подобное сообщение при попытке подключения к старым SSH-серверам. Это можно обойти с помощью различных <a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">параметров клиента</a> (подробнее см. <span class="plainlinks archwiki-template-man" title="$ man 5 ssh_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh_config.5">ssh_config(5)</a></span>).
</p>
<p>Причиной проблемы может быть алгоритм эллиптических кривых <code>ecdsa-sha2-nistp*-cert-v01@openssh</code>. Его можно отключить, удалив название алгоритма из списка <code>HostKeyAlgorithms</code>.
</p>
<p>Если это не помогло, возможно, список алгоритмов слишком длинен. Укажите в параметре <code>Ciphers</code> менее длинный список (короче 80 символов). Аналогично можно попробовать сократить список <code>MACs</code>.
</p>
<p>Также стоит изучить <a rel="nofollow" class="external text" href="https://lists.gt.net/openssh/dev/51339">обсуждение</a><sup title="Статус последней проверки: domain name not resolved">[<a href="https://en.wikipedia.org/wiki/ru:%D0%92%D0%B8%D0%BA%D0%B8%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F:%D0%9C%D1%91%D1%80%D1%82%D0%B2%D1%8B%D0%B5_%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8" class="extiw" title="wikipedia:ru:Википедия:Мёртвые ссылки">устаревшая ссылка</a> 2024-07-30 ⓘ]</sup> на форуме openssh.
</p>
<h3>
<span id=".22.5B.D0.B2.D0.B0.D1.88.D0.B0_.D0.BA.D0.BE.D0.BC.D0.B0.D0.BD.D0.B4.D0.BD.D0.B0.D1.8F_.D0.BE.D0.B1.D0.BE.D0.BB.D0.BE.D1.87.D0.BA.D0.B0.5D:_No_such_file_or_directory.22_.2F_ssh_exchange_identification_problem"></span><span class="mw-headline" id='"[ваша_командная_оболочка]:_No_such_file_or_directory"_/_ssh_exchange_identification_problem'>"[ваша командная оболочка]: No such file or directory" / ssh_exchange_identification problem</span>
</h3>
<p>Одна из возможных причин - необходимость найти абсолютный путь (который возвращает команда <code>whereis -b [ваша командная оболочка]</code>, например) в <code>$SHELL</code>, даже если бинарный пакет вашего интерпретатора находится в одной из записей <code>$PATH</code>.
</p>
<h3>
<span id=".D0.9E.D1.88.D0.B8.D0.B1.D0.BA.D0.B8_.22Terminal_unknown.22_.D0.B8_.22Error_opening_terminal.22"></span><span class="mw-headline" id='Ошибки_"Terminal_unknown"_и_"Error_opening_terminal"'>Ошибки "Terminal unknown" и "Error opening terminal"</span>
</h3>
<p>Если вы получаете одну из таких ошибок во время входа, это значит, что сервер не может распознать ваш терминал. Приложения ncurses вроде nano могут не запуститься, выдав сообщение "Error opening terminal".
</p>
<p>Правильным решением будет установить файл terminfo клиентского терминала на сервер. Тогда консольные программы на сервере будут знать, как правильно взаимодействовать с вашим терминалом. Информацию о текущем terminfo можно получить с помощью команды <code>infocmp</code>, после чего нужно выяснить, <a href="../ru/Pacman.html#%D0%97%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D1%8B_%D0%BA_%D0%B1%D0%B0%D0%B7%D0%B0%D0%BC_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" title="Pacman (Русский)">какому пакету он принадлежит</a>.
</p>
<p>Если <a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">установить</a> файл нормально не удаётся, скопируйте его в домашний каталог на сервере:
</p>
<pre>$ ssh myserver mkdir -p  ~/.terminfo/${TERM:0:1}
$ scp /usr/share/terminfo/${TERM:0:1}/$TERM myserver:~/.terminfo/${TERM:0:1}/
</pre>
<p>После выхода и отключения от сервера проблема должна решиться.
</p>
<h4>
<span id=".D0.A5.D0.B0.D0.BA_.24TERM"></span><span class="mw-headline" id="Хак_$TERM">Хак $TERM</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Это должно быть последним средством.
</div>
<p>Можно задать переменную окружения сервера <code>TERM=xterm</code> (например, в файле <code>.bash_profile</code>). Это заглушит сообщения об ошибках и позволит запуститься приложениям ncurses, но результатом может стать странное поведение и графические баги — кроме случая, если контрольные последовательности вашего терминала совпадают с таковыми у xterm.
</p>
<h3>
<span id=".D0.9E.D1.88.D0.B8.D0.B1.D0.BA.D0.B0_Connection_closed_by_x.x.x.x_.5Bpreauth.5D"></span><span class="mw-headline" id="Ошибка_Connection_closed_by_x.x.x.x_[preauth]">Ошибка Connection closed by x.x.x.x [preauth]</span>
</h3>
<p>Если вы получили такое сообщение об ошибке, убедитесь, что настроен верный HostKey:
</p>
<pre>HostKey /etc/ssh/ssh_host_rsa_key
</pre>
<h3>
<span id="id_dsa_.D0.BD.D0.B5_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D1.83.D0.B5.D1.82.D1.81.D1.8F_.D0.B2_OpenSSH_7.0"></span><span class="mw-headline" id="id_dsa_не_используется_в_OpenSSH_7.0">id_dsa не используется в OpenSSH 7.0</span>
</h3>
<p>OpenSSH 7.0 прекратил использование открытых ключей DSA из соображений безопасности. Если вам очень нужно именно эти ключи, воспольуйтесь <a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">опцией</a> <code>PubkeyAcceptedKeyTypes +ssh-dss</code> (на странице <a rel="nofollow" class="external free" href="https://www.openssh.com/legacy.html">https://www.openssh.com/legacy.html</a> она не упомянута).
</p>
<h3>
<span id=".D0.9D.D0.B5_.D1.83.D0.B4.D0.B0.D1.91.D1.82.D1.81.D1.8F_.D0.BF.D0.BE.D0.B4.D0.BE.D0.B1.D1.80.D0.B0.D1.82.D1.8C_.D1.81.D0.BF.D0.BE.D1.81.D0.BE.D0.B1_.D0.BE.D0.B1.D0.BC.D0.B5.D0.BD.D0.B0_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0.D0.BC.D0.B8_.D0.B2_OpenSSH_7.0"></span><span class="mw-headline" id="Не_удаётся_подобрать_способ_обмена_ключами_в_OpenSSH_7.0">Не удаётся подобрать способ обмена ключами в OpenSSH 7.0</span>
</h3>
<p>OpenSSH 7.0 прекратил использование алгоритма diffie-hellman-group1-sha1, поскольку он ненадёжный и теоретически может быть взломан т.н. атакой Logjam (см. <a rel="nofollow" class="external free" href="https://www.openssh.com/legacy.html">https://www.openssh.com/legacy.html</a>). Если этот алгоритм будет нужен какому-то хосту, ssh выдаст соощение об ошибке следующего содержания:
</p>
<pre>Unable to negotiate with 127.0.0.1: no matching key exchange method found.
Their offer: diffie-hellman-group1-sha1
</pre>
<p>Лучшим решением будет обновить сервер и отключить использование устаревших алгоритмов. Если это сделать невозможно, вы можете заставить клиент включить алгоритм <a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">параметром</a> <code>KexAlgorithms +diffie-hellman-group1-sha1</code>.
</p>
<h3>
<span id=".D0.A1.D0.B5.D0.B0.D0.BD.D1.81_tmux.2Fscreen_.D0.BF.D1.80.D0.B5.D1.80.D1.8B.D0.B2.D0.B0.D0.B5.D1.82.D1.81.D1.8F_.D0.BF.D1.80.D0.B8_.D1.80.D0.B0.D0.B7.D1.80.D1.8B.D0.B2.D0.B5_.D1.81.D0.BE.D0.B5.D0.B4.D0.B8.D0.BD.D0.B5.D0.BD.D0.B8.D1.8F_SSH"></span><span class="mw-headline" id="Сеанс_tmux/screen_прерывается_при_разрыве_соединения_SSH">Сеанс tmux/screen прерывается при разрыве соединения SSH</span>
</h3>
<p>Если ваши процессы прерываются при завершении сеанса SSH, возможно, что вы используете активацию сокета и <a href="../ru/Systemd.html" title="Systemd (Русский)">systemd</a> принудительно её убивает. В этом случае есть два решения. Первый — не использовать активацию сокета и заменить <code>ssh.socket</code> на <code>ssh.service</code>. Второй — задать параметр <code>KillMode=process</code> в разделе <code>Service</code> файла <code>ssh@.service</code>.
</p>
<p>Параметр <code>KillMode=process</code> может также быть полезен при работе с классическим <code>ssh.service</code>, т.к. он не позволяет убить процесс сессии SSH или процессы <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=screen">screen</a></span> и <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tmux">tmux</a></span> при остановке или перезагрузке сервера.
</p>
<h3>
<span id=".D0.A1.D0.B5.D0.B0.D0.BD.D1.81_SSH_.D0.BD.D0.B5_.D0.BE.D1.82.D0.B2.D0.B5.D1.87.D0.B0.D0.B5.D1.82"></span><span class="mw-headline" id="Сеанс_SSH_не_отвечает">Сеанс SSH не отвечает</span>
</h3>
<p>SSH реагирует на <a href="https://en.wikipedia.org/wiki/Software_flow_control" class="extiw" title="wikipedia:Software flow control">команды управления</a> <code>XON</code> и <code>XOFF</code>. Он остановится, если вы случайно нажали <code>Ctrl+s</code>. Нажмите <code>Ctrl+q</code>, чтобы продолжить сеанс.
</p>
<h3><span class="mw-headline" id="Broken_pipe">Broken pipe</span></h3>
<p>Если вы пытаетесь установить соединение и получаете ответ <code>Broken pipe</code> на <code>packet_write_wait</code>, попробуйте подключиться в режиме отладки. Посмотрите, если ли в выводе сообщений об ошибках:
</p>
<pre>debug3: send packet: type 1
packet_write_wait: Connection to A.B.C.D port 22: Broken pipe
</pre>
<p>Строчка <code>send packet</code> указывает на то, что ответный пакет получен не был. Следовательно, проблема заключается в <i>QoS</i>. Чтобы уменьшить потерю пакетов, задайте значение параметра <code>IPQoS</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/ssh_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Host *
    IPQoS reliability
</pre>
<p>Значение <code>reliability</code> (<code>0x04</code>) должно решить проблему. Также можно задать значения <code>0x00</code> и <code>throughput</code> (<code>0x08</code>).
</p>
<h3>
<span id=".D0.94.D0.B5.D0.BC.D0.BE.D0.BD_.D0.BC.D0.B5.D0.B4.D0.BB.D0.B5.D0.BD.D0.BD.D0.BE_.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA.D0.B0.D0.B5.D1.82.D1.81.D1.8F_.D0.BF.D0.BE.D1.81.D0.BB.D0.B5_.D0.BF.D0.B5.D1.80.D0.B5.D0.B7.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.BA.D0.B8"></span><span class="mw-headline" id="Демон_медленно_запускается_после_перезагрузки">Демон медленно запускается после перезагрузки</span>
</h3>
<p>Если демон запускается необычно долго после перезагрузки (несколько минут), особенно для headless- и виртуализированных серверов, это может быть связано с нехваткой энтропии <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=241954">[8]</a>. Для решения этой проблемы установите <a href="../en/Rng-tools.html" title="Rng-tools">Rng-tools</a> или <a href="../ru/Haveged.html" title="Haveged (Русский)">Haveged</a>. Однако обратите внимание на вопросы безопасности, которые обсуждаются в посвящённых этим утилитам статьях.
</p>
<h3>
<span id=".D0.97.D0.B0.D0.B2.D0.B5.D1.80.D1.88.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BD.D0.B5.D0.BE.D1.82.D0.B2.D0.B5.D1.87.D0.B0.D1.8E.D1.89.D0.B5.D0.B3.D0.BE_SSH-.D1.81.D0.BE.D0.B5.D0.B4.D0.B8.D0.BD.D0.B5.D0.BD.D0.B8.D1.8F"></span><span class="mw-headline" id="Завершение_неотвечающего_SSH-соединения">Завершение неотвечающего SSH-соединения</span>
</h3>
<p>Если клиентский сеанс больше не отвечает и не завершается командами вызвавшей программы (например, <a href="../ru/Command-line_shell.html" title="Command-line shell (Русский)">командной оболочки</a>), то завершить его можно последовательным нажатием клавиш <code>Enter</code>, <code>~</code> и <code>.</code>.
</p>
<p><code>~</code> является управляющей последовательностью псевдотерминала (см. <span class="plainlinks archwiki-template-man" title="$ man 1 ssh"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh.1#ESCAPE_CHARACTERS">ssh(1) § ESCAPE CHARACTERS</a></span>), которую можно нажимать несколько раз в зависимости от того, какой сеанс необходимо завершить. Например, если вы установили соединение от А к Б, а затем от Б к В, и сеанс Б-В больше не отзывается, завершить его можно нажав <code>Enter</code> и введя <code>~~.</code>. После этого останется только рабочий сеанс с Б.
</p>
<h3>
<span id="WARNING:_REMOTE_HOST_IDENTIFICATION_HAS_CHANGED.21"></span><span class="mw-headline" id="WARNING:_REMOTE_HOST_IDENTIFICATION_HAS_CHANGED!">WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!</span>
</h3>
<p>Если клиент выдаёт предупреждение, что ключ ssh-сервера изменился, убедитесь, что новый ключ действительно принадлежит оператору сервера. Если всё в порядке, удалите старый ключ из файла <code>known_hosts</code> командой <code>ssh-keygen -R $SSH_HOST</code> и используйте новый.
</p>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.la-samhna.de/library/brutessh.html">Защита от атак перебором</a></li>
<li>Управление ключами OpenSSH: <a rel="nofollow" class="external text" href="https://developer.ibm.com/articles/l-keyc/">Часть 1</a> на IBM developerWorks, <a href="https://www.funtoo.org/OpenSSH_Key_Management,_Part_2" class="extiw" title="funtoo:OpenSSH Key Management, Part 2">Часть 2</a> и <a href="https://www.funtoo.org/OpenSSH_Key_Management,_Part_3" class="extiw" title="funtoo:OpenSSH Key Management, Part 3">Часть 3</a> на funtoo.org</li>
<li><a rel="nofollow" class="external text" href="https://stribika.github.io/2015/01/04/secure-secure-shell.html">Secure Secure Shell</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../ru/Category:Secure_Shell.html" title="Category:Secure Shell (Русский)">Secure Shell (Русский)</a></li>
<li><a href="../ru/Category:Servers.html" title="Category:Servers (Русский)">Servers (Русский)</a></li>
<li><a href="../ru/Category:OpenBSD.html" title="Category:OpenBSD (Русский)">OpenBSD (Русский)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=OpenSSH_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=813426">https://wiki.archlinux.org/index.php?title=OpenSSH_(Русский)&amp;oldid=813426</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 30 July 2024, at 15:06.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
