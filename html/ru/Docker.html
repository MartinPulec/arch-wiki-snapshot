<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Docker (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Docker_Русский rootpage-Docker_Русский skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Установка" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Установка</div>
		</a>
		
			<button aria-controls="toc-Установка-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Установка subsection</span>
			</button>
		
		<ul id="toc-Установка-sublist" class="vector-toc-list">
			<li id="toc-Docker_Compose" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Docker_Compose">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Docker Compose</div>
			</a>
			
			<ul id="toc-Docker_Compose-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Docker_Desktop" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Docker_Desktop">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Docker Desktop</div>
			</a>
			
			<ul id="toc-Docker_Desktop-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Использование" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Использование</div>
		</a>
		
		<ul id="toc-Использование-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Настройка" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Настройка</div>
		</a>
		
			<button aria-controls="toc-Настройка-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Настройка subsection</span>
			</button>
		
		<ul id="toc-Настройка-sublist" class="vector-toc-list">
			<li id="toc-Драйвер_хранения" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%94%D1%80%D0%B0%D0%B9%D0%B2%D0%B5%D1%80_%D1%85%D1%80%D0%B0%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Драйвер хранения</div>
			</a>
			
			<ul id="toc-Драйвер_хранения-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Сокет_демона" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%BE%D0%BA%D0%B5%D1%82_%D0%B4%D0%B5%D0%BC%D0%BE%D0%BD%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Сокет демона</div>
			</a>
			
			<ul id="toc-Сокет_демона-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-HTTP-прокси" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#HTTP-%D0%BF%D1%80%D0%BE%D0%BA%D1%81%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>HTTP-прокси</div>
			</a>
			
			<ul id="toc-HTTP-прокси-sublist" class="vector-toc-list">
				<li id="toc-Настройка_демона_для_использования_прокси" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%B4%D0%B5%D0%BC%D0%BE%D0%BD%D0%B0_%D0%B4%D0%BB%D1%8F_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_%D0%BF%D1%80%D0%BE%D0%BA%D1%81%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.1</span>Настройка демона для использования прокси</div>
			</a>
			
			<ul id="toc-Настройка_демона_для_использования_прокси-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Настройка_контейнеров_для_использования_прокси" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%BE%D0%B2_%D0%B4%D0%BB%D1%8F_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_%D0%BF%D1%80%D0%BE%D0%BA%D1%81%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.2</span>Настройка контейнеров для использования прокси</div>
			</a>
			
			<ul id="toc-Настройка_контейнеров_для_использования_прокси-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Настройка_DNS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_DNS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4</span>Настройка DNS</div>
			</a>
			
			<ul id="toc-Настройка_DNS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Расположение_образов" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A0%D0%B0%D1%81%D0%BF%D0%BE%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.5</span>Расположение образов</div>
			</a>
			
			<ul id="toc-Расположение_образов-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Небезопасные_реестры" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B5%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D1%8B%D0%B5_%D1%80%D0%B5%D0%B5%D1%81%D1%82%D1%80%D1%8B">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.6</span>Небезопасные реестры</div>
			</a>
			
			<ul id="toc-Небезопасные_реестры-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-IPv6" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#IPv6">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.7</span>IPv6</div>
			</a>
			
			<ul id="toc-IPv6-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Изоляция_пользовательского_пространства_имён" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%98%D0%B7%D0%BE%D0%BB%D1%8F%D1%86%D0%B8%D1%8F_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D1%81%D0%BA%D0%BE%D0%B3%D0%BE_%D0%BF%D1%80%D0%BE%D1%81%D1%82%D1%80%D0%B0%D0%BD%D1%81%D1%82%D0%B2%D0%B0_%D0%B8%D0%BC%D1%91%D0%BD">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.8</span>Изоляция пользовательского пространства имён</div>
			</a>
			
			<ul id="toc-Изоляция_пользовательского_пространства_имён-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Запуск_демона_Docker_без_прав_суперпользователя" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_%D0%B4%D0%B5%D0%BC%D0%BE%D0%BD%D0%B0_Docker_%D0%B1%D0%B5%D0%B7_%D0%BF%D1%80%D0%B0%D0%B2_%D1%81%D1%83%D0%BF%D0%B5%D1%80%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.9</span>Запуск демона Docker без прав суперпользователя</div>
			</a>
			
			<ul id="toc-Запуск_демона_Docker_без_прав_суперпользователя-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Включение_native_overlay_diff_engine" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_native_overlay_diff_engine">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.10</span>Включение native overlay diff engine</div>
			</a>
			
			<ul id="toc-Включение_native_overlay_diff_engine-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Образы" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%9E%D0%B1%D1%80%D0%B0%D0%B7%D1%8B">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Образы</div>
		</a>
		
			<button aria-controls="toc-Образы-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Образы subsection</span>
			</button>
		
		<ul id="toc-Образы-sublist" class="vector-toc-list">
			<li id="toc-Arch_Linux" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Arch_Linux">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Arch Linux</div>
			</a>
			
			<ul id="toc-Arch_Linux-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Alpine_Linux" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Alpine_Linux">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Alpine Linux</div>
			</a>
			
			<ul id="toc-Alpine_Linux-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Debian" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Debian">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Debian</div>
			</a>
			
			<ul id="toc-Debian-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Distroless" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Distroless">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>Distroless</div>
			</a>
			
			<ul id="toc-Distroless-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Советы_и_рекомендации" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A1%D0%BE%D0%B2%D0%B5%D1%82%D1%8B_%D0%B8_%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D0%B0%D1%86%D0%B8%D0%B8">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Советы и рекомендации</div>
		</a>
		
			<button aria-controls="toc-Советы_и_рекомендации-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Советы и рекомендации subsection</span>
			</button>
		
		<ul id="toc-Советы_и_рекомендации-sublist" class="vector-toc-list">
			<li id="toc-Получение_IP-адреса_запущенного_контейнера" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_IP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81%D0%B0_%D0%B7%D0%B0%D0%BF%D1%83%D1%89%D0%B5%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE_%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Получение IP-адреса запущенного контейнера</div>
			</a>
			
			<ul id="toc-Получение_IP-адреса_запущенного_контейнера-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Запуск_графических_программ_внутри_контейнера" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D1%85_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC_%D0%B2%D0%BD%D1%83%D1%82%D1%80%D0%B8_%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Запуск графических программ внутри контейнера</div>
			</a>
			
			<ul id="toc-Запуск_графических_программ_внутри_контейнера-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Запуск_проектов_Docker_Compose_при_загрузке_системы" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%BE%D0%B2_Docker_Compose_%D0%BF%D1%80%D0%B8_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B5_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Запуск проектов Docker Compose при загрузке системы</div>
			</a>
			
			<ul id="toc-Запуск_проектов_Docker_Compose_при_загрузке_системы-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Использование_buildx_для_кросс-компиляции" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_buildx_%D0%B4%D0%BB%D1%8F_%D0%BA%D1%80%D0%BE%D1%81%D1%81-%D0%BA%D0%BE%D0%BC%D0%BF%D0%B8%D0%BB%D1%8F%D1%86%D0%B8%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>Использование buildx для кросс-компиляции</div>
			</a>
			
			<ul id="toc-Использование_buildx_для_кросс-компиляции-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Запуск_Docker-контейнеров_с_ускорением_на_графических_процессорах_NVIDIA" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_Docker-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%BE%D0%B2_%D1%81_%D1%83%D1%81%D0%BA%D0%BE%D1%80%D0%B5%D0%BD%D0%B8%D0%B5%D0%BC_%D0%BD%D0%B0_%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D1%85_%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BE%D1%80%D0%B0%D1%85_NVIDIA">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5</span>Запуск Docker-контейнеров с ускорением на графических процессорах NVIDIA</div>
			</a>
			
			<ul id="toc-Запуск_Docker-контейнеров_с_ускорением_на_графических_процессорах_NVIDIA-sublist" class="vector-toc-list">
				<li id="toc-С_помощью_NVIDIA_Container_Toolkit_(рекомендуется)" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A1_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_NVIDIA_Container_Toolkit_(%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D1%83%D0%B5%D1%82%D1%81%D1%8F)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.1</span>С помощью NVIDIA Container Toolkit (рекомендуется)</div>
			</a>
			
			<ul id="toc-С_помощью_NVIDIA_Container_Toolkit_(рекомендуется)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-С_помощью_NVIDIA_Container_Runtime" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A1_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_NVIDIA_Container_Runtime">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.2</span>С помощью NVIDIA Container Runtime</div>
			</a>
			
			<ul id="toc-С_помощью_NVIDIA_Container_Runtime-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-С_помощью_nvidia-docker_(устарело)" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A1_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_nvidia-docker_(%D1%83%D1%81%D1%82%D0%B0%D1%80%D0%B5%D0%BB%D0%BE)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.3</span>С помощью nvidia-docker (устарело)</div>
			</a>
			
			<ul id="toc-С_помощью_nvidia-docker_(устарело)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Образ_Arch_Linux_с_CUDA" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9E%D0%B1%D1%80%D0%B0%D0%B7_Arch_Linux_%D1%81_CUDA">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.4</span>Образ Arch Linux с CUDA</div>
			</a>
			
			<ul id="toc-Образ_Arch_Linux_с_CUDA-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Удаление_Docker_и_образов" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A3%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_Docker_%D0%B8_%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Удаление Docker и образов</div>
		</a>
		
		<ul id="toc-Удаление_Docker_и_образов-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Решение_проблем" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A0%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Решение проблем</div>
		</a>
		
			<button aria-controls="toc-Решение_проблем-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Решение проблем subsection</span>
			</button>
		
		<ul id="toc-Решение_проблем-sublist" class="vector-toc-list">
			<li id="toc-docker0_Bridge_не_получает_IP_/_нет_доступа_к_Интернету_в_контейнерах_при_использовании_systemd-networkd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#docker0_Bridge_%D0%BD%D0%B5_%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B0%D0%B5%D1%82_IP_/_%D0%BD%D0%B5%D1%82_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0_%D0%BA_%D0%98%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B5%D1%82%D1%83_%D0%B2_%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B0%D1%85_%D0%BF%D1%80%D0%B8_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B8_systemd-networkd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1</span>docker0 Bridge не получает IP / нет доступа к Интернету в контейнерах при использовании systemd-networkd</div>
			</a>
			
			<ul id="toc-docker0_Bridge_не_получает_IP_/_нет_доступа_к_Интернету_в_контейнерах_при_использовании_systemd-networkd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Слишком_маленькое_разрешённое_количество_процессов/потоков_по_умолчанию" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%BB%D0%B8%D1%88%D0%BA%D0%BE%D0%BC_%D0%BC%D0%B0%D0%BB%D0%B5%D0%BD%D1%8C%D0%BA%D0%BE%D0%B5_%D1%80%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D1%91%D0%BD%D0%BD%D0%BE%D0%B5_%D0%BA%D0%BE%D0%BB%D0%B8%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BE%D0%B2/%D0%BF%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%B2_%D0%BF%D0%BE_%D1%83%D0%BC%D0%BE%D0%BB%D1%87%D0%B0%D0%BD%D0%B8%D1%8E">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2</span>Слишком маленькое разрешённое количество процессов/потоков по умолчанию</div>
			</a>
			
			<ul id="toc-Слишком_маленькое_разрешённое_количество_процессов/потоков_по_умолчанию-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Error_initializing_graphdriver:_devmapper" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Error_initializing_graphdriver:_devmapper">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.3</span>Error initializing graphdriver: devmapper</div>
			</a>
			
			<ul id="toc-Error_initializing_graphdriver:_devmapper-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Failed_to_create_some/path/to/file:_No_space_left_on_device" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Failed_to_create_some/path/to/file:_No_space_left_on_device">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.4</span>Failed to create some/path/to/file: No space left on device</div>
			</a>
			
			<ul id="toc-Failed_to_create_some/path/to/file:_No_space_left_on_device-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Docker-machine_не_может_создать_виртуальные_машины_с_драйвером_virtualbox" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Docker-machine_%D0%BD%D0%B5_%D0%BC%D0%BE%D0%B6%D0%B5%D1%82_%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D1%82%D1%8C_%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5_%D0%BC%D0%B0%D1%88%D0%B8%D0%BD%D1%8B_%D1%81_%D0%B4%D1%80%D0%B0%D0%B9%D0%B2%D0%B5%D1%80%D0%BE%D0%BC_virtualbox">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.5</span>Docker-machine не может создать виртуальные машины с драйвером virtualbox</div>
			</a>
			
			<ul id="toc-Docker-machine_не_может_создать_виртуальные_машины_с_драйвером_virtualbox-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Запуск_Docker_ломает_сетевой_мост_KVM" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_Docker_%D0%BB%D0%BE%D0%BC%D0%B0%D0%B5%D1%82_%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D0%BE%D0%B9_%D0%BC%D0%BE%D1%81%D1%82_KVM">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.6</span>Запуск Docker ломает сетевой мост KVM</div>
			</a>
			
			<ul id="toc-Запуск_Docker_ломает_сетевой_мост_KVM-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Ограничения_на_скачивание_образов_с_Docker_Hub" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9E%D0%B3%D1%80%D0%B0%D0%BD%D0%B8%D1%87%D0%B5%D0%BD%D0%B8%D1%8F_%D0%BD%D0%B0_%D1%81%D0%BA%D0%B0%D1%87%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2_%D1%81_Docker_Hub">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.7</span>Ограничения на скачивание образов с Docker Hub</div>
			</a>
			
			<ul id="toc-Ограничения_на_скачивание_образов_с_Docker_Hub-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-iptables_(legacy):_unknown_option_"--dport"' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#iptables_(legacy):_unknown_option_"--dport"'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.8</span>iptables (legacy): unknown option "--dport"</div>
			</a>
			
			<ul id='toc-iptables_(legacy):_unknown_option_"--dport"-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-"Your_password_will_be_stored_unencrypted"_при_выполнении_docker_login' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#"Your_password_will_be_stored_unencrypted"_%D0%BF%D1%80%D0%B8_%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B8_docker_login'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.9</span>"Your password will be stored unencrypted" при выполнении docker login</div>
			</a>
			
			<ul id='toc-"Your_password_will_be_stored_unencrypted"_при_выполнении_docker_login-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-"Could_not_find_an_available,_non-overlapping_IPv4_address_pool_among_the_defaults_to_assign_to_the_network"' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#"Could_not_find_an_available,_non-overlapping_IPv4_address_pool_among_the_defaults_to_assign_to_the_network"'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.10</span>"Could not find an available, non-overlapping IPv4 address pool among the defaults to assign to the network"</div>
			</a>
			
			<ul id='toc-"Could_not_find_an_available,_non-overlapping_IPv4_address_pool_among_the_defaults_to_assign_to_the_network"-sublist' class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Смотрите_также" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>Смотрите также</div>
		</a>
		
		<ul id="toc-Смотрите_также-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Docker (Русский)</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-en mw-list-item"><a href="../en/Docker.html" title="Docker – English" lang="en" hreflang="en" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Docker" title="Docker – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Docker" title="Docker – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="ru" dir="ltr">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/Docker.html" title="Docker">Docker</a>. Дата последней синхронизации: 13 декабря 2023. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Docker&amp;diff=0&amp;oldid=793323">изменения</a>.</div>
<div class="archwiki-template-meta-related-articles">
<p>Ссылки по теме</p>
<ul>
<li><a href="../en/Systemd-nspawn.html" class="mw-redirect" title="Systemd-nspawn (Русский)">systemd-nspawn (Русский)</a></li>
<li><a href="../en/Linux_Containers.html" title="Linux Containers">Linux Containers</a></li>
<li><a href="../en/Vagrant.html" title="Vagrant">Vagrant</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/ru:Docker" class="extiw" title="wikipedia:ru:Docker">Docker</a> — утилита для упаковки, загрузки и запуска любых приложений в легковесных контейнерах.
</p>
<meta property="mw:PageProp/toc">
<h2>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0"></span><span class="mw-headline" id="Установка">Установка</span>
</h2>
<p>Чтобы скачивать образы Docker и запускать контейнеры Docker, вам понадобится Docker Engine. Docker Engine включает в себя демон для управления контейнерами, а также интерфейс CLI <code>docker</code>. <a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">Установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=docker">docker</a></span> или разрабатываемую версию <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/docker-git/">docker-git</a></span><sup><small>AUR</small></sup>. Затем <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Запустите/включите">запустите/включите</a> <code>docker.service</code> или <code>docker.socket</code>. Обратите внимание, что <code>docker.service</code> запускает службу при загрузке, тогда как <code>docker.socket</code> запускает docker при первом использовании, <a rel="nofollow" class="external text" href="https://github.com/moby/moby/issues/38373#issuecomment-447393517">что может сократить время загрузки системы</a>. Проверьте работу демона:
</p>
<pre># docker info
</pre>
<p>Обратите внимание, что запуск службы Docker может завершиться сбоем, если имеется активное VPN-соединение. Это происходит из-за IP-конфликтов между сетевыми мостами и оверлейными сетями VPN и Docker. Если это так, попробуйте отключить VPN перед запуском службы Docker. Вы можете переподключить VPN сразу после этого. Вы также можете попытаться устранить конфликты сетей (смотрите решения <a rel="nofollow" class="external autonumber" href="https://stackoverflow.com/questions/45692255/how-make-openvpn-work-with-docker">[1]</a> или <a rel="nofollow" class="external autonumber" href="https://github.com/docker/compose/issues/4336#issuecomment-457326123">[2]</a>).
</p>
<p>Затем проверьте, что запуск контейнеров работает. Следующая команда скачивает свежий <a href="#Arch_Linux">образ Arch Linux</a> и использует его для запуска программы Hello World в контейнере:
</p>
<pre># docker run -it --rm archlinux bash -c "echo hello world"
</pre>
<p>Если требуется использовать команду <code>docker</code> от имени обычного пользователя, добавьте его в <a href="../ru/Users_and_groups.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B3%D1%80%D1%83%D0%BF%D0%BF%D0%B0%D0%BC%D0%B8" title="Users and groups (Русский)">группу</a> <code>docker</code>, перелогиньтесь и <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">перезапустите</a> службу <code>docker.service</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Каждый пользователь в группе <code>docker</code> имеет права, равноценные правам суперпользователя, поскольку они могут использовать <code>docker run --privileged</code> для запуска контейнеров с привилегиями суперпользователя. Подробнее <a rel="nofollow" class="external autonumber" href="https://github.com/docker/docker/issues/9976">[3]</a> и <a rel="nofollow" class="external autonumber" href="https://docs.docker.com/engine/security/security/">[4]</a>.</div>
<h3><span class="mw-headline" id="Docker_Compose">Docker Compose</span></h3>
<p><a rel="nofollow" class="external text" href="https://docs.docker.com/compose/">Docker Compose</a> — это альтернативный интерфейс CLI для Docker Engine, который определяет свойства контейнеров с помощью <a href="https://en.wikipedia.org/wiki/ru:YAML" class="extiw" title="wikipedia:ru:YAML">YAML</a>-файла <code>docker-compose.yml</code> вместо, например, скрипта с параметрами <code>docker run</code>. Это полезно для настройки служб, которые часто используются и/или имеют сложные конфигурации. Для использования <a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=docker-compose">docker-compose</a></span>.
</p>
<h3><span class="mw-headline" id="Docker_Desktop">Docker Desktop</span></h3>
<p><a rel="nofollow" class="external text" href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a> — это проприетарное настольное приложение, которое запускает Docker Engine внутри виртуальной машины Linux. Включены дополнительные функции, такие как кластер Kubernetes и сканер уязвимостей. Это приложение полезно для групп разработчиков программного обеспечения, которые разрабатывают контейнеры Docker с использованием macOS и Windows. Порт приложения для Linux является относительно новым и дополняет интерфейс командной строки Docker <a rel="nofollow" class="external autonumber" href="https://www.docker.com/blog/the-magic-of-docker-desktop-is-now-available-on-linux/">[5]</a>.
</p>
<p>Экспериментальный пакет для Arch предоставляется непосредственно Docker. Подробнее в <a rel="nofollow" class="external text" href="https://docs.docker.com/desktop/linux/install/archlinux/">руководстве</a>. К сожалению, он содержит файлы, которые конфликтуют с пакетом <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=docker-compose">docker-compose</a></span>, поэтому сначала вам необходимо удалить <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=docker-compose">docker-compose</a></span>, если он установлен. Но вы можете установить пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/docker-desktop/">docker-desktop</a></span><sup><small>AUR</small></sup>, который не конфликтует с существующими пакетами.
</p>
<p>Кроме того, для запуска <a rel="nofollow" class="external text" href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a> ваша система должна соответствовать определённым <a rel="nofollow" class="external text" href="https://docs.docker.com/desktop/install/linux-install/">требованиям</a>, в частности, должна быть включена поддержка виртуализации <a href="../en/KVM.html" title="KVM">KVM</a>. Чтобы увидеть значок на панели задач в Gnome, потребуется <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnome-shell-extension-appindicator">gnome-shell-extension-appindicator</a></span>.
</p>
<p>Наконец, поддержка совместного использования файлов требует сопоставления идентификаторов пользователей и групп через <code>/etc/subuid</code> и <code>/etc/subgid</code>. Дополнительные сведения см. в <a rel="nofollow" class="external text" href="https://docs.docker.com/desktop/faqs/linuxfaqs/#how-do-i-enable-file-sharing">Инструкции по совместному использованию файлов Docker Desktop для Linux</a><sup title="Статус последней проверки: 404">[<a href="https://en.wikipedia.org/wiki/ru:%D0%92%D0%B8%D0%BA%D0%B8%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F:%D0%9C%D1%91%D1%80%D1%82%D0%B2%D1%8B%D0%B5_%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8" class="extiw" title="wikipedia:ru:Википедия:Мёртвые ссылки">устаревшая ссылка</a> 2024-12-15 ⓘ]</sup>.
</p>
<h2>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Использование">Использование</span>
</h2>
<p>Docker состоит из нескольких компонентов:
</p>
<ul>
<li>Демон Docker (иногда его также называют Docker Engine) — это процесс, который запускается через <code>docker.service</code>. Он реализует Docker API и управляет контейнерами Docker.</li>
<li>Команда <code>docker</code>, которая позволяет пользователям взаимодействовать с Docker API через командную строку и управлять демоном Docker.</li>
<li>Контейнеры Docker — это изолированные (namespaced) процессы, которые запускаются и управляются демоном Docker по запросу через Docker API.</li>
</ul>
<p>Обычно пользователи используют Docker, выполняя команды <code>docker</code>, которые, в свою очередь, обращаются к демону Docker для выполнения действий, которые, в свою очередь, манипулируют контейнерами Docker. Понимание взаимосвязи между клиентом (<code>docker</code>), сервером (<code>docker.service</code>) и контейнерами важно для успешного администрирования Docker.
</p>
<p>Обратите внимание, что если демон Docker останавливается или перезапускается, все запущенные в данный момент контейнеры Docker тоже останавливаются или перезапускаются.
</p>
<p>Также можно отправлять запросы к Docker API и управлять демоном Docker без использования команды <code>docker</code>. Смотрите <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/api/">документацию Docker API</a>.
</p>
<p>Подробнее об использовании Docker можно почитать в <a rel="nofollow" class="external text" href="https://docs.docker.com/get-started/">Docker Getting Started guide</a>.
</p>
<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0"></span><span class="mw-headline" id="Настройка">Настройка</span>
</h2>
<p>Демон Docker настраивается через файл настроек <code>/etc/docker/daemon.json</code> или через флаги командной строки в юните <code>docker.service</code>. <a rel="nofollow" class="external text" href="https://docs.docker.com/config/daemon/#configure-the-docker-daemon">Официальная документация</a> рекомендует использовать файл настроек. Если вы хотите использовать флаги командной строки, используйте <a href="../ru/Systemd.html#Drop-in_%D1%84%D0%B0%D0%B9%D0%BB%D1%8B" title="Systemd (Русский)">drop-in файлы</a>, чтобы переопределить директиву <code>ExecStart</code> в <code>docker.service</code>.
</p>
<p>Информация об опциях в <code>daemon.json</code> есть в <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file">документации</a>.
</p>
<h3>
<span id=".D0.94.D1.80.D0.B0.D0.B9.D0.B2.D0.B5.D1.80_.D1.85.D1.80.D0.B0.D0.BD.D0.B5.D0.BD.D0.B8.D1.8F"></span><span class="mw-headline" id="Драйвер_хранения">Драйвер хранения</span>
</h3>
<p>Драйвер хранения (<a rel="nofollow" class="external text" href="https://docs.docker.com/storage/storagedriver/select-storage-driver/">storage driver</a>) управляет хранением образов и контейнеров на вашем Docker-хосте. По умолчанию используется драйвер <code>overlay2</code>, который имеет хорошую производительность и является хорошим выбором для современных ядер Linux и файловых систем. Более старые драйверы <code>devicemapper</code> и <code>aufs</code> могут использоваться для совместимости со старыми ядрами Linux, но использовать их в Arch Linux вместо <code>overlay2</code> смысла мало.
</p>
<p>Пользователи <a href="../ru/Btrfs.html" title="Btrfs (Русский)">Btrfs</a> или <a href="../en/ZFS.html" class="mw-redirect" title="ZFS (Русский)">ZFS</a> могут использовать драйвер <code>btrfs</code> или <code>zfs</code> соответственно, преимущество которых в использовании возможностей, специфичных для файловой системы. Смотрите <a rel="nofollow" class="external text" href="https://docs.docker.com/storage/storagedriver/btrfs-driver/">документацию драйвера btrfs</a> и <a rel="nofollow" class="external text" href="https://docs.docker.com/storage/storagedriver/zfs-driver/">документацию драйвера zfs</a> для более подробной информации.
</p>
<h3>
<span id=".D0.A1.D0.BE.D0.BA.D0.B5.D1.82_.D0.B4.D0.B5.D0.BC.D0.BE.D0.BD.D0.B0"></span><span class="mw-headline" id="Сокет_демона">Сокет демона</span>
</h3>
<p>По умолчанию демон Docker принимает запросы Docker API через <a href="https://en.wikipedia.org/wiki/ru:%D0%A1%D0%BE%D0%BA%D0%B5%D1%82_%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%B0_Unix" class="extiw" title="wikipedia:ru:Сокет домена Unix">Unix-сокет</a> <code>/var/run/docker.sock</code>. Это подходящий вариант в большинстве случаев.
</p>
<p>Можно настроить демон так, чтобы он дополнительно слушал TCP-сокет, что позволит получить удалённый доступ к Docker API с других компьютеров. <a rel="nofollow" class="external autonumber" href="https://docs.docker.com/engine/install/linux-postinstall/#allow-access-to-the-remote-api-through-a-firewall">[6]</a> Это можно использовать, например, для того, чтобы команды <code>docker</code>, выполняемые на хосте, могли получить доступ к демону Docker, запущенному в виртуальной машине с Linux, например в виртуальной машине с Arch на хосте Windows или macOS.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> По умолчанию Docker API не использует шифрование или аутентификацию. Удалённый доступ к демону Docker через TCP эквивалентен незащищенному удалённому root-доступу, если не включены шифрование TLS и авторизация либо с помощью HTTP-прокси, либо с помощью <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/security/https/">дополнительной настройки Docker</a>. В целом, включение TCP-сокетов для Docker API следует рассматривать как высокий риск для безопасности.</div>
<p>В стандартном файле <code>docker.service</code> установлен флаг <code>-H</code>, и Docker не запустится, если опция присутствует одновременно во флагах и в файле <code>/etc/docker/daemon.json</code>. Поэтому самый простой способ изменить настройки сокета — использовать <a href="../ru/Systemd.html#Drop-in_%D1%84%D0%B0%D0%B9%D0%BB%D1%8B" class="mw-redirect" title="Drop-in файл">drop-in файл</a>. Пример ниже добавляет TCP-сокет на порту 2376:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/docker.service.d/docker.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/dockerd -H unix:///var/run/docker.sock -H tcp://0.0.0.0:2376</pre>
<p>Для применения изменений выполните <a href="../ru/Systemd.html#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" title="Systemd (Русский)">daemon-reload</a> и <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">перезапустите</a> службу <code>docker.service</code>.
</p>
<h3>
<span id="HTTP-.D0.BF.D1.80.D0.BE.D0.BA.D1.81.D0.B8"></span><span class="mw-headline" id="HTTP-прокси">HTTP-прокси</span>
</h3>
<p>Настройка Docker для использования HTTP-прокси состоит из двух частей: настройка демона и настройка контейнеров.
</p>
<h4>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D0.B4.D0.B5.D0.BC.D0.BE.D0.BD.D0.B0_.D0.B4.D0.BB.D1.8F_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F_.D0.BF.D1.80.D0.BE.D0.BA.D1.81.D0.B8"></span><span class="mw-headline" id="Настройка_демона_для_использования_прокси">Настройка демона для использования прокси</span>
</h4>
<p>Смотрите <a rel="nofollow" class="external text" href="https://docs.docker.com/config/daemon/systemd/#httphttps-proxy">документацию Docker</a>.
</p>
<h4>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D0.BA.D0.BE.D0.BD.D1.82.D0.B5.D0.B9.D0.BD.D0.B5.D1.80.D0.BE.D0.B2_.D0.B4.D0.BB.D1.8F_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F_.D0.BF.D1.80.D0.BE.D0.BA.D1.81.D0.B8"></span><span class="mw-headline" id="Настройка_контейнеров_для_использования_прокси">Настройка контейнеров для использования прокси</span>
</h4>
<p>Смотрите <a rel="nofollow" class="external text" href="https://docs.docker.com/network/proxy/#configure-the-docker-client">документацию Docker</a>.
</p>
<h3>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_DNS"></span><span class="mw-headline" id="Настройка_DNS">Настройка DNS</span>
</h3>
<p><a rel="nofollow" class="external text" href="https://docs.docker.com/config/containers/container-networking/#dns-services">Документация Docker</a> содержит подробную информацию о том, как работает DNS в контейнерах. Чаще всего используются те же DNS-серверы, которые используются на хосте.
</p>
<p>Большинство DNS-серверов, запущенных на <code>127.0.0.0/8</code>, <a rel="nofollow" class="external text" href="https://github.com/moby/moby/issues/6388#issuecomment-76124221">не поддерживается</a> из-за конфликтов между сетевыми пространствам имён хоста и контейнеров. Такие серверы <a rel="nofollow" class="external text" href="https://github.com/moby/libnetwork/blob/master/resolvconf/resolvconf.go">убираются из файлов /etc/resolv.conf внутри контейнеров</a>. Если в результате этого <code>/etc/resolv.conf</code> окажется пустым, то будет использоваться Google DNS.
</p>
<p>Особым случаем является использование <code>127.0.0.53</code> в качестве единственного указанного DNS-сервера. В таком случае Docker предполагает наличие <a href="../ru/Systemd-resolved.html" title="Systemd-resolved (Русский)">systemd-resolved</a> и использует <code>/run/systemd/resolve/resolv.conf</code>.
</p>
<p>Если вы используете службу вроде <a href="../en/Dnsmasq.html" class="mw-redirect" title="Dnsmasq (Русский)">dnsmasq</a>, можно добавить виртуальный сетевой интерфейс с link-local адресом из блока <code>169.254.0.0/16</code> вместо <code>127.0.0.1</code>.
</p>
<h3>
<span id=".D0.A0.D0.B0.D1.81.D0.BF.D0.BE.D0.BB.D0.BE.D0.B6.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BE.D0.B1.D1.80.D0.B0.D0.B7.D0.BE.D0.B2"></span><span class="mw-headline" id="Расположение_образов">Расположение образов</span>
</h3>
<p>По умолчанию Docker образы расположены в <code>/var/lib/docker</code>. Они могут быть перемещены в другие разделы.
Ниже в качестве примера рассматривается перемещение в <code>/mnt/docker</code>.
</p>
<p>Для начала <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Остановите">остановите</a> <code>docker.service</code>. Это также остановит все запущенные контейнеры и размонтирует все образы. После этого можно поместить файлы образов в нужное место, например, командой <code>cp -r /var/lib/docker /mnt/docker</code>.
</p>
<p>После этого в файле <code>/etc/docker/daemon.json</code> измените опцию <code>data-root</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "data-root": "/mnt/docker"
}</pre>
<p><a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">Перезапустите</a> <code>docker.service</code> для применения изменений.
</p>
<h3>
<span id=".D0.9D.D0.B5.D0.B1.D0.B5.D0.B7.D0.BE.D0.BF.D0.B0.D1.81.D0.BD.D1.8B.D0.B5_.D1.80.D0.B5.D0.B5.D1.81.D1.82.D1.80.D1.8B"></span><span class="mw-headline" id="Небезопасные_реестры">Небезопасные реестры</span>
</h3>
<p>Если вы решите использовать самозаверенный сертификат для своего личного реестра, Docker откажется использовать его, пока вы не заявите, что доверяете ему.
Например, чтобы разрешить использование образов из реестра <code>myregistry.example.com:8443</code>, измените опцию <code>/etc/docker/daemon.json</code> в файле <code>/etc/docker/daemon.json</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "insecure-registries": [
    "my.registry.example.com:8443"
  ]
}</pre>
<p><a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">Перезапустите</a> <code>docker.service</code> для применения изменений.
</p>
<h3><span class="mw-headline" id="IPv6">IPv6</span></h3>
<p>Чтобы включить поддержку IPv6 в Docker, необходимо выполнить несколько действий. Подробнее смотрите <a rel="nofollow" class="external autonumber" href="https://github.com/docker/docker.github.io/blob/c0eb65aabe4de94d56bbc20249179f626df5e8c3/engine/userguide/networking/default_network/ipv6.md">[7]</a> и <a rel="nofollow" class="external autonumber" href="https://github.com/moby/moby/issues/36954">[8]</a>.
</p>
<p>Сперва включите параметр <code>ipv6</code> в файле <code>/etc/docker/daemon.json</code> и задайте определённую подсеть IPv6. В примерах ниже используется частная подсеть <code>fd00::/80</code>. Убедитесь, что используете подсеть не менее 80 бит, так как это позволит IPv6-адресу контейнера оканчиваться его MAC-адресом, что уменьшит проблемы с недействительностью кэша соседей NDP.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "ipv6": true,
  "fixed-cidr-v6": "fd00::/80"
}
</pre>
<p><a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">Перезапустите</a> <code>docker.service</code> для применения изменений.
</p>
<p>После этого, чтобы предоставить контейнерам доступ к сети хоста, необходимо решить проблемы с маршрутизацией, возникающие из-за использования частной подсети IPv6. Добавьте IPv6 NAT:
</p>
<pre># ip6tables -t nat -A POSTROUTING -s fd00::/80 ! -o docker0 -j MASQUERADE
</pre>
<p>После этого IPv6 должен полноценно заработать. Проверить можно такой командой:
</p>
<pre># docker run curlimages/curl curl -v -6 archlinux.org
</pre>
<p>Если вы используете <a href="../en/Firewalld.html" title="Firewalld">firewalld</a>, можно добавить подобное правило:
</p>
<pre># firewall-cmd --zone=public --add-rich-rule='rule family="ipv6" destination not address="fd00::1/80" source address="fd00::/80" masquerade'
</pre>
<p>Для <a href="../en/Uncomplicated_Firewall.html" class="mw-redirect" title="Ufw">ufw</a> нужно сперва разрешить ipv6 forwarding, как описано в разделе <a href="../en/Uncomplicated_Firewall.html#Forward_policy" title="Uncomplicated Firewall">Uncomplicated Firewall#Forward policy</a>. Затем отредактируйте файл <code>/etc/default/ufw</code>, раскомментировав следующие строки:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ufw/sysctl.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">net/ipv6/conf/default/forwarding=1
net/ipv6/conf/all/forwarding=1</pre>
<p>После этого можно добавить правило iptables:
</p>
<pre># ip6tables -t nat -A POSTROUTING -s fd00::/80 ! -o docker0 -j MASQUERADE
</pre>
<p>Для контейнеров docker, созданных с помощью <i>docker-compose</i>, может потребоваться установить значение <code>enable_ipv6: true</code> в разделе <code>networks</code> для соответствующей сети. Кроме того, может потребоваться настройка подсети IPv6. Смотрите <a rel="nofollow" class="external autonumber" href="https://docs.docker.com/compose/compose-file/compose-file-v2/#ipv4_address-ipv6_address">[9]</a> для более подробной информации.
</p>
<h3>
<span id=".D0.98.D0.B7.D0.BE.D0.BB.D1.8F.D1.86.D0.B8.D1.8F_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8C.D1.81.D0.BA.D0.BE.D0.B3.D0.BE_.D0.BF.D1.80.D0.BE.D1.81.D1.82.D1.80.D0.B0.D0.BD.D1.81.D1.82.D0.B2.D0.B0_.D0.B8.D0.BC.D1.91.D0.BD"></span><span class="mw-headline" id="Изоляция_пользовательского_пространства_имён">Изоляция пользовательского пространства имён</span>
</h3>
<p>По умолчанию процессы в контейнерах Docker запускаются в том же пользовательском пространстве имён, что и основной демон <code>dockerd</code>, то есть контейнеры не изолированы от него с помощью <span class="plainlinks archwiki-template-man" title="$ man 7 user_namespaces"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/user_namespaces.7">user_namespaces(7)</a></span>. Это позволяет процессу внутри контейнера получать доступ к настроенным ресурсам на хосте в соответствии с <a href="../ru/Users_and_groups.html#%D0%9F%D1%80%D0%B0%D0%B2%D0%B0_%D0%B8_%D0%B2%D0%BB%D0%B0%D0%B4%D0%B5%D0%BB%D1%8C%D1%86%D1%8B" title="Users and groups (Русский)">обычными правами доступа</a>. Это обеспечивает максимальную совместимость, но создаёт риск безопасности в случае появления уязвимостей, связанных с повышением привилегий или побегом из контейнера (одна такая уязвимость была <a rel="nofollow" class="external text" href="https://seclists.org/oss-sec/2019/q1/119">обнародована и исправлена в феврале 2019 года</a>).
</p>
<p>Влияние такой уязвимости можно уменьшить с помощью <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/security/userns-remap/">изоляции пользовательского пространства имён</a> — UID и GID внутри контейнеров будут сопоставляться с другим (как правило, непривилегированным) диапазоном UID/GID на хосте.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Демон <code>dockerd</code> всё равно будет запускаться от имени суперпользователя. Запуск Docker <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/security/rootless/">без прав суперпользователя</a> — отдельная, не связанная с этим функция.</li>
<li>Процессы в контейнере запускаются от имени пользователя, указанного в директиве <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/reference/builder/#user">USER</a> в Dockerfile, используемом для создания образа контейнера.</li>
<li>Все контейнеры используют и тот же диапазон UID/GID. Это сохраняет возможность совместного использования томов контейнерами.</li>
<li>Включение изоляции пользовательского пространства имён имеет <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/security/userns-remap/#user-namespace-known-limitations">ряд ограничений</a>.</li>
<li>Включение изоляции пользовательского пространства имён фактически замаскирует существующие слои образов и контейнеров, а также другие объекты Docker в <code>/var/lib/docker/</code>, поскольку Docker необходимо настроить права на них. В официальной документации рекомендуется включать эту функцию на новой установке Docker, а не на существующей.</li>
</ul>
</div>
<p>В файле <code>/etc/docker/daemon.json</code> измените опцию <code>userns-remap</code>. Значение <code>default</code> автоматически создаст пользователя и группу <code>dockremap</code> для использования с изоляцией пользовательского пространства имён.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "userns-remap": "default"
}</pre>
<p>Настройте <code>/etc/subuid</code> и <code>/etc/subgid</code>, указав имя пользователя/группы, начальные UID/GID и размеры диапазонов UID/GID. В примере ниже пользователю и группе <code>dockremap</code> назначается диапазон из 65536 UID и GID, начиная с 165536.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/subuid</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dockremap:165536:65536</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/subgid</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dockremap:165536:65536</pre>
<p><a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">Перезапустите</a> <code>docker.service</code> для применения изменений.
</p>
<p>После этого все контейнеры будут по умолчанию работать в изолированном пользовательском пространстве имён. Это можно отключить для отдельных контейнеров с помощью флага <code>--userns=host</code> команды <code>docker</code>. Смотрите <a rel="nofollow" class="external autonumber" href="https://docs.docker.com/engine/security/userns-remap/#disable-namespace-remapping-for-a-container">[10]</a> для более подробной информации.
</p>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_.D0.B4.D0.B5.D0.BC.D0.BE.D0.BD.D0.B0_Docker_.D0.B1.D0.B5.D0.B7_.D0.BF.D1.80.D0.B0.D0.B2_.D1.81.D1.83.D0.BF.D0.B5.D1.80.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8F"></span><span class="mw-headline" id="Запуск_демона_Docker_без_прав_суперпользователя">Запуск демона Docker без прав суперпользователя</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Без прав суперпользователя Docker полагается на непривилегированные пользовательские пространства имён (unprivileged user namespaces, <code>CONFIG_USER_NS_UNPRIVILEGED</code>). Это включено по умолчанию в ядрах <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-lts">linux-lts</a></span> и <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-zen">linux-zen</a></span>. Пользователям других ядер может потребоваться явно включить эту функцию. Это имеет некоторые последствия для безопасности; смотрите <a href="../ru/Security.html#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B9_%D0%B2_%D0%BF%D0%B5%D1%81%D0%BE%D1%87%D0%BD%D0%B8%D1%86%D0%B5" class="mw-redirect" title="Безопасность">Безопасность#Запуск приложений в песочнице</a>.</div>
<p>Чтобы сам демон Docker запускался от имени обычного пользователя, <a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/docker-rootless-extras/">docker-rootless-extras</a></span><sup><small>AUR</small></sup>.
</p>
<p>Настройте <code>/etc/subuid</code> и <code>/etc/subgid</code>, указав имя пользователя/группы, начальные UID/GID и размеры диапазонов UID/GID.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/subuid</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">имя_пользователя:165536:65536</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/subgid</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">имя_пользователя:165536:65536</pre>
<p>Включите <a href="../ru/Systemd/User.html" title="Systemd (Русский)/User (Русский)">пользовательский юнит</a> <code>docker.socket</code>; благодаря ему демон Docker будет автоматически запускаться при обращении к его сокету.
</p>
<p>Наконец, задайте <a href="../ru/Environment_variables.html" title="Environment variables (Русский)">переменную окружения</a>, задающую путь к сокету демона Docker:
</p>
<pre>$ export DOCKER_HOST=unix://$XDG_RUNTIME_DIR/docker.sock
</pre>
<h3>
<span id=".D0.92.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_native_overlay_diff_engine"></span><span class="mw-headline" id="Включение_native_overlay_diff_engine">Включение native overlay diff engine</span>
</h3>
<p>Некоторые пользователи сообщают, что на их системах Docker не может использовать native overlay diff engine, что замедляет сборку образов. Если вы часто собираете образы, вы можете включить это, добавив <a href="../ru/Kernel_module.html#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%B2_%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8F" title="Kernel module (Русский)">параметры модуля ядра</a>, как описано в <a rel="nofollow" class="external autonumber" href="https://mikeshade.com/posts/docker-native-overlay-diff/">[11]</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/disable-overlay-redirect-dir.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options overlay metacopy=off redirect_dir=off</pre>
<p>После этого <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Остановите">остановите</a> <code>docker.service</code> и перезагрузите модуль <code>overlay</code>:
</p>
<pre># modprobe -r overlay
# modprobe overlay
</pre>
<p>Затем можно снова <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Запустить">запустить</a> <code>docker.service</code>.
</p>
<p>Для проверки выполните <code>docker info</code> — в строке <code>Native Overlay Diff</code> должно быть <code>true</code>.
</p>
<h2>
<span id=".D0.9E.D0.B1.D1.80.D0.B0.D0.B7.D1.8B"></span><span class="mw-headline" id="Образы">Образы</span>
</h2>
<h3><span class="mw-headline" id="Arch_Linux">Arch Linux</span></h3>
<p>Следующая команда скачивает x86_64 образ <a rel="nofollow" class="external text" href="https://hub.docker.com/_/archlinux/">archlinux</a>. Это урезанная версия ядра Arch без сети и т.д.
</p>
<pre># docker pull archlinux
</pre>
<p>Смотрите также <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archlinux-docker/blob/master/README.md">README.md</a>.
</p>
<p>Для полноценного образа Arch, клонируйте репозиторий и создайте свой собственный образ.
</p>
<pre>$ git clone <a rel="nofollow" class="external free" href="https://gitlab.archlinux.org/archlinux/archlinux-docker.git">https://gitlab.archlinux.org/archlinux/archlinux-docker.git</a>
</pre>
<p>Убедитесь, что пакеты <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=devtools">devtools</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fakechroot">fakechroot</a></span> и <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fakeroot">fakeroot</a></span> установлены.
</p>
<p>Сборка базового образа:
</p>
<pre>$ make image-base
</pre>
<h3><span class="mw-headline" id="Alpine_Linux">Alpine Linux</span></h3>
<p><a rel="nofollow" class="external text" href="https://www.alpinelinux.org/">Alpine Linux</a> — популярный выбор для создания небольших образов, особенно для статически слинкованных программ. Следующая команда скачивает свежий образ Alpine Linux:
</p>
<pre># docker pull alpine
</pre>
<p>Alpine Linux использует реализацию <a rel="nofollow" class="external text" href="https://musl.libc.org/">musl</a> libc вместо <a rel="nofollow" class="external text" href="https://www.gnu.org/software/libc/">glibc</a>, используемой в большинстве дистрибутивов Linux. Поскольку Arch Linux использует glibc, существует ряд функциональных различий между хостом Arch Linux и контейнером Alpine Linux, которые могут повлиять на производительность и корректность работы программ. Список этих различий описан <a rel="nofollow" class="external text" href="https://wiki.musl-libc.org/functional-differences-from-glibc.html">здесь</a>.
</p>
<p>Обратите внимание, что динамически слинкованные программы, собранные на Arch Linux (или любой другой системе, использующей glibc), могут иметь ошибки и проблемы с производительностью при запуске на Alpine Linux (или любой другой системе, использующей другую libc). Примеры: <a rel="nofollow" class="external autonumber" href="https://bugs.python.org/issue32307">[12]</a>, <a rel="nofollow" class="external autonumber" href="https://superuser.com/questions/1219609/why-is-the-alpine-docker-image-over-50-slower-than-the-ubuntu-image">[13]</a>, <a rel="nofollow" class="external autonumber" href="https://pythonspeed.com/articles/alpine-docker-python">[14]</a>.
</p>
<h3><span class="mw-headline" id="Debian">Debian</span></h3>
<p>Следующая команда скачивает свежий образ <a rel="nofollow" class="external text" href="https://hub.docker.com/_/debian">debian</a>:
</p>
<pre># docker pull debian
</pre>
<p>Полный список доступных тегов, включая стандартные и тонкие (slim) версии для каждого выпуска Debian, есть на странице Docker Hub.
</p>
<h3><span class="mw-headline" id="Distroless">Distroless</span></h3>
<p>Google поддерживает образы <a rel="nofollow" class="external text" href="https://github.com/GoogleContainerTools/distroless">distroless</a> — минимальные образы без компонентов ОС, таких как менеджеры пакетов или оболочки, что позволяет создавать очень маленькие образы для упаковки программ.
</p>
<p>Список образов и инструкции по их использованию с различными языками программирования есть в README на GitHub.
</p>
<h2>
<span id=".D0.A1.D0.BE.D0.B2.D0.B5.D1.82.D1.8B_.D0.B8_.D1.80.D0.B5.D0.BA.D0.BE.D0.BC.D0.B5.D0.BD.D0.B4.D0.B0.D1.86.D0.B8.D0.B8"></span><span class="mw-headline" id="Советы_и_рекомендации">Советы и рекомендации</span>
</h2>
<h3>
<span id=".D0.9F.D0.BE.D0.BB.D1.83.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_IP-.D0.B0.D0.B4.D1.80.D0.B5.D1.81.D0.B0_.D0.B7.D0.B0.D0.BF.D1.83.D1.89.D0.B5.D0.BD.D0.BD.D0.BE.D0.B3.D0.BE_.D0.BA.D0.BE.D0.BD.D1.82.D0.B5.D0.B9.D0.BD.D0.B5.D1.80.D0.B0"></span><span class="mw-headline" id="Получение_IP-адреса_запущенного_контейнера">Получение IP-адреса запущенного контейнера</span>
</h3>
<p>Чтобы получить IP адрес контейнера, выполните:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ docker inspect --format='{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' &lt;container-name OR id&gt; </pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">172.17.0.37</pre>
<p>Для каждого работающего контейнера имя и соответствующий IP-адрес могут быть перечислены для использования в <code>/etc/hosts</code>:
</p>
<pre>#!/usr/bin/env sh
for ID in $(docker ps -q | awk '{print $1}'); do
    IP=$(docker inspect --format="{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}" "$ID")
    NAME=$(docker ps | grep "$ID" | awk '{print $NF}')
    printf "%s %s\n" "$IP" "$NAME"
done</pre>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_.D0.B3.D1.80.D0.B0.D1.84.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D1.85_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D0.BC_.D0.B2.D0.BD.D1.83.D1.82.D1.80.D0.B8_.D0.BA.D0.BE.D0.BD.D1.82.D0.B5.D0.B9.D0.BD.D0.B5.D1.80.D0.B0"></span><span class="mw-headline" id="Запуск_графических_программ_внутри_контейнера">Запуск графических программ внутри контейнера</span>
</h3>
<p>В этом разделе описаны действия, необходимые для того, чтобы графические программы (в том числе те, которые используют OpenGL или Vulkan) могли работать на X-сервере хоста.
</p>
<p>Во-первых, в контейнере должны быть установлены правильные драйверы, совместимые с графическим оборудованием <b>хоста</b>. Процедура установки зависит от типа контейнера, но для контейнеров, основанных на образах Arch Linux, обратитесь к разделам <a href="../en/OpenGL.html#Installation" title="OpenGL">OpenGL#Installation</a> и <a href="../ru/Vulkan.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0" title="Vulkan (Русский)">Vulkan (Русский)#Установка</a> для получения пакетов, специфичных для вашего оборудования.
</p>
<p>Далее нужно предоставить контейнеру доступ к X-серверу хоста. В однопользовательской среде это можно легко сделать, запустив <a href="../ru/Xhost.html" title="Xhost (Русский)">Xhost</a> на хосте, который добавляет несетевые локальные соединения в список контроля доступа:
</p>
<pre>$ xhost +local:
</pre>
<p>После этого нужно добавить следующие параметры к команде <code>docker run</code>:
</p>
<ul>
<li>
<code>-e "DISPLAY=$DISPLAY"</code> для установки внутри контейнера переменной окружения <code>DISPLAY</code>, соответствующей дисплею хоста;</li>
<li>
<code>--mount type=bind,src=/tmp/.X11-unix,dst=/tmp/.X11-unix</code> для доступа к сокету X-сервера изнутри контейнера;</li>
<li>
<code>--device=/dev/dri:/dev/dri</code> для доступа к устройствам <a href="https://en.wikipedia.org/wiki/ru:Direct_Rendering_Infrastructure" class="extiw" title="wikipedia:ru:Direct Rendering Infrastructure">Direct Rendering Infrastructure</a> хоста.</li>
</ul>
<p>Для проверки можно внутри контейнера запустить <code>glxgears</code> из пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mesa-utils">mesa-utils</a></span> или <code>vkcube</code> из пакета <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=vulkan-tools">vulkan-tools</a></span>.
</p>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_.D0.BF.D1.80.D0.BE.D0.B5.D0.BA.D1.82.D0.BE.D0.B2_Docker_Compose_.D0.BF.D1.80.D0.B8_.D0.B7.D0.B0.D0.B3.D1.80.D1.83.D0.B7.D0.BA.D0.B5_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D1.8B"></span><span class="mw-headline" id="Запуск_проектов_Docker_Compose_при_загрузке_системы">Запуск проектов Docker Compose при загрузке системы</span>
</h3>
<p>Создайте юнит-шаблон для Docker Compose, параметром которого является название вашего проекта (смотрите <a href="../ru/Systemd.html#%D0%9D%D0%B0%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" title="Systemd (Русский)">systemd (Русский)#Написание файлов юнитов</a> и <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.service"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.service.5#SERVICE_TEMPLATES">systemd.service(5) § SERVICE TEMPLATES</a></span>):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/docker-compose@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=%i service with docker compose
Requires=docker.service
After=docker.service

[Service]
WorkingDirectory=/opt/%i
ExecStartPre=-/usr/bin/docker compose pull
ExecStart=/usr/bin/docker compose up --remove-orphans
ExecStop=/usr/bin/docker compose down
ExecReload=/usr/bin/docker compose pull
ExecReload=/usr/bin/docker compose up --remove-orphans

[Install]
WantedBy=multi-user.target</pre>
<p>Затем для каждого проекта, который вы хотите запускать таким образом, создайте каталог <code>/opt/<i>название_проекта</i></code>, содержащий файл Compose и другие необходимые для запуска файлы (например, <code>.env</code>). <a rel="nofollow" class="external autonumber" href="https://refspecs.linuxfoundation.org/FHS_3.0/fhs/ch03s13.html">[15]</a>
</p>
<p>После этого <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Запустите/включите">запустите/включите</a> <code>docker-compose@<i>название_проекта</i>.service</code>.
</p>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_buildx_.D0.B4.D0.BB.D1.8F_.D0.BA.D1.80.D0.BE.D1.81.D1.81-.D0.BA.D0.BE.D0.BC.D0.BF.D0.B8.D0.BB.D1.8F.D1.86.D0.B8.D0.B8"></span><span class="mw-headline" id="Использование_buildx_для_кросс-компиляции">Использование buildx для кросс-компиляции</span>
</h3>
<p><a rel="nofollow" class="external text" href="https://docs.docker.com/build/architecture/#buildx">Плагин buildx</a> использует новый набор инструментов для сборки <a rel="nofollow" class="external text" href="https://docs.docker.com/build/buildkit/">BuildKit</a>. <a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">Установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=docker-buildx">docker-buildx</a></span>. Интерфейс buildx поддерживает сборку мультиплатформенных образов, в том числе для архитектур, отличных от архитектуры хоста.
</p>
<p>Для кросс-компиляции образов требуется QEMU. Чтобы настроить статическую сборку QEMU в Docker, смотрите информацию об использовании образа <a rel="nofollow" class="external text" href="https://github.com/multiarch/qemu-user-static">multiarch/qemu-user-static</a>. В противном случае, чтобы настроить QEMU на хост-системе для использования с Docker, смотрите <a href="../en/QEMU.html#Chrooting_into_arm/arm64_environment_from_x86_64" title="QEMU">QEMU#Chrooting into arm/arm64 environment from x86_64</a>. В любом случае система будет настроена на эмуляцию гостевой архитектуры в пользовательском режиме.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ docker buildx ls</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME/NODE DRIVER/ENDPOINT STATUS  PLATFORMS
default * docker
  default default         running linux/amd64, linux/386, linux/arm64, linux/riscv64, linux/s390x, linux/arm/v7, linux/arm/v6
</pre>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_Docker-.D0.BA.D0.BE.D0.BD.D1.82.D0.B5.D0.B9.D0.BD.D0.B5.D1.80.D0.BE.D0.B2_.D1.81_.D1.83.D1.81.D0.BA.D0.BE.D1.80.D0.B5.D0.BD.D0.B8.D0.B5.D0.BC_.D0.BD.D0.B0_.D0.B3.D1.80.D0.B0.D1.84.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D1.85_.D0.BF.D1.80.D0.BE.D1.86.D0.B5.D1.81.D1.81.D0.BE.D1.80.D0.B0.D1.85_NVIDIA"></span><span class="mw-headline" id="Запуск_Docker-контейнеров_с_ускорением_на_графических_процессорах_NVIDIA">Запуск Docker-контейнеров с ускорением на графических процессорах NVIDIA</span>
</h3>
<h4>
<span id=".D0.A1_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_NVIDIA_Container_Toolkit_.28.D1.80.D0.B5.D0.BA.D0.BE.D0.BC.D0.B5.D0.BD.D0.B4.D1.83.D0.B5.D1.82.D1.81.D1.8F.29"></span><span class="mw-headline" id="С_помощью_NVIDIA_Container_Toolkit_(рекомендуется)">С помощью NVIDIA Container Toolkit (рекомендуется)</span>
</h4>
<p>Начиная с версии 19.03, графические процессоры NVIDIA поддерживаются в качестве устройств Docker. <a rel="nofollow" class="external text" href="https://github.com/NVIDIA/nvidia-container-toolkit">NVIDIA Container Toolkit</a> ― рекомендуемый способ запуска контейнеров, использующих графические процессоры NVIDIA.
</p>
<p>Установите пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvidia-container-toolkit">nvidia-container-toolkit</a></span> и <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">перезапустите</a> Docker. Теперь вы можете запускать контейнеры Docker, использующие графические процессоры NVIDIA, с помощью параметра <code>--gpus</code>:
</p>
<pre># docker run --gpus all nvidia/cuda:12.1.1-runtime-ubuntu22.04 nvidia-smi
</pre>
<p>Укажите, сколько графических процессоров разрешено в контейнере:
</p>
<pre># docker run --gpus 2 nvidia/cuda:12.1.1-runtime-ubuntu22.04 nvidia-smi
</pre>
<p>Укажите, какие GPU следует использовать:
</p>
<pre># docker run --gpus '"device=1,2"' nvidia/cuda:12.1.1-runtime-ubuntu22.04 nvidia-smi
</pre>
<p>или
</p>
<pre># docker run --gpus '"device=UUID-ABCDEF,1"' nvidia/cuda:12.1.1-runtime-ubuntu22.04 nvidia-smi
</pre>
<p>Если при использовании вышеуказанных команд вы получаете ошибку типа <code>Failed to initialize NVML: Unknown Error</code>, вы можете попробовать более точно указать GPU:
</p>
<pre># docker run --gpus all --device /dev/nvidiactl:/dev/nvidiactl --device /dev/nvidia-uvm:/dev/nvidia-uvm --device /dev/nvidia0:/dev/nvidia0 nvidia/cuda:12.1.1-runtime-ubuntu22.04 nvidia-smi
</pre>
<p>Укажите возможности ("graphics", "compute", ...) контейнера (хотя это редко, если вообще когда либо используется таким образом):
</p>
<pre># docker run --gpus all,capabilities=utility nvidia/cuda:12.1.1-runtime-ubuntu22.04 nvidia-smi
</pre>
<p>Для получения дополнительной информации смотрите <a rel="nofollow" class="external text" href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/index.html">документацию</a> и <a rel="nofollow" class="external text" href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html">руководство по установке</a>.
</p>
<p>Если у вас установлен <a href="../en/VirtualGL.html" title="VirtualGL">VirtualGL</a> и вы получаете ошибку NVML, замените
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nvidia-container-runtime/config.toml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#user = "root:video"</pre>
<p>на
</p>
<pre>user = "root:root"
</pre>
<p>Подробнее об этой проблеме в <a rel="nofollow" class="external text" href="https://github.com/NVIDIA/nvidia-docker/issues/1547">NVIDIA/nvidia-docker на GitHub</a>.
</p>
<h4>
<span id=".D0.A1_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_NVIDIA_Container_Runtime"></span><span class="mw-headline" id="С_помощью_NVIDIA_Container_Runtime">С помощью NVIDIA Container Runtime</span>
</h4>
<p>Установите пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nvidia-container-runtime/">nvidia-container-runtime</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" class="mw-redirect" title="ArchWiki:Requests">ссылка недействительна</a>: package not found]</sup>. Затем, зарегистрируйте среду выполнения NVIDIA, отредактировав конфигурационный файл <code>/etc/docker/daemon.json</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "runtimes": {
    "nvidia": {
      "path": "/usr/bin/nvidia-container-runtime",
      "runtimeArgs": []
    }
  }
}</pre>
<p>и <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">перезапустите</a> docker.
</p>
<p>Среда выполнения также может быть зарегистрирована с помощью параметра командной строки <i>dockerd</i>:
</p>
<pre># /usr/bin/dockerd --add-runtime=nvidia=/usr/bin/nvidia-container-runtime
</pre>
<p>После этого контейнеры с ускорением на графических процессорах могут быть запущены с помощью следующей команды:
</p>
<pre># docker run --runtime=nvidia nvidia/cuda:9.0-base nvidia-smi
</pre>
<p>или (требуется Docker версии 19.03 или выше):
</p>
<pre># docker run --gpus all nvidia/cuda:9.0-base nvidia-smi
</pre>
<p>Смотрите также <a rel="nofollow" class="external text" href="https://github.com/NVIDIA/nvidia-container-runtime/blob/master/README.md">README.md</a>.
</p>
<h4>
<span id=".D0.A1_.D0.BF.D0.BE.D0.BC.D0.BE.D1.89.D1.8C.D1.8E_nvidia-docker_.28.D1.83.D1.81.D1.82.D0.B0.D1.80.D0.B5.D0.BB.D0.BE.29"></span><span class="mw-headline" id="С_помощью_nvidia-docker_(устарело)">С помощью nvidia-docker (устарело)</span>
</h4>
<p><a rel="nofollow" class="external text" href="https://nvidia.github.io/nvidia-docker/">nvidia-docker</a> — обёртка над библиотекой среды исполнения NVIDIA Container Runtime, которая регистрирует среду выполнения NVIDIA по умолчанию и предоставляет команду <i>nvidia-docker</i>.
</p>
<p>Чтобы использовать nvidia-docker, установите пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nvidia-docker/">nvidia-docker</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" class="mw-redirect" title="ArchWiki:Requests">ссылка недействительна</a>: package not found]</sup> и <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">перезапустите</a> Docker. Контейнеры с поддержкой NVIDIA GPU могут быть запущены, используя один из следующих методов:
</p>
<pre># docker run --runtime=nvidia nvidia/cuda:9.0-base nvidia-smi
</pre>
<pre># nvidia-docker run nvidia/cuda:9.0-base nvidia-smi
</pre>
<p>или (требуется Docker версии 19.03 или выше)
</p>
<pre># docker run --gpus all nvidia/cuda:9.0-base nvidia-smi
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> nvidia-docker — устаревший метод запуска Docker-контейнеров с ускорением на графических процессорах NVIDIA, использующийся в версиях Docker, предшествующих версии 19.03. Если вы используете Docker версии 19.03 или выше, рекомендуется использовать <a href="#%D0%A1_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_NVIDIA_Container_Toolkit_(%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D1%83%D0%B5%D1%82%D1%81%D1%8F)">NVIDIA Container Toolkit</a>.</div>
<h4>
<span id=".D0.9E.D0.B1.D1.80.D0.B0.D0.B7_Arch_Linux_.D1.81_CUDA"></span><span class="mw-headline" id="Образ_Arch_Linux_с_CUDA">Образ Arch Linux с CUDA</span>
</h4>
<p>Можно использовать следующий <code>Dockerfile</code> для создания собственного образа Arch Linux с CUDA. Он использует <a rel="nofollow" class="external text" href="https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/syntax.md">Dockerfile frontend syntax 1.2</a> для кэширования пакетов pacman на хосте. Перед запуском сборки нужно установить <a href="../ru/Environment_variables.html" title="Environment variables (Русский)">переменную окружения</a> <code>DOCKER_BUILDKIT=1</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">Dockerfile</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># syntax = docker/dockerfile:1.2

FROM archlinux

# установка пакетов
RUN --mount=type=cache,sharing=locked,target=/var/cache/pacman \
    pacman -Syu --noconfirm --needed base base-devel cuda

# настройка nvidia container runtime
# https://github.com/NVIDIA/nvidia-container-runtime#environment-variables-oci-spec
ENV NVIDIA_VISIBLE_DEVICES all
ENV NVIDIA_DRIVER_CAPABILITIES compute,utility
</pre>
<h2>
<span id=".D0.A3.D0.B4.D0.B0.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_Docker_.D0.B8_.D0.BE.D0.B1.D1.80.D0.B0.D0.B7.D0.BE.D0.B2"></span><span class="mw-headline" id="Удаление_Docker_и_образов">Удаление Docker и образов</span>
</h2>
<p>Если вы хотите полностью удалить Docker, вам следует выполнить следующие шаги:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Не копируйте бездумно эти команды, не убедившись, что вы знаете, что делаете.</div>
<p>Выдать список работающих контейнеров:
</p>
<pre># docker ps
</pre>
<p>Выдать список всех контейнеров, запущенных на хосте для удаления:
</p>
<pre># docker ps -a
</pre>
<p>Остановить работающий контейнер:
</p>
<pre># docker stop &lt;CONTAINER ID&gt;
</pre>
<p>Выполнить команду kill для всё ещё работающих контейнеров:
</p>
<pre># docker kill &lt;CONTAINER ID&gt;
</pre>
<p>Удалить все контейнеры, перечисленные по ID:
</p>
<pre># docker rm &lt;CONTAINER ID&gt;
</pre>
<p>Выдать список всех образов Docker:
</p>
<pre># docker images
</pre>
<p>Удалить все образы Docker по ID:
</p>
<pre># docker rmi &lt;IMAGE ID&gt;
</pre>
<p>Удалить все образы, контейнеры, тома и сети, которые не связаны с контейнерами (висячие):
</p>
<pre># docker system prune
</pre>
<p>Чтобы дополнительно удалить все остановленные контейнеры и все неиспользуемые образы (не только висячие), добавьте к команде флаг -a:
</p>
<pre># docker system prune -a
</pre>
<p>Удалить все данные Docker (очистить каталог):
</p>
<pre># rm -R /var/lib/docker
</pre>
<h2>
<span id=".D0.A0.D0.B5.D1.88.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC"></span><span class="mw-headline" id="Решение_проблем">Решение проблем</span>
</h2>
<h3>
<span id="docker0_Bridge_.D0.BD.D0.B5_.D0.BF.D0.BE.D0.BB.D1.83.D1.87.D0.B0.D0.B5.D1.82_IP_.2F_.D0.BD.D0.B5.D1.82_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF.D0.B0_.D0.BA_.D0.98.D0.BD.D1.82.D0.B5.D1.80.D0.BD.D0.B5.D1.82.D1.83_.D0.B2_.D0.BA.D0.BE.D0.BD.D1.82.D0.B5.D0.B9.D0.BD.D0.B5.D1.80.D0.B0.D1.85_.D0.BF.D1.80.D0.B8_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B8_systemd-networkd"></span><span class="mw-headline" id="docker0_Bridge_не_получает_IP_/_нет_доступа_к_Интернету_в_контейнерах_при_использовании_systemd-networkd">docker0 Bridge не получает IP / нет доступа к Интернету в контейнерах при использовании systemd-networkd</span>
</h3>
<p>Docker пытается включить пересылку (forwarding) IP-пакетов глобально, но по умолчанию <a href="../ru/Systemd-networkd.html" title="Systemd-networkd (Русский)">systemd-networkd</a> переопределяет глобальную настройку sysctl настройками конкретных сетевых профилей. Укажите <code>IPForward=yes</code> в сетевом профиле. Подробнее в разделе <a href="../ru/Internet_sharing.html#%D0%A0%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D0%B8%D1%82%D0%B5_%D0%BF%D0%B5%D1%80%D0%B5%D1%81%D1%8B%D0%BB%D0%BA%D1%83_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Раздача интернета">Раздача интернета#Разрешите пересылку пакетов</a>.
</p>
<p>Когда <a href="../ru/Systemd-networkd.html" title="Systemd-networkd (Русский)">systemd-networkd</a> пытается управлять сетевыми интерфейсами, которые создал Docker, например, когда вы прописали <code>Name=*</code> в секции <code>Match</code>, это может привести к проблемам с подключением. Решить их можно сужением выбора интерфейсов, то есть избегайте использования <code>Name=*</code> или других масок, которые соответствуют сетевым интерфейсам Docker. Убедитесь, что <code>networkctl list</code> в столбце SETUP сообщает <code>unmanaged</code> для таких интерфейсов.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Вам может понадобится <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" title="Help:Reading (Русский)">перезапускать</a> <code>docker.service</code> каждый раз, когда вы выполняете <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" title="Help:Reading (Русский)">перезапуск</a> <code>systemd-networkd.service</code> или <code>iptables.service</code>.</li>
<li>Также имейте в виду, что <a href="../ru/Nftables.html" title="Nftables (Русский)">nftables</a> может блокировать соединения docker по умолчанию. Используйте <code>nft list ruleset</code>, чтобы проверить наличие блокирующих правил. <code>nft flush chain inet filter forward</code> временно удаляет все правила пересылки. Отредактируйте <code>/etc/nftables.conf</code>, чтобы сделать изменения постоянными. Не забудьте <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустить">перезапустить</a> <code>nftables.service</code> для применения изменений из файла. Подробнее о поддержке nftables в Docker: <a rel="nofollow" class="external autonumber" href="https://github.com/moby/moby/issues/26824">[16]</a>.</li>
</ul>
</div>
<h3>
<span id=".D0.A1.D0.BB.D0.B8.D1.88.D0.BA.D0.BE.D0.BC_.D0.BC.D0.B0.D0.BB.D0.B5.D0.BD.D1.8C.D0.BA.D0.BE.D0.B5_.D1.80.D0.B0.D0.B7.D1.80.D0.B5.D1.88.D1.91.D0.BD.D0.BD.D0.BE.D0.B5_.D0.BA.D0.BE.D0.BB.D0.B8.D1.87.D0.B5.D1.81.D1.82.D0.B2.D0.BE_.D0.BF.D1.80.D0.BE.D1.86.D0.B5.D1.81.D1.81.D0.BE.D0.B2.2F.D0.BF.D0.BE.D1.82.D0.BE.D0.BA.D0.BE.D0.B2_.D0.BF.D0.BE_.D1.83.D0.BC.D0.BE.D0.BB.D1.87.D0.B0.D0.BD.D0.B8.D1.8E"></span><span class="mw-headline" id="Слишком_маленькое_разрешённое_количество_процессов/потоков_по_умолчанию">Слишком маленькое разрешённое количество процессов/потоков по умолчанию</span>
</h3>
<p>Если вы столкнетесь с сообщениями об ошибках, похожими на следующие:
</p>
<pre># e.g. Java
java.lang.OutOfMemoryError: unable to create new native thread
# e.g. C, bash, ...
fork failed: Resource temporarily unavailable
</pre>
<p>то вам, возможно, необходимо изменить количество процессов, разрешённых systemd. <a href="../ru/Systemd.html#%D0%A0%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Отредактируйте">Отредактируйте</a> юнит <code>docker.service</code> следующим образом:
</p>
<pre>[Service]
TasksMax=infinity
</pre>
<p>Подробнее смотрите <code>DefaultLimitNPROC</code> в <span class="plainlinks archwiki-template-man" title="$ man 5 systemd-system.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-system.conf.5#OPTIONS">systemd-system.conf(5) § OPTIONS</a></span> и <code>TasksMax</code> в <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.resource-control"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.resource-control.5#OPTIONS">systemd.resource-control(5) § OPTIONS</a></span>.
</p>
<h3><span class="mw-headline" id="Error_initializing_graphdriver:_devmapper">Error initializing graphdriver: devmapper</span></h3>
<p>Если <i>systemctl</i> не запускает Docker и выдаёт ошибку:
</p>
<pre>Error starting daemon: error initializing graphdriver: devmapper: Device docker-8:2-915035-pool is not a thin pool
</pre>
<p>Попробуйте выполнить следующие действия, чтобы устранить ошибку. Остановите службу, сделайте резервную копию <code>/var/lib/docker/</code> (если это необходимо), удалите содержимое <code>/var/lib/docker/</code> и попробуйте запустить службу. Смотрите <a rel="nofollow" class="external text" href="https://github.com/docker/docker/issues/21304">описание проблемы на GitHub</a><sup title="Статус последней проверки: 404">[<a href="https://en.wikipedia.org/wiki/ru:%D0%92%D0%B8%D0%BA%D0%B8%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F:%D0%9C%D1%91%D1%80%D1%82%D0%B2%D1%8B%D0%B5_%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8" class="extiw" title="wikipedia:ru:Википедия:Мёртвые ссылки">устаревшая ссылка</a> 2024-12-15 ⓘ]</sup> для более подробной информации.
</p>
<h3>
<span id="Failed_to_create_some.2Fpath.2Fto.2Ffile:_No_space_left_on_device"></span><span class="mw-headline" id="Failed_to_create_some/path/to/file:_No_space_left_on_device">Failed to create some/path/to/file: No space left on device</span>
</h3>
<p>Если вы получаете сообщение об ошибке, подобное этому:
</p>
<pre>ERROR: Failed to create some/path/to/file: No space left on device
</pre>
<p>при создании или исполнении Docker образа, даже если у вас достаточно свободного места на диске, убедитесь, что:
</p>
<ul>
<li>
<a href="../ru/Tmpfs.html" title="Tmpfs (Русский)">Tmpfs</a> отключен или имеет достаточно памяти. Docker может пытаться записать файлы в <code>/tmp</code>, но терпит неудачу из-за ограничений в использовании памяти, а не дискового пространства.</li>
<li>Если вы используете <a href="../ru/XFS.html" title="XFS (Русский)">XFS</a>, вы можете удалить опцию монтирования <code>noquota</code> из соответствующих записей в <code>/etc/fstab</code> (обычно тех, на которых находятся <code>/tmp</code> и/или <code>/var/lib/docker</code>). Для получения дополнительной информации обратитесь к <a href="../en/Disk_quota.html" title="Disk quota">Disk quota</a>, особенно, если вы планируете использовать и изменить размер <code>overlay2</code> Docker хранилища.</li>
<li>Варианты установки монтирования квоты XFS (<code>uquota</code>, <code>gquota</code>, <code>prjquota</code>, и т.д.) выдают ошибку при перемонтировании файловой системы. Чтобы включить квоту для корневой файловой системы, параметр монтирования должен быть передан как <a href="../ru/Kernel_parameters.html" class="mw-redirect" title="Параметр ядра">параметр ядра</a> <code>rootflags=</code>. Впоследствии его не следует указывать среди параметров монтирования в <code>/etc/fstab</code> для корневой файловой системы (<code>/</code>).</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Есть некоторые отличия XFS Quota по сравнению со стандартом Linux <a href="../en/Disk_quota.html" title="Disk quota">Disk quota</a>, <a rel="nofollow" class="external autonumber" href="https://inai.de/linux/adm_quota">[17]</a> рекомендуется к прочтению.</div>
<h3>
<span id="Docker-machine_.D0.BD.D0.B5_.D0.BC.D0.BE.D0.B6.D0.B5.D1.82_.D1.81.D0.BE.D0.B7.D0.B4.D0.B0.D1.82.D1.8C_.D0.B2.D0.B8.D1.80.D1.82.D1.83.D0.B0.D0.BB.D1.8C.D0.BD.D1.8B.D0.B5_.D0.BC.D0.B0.D1.88.D0.B8.D0.BD.D1.8B_.D1.81_.D0.B4.D1.80.D0.B0.D0.B9.D0.B2.D0.B5.D1.80.D0.BE.D0.BC_virtualbox"></span><span class="mw-headline" id="Docker-machine_не_может_создать_виртуальные_машины_с_драйвером_virtualbox">Docker-machine не может создать виртуальные машины с драйвером virtualbox</span>
</h3>
<p>Если docker-machine не может создать виртуальные машины с драйвером virtualbox и отображает следующую ошибку:
</p>
<pre>VBoxManage: error: VBoxNetAdpCtl: Error while adding new interface: failed to open /dev/vboxnetctl: No such file or directory
</pre>
<p>Перезагрузите virtualbox из командной строки с помощью команды <code>vboxreload</code>.
</p>
<h3>
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_Docker_.D0.BB.D0.BE.D0.BC.D0.B0.D0.B5.D1.82_.D1.81.D0.B5.D1.82.D0.B5.D0.B2.D0.BE.D0.B9_.D0.BC.D0.BE.D1.81.D1.82_KVM"></span><span class="mw-headline" id="Запуск_Docker_ломает_сетевой_мост_KVM">Запуск Docker ломает сетевой мост KVM</span>
</h3>
<p>Проблема в том, что скрипты Docker добавляют некоторые правила iptables для блокировки пересылки на другие интерфейсы, кроме своего собственного. Это <a rel="nofollow" class="external text" href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=865975">известная проблема</a>.
</p>
<p>В примерах ниже замените br0 на имя своего моста.
</p>
<p>Самое быстрое решение (но отключает все правила iptables, которые добавляет Docker, что может оказаться не тем, что вы хотите):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "iptables": false
}</pre>
<p>Если для KVM уже настроен сетевой мост, проблему можно решить, попросив docker использовать этот самый мост: <a rel="nofollow" class="external autonumber" href="https://muthii.com/blog/?p=540">[18]</a>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "bridge": "br0"
}</pre>
<p>Если это не работает или вы предпочитаете решать проблему через iptables напрямую или через менеджер вроде UFW, добавьте следующее:
</p>
<pre>iptables -I FORWARD -i br0 -o br0 -j ACCEPT</pre>
<p>Более подробные решения можно почитать <a rel="nofollow" class="external text" href="https://serverfault.com/questions/963759/docker-breaks-libvirt-bridge-network">здесь</a>.
</p>
<h3>
<span id=".D0.9E.D0.B3.D1.80.D0.B0.D0.BD.D0.B8.D1.87.D0.B5.D0.BD.D0.B8.D1.8F_.D0.BD.D0.B0_.D1.81.D0.BA.D0.B0.D1.87.D0.B8.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BE.D0.B1.D1.80.D0.B0.D0.B7.D0.BE.D0.B2_.D1.81_Docker_Hub"></span><span class="mw-headline" id="Ограничения_на_скачивание_образов_с_Docker_Hub">Ограничения на скачивание образов с Docker Hub</span>
</h3>
<p>С 1 ноября 2020 года для загрузок из Docker Hub с анонимных и бесплатных аккаунтов включены лимиты (rate limiting). Подробнее в <a rel="nofollow" class="external text" href="https://docs.docker.com/docker-hub/download-rate-limit/">документации</a>.
</p>
<p>Лимиты для неаутентифицированных пользователей отслеживаются по IP-адресу, а для аутентифицированных — по учётной записи.
</p>
<p>Если вам нужно превысить лимиты, вы можете либо <a rel="nofollow" class="external text" href="https://www.docker.com/pricing">использовать платный тарифный план</a>, либо сделать зеркало нужных вам образов в другом реестре. Вы можете <a rel="nofollow" class="external text" href="https://docs.docker.com/registry/">создать свой собственный реестр</a> или использовать облачный хостинг, например <a rel="nofollow" class="external text" href="https://aws.amazon.com/ecr/">Amazon ECR</a>, <a rel="nofollow" class="external text" href="https://cloud.google.com/container-registry/">Google Container Registry</a>, <a rel="nofollow" class="external text" href="https://azure.microsoft.com/en-us/services/container-registry/">Azure Container Registry</a> или <a rel="nofollow" class="external text" href="https://quay.io/">Quay Container Registry</a>.
</p>
<p>Чтобы создать зеркало образа, используйте <code>pull</code>, <code>tag</code> и <code>push</code> в Docker CLI. Пример создания зеркала образа Nginx 1.19.3 в реестре <code>cr.example.com</code>:
</p>
<pre>$ docker pull nginx:1.19.3
$ docker tag nginx:1.19.3 cr.example.com/nginx:1.19.3
$ docker push cr.example.com/nginx:1.19.3
</pre>
<p>После этого можно скачивать или запускать образы с зеркала:
</p>
<pre>$ docker pull cr.example.com/nginx:1.19.3
$ docker run cr.example.com/nginx:1.19.3
</pre>
<h3>
<span id="iptables_.28legacy.29:_unknown_option_.22--dport.22"></span><span class="mw-headline" id='iptables_(legacy):_unknown_option_"--dport"'>iptables (legacy): unknown option "--dport"</span>
</h3>
<p>Если возникает такая ошибка при запуске контейнера, установите <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iptables-nft">iptables-nft</a></span> вместо <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iptables">iptables</a></span> (legacy) и перезагрузитесь <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=256709">[19]</a>.
</p>
<h3>
<span id=".22Your_password_will_be_stored_unencrypted.22_.D0.BF.D1.80.D0.B8_.D0.B2.D1.8B.D0.BF.D0.BE.D0.BB.D0.BD.D0.B5.D0.BD.D0.B8.D0.B8_docker_login"></span><span class="mw-headline" id='"Your_password_will_be_stored_unencrypted"_при_выполнении_docker_login'>"Your password will be stored unencrypted" при выполнении docker login</span>
</h3>
<p><a rel="nofollow" class="external text" href="https://docs.docker.com/engine/reference/commandline/login/#credentials-store">По умолчанию</a> Docker попытается использовать <code>pass</code> или <code>secretservice</code> для хранения паролей в реестре. Если он не найдёт эти программы, то сохранит пароли в виде обычного текста (закодированного в base64) в файле <code>$HOME/.docker/config.json</code> и выведет следующее сообщение после успешного входа в систему:
</p>
<pre>$ WARNING! Your password will be stored unencrypted in /home/<i>пользователь</i>/.docker/config.json.
</pre>
<p>Если вы используете менеджер паролей, реализующий <a rel="nofollow" class="external text" href="https://specifications.freedesktop.org/secret-service-spec/latest/">Secret Service Freedesktop DBUS API</a>, например, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=kwallet">kwallet</a></span> из KDE или <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnome-keyring">gnome-keyring</a></span> из GNOME, вы можете установить пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/docker-credential-secretservice/">docker-credential-secretservice</a></span><sup><small>AUR</small></sup>, чтобы хранить пароли в своём менеджере.
</p>
<h3>
<span id=".22Could_not_find_an_available.2C_non-overlapping_IPv4_address_pool_among_the_defaults_to_assign_to_the_network.22"></span><span class="mw-headline" id='"Could_not_find_an_available,_non-overlapping_IPv4_address_pool_among_the_defaults_to_assign_to_the_network"'>"Could not find an available, non-overlapping IPv4 address pool among the defaults to assign to the network"</span>
</h3>
<p>Иногда при использовании большого числа проектов на Docker (например, при использовании docker-compose), может случиться так, что у вас закончатся IP-адреса для контейнеров, что приведёт к возникновению ошибки:
</p>
<pre>Could not find an available, non-overlapping IPv4 address pool among the defaults to assign to the network
</pre>
<p>Как описано <a rel="nofollow" class="external text" href="https://github.com/docker/docs/issues/8663">здесь</a>, значения по умолчанию такие:
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Тип</th>
<th>Размер по умолчанию</th>
<th>Пул по умолчанию
</th>
</tr>
<tr>
<td>local</td>
<td>/16</td>
<td>172.17.0.0/12
</td>
</tr>
<tr>
<td>local*</td>
<td>/20</td>
<td>192.168.0.0/16
</td>
</tr>
</tbody>
</table>
<p>Это можно легко исправить увеличением IP-пространства Docker через настройку <code>default-address-pools</code> в файле <code>/etc/docker/daemon.json</code>. Увеличьте первый диапазон с 16 до 24, а второй диапазон не трогайте, чтобы избежать коллизий в локальной сети:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  ...
  "default-address-pools" : [
    {
      "base" : "172.17.0.0/12",
      "size" : 24
    },
    {
      "base" : "192.168.0.0/16",
      "size" : 24
    }
  ]
}</pre>
<p><a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">Перезапустите</a> <code>docker.service</code> для применения изменений.
</p>
<p>Более подробную информацию можно почитать в статье <a rel="nofollow" class="external text" href="https://straz.to/2021-09-08-docker-address-pools/">The definitive guide to docker's default-address-pools option</a>.
</p>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.docker.com">Официальный сайт</a></li>
<li><a rel="nofollow" class="external text" href="https://docs.docker.com/engine/installation/linux/archlinux/">Arch Linux на docs.docker.com</a></li>
<li>
<a rel="nofollow" class="external text" href="https://opensource.com/business/14/7/docker-security-selinux">Are Docker containers really secure?</a> — opensource.com</li>
<li>
<a rel="nofollow" class="external text" href="https://awesome-docker.netlify.com/">Awesome Docker</a><sup title="Статус последней проверки: 404">[<a href="https://en.wikipedia.org/wiki/ru:%D0%92%D0%B8%D0%BA%D0%B8%D0%BF%D0%B5%D0%B4%D0%B8%D1%8F:%D0%9C%D1%91%D1%80%D1%82%D0%B2%D1%8B%D0%B5_%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8" class="extiw" title="wikipedia:ru:Википедия:Мёртвые ссылки">устаревшая ссылка</a> 2024-07-30 ⓘ]</sup>
</li>
<li><a rel="nofollow" class="external text" href="https://www.trendmicro.com/en_us/research/19/l/why-running-a-privileged-container-in-docker-is-a-bad-idea.html">Why A Privileged Container in Docker Is a Bad Idea</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../ru/Category:Virtualization.html" title="Category:Virtualization (Русский)">Virtualization (Русский)</a></li>
<li><a href="../ru/Category:Sandboxing.html" title="Category:Sandboxing (Русский)">Sandboxing (Русский)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Docker_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=823135">https://wiki.archlinux.org/index.php?title=Docker_(Русский)&amp;oldid=823135</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 15 December 2024, at 08:26.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
