<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>systemd (Русский)/User (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Systemd_Русский_User_Русский rootpage-Systemd_Русский skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Как_это_работает" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%9A%D0%B0%D0%BA_%D1%8D%D1%82%D0%BE_%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Как это работает</div>
		</a>
		
		<ul id="toc-Как_это_работает-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Основные_настройки" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Основные настройки</div>
		</a>
		
			<button aria-controls="toc-Основные_настройки-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Основные настройки subsection</span>
			</button>
		
		<ul id="toc-Основные_настройки-sublist" class="vector-toc-list">
			<li id="toc-Переменные_окружения" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5_%D0%BE%D0%BA%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Переменные окружения</div>
			</a>
			
			<ul id="toc-Переменные_окружения-sublist" class="vector-toc-list">
				<li id="toc-Пример_службы" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80_%D1%81%D0%BB%D1%83%D0%B6%D0%B1%D1%8B">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.1</span>Пример службы</div>
			</a>
			
			<ul id="toc-Пример_службы-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-DISPLAY_и_XAUTHORITY" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#DISPLAY_%D0%B8_XAUTHORITY">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.2</span>DISPLAY и XAUTHORITY</div>
			</a>
			
			<ul id="toc-DISPLAY_и_XAUTHORITY-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-PATH" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#PATH">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.3</span>PATH</div>
			</a>
			
			<ul id="toc-PATH-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-pam_env" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#pam_env">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.4</span>pam_env</div>
			</a>
			
			<ul id="toc-pam_env-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Автоматический_запуск_systemd_от_имени_пользователя" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_systemd_%D0%BE%D1%82_%D0%B8%D0%BC%D0%B5%D0%BD%D0%B8_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Автоматический запуск systemd от имени пользователя</div>
			</a>
			
			<ul id="toc-Автоматический_запуск_systemd_от_имени_пользователя-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Написание_пользовательских_юнитов" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%9D%D0%B0%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D1%81%D0%BA%D0%B8%D1%85_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Написание пользовательских юнитов</div>
		</a>
		
			<button aria-controls="toc-Написание_пользовательских_юнитов-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Написание пользовательских юнитов subsection</span>
			</button>
		
		<ul id="toc-Написание_пользовательских_юнитов-sublist" class="vector-toc-list">
			<li id="toc-Пример" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Пример</div>
			</a>
			
			<ul id="toc-Пример-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Пример_с_переменными" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80_%D1%81_%D0%BF%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%BC%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Пример с переменными</div>
			</a>
			
			<ul id="toc-Пример_с_переменными-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Чтение_журнала" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A7%D1%82%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B6%D1%83%D1%80%D0%BD%D0%B0%D0%BB%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Чтение журнала</div>
			</a>
			
			<ul id="toc-Чтение_журнала-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Временные_файлы" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%92%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D1%8B">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Временные файлы</div>
		</a>
		
		<ul id="toc-Временные_файлы-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Xorg_и_systemd" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Xorg_%D0%B8_systemd">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Xorg и systemd</div>
		</a>
		
			<button aria-controls="toc-Xorg_и_systemd-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Xorg и systemd subsection</span>
			</button>
		
		<ul id="toc-Xorg_и_systemd-sublist" class="vector-toc-list">
			<li id="toc-Автоматический_логин_в_Xorg_без_экранного_менеджера" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%BB%D0%BE%D0%B3%D0%B8%D0%BD_%D0%B2_Xorg_%D0%B1%D0%B5%D0%B7_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE_%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Автоматический логин в Xorg без экранного менеджера</div>
			</a>
			
			<ul id="toc-Автоматический_логин_в_Xorg_без_экранного_менеджера-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Xorg_как_пользовательская_служба_systemd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Xorg_%D0%BA%D0%B0%D0%BA_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D1%81%D0%BA%D0%B0%D1%8F_%D1%81%D0%BB%D1%83%D0%B6%D0%B1%D0%B0_systemd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Xorg как пользовательская служба systemd</div>
			</a>
			
			<ul id="toc-Xorg_как_пользовательская_служба_systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Некоторые_случаи_использования" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%9D%D0%B5%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D1%8B%D0%B5_%D1%81%D0%BB%D1%83%D1%87%D0%B0%D0%B8_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Некоторые случаи использования</div>
		</a>
		
			<button aria-controls="toc-Некоторые_случаи_использования-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Некоторые случаи использования subsection</span>
			</button>
		
		<ul id="toc-Некоторые_случаи_использования-sublist" class="vector-toc-list">
			<li id="toc-Постоянный_терминальный_мультиплексор" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%BD%D1%8B%D0%B9_%D1%82%D0%B5%D1%80%D0%BC%D0%B8%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D0%BC%D1%83%D0%BB%D1%8C%D1%82%D0%B8%D0%BF%D0%BB%D0%B5%D0%BA%D1%81%D0%BE%D1%80">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>Постоянный терминальный мультиплексор</div>
			</a>
			
			<ul id="toc-Постоянный_терминальный_мультиплексор-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Оконный_менеджер" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9E%D0%BA%D0%BE%D0%BD%D0%BD%D1%8B%D0%B9_%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2</span>Оконный менеджер</div>
			</a>
			
			<ul id="toc-Оконный_менеджер-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Завершение_процессов_пользователя_при_выходе_из_системы" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%97%D0%B0%D0%B2%D0%B5%D1%80%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BE%D0%B2_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F_%D0%BF%D1%80%D0%B8_%D0%B2%D1%8B%D1%85%D0%BE%D0%B4%D0%B5_%D0%B8%D0%B7_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Завершение процессов пользователя при выходе из системы</div>
		</a>
		
		<ul id="toc-Завершение_процессов_пользователя_при_выходе_из_системы-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Решение_проблем" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%A0%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>Решение проблем</div>
		</a>
		
			<button aria-controls="toc-Решение_проблем-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Решение проблем subsection</span>
			</button>
		
		<ul id="toc-Решение_проблем-sublist" class="vector-toc-list">
			<li id="toc-Runtime_directory_'/run/user/1000'_is_not_owned_by_UID_1000,_as_it_should" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Runtime_directory_'/run/user/1000'_is_not_owned_by_UID_1000,_as_it_should">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.1</span>Runtime directory '/run/user/1000' is not owned by UID 1000, as it should</div>
			</a>
			
			<ul id="toc-Runtime_directory_'/run/user/1000'_is_not_owned_by_UID_1000,_as_it_should-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Смотрите_также" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">9</span>Смотрите также</div>
		</a>
		
		<ul id="toc-Смотрите_также-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">systemd (Русский)/User (Русский)</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 5 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-5" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">5 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-en mw-list-item"><a href="../../en/Systemd/User.html" title="Systemd/User – English" lang="en" hreflang="en" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-fr mw-list-item"><a href="../../fr/Systemd/User.html" title="Systemd (Français)/User – français" lang="fr" hreflang="fr" class="interlanguage-link-target"><span>Français</span></a></li>
<li class="interlanguage-link interwiki-it mw-list-item"><a href="../../it/Systemd/User.html" title="Systemd (Italiano)/User – italiano" lang="it" hreflang="it" class="interlanguage-link-target"><span>Italiano</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Systemd/%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC" title="Systemd/ユーザー – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Systemd/User" title="Systemd/User – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <a href="../../ru/Systemd.html" title="Systemd (Русский)">Systemd (Русский)</a>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="ru" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-meta-related-articles">
<p>Ссылки по теме</p>
<ul>
<li><a href="../../ru/Systemd.html" title="Systemd (Русский)">systemd (Русский)</a></li>
<li><a href="../../ru/Getty.html#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%B2%D1%85%D0%BE%D0%B4_%D0%B2_%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D1%83%D1%8E_%D0%BA%D0%BE%D0%BD%D1%81%D0%BE%D0%BB%D1%8C" class="mw-redirect" title="Автоматический вход в виртуальную консоль">Автоматический вход в виртуальную консоль</a></li>
<li><a href="../../ru/Xinit.html#%D0%90%D0%B2%D1%82%D0%BE%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_X_%D0%BF%D1%80%D0%B8_%D0%B2%D1%85%D0%BE%D0%B4%D0%B5_%D0%B2_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%83" class="mw-redirect" title="Xinitrc (Русский)">xinitrc (Русский)#Автозапуск X при входе в систему</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../../en/Systemd/User.html" title="Systemd/User">systemd/User</a>. Дата последней синхронизации: 12 июля 2021. Вы можете <a href="../../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Systemd/User&amp;diff=0&amp;oldid=679973">изменения</a>.</div>
<p><a href="../../ru/Systemd.html" title="Systemd (Русский)">systemd</a> позволяет пользователю управлять службами в личном, отдельном экземпляре systemd. Благодаря этому пользователь может запускать, останавливать, включать и отключать свои собственные юниты. Это очень удобно в случае демонов и служб, которые обычно запускаются для отдельного пользователя (<a href="../../en/Music_Player_Daemon.html" title="Music Player Daemon">mpd</a>), или выполнения автоматизированных задач (например, скачивание почты).
</p>
<meta property="mw:PageProp/toc">
<h2>
<span id=".D0.9A.D0.B0.D0.BA_.D1.8D.D1.82.D0.BE_.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D0.B0.D0.B5.D1.82"></span><span class="mw-headline" id="Как_это_работает">Как это работает</span>
</h2>
<p>В соответствии с конфигурацией по умолчанию в <code>/etc/pam.d/system-login</code>, модуль <code>pam_systemd</code> автоматически запускает <code>systemd --user</code> в случае, когда пользователь в первый раз входит в систему . Этот процесс будет работать до тех пор, пока существует сессия этого пользователя, и будет убит, как только последний сеанс для пользователя будет закрыт. Когда включен <a href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_systemd_%D0%BE%D1%82_%D0%B8%D0%BC%D0%B5%D0%BD%D0%B8_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F">#Автоматический запуск systemd от имени пользователя</a>, то процесс запускается при загрузке и убит не будет. Пользовательский процесс systemd отвечает за управление службами пользователей, которые могут быть использованы для запуска демонов или автоматизированных задач, со всеми преимуществами systemd, таких как активация сокета, таймеры, системы зависимостей или строгий контроль процесса через контрольные группы.
</p>
<p>Аналогично системным службам, пользовательские службы расположены в следующих каталогах (отсортированы по возрастанию приоритета):
</p>
<ul>
<li>
<code>/usr/lib/systemd/user/</code> где находятся службы, относящиеся к установленным пакетам.</li>
<li>
<code>~/.local/share/systemd/user/</code> где находятся службы, относящиеся к пакетам, установленным в домашний каталог.</li>
<li>
<code>/etc/systemd/user/</code> где находятся общесистемные пользовательские службы, созданные системным администратором.</li>
<li>
<code>~/.config/systemd/user/</code> где пользователь размещает свои собственные службы.</li>
</ul>
<p>При запуске пользовательского процесса systemd он привязывается к пользовательской же (то есть отдельной для каждого пользователя) цели <code>default.target</code>. Другие службы могут управляться вручную с помощью команды <code>systemctl --user</code>. См. <span class="plainlinks archwiki-template-man" title="$ man 7 systemd.special"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.special.7#UNITS_MANAGED_BY_THE_USER_SERVICE_MANAGER">systemd.special(7) § UNITS MANAGED BY THE USER SERVICE MANAGER</a></span>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Имейте в виду, что <code>systemd --user</code> представляет собой процесс для каждого пользователя, а не для сессии. Смысл заключается в том, что большая часть ресурсов, обрабатываемых пользовательскими службами, такие как сокеты или файлы состояния будут создаваться отдельно для каждого пользователя (в его домашнем каталоге), и не за один сеанс. Это означает, что все пользовательские службы работают вне сеанса. Как следствие, программы, которые должны быть запущены внутри сессии, вероятно, прервут выполнение пользовательских служб. С помощью systemd в пользовательском сеансе обрабатывается довольно много данных. См <a rel="nofollow" class="external autonumber" href="https://mail.gnome.org/archives/desktop-devel-list/2014-January/msg00079.html">[1]</a> и <a rel="nofollow" class="external autonumber" href="https://lists.freedesktop.org/archives/systemd-devel/2014-March/017552.html">[2]</a> для получения подсказок о том, как идут дела.</li>
<li>
<code>systemd --user</code> выполняется как процесс, отдельный от родительского процесса <code>systemd --system</code>. Службы пользователей не могут ссылаться или зависеть от системных юнитов или юнитов других пользователей.</li>
</ul>
</div>
<h2>
<span id=".D0.9E.D1.81.D0.BD.D0.BE.D0.B2.D0.BD.D1.8B.D0.B5_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B8"></span><span class="mw-headline" id="Основные_настройки">Основные настройки</span>
</h2>
<p>Все пользовательские службы размещаются в <code>~/.config/systemd/user/</code>. Если вы хотите запускать службы при первом входе в систему, выполните <code>systemctl --user enable <i>service</i></code> для любой службы, которую вы хотите сделать автозагрузочной.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong>  Если вы хотите включить службу для всех пользователей, а не для пользователя, выполняющего команду <i>systemctl </i>, запустите <code>systemctl --user --global enable <i>service</i></code> от имени суперпользователя.</div>
<h3>
<span id=".D0.9F.D0.B5.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.BD.D1.8B.D0.B5_.D0.BE.D0.BA.D1.80.D1.83.D0.B6.D0.B5.D0.BD.D0.B8.D1.8F"></span><span class="mw-headline" id="Переменные_окружения">Переменные окружения</span>
</h3>
<p>Пользовательский процесс systemd не наследует какую-либо из <a href="../../ru/Environment_variables.html" title="Environment variables (Русский)">переменных окружения</a>, установленных в <code>.bashrc</code> или других. Существует несколько способов установить переменные окружения для systemd:
</p>
<ol><li>Для переменной <code>$HOME</code> пользовательского каталога, создайте файл <i>.conf</i> в каталоге <code>~/.config/environment.d/</code> со строками вида {{ic | 1 = NAME = VAL}. Применяется только к части пользовательских служб.</li></ol>
<p>Смотрите <span class="plainlinks archwiki-template-man" title="$ man 5 environment.d"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/environment.d.5">environment.d(5)</a></span> для получения дополнительной информации.
</p>
<ol>
<li>Используйте опцию <code>DefaultEnvironment</code> в <code>/etc/systemd/user.conf</code>. Применяется ко всем пользовательским службам.</li>
<li>Добавление конфигурационного файла в <code>/etc/systemd/system/user@.service.d/</code>. Применяется ко всем пользовательским процессам; см <a href="#%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80_%D1%81%D0%BB%D1%83%D0%B6%D0%B1%D1%8B">#Пример службы</a>
</li>
<li>Для временного изменения используйте <code>systemctl --user set-environment</code> или <code>systemctl --user import-environment</code>. Применяется ко всем пользовательским службам, созданным после установки переменных окружения, но не к службам, которые уже были запущены.</li>
<li>Используйте <code>dbus-update-activation-environment --systemd --all</code> — команду, которую предоставляет <a href="../../ru/D-Bus.html" title="D-Bus (Русский)">D-Bus</a>. Имеет тот же эффект, что и <code>systemctl --user import-environment</code>, но также влияет на сессию D-Bus. Вы можете добавить это в конец вашего файла инициализации оболочки.</li>
<li>Для "глобальных" переменных пользовательского окружения вы можете использовать каталоги <code>environment.d</code>, которые анализируются генераторами systemd. Подробнее см. <span class="plainlinks archwiki-template-man" title="$ man 5 environment.d"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/environment.d.5">environment.d(5)</a></span> и <span class="plainlinks archwiki-template-man" title="$ man 7 systemd.generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.generator.7">systemd.generator(7)</a></span>.</li>
<li>Вы также можете написать скрипт генератора среды, который может создавать переменные среды, которые варьируются от пользователя к пользователю. Это, вероятно, лучший способ, если вам нужны индивидуальные среды (это относится к <code>XDG_RUNTIME_DIR</code>, <code>DBUS_SESSION_BUS_ADDRESS</code> и т.д.). Смотрите <span class="plainlinks archwiki-template-man" title="$ man 7 systemd.environment-generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.environment-generator.7">systemd.environment-generator(7)</a></span>.</li>
</ol>
<p>Одну переменную Вы можете установить в <code>PATH</code>.
</p>
<p>После настройки можно использовать команду <code>systemctl --user show-environment</code> для проверки правильности значений.
</p>
<h4>
<span id=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D1.80_.D1.81.D0.BB.D1.83.D0.B6.D0.B1.D1.8B"></span><span class="mw-headline" id="Пример_службы">Пример службы</span>
</h4>
<p>Создайте <a href="../../en/Systemd.html#Drop-in_files" title="Systemd">drop-in</a> каталог <code>/etc/systemd/system/user@.service.d/</code> и внутри создайте файл с расширением <code>.conf</code> (например, <code>local.conf</code>):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/user@.service.d/local.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
Environment="PATH=/usr/lib/ccache/bin:/usr/local/bin:/usr/bin:/bin"
Environment="EDITOR=nano -c"
Environment="BROWSER=firefox"
Environment="NO_AT_BRIDGE=1"</pre>
<h4>
<span id="DISPLAY_.D0.B8_XAUTHORITY"></span><span class="mw-headline" id="DISPLAY_и_XAUTHORITY">DISPLAY и XAUTHORITY</span>
</h4>
<p>Переменная <code>DISPLAY</code> используется любым графическим приложением, чтобы знать, какой дисплей использовать, <code>XAUTHORITY</code>, чтобы указать путь к пользовательскому файлу <code>.Xauthority</code>, а также куки, необходимые для запуска Х-сервера. Если Вы планируете запускать графические приложения из процесса systemd, то эти переменные обязательно должны быть установлены. Systemd предоставляет скрипт в <code>/etc/X11/xinit/xinitrc.d/50-systemd-user.sh</code> для импорта этих переменных в пользовательскую сессию systemd на запуск X. <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/blob/v219/NEWS#L194">[3]</a> Так что если Вы не запускаете Х нестандартным образом, пользовательские службы должны знать переменные <code>DISPLAY</code> и <code>XAUTHORITY</code>.
</p>
<h4><span class="mw-headline" id="PATH">PATH</span></h4>
<p>Если изменить <code>PATH</code> и запланированный запуск приложений, которые используют службу systemd, Вы должны убедиться, что модифицированный <code>PATH</code> установлен и в среде systemd. Если предположить, что Вы установили переменную <code>PATH</code> в <code>.bash_profile</code>, то лучшим способом сделать systemd осведомленным о модификации <code>PATH</code> будет добавление в <code>.bash_profile</code> после <code>PATH</code> заданной переменной:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.bash_profile</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">systemctl --user import-environment PATH
</pre>
<p>Обратите внимание, что это не повлияет на службы systemd, запущенные до импортирования PATH.
</p>
<h4><span class="mw-headline" id="pam_env">pam_env</span></h4>
<p>Переменные среды можно сделать доступными с помощью модуля <code>pam_env.so</code>. Смотрите <a href="../../en/Environment_variables.html#Using_pam_env" title="Environment variables">Environment variables#Using pam_env</a> для деталей конфигурации.
</p>
<h3>
<span id=".D0.90.D0.B2.D1.82.D0.BE.D0.BC.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B9_.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA_systemd_.D0.BE.D1.82_.D0.B8.D0.BC.D0.B5.D0.BD.D0.B8_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8F"></span><span class="mw-headline" id="Автоматический_запуск_systemd_от_имени_пользователя">Автоматический запуск systemd от имени пользователя</span>
</h3>
<p>Пользовательский процесс systemd запускается сразу после первого входа пользователя в систему, и будет убит после завершения последнего сеанса пользователя. Иногда может быть полезно запустить службу сразу после загрузки, и поддерживать процесс systemd запущенным даже после завершения последнего сеанса пользователя, например, чтобы некоторый пользовательский процесс работал без какой-либо открытой сессии. Для этой цели используются долговременные службы.  Используйте следующую команду, чтобы включить долговременную службу для конкретного пользователя:
</p>
<pre># loginctl enable-linger <i>username</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Служба systemd находится <b>вне</b> сессии, она запускается за пределами <i>logind</i>. Не используйте долговременные службы для включения автоматического входа в систему, иначе будет <a href="../../ru/General_troubleshooting.html#%D0%A0%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F_%D1%81%D0%B5%D1%81%D1%81%D0%B8%D0%B8" title="General troubleshooting (Русский)">перерыв в работе сессии</a>.</div>
<h2>
<span id=".D0.9D.D0.B0.D0.BF.D0.B8.D1.81.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8C.D1.81.D0.BA.D0.B8.D1.85_.D1.8E.D0.BD.D0.B8.D1.82.D0.BE.D0.B2"></span><span class="mw-headline" id="Написание_пользовательских_юнитов">Написание пользовательских юнитов</span>
</h2>
<p>Смотрите <a href="../../en/Systemd.html#Writing_unit_files" title="Systemd">systemd#Writing unit files</a> для получения общей информации о написании юнитов модулей systemd.
</p>
<h3>
<span id=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D1.80"></span><span class="mw-headline" id="Пример">Пример</span>
</h3>
<p>Ниже приведен пример варианта пользовательской службы mpd.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/mpd.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Music Player Daemon

[Service]
ExecStart=/usr/bin/mpd --no-daemon

[Install]
WantedBy=default.target
</pre>
<h3>
<span id=".D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D1.80_.D1.81_.D0.BF.D0.B5.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.BD.D1.8B.D0.BC.D0.B8"></span><span class="mw-headline" id="Пример_с_переменными">Пример с переменными</span>
</h3>
<p>Ниже приведен пример пользовательской версии <code>sickbeard.service</code>, которая учитывает все переменные окружения пользовательских каталогов, где SickBeard может найти некоторые файлы:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/sickbeard.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=SickBeard Daemon

[Service]
ExecStart=/usr/bin/env python2 /opt/sickbeard/SickBeard.py --config %h/.sickbeard/config.ini --datadir %h/.sickbeard

[Install]
WantedBy=default.target
</pre>
<p>Как указано в <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.unit"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.unit.5">systemd.unit(5)</a></span>, переменная <code>%h</code> заменяется домашней директорией пользователя, запускающего службу. Есть и другие переменные, которые учитываются на странице руководства <a href="../../en/Systemd.html" title="Systemd">systemd</a>.
</p>
<h3>
<span id=".D0.A7.D1.82.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B6.D1.83.D1.80.D0.BD.D0.B0.D0.BB.D0.B0"></span><span class="mw-headline" id="Чтение_журнала">Чтение журнала</span>
</h3>
<p>Журнал для пользователя может быть прочитан с помощью аналогичной команды:
</p>
<pre>$ journalctl --user
</pre>
<p>Чтобы указать юнит, можно использовать
</p>
<pre>$ journalctl --user -u myunit.service
</pre>
<p>Эквивалентная команда
</p>
<pre>$ journalctl --user --user-unit myunit.service
</pre>
<p>Обратите внимание, что journald не будет писать пользовательские журналы для пользователей с UID ниже 1000, вместо этого <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/blob/a33687b792908aa6c9f4c0b22e8935643ee0ddb6/src/journal/journald-server.c#L402">перенаправляя </a> всё в системный журнал.
</p>
<h2>
<span id=".D0.92.D1.80.D0.B5.D0.BC.D0.B5.D0.BD.D0.BD.D1.8B.D0.B5_.D1.84.D0.B0.D0.B9.D0.BB.D1.8B"></span><span class="mw-headline" id="Временные_файлы">Временные файлы</span>
</h2>
<p><i>systemd-tmpfiles</i> позволяет пользователям управлять нестабильными и временными файлами и каталогами так же, как общесистемным способом (см. <a href="../../ru/Systemd.html#systemd-tmpfiles_%E2%80%94_%D0%B2%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D1%8B" title="Systemd (Русский)">systemd#systemd-tmpfiles — временные файлы</a>). Пользовательские файлы конфигурации считываются из <code>~/.config/user-tmpfiles.d/</code> и <code>~/.local/share/user-tmpfiles.d/</code> в указанном порядке. Для использования этой функциональности требуется включить необходимые пользовательские юниты systemd для вашего пользователя:
</p>
<pre>$ systemctl --user enable systemd-tmpfiles-setup.service systemd-tmpfiles-clean.timer
</pre>
<p>Синтаксис конфигурационных файлов такой же, как и для всей системы. Для получения дополнительной информации смотрите справочные страницы <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-tmpfiles"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-tmpfiles.8">systemd-tmpfiles(8)</a></span> и <span class="plainlinks archwiki-template-man" title="$ man 5 tmpfiles.d"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/tmpfiles.d.5">tmpfiles.d(5)</a></span>.
</p>
<h2>
<span id="Xorg_.D0.B8_systemd"></span><span class="mw-headline" id="Xorg_и_systemd">Xorg и systemd</span>
</h2>
<p>Есть несколько способов запустить xorg в системных модулях. Ниже представлены два варианта: либо запустить новый пользовательский сеанс с процессом xorg, либо запустить xorg из пользовательской службы systemd.
</p>
<h3>
<span id=".D0.90.D0.B2.D1.82.D0.BE.D0.BC.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B9_.D0.BB.D0.BE.D0.B3.D0.B8.D0.BD_.D0.B2_Xorg_.D0.B1.D0.B5.D0.B7_.D1.8D.D0.BA.D1.80.D0.B0.D0.BD.D0.BD.D0.BE.D0.B3.D0.BE_.D0.BC.D0.B5.D0.BD.D0.B5.D0.B4.D0.B6.D0.B5.D1.80.D0.B0"></span><span class="mw-headline" id="Автоматический_логин_в_Xorg_без_экранного_менеджера">Автоматический логин в Xorg без экранного менеджера</span>
</h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Спорная информация в оригинале: This setup ends up with two user D-Bus buses, one for the desktop, and an other for systemd. Why can't we use the systemd one alone?  (Discuss in <a rel="nofollow" class="external text" href="../../ru/Talk:Systemd/User.html">Talk:Systemd (Русский)/User (Русский)</a>)</div>
</div>
<p>Эта опция запускает системный блок, который запускает сеанс пользователя с сервером xorg, а затем запускает обычный <code>~/.xinitrc</code> для запуска оконного менеджера и т.д.
</p>
<p>Вам необходим установленный <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xlogin-git/">xlogin-git</a></span><sup><small>AUR</small></sup>. Настройте свой xinitrc, как указано в разделе <a href="../../en/Xinit.html#xinitrc" title="Xinit">Xinit#xinitrc</a>.
</p>
<p>Сеанс будет использовать собственный  dbus демон, но различные утилиты systemd будут автоматически подключаться к экземпляру <code>dbus.service</code>. Наконец, <a href="../../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> службу <code>xlogin@<i>username</i></code> для автоматического входа при загрузке.Сеанс пользователя полностью находится в области видимости systemd, и все в сеансе пользователя должно работать нормально.
</p>
<h3>
<span id="Xorg_.D0.BA.D0.B0.D0.BA_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8C.D1.81.D0.BA.D0.B0.D1.8F_.D1.81.D0.BB.D1.83.D0.B6.D0.B1.D0.B0_systemd"></span><span class="mw-headline" id="Xorg_как_пользовательская_служба_systemd">Xorg как пользовательская служба systemd</span>
</h3>
<p>Кроме того, <a href="../../ru/Xorg.html" title="Xorg (Русский)">Xorg</a> можно запустить из службы пользователя systemd. Это хорошо, поскольку другие связанные с X юниты могут зависеть от xorg и т. д. Но с другой стороны, у этого есть некоторые недостатки, объясненные ниже.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xorg-server">xorg-server</a></span> обеспечивает интеграцию с systemd двумя способами:
</p>
<ul>
<li>Может быть запущен непривилегированным, делегируя управление устройствами logind (смотрите коммиты Hans de Goede <a rel="nofollow" class="external text" href="https://gitlab.freedesktop.org/xorg/xserver/-/commit/82863656ec449644cd34a86388ba40f36cea11e9">коммит</a>).</li>
<li>Может быть превращен в сервис, активируемый сокетом (смотрите <a rel="nofollow" class="external text" href="https://gitlab.freedesktop.org/xorg/xserver/-/commit/b3d3ffd19937827bcbdb833a628f9b1814a6e189">этот коммит</a>).</li>
</ul>
<p>К сожалению, чтобы иметь возможность запускать xorg в непривилегированном режиме, он должен запускаться внутри сеанса. Итак, в данный момент недостаток запуска xorg в качестве пользовательской службы заключается в том, что он должен запускаться с привилегиями суперпользователя (как до 1.16) и не может использовать преимущества непривилегированного режима, представленного в 1.16.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Это не является фундаментальным ограничением, налагаемым logind, но причина, по-видимому, заключается в том, что xorg нужно знать, какой сеанс взять на себя, и сейчас он получает эту информацию, вызывая <a rel="nofollow" class="external text" href="https://www.freedesktop.org/wiki/Software/systemd/logind">logind</a>'s <code>GetSessionByPID</code> используя свой собственный pid в качестве аргумента. Смотрите <a rel="nofollow" class="external text" href="https://lists.x.org/archives/xorg-devel/2014-February/040476.html">this thread</a> и <a rel="nofollow" class="external text" href="https://gitlab.freedesktop.org/xorg/xserver/-/blob/master/hw/xfree86/os-support/linux/systemd-logind.c">xorg sources</a>. Кажется вероятным, что xorg можно изменить, чтобы получить сеанс от tty, к которому он подключен, и затем он мог бы работать непривилегированным из пользовательской службы вне сеанса.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> В xorg 1.18  активация сокета, кажется, сломана. Клиент, вызывающий активацию, зависает. Смотрите вышестоящий отчет об ошибках <a rel="nofollow" class="external autonumber" href="https://gitlab.freedesktop.org/xorg/xserver/issues/491">[4]</a>. В качестве временного обходного пути вы можете запустить сервер xorg без активации сокета, убедившись, что клиенты подключаются после задержки, поэтому сервер полностью запускается. Кажется, нет никакого удобного механизма, чтобы получить уведомление о запуске для X сервера.</div>
<p>Вот как запустить xorg из пользовательского сервиса:
</p>
<p>1. Заставить xorg работать с правами суперпользователя и для любого пользователя путем редактирования <code>/etc/X11/Xwrapper.config</code> 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/X11/Xwrapper.config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">allowed_users=anybody
needs_root_rights=yes
</pre>
<p>2. Добавить следующие юниты в <code>~/.config/systemd/user</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/xorg@.socket</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Socket for xorg at display %i

[Socket]
ListenStream=/tmp/.X11-unix/X%i
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/xorg@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Xorg server at display %i

Requires=xorg@%i.socket
After=xorg@%i.socket

[Service]
Type=simple
SuccessExitStatus=0 1

ExecStart=/usr/bin/Xorg :%i -nolisten tcp -noreset -verbose 2 "vt${XDG_VTNR}"
</pre>
<p>где <code>${XDG_VTNR</code>} - виртуальный терминал, на котором будет запущен xorg, либо прописанный в сервисном модуле, либо установленный в среде systemd с помощью
</p>
<pre>$ systemctl --user set-environment XDG_VTNR=1
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> xorg должен быть запущен на том же виртуальном терминале, где пользователь вошел в систему. В противном случае logind будет считать сеанс неактивным.</div>
<p>3. Обязательно настройте переменную среды <code>DISPLAY</code>, как описано <a href="#DISPLAY_%D0%B8_XAUTHORITY">выше</a>.
</p>
<p>4. Затем, чтобы активировать сокет для xorg на дисплее 0 и tty 2, следует выполнить:
</p>
<pre>$ systemctl --user set-environment XDG_VTNR=2     # Так что xorg@.service знает, какой vt использовать
$ systemctl --user start xorg@0.socket            # начинает слушать на сокете для дисплея 0
</pre>
<p>Теперь запуск любого X приложения  автоматически запустит xorg на виртуальном терминале 2.
</p>
<p>Переменная среды <code>XDG_VTNR</code> может быть установлена в среде systemd из <code>.bash_profile</code>, а затем можно запустить любое приложение X, включая диспетчер окон, как системный модуль, зависящий от <code>xorg@0.socket</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> В настоящее время запуск оконного менеджера в качестве пользовательской службы означает, что он работает работает за пределами сеанса, с проблемами, которые могут возникнуть: <a href="../../en/General_troubleshooting.html#Session_permissions" title="General troubleshooting">break the session</a>. Однако, похоже, что разработчики systemd намерены сделать что-то подобное возможным. Смотрите <a rel="nofollow" class="external autonumber" href="https://mail.gnome.org/archives/desktop-devel-list/2014-January/msg00079.html">[5]</a> и <a rel="nofollow" class="external autonumber" href="https://lists.freedesktop.org/archives/systemd-devel/2014-March/017552.html">[6]</a>
</div>
<h2>
<span id=".D0.9D.D0.B5.D0.BA.D0.BE.D1.82.D0.BE.D1.80.D1.8B.D0.B5_.D1.81.D0.BB.D1.83.D1.87.D0.B0.D0.B8_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F"></span><span class="mw-headline" id="Некоторые_случаи_использования">Некоторые случаи использования</span>
</h2>
<h3>
<span id=".D0.9F.D0.BE.D1.81.D1.82.D0.BE.D1.8F.D0.BD.D0.BD.D1.8B.D0.B9_.D1.82.D0.B5.D1.80.D0.BC.D0.B8.D0.BD.D0.B0.D0.BB.D1.8C.D0.BD.D1.8B.D0.B9_.D0.BC.D1.83.D0.BB.D1.8C.D1.82.D0.B8.D0.BF.D0.BB.D0.B5.D0.BA.D1.81.D0.BE.D1.80"></span><span class="mw-headline" id="Постоянный_терминальный_мультиплексор">Постоянный терминальный мультиплексор</span>
</h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> Устаревшая информация в оригинале: Ссылается на <code>user-session@.service</code> вместо <code>user@.service</code>; последний не содержит <code>Conflicts=getty@tty1.service</code>. (Discuss in <a rel="nofollow" class="external text" href="../../ru/Talk:Systemd/User.html">Talk:Systemd (Русский)/User (Русский)</a>)</div>
</div>
<p>Возможно, вы захотите, чтобы в сеансе пользователя по умолчанию использовался терминальный мультиплексор, например <a href="../../ru/GNU_Screen.html" title="GNU Screen (Русский)">GNU Screen</a> или <a href="../../en/Tmux.html" title="Tmux">Tmux</a>, в фоновом режиме, а не для входа в сеанс оконного менеджера. Разделение входа в систему от входа в систему X, скорее всего, полезно только для тех, кто загружается с TTY, а не с экранным менеджером (в этом случае вы можете просто связать все, что вы запускаете, с myStuff.target). 
</p>
<p>Чтобы создать пользовательский сеанс такого типа, действуйте, как указано выше, но вместо создания wm.target создайте multiplexer.target:
</p>
<pre>[Unit]
Description=Terminal multiplexer
Documentation=info:screen man:screen(1) man:tmux(1)
After=cruft.target
Wants=cruft.target

[Install]
Alias=default.target</pre>
<p><code>cruft.target</code>, как <code>mystuff.target</code> выше, должен запускать все, что, по вашему мнению, должно запускаться до запуска tmux или экрана (или что вы хотите запустить при загрузке независимо от времени), например сеанс демона GnuPG.
</p>
<p>Затем вам нужно создать сервис для сеанса мультиплексора. Вот пример службы, использующей tmux в качестве примера и использующей сеанс gpg-agent, который записал свою информацию в <code>/tmp/gpg-agent-info</code>. Этот пример сеанса при запуске X также сможет запускать программы X, так как установлен DISPLAY.
</p>
<pre>[Unit]
Description=tmux: A terminal multiplixer 
Documentation=man:tmux(1)
After=gpg-agent.service
Wants=gpg-agent.service

[Service]
Type=forking
ExecStart=/usr/bin/tmux start
ExecStop=/usr/bin/tmux kill-server
Environment=DISPLAY=:0
EnvironmentFile=/tmp/gpg-agent-info

[Install]
WantedBy=multiplexer.target</pre>
<p>Как только это будет сделано, <code>systemctl --user enable</code> <code>tmux.service</code>, <code>multiplexer.target</code> и любые сервисы, которые вы создали для запуска <code>cruft.target</code>, и вы должны быть готовы к работе! Активирован <code>user-session@.service</code>, как описано выше, но обязательно удалите <code>Conflicts=getty@tty1.service</code> из {{ic|user-session@.service} }, поскольку ваш пользовательский сеанс не будет принимать TTY. Поздравляем! У вас есть работающий терминальный мультиплексор и некоторые другие полезные программы, готовые к запуску при загрузке!
</p>
<h3>
<span id=".D0.9E.D0.BA.D0.BE.D0.BD.D0.BD.D1.8B.D0.B9_.D0.BC.D0.B5.D0.BD.D0.B5.D0.B4.D0.B6.D0.B5.D1.80"></span><span class="mw-headline" id="Оконный_менеджер">Оконный менеджер</span>
</h3>
<p>Чтобы запустить оконный менеджер в качестве службы systemd, сначала необходимо запустить <a href="#Xorg_%D0%BA%D0%B0%D0%BA_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D1%81%D0%BA%D0%B0%D1%8F_%D1%81%D0%BB%D1%83%D0%B6%D0%B1%D0%B0_systemd">Xorg как пользовательскую службу systemd</a>. В следующем примере мы будем использовать <a href="../../ru/Awesome.html" title="Awesome (Русский)">awesome (Русский)</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/awesome.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Awesome window manager
After=xorg.target
Requires=xorg.target

[Service]
ExecStart=/usr/bin/awesome
Restart=always
RestartSec=10
 
[Install]
WantedBy=wm.target
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Раздел <code>[Install]</code> содержит часть <code>WantedBy</code>. При использовании <code>systemctl --user enable</code> он будет связывать это как <code>~/.config/systemd/user/wm.target.wants /<i>window_manager</i>.service</code>, позволяя ему стартовать при входе в систему. Рекомендуется включить этот сервис, а не связывать его вручную.</div>
<h2>
<span id=".D0.97.D0.B0.D0.B2.D0.B5.D1.80.D1.88.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D1.86.D0.B5.D1.81.D1.81.D0.BE.D0.B2_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8F_.D0.BF.D1.80.D0.B8_.D0.B2.D1.8B.D1.85.D0.BE.D0.B4.D0.B5_.D0.B8.D0.B7_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D1.8B"></span><span class="mw-headline" id="Завершение_процессов_пользователя_при_выходе_из_системы">Завершение процессов пользователя при выходе из системы</span>
</h2>
<p>Arch Linux создает пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd">systemd</a></span> с помощью <code>--without-kill-user-process</code>, устанавливая <code>KillUserProcesses</code> равным <code>no</code> по умолчанию. Этот параметр предотвращает уничтожение пользовательских процессов, когда пользователь полностью выходит из системы. Чтобы изменить это поведение и убить все пользовательские процессы при выходе из системы, установите <code>KillUserProcesses=yes</code> в <code>/etc/systemd/logind.conf</code>.
</p>
<p>Обратите внимание, что изменение этого параметра нарушает работу мультиплексоров терминала, таких как <a href="../../en/Tmux.html" title="Tmux">tmux</a> и <a href="../../ru/GNU_Screen.html" title="GNU Screen (Русский)">GNU Screen (Русский)</a>. Если вы измените этот параметр, вы все равно сможете использовать терминальный мультиплексор, используя <code>systemd-run</code> следующим образом:
</p>
<pre>$ systemd-run --scope --user <i>command</i> <i>args</i>
</pre>
<p>Например, чтобы запустить <code>screen</code>, вы должны сделать:
</p>
<pre>$ systemd-run --scope --user screen -S <i>foo</i>
</pre>
<p>Запущенные с помощью <code>systemd-run</code> процессы продолжат работу даже после выхода пользователя, если он залогинен в системе где-то ещё и служба <code>user@.service</code> всё ещё работает.
</p>
<p>После завершения всех активных сеансов <code>user@.service</code> прекращает работу, если для этого пользователя не был включён <i>lingering</i> <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/blob/76153ad45f09b6ae45464f2e03d3afefbb4b2afe/NEWS#L274">[7]</a>. Поэтому для запуска и работы долгосрочных процессов после полного выхода пользователя из системы необходимо включить lingering. Подробнее см. <a href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_systemd_%D0%BE%D1%82_%D0%B8%D0%BC%D0%B5%D0%BD%D0%B8_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F">#Автоматический запуск systemd от имени пользователя</a> и <span class="plainlinks archwiki-template-man" title="$ man 1 loginctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/loginctl.1">loginctl(1)</a></span>.
</p>
<h2>
<span id=".D0.A0.D0.B5.D1.88.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC"></span><span class="mw-headline" id="Решение_проблем">Решение проблем</span>
</h2>
<h3>
<span id="Runtime_directory_.27.2Frun.2Fuser.2F1000.27_is_not_owned_by_UID_1000.2C_as_it_should"></span><span class="mw-headline" id="Runtime_directory_'/run/user/1000'_is_not_owned_by_UID_1000,_as_it_should">Runtime directory '/run/user/1000' is not owned by UID 1000, as it should</span>
</h3>
<pre>systemd[1867]: pam_systemd(systemd-user:session): Runtime directory '/run/user/1000' is not owned by UID 1000, as it should.
systemd[1867]: Trying to run as user instance, but $XDG_RUNTIME_DIR is not set
</pre>
<p>Если вы видите такую ошибку и ваш сеанс в порядке, то возможно, что другая системная (не пользовательская) служба создала этот каталог. Например, такое могло произойти при использовании контейнера <a href="../../en/Docker.html" title="Docker">docker</a>, который выполнил bind-монтирование в каталог <code>/run/user/1000</code>. Чтобы это исправить, либо отредактируйте контейнер, удалив монтирование, либо отключите/отложите службу docker.
</p>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://bitbucket.org/KaiSforza/systemd-user-units/wiki/Home">Вики-ресурс пользователя KaiSforza на Bitbucket</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/zoqaeski/systemd-user-units">Файлы юнитов пользователя Zoqaeski на GitHub</a></li>
<li><a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=167115">Ветка форума Arch Linux об изменениях пользовательских экземпляров в systemd 206</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../ru/Category:System_administration.html" title="Category:System administration (Русский)">System administration (Русский)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Systemd_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)/User_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=758428">https://wiki.archlinux.org/index.php?title=Systemd_(Русский)/User_(Русский)&amp;oldid=758428</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 29 November 2022, at 07:07.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
