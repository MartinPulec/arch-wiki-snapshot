<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Active Directory integration (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.44.2">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Active_Directory_integration_Русский rootpage-Active_Directory_integration_Русский skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Терминология" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A2%D0%B5%D1%80%D0%BC%D0%B8%D0%BD%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D1%8F">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Терминология</span>
			</div>
		</a>
		
		<ul id="toc-Терминология-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Настройка" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Настройка</span>
			</div>
		</a>
		
			<button aria-controls="toc-Настройка-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Настройка subsection</span>
			</button>
		
		<ul id="toc-Настройка-sublist" class="vector-toc-list">
			<li id="toc-Настройка_AD" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_AD">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>Настройка AD</span>
				</div>
			</a>
			
			<ul id="toc-Настройка_AD-sublist" class="vector-toc-list">
				<li id="toc-Обновление_GPO" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9E%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_GPO">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1.1</span>
					<span>Обновление GPO</span>
				</div>
			</a>
			
			<ul id="toc-Обновление_GPO-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Настройка_Linux_хоста" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_Linux_%D1%85%D0%BE%D1%81%D1%82%D0%B0">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>Настройка Linux хоста</span>
				</div>
			</a>
			
			<ul id="toc-Настройка_Linux_хоста-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Установка" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3</span>
					<span>Установка</span>
				</div>
			</a>
			
			<ul id="toc-Установка-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Обновление_DNS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9E%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_DNS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4</span>
					<span>Обновление DNS</span>
				</div>
			</a>
			
			<ul id="toc-Обновление_DNS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Настройка_NTP" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_NTP">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.5</span>
					<span>Настройка NTP</span>
				</div>
			</a>
			
			<ul id="toc-Настройка_NTP-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Kerberos" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Kerberos">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.6</span>
					<span>Kerberos</span>
				</div>
			</a>
			
			<ul id="toc-Kerberos-sublist" class="vector-toc-list">
				<li id="toc-Создание_ключа_Kerberos" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0_Kerberos">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.6.1</span>
					<span>Создание ключа Kerberos</span>
				</div>
			</a>
			
			<ul id="toc-Создание_ключа_Kerberos-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Подтверждение_ключа" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9F%D0%BE%D0%B4%D1%82%D0%B2%D0%B5%D1%80%D0%B6%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.6.2</span>
					<span>Подтверждение ключа</span>
				</div>
			</a>
			
			<ul id="toc-Подтверждение_ключа-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-pam_winbind.conf" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#pam_winbind.conf">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.7</span>
					<span>pam_winbind.conf</span>
				</div>
			</a>
			
			<ul id="toc-pam_winbind.conf-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Samba" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Samba">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.8</span>
					<span>Samba</span>
				</div>
			</a>
			
			<ul id="toc-Samba-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Запуск_и_проверка_сервисов" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_%D0%B8_%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Запуск и проверка сервисов</span>
			</div>
		</a>
		
			<button aria-controls="toc-Запуск_и_проверка_сервисов-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Запуск и проверка сервисов subsection</span>
			</button>
		
		<ul id="toc-Запуск_и_проверка_сервисов-sublist" class="vector-toc-list">
			<li id="toc-Запуск_Samba" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%97%D0%B0%D0%BF%D1%83%D1%81%D0%BA_Samba">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>Запуск Samba</span>
				</div>
			</a>
			
			<ul id="toc-Запуск_Samba-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Присоединение_к_Домену" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%B8%D1%81%D0%BE%D0%B5%D0%B4%D0%B8%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BA_%D0%94%D0%BE%D0%BC%D0%B5%D0%BD%D1%83">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>Присоединение к Домену</span>
				</div>
			</a>
			
			<ul id="toc-Присоединение_к_Домену-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Перезапуск_Samba" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_Samba">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3</span>
					<span>Перезапуск Samba</span>
				</div>
			</a>
			
			<ul id="toc-Перезапуск_Samba-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Проверка_Winbind" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_Winbind">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.4</span>
					<span>Проверка Winbind</span>
				</div>
			</a>
			
			<ul id="toc-Проверка_Winbind-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Проверка_nsswitch" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_nsswitch">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.5</span>
					<span>Проверка nsswitch</span>
				</div>
			</a>
			
			<ul id="toc-Проверка_nsswitch-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Проверка_команд_Samba" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4_Samba">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.6</span>
					<span>Проверка команд Samba</span>
				</div>
			</a>
			
			<ul id="toc-Проверка_команд_Samba-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Настройка_PAM" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_PAM">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Настройка PAM</span>
			</div>
		</a>
		
			<button aria-controls="toc-Настройка_PAM-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Настройка PAM subsection</span>
			</button>
		
		<ul id="toc-Настройка_PAM-sublist" class="vector-toc-list">
			<li id="toc-system-auth" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#system-auth">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>system-auth</span>
				</div>
			</a>
			
			<ul id="toc-system-auth-sublist" class="vector-toc-list">
				<li id="toc-Раздел_&quot;auth&quot;" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A0%D0%B0%D0%B7%D0%B4%D0%B5%D0%BB_&quot;auth&quot;">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1.1</span>
					<span>Раздел "auth"</span>
				</div>
			</a>
			
			<ul id="toc-Раздел_&quot;auth&quot;-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Раздел_&quot;account&quot;" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A0%D0%B0%D0%B7%D0%B4%D0%B5%D0%BB_&quot;account&quot;">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1.2</span>
					<span>Раздел "account"</span>
				</div>
			</a>
			
			<ul id="toc-Раздел_&quot;account&quot;-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Раздел_&quot;session&quot;" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A0%D0%B0%D0%B7%D0%B4%D0%B5%D0%BB_&quot;session&quot;">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1.3</span>
					<span>Раздел "session"</span>
				</div>
			</a>
			
			<ul id="toc-Раздел_&quot;session&quot;-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Раздел_&quot;password&quot;" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A0%D0%B0%D0%B7%D0%B4%D0%B5%D0%BB_&quot;password&quot;">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1.4</span>
					<span>Раздел "password"</span>
				</div>
			</a>
			
			<ul id="toc-Раздел_&quot;password&quot;-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Проверка_входа" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D0%B2%D1%85%D0%BE%D0%B4%D0%B0">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.2</span>
					<span>Проверка входа</span>
				</div>
			</a>
			
			<ul id="toc-Проверка_входа-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Настройка_общих_файлов" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%BE%D0%B1%D1%89%D0%B8%D1%85_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Настройка общих файлов</span>
			</div>
		</a>
		
		<ul id="toc-Настройка_общих_файлов-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Добавление_файла_keytab_и_включение_беспарольного_входа_на_машину_через_Kerber_и_ssh" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%B0_keytab_%D0%B8_%D0%B2%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B1%D0%B5%D1%81%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D1%8C%D0%BD%D0%BE%D0%B3%D0%BE_%D0%B2%D1%85%D0%BE%D0%B4%D0%B0_%D0%BD%D0%B0_%D0%BC%D0%B0%D1%88%D0%B8%D0%BD%D1%83_%D1%87%D0%B5%D1%80%D0%B5%D0%B7_Kerber_%D0%B8_ssh">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Добавление файла keytab и включение беспарольного входа на машину через Kerber и ssh</span>
			</div>
		</a>
		
			<button aria-controls="toc-Добавление_файла_keytab_и_включение_беспарольного_входа_на_машину_через_Kerber_и_ssh-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Добавление файла keytab и включение беспарольного входа на машину через Kerber и ssh subsection</span>
			</button>
		
		<ul id="toc-Добавление_файла_keytab_и_включение_беспарольного_входа_на_машину_через_Kerber_и_ssh-sublist" class="vector-toc-list">
			<li id="toc-Создание_key_tab_файла" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_key_tab_%D1%84%D0%B0%D0%B9%D0%BB%D0%B0">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.1</span>
					<span>Создание key tab файла</span>
				</div>
			</a>
			
			<ul id="toc-Создание_key_tab_файла-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Включение_входа_через_keytab" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B2%D1%85%D0%BE%D0%B4%D0%B0_%D1%87%D0%B5%D1%80%D0%B5%D0%B7_keytab">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.2</span>
					<span>Включение входа через keytab</span>
				</div>
			</a>
			
			<ul id="toc-Включение_входа_через_keytab-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Подготовка_sshd_на_сервере" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D0%BE%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0_sshd_%D0%BD%D0%B0_%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B5">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.3</span>
					<span>Подготовка sshd на сервере</span>
				</div>
			</a>
			
			<ul id="toc-Подготовка_sshd_на_сервере-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Добавление_опций,_нужных_для_клиента" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BE%D0%BF%D1%86%D0%B8%D0%B9,_%D0%BD%D1%83%D0%B6%D0%BD%D1%8B%D1%85_%D0%B4%D0%BB%D1%8F_%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D0%B0">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.4</span>
					<span>Добавление опций, нужных для клиента</span>
				</div>
			</a>
			
			<ul id="toc-Добавление_опций,_нужных_для_клиента-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Проверка_установки" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.5</span>
					<span>Проверка установки</span>
				</div>
			</a>
			
			<ul id="toc-Проверка_установки-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Настройка_для_полной_аутентификации_Kerberos_без_пароля." class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%B4%D0%BB%D1%8F_%D0%BF%D0%BE%D0%BB%D0%BD%D0%BE%D0%B9_%D0%B0%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D0%B8_Kerberos_%D0%B1%D0%B5%D0%B7_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D1%8F.">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.6</span>
					<span>Настройка для полной аутентификации Kerberos без пароля.</span>
				</div>
			</a>
			
			<ul id="toc-Настройка_для_полной_аутентификации_Kerberos_без_пароля.-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Генерирование_keytab,_которые_будет_принимать_AD" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%93%D0%B5%D0%BD%D0%B5%D1%80%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_keytab,_%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D1%8B%D0%B5_%D0%B1%D1%83%D0%B4%D0%B5%D1%82_%D0%BF%D1%80%D0%B8%D0%BD%D0%B8%D0%BC%D0%B0%D1%82%D1%8C_AD">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">7</span>
				<span>Генерирование keytab, которые будет принимать AD</span>
			</div>
		</a>
		
			<button aria-controls="toc-Генерирование_keytab,_которые_будет_принимать_AD-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Генерирование keytab, которые будет принимать AD subsection</span>
			</button>
		
		<ul id="toc-Генерирование_keytab,_которые_будет_принимать_AD-sublist" class="vector-toc-list">
			<li id="toc-Интересно_знать" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%98%D0%BD%D1%82%D0%B5%D1%80%D0%B5%D1%81%D0%BD%D0%BE_%D0%B7%D0%BD%D0%B0%D1%82%D1%8C">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.1</span>
					<span>Интересно знать</span>
				</div>
			</a>
			
			<ul id="toc-Интересно_знать-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Смотрите_также" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">8</span>
				<span>Смотрите также</span>
			</div>
		</a>
		
			<button aria-controls="toc-Смотрите_также-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Смотрите также subsection</span>
			</button>
		
		<ul id="toc-Смотрите_также-sublist" class="vector-toc-list">
			<li id="toc-Коммерческие_решения" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9A%D0%BE%D0%BC%D0%BC%D0%B5%D1%80%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5_%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.1</span>
					<span>Коммерческие решения</span>
				</div>
			</a>
			
			<ul id="toc-Коммерческие_решения-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar vector-feature-custom-font-size-clientpref--excluded">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Active Directory integration (Русский)</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-en mw-list-item"><a href="../en/Active_Directory_integration.html" title="Active Directory integration – English" lang="en" hreflang="en" data-title="Active Directory integration" data-language-autonym="English" data-language-local-name="English" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/Active_Directory_integration.html" title="Active Directory integration – español" lang="es" hreflang="es" data-title="Active Directory integration" data-language-autonym="Español" data-language-local-name="español" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Active_Directory_Integration" title="Active Directory Integration – 日本語" lang="ja" hreflang="ja" data-title="Active Directory Integration" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end vector-feature-custom-font-size-clientpref--excluded">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="ru" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Ссылки по теме</p>
<ul>
<li><a href="../ru/Samba.html" title="Samba (Русский)">Samba (Русский)</a></li>
<li><a href="../en/Samba/Active_Directory_domain_controller.html" class="mw-redirect" title="Samba/Контроллер домена Active Directory">Samba/Контроллер домена Active Directory</a></li>
<li><a href="../en/SOGo.html" title="SOGo">SOGo</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/Active_Directory_integration.html" title="Active Directory integration">Active Directory integration</a>. Дата последней синхронизации: 31 октября 2015. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Active_Directory_integration&amp;diff=0&amp;oldid=407563">изменения</a>.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно</strong> Так как Arch Linux использует систему распространения rolling release,возможно,некоторая информация на странице может быть устаревшей из-за изменений в пакетах или конфигурациях,сделанных разработчиками. Никогда слепо не следуйте этой или любой другой инструкции. Когда в инструкции сказано изменить какой-либо файл, обязательно сделайте бэкап. Проверяйте дату последней проверки статьи.</div>
<p>Основной задачей системных администраторов являются попытки совместного изпользования разнообразных окружений. Мы имеем в виду смешивание разных серверных операционных систем (Обычно Microsoft Windows &amp; Unix/Linux). Управление пользователями и аутентификацией на данный момент является наиболее сложной задачей. Популярнейший способ решения это задачи - Directory Server. Существует много открытых и коммерческих решений для разный типов *NIX; однако, только немногие решают проблему взаимодействия с Windows. Активный Каталог (AD) - служба каталогов созданная Microsoft для доменных сетей Windows. Он входит в большинство операционных систем Windows Server. Сервера,на которых запущен AD, называются контроллерами доменов(domain controllers)
</p>
<p><a href="https://en.wikipedia.org/wiki/Active_Directory" class="extiw" title="wikipedia:Active Directory">Активный каталог</a> используется как главное средство администрирования сети и безопасности.Он отвечает за аутентификацию и авторизацию все пользователей и компьютеров в доменной сети Windows, назначая и следя за правилами безопасности для всех компьютеров в сети, также устанавливая и обновляя ПО на компьютерах в этой сети. Например,когда пользователь авторизуется в компьютер,который является частью доменной сети, AD проверяет его пароль и яляется он обычным пользователем или же системным администратором.
</p>
<p>Активный католог использует <a href="https://en.wikipedia.org/wiki/Ldap" class="extiw" title="wikipedia:Ldap">Lightweight Directory Access Protocol (LDAP)</a> версий 2 и 3, <a href="https://en.wikipedia.org/wiki/Kerberos_(protocol)" class="extiw" title="wikipedia:Kerberos (protocol)">Kerberos</a> и DNS.
Эти же стандарты доступны в Linux, но их комбинирование - непростая задача. Эта статья поможет вам настроить хост Arch Linux для аутентификация в домене AD.
</p>
<p>Эта статья объясняет, как интегрировать хост Arch Linux в сущестующий домен AD.
Перед продолжением у вас должен быть существующий домен AD, и пользователь с правами на добавление пользователей и компьютерных аккаунтов.
Эта сатья не предназначена ни как полное описание AD,ни как полно описание работы с Samba. Обратитесь к разделу ресурсов для дополнительной информации.
</p>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Терминология">
<span id=".D0.A2.D0.B5.D1.80.D0.BC.D0.B8.D0.BD.D0.BE.D0.BB.D0.BE.D0.B3.D0.B8.D1.8F"></span>Терминология</h2></div>
<p>Если вы не знакомы с AD, здесь приведены некоторые ключевые слова, которые будет полезно знать.
</p>
<ul>
<li>
<b>Домен(Domain)</b> : Имя,используемое для группы компьютеров и аккаунтов.</li>
<li>
<b>SID</b> : Каждый компьютер,присоединяющийся к сети должен иметь уникальный SID / Системный идентификатор.</li>
<li>
<b>SMB</b> : Блок сообщения сервера.</li>
<li>
<b>NETBIOS</b>: Network naming protocol used as an alternative to DNS. Mostly legacy, but still used in Windows Networking.</li>
<li>
<b>WINS</b>: Windows Information Naming Service. Used for resolving Netbios names to windows hosts.</li>
<li>
<b>Winbind</b>: Protocol for windows authentication. Протокол для авторизации windows.</li>
</ul>
<div class="mw-heading mw-heading2"><h2 id="Настройка">
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0"></span>Настройка</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Настройка_AD">
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_AD"></span>Настройка AD</h3></div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно</strong> Эта часть не была проверена, продолжайте с отсторожностью.</div>
<div class="mw-heading mw-heading4"><h4 id="Обновление_GPO">
<span id=".D0.9E.D0.B1.D0.BD.D0.BE.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_GPO"></span>Обновление GPO</h4></div>
<p>Возможно, нужно будет отключить <i>Digital Sign Communication (Always)</i> в настройках групп AD. А именно:
</p>
<dl><dd>
<code>Local policies</code> -&gt; <code>Security policies</code> -&gt; <code>Microsoft Network Server</code> -&gt; <code>Digital sign communication (Always)</code> -&gt; выбрать <code>define this policy</code> и поставить "галочку" на <code>disable</code>.</dd></dl>
<p>Если вы используете Windows Server 2008 R2, то вам нужно настроить GPO в GPO for Default Domain Controller Policy -&gt; Computer Setting -&gt; Policies -&gt; Windows Setting -&gt; Security Setting -&gt; Local Policies -&gt; Security Option -&gt; <i>Microsoft network client: Digitally sign communications (always)</i>
</p>
<div class="mw-heading mw-heading3"><h3 id="Настройка_Linux_хоста">
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_Linux_.D1.85.D0.BE.D1.81.D1.82.D0.B0"></span>Настройка Linux хоста</h3></div>
<p>Следующие несколько шагов - начало конфигурации хоста. Вам понадобиться root или sudo доступ.
</p>
<div class="mw-heading mw-heading3"><h3 id="Установка">
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0"></span>Установка</h3></div>
<p><a href="../ru/Pacman.html" title="Pacman (Русский)">Установите</a> следующие пакеты:
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=samba">samba</a></span>, см. <a href="../en/Samba.html" title="Samba">Samba</a>
</li>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pam-krb5">pam-krb5</a></span></li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ntp">ntp</a></span> или <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openntpd">openntpd</a></span>, см. также <a href="../en/Network_Time_Protocol_daemon.html" class="mw-redirect" title="NTPd">NTPd</a> или <a href="../en/OpenNTPD.html" title="OpenNTPD">OpenNTPD</a>
</li>
</ul>
<div class="mw-heading mw-heading3"><h3 id="Обновление_DNS">
<span id=".D0.9E.D0.B1.D0.BD.D0.BE.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_DNS"></span>Обновление DNS</h3></div>
<p>AD сильно зависит от DNS. Вам нужно будет обновить <code>/etc/resolv.conf</code>, чтобы использовать контроллеры доменов AD:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/resolv.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">nameserver &lt;IP1&gt;
nameserver &lt;IP2&gt;
</pre>
<p>Замените &lt;IP1&gt; и &lt;IP2&gt; IP адресами для сервера AD.Есили ваши AD домены не позволяют использовать DNS форвардинг или рекурсию,возможно,придётся добавить некоторые вещи. 
Если ваша машина имеет дуалбут Windows и Linux, стоит использовать разные имена DNS и netbios для linux,если обе операционные системы будут членами одного домена.
</p>
<div class="mw-heading mw-heading3"><h3 id="Настройка_NTP">
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_NTP"></span>Настройка NTP</h3></div>
<p>См. <a href="../en/Network_Time_Protocol_daemon.html" class="mw-redirect" title="NTPd">NTPd</a> или <a href="../en/OpenNTPD.html" title="OpenNTPD">OpenNTPD</a> для инструкции по настройке NTP. Стоит отметить, что OpenNTPD больше не поддерживается.
</p>
<p>При настройке используйте IP адреса серверов AD.Как альтернативу можно использовать другие NTP сервера,которые обеспечат синхронизацию AD в то же место.Тем не менее,AD обычно запускают NTP в качестве службы.
</p>
<p>Убедитесь,что демон настроен на  <b>sync automatically on startup</b>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Kerberos">Kerberos</h3></div>
<p>Допустим,что ваша AD называется example.com. Далее допустим что ваша AD управляется двумя доменными контроллерами, главным и вторичным, которые называются PDC и BDS, pdc.example.com и bdc.example.com соответственно. Их адреса будут,например, 192.168.1.2 и 192.168.1.3. Следите за написанием,верхний регистр очень важен.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/krb5.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[libdefaults]
        default_realm 	= 	EXAMPLE.COM
	clockskew 	= 	300
	ticket_lifetime	=	1d
        forwardable     =       true
        proxiable       =       true
        dns_lookup_realm =      true
        dns_lookup_kdc  =       true
	
[realms]
	EXAMPLE.COM = {
		kdc 	= 	PDC.EXAMPLE.COM
                admin_server = PDC.EXAMPLE.COM
		default_domain = EXAMPLE.COM
	}
	
[domain_realm]
        .kerberos.server = EXAMPLE.COM
	.example.com = EXAMPLE.COM
	example.com = EXAMPLE.COM
	example	= EXAMPLE.COM

[appdefaults]
	pam = {
	ticket_lifetime 	= 1d
	renew_lifetime 		= 1d
	forwardable 		= true
	proxiable 		= false
	retain_after_close 	= false
	minimum_uid 		= 0
	debug 			= false
	}

[logging]
	default 		= FILE:/var/log/krb5libs.log
	kdc 			= FILE:/var/log/kdc.log
        admin_server            = FILE:/var/log/kadmind.log
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание</strong> Heimdal 1.3.1 не принимает DES шифрование,которое необходимо для аутентификации AD до Windows Server 2008. Скорее всего вам придётся добавить
<pre>allow_weak_crypto = true</pre> в раздел <code>[libdefaults]</code> </div>
<div class="mw-heading mw-heading4"><h4 id="Создание_ключа_Kerberos">
<span id=".D0.A1.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0_Kerberos"></span>Создание ключа Kerberos</h4></div>
<p>Теперь во можете запросить ключи для AD (<b>верхний регистр необходим</b>):
</p>
<pre>kinit administrator@EXAMPLE.COM</pre>
<p>Можно использовать любое имя пользователя,у которого есть права администратора домена.
</p>
<div class="mw-heading mw-heading4"><h4 id="Подтверждение_ключа">
<span id=".D0.9F.D0.BE.D0.B4.D1.82.D0.B2.D0.B5.D1.80.D0.B6.D0.B4.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0"></span>Подтверждение ключа</h4></div>
<p>Запустите <b>klist</b> чтобы проверить,получили ли вы токен,должно быть нечто подобное:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># klist</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> Ticket cache: FILE:/tmp/krb5cc_0
 Default principal: administrator@EXAMPLE.COM
 
 Valid starting    Expires           Service principal 
 02/04/12 21:27:47 02/05/12 07:27:42 krbtgt/EXAMPLE.COM@EXAMPLE.COM
         renew until 02/05/12 21:27:47
</pre>
<div class="mw-heading mw-heading3"><h3 id="pam_winbind.conf">pam_winbind.conf</h3></div>
<p>Если вы получаете ошибки "/etc/security/pam_winbind.conf не найден",создайте этот файл и отредактируйте его следующим образом:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/security/pam_winbind.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">debug=no
debug_state=no
try_first_pass=yes
krb5_auth=yes
krb5_cache_type=FILE
cached_login=yes
silent=no
mkhomedir=yes
</pre>
<div class="mw-heading mw-heading3"><h3 id="Samba">Samba</h3></div>
<p>Samba — бесплатная реализация протокола SMB/CIFS. Также она включает инструменты для Linux машин,которые заставляют их вести себя будто Windows сервера и клиенты.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание</strong> Настройка может разниться в зависимости от конфигурации сервера Windows. Будьте готовы изучать и решать проблемы.</div>
<p>В этом разделе мы сначала сфокусируемся на работе аутентификации с помощью изменения секции 'Global'. Далее, мы вернёмся к остальным.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Global]
  netbios name = MYARCHLINUX
  workgroup = EXAMPLE
  realm = EXAMPLE.COM
  server string = %h Arch Linux Host
  security = ads
  encrypt passwords = yes
  password server = pdc.example.com

  idmap config * : backend = rid
  idmap config * : range = 10000-20000

  winbind use default domain = Yes
  winbind enum users = Yes
  winbind enum groups = Yes
  winbind nested groups = Yes
  winbind separator = +
  winbind refresh tickets = yes

  template shell = /bin/bash
  template homedir = /home/%D/%U
   
  preferred master = no
  dns proxy = no
  wins server = pdc.example.com
  wins proxy = no

  inherit acls = Yes
  map acl inherit = Yes
  acl group control = yes

  load printers = no
  debug level = 3
  use sendfile = no
</pre>
<p>Теперь надо "объяснить" Samba, что мы будет использовать базы даннх PDC для аутенификации.Будем использовать winbindd, который входит в поставку Samba.Winbind указывает UID и GID Linux машины для AD. Winbind использует UNIX реализацию RPC вызовов, Pluggable Authentication Modules (aka PAM) и Name Service Switch (NSS), чтобы разрешить допуск пользователей и Windows AD на Linux-машинах. Лучшая часть winbindd то,что вам не нужно размечать самому, от вас требуется только указать диапазон UID и GID! Именно их мы объявили в smb.conf.
</p>
<p>Обновите файл настроек samba чтобы включить демона winbind
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/conf.d/samba</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> ##### /etc/conf.d/samba #####
 #SAMBA_DAEMONS=(smbd nmbd)
 SAMBA_DAEMONS=(smbd nmbd winbindd)
</pre>
<p>Далее, настройте <code>samba</code> так, для запуска вместе со стартом системы. См. <a href="../en/Systemd.html" class="mw-redirect" title="Daemons">Daemons</a> для подробностей.
</p>
<div class="mw-heading mw-heading2"><h2 id="Запуск_и_проверка_сервисов">
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_.D0.B8_.D0.BF.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D1.81.D0.B5.D1.80.D0.B2.D0.B8.D1.81.D0.BE.D0.B2"></span>Запуск и проверка сервисов</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Запуск_Samba">
<span id=".D0.97.D0.B0.D0.BF.D1.83.D1.81.D0.BA_Samba"></span>Запуск Samba</h3></div>
<p>Надеемся,вы ещё не перезагрузились! Хорошо. Если у вас запущена X-сессия - выходите из неё,чтобы проверить вход в другой терминал не выходя из своей сессии.
</p>
<p><a href="../en/Systemd.html" class="mw-redirect" title="Daemons">Запуск</a> Samba (включая smbd, nmbd и winbindd):
</p>
<p>Если вы проверите список процессов,то заметите,что на самом деле winbind не запустился. Быстрый осмотр логов говорит,что SID для этого хоста может быть получен от домена:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># tail /var/log/samba/log.winbindd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[2012/02/05 21:51:30.085574,  0] winbindd/winbindd_cache.c:3147(initialize_winbindd_cache)
  initialize_winbindd_cache: clearing cache and re-creating with version number 2
[2012/02/05 21:51:30.086137,  2] winbindd/winbindd_util.c:233(add_trusted_domain)
  Added domain BUILTIN  S-1-5-32
[2012/02/05 21:51:30.086223,  2] winbindd/winbindd_util.c:233(add_trusted_domain)
  Added domain MYARCHLINUX  S-1-5-21-3777857242-3272519233-2385508432
[2012/02/05 21:51:30.086254,  0] winbindd/winbindd_util.c:635(init_domain_list)
  Could not fetch our SID - did we join?
[2012/02/05 21:51:30.086408,  0] winbindd/winbindd.c:1105(winbindd_register_handlers)
  unable to initialize domain list
</pre>
<div class="mw-heading mw-heading3"><h3 id="Присоединение_к_Домену">
<span id=".D0.9F.D1.80.D0.B8.D1.81.D0.BE.D0.B5.D0.B4.D0.B8.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BA_.D0.94.D0.BE.D0.BC.D0.B5.D0.BD.D1.83"></span>Присоединение к Домену</h3></div>
<p>Вам нужен аккаунт администратора AD чтобы сделать это. Пусть наш логин: Administrator. Комана - 'net ads join'
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># net ads join -U Administrator</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Administrator's password: xxx
Using short domain name -- EXAMPLE
Joined 'MYARCHLINUX' to realm 'EXAMPLE.COM'
</pre>
<div class="mw-heading mw-heading3"><h3 id="Перезапуск_Samba">
<span id=".D0.9F.D0.B5.D1.80.D0.B5.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA_Samba"></span>Перезапуск Samba</h3></div>
<p><b>winbindd</b> не смог запуститься потому,что пока что мы не домен.
</p>
<p><a href="../en/Systemd.html" class="mw-redirect" title="Daemons">Перезапустите</a> сервис Samba и winbind тоже должен запуститься.
</p>
<p>NSSwitch говорит Linux хосту как получить игформацию из различных источников и к каком порядке это сделать. В нашем случае мы добаим AD как дополнительный источник для пользователей, групп и хостов.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nsswitch.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> passwd:            files winbind
 shadow:            files winbind
 group:             files winbind 
 
 hosts:             files dns wins
</pre>
<div class="mw-heading mw-heading3"><h3 id="Проверка_Winbind">
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_Winbind"></span>Проверка Winbind</h3></div>
<p>Проверим, может ли winbind получить доступ к AD. Следующие команды возвращают список пользователей AD:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># wbinfo -u</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">administrator
guest
krbtgt
test.user
</pre>
<ul><li>Note мы создали пользователя AD 'test.user' в домменом контоллере.</li></ul>
<p>Можно сделать то же  самое для групп AD:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># wbinfo -g</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">domain computers
domain controllers
schema admins
enterprise admins
cert publishers
domain admins
domain users
domain guests
group policy creator owners
ras and ias servers
allowed rodc password replication group
denied rodc password replication group
read-only domain controllers
enterprise read-only domain controllers
dnsadmins
dnsupdateproxy
</pre>
<div class="mw-heading mw-heading3"><h3 id="Проверка_nsswitch">
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_nsswitch"></span>Проверка nsswitch</h3></div>
<p>Дабы убедиться,что наш хост имеет доступ к домену для пользователей и групп, мы проверим настройки nsswitch, используя 'getent'. Следующий вывод показывает,как оно дожно выглядеть на нетронутом Arch Linux:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># getent passwd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/bin/false
daemon:x:2:2:daemon:/sbin:/bin/false
mail:x:8:12:mail:/var/spool/mail:/bin/false
ftp:x:14:11:ftp:/srv/ftp:/bin/false
http:x:33:33:http:/srv/http:/bin/false
nobody:x:99:99:nobody:/:/bin/false
dbus:x:81:81:System message bus:/:/bin/false
ntp:x:87:87:Network Time Protocol:/var/empty:/bin/false
avahi:x:84:84:avahi:/:/bin/false
administrator:*:10001:10006:Administrator:/home/EXAMPLE/administrator:/bin/bash
guest:*:10002:10007:Guest:/home/EXAMPLE/guest:/bin/bash
krbtgt:*:10003:10006:krbtgt:/home/EXAMPLE/krbtgt:/bin/bash
test.user:*:10000:10006:Test User:/home/EXAMPLE/test.user:/bin/bash
</pre>
<p>Для групп:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># getent group</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">root:x:0:root
bin:x:1:root,bin,daemon
daemon:x:2:root,bin,daemon
sys:x:3:root,bin
adm:x:4:root,daemon
tty:x:5:
disk:x:6:root
lp:x:7:daemon
mem:x:8:
kmem:x:9:
wheel:x:10:root
ftp:x:11:
mail:x:12:
uucp:x:14:
log:x:19:root
utmp:x:20:
locate:x:21:
rfkill:x:24:
smmsp:x:25:
http:x:33:
games:x:50:
network:x:90:
video:x:91:
audio:x:92:
optical:x:93:
floppy:x:94:
storage:x:95:
scanner:x:96:
power:x:98:
nobody:x:99:
users:x:100:
dbus:x:81:
ntp:x:87:
avahi:x:84:
domain computers:x:10008:
domain controllers:x:10009:
schema admins:x:10010:administrator
enterprise admins:x:10011:administrator
cert publishers:x:10012:
domain admins:x:10013:test.user,administrator
domain users:x:10006:
domain guests:x:10007:
group policy creator owners:x:10014:administrator
ras and ias servers:x:10015:
allowed rodc password replication group:x:10016:
denied rodc password replication group:x:10017:krbtgt
read-only domain controllers:x:10018:
enterprise read-only domain controllers:x:10019:
dnsadmins:x:10020:
dnsupdateproxy:x:10021:
</pre>
<div class="mw-heading mw-heading3"><h3 id="Проверка_команд_Samba">
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D0.BA.D0.BE.D0.BC.D0.B0.D0.BD.D0.B4_Samba"></span>Проверка команд Samba</h3></div>
<p>Попробуйте некоторые команды,чтобу увидеть,может ли Samba взаимодействовать с AD:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># net ads info</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[2012/02/05 20:21:36.473559,  0] param/loadparm.c:7599(lp_do_parameter)
  Ignoring unknown parameter "idmapd backend"
LDAP server: 192.168.1.2
LDAP server name: PDC.example.com
Realm: EXAMPLE.COM
Bind Path: dc=EXAMPLE,dc=COM
LDAP port: 389
Server time: Sun, 05 Feb 2012 20:21:33 CST
KDC server: 192.168.1.2
Server time offset: -3
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># net ads lookup</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[2012/02/05 20:22:39.298823,  0] param/loadparm.c:7599(lp_do_parameter)
  Ignoring unknown parameter "idmapd backend"
Information for Domain Controller: 192.168.1.2

Response Type: LOGON_SAM_LOGON_RESPONSE_EX
GUID: 2a098512-4c9f-4fe4-ac22-8f9231fabbad
Flags:
        Is a PDC:                                   yes
        Is a GC of the forest:                      yes
        Is an LDAP server:                          yes
        Supports DS:                                yes
        Is running a KDC:                           yes
        Is running time services:                   yes
        Is the closest DC:                          yes
        Is writable:                                yes
        Has a hardware clock:                       yes
        Is a non-domain NC serviced by LDAP server: no
        Is NT6 DC that has some secrets:            no
        Is NT6 DC that has all secrets:             yes
Forest:                 example.com
Domain:                 example.com
Domain Controller:      PDC.example.com
Pre-Win2k Domain:       EXAMPLE
Pre-Win2k Hostname:     PDC
Server Site Name :              Office
Client Site Name :              Office
NT Version: 5
LMNT Token: ffff
LM20 Token: ffff
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># net ads status -U administrator | less</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: user
objectClass: computer
cn: myarchlinux
distinguishedName: CN=myarchlinux,CN=Computers,DC=leafscale,DC=inc
instanceType: 4
whenCreated: 20120206043413.0Z
whenChanged: 20120206043414.0Z
uSNCreated: 16556
uSNChanged: 16563
name: myarchlinux
objectGUID: 2c24029c-8422-42b2-83b3-a255b9cb41b3
userAccountControl: 69632
badPwdCount: 0
codePage: 0
countryCode: 0
badPasswordTime: 0
lastLogoff: 0
lastLogon: 129729780312632000
localPolicyFlags: 0
pwdLastSet: 129729764538848000
primaryGroupID: 515
objectSid: S-1-5-21-719106045-3766251393-3909931865-1105
...&lt;snip&gt;...
</pre>
<div class="mw-heading mw-heading2"><h2 id="Настройка_PAM">
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_PAM"></span>Настройка PAM</h2></div>
<p>Теперь мы будем менять разные правила в PAM, чтобы допустить пользователей AD к использованию системы для входа и к sudo доступу. Когда вы меняете правила, запоминание их порядка и помечены ли они как <b>required</b> или как <i>sufficient</i> критически важно,если вы хотите,чтобы всё работало,как вы задумали.Вам не стоит отклоняться от этих правил,если только вы не знаете как писать правила для PAM
</p>
<p>В случае со входом,PAM следует сначала запросить аккаунт AD и проверять локальные аккаунты только если аккаунту AD не соответствует локальный аккаунт.Поэтому, мы добавим записи,которые включат <code>pam_winbindd.so</code> в процесс аутентификации.
</p>
<p>Главный процесс аутентификации в конфигурации PAM Arch Linux находится в <code>/etc/pam.d/system-auth</code>. Начав со стандартной конфигурации из <code>pambase</code>, измените её следующим образом:
</p>
<div class="mw-heading mw-heading3"><h3 id="system-auth">system-auth</h3></div>
<div class="mw-heading mw-heading4"><h4 id="Раздел_&quot;auth&quot;">
<span id=".D0.A0.D0.B0.D0.B7.D0.B4.D0.B5.D0.BB_.22auth.22"></span>Раздел "auth"</h4></div>
<p>Найдите строку:
</p>
<pre>auth required pam_unix.so ...
</pre>
<p>Удалите её, и замените следующим:
</p>
<pre>auth [success=1 default=ignore] pam_localuser.so
auth [success=2 default=die] pam_winbind.so
auth [success=1 default=die] pam_unix.so nullok
auth requisite pam_deny.so
</pre>
<div class="mw-heading mw-heading4"><h4 id="Раздел_&quot;account&quot;">
<span id=".D0.A0.D0.B0.D0.B7.D0.B4.D0.B5.D0.BB_.22account.22"></span>Раздел "account"</h4></div>
<p>Найдите строку:
</p>
<pre>account required pam_unix.so
</pre>
<p>Под ней допишите следующее:
</p>
<pre>account [success=1 default=ignore] pam_localuser.so
account required pam_winbind.so
</pre>
<div class="mw-heading mw-heading4"><h4 id="Раздел_&quot;session&quot;">
<span id=".D0.A0.D0.B0.D0.B7.D0.B4.D0.B5.D0.BB_.22session.22"></span>Раздел "session"</h4></div>
<p>Найдите строку:
</p>
<pre>session required pam_unix.so
</pre>
<p>Под ней допишите следующее:
</p>
<pre>session required pam_mkhomedir.so umask=0022 skel=/etc/skel
session [success=1 default=ignore] pam_localuser.so
session required pam_winbind.so
</pre>
<div class="mw-heading mw-heading4"><h4 id="Раздел_&quot;password&quot;">
<span id=".D0.A0.D0.B0.D0.B7.D0.B4.D0.B5.D0.BB_.22password.22"></span>Раздел "password"</h4></div>
<p>Найдите строку:
</p>
<pre>password required pam_unix.so ...
</pre>
<p>Удалите её и замените следующими:
</p>
<pre>password [success=1 default=ignore] pam_localuser.so
password [success=2 default=die] pam_winbind.so
password [success=1 default=die] pam_unix.so sha512 shadow
password requisite pam_deny.so
</pre>
<div class="mw-heading mw-heading3"><h3 id="Проверка_входа">
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D0.B2.D1.85.D0.BE.D0.B4.D0.B0"></span>Проверка входа</h3></div>
<p>Теперь запустите новую сессию/войдите через ssh и попробуйте войти,использую данные аккаунта AD. Имя домена опционально, так как это было задано в настройках Winbind как 'default realm'. Заметьте,что в случае с ssh, вам нужно изменить <code>/etc/ssh/sshd_config</code>, чтобы он разрешал аутентификацию через kerberos: <code>(KerberosAuthentication yes)</code>.
</p>
<pre>test.user
EXAMPLE+test.user
</pre>
<p>Оба должны работать. Стоит подметить,что <code>/home/example/test.user</code> будет создан автоматически.
</p>
<p><b>Войдите в другую сессию использую аккаунт Linux. Удостоверьтесь,что всё ещё можете войти как root - запомните,что вы должны быть под аккаунтом root как минимум в одной сессии!</b>
</p>
<div class="mw-heading mw-heading2"><h2 id="Настройка_общих_файлов">
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D0.BE.D0.B1.D1.89.D0.B8.D1.85_.D1.84.D0.B0.D0.B9.D0.BB.D0.BE.D0.B2"></span>Настройка общих файлов</h2></div>
<p>Ранее мы пропустили настройку общих файлов. Теперь,когда всё работает, вернитесь к <code>/etc/smb.conf</code> и добавьте эксопрт для хостов,которые вы желаете сделать доступными в Windows
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[MyShare]
  comment = Example Share
  path = /srv/exports/myshare
  read only = no
  browseable = yes
  valid users = @NETWORK+"Domain Admins" NETWORK+test.user
</pre>
<p>В примере выше, ключевое слово <b>NETWORK</b>. Не путайте его с именем домена. Для добавления групп,добавьте символ '@' к группе. Заметьте, <code>Domain Admins</code> заключается в "цитаты", чтобы Samba корректно считывала их,когда просматривает файл конфигурации.
</p>
<div class="mw-heading mw-heading2"><h2 id="Добавление_файла_keytab_и_включение_беспарольного_входа_на_машину_через_Kerber_и_ssh">
<span id=".D0.94.D0.BE.D0.B1.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D1.84.D0.B0.D0.B9.D0.BB.D0.B0_keytab_.D0.B8_.D0.B2.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B1.D0.B5.D1.81.D0.BF.D0.B0.D1.80.D0.BE.D0.BB.D1.8C.D0.BD.D0.BE.D0.B3.D0.BE_.D0.B2.D1.85.D0.BE.D0.B4.D0.B0_.D0.BD.D0.B0_.D0.BC.D0.B0.D1.88.D0.B8.D0.BD.D1.83_.D1.87.D0.B5.D1.80.D0.B5.D0.B7_Kerber_.D0.B8_ssh"></span>Добавление файла keytab и включение беспарольного входа на машину через Kerber и ssh</h2></div>
<p>Это объясняет,как сгенерировать keytab файл,который вам нужен,например,чтобы включить беспарольный вход на машину через Kerber и ssh с другой машины в том же домене. Допустим, что у вас много компьютеров в домене и вы только что добавили сервер/рабочую станцию использую описание выше в ваш домен, в котором пользователям нужен ssh для работы - например рабочаю станция GPU или вычислительный узел OpenMP и т.д. В этом случае вам, наверное, не захочется вводить пароль каждый раз при входе. С другой стороны аутентификация с помощью ключа используется множеством пользователей, в этом случае нужных полномочий для,например,монтирования общего NFSv4 с Kerberos. Так что это поможет включить беспарольные входы на машины используя "kerberos ticket forwarding".
</p>
<div class="mw-heading mw-heading3"><h3 id="Создание_key_tab_файла">
<span id=".D0.A1.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D0.B5_key_tab_.D1.84.D0.B0.D0.B9.D0.BB.D0.B0"></span>Создание key tab файла</h3></div>
<p>Запустите 'net ads keytab create -U administrator' как суперпользователь дабы создать keytab файл в '/etc/krb5.keytab'. Она напишет ваи,что необходимо включить аутентификацию с помощью keytab в файле конфигурации, чтобы мы могли совершить следующий шаг. Иногда возникают проблемы, если файл krb5.keytab уже существует,в таком случае нужно переименовать его и запустить команду ещё раз, это должно помочь.
</p>
<pre># net ads keytab create -U administrator</pre>
<p>Проверьте содержание файла следующим образом:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># klist -k /etc/krb5.keytab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Keytab name: FILE:/etc/krb5.keytab
KVNO Principal
---- --------------------------------------------------------------------------
   4 host/myarchlinux.example.com@EXAMPLE.COM
   4 host/myarchlinux.example.com@EXAMPLE.COM
   4 host/myarchlinux.example.com@EXAMPLE.COM
   4 host/myarchlinux.example.com@EXAMPLE.COM
   4 host/myarchlinux.example.com@EXAMPLE.COM
   4 host/MYARCHLINUX@EXAMPLE.COM
   4 host/MYARCHLINUX@EXAMPLE.COM
   4 host/MYARCHLINUX@EXAMPLE.COM
   4 host/MYARCHLINUX@EXAMPLE.COM
   4 host/MYARCHLINUX@EXAMPLE.COM
   4 MYARCHLINUX$@EXAMPLE.COM
   4 MYARCHLINUX$@EXAMPLE.COM
   4 MYARCHLINUX$@EXAMPLE.COM
   4 MYARCHLINUX$@EXAMPLE.COM
   4 MYARCHLINUX$@EXAMPLE.COM
</pre>
<div class="mw-heading mw-heading3"><h3 id="Включение_входа_через_keytab">
<span id=".D0.92.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B2.D1.85.D0.BE.D0.B4.D0.B0_.D1.87.D0.B5.D1.80.D0.B5.D0.B7_keytab"></span>Включение входа через keytab</h3></div>
<p>Теперь вам нужно указать winbind,что он должен использовать keytab файлы,добавив следующий строки в /etc/samba/smb.conf:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> kerberos method = system keytab
 dedicated keytab file = /etc/krb5.keytab
</pre>
<p>В итоге всё должно выглядеть примерно так:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Global]
  netbios name = MYARCHLINUX
  workgroup = EXAMPLE
  realm = EXAMPLE.COM
  server string = %h Arch Linux Host
  security = ads
  encrypt passwords = yes
  password server = pdc.example.com
  kerberos method = system keytab
  dedicated keytab file = /etc/krb5.keytab

  idmap config * : backend = tdb
  idmap config * : range = 10000-20000

  winbind use default domain = Yes
  winbind enum users = Yes
  winbind enum groups = Yes
  winbind nested groups = Yes
  winbind separator = +
  winbind refresh tickets = yes

  template shell = /bin/bash
  template homedir = /home/%D/%U
   
  preferred master = no
  dns proxy = no
  wins server = pdc.example.com
  wins proxy = no

  inherit acls = Yes
  map acl inherit = Yes
  acl group control = yes

  load printers = no
  debug level = 3
  use sendfile = no
</pre>
<p>Перезапустите winbind.service с помощью 'systemctl restart winbind.service' с привелегиями суперпользователя.
</p>
<pre># systemctl restart winbind.service</pre>
<p>Проверьте,всё ли работает,получив тикет для вашей системы и запустив
</p>
<pre># kinit MYARCHLINUX$ -kt /etc/krb5.keytab</pre>
<p>Эта команда не должна написать ничего в консоль,ондако 'klist' должен показать что-то вроде этого:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># klist</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> Ticket cache: FILE:/tmp/krb5cc_0
 Default principal: MYARCHLINUX$@EXAMPLE.COM
 
 Valid starting    Expires           Service principal 
 02/04/12 21:27:47 02/05/12 07:27:42 krbtgt/EXAMPLE.COM@EXAMPLE.COM
         renew until 02/05/12 21:27:47
</pre>
<p>Некоторые частые ошибки : a)забывают поставить $ или b) игнорируют чувствительный регистр - он должен быть точно таким же,как записьв keytab
</p>
<div class="mw-heading mw-heading3"><h3 id="Подготовка_sshd_на_сервере">
<span id=".D0.9F.D0.BE.D0.B4.D0.B3.D0.BE.D1.82.D0.BE.D0.B2.D0.BA.D0.B0_sshd_.D0.BD.D0.B0_.D1.81.D0.B5.D1.80.D0.B2.D0.B5.D1.80.D0.B5"></span>Подготовка sshd на сервере</h3></div>
<p>Всё,что нам нужно сделать - это добавить некоторые опции в sshd_config и перезапустить sshd.service.
</p>
<p>Измените '/etc/ssh/sshd_config' чтобы он выглядел так в нужных местах:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># /etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">

...

# Изсенить на no чтобы выключить s/key пароли
ChallengeResponseAuthentication no

# Опции Kerberos 
KerberosAuthentication yes
#KerberosOrLocalPasswd yes
KerberosTicketCleanup yes
KerberosGetAFSToken yes

# Опции GSSAPI
GSSAPIAuthentication yes
GSSAPICleanupCredentials yes

...

</pre>
<p>Перезапустите sshd.service: 
</p>
<pre># systemctl restart sshd.service</pre>
<div class="mw-heading mw-heading3"><h3 id="Добавление_опций,_нужных_для_клиента">
<span id=".D0.94.D0.BE.D0.B1.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BE.D0.BF.D1.86.D0.B8.D0.B9.2C_.D0.BD.D1.83.D0.B6.D0.BD.D1.8B.D1.85_.D0.B4.D0.BB.D1.8F_.D0.BA.D0.BB.D0.B8.D0.B5.D0.BD.D1.82.D0.B0"></span>Добавление опций, нужных для клиента</h3></div>
<p>Для начала нам нужно убедиться в том, что тикеты доступны для клиента. Обычно всё работает, но, на всякий случай, используйте следующий параметр:
</p>
<pre>forwardable = true
</pre>
<p>Далее надо добавить опции:
</p>
<pre>GSSAPIAuthentication yes
GSSAPIDelegateCredentials yes

</pre>
<p>в наш файл <code>.ssh/config</code>, который говорит <i>ssh</i> использовать эту опцию, как альтернативу: можно использовать 'ssh -o' (смотрите страницу справочного руководства <span class="plainlinks archwiki-template-man" title="$ man 1 ssh"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh.1">ssh(1)</a></span>).
</p>
<div class="mw-heading mw-heading3"><h3 id="Проверка_установки">
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D1.83.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B8"></span>Проверка установки</h3></div>
<p>Клиент:
</p>
<p>Убедитесь,что у вас правильный тикет, используя 'kinit'. Затем подключитесь к своем машине через ssh
</p>
<pre>ssh myarchlinux.example.com </pre>
<p>Вы должны подключится без просьбы ввести пароль
</p>
<p>Если у вас также включна аутентификация ключем,нужно выполнить
</p>
<pre>ssh -v myarchlinux.example.com </pre>
<p>чтобы увидеть,какой метод аутентификации используется на самом деле.
</p>
<p>Для дебага вы можете включить DEBUG3 на сервере и посмотреть лог через 'journalctl'
</p>
<div class="mw-heading mw-heading3"><h3 id="Настройка_для_полной_аутентификации_Kerberos_без_пароля.">
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D0.B4.D0.BB.D1.8F_.D0.BF.D0.BE.D0.BB.D0.BD.D0.BE.D0.B9_.D0.B0.D1.83.D1.82.D0.B5.D0.BD.D1.82.D0.B8.D1.84.D0.B8.D0.BA.D0.B0.D1.86.D0.B8.D0.B8_Kerberos_.D0.B1.D0.B5.D0.B7_.D0.BF.D0.B0.D1.80.D0.BE.D0.BB.D1.8F."></span>Настройка для полной аутентификации Kerberos без пароля.</h3></div>
<p>Если ваши клиенты не используют доменные аккаунты на их локальных машинах (по какой бы то не было причине),довольно сложно будет научить их использовать 'kinit' перед тем,как ssh подключится к рабочей станции.Так что есть классный способ это решить:
</p>
<div class="mw-heading mw-heading2"><h2 id="Генерирование_keytab,_которые_будет_принимать_AD">
<span id=".D0.93.D0.B5.D0.BD.D0.B5.D1.80.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_keytab.2C_.D0.BA.D0.BE.D1.82.D0.BE.D1.80.D1.8B.D0.B5_.D0.B1.D1.83.D0.B4.D0.B5.D1.82_.D0.BF.D1.80.D0.B8.D0.BD.D0.B8.D0.BC.D0.B0.D1.82.D1.8C_AD"></span>Генерирование keytab, которые будет принимать AD</h2></div>
<p>Пользователь должен выполнить:
</p>
<pre>ktutil
addent -password -p username@EXAMPLE.COM -k 1 -e RC4-HMAC
- enter password for username -
wkt username.keytab
q
</pre>
<p>Теперь провертьте файл:
</p>
<pre>kinit -kt username.keytab</pre>
<p>Оно не должно спросить пароль, теперь просто скопируйте это в '~/.bashrc', это позволит не вводит пароль каждый раз.
</p>
<div class="mw-heading mw-heading3"><h3 id="Интересно_знать">
<span id=".D0.98.D0.BD.D1.82.D0.B5.D1.80.D0.B5.D1.81.D0.BD.D0.BE_.D0.B7.D0.BD.D0.B0.D1.82.D1.8C"></span>Интересно знать</h3></div>
<p>Файл 'username.keytab' не спецефичен для машины,и,следовательно,может быть скопирован на другие машины. Например,мы создали файл на Linux машине и скопировали на Mac клиента так как команды в неё другие...
</p>
<div class="mw-heading mw-heading2"><h2 id="Смотрите_также">
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span>Смотрите также</h2></div>
<ul>
<li><a href="https://en.wikipedia.org/wiki/ru:Active_Directory" class="extiw" title="wikipedia:ru:Active Directory">Wikipedia: Active Directory</a></li>
<li><a href="https://en.wikipedia.org/wiki/ru:Samba" class="extiw" title="wikipedia:ru:Samba">Wikipedia: Samba</a></li>
<li><a href="https://en.wikipedia.org/wiki/ru:Kerberos" class="extiw" title="wikipedia:ru:Kerberos">Wikipedia: Kerberos</a></li>
<li><a rel="nofollow" class="external text" href="https://www.samba.org/samba/docs">Samba: Documentation</a></li>
<li><a rel="nofollow" class="external text" href="https://wiki.samba.org/index.php?title=Samba,_Active_Directory_%26_LDAP&amp;direction=next&amp;oldid=4082">Samba Wiki - Samba, Active Directory &amp; LDAP</a></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5">smb.conf(5)</a></span></li>
</ul>
<div class="mw-heading mw-heading3"><h3 id="Коммерческие_решения">
<span id=".D0.9A.D0.BE.D0.BC.D0.BC.D0.B5.D1.80.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B5_.D1.80.D0.B5.D1.88.D0.B5.D0.BD.D0.B8.D1.8F"></span>Коммерческие решения</h3></div>
<ul>
<li>Centrify</li>
<li>Likewise</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../ru/Category:Directory_services.html" title="Category:Directory services (Русский)">Directory services (Русский)</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Active_Directory_integration_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=778429">https://wiki.archlinux.org/index.php?title=Active_Directory_integration_(Русский)&amp;oldid=778429</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 18 May 2023, at 14:20.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true"><span class="mw-page-title-main">Active Directory integration (Русский)</span></div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
