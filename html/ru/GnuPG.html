<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>GnuPG (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-GnuPG_Русский rootpage-GnuPG_Русский skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Установка" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Установка</div>
		</a>
		
		<ul id="toc-Установка-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Настройка" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Настройка</div>
		</a>
		
			<button aria-controls="toc-Настройка-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Настройка subsection</span>
			</button>
		
		<ul id="toc-Настройка-sublist" class="vector-toc-list">
			<li id="toc-Домашний_каталог" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%94%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B8%D0%B9_%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Домашний каталог</div>
			</a>
			
			<ul id="toc-Домашний_каталог-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Файлы_конфигурации" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A4%D0%B0%D0%B9%D0%BB%D1%8B_%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Файлы конфигурации</div>
			</a>
			
			<ul id="toc-Файлы_конфигурации-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Стандартные_настройки_для_новых_пользователей" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D1%82%D0%B0%D0%BD%D0%B4%D0%B0%D1%80%D1%82%D0%BD%D1%8B%D0%B5_%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8_%D0%B4%D0%BB%D1%8F_%D0%BD%D0%BE%D0%B2%D1%8B%D1%85_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B5%D0%B9">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Стандартные настройки для новых пользователей</div>
			</a>
			
			<ul id="toc-Стандартные_настройки_для_новых_пользователей-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Использование" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Использование</div>
		</a>
		
			<button aria-controls="toc-Использование-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Использование subsection</span>
			</button>
		
		<ul id="toc-Использование-sublist" class="vector-toc-list">
			<li id="toc-Создание_пары_ключей" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%B0%D1%80%D1%8B_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Создание пары ключей</div>
			</a>
			
			<ul id="toc-Создание_пары_ключей-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Просмотр_списка_ключей" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80_%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B0_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Просмотр списка ключей</div>
			</a>
			
			<ul id="toc-Просмотр_списка_ключей-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Экспорт_открытого_ключа" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%AD%D0%BA%D1%81%D0%BF%D0%BE%D1%80%D1%82_%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D0%BE%D0%B3%D0%BE_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Экспорт открытого ключа</div>
			</a>
			
			<ul id="toc-Экспорт_открытого_ключа-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Импорт_открытого_ключа" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%98%D0%BC%D0%BF%D0%BE%D1%80%D1%82_%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D0%BE%D0%B3%D0%BE_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4</span>Импорт открытого ключа</div>
			</a>
			
			<ul id="toc-Импорт_открытого_ключа-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Использование_сервера_ключей" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.5</span>Использование сервера ключей</div>
			</a>
			
			<ul id="toc-Использование_сервера_ключей-sublist" class="vector-toc-list">
				<li id="toc-Отправка_ключей" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9E%D1%82%D0%BF%D1%80%D0%B0%D0%B2%D0%BA%D0%B0_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.5.1</span>Отправка ключей</div>
			</a>
			
			<ul id="toc-Отправка_ключей-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Поиск_и_получение_ключей" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9F%D0%BE%D0%B8%D1%81%D0%BA_%D0%B8_%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.5.2</span>Поиск и получение ключей</div>
			</a>
			
			<ul id="toc-Поиск_и_получение_ключей-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Серверы_ключей" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A1%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D1%8B_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.5.3</span>Серверы ключей</div>
			</a>
			
			<ul id="toc-Серверы_ключей-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Web_Key_Directory" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Web_Key_Directory">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.6</span>Web Key Directory</div>
			</a>
			
			<ul id="toc-Web_Key_Directory-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Шифрование_и_дешифрование" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A8%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B8_%D0%B4%D0%B5%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.7</span>Шифрование и дешифрование</div>
			</a>
			
			<ul id="toc-Шифрование_и_дешифрование-sublist" class="vector-toc-list">
				<li id="toc-Асимметричное" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%90%D1%81%D0%B8%D0%BC%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%BD%D0%BE%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.7.1</span>Асимметричное</div>
			</a>
			
			<ul id="toc-Асимметричное-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Симметричное" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A1%D0%B8%D0%BC%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%BD%D0%BE%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.7.2</span>Симметричное</div>
			</a>
			
			<ul id="toc-Симметричное-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Каталог" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9A%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.7.3</span>Каталог</div>
			</a>
			
			<ul id="toc-Каталог-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Управление_ключами" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0%D0%BC%D0%B8">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Управление ключами</div>
		</a>
		
			<button aria-controls="toc-Управление_ключами-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Управление ключами subsection</span>
			</button>
		
		<ul id="toc-Управление_ключами-sublist" class="vector-toc-list">
			<li id="toc-Резервное_копирование_закрытого_ключа" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A0%D0%B5%D0%B7%D0%B5%D1%80%D0%B2%D0%BD%D0%BE%D0%B5_%D0%BA%D0%BE%D0%BF%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B7%D0%B0%D0%BA%D1%80%D1%8B%D1%82%D0%BE%D0%B3%D0%BE_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Резервное копирование закрытого ключа</div>
			</a>
			
			<ul id="toc-Резервное_копирование_закрытого_ключа-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Резервное_копирование_сертификата_отзыва" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A0%D0%B5%D0%B7%D0%B5%D1%80%D0%B2%D0%BD%D0%BE%D0%B5_%D0%BA%D0%BE%D0%BF%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D0%B5%D1%80%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%B0_%D0%BE%D1%82%D0%B7%D1%8B%D0%B2%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Резервное копирование сертификата отзыва</div>
			</a>
			
			<ul id="toc-Резервное_копирование_сертификата_отзыва-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Редактирование_ключа" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A0%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Редактирование ключа</div>
			</a>
			
			<ul id="toc-Редактирование_ключа-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Экспорт_подключей" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%AD%D0%BA%D1%81%D0%BF%D0%BE%D1%80%D1%82_%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>Экспорт подключей</div>
			</a>
			
			<ul id="toc-Экспорт_подключей-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Продление_срока_действия" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B4%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%81%D1%80%D0%BE%D0%BA%D0%B0_%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.5</span>Продление срока действия</div>
			</a>
			
			<ul id="toc-Продление_срока_действия-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Ротация_подключей" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A0%D0%BE%D1%82%D0%B0%D1%86%D0%B8%D1%8F_%D0%BF%D0%BE%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.6</span>Ротация подключей</div>
			</a>
			
			<ul id="toc-Ротация_подключей-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Отзыв_ключа" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9E%D1%82%D0%B7%D1%8B%D0%B2_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.7</span>Отзыв ключа</div>
			</a>
			
			<ul id="toc-Отзыв_ключа-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Подпись" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%9F%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D1%8C">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Подпись</div>
		</a>
		
			<button aria-controls="toc-Подпись-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Подпись subsection</span>
			</button>
		
		<ul id="toc-Подпись-sublist" class="vector-toc-list">
			<li id="toc-Создание_подписи" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Создание подписи</div>
			</a>
			
			<ul id="toc-Создание_подписи-sublist" class="vector-toc-list">
				<li id="toc-Подпись_файла" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9F%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D1%8C_%D1%84%D0%B0%D0%B9%D0%BB%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.1</span>Подпись файла</div>
			</a>
			
			<ul id="toc-Подпись_файла-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Подпись_файла_в_текстовом_формате" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9F%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D1%8C_%D1%84%D0%B0%D0%B9%D0%BB%D0%B0_%D0%B2_%D1%82%D0%B5%D0%BA%D1%81%D1%82%D0%BE%D0%B2%D0%BE%D0%BC_%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.2</span>Подпись файла в текстовом формате</div>
			</a>
			
			<ul id="toc-Подпись_файла_в_текстовом_формате-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Создание_отделённой_подписи" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BE%D1%82%D0%B4%D0%B5%D0%BB%D1%91%D0%BD%D0%BD%D0%BE%D0%B9_%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.3</span>Создание отделённой подписи</div>
			</a>
			
			<ul id="toc-Создание_отделённой_подписи-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Проверка_подписи" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D0%B8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Проверка подписи</div>
			</a>
			
			<ul id="toc-Проверка_подписи-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-gpg-agent" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#gpg-agent">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>gpg-agent</div>
		</a>
		
			<button aria-controls="toc-gpg-agent-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle gpg-agent subsection</span>
			</button>
		
		<ul id="toc-gpg-agent-sublist" class="vector-toc-list">
			<li id="toc-Настройка_2" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>Настройка</div>
			</a>
			
			<ul id="toc-Настройка_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Перезапуск_агента" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_%D0%B0%D0%B3%D0%B5%D0%BD%D1%82%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2</span>Перезапуск агента</div>
			</a>
			
			<ul id="toc-Перезапуск_агента-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-pinentry" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#pinentry">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.3</span>pinentry</div>
			</a>
			
			<ul id="toc-pinentry-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Кэширование_паролей" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9A%D1%8D%D1%88%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D0%B5%D0%B9">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.4</span>Кэширование паролей</div>
			</a>
			
			<ul id="toc-Кэширование_паролей-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Автоматический_ввод_пароля" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%B2%D0%B2%D0%BE%D0%B4_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.5</span>Автоматический ввод пароля</div>
			</a>
			
			<ul id="toc-Автоматический_ввод_пароля-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Агент_SSH" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%90%D0%B3%D0%B5%D0%BD%D1%82_SSH">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.6</span>Агент SSH</div>
			</a>
			
			<ul id="toc-Агент_SSH-sublist" class="vector-toc-list">
				<li id="toc-Установка_SSH_AUTH_SOCK" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_SSH_AUTH_SOCK">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.6.1</span>Установка SSH_AUTH_SOCK</div>
			</a>
			
			<ul id="toc-Установка_SSH_AUTH_SOCK-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Настройка_pinentry_для_использования_правильного_TTY" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_pinentry_%D0%B4%D0%BB%D1%8F_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB%D1%8C%D0%BD%D0%BE%D0%B3%D0%BE_TTY">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.6.2</span>Настройка pinentry для использования правильного TTY</div>
			</a>
			
			<ul id="toc-Настройка_pinentry_для_использования_правильного_TTY-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Добавление_ключей_SSH" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9_SSH">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.6.3</span>Добавление ключей SSH</div>
			</a>
			
			<ul id="toc-Добавление_ключей_SSH-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Использование_ключа_PGP_для_аутентификации_SSH" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0_PGP_%D0%B4%D0%BB%D1%8F_%D0%B0%D1%83%D1%82%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D0%B8_SSH">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.6.4</span>Использование ключа PGP для аутентификации SSH</div>
			</a>
			
			<ul id="toc-Использование_ключа_PGP_для_аутентификации_SSH-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Доступ_к_gpg-agent_и_ssh-agent_на_удалённом_устройстве" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%94%D0%BE%D1%81%D1%82%D1%83%D0%BF_%D0%BA_gpg-agent_%D0%B8_ssh-agent_%D0%BD%D0%B0_%D1%83%D0%B4%D0%B0%D0%BB%D1%91%D0%BD%D0%BD%D0%BE%D0%BC_%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%B5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.7</span>Доступ к gpg-agent и ssh-agent на удалённом устройстве</div>
			</a>
			
			<ul id="toc-Доступ_к_gpg-agent_и_ssh-agent_на_удалённом_устройстве-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Смарт-карты" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A1%D0%BC%D0%B0%D1%80%D1%82-%D0%BA%D0%B0%D1%80%D1%82%D1%8B">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Смарт-карты</div>
		</a>
		
			<button aria-controls="toc-Смарт-карты-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Смарт-карты subsection</span>
			</button>
		
		<ul id="toc-Смарт-карты-sublist" class="vector-toc-list">
			<li id="toc-Настройка_только_для_GnuPG" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D1%82%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE_%D0%B4%D0%BB%D1%8F_GnuPG">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1</span>Настройка только для GnuPG</div>
			</a>
			
			<ul id="toc-Настройка_только_для_GnuPG-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-GnuPG_вместе_с_pcscd_(PCSC_Lite)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#GnuPG_%D0%B2%D0%BC%D0%B5%D1%81%D1%82%D0%B5_%D1%81_pcscd_(PCSC_Lite)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2</span>GnuPG вместе с pcscd (PCSC Lite)</div>
			</a>
			
			<ul id="toc-GnuPG_вместе_с_pcscd_(PCSC_Lite)-sublist" class="vector-toc-list">
				<li id="toc-Всегда_использовать_pcscd" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%92%D1%81%D0%B5%D0%B3%D0%B4%D0%B0_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D1%8C_pcscd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2.1</span>Всегда использовать pcscd</div>
			</a>
			
			<ul id="toc-Всегда_использовать_pcscd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Общий_доступ_с_pcscd" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9E%D0%B1%D1%89%D0%B8%D0%B9_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF_%D1%81_pcscd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2.2</span>Общий доступ с pcscd</div>
			</a>
			
			<ul id="toc-Общий_доступ_с_pcscd-sublist" class="vector-toc-list">
				<li id="toc-Multi_applet_smart_cards" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Multi_applet_smart_cards">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2.2.1</span>Multi applet smart cards</div>
			</a>
			
			<ul id="toc-Multi_applet_smart_cards-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Использование_смарт-карты_на_удалённом_клиенте_через_SSH" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D0%BC%D0%B0%D1%80%D1%82-%D0%BA%D0%B0%D1%80%D1%82%D1%8B_%D0%BD%D0%B0_%D1%83%D0%B4%D0%B0%D0%BB%D1%91%D0%BD%D0%BD%D0%BE%D0%BC_%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D0%B5_%D1%87%D0%B5%D1%80%D0%B5%D0%B7_SSH">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2.2.2</span>Использование смарт-карты на удалённом клиенте через SSH</div>
			</a>
			
			<ul id="toc-Использование_смарт-карты_на_удалённом_клиенте_через_SSH-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Советы_и_рекомендации" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A1%D0%BE%D0%B2%D0%B5%D1%82%D1%8B_%D0%B8_%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D0%B0%D1%86%D0%B8%D0%B8">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>Советы и рекомендации</div>
		</a>
		
			<button aria-controls="toc-Советы_и_рекомендации-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Советы и рекомендации subsection</span>
			</button>
		
		<ul id="toc-Советы_и_рекомендации-sublist" class="vector-toc-list">
			<li id="toc-Другой_алгоритм" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%94%D1%80%D1%83%D0%B3%D0%BE%D0%B9_%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.1</span>Другой алгоритм</div>
			</a>
			
			<ul id="toc-Другой_алгоритм-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Шифрование_пароля" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A8%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.2</span>Шифрование пароля</div>
			</a>
			
			<ul id="toc-Шифрование_пароля-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Изменение_модели_доверия" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%98%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D0%B8_%D0%B4%D0%BE%D0%B2%D0%B5%D1%80%D0%B8%D1%8F">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.3</span>Изменение модели доверия</div>
			</a>
			
			<ul id="toc-Изменение_модели_доверия-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Скрытие_всех_идентификаторов_получателей" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%BA%D1%80%D1%8B%D1%82%D0%B8%D0%B5_%D0%B2%D1%81%D0%B5%D1%85_%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2_%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B0%D1%82%D0%B5%D0%BB%D0%B5%D0%B9">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.4</span>Скрытие всех идентификаторов получателей</div>
			</a>
			
			<ul id="toc-Скрытие_всех_идентификаторов_получателей-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Использование_caff_на_встречах_для_подписи_ключей" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_caff_%D0%BD%D0%B0_%D0%B2%D1%81%D1%82%D1%80%D0%B5%D1%87%D0%B0%D1%85_%D0%B4%D0%BB%D1%8F_%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D0%B8_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.5</span>Использование caff на встречах для подписи ключей</div>
			</a>
			
			<ul id="toc-Использование_caff_на_встречах_для_подписи_ключей-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Отображение_длинных_идентификаторов_и_отпечатков" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9E%D1%82%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B4%D0%BB%D0%B8%D0%BD%D0%BD%D1%8B%D1%85_%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2_%D0%B8_%D0%BE%D1%82%D0%BF%D0%B5%D1%87%D0%B0%D1%82%D0%BA%D0%BE%D0%B2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.6</span>Отображение длинных идентификаторов и отпечатков</div>
			</a>
			
			<ul id="toc-Отображение_длинных_идентификаторов_и_отпечатков-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Настройка_возможностей" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%B2%D0%BE%D0%B7%D0%BC%D0%BE%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D0%B5%D0%B9">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.7</span>Настройка возможностей</div>
			</a>
			
			<ul id="toc-Настройка_возможностей-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Решение_проблем" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A0%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">9</span>Решение проблем</div>
		</a>
		
			<button aria-controls="toc-Решение_проблем-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Решение проблем subsection</span>
			</button>
		
		<ul id="toc-Решение_проблем-sublist" class="vector-toc-list">
			<li id="toc-su" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#su">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.1</span>su</div>
			</a>
			
			<ul id="toc-su-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Agent_выводит_ошибку_end_of_file" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Agent_%D0%B2%D1%8B%D0%B2%D0%BE%D0%B4%D0%B8%D1%82_%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D1%83_end_of_file">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.2</span>Agent выводит ошибку end of file</div>
			</a>
			
			<ul id="toc-Agent_выводит_ошибку_end_of_file-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Настройка_прав_доступа_для_KGpg" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%BF%D1%80%D0%B0%D0%B2_%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0_%D0%B4%D0%BB%D1%8F_KGpg">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.3</span>Настройка прав доступа для KGpg</div>
			</a>
			
			<ul id="toc-Настройка_прав_доступа_для_KGpg-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-GNOME_на_Wayland_переопределяет_сокет_агента_SSH" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#GNOME_%D0%BD%D0%B0_Wayland_%D0%BF%D0%B5%D1%80%D0%B5%D0%BE%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D1%8F%D0%B5%D1%82_%D1%81%D0%BE%D0%BA%D0%B5%D1%82_%D0%B0%D0%B3%D0%B5%D0%BD%D1%82%D0%B0_SSH">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.4</span>GNOME на Wayland переопределяет сокет агента SSH</div>
			</a>
			
			<ul id="toc-GNOME_на_Wayland_переопределяет_сокет_агента_SSH-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-mutt" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#mutt">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.5</span>mutt</div>
			</a>
			
			<ul id="toc-mutt-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-"Потерявшиеся"_ключи_после_обновления_до_GnuPG_2.1' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#"%D0%9F%D0%BE%D1%82%D0%B5%D1%80%D1%8F%D0%B2%D1%88%D0%B8%D0%B5%D1%81%D1%8F"_%D0%BA%D0%BB%D1%8E%D1%87%D0%B8_%D0%BF%D0%BE%D1%81%D0%BB%D0%B5_%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F_%D0%B4%D0%BE_GnuPG_2.1'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.6</span>"Потерявшиеся" ключи после обновления до GnuPG 2.1</div>
			</a>
			
			<ul id='toc-"Потерявшиеся"_ключи_после_обновления_до_GnuPG_2.1-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-gpg_зависает_на_всех_серверах_ключей_(при_попытке_получения_ключей)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#gpg_%D0%B7%D0%B0%D0%B2%D0%B8%D1%81%D0%B0%D0%B5%D1%82_%D0%BD%D0%B0_%D0%B2%D1%81%D0%B5%D1%85_%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0%D1%85_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9_(%D0%BF%D1%80%D0%B8_%D0%BF%D0%BE%D0%BF%D1%8B%D1%82%D0%BA%D0%B5_%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D1%8F_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.7</span>gpg зависает на всех серверах ключей (при попытке получения ключей)</div>
			</a>
			
			<ul id="toc-gpg_зависает_на_всех_серверах_ключей_(при_попытке_получения_ключей)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Смарт-карта_не_обнаружена" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%BC%D0%B0%D1%80%D1%82-%D0%BA%D0%B0%D1%80%D1%82%D0%B0_%D0%BD%D0%B5_%D0%BE%D0%B1%D0%BD%D0%B0%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.8</span>Смарт-карта не обнаружена</div>
			</a>
			
			<ul id="toc-Смарт-карта_не_обнаружена-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-server_'gpg-agent'_is_older_than_us_(x_&lt;_y)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#server_'gpg-agent'_is_older_than_us_(x_&lt;_y)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.9</span>server 'gpg-agent' is older than us (x &lt; y)</div>
			</a>
			
			<ul id="toc-server_'gpg-agent'_is_older_than_us_(x_&lt;_y)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-IPC_connect_call_failed" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#IPC_connect_call_failed">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.10</span>IPC connect call failed</div>
			</a>
			
			<ul id="toc-IPC_connect_call_failed-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Защита_от_отравленных_PGP-сертификатов" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%97%D0%B0%D1%89%D0%B8%D1%82%D0%B0_%D0%BE%D1%82_%D0%BE%D1%82%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%BD%D1%8B%D1%85_PGP-%D1%81%D0%B5%D1%80%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D0%B2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.11</span>Защита от отравленных PGP-сертификатов</div>
			</a>
			
			<ul id="toc-Защита_от_отравленных_PGP-сертификатов-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Invalid_IPC_response_и_Inappropriate_ioctl_for_device" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Invalid_IPC_response_%D0%B8_Inappropriate_ioctl_for_device">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.12</span>Invalid IPC response и Inappropriate ioctl for device</div>
			</a>
			
			<ul id="toc-Invalid_IPC_response_и_Inappropriate_ioctl_for_device-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Keyblock_resource_не_существует" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Keyblock_resource_%D0%BD%D0%B5_%D1%81%D1%83%D1%89%D0%B5%D1%81%D1%82%D0%B2%D1%83%D0%B5%D1%82">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.13</span>Keyblock resource не существует</div>
			</a>
			
			<ul id="toc-Keyblock_resource_не_существует-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Смотрите_также" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">10</span>Смотрите также</div>
		</a>
		
		<ul id="toc-Смотрите_также-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">GnuPG (Русский)</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 5 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-5" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">5 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-de mw-list-item"><a href="https://wiki.archlinux.de/title/GnuPG" title="GnuPG – Deutsch" lang="de" hreflang="de" class="interlanguage-link-target"><span>Deutsch</span></a></li>
<li class="interlanguage-link interwiki-en mw-list-item"><a href="../en/GnuPG.html" title="GnuPG – English" lang="en" hreflang="en" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/GnuPG" title="GnuPG – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pl mw-list-item"><a href="../pl/GnuPG.html" title="GnuPG – polski" lang="pl" hreflang="pl" class="interlanguage-link-target"><span>Polski</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/GnuPG" title="GnuPG – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="ru" dir="ltr">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../en/GnuPG.html" title="GnuPG">GnuPG</a>. Дата последней синхронизации: 9 октября 2023. Вы можете <a href="../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=GnuPG&amp;diff=0&amp;oldid=789352">изменения</a>.</div>
<div class="archwiki-template-meta-related-articles">
<p>Ссылки по теме</p>
<ul>
<li><a href="../ru/Pacman/Package_signing.html" class="mw-redirect" title="Pacman/Подпись пакета">pacman/Подпись пакета</a></li>
<li><a href="../ru/Data-at-rest_encryption.html" title="Data-at-rest encryption (Русский)">Data-at-rest encryption (Русский)</a></li>
<li><a href="../ru/List_of_applications/Security.html#%D0%A8%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5,_%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D0%B8_%D0%B8_%D1%81%D1%82%D0%B5%D0%B3%D0%B0%D0%BD%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%8F" class="mw-redirect" title="Список приложений/Безопасность">Список приложений/Безопасность#Шифрование, подписи и стеганография</a></li>
</ul>
</div>
<p>В соответствии с официальной <a rel="nofollow" class="external text" href="https://www.gnupg.org/">веб-страницей</a>:
</p>
<dl><dd>GnuPG — полная и свободная реализация стандарта <a rel="nofollow" class="external text" href="https://openpgp.org/about/">OpenPGP</a>, определённого в <a rel="nofollow" class="external text" href="https://tools.ietf.org/html/rfc4880">RFC4880</a> (также известного как PGP). GnuPG позволяет вам шифровать и подписывать данные и сообщения. Он оснащён универсальной системой управления ключами, а также модулями доступа для всех типов открытых ключей. GnuPG, также известный как GPG, это инструмент командной строки с возможностью лёгкой интеграции с другими приложениями. Доступен богатый выбор пользовательских приложений и библиотек. GnuPG также поддерживает S/MIME и Secure Shell (ssh).</dd></dl>
<meta property="mw:PageProp/toc">
<h2>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0"></span><span class="mw-headline" id="Установка">Установка</span>
</h2>
<p><a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">Установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnupg">gnupg</a></span>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Хотя текущая стабильная версия GnuPG — 2.4, пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnupg">gnupg</a></span> содержит версию 2.2. Если вам нужна версия 2.4, установите <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/gnupg24/">gnupg24</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/ArchWiki:Requests.html#Broken_package_links" class="mw-redirect" title="ArchWiki:Requests">ссылка недействительна</a>: package not found]</sup>. Смотрите <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=286519">BBS#286519</a>.</div>
<p>При этом будет установлен <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pinentry">pinentry</a></span> — набор простых диалоговых окон для ввода PIN-кода или парольной фразы, который использует GnuPG. Скрипт <code>/usr/bin/pinentry</code> определяет, какая конкретно реализация <i>pinentry</i> будет использоваться; смотрите раздел <a href="#pinentry">#pinentry</a>.
</p>
<p>Список программ, взаимодействующих с GnuPG, и графических фронтендов доступен в статье <a href="../ru/List_of_applications/Security.html#%D0%A8%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5,_%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D0%B8_%D0%B8_%D1%81%D1%82%D0%B5%D0%B3%D0%B0%D0%BD%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%8F" class="mw-redirect" title="Список приложений/Безопасность">Список приложений/Безопасность#Шифрование, подписи и стеганография</a>.
</p>
<h2>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0"></span><span class="mw-headline" id="Настройка">Настройка</span>
</h2>
<h3>
<span id=".D0.94.D0.BE.D0.BC.D0.B0.D1.88.D0.BD.D0.B8.D0.B9_.D0.BA.D0.B0.D1.82.D0.B0.D0.BB.D0.BE.D0.B3"></span><span class="mw-headline" id="Домашний_каталог">Домашний каталог</span>
</h3>
<p>Домашний каталог GnuPG — это место, где GnuPG хранит связки ключей, закрытые ключи и конфигурационные файлы. По умолчанию используется <code>~/.gnupg</code>. Есть два способа задать свой путь:
</p>
<ul>
<li>с помощью <a href="../ru/Environment_variables.html" title="Environment variables (Русский)">переменной окружения</a> <code>$GNUPGHOME</code>;</li>
<li>с помощью аргумента <code>--homedir</code>, например <code>$ gpg --homedir <i>путь/к/каталогу</i></code> <a rel="nofollow" class="external autonumber" href="https://www.gnupg.org/documentation/manuals/gnupg/GPG-Configuration-Options.html">[1]</a>.</li>
</ul>
<p>По умолчанию домашний каталог имеет <a href="../ru/File_permissions_and_attributes.html" title="File permissions and attributes (Русский)">права доступа</a> <code>700</code>, а содержащиеся в нём файлы — права доступа <code>600</code>. Только владелец каталога имеет доступ к файлам. Это сделано в целях безопасности и не должно изменяться. Если каталог или какой-либо файл в нём не соблюдает эту меру безопасности, вы получите предупреждение о небезопасных правах доступа файлов и домашнего каталога.
</p>
<h3>
<span id=".D0.A4.D0.B0.D0.B9.D0.BB.D1.8B_.D0.BA.D0.BE.D0.BD.D1.84.D0.B8.D0.B3.D1.83.D1.80.D0.B0.D1.86.D0.B8.D0.B8"></span><span class="mw-headline" id="Файлы_конфигурации">Файлы конфигурации</span>
</h3>
<p>Всё поведение GnuPG можно настроить через аргументы командной строки. Аргументы, которые вы хотите использовать по умолчанию, можно добавить в соответствующий конфигурационный файл:
</p>
<ul>
<li>
<i>gpg</i> проверяет файлы <code><i>gnupg_home</i>/gpg.conf</code> (пользовательский) и <code>/etc/gnupg/gpg.conf</code> (глобальный) <a rel="nofollow" class="external autonumber" href="https://dev.gnupg.org/T4788">[2]</a>. Поскольку команда <i>gpg</i> является основной точкой входа в GnuPG, большинство настроек будет находиться здесь. Доступные опции описаны в <a rel="nofollow" class="external text" href="https://www.gnupg.org/documentation/manuals/gnupg/GPG-Options.html">GPG Options</a>.</li>
<li>
<i>dirmngr</i> проверяет файлы <code><i>gnupg_home</i>/dirmngr.conf</code> и <code>/etc/gnupg/dirmngr.conf</code>. <i>dirmngr</i> — это внутренняя программа, которую <code>gpg</code> использует для доступа к серверам ключей PGP <a rel="nofollow" class="external autonumber" href="https://www.gnupg.org/documentation/manuals/gnupg/Invoking-DIRMNGR.html">[3]</a>. Доступные опции описаны в <a rel="nofollow" class="external text" href="https://www.gnupg.org/documentation/manuals/gnupg/Dirmngr-Options.html">Dirmngr Options</a>.</li>
</ul>
<p>Эти два файла охватывают самые частые сценарии использования, но в GnuPG есть и другие вспомогательные программы со своими собственными опциями. Полный их перечень есть в <a rel="nofollow" class="external text" href="https://www.gnupg.org/documentation/manuals/gnupg/index.html">GnuPG manual</a>.
</p>
<p>Создайте нужные файлы и задайте им права доступа <code>600</code>, как обсуждалось в разделе <a href="#%D0%94%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B8%D0%B9_%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3">#Домашний каталог</a>.
</p>
<p>Добавьте в эти файлы все необходимые длинные опции. Не пишите перед ними два дефиса, просто имя опции и требуемые аргументы. Например, чтобы GnuPG всегда использовал связку ключей по определённому пути, как если бы он был вызван с опцией <code>gpg --no-default-keyring --keyring <i>keyring-path</i> ...</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"><i>gnupg_home</i>/gpg.conf (или /etc/gnupg/gpg.conf)</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">no-default-keyring
keyring <i>keyring-path</i>
</pre>
<p>Другие примеры можно найти в разделе <a href="#%D0%A1%D0%BC%D0%BE%D1%82%D1%80%D0%B8%D1%82%D0%B5_%D1%82%D0%B0%D0%BA%D0%B6%D0%B5">#Смотрите также</a>.
</p>
<p>В дополнение, <a href="../ru/Pacman.html" title="Pacman (Русский)">pacman</a> использует отдельный набор конфигурационных файлов для проверки подписи пакетов. Подробнее в статье <a href="../ru/Pacman/Package_signing.html" class="mw-redirect" title="Pacman/Подпись пакета">pacman/Подпись пакета</a>.
</p>
<h3>
<span id=".D0.A1.D1.82.D0.B0.D0.BD.D0.B4.D0.B0.D1.80.D1.82.D0.BD.D1.8B.D0.B5_.D0.BD.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B8_.D0.B4.D0.BB.D1.8F_.D0.BD.D0.BE.D0.B2.D1.8B.D1.85_.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D0.B5.D0.B9"></span><span class="mw-headline" id="Стандартные_настройки_для_новых_пользователей">Стандартные настройки для новых пользователей</span>
</h3>
<p>Если вы хотите задать какие-нибудь опции по умолчанию для новых пользователей, поместите соответствующие файлы в <code>/etc/skel/.gnupg/</code>. Когда новый пользователь будет добавлен в систему, файлы отсюда будут скопированы в его домашний каталог GnuPG. Также имеется простой скрипт <i>addgnupghome</i>, с помощью которого вы можете создать новые домашние каталоги GnuPG для существующих пользователей:
</p>
<pre># addgnupghome user1 user2
</pre>
<p>Команда добавит <code>/home/user1/.gnupg/</code> и <code>/home/user2/.gnupg/</code> соответственно и скопирует туда файлы из каталога шаблонов (skeleton directory). Пользователи с существующими домашними каталогами GnuPG просто будут пропущены.
</p>
<h2>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Использование">Использование</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Всякий раз, когда команде требуется <i><code>user-id</code></i>, вы можете указать ваш key ID, отпечаток ключа (fingerprint), часть вашего имени, адреса электронной почты и т. д.  GnuPG гибок в этом плане.</li>
<li>Когда требуется <code><i>key-id</i></code>, его можно найти добавлением опции <code>--keyid-format=long</code> к команде. Например, для просмотра закрытого мастер-ключа выполните <code>gpg --list-secret-keys --keyid-format=long <i>user-id</i></code>, и <i>key-id</i> будет шестнадцатеричным значением, находящимся в строке <i>sec</i>.</li>
</ul>
</div>
<h3>
<span id=".D0.A1.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BF.D0.B0.D1.80.D1.8B_.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9"></span><span class="mw-headline" id="Создание_пары_ключей">Создание пары ключей</span>
</h3>
<p>Создайте пару ключей, введя в терминал:
</p>
<pre>$ gpg --full-gen-key
</pre>
<p>Используйте опцию <code>--expert</code>, чтобы выбрать другие шифры, в частности <a href="https://en.wikipedia.org/wiki/ru:%D0%AD%D0%BB%D0%BB%D0%B8%D0%BF%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F_%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%8F" class="extiw" title="wikipedia:ru:Эллиптическая криптография">эллиптическую криптографию</a> (ECC).
</p>
<p>Команда задаст несколько вопросов. Для общего использования большинству людей подойдут такие параметры:
</p>
<ul>
<li>RSA (только для подписи) и RSA (только для шифрования) ключ.</li>
<li>размер ключа по умолчанию (3072). Размер ключа 4096 «дорого обходится, но почти ничего не даёт» (смотрите <a rel="nofollow" class="external text" href="https://www.gnupg.org/faq/gnupg-faq.html#no_default_of_rsa4096">why doesn’t GnuPG default to using RSA-4096</a>).</li>
<li>срок действия. Период в один год обычно достаточно хорош. В этом случае, даже если доступ к ключу будет потерян, он позволит другим узнать, что больше недействителен. Позже, при необходимости, срок действия может быть расширен без повторного выпуска нового ключа.</li>
<li>ваше имя и адрес электронной почты. Вы можете добавить несколько идентификаторов к одному и тому же ключу позже (<i>например</i>, если у вас есть несколько адресов электронной почты, которые вы хотите связать с этим ключом).</li>
<li>пустой необязательный комментарий. Поскольку семантика поля комментария <a rel="nofollow" class="external text" href="https://lists.gnupg.org/pipermail/gnupg-devel/2015-July/030150.html">не определена</a>, она имеет ограниченное значение для идентификации.</li>
<li>
<a href="../ru/Security.html#%D0%9D%D0%B0%D0%B4%D1%91%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D1%8C_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D1%8F" title="Security (Русский)">безопасная парольная фраза</a>.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Имя и адрес электронной почты, которые вы вводите здесь, будут видеть все, кто импортирует ваш ключ.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Более простая опция <code>--gen-key</code> использует параметры по умолчанию для шифра, размера и срока действия ключа и запрашивает только имя и адрес электронной почты.</div>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D1.81.D0.BC.D0.BE.D1.82.D1.80_.D1.81.D0.BF.D0.B8.D1.81.D0.BA.D0.B0_.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9"></span><span class="mw-headline" id="Просмотр_списка_ключей">Просмотр списка ключей</span>
</h3>
<p>Вывести список открытых ключей:
</p>
<pre>$ gpg --list-keys
</pre>
<p>Вывести список закрытых ключей:
</p>
<pre>$ gpg --list-secret-keys
</pre>
<h3>
<span id=".D0.AD.D0.BA.D1.81.D0.BF.D0.BE.D1.80.D1.82_.D0.BE.D1.82.D0.BA.D1.80.D1.8B.D1.82.D0.BE.D0.B3.D0.BE_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0"></span><span class="mw-headline" id="Экспорт_открытого_ключа">Экспорт открытого ключа</span>
</h3>
<p>Основное назначение GnuPG — обеспечение конфиденциальности обмена сообщениями с помощью криптографии с открытым ключом. С его помощью каждый пользователь распространяет открытый ключ своей связки ключей, который может быть использован другими пользователями для шифрования сообщений пользователю. Закрытый ключ <i>всегда</i> должен оставаться в тайне, иначе конфиденциальность будет нарушена. Подробнее о том, как это всё работает, можно почитать в <a href="https://en.wikipedia.org/wiki/ru:%D0%9A%D1%80%D0%B8%D0%BF%D1%82%D0%BE%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0_%D1%81_%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D1%8B%D0%BC_%D0%BA%D0%BB%D1%8E%D1%87%D0%BE%D0%BC" class="extiw" title="wikipedia:ru:Криптосистема с открытым ключом">статье на Википедии</a>.
</p>
<p>Таким образом, чтобы другие могли отправлять вам зашифрованные сообщения, им нужен ваш открытый ключ.
</p>
<p>Чтобы сгенерировать ASCII-версию открытого ключа пользователя в файл <code><i>public-key</i>.asc</code> (например, для отправки по электронной почте):
</p>
<pre>$ gpg --export --armor --output <i>public-key</i>.asc <i>user-id</i>
</pre>
<p>Ещё один вариант распространения открытого ключа — <a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9">#Использование сервера ключей</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> 
<ul>
<li>Добавьте <code>--no-emit-version</code>, чтобы не выводить номер версии, или добавьте соответствующий параметр в ваш файл настроек.</li>
<li>Вы можете опустить <code>user-id</code>, чтобы экспортировать все открытые ключи в вашей связке ключей. Это полезно, если вы хотите поделиться несколькими идентификаторами одновременно или для импорта в другое приложение, например, <a href="../ru/Thunderbird.html#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_OpenPGP_%D1%81_%D0%B2%D0%BD%D0%B5%D1%88%D0%BD%D0%B8%D0%BC_GnuPG" title="Thunderbird (Русский)">Thunderbird</a>.</li>
</ul>
</div>
<h3>
<span id=".D0.98.D0.BC.D0.BF.D0.BE.D1.80.D1.82_.D0.BE.D1.82.D0.BA.D1.80.D1.8B.D1.82.D0.BE.D0.B3.D0.BE_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0"></span><span class="mw-headline" id="Импорт_открытого_ключа">Импорт открытого ключа</span>
</h3>
<p>Чтобы зашифровать сообщения другим людям, а также проверить их подписи, вам нужен их открытый ключ. Чтобы импортировать открытый ключ из файла <code><i>public-key</i>.asc</code> в свой список открытых ключей, выполните команду:
</p>
<pre>$ gpg --import <i>public-key</i>.asc
</pre>
<p>Другой вариант для поиска открытого ключа — <a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9">#Использование сервера ключей</a>.
</p>
<p>Если вы хотите импортировать ключ для установки определённого пакета Arch Linux, смотрите <a href="../ru/Pacman/Package_signing.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%BE%D0%B9_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9" class="mw-redirect" title="Pacman/Подпись пакета">pacman/Подпись пакета#Управление связкой ключей</a> и <a href="../ru/Makepkg.html#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D1%86%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D1%8B%D1%85_%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D0%B5%D0%B9" title="Makepkg (Русский)">makepkg (Русский)#Проверка цифровых подписей</a>.
</p>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D1.81.D0.B5.D1.80.D0.B2.D0.B5.D1.80.D0.B0_.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9"></span><span class="mw-headline" id="Использование_сервера_ключей">Использование сервера ключей</span>
</h3>
<h4>
<span id=".D0.9E.D1.82.D0.BF.D1.80.D0.B0.D0.B2.D0.BA.D0.B0_.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9"></span><span class="mw-headline" id="Отправка_ключей">Отправка ключей</span>
</h4>
<p>Вы можете зарегистрировать свой ключ на публичном сервере ключей PGP, чтобы другие могли получить его без необходимости обращаться к вам напрямую:
</p>
<pre>$ gpg --send-keys <i>key-id</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> После отправки ключ будет невозможно удалить с сервера. Причина этого описана в <a rel="nofollow" class="external text" href="https://pgp.mit.edu/faq.html">MIT PGP Public Key Server FAQ</a>.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Связанный адрес электронной почты, будучи опубликованным публично, может стать целью спамеров, и в этом случае может потребоваться антиспам-фильтр.</div>
<h4>
<span id=".D0.9F.D0.BE.D0.B8.D1.81.D0.BA_.D0.B8_.D0.BF.D0.BE.D0.BB.D1.83.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9"></span><span class="mw-headline" id="Поиск_и_получение_ключей">Поиск и получение ключей</span>
</h4>
<p>Чтобы посмотреть информацию о ключе на сервере ключей, не импортируя его, выполните:
</p>
<pre>$ gpg --search-keys <i>user-id</i>
</pre>
<p>Импортирование ключа с сервера ключей:
</p>
<pre>$ gpg --receive-keys <i>key-id</i>
</pre>
<p>Чтобы обновить связку ключей последней версией с сервера ключей:
</p>
<pre>$ gpg --refresh-keys
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> 
<ul>
<li>Обязательно проверьте подлинность полученного открытого ключа, сравнив его отпечаток с тем, который владелец опубликовал в независимом источнике (например, связавшись с ним напрямую). Смотрите также <a href="https://en.wikipedia.org/wiki/ru:%D0%9E%D1%82%D0%BF%D0%B5%D1%87%D0%B0%D1%82%D0%BE%D0%BA_%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D0%BE%D0%B3%D0%BE_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0" class="extiw" title="wikipedia:ru:Отпечаток открытого ключа">статью на Википедии</a>.</li>
<li>Для получения ключа рекомендуется использовать длинный ID ключа или полный отпечаток. С короткими ID могут случаться коллизии. Если несколько разных ключей имеют один и тот же короткий ID — будут импортированы все. <a rel="nofollow" class="external text" href="https://lore.kernel.org/lkml/20160815153401.9EC2BADC2C@smtp.postman.i2p/">Уже встречались поддельные ключи</a>, у которых короткие ID совпадали с короткими ID ключей Линуса Торвальдса и Грега Кроа-Хартмана.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Добавление <code>auto-key-retrieve</code> в <a href="#%D0%A4%D0%B0%D0%B9%D0%BB%D1%8B_%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D0%B8">конфигурационный файл GnuPG</a> включит автоматические получение ключей с сервера ключей по мере необходимости. Это не является компромиссом с точки зрения безопасности, но может рассматриваться как <b>нарушение конфиденциальности</b>; смотрите «web bug» в <span class="plainlinks archwiki-template-man" title="$ man 1 gpg"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/gpg.1">gpg(1)</a></span>.</div>
<h4>
<span id=".D0.A1.D0.B5.D1.80.D0.B2.D0.B5.D1.80.D1.8B_.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9"></span><span class="mw-headline" id="Серверы_ключей">Серверы ключей</span>
</h4>
<p>Самые популярные серверы ключей:
</p>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://keyserver.ubuntu.com">Ubuntu Keyserver</a>: федеративный, без проверки, ключи не могут быть удалены.</li>
<li>
<a rel="nofollow" class="external text" href="https://keys.mailvelope.com">Mailvelope Keyserver</a>: централизованный, проверка идентификаторов электронной почты, ключи могут быть удалены.</li>
<li>
<a rel="nofollow" class="external text" href="https://keys.openpgp.org">keys.openpgp.org</a>: централизованный, проверка идентификаторов электронной почты, ключи могут быть удалены, нет подписей третьих лиц (т.е. нет поддержки Web of Trust).</li>
</ul>
<p>Также можно посмотреть <a href="https://en.wikipedia.org/wiki/ru:%D0%A1%D0%B5%D1%80%D0%B2%D0%B5%D1%80_%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D1%85_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9#.D0.9F.D1.80.D0.B8.D0.BC.D0.B5.D1.80.D1.8B_.D1.81.D0.B5.D1.80.D0.B2.D0.B5.D1.80.D0.BE.D0.B2_.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9" class="extiw" title="wikipedia:ru:Сервер криптографических ключей">список серверов в Википедии</a>.
</p>
<p>Можно указать произвольный <code>keyserver</code> в настройках, например:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/dirmngr.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">keyserver hkp://keyserver.ubuntu.com
</pre>
<p>Временное использование другого сервера удобно, когда обычный сервер работает не так, как нужно. Например:
</p>
<pre>$ gpg --keyserver <i>hkps://keys.openpgp.org/</i> --search-keys <i>user-id</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> 
<ul>
<li>Если при получении ключа появляется ошибка <code>gpg: keyserver receive failed: General error</code> и вы используете пул серверов hkps по умолчанию, убедитесь, что установлен сертификат проверки пула HKPS с помощью <code>hkp-cacert /usr/share/gnupg/sks-keyservers.netCA.pem</code> в вашем <code>dirmngr.conf</code>, и завершите старый процесс dirmngr.</li>
<li>Если при получении ключа появляется ошибка <code>gpg: keyserver receive failed: Connection refused</code>, попробуйте использовать другой DNS-сервер.</li>
<li>Можно подключиться к серверу ключей через <a href="../ru/Tor.html" title="Tor (Русский)">Tor</a> с помощью <a href="../ru/Tor.html#Torsocks" title="Tor (Русский)">torsocks</a>. Или можно использовать опцию <code>--use-tor</code>. Смотрите <a rel="nofollow" class="external autonumber" href="https://gnupg.org/blog/20151224-gnupg-in-november-and-december.html">[4]</a> для более подробной информации.</li>
<li>Можно подключиться к серверу ключей через прокси, указав <a href="../ru/Environment_variables.html" title="Environment variables (Русский)">переменную окружения</a> <code>http_proxy</code> и прописав <code>honor-http-proxy</code> в <code>dirmngr.conf</code>. Также можно задать <code>http-proxy <i>хост[:порт]</i></code> в файле настроек, чтобы переопределить параметры из переменной окружения. Перезапустите <a href="../ru/Systemd/User.html" title="Systemd (Русский)/User (Русский)">пользовательскую службу</a> <code>dirmngr.service</code> для применения изменений.</li>
<li>Если при подключении к серверу ключей возникает ошибка <code>gpg: keyserver receive failed: Server indicated a failure</code>, возможно, необходимо настроить gpg на использование альтернативного порта. Например, чтобы использовать порт 80 для Ubuntu Keyserver, используйте <code>keyserver hkp://keyserver.ubuntu.com:80</code>.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Web_Key_Directory">Web Key Directory</span></h3>
<p>Протокол Web Key Service (WKS) — это новый <a rel="nofollow" class="external text" href="https://datatracker.ietf.org/doc/draft-koch-openpgp-webkey-service/">стандарт</a> доставки ключей, в котором домен электронной почты предоставляет свой собственный сервер ключей, называемый <a rel="nofollow" class="external text" href="https://wiki.gnupg.org/WKD">Web Key Directory (WKD)</a>. При шифровании для адреса электронной почты (например, <code>user@example.com</code>) GnuPG (&gt;=2.1.16) обратится к домену (<code>example.com</code>) через HTTPS для получения открытого ключа OpenPGP, если его ещё нет в локальном списке ключей. Опция <code>auto-key-locate</code> найдёт ключ по протоколу WKD, если в локальном списке ключей нет ключа для данного адреса электронной почты.
</p>
<pre># gpg --recipient <i>user@example.org</i> --auto-key-locate --encrypt <i>doc</i>
</pre>
<p>В <a rel="nofollow" class="external text" href="https://wiki.gnupg.org/WKD#Implementations">GnuPG Wiki</a> есть список email-провайдеров, поддерживающих WKD. Если у вас есть контроль над доменом, вы можете включить для него WKD, как описано в <a rel="nofollow" class="external text" href="https://wiki.gnupg.org/WKDHosting">этом руководстве</a>. Для проверки, что ваш ключ доступен через WKD, можно использовать <a rel="nofollow" class="external text" href="https://metacode.biz/openpgp/web-key-directory">этот веб-интерфейс</a>.
</p>
<h3>
<span id=".D0.A8.D0.B8.D1.84.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.B8_.D0.B4.D0.B5.D1.88.D0.B8.D1.84.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5"></span><span class="mw-headline" id="Шифрование_и_дешифрование">Шифрование и дешифрование</span>
</h3>
<h4>
<span id=".D0.90.D1.81.D0.B8.D0.BC.D0.BC.D0.B5.D1.82.D1.80.D0.B8.D1.87.D0.BD.D0.BE.D0.B5"></span><span class="mw-headline" id="Асимметричное">Асимметричное</span>
</h4>
<p>Перед шифрованием (опция <code>-e</code>/<code>--encrypt</code>) файла для указанного получателя (опция <code>-r</code>/<code>--recipient</code>) выполните <a href="#%D0%98%D0%BC%D0%BF%D0%BE%D1%80%D1%82_%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D0%BE%D0%B3%D0%BE_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0">#Импорт открытого ключа</a>. Также выполните <a href="#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%B0%D1%80%D1%8B_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9">#Создание пары ключей</a>, если её у вас ещё нет.
</p>
<p>Шифрование файла с именем <i>doc</i>:
</p>
<pre>$ gpg --recipient <i>user-id</i> --encrypt <i>doc</i>
</pre>
<p>Чтобы расшифровать (опция <code>-d</code>/<code>--decrypt</code>) файл с именем <i>doc</i>.gpg, зашифрованный вашим открытым ключом:
</p>
<pre>$ gpg --output <i>doc</i> --decrypt <i>doc</i>.gpg
</pre>
<p><i>gpg</i> спросит ваш пароль и затем расшифрует данные из файла <i>doc</i>.gpg в файл <i>doc</i>. Если опцию <code>-o</code>/<code>--output</code> не указывать, данные будут записаны в стандартный вывод (stdout).
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> 
<ul>
<li>Опция <code>--armor</code> запишет вывод в ASCII-совместимом формате, пригодном для передачи в текстовых сообщениях.</li>
<li>Используйте <code>-R <i>user-id</i></code> или <code>--hidden-recipient <i>user-id</i></code> вместо <code>-r</code>, чтобы не помещать ID ключей получателей в зашифрованное сообщение. Это помогает скрыть получателей сообщения и является ограниченной контрмерой против анализа трафика.</li>
<li>Добавьте <code>--no-emit-version</code>, чтобы не выводить номер версии, или добавьте соответствующий параметр в ваш файл настроек.</li>
<li>Можно использовать GnuPG для шифрования конфиденциальных документов, используя свой собственный user-id в качестве получателя или используя флаг <code>--default-recipient-self</code>, однако вы можете делать это только с одним файлом за раз. Впрочем, можно собрать несколько файлов в один tar-архив и зашифровать уже его. Смотрите также <a href="../ru/Data-at-rest_encryption.html#%D0%94%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BD%D1%8B%D0%B5_%D0%BC%D0%B5%D1%82%D0%BE%D0%B4%D1%8B" title="Data-at-rest encryption (Русский)">Data-at-rest encryption (Русский)#Доступные методы</a>, если вы хотите зашифровать каталоги или целую файловую систему.</li>
</ul>
</div>
<h4>
<span id=".D0.A1.D0.B8.D0.BC.D0.BC.D0.B5.D1.82.D1.80.D0.B8.D1.87.D0.BD.D0.BE.D0.B5"></span><span class="mw-headline" id="Симметричное">Симметричное</span>
</h4>
<p>Симметричное шифрование не требует генерации пары ключей и может использоваться для простого шифрования данных с помощью пароля. Просто используйте <code>-c</code>/<code>--symmetric</code> для выполнения симметричного шифрования:
</p>
<pre>$ gpg -c <i>doc</i>
</pre>
<p>Следующий пример:
</p>
<ul>
<li>Шифрует файл <code><i>doc</i></code> симметричным шифрованием с использованием пароля</li>
<li>Использует алгоритм шифрования AES-256 для шифрования данных</li>
<li>Использует алгоритм хэширования SHA-512 для генерации ключа шифрования из пароля</li>
<li>Выполняет 65536 итераций в процессе генерации ключа из пароля</li>
</ul>
<pre>$ gpg -c --s2k-cipher-algo AES256 --s2k-digest-algo SHA512 --s2k-count 65536 <i>doc</i>
</pre>
<p>Расшифровка симметрично зашифрованного <code><i>doc</i>.gpg</code> с помощью пароля и вывод расшифрованного содержимого в тот же каталог, что и <code><i>doc</i></code>:
</p>
<pre>$ gpg --output <i>doc</i> --decrypt <i>doc</i>.gpg
</pre>
<h4>
<span id=".D0.9A.D0.B0.D1.82.D0.B0.D0.BB.D0.BE.D0.B3"></span><span class="mw-headline" id="Каталог">Каталог</span>
</h4>
<p>Можно зашифровать/расшифровать целый каталог с помощью <span class="plainlinks archwiki-template-man" title="$ man 1 gpgtar"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/gpgtar.1">gpgtar(1)</a></span>.
</p>
<p>Шифрование:
</p>
<pre>$ gpgtar -c -o <i>dir</i>.gpg <i>dir</i>
</pre>
<p>Дешифрование:
</p>
<pre>$ gpgtar -d <i>dir</i>.gpg
</pre>
<h2>
<span id=".D0.A3.D0.BF.D1.80.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0.D0.BC.D0.B8"></span><span class="mw-headline" id="Управление_ключами">Управление ключами</span>
</h2>
<h3>
<span id=".D0.A0.D0.B5.D0.B7.D0.B5.D1.80.D0.B2.D0.BD.D0.BE.D0.B5_.D0.BA.D0.BE.D0.BF.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.B7.D0.B0.D0.BA.D1.80.D1.8B.D1.82.D0.BE.D0.B3.D0.BE_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0"></span><span class="mw-headline" id="Резервное_копирование_закрытого_ключа">Резервное копирование закрытого ключа</span>
</h3>
<p>Чтобы создать резервную копию вашего закрытого ключа, выполните:
</p>
<pre>$ gpg --export-secret-keys --armor --output <i>private-key</i>.asc <i>user-id</i>
</pre>
<p>Обратите внимание, что вышеуказанная команда требует ввода пароля от ключа. В противном случае любой, кто получит доступ к экспортированному файлу, сможет шифровать и подписывать документы, как если бы он был вами, <i>без</i> необходимости знать пароль.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> 
<ul>
<li>Пароль — обычно самое слабое звено в защите закрытого ключа. Поместите закрытый ключ в безопасное место на другой системе или на другом устройстве, например, в заблокированный контейнер или на зашифрованный диск. Это единственное средство защиты, которое поможет вам восстановить контроль над списком ваших ключей в случае, например, поломки диска, кражи или ещё чего-нибудь похуже.</li>
<li>Этот способ резервного копирования ключей имеет некоторые ограничения по безопасности. Более безопасный способ резервного копирования и импорта ключей с помощью <i>gpg</i> описан <a rel="nofollow" class="external text" href="https://web.archive.org/web/20210803213236/https://habd.as/post/moving-gpg-keys-privately/">здесь</a>.</li>
</ul>
</div>
<p>Импорт закрытого ключа из резервной копии:
</p>
<pre>$ gpg --import <i>private-key</i>.asc
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> <a href="../en/Paperkey.html" title="Paperkey">Paperkey</a> позволяет экспортировать ключ в виде простого текста или машиночитаемого штрих-кода, которые можно отпечатать на бумаге.</div>
<h3>
<span id=".D0.A0.D0.B5.D0.B7.D0.B5.D1.80.D0.B2.D0.BD.D0.BE.D0.B5_.D0.BA.D0.BE.D0.BF.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D1.81.D0.B5.D1.80.D1.82.D0.B8.D1.84.D0.B8.D0.BA.D0.B0.D1.82.D0.B0_.D0.BE.D1.82.D0.B7.D1.8B.D0.B2.D0.B0"></span><span class="mw-headline" id="Резервное_копирование_сертификата_отзыва">Резервное копирование сертификата отзыва</span>
</h3>
<p>Сертификаты отзыва автоматически генерируются для вновь создаваемых ключей. По умолчанию они находятся в <code>~/.gnupg/openpgp-revocs.d/</code>. Имя файла сертификата — это отпечаток ключа, который он отзывает. Сертификаты отзыва также можно сгенерированы вручную с помощью следующей команды:
</p>
<pre>$ gpg --gen-revoke --armor --output <i>revcert</i>.asc <i>user-id</i>
</pre>
<p>Этот сертификат используется, чтобы выполнить <a href="#%D0%9E%D1%82%D0%B7%D1%8B%D0%B2_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0">#Отзыв ключа</a> в случае, если он оказался потерян или скомпрометирован. Резервная копия будет полезна, если у вас больше нет доступа к закрытому ключу, из-за чего вы не можете сгенерировать новый сертификат отзыва с помощью приведённой выше команды. Он достаточно короткий, чтобы его можно было распечатать и набрать от руки при необходимости.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Любой человек, имеющий доступ к сертификату отзыва, может публично отозвать ключ, и это действие нельзя отменить. Защищайте свой сертификат отзыва так же, как вы защищаете свой закрытый ключ.</div>
<h3>
<span id=".D0.A0.D0.B5.D0.B4.D0.B0.D0.BA.D1.82.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0"></span><span class="mw-headline" id="Редактирование_ключа">Редактирование ключа</span>
</h3>
<p>Команда <code>gpg --edit-key <i>user-id</i></code> откроет меню, которое позволит вам выполнить большинство задач, связанных с управлением ключами.
</p>
<p>Введите <code>help</code> в подменю редактирования ключа, чтобы увидеть полный список команд. Некоторые полезные команды:
</p>
<pre>&gt; passwd      сменить фразу-пароль
&gt; clean       сжать непригодные идентификаторы пользователей и удалить непригодные подписи из ключа
&gt; revkey      отозвать ключ или выбранные подключи
&gt; addkey      добавить подключ
&gt; expire      сменить срок действия ключа или выбранных подключей
&gt; adduid      добавить идентификатор пользователя
&gt; addphoto    добавить фотоидентификатор
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Если у вас есть несколько адресов электронной почты, вы можете добавить каждый из них в качестве идентификатора с помощью команды <code>adduid</code>. После этого можно установить нужный адрес в качестве основного (<code>primary</code>).</div>
<h3>
<span id=".D0.AD.D0.BA.D1.81.D0.BF.D0.BE.D1.80.D1.82_.D0.BF.D0.BE.D0.B4.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9"></span><span class="mw-headline" id="Экспорт_подключей">Экспорт подключей</span>
</h3>
<p>Если вы планируете использовать один и тот же ключ на разных устройствах, вы можете убрать мастер-ключ и оставить только минимально необходимый подключ для использования на менее защищённых системах.
</p>
<p>Прежде всего, определите, какой подключ вы хотите экспортировать.
</p>
<pre>$ gpg --list-secret-keys --with-subkey-fingerprint
</pre>
<p>Укажите, что экспортировать нужно только конкретный подключ.
</p>
<pre>$ gpg -a --export-secret-subkeys [subkey id]! &gt; /tmp/subkey.gpg
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> Если вы забудете добавить !, будут экспортированы все ваши подключи.</div>
<p>На этом этапе вы можете закончить, но хорошей идеей будет изменить пароль. Импортируйте ключ во временный каталог.
</p>
<pre>$ gpg --homedir /tmp/gpg --import /tmp/subkey.gpg
$ gpg --homedir /tmp/gpg --edit-key <i>user-id</i>
&gt; passwd
&gt; save
$ gpg --homedir /tmp/gpg -a --export-secret-subkeys <i>[subkey id]</i>! &gt; /tmp/subkey.altpass.gpg
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Вы получите предупреждение о недоступности мастер-ключа и о том, что пароль не был изменён, но вы спокойно можете игнорировать это предупреждение, поскольку пароль для подключа был изменён.</div>
<p>Теперь вы уже можете использовать <code>/tmp/subkey.altpass.gpg</code> на других ваших устройствах.
</p>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B4.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D1.81.D1.80.D0.BE.D0.BA.D0.B0_.D0.B4.D0.B5.D0.B9.D1.81.D1.82.D0.B2.D0.B8.D1.8F"></span><span class="mw-headline" id="Продление_срока_действия">Продление срока действия</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> <b>Никогда</b> не удаляйте просроченные или отозванные подключи без особой на то причины, иначе вы полностью потеряете возможность расшифровать файлы, зашифрованные старым подключом. Удаляйте <b>только</b> чужие просроченные или отозванные подключи, если хотите очистить свой список открытых ключей.</div>
<p>Хорошей практикой является установка срока действия подключей, чтобы в случае потери доступа к ключу (например, если вы забудете пароль) он не мог использоваться другими пользователями неограниченное время. Когда срок действия ключа истекает, продлить дату истечения срока действия относительно просто:
</p>
<pre>$ gpg --edit-key <i>user-id</i>
&gt; expire
</pre>
<p>Вам будет предложено ввести новую дату истечения срока действия, а также пароль для закрытого ключа, который используется для подписания новой даты истечения срока действия.
</p>
<p>Повторите это для всех остальных подключей, срок действия которых истекает:
</p>
<pre>&gt; key 1
&gt; expire
</pre>
<p>Наконец, сохраните изменения и выйдите из программы:
</p>
<pre>&gt; save
</pre>
<p>Загрузите изменения на сервер ключей.
</p>
<pre>$ gpg --keyserver keyserver.ubuntu.com --send-keys <i>key-id</i>
</pre>
<p>Если вы используете этот ключ на нескольких компьютерах, можно экспортировать открытый ключ (с новыми подписанными датами истечения срока действия) и импортировать его на других компьютерах:
</p>
<pre>$ gpg --export --output pubkey.gpg <i>user-id</i>
$ gpg --import pubkey.gpg
</pre>
<p>Нет необходимости повторно экспортировать закрытый ключ или обновлять резервные копии: сам главный закрытый ключ никогда не истекает, а подпись даты истечения срока действия, оставленная на открытом ключе и подключах, — это всё что нужно.
</p>
<h3>
<span id=".D0.A0.D0.BE.D1.82.D0.B0.D1.86.D0.B8.D1.8F_.D0.BF.D0.BE.D0.B4.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9"></span><span class="mw-headline" id="Ротация_подключей">Ротация подключей</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно:</strong> <b>Никогда</b> не удаляйте просроченные или отозванные подключи без особой на то причины, иначе вы полностью потеряете возможность расшифровать файлы, зашифрованные старым подключом. Удаляйте <b>только</b> чужие просроченные или отозванные подключи, если хотите очистить свой список открытых ключей.</div>
<p>Если вы предпочитаете полностью прекратить использование подключей по истечении срока их действия, вы можете создать новые. Сделайте это за несколько недель до истечения срока действия, чтобы у других пользователей была возможность вовремя обновить свой список ключей.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Вам не обязательно создавать новый ключ только потому, что предыдущий просрочен. Вы всегда можете продлить срок ключа; смотрите раздел <a href="#%D0%9F%D1%80%D0%BE%D0%B4%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%81%D1%80%D0%BE%D0%BA%D0%B0_%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D1%8F">#Продление срока действия</a>.</div>
<p>Создайте новый подключ (запустите дважды для создания отдельных ключей для подписывания и шифрования)
</p>
<pre>$ gpg --edit-key <i>user-id</i>
&gt; addkey
</pre>
<p>При этом вам будет задано несколько вопросов (рекомендуемые настройки смотрите в разделе <a href="#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%B0%D1%80%D1%8B_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9">#Создание пары ключей</a>).
</p>
<p>Сохраните изменения
</p>
<pre>&gt; save
</pre>
<p>Загрузите изменения на сервер ключей.
</p>
<pre>$ gpg --keyserver <i>pgp.mit.edu</i> --send-keys <i>user-id</i>
</pre>
<p>Также нужно сделать новую резервную копию; смотрите раздел <a href="#%D0%A0%D0%B5%D0%B7%D0%B5%D1%80%D0%B2%D0%BD%D0%BE%D0%B5_%D0%BA%D0%BE%D0%BF%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B7%D0%B0%D0%BA%D1%80%D1%8B%D1%82%D0%BE%D0%B3%D0%BE_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0">#Резервное копирование закрытого ключа</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Отзывать просроченные подключи абсолютно бесполезно и является плохой практикой. Если вы постоянно отзываете ключи, уверенность других пользователей в вас может быть подорвана.</div>
<h3>
<span id=".D0.9E.D1.82.D0.B7.D1.8B.D0.B2_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0"></span><span class="mw-headline" id="Отзыв_ключа">Отзыв ключа</span>
</h3>
<p>Если ключ скомпрометирован, заменён, больше не используется или вы забыли пароль, необходимо отозвать ключ. Это делается путём слияния ключа с сертификатом отзыва ключа.
</p>
<p>Если у вас больше нет доступа к вашей паре ключей, сначала выполните импорт собственного ключа (смотрите раздел <a href="#%D0%98%D0%BC%D0%BF%D0%BE%D1%80%D1%82_%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D0%BE%D0%B3%D0%BE_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0">#Импорт открытого ключа</a>). Затем, чтобы отозвать ключ, импортируйте сертификат отзыва (нужно заранее создать его, как описано в разделе <a href="#%D0%A0%D0%B5%D0%B7%D0%B5%D1%80%D0%B2%D0%BD%D0%BE%D0%B5_%D0%BA%D0%BE%D0%BF%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D0%B5%D1%80%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%B0_%D0%BE%D1%82%D0%B7%D1%8B%D0%B2%D0%B0">#Резервное копирование сертификата отзыва</a>):
</p>
<pre> $ gpg --import <i>revcert</i>.asc
</pre>
<p>Теперь нужно опубликовать информацию об отзыве ключа. Если вы ранее использовали публичный сервер PGP, отправьте на него отозванный ключ, как описано в разделе <a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0_%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B9">#Использование сервера ключей</a>. В противном случае экспортируйте отозванный ключ в файл и распространите его среди ваших собеседников.
</p>
<h2>
<span id=".D0.9F.D0.BE.D0.B4.D0.BF.D0.B8.D1.81.D1.8C"></span><span class="mw-headline" id="Подпись">Подпись</span>
</h2>
<p>Подписи позволяют проверить подлинность документов и ставят временные метки. Если документ будет изменён, проверка подписи будет неудачной. В отличие от шифрования, которое использует открытые ключи, подписи создаются с помощью закрытого ключа. Получатель подписанного документа затем проверяет подпись с помощью открытого ключа отправителя.
</p>
<h3>
<span id=".D0.A1.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BF.D0.BE.D0.B4.D0.BF.D0.B8.D1.81.D0.B8"></span><span class="mw-headline" id="Создание_подписи">Создание подписи</span>
</h3>
<h4>
<span id=".D0.9F.D0.BE.D0.B4.D0.BF.D0.B8.D1.81.D1.8C_.D1.84.D0.B0.D0.B9.D0.BB.D0.B0"></span><span class="mw-headline" id="Подпись_файла">Подпись файла</span>
</h4>
<p>Для подписи файла используйте флаг <code>-s</code>/<code>--sign</code>:
</p>
<pre>$ gpg --output <i>doc</i>.sig --sign <i>doc</i>
</pre>
<p>Файл <code><i>doc</i>.sig</code> будет содержать сжатое содержимое оригинального файла <code><i>doc</i></code> и подпись в бинарном формате. По умолчанию файл не будет зашифрован, но можно совместить подпись с <a href="#%D0%A8%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B8_%D0%B4%D0%B5%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">шифрованием</a>.
</p>
<h4>
<span id=".D0.9F.D0.BE.D0.B4.D0.BF.D0.B8.D1.81.D1.8C_.D1.84.D0.B0.D0.B9.D0.BB.D0.B0_.D0.B2_.D1.82.D0.B5.D0.BA.D1.81.D1.82.D0.BE.D0.B2.D0.BE.D0.BC_.D1.84.D0.BE.D1.80.D0.BC.D0.B0.D1.82.D0.B5"></span><span class="mw-headline" id="Подпись_файла_в_текстовом_формате">Подпись файла в текстовом формате</span>
</h4>
<p>Для создания подписи в текстовом, а не в бинарном формате используйте флаг <code>--clearsign</code>:
</p>
<pre>$ gpg --output <i>doc</i>.sig --clearsign <i>doc</i>
</pre>
<p>Файл <code><i>doc</i>.sig</code> будет содержать данные оригинального файла <code><i>doc</i></code> как есть и подпись в человекочитаемом формате.
</p>
<h4>
<span id=".D0.A1.D0.BE.D0.B7.D0.B4.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BE.D1.82.D0.B4.D0.B5.D0.BB.D1.91.D0.BD.D0.BD.D0.BE.D0.B9_.D0.BF.D0.BE.D0.B4.D0.BF.D0.B8.D1.81.D0.B8"></span><span class="mw-headline" id="Создание_отделённой_подписи">Создание отделённой подписи</span>
</h4>
<p>С помощью флага <code>--detach-sig</code> можно создать отдельный файл с подписью, который не будет содержать в себе данные оригинального файла:
</p>
<pre>$ gpg --output <i>doc</i>.sig --detach-sig <i>doc</i>
</pre>
<p>В файл <code><i>doc</i>.sig</code> будет записана только подпись без содержимого файла <code><i>doc</i></code>. Этот метод часто используется при распространении программ, чтобы пользователи могли убедиться, что программа не была изменена третьей стороной.
</p>
<h3>
<span id=".D0.9F.D1.80.D0.BE.D0.B2.D0.B5.D1.80.D0.BA.D0.B0_.D0.BF.D0.BE.D0.B4.D0.BF.D0.B8.D1.81.D0.B8"></span><span class="mw-headline" id="Проверка_подписи">Проверка подписи</span>
</h3>
<p>Для проверки подписи используйте флаг <code>--verify</code>:
</p>
<pre>$ gpg --verify <i>doc</i>.sig
</pre>
<p>где <code><i>doc</i>.sig</code> — это файл, содержащий подпись, которую вы хотите проверить.
</p>
<p>Если это отделённая подпись, то для проверки должен присутствовать оригинальный файл. Например, для проверки iso-образа Arch Linux используйте:
</p>
<pre>$ gpg --verify archlinux-<i>версия</i>.iso.sig
</pre>
<p>где <code>archlinux-<i>версия</i>.iso</code> — проверяемый файл, который должен находиться в том же каталоге.
</p>
<p>Также можно явно указать путь к проверяемому файлу:
</p>
<pre>$ gpg --verify archlinux-<i>версия</i>.iso.sig <i>/путь/к/</i>archlinux-<i>версия</i>.iso
</pre>
<p>Если файл был не только подписан, но ещё и зашифрован, просто <a href="#%D0%A8%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B8_%D0%B4%D0%B5%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">расшифруйте</a> файл, и его подпись будет автоматически проверена в процессе дешифрования.
</p>
<h2><span class="mw-headline" id="gpg-agent">gpg-agent</span></h2>
<p><i>gpg-agent</i> чаще всего используется как посредник для временного хранения пароля (пароль не будет запрашиваться каждый раз, когда нужен). Он полезен, если GnuPG используется внешней программой — например, почтовым клиентом.
Пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnupg">gnupg</a></span> предоставляет <a href="../ru/Systemd/User.html" title="Systemd (Русский)/User (Русский)">пользовательские сокеты systemd</a>, которые включены по умолчанию: <code>gpg-agent.socket</code>, <code>gpg-agent-extra.socket</code>, <code>gpg-agent-browser.socket</code>, <code>gpg-agent-ssh.socket</code> и <code>dirmngr.socket</code>.
</p>
<ul>
<li>Основной сокет <code>gpg-agent.socket</code> используется <i>gpg</i> для подключения к демону <i>gpg-agent</i>.</li>
<li>Предполагаемое использование <code>gpg-agent-extra.socket</code> на локальной системе — настройка переадресации Unix-сокета с удалённой системы. Это позволяет использовать <i>gpg</i> на удалённой системе без передачи на неё закрытых ключей. Смотрите <span class="plainlinks archwiki-template-man" title="$ man 1 gpg-agent"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/gpg-agent.1">gpg-agent(1)</a></span> для более подробной информации.</li>
<li>
<code>gpg-agent-browser.socket</code> позволяет веб-браузерам обращаться к демону <i>gpg-agent</i>.</li>
<li>
<code>gpg-agent-ssh.socket</code> может использоваться <a href="../ru/OpenSSH.html" class="mw-redirect" title="SSH (Русский)">SSH</a> для кэширования <a href="../en/SSH_keys.html" class="mw-redirect" title="SSH keys (Русский)">ключей SSH</a>, добавленных программой <i>ssh-add</i>. Настройка описана в разделе <a href="#%D0%90%D0%B3%D0%B5%D0%BD%D1%82_SSH">#Агент SSH</a>.</li>
<li>
<code>dirmngr.socket</code> запускает демон GnuPG, обрабатывающий соединения с серверами ключей.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Если вы используете нестандартный <a href="#%D0%94%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B8%D0%B9_%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3">#Домашний каталог</a> GnuPG, вам нужно будет <a href="../ru/Systemd.html#%D0%A0%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" title="Systemd (Русский)">отредактировать</a> параметр <code>ListenStream</code> (смотрите <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.socket"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.socket.5#options">systemd.socket(5) § options</a></span>) во всех socket-юнитах в соответствии со значениями из <code>gpgconf --list-dirs</code>. Имена сокетов используют хэш нестандартного домашнего каталога GnuPG <a rel="nofollow" class="external autonumber" href="https://github.com/gpg/gnupg/blob/260bbb4ab27eab0a8d4fb68592b0d1c20d80179c/common/homedir.c#L710-L713">[5]</a>, поэтому вы можете захардкодить его, не беспокоясь о том, что он изменится.</div>
<h3>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_2"></span><span class="mw-headline" id="Настройка_2">Настройка</span>
</h3>
<p>gpg-agent можно настроить в файле <code>~/.gnupg/gpg-agent.conf</code>. Все опции для настройки перечислены на странице <span class="plainlinks archwiki-template-man" title="$ man 1 gpg-agent"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/gpg-agent.1">gpg-agent(1)</a></span>. Например, так вы можете задать время жизни для ключей в кэше с момента последнего использования:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/gpg-agent.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">default-cache-ttl 3600
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Для кеширования вашего пароля на протяжении всего сеанса используйте команду:
<pre>$ /usr/lib/gnupg/gpg-preset-passphrase --preset XXXXX
</pre>
<p>где XXXXX это keygrip. Вы можете получить это значение, запустив <code>gpg --with-keygrip -K</code>. Пароль будет храниться до перезапуска <code>gpg-agent</code>. Если установлено значение <code>default-cache-ttl</code>, оно более приоритетно.
</p>
<p>Чтобы это работало, нужно разрешить такое кеширование путём запуска gpg-agent с опцией <code>--allow-preset-passphrase</code> или добавлением <code>allow-preset-passphrase</code> в файле <code>~/.gnupg/gpg-agent.conf</code>.
</p>
</div>
<h3>
<span id=".D0.9F.D0.B5.D1.80.D0.B5.D0.B7.D0.B0.D0.BF.D1.83.D1.81.D0.BA_.D0.B0.D0.B3.D0.B5.D0.BD.D1.82.D0.B0"></span><span class="mw-headline" id="Перезапуск_агента">Перезапуск агента</span>
</h3>
<p>После обновления настроек перезапустите агент с помощью <i>gpg-connect-agent</i>:
</p>
<pre>$ gpg-connect-agent reloadagent /bye
</pre>
<p>Будет выведено сообщение <code>OK</code>.
</p>
<p>Однако в некоторых случаях только перезапуска может быть недостаточно, например, когда в конфигурацию агента был добавлен <code>keep-screen</code>. В этом случае необходимо сначала завершить текущий процесс gpg-agent, а затем перезапустить его, как описано выше.
</p>
<h3><span class="mw-headline" id="pinentry">pinentry</span></h3>
<p><code>gpg-agent</code> позволяет выбрать реализацию <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pinentry">pinentry</a></span>, которая используется в качестве интерфейса для ввода пароля, через опцию <code>pinentry-program</code>. Например:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/gpg-agent.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">pinentry-program /usr/bin/pinentry-curses
</pre>
<p>Посмотреть реализации pinentry, доступные в репозиториях, можно с помощью команды <code>pacman -Ql pinentry | grep /usr/bin/</code>. Может понадобиться установить <a href="../ru/Pacman.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" title="Pacman (Русский)">опциональные зависимости</a> для выбранной вами реализации.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> 
<ul>
<li>Чтобы использовать <code>/usr/bin/pinentry-kwallet</code> потребуется установить пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/kwalletcli/">kwalletcli</a></span><sup><small>AUR</small></sup>.</li>
<li>Программы <code>/usr/bin/pinentry-gnome3</code> (для GNOME) и <code>/usr/bin/pinentry-gtk-2</code> (универсальная) <a rel="nofollow" class="external autonumber" href="https://avaldes.co/2020/01/28/secret-service-keepassxc.html">[6]</a> поддерживают <a rel="nofollow" class="external text" href="https://specifications.freedesktop.org/secret-service/">DBus Secret Service API</a>, который позволяет запоминать пароли в совместимом менеджере, таком как <a href="../en/GNOME/Keyring.html" class="mw-redirect" title="GNOME Keyring">GNOME Keyring</a> или <a href="../ru/KeePass.html#%D0%A1%D0%BB%D1%83%D0%B6%D0%B1%D0%B0_%D1%81%D0%B5%D0%BA%D1%80%D0%B5%D1%82%D0%BE%D0%B2" title="KeePass (Русский)">KeePassXC</a>.</li>
</ul>
</div>
<p>Не забудьте выполнить <a href="#%D0%9F%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_%D0%B0%D0%B3%D0%B5%D0%BD%D1%82%D0%B0">#Перезапуск агента</a> после внесения изменений.
</p>
<h3>
<span id=".D0.9A.D1.8D.D1.88.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BF.D0.B0.D1.80.D0.BE.D0.BB.D0.B5.D0.B9"></span><span class="mw-headline" id="Кэширование_паролей">Кэширование паролей</span>
</h3>
<p><code>max-cache-ttl</code> и <code>default-cache-ttl</code> определяют, сколько секунд gpg-agent должен кэшировать пароли. Чтобы вводить пароль всего один раз за сеанс, установите их на очень высокое значение, например:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">gpg-agent.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">max-cache-ttl 60480000
default-cache-ttl 60480000
</pre>
<p>Для кэширования паролей в режиме эмуляции SSH установите <code>default-cache-ttl-ssh</code> и <code>max-cache-ttl-ssh</code>, например:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">gpg-agent.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">default-cache-ttl-ssh 60480000
max-cache-ttl-ssh 60480000
</pre>
<h3>
<span id=".D0.90.D0.B2.D1.82.D0.BE.D0.BC.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B8.D0.B9_.D0.B2.D0.B2.D0.BE.D0.B4_.D0.BF.D0.B0.D1.80.D0.BE.D0.BB.D1.8F"></span><span class="mw-headline" id="Автоматический_ввод_пароля">Автоматический ввод пароля</span>
</h3>
<p>Начиная с GnuPG 2.1.0, использование gpg-agent и pinentry стало обязательным; это нарушает обратную совместимость для парольных фраз, которые вводились через входной поток (STDIN) с помощью опции <code>--passphrase-fd 0</code>. Чтобы восстановить эту возможность, требуется выполнить несколько шагов.
</p>
<p>Первым делом, отредактируйте настройки gpg-agent, разрешив режим петли (<i>loopback</i>) для pinentry:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/gpg-agent.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">allow-loopback-pinentry
</pre>
<p>Выполните <a href="#%D0%9F%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_%D0%B0%D0%B3%D0%B5%D0%BD%D1%82%D0%B0">#Перезапуск агента</a>, чтобы изменения вступили в силу.
</p>
<p>Теперь либо запускайте GnuPG с опцией <code>--pinentry-mode loopback</code>
</p>
<pre>$ gpg --pinentry-mode loopback ...
</pre>
<p>либо, если использовать опцию в командной строке невозможно, добавьте её в файл настроек GnuPG:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/gpg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">pinentry-mode loopback
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Разработчики отмечают, что установка <code>pinentry-mode loopback</code> в файле настроек может нарушать другую функциональность GnuPG, и, если это возможно, лучше указывать опцию через командную строку. <a rel="nofollow" class="external autonumber" href="https://dev.gnupg.org/T1772">[7]</a>
</div>
<h3>
<span id=".D0.90.D0.B3.D0.B5.D0.BD.D1.82_SSH"></span><span class="mw-headline" id="Агент_SSH">Агент SSH</span>
</h3>
<p><i>gpg-agent</i> имеет эмуляцию агента OpenSSH. Если вы уже используете пакет GnuPG, вы можете рассмотреть возможность использования его агента для кэширования ваших <a href="../en/SSH_keys.html" class="mw-redirect" title="SSH keys (Русский)">ключей SSH</a>. Кроме того, некоторые пользователи могут предпочесть диалог ввода PIN-кода, который GnuPG agent предоставляет как часть управления парольной фразой.
</p>
<h4>
<span id=".D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_SSH_AUTH_SOCK"></span><span class="mw-headline" id="Установка_SSH_AUTH_SOCK">Установка SSH_AUTH_SOCK</span>
</h4>
<p>Чтобы связываться с <i>gpg-agent</i> и заменить стандартный <i>ssh-agent</i>, <a href="../ru/Environment_variables.html#%D0%9D%D0%B0_%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D0%B5_%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F" title="Environment variables (Русский)">установите переменные окружения</a>:
</p>
<pre>SSH_AGENT_PID=""
SSH_AUTH_SOCK="${XDG_RUNTIME_DIR}/gnupg/S.gpg-agent.ssh"</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> 
<ul>
<li>Если вы используете скрипт для установки переменных окружения, вы можете просто удалить переменную <code>SSH_AGENT_PID</code> вместо установки пустой строки: <code>unset SSH_AGENT_PID</code>.</li>
<li>Если вы устанавливаете <code>SSH_AUTH_SOCK</code> вручную, имейте в виду, что расположение сокета может отличаться, если вы используете нестандартный <code>GNUPGHOME</code>. Вы можете использовать приведённый ниже пример bash-скрипта или изменить <code>SSH_AUTH_SOCK</code> на значение <code>gpgconf --list-dirs agent-ssh-socket</code>.</li>
<li>Если установлен GNOME Keyring, необходимо <a href="../en/GNOME/Keyring.html#Disabling" title="GNOME/Keyring">деактивировать</a> его ssh-компонент, иначе он перезапишет <code>SSH_AUTH_SOCK</code>.</li>
</ul>
</div>
<p>Вариант с bash-скриптом, который поддерживает нестандартное расположение сокета:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.bashrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">unset SSH_AGENT_PID
if [ "${gnupg_SSH_AUTH_SOCK_by:-0}" -ne $$ ]; then
  export SSH_AUTH_SOCK="$(gpgconf --list-dirs agent-ssh-socket)"
fi</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Тест, включающий переменную <code>gnupg_SSH_AUTH_SOCK_by</code>, предназначен для случая, когда агент запускается как <code>gpg-agent --daemon /bin/sh</code>, в этом случае оболочка наследует переменную <code>SSH_AUTH_SOCK</code> от родителя, <i>gpg-agent</i> <a rel="nofollow" class="external autonumber" href="https://git.gnupg.org/cgi-bin/gitweb.cgi?p=gnupg.git;a=blob;f=agent/gpg-agent.c;hb=7bca3be65e510eda40572327b87922834ebe07eb#l1307">[8]</a>.</div>
<h4>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_pinentry_.D0.B4.D0.BB.D1.8F_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F_.D0.BF.D1.80.D0.B0.D0.B2.D0.B8.D0.BB.D1.8C.D0.BD.D0.BE.D0.B3.D0.BE_TTY"></span><span class="mw-headline" id="Настройка_pinentry_для_использования_правильного_TTY">Настройка pinentry для использования правильного TTY</span>
</h4>
<p>Также укажите GPG_TTY и обновите TTY в случае, если пользователь перешёл в X-сессию, как указано в <span class="plainlinks archwiki-template-man" title="$ man 1 gpg-agent"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/gpg-agent.1">gpg-agent(1)</a></span>. Например:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.bashrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">export GPG_TTY=$(tty)
gpg-connect-agent updatestartuptty /bye &gt;/dev/null</pre>
<p>Если вы используете несколько терминалов одновременно и хотите, чтобы <i>gpg-agent</i> спрашивал пароль через <i>pinentry-curses</i> в том же терминале, в котором была запущена команда <i>ssh</i>, добавьте следующее в файл конфигурации SSH. Это заставит TTY обновляться каждый раз, когда выполняется команда <i>ssh</i> <a rel="nofollow" class="external autonumber" href="https://unix.stackexchange.com/a/499133">[9]</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.ssh/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Match host * exec "gpg-connect-agent UPDATESTARTUPTTY /bye"</pre>
<p>Для корректной работы должна быть указана переменная GPG_TTY.
</p>
<h4>
<span id=".D0.94.D0.BE.D0.B1.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9_SSH"></span><span class="mw-headline" id="Добавление_ключей_SSH">Добавление ключей SSH</span>
</h4>
<p>После запуска <i>gpg-agent</i> вы можете использовать <i>ssh-add</i> для одобрения ключей, выполнив действия, описанные в статье <a href="../en/SSH_keys.html#ssh-agent" title="SSH keys">SSH keys#ssh-agent</a>. Список одобренных ключей хранится в файле <code>~/.gnupg/sshcontrol</code>.
</p>
<p>Когда ваш ключ будет одобрен, вы будете получать диалог <i>pinentry</i> каждый раз, когда потребуется пароль. Для кэширования смотрите раздел <a href="#%D0%9A%D1%8D%D1%88%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D0%B5%D0%B9">#Кэширование паролей</a>.
</p>
<h4>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BA.D0.BB.D1.8E.D1.87.D0.B0_PGP_.D0.B4.D0.BB.D1.8F_.D0.B0.D1.83.D1.82.D0.B5.D0.BD.D1.82.D0.B8.D1.84.D0.B8.D0.BA.D0.B0.D1.86.D0.B8.D0.B8_SSH"></span><span class="mw-headline" id="Использование_ключа_PGP_для_аутентификации_SSH">Использование ключа PGP для аутентификации SSH</span>
</h4>
<p>Можно использовать ключ PGP в качестве ключа SSH. Для этого требуется ключ с возможностью <code>Authentication</code> (смотрите раздел <a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_%D0%B2%D0%BE%D0%B7%D0%BC%D0%BE%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D0%B5%D0%B9">#Настройка возможностей</a>). Это даёт некоторые преимущества:
</p>
<ul>
<li>Меньше работы по управлению ключами, поскольку вам больше не нужно будет поддерживать отдельный ключ SSH.</li>
<li>Возможность хранить ключ аутентификации на смарт-карте. GnuPG автоматически обнаружит ключ, когда карта будет доступна, и добавит его в агент (проверьте с помощью <code>ssh-add -l</code> или <code>ssh-add -L</code>). Комментарий к ключу должен быть примерно таким: <code>openpgp:<i>key-id</i></code> или <code>cardno:<i>card-id</i></code>.</li>
</ul>
<p>Чтобы получить часть открытого ключа вашего ключа GPG/SSH, выполните <code>gpg --export-ssh-key <i>gpg-key</i></code>. Если для ключа включена возможность аутентификации, но эта команда всё равно не работает с сообщением "Unusable public key", добавьте суффикс <code>!</code> (<a rel="nofollow" class="external autonumber" href="https://dev.gnupg.org/T2957">[10]</a>).
</p>
<p>Если ваш ключ GPG не хранится на ключ-карте, вам нужно добавить ключ в <code>$GNUPGHOME/sshcontrol</code>, чтобы он был распознан как ключ SSH. Если ваш ключ находится на ключ-карте, его keygrip будет добавлен в <code>sshcontrol</code> неявно. Если нет, получите keygrip ключа таким образом:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ gpg --list-keys --with-keygrip</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">sub   rsa4096 2018-07-25 [A]
      Keygrip = <i>1531C8084D16DC4C36911F1585AF0ACE7AAFD7E7</i></pre>
<p>Затем отредактируйте <code>sshcontrol</code> следующим образом. Добавление keygrip — это однократное действие; вам не нужно будет редактировать файл снова, если вы не будете добавлять дополнительные ключи.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$GNUPGHOME/sshcontrol</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"><i>1531C8084D16DC4C36911F1585AF0ACE7AAFD7E7</i>
</pre>
<h3>
<span id=".D0.94.D0.BE.D1.81.D1.82.D1.83.D0.BF_.D0.BA_gpg-agent_.D0.B8_ssh-agent_.D0.BD.D0.B0_.D1.83.D0.B4.D0.B0.D0.BB.D1.91.D0.BD.D0.BD.D0.BE.D0.BC_.D1.83.D1.81.D1.82.D1.80.D0.BE.D0.B9.D1.81.D1.82.D0.B2.D0.B5"></span><span class="mw-headline" id="Доступ_к_gpg-agent_и_ssh-agent_на_удалённом_устройстве">Доступ к gpg-agent и ssh-agent на удалённом устройстве</span>
</h3>
<p>Как описано в <a rel="nofollow" class="external text" href="https://wiki.gnupg.org/AgentForwarding">GnuPG wiki</a>, можно получить доступ к своему gpg-agent с удалённой машины, перенаправив на неё сокеты gpg с помощью SSH.
</p>
<p>Сначала добавьте следующую строку в <code>/etc/ssh/sshd_config</code> на удалённой машине, чтобы включить автоматическое удаление старых сокетов при подключении. Без этого сокеты на удалённой машине придётся удалять вручную перед подключением с включенным перенаправлением, чтобы оно работало:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
StreamLocalBindUnlink yes
...
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезагрузите">Перезагрузите</a> службу <code>sshd.service</code> на удалённой машине для применения изменений.</div>
<p>На клиенте используйте директиву SSH <code>RemoteForward</code> для перенаправления трафика с удалённого порта на локальный. Как описано в <span class="plainlinks archwiki-template-man" title="$ man 5 ssh_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh_config.5#RemoteForward">ssh_config(5) § RemoteForward</a></span>, параметрами этой директивы являются путь к слушающему сокету на удалённой стороне (той, на которую нужно пробросить агент), а затем путь к сокету назначения на локальном хосте (том, из которого пробрасывается агент). Конфигурация должна выглядеть примерно так:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.ssh/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Host <i>remote_name</i>
    ...
    RemoteForward <i>remote_agent_socket</i> <i>local_agent_extra_socket</i>
    RemoteForward <i>remote_agent_ssh_socket</i> <i>local_agent_ssh_socket</i>
</pre>
<p>Первая строка настраивает переадресацию gpg-agent:
</p>
<ul>
<li>
<i>remote_agent_socket</i> — вывод команды <code>gpgconf --list-dir agent-socket</code> на удалённом хосте.</li>
<li>
<i>local_agent_extra_socket</i> — вывод команды <code>gpgconf --list-dir agent-extra-socket</code> на локальном хосте.</li>
</ul>
<p>Вторая строка является необязательной. Она настраивает переадресацию ssh-agent:
</p>
<ul>
<li>
<i>local_agent_ssh_socket</i> — вывод команды <code>gpgconf --list-dir agent-ssh-socket</code> на удалённом хосте.</li>
<li>
<i>remote_agent_ssh_socket</i> — вывод команды <code>gpgconf --list-dir agent-ssh-socket</code> на локальном хосте.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> При переадресации ssh-agent на удалённом хосте должен быть установлен <code>SSH_AUTH_SOCK</code> в соответствии с выводом <code>gpgconf --list-dirs agent-ssh-socket</code>, как описано в разделе <a href="#%D0%90%D0%B3%D0%B5%D0%BD%D1%82_SSH">#Агент SSH</a>).</div>
<p>Таким образом, с путями по умолчанию это будет выглядеть так:
</p>
<pre>    RemoteForward /run/user/1000/gnupg/S.gpg-agent /run/user/1000/gnupg/S.gpg-agent.extra
    RemoteForward /run/user/1000/gnupg/S.gpg-agent.ssh /run/user/1000/gnupg/S.gpg-agent.ssh
</pre>
<p>При такой конфигурации вызов <code>ssh <i>remote_name</i></code> должен автоматически пробросить gpg-agent с вашего локального устройства на сервер, к которому вы подключаетесь, и позволить использовать там ваши gpg-ключи для расшифровки/подписи (и, если вы добавили вторую строку RemoteForward, то использовать ssh-agent тоже).
</p>
<h2>
<span id=".D0.A1.D0.BC.D0.B0.D1.80.D1.82-.D0.BA.D0.B0.D1.80.D1.82.D1.8B"></span><span class="mw-headline" id="Смарт-карты">Смарт-карты</span>
</h2>
<p>GnuPG использует <i>scdaemon</i> в качестве интерфейса к устройству для чтения смарт-карт. Для получения дополнительной информации обратитесь к <a href="../ru/Man_page.html" title="Man page (Русский)">man-странице</a> <span class="plainlinks archwiki-template-man" title="$ man 1 scdaemon"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/scdaemon.1">scdaemon(1)</a></span>.
</p>
<h3>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D1.82.D0.BE.D0.BB.D1.8C.D0.BA.D0.BE_.D0.B4.D0.BB.D1.8F_GnuPG"></span><span class="mw-headline" id="Настройка_только_для_GnuPG">Настройка только для GnuPG</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Чтобы предоставить scdaemon прямой доступ к USB-считывателям смарт-карт, установите дополнительную зависимость <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libusb-compat">libusb-compat</a></span>.</div>
<p>Если вы не планируете использовать другие карты, кроме тех, что работают на основе GnuPG, необходимо проверить параметр <code>reader-port</code> в файле <code>~/.gnupg/scdaemon.conf</code>. Значение '0' относится к первому доступному считывателю последовательного порта, а значение '32768' (по умолчанию) — к первому считывателю USB.
</p>
<h3>
<span id="GnuPG_.D0.B2.D0.BC.D0.B5.D1.81.D1.82.D0.B5_.D1.81_pcscd_.28PCSC_Lite.29"></span><span class="mw-headline" id="GnuPG_вместе_с_pcscd_(PCSC_Lite)">GnuPG вместе с pcscd (PCSC Lite)</span>
</h3>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 pcscd"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pcscd.8">pcscd(8)</a></span> — это демон, который обрабатывает доступ к смарт-карте (SCard API). Если scdaemon не может подключиться к смарт-карте напрямую (например, используя встроенную поддержку CCID), он пытается найти смарт-карту с помощью драйвера PCSC Lite.
</p>
<p>Для использования pscsd <a href="../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">установите</a> пакеты <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pcsclite">pcsclite</a></span> и <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ccid">ccid</a></span>. Затем <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Запустите">запустите</a> и/или <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Включите">включите</a> службу <code>pcscd.service</code>. Вместо запуска демона напрямую можно запустить и/или включить <code>pcscd.socket</code>, тогда демон будет запускаться только по необходимости.
</p>
<h4>
<span id=".D0.92.D1.81.D0.B5.D0.B3.D0.B4.D0.B0_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D1.8C_pcscd"></span><span class="mw-headline" id="Всегда_использовать_pcscd">Всегда использовать pcscd</span>
</h4>
<p>Если вы используете смарт-карту с драйвером opensc (например, ID-карты, распространённые в некоторых странах), необходимо уделить чуть большее время настройке GnuPG. Используя стандартную конфигурацию, при запросе <code>gpg --card-status</code> вы можете получать сообщения вроде этого:
</p>
<pre>gpg: selecting openpgp failed: ec=6.108
</pre>
<p>По умолчанию scdaemon пытается подключиться к устройству напрямую. Эта попытка провалится, если считыватель карт используется другим процессом. Например, если демон pcscd используется OpenSC. Чтобы справиться с этой ситуацией, необходимо использовать тот же самый драйвер, который использует opensc — тогда они смогут работать вместе. Чтобы заставить scdaemon использовать pcscd, необходимо удалить <code>reader-port</code> из файла <code>~/.gnupg/scdaemon.conf</code>, указать путь к библиотеке <code>libpcsclite.so</code> и отключить ccid, чтобы удостовериться, что используется именно pcscd:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/scdaemon.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">pcsc-driver /usr/lib/libpcsclite.so
card-timeout 5
disable-ccid
</pre>
<p>Обратитесь к <a href="../ru/Man_page.html" title="Man page (Русский)">man-странице</a> <span class="plainlinks archwiki-template-man" title="$ man 1 scdaemon"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/scdaemon.1">scdaemon(1)</a></span>, если вы не используете OpenSC.
</p>
<h4>
<span id=".D0.9E.D0.B1.D1.89.D0.B8.D0.B9_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF_.D1.81_pcscd"></span><span class="mw-headline" id="Общий_доступ_с_pcscd">Общий доступ с pcscd</span>
</h4>
<p>GnuPG <code>scdaemon</code> — единственный популярный клиент <code>pcscd</code>, который использует флаг <code>PCSC_SHARE_EXCLUSIVE</code> при подключении к <code>pcscd</code>. Другие клиенты, такие как OpenSC PKCS#11, которые используются браузерами и программами, перечисленными в статье <a href="../en/Electronic_identification.html" title="Electronic identification">Electronic identification</a>, используют <code>PCSC_SHARE_SHARED</code>, который даёт общий доступ к одной смарт-карте. <code>pcscd</code> не будет предоставлять эксклюзивный доступ к смарт-карте, пока подключены другие клиенты. Это означает, что для использования возможностей смарт-карты GnuPG вам придётся предварительно закрыть все открытые окна браузера или выполнить другие неудобные действия. Начиная с версии 2.2.28 LTS и 2.3.0, вы можете включить общий доступ, изменив файл <code>scdaemon.conf</code> и добавив <code>pcsc-shared</code> в конце.
</p>
<h5><span class="mw-headline" id="Multi_applet_smart_cards">Multi applet smart cards</span></h5>
<p>При использовании <a href="../en/YubiKey.html" title="YubiKey">YubiKey</a> или других USB-ключей с несколькими апплетами с OpenSC PKCS#11 могут возникнуть проблемы, когда OpenSC переключает ваш Yubikey с апплета OpenPGP на апплет PIV, нарушая работу <code>scdaemon</code>.
</p>
<p>Вы можете обойти эту проблему, заставив OpenSC также использовать апплет OpenPGP. Откройте файл <code>/etc/opensc.conf</code>, найдите Yubikey и измените строку <code>driver = "PIV-II";</code> на <code>driver = "openpgp";</code>. Если такой записи нет, используйте <code>pcsc_scan</code>. Найдите Answer to Reset <code>ATR: 12 34 56 78 90 AB CD ...</code>. Затем создайте новую запись.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/opensc.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
card_atr 12:23:34:45:67:89:ab:cd:... {
    name = "YubiKey Neo";
    driver = "openpgp"
}
...</pre>
<p>После этого вы можете проверить с помощью <code>pkcs11-tool -O --login</code>, что апплет OpenPGP выбран по умолчанию. Другие клиенты PKCS#11, такие как браузеры, может понадобиться перезапустить для применения этого изменения.
</p>
<h5>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D1.81.D0.BC.D0.B0.D1.80.D1.82-.D0.BA.D0.B0.D1.80.D1.82.D1.8B_.D0.BD.D0.B0_.D1.83.D0.B4.D0.B0.D0.BB.D1.91.D0.BD.D0.BD.D0.BE.D0.BC_.D0.BA.D0.BB.D0.B8.D0.B5.D0.BD.D1.82.D0.B5_.D1.87.D0.B5.D1.80.D0.B5.D0.B7_SSH"></span><span class="mw-headline" id="Использование_смарт-карты_на_удалённом_клиенте_через_SSH">Использование смарт-карты на удалённом клиенте через SSH</span>
</h5>
<p>Если вы входите в машину по SSH и пытаетесь использовать подключенное устройство через pcscd, то можете обнаружить ошибки типа:
</p>
<pre>gpg: selecting card failed: No such device
gpg: OpenPGP card not available: No such device
</pre>
<p>Это связано с тем, что <a href="../ru/Polkit.html" title="Polkit (Русский)">Polkit</a> предоставляет доступ только локальным клиентам. Чтобы решить эту проблему, можно добавить правило, разрешающее доступ определённым пользователям во всех случаях. Приведённое ниже правило разрешает всем пользователям из группы <code>wheel</code> доступ к устройствам через <code>pcscd</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/polkit-1/rules.d/99-pcscd.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">polkit.addRule(function(action, subject) {
    if (action.id == "org.debian.pcsc-lite.access_card" &amp;&amp;
        subject.isInGroup("wheel")) {
        return polkit.Result.YES;
    }
});
polkit.addRule(function(action, subject) {
    if (action.id == "org.debian.pcsc-lite.access_pcsc" &amp;&amp;
        subject.isInGroup("wheel")) {
        return polkit.Result.YES;
    }
});</pre>
<p>После создания файла <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">перезапустите</a> службу <code>polkit.service</code>.
</p>
<h2>
<span id=".D0.A1.D0.BE.D0.B2.D0.B5.D1.82.D1.8B_.D0.B8_.D1.80.D0.B5.D0.BA.D0.BE.D0.BC.D0.B5.D0.BD.D0.B4.D0.B0.D1.86.D0.B8.D0.B8"></span><span class="mw-headline" id="Советы_и_рекомендации">Советы и рекомендации</span>
</h2>
<h3>
<span id=".D0.94.D1.80.D1.83.D0.B3.D0.BE.D0.B9_.D0.B0.D0.BB.D0.B3.D0.BE.D1.80.D0.B8.D1.82.D0.BC"></span><span class="mw-headline" id="Другой_алгоритм">Другой алгоритм</span>
</h3>
<p>Возможно, вы захотите использовать более сильные алгоритмы:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.gnupg/gpg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...

personal-digest-preferences SHA512
cert-digest-algo SHA512
default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 ZLIB BZIP2 ZIP Uncompressed
personal-cipher-preferences TWOFISH CAMELLIA256 AES 3DES
</pre>
<p>В последней версии GnuPG по умолчанию используются алгоритмы SHA256 и AES, которые достаточно безопасны для большинства пользователей. Однако если вы используете версию GnuPG старше 2.1 или если вы хотите получить ещё более высокий уровень безопасности, то вам стоит выполнить описанные выше действия.
</p>
<h3>
<span id=".D0.A8.D0.B8.D1.84.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BF.D0.B0.D1.80.D0.BE.D0.BB.D1.8F"></span><span class="mw-headline" id="Шифрование_пароля">Шифрование пароля</span>
</h3>
<p>Может быть полезно зашифровать какой-нибудь пароль, чтобы он не хранился в чистом виде в файле настроек. Например, пароль от вашей учётной записи электронной почты.
</p>
<p>Первым делом создайте файл пароля, содержащий только ваш пароль и пустую строку. Обратите внимание: файл <b>должен</b> содержать <b>одну</b> пустую строку в конце, иначе gpg выведет сообщение об ошибке.
</p>
<p>Теперь выполните:
</p>
<pre>$ gpg -e -a -r <i>user-id</i> <i>файл_пароля</i>
</pre>
<p>Опция <code>-e</code> обозначает режим шифрования, <code>-a</code> — для вывода в ASCII-совместимом формате, <code>-r</code> — идентификатор ключа.
</p>
<p>После выполнения команды в текущем каталоге будет создан новый файл <code><i>файл_пароля</i>.asc</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> <a href="../en/Pass.html" title="Pass">pass</a> автоматизирует этот процесс.</div>
<h3>
<span id=".D0.98.D0.B7.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BC.D0.BE.D0.B4.D0.B5.D0.BB.D0.B8_.D0.B4.D0.BE.D0.B2.D0.B5.D1.80.D0.B8.D1.8F"></span><span class="mw-headline" id="Изменение_модели_доверия">Изменение модели доверия</span>
</h3>
<p>По умолчанию GnuPG использует модель доверия <a href="https://en.wikipedia.org/wiki/Web_of_Trust" class="extiw" title="wikipedia:Web of Trust">Web of Trust</a>. Можно изменить эту модель на <a href="https://en.wikipedia.org/wiki/Trust_on_first_use" class="extiw" title="wikipedia:Trust on first use">Trust on first use</a>, добавив <code>--trust-model=tofu</code> при добавлении ключа или добавив эту опцию в файл настроек GnuPG. Более подробная информация содержится в <a rel="nofollow" class="external text" href="https://lists.gnupg.org/pipermail/gnupg-devel/2015-October/030341.html">этом письме GnuPG</a>.
</p>
<h3>
<span id=".D0.A1.D0.BA.D1.80.D1.8B.D1.82.D0.B8.D0.B5_.D0.B2.D1.81.D0.B5.D1.85_.D0.B8.D0.B4.D0.B5.D0.BD.D1.82.D0.B8.D1.84.D0.B8.D0.BA.D0.B0.D1.82.D0.BE.D1.80.D0.BE.D0.B2_.D0.BF.D0.BE.D0.BB.D1.83.D1.87.D0.B0.D1.82.D0.B5.D0.BB.D0.B5.D0.B9"></span><span class="mw-headline" id="Скрытие_всех_идентификаторов_получателей">Скрытие всех идентификаторов получателей</span>
</h3>
<p>По умолчанию в зашифрованном сообщении содержится идентификатор ключа получателя. Его можно удалить во время шифрования для получателя с помощью <code>hidden-recipient <i>user-id</i></code>. Чтобы удалить его для всех получателей, добавьте <code>throw-keyids</code> в файл настроек. Это помогает скрыть получателей сообщения и является ограниченной контрмерой против анализа трафика (то есть, используя немного социальной инженерии, любой, кто способен расшифровать сообщение, может проверить, является ли один из других получателей тем, кого он подозревает). На стороне получателя это может замедлить процесс расшифровки, поскольку необходимо попробовать все доступные закрытые ключи (например, с помощью <code>--try-secret-key <i>user-id</i></code>).
</p>
<h3>
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_caff_.D0.BD.D0.B0_.D0.B2.D1.81.D1.82.D1.80.D0.B5.D1.87.D0.B0.D1.85_.D0.B4.D0.BB.D1.8F_.D0.BF.D0.BE.D0.B4.D0.BF.D0.B8.D1.81.D0.B8_.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9"></span><span class="mw-headline" id="Использование_caff_на_встречах_для_подписи_ключей">Использование caff на встречах для подписи ключей</span>
</h3>
<p>Чтобы дать возможность пользователям проверить ключи в хранилищах ключей и в собственных списках (то есть убедиться, что владелец ключа на самом деле тот, за кого себя выдаёт), PGP/GnuPG использует так называемую «сеть доверия» (<a href="https://en.wikipedia.org/wiki/Web_of_Trust" class="extiw" title="wikipedia:Web of Trust">Web of Trust</a>). Для поддержания и развития сети периодически организуются очные встречи, на которых люди, использующие систему PGP, обмениваются своими публичными ключами. <a href="https://en.wikipedia.org/wiki/Zimmermann%E2%80%93Sassaman_key-signing_protocol" class="extiw" title="wikipedia:Zimmermann–Sassaman key-signing protocol">Протокол Циммермана–Сассамана</a> призван сделать этот процесс наиболее эффективным. <a rel="nofollow" class="external text" href="https://www.cryptnet.net/fdp/crypto/keysigning_party/en/keysigning_party.html">Здесь</a> вы можете найти инструкцию по проведению встреч.
</p>
<p>Для упрощения процедуры подписи ключей и отправки этих подписей владельцам ключей вы можете воспользоваться утилитой <i>caff</i>. Установить её можно из <a href="../ru/Arch_User_Repository.html" class="mw-redirect" title="AUR (Русский)">AUR</a> с пакетом <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/caff-git/">caff-git</a></span><sup><small>AUR</small></sup>.
</p>
<p>Для отправки подписей владельцам вам нужен работающий агент <a href="https://en.wikipedia.org/wiki/Message_transfer_agent" class="extiw" title="wikipedia:Message transfer agent">MTA</a>. Если у вас его ещё нет, установите <a href="../en/Msmtp.html" title="Msmtp">msmtp</a>.
</p>
<h3>
<span id=".D0.9E.D1.82.D0.BE.D0.B1.D1.80.D0.B0.D0.B6.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B4.D0.BB.D0.B8.D0.BD.D0.BD.D1.8B.D1.85_.D0.B8.D0.B4.D0.B5.D0.BD.D1.82.D0.B8.D1.84.D0.B8.D0.BA.D0.B0.D1.82.D0.BE.D1.80.D0.BE.D0.B2_.D0.B8_.D0.BE.D1.82.D0.BF.D0.B5.D1.87.D0.B0.D1.82.D0.BA.D0.BE.D0.B2"></span><span class="mw-headline" id="Отображение_длинных_идентификаторов_и_отпечатков">Отображение длинных идентификаторов и отпечатков</span>
</h3>
<p>Чтобы всегда показывать длинные идентификаторы ключей, добавьте <code>keyid-format 0xlong</code> в файл настроек. Чтобы всегда показывать полные отпечатки, добавьте <code>with-fingerprint</code>.
</p>
<h3>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D0.B2.D0.BE.D0.B7.D0.BC.D0.BE.D0.B6.D0.BD.D0.BE.D1.81.D1.82.D0.B5.D0.B9"></span><span class="mw-headline" id="Настройка_возможностей">Настройка возможностей</span>
</h3>
<p>Можно установить пользовательские возможности (capabilities) для ваших ключей. Доступны следующие возможности:
</p>
<ul>
<li>Сертификация (Certify, только для мастер-ключей) — позволяет ключу создавать подключи, обязательна для мастер-ключей.</li>
<li>Подпись (Sign) — позволяет ключу создавать криптографические подписи, которые другие могут проверить с помощью открытого ключа.</li>
<li>Шифрование (Encrypt) — позволяет любому человеку шифровать данные с помощью открытого ключа, расшифровать которые может только закрытый ключ.</li>
<li>Аутентификация (Authenticate) — позволяет использовать ключ для аутентификации в различных программах, не относящихся к GnuPG. Ключ можно использовать, например, в качестве ключа SSH.</li>
</ul>
<p>Можно указать возможности мастер-ключа, выполнив команду:
</p>
<pre>$ gpg --full-generate-key --expert
</pre>
<p>И выбрав опцию, позволяющую задать собственные возможности.
</p>
<p>Аналогично, чтобы задать возможности для подключей, добавьте флаг <code>--expert</code> в команду <code>gpg --edit-key</code>; смотрите раздел <a href="#%D0%A0%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BA%D0%BB%D1%8E%D1%87%D0%B0">#Редактирование ключа</a>.
</p>
<h2>
<span id=".D0.A0.D0.B5.D1.88.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC"></span><span class="mw-headline" id="Решение_проблем">Решение проблем</span>
</h2>
<h3><span class="mw-headline" id="su">su</span></h3>
<p>При использовании <code>pinentry</code> у вас должны быть корректные настройки прав доступа к устройству терминала (например <code>/dev/tty1</code>). Однако при использовании <i>su</i> (или <i>sudo</i>) права доступа остаются у изначального пользователя. Из-за этого будут возникать проблемы с pinentry, даже при запуске от имени суперпользователя. При попытке использовать ssh будет возникать ошибка <code>sign_and_send_pubkey: signing failed: agent refused operation</code>. Чтобы исправить эту проблему, назначьте нового владельца к устройству терминала до использования pinentry (например, перед запуском gpg-agent). При использовании <i>gpg</i> от имени суперпользователя просто измените владельца на root перед использованием gpg:
</p>
<pre># chown root /dev/ttyN  # где N — текущий tty
</pre>
<p>Затем верните прежнего владельца после первого запуска <i>gpg</i>. Аналогично должно работать и для <code>/dev/pts/</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание:</strong> Владелец tty <i>должен</i> совпадать с пользователем, от имени которого запускается pinentry. Добавление пользователя в группу <code>tty</code> <b>не</b> поможет решить проблему.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет:</strong> Если вы запустите gpg через <code>script</code>, он будет использовать новый tty с правильным владельцем:
<pre># script -q -c "gpg --gen-key" /dev/null
</pre>
</div>
<h3>
<span id="Agent_.D0.B2.D1.8B.D0.B2.D0.BE.D0.B4.D0.B8.D1.82_.D0.BE.D1.88.D0.B8.D0.B1.D0.BA.D1.83_end_of_file"></span><span class="mw-headline" id="Agent_выводит_ошибку_end_of_file">Agent выводит ошибку end of file</span>
</h3>
<p>Если используется <code>/usr/bin/pinentry-gnome3</code>, для его правильной работы требуется запущенный DBus. Для получения дополнительной информации смотрите раздел <a href="../ru/General_troubleshooting.html#%D0%A0%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F_%D1%81%D0%B5%D1%81%D1%81%D0%B8%D0%B8" class="mw-redirect" title="Устранение часто встречающихся неполадок">Устранение часто встречающихся неполадок#Разрешения сессии</a>.
</p>
<p>Также можно использовать другую реализацию pinentry. Как это сделать, смотрите в разделе <a href="#pinentry">#pinentry</a>.
</p>
<h3>
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_.D0.BF.D1.80.D0.B0.D0.B2_.D0.B4.D0.BE.D1.81.D1.82.D1.83.D0.BF.D0.B0_.D0.B4.D0.BB.D1.8F_KGpg"></span><span class="mw-headline" id="Настройка_прав_доступа_для_KGpg">Настройка прав доступа для KGpg</span>
</h3>
<p>Некоторые пользователи сталкивались с проблемой, когда <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=kgpg">kgpg</a></span> не может получить доступ к настройкам в <code>~/.gnupg/</code>. Одна из причин может быть в устаревшем файле <i>options</i>. Подробности смотрите в <a rel="nofollow" class="external text" href="https://bugs.kde.org/show_bug.cgi?id=290221">отчёте об ошибке</a>.
</p>
<h3>
<span id="GNOME_.D0.BD.D0.B0_Wayland_.D0.BF.D0.B5.D1.80.D0.B5.D0.BE.D0.BF.D1.80.D0.B5.D0.B4.D0.B5.D0.BB.D1.8F.D0.B5.D1.82_.D1.81.D0.BE.D0.BA.D0.B5.D1.82_.D0.B0.D0.B3.D0.B5.D0.BD.D1.82.D0.B0_SSH"></span><span class="mw-headline" id="GNOME_на_Wayland_переопределяет_сокет_агента_SSH">GNOME на Wayland переопределяет сокет агента SSH</span>
</h3>
<p>В сеансах Wayland <code>gnome-session</code> устанавливает <code>SSH_AUTH_SOCK</code> на стандартный сокет gnome-keyring, <code>$XDG_RUNTIME_DIR/keyring/ssh</code>. Это переопределяет любое значение, установленное в другом месте.
</p>
<p>Отключение такого поведения описано в статье <a href="../en/GNOME/Keyring.html#Disabling" title="GNOME/Keyring">GNOME/Keyring#Disabling</a>.
</p>
<h3><span class="mw-headline" id="mutt">mutt</span></h3>
<p>Mutt может неправильно использовать <i>gpg-agent</i>, вам нужно установить <a href="../ru/Environment_variables.html" title="Environment variables (Русский)">переменную окружения</a> <code>GPG_AGENT_INFO</code> (содержимое не имеет значения) при запуске mutt. Также убедитесь, что включено <a href="#%D0%9A%D1%8D%D1%88%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%B0%D1%80%D0%BE%D0%BB%D0%B5%D0%B9">#Кэширование паролей</a>.
</p>
<p>Смотрите <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1490821#p1490821">эту ветку форума</a>.
</p>
<h3>
<span id=".22.D0.9F.D0.BE.D1.82.D0.B5.D1.80.D1.8F.D0.B2.D1.88.D0.B8.D0.B5.D1.81.D1.8F.22_.D0.BA.D0.BB.D1.8E.D1.87.D0.B8_.D0.BF.D0.BE.D1.81.D0.BB.D0.B5_.D0.BE.D0.B1.D0.BD.D0.BE.D0.B2.D0.BB.D0.B5.D0.BD.D0.B8.D1.8F_.D0.B4.D0.BE_GnuPG_2.1"></span><span class="mw-headline" id='"Потерявшиеся"_ключи_после_обновления_до_GnuPG_2.1'>"Потерявшиеся" ключи после обновления до GnuPG 2.1</span>
</h3>
<p>Если команда <code>gpg --list-keys</code> перестала отображать какие-то ключи, а приложения ругаются на отсутствующие/повреждённые ключи, вероятно, какие-то ключи не были сконвертированы в новый формат.
</p>
<p>Прочтите <a rel="nofollow" class="external text" href="https://web.archive.org/web/20160502052025/http://jo-ke.name/wp/?p=111">исправление ошибки Invalid packet</a>. Здесь говорится, что существует баг с ключами в старых файлах <code>pubring.gpg</code> и <code>secring.gpg</code>, которые были заменены файлом <code>pubring.kbx</code> и подкаталогом <code>private-keys-v1.d/</code>. Потерянные ключи можно восстановить следующими командами:
</p>
<pre>$ cd
$ cp -r .gnupg gnupgOLD
$ gpg --export-ownertrust &gt; otrust.txt
$ gpg --import .gnupg/pubring.gpg
$ gpg --import-ownertrust otrust.txt
$ gpg --list-keys
</pre>
<h3>
<span id="gpg_.D0.B7.D0.B0.D0.B2.D0.B8.D1.81.D0.B0.D0.B5.D1.82_.D0.BD.D0.B0_.D0.B2.D1.81.D0.B5.D1.85_.D1.81.D0.B5.D1.80.D0.B2.D0.B5.D1.80.D0.B0.D1.85_.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9_.28.D0.BF.D1.80.D0.B8_.D0.BF.D0.BE.D0.BF.D1.8B.D1.82.D0.BA.D0.B5_.D0.BF.D0.BE.D0.BB.D1.83.D1.87.D0.B5.D0.BD.D0.B8.D1.8F_.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.B9.29"></span><span class="mw-headline" id="gpg_зависает_на_всех_серверах_ключей_(при_попытке_получения_ключей)">gpg зависает на всех серверах ключей (при попытке получения ключей)</span>
</h3>
<p>Если gpg зависает на определённом сервере ключей, когда пытается получить ключи, вам придётся убить dirmngr для того, чтобы получить доступ к другим действительно рабочим серверам, в противном случае gpg останется зависшим для всех них.
</p>
<h3>
<span id=".D0.A1.D0.BC.D0.B0.D1.80.D1.82-.D0.BA.D0.B0.D1.80.D1.82.D0.B0_.D0.BD.D0.B5_.D0.BE.D0.B1.D0.BD.D0.B0.D1.80.D1.83.D0.B6.D0.B5.D0.BD.D0.B0"></span><span class="mw-headline" id="Смарт-карта_не_обнаружена">Смарт-карта не обнаружена</span>
</h3>
<p>Возможно, пользователь, из-под которого вы работаете, не имеет права доступа к смарт-карте, вследствие чего и возникает <code>card error</code>, даже если карта корректно настроена и установлена.
</p>
<p>Одно из возможных решений — добавить новую группу <code>scard</code> с включением в неё пользователей, которым нужен доступ к смарт-карте.
</p>
<p>Дальше используйте подобное правило <a href="../ru/Udev.html" title="Udev (Русский)">udev</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/71-gnupg-ccid.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ACTION=="add", SUBSYSTEM=="usb", ENV{ID_VENDOR_ID}=="1050", ENV{ID_MODEL_ID}=="0116|0111", MODE="660", GROUP="scard"
</pre>
<p>Только нужно адаптировать VENDOR и MODEL в соответствии с выводом <code>lsusb</code>. Выше приведён пример для YubikeyNEO.
</p>
<h3>
<span id="server_.27gpg-agent.27_is_older_than_us_.28x_.3C_y.29"></span><span class="mw-headline" id="server_'gpg-agent'_is_older_than_us_(x_&lt;_y)">server 'gpg-agent' is older than us (x &lt; y)</span>
</h3>
<p>Это предупреждение появляется, если <code>gnupg</code> был обновлён, а старый gpg-agent всё ещё запущен. <a href="../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">Перезапустите</a> <i>пользовательский</i> <code>gpg-agent.socket</code> (т.е. используйте флаг <code>--user</code> при перезапуске).
</p>
<h3><span class="mw-headline" id="IPC_connect_call_failed">IPC connect call failed</span></h3>
<p>Убедитесь, что <code>gpg-agent</code> и <code>dirmngr</code> не запущены, с помощью команды <code>killall gpg-agent dirmngr</code>, и проверьте права доступа к каталогу <code>$GNUPGHOME/crls.d/</code>, которые должны быть <code>700</code>.
</p>
<p>По умолчанию пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnupg">gnupg</a></span> использует для сокетов каталог <code>/run/user/$UID/gnupg/</code>. В <a rel="nofollow" class="external text" href="https://github.com/gpg/gnupg/blob/25ae80b8eb6e9011049d76440ad7d250c1d02f7c/README#L121-L122">документации GnuPG</a> указано, что это предпочтительный каталог (не все файловые системы поддерживают сокеты). Убедитесь, что в конфигурации <code>agent-socket</code> указан путь к поддерживающей сокеты файловой системе. Настройки пути для <code>agent-socket</code> можно узнать, выполнив команду <code>gpgconf --list-dirs agent-socket</code>.
</p>
<p>Проверьте, что <code>gpg-agent</code> успешно запускается, с помощью команды <code>gpg-agent --daemon</code>.
</p>
<h3>
<span id=".D0.97.D0.B0.D1.89.D0.B8.D1.82.D0.B0_.D0.BE.D1.82_.D0.BE.D1.82.D1.80.D0.B0.D0.B2.D0.BB.D0.B5.D0.BD.D0.BD.D1.8B.D1.85_PGP-.D1.81.D0.B5.D1.80.D1.82.D0.B8.D1.84.D0.B8.D0.BA.D0.B0.D1.82.D0.BE.D0.B2"></span><span class="mw-headline" id="Защита_от_отравленных_PGP-сертификатов">Защита от отравленных PGP-сертификатов</span>
</h3>
<p>В июне 2019 года неизвестный злоумышленник заспамил PGP-сертификаты некоторых высокопоставленных участников сообщества десятками тысяч (или сотнями тысяч) подписей (CVE-2019-13050) и загрузил эти подписи на серверы ключей SKS. Существование этих отравленных сертификатов в списке ключей приводит к зависанию gpg со следующим сообщением:
</p>
<pre>gpg: removing stale lockfile (created by 7055)
</pre>
<p>Возможное решение проблемы заключается в удалении отравленного сертификата, как описано в <a rel="nofollow" class="external text" href="https://tech.michaelaltfield.net/2019/07/14/mitigating-poisoned-pgp-certificates/">этой статье</a>.
</p>
<h3>
<span id="Invalid_IPC_response_.D0.B8_Inappropriate_ioctl_for_device"></span><span class="mw-headline" id="Invalid_IPC_response_и_Inappropriate_ioctl_for_device">Invalid IPC response и Inappropriate ioctl for device</span>
</h3>
<p>По умолчанию программой pinentry является <code>/usr/bin/pinentry-gtk-2</code>. Если <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gtk2">gtk2</a></span> недоступен, pinentry пытается использовать <code>/usr/bin/pinentry-curses</code>, что приводит к сбою подписания:
</p>
<pre>gpg: signing failed: Inappropriate ioctl for device
gpg: [stdin]: clear-sign failed: Inappropriate ioctl for device
</pre>
<p>Установите <a href="../ru/Environment_variables.html" title="Environment variables (Русский)">переменную окружения</a> <code>GPG_TTY</code> для программ <code>/usr/bin/pinentry-tty</code> и <code>/usr/bin/pinentry-curses</code>.
</p>
<pre>$ export GPG_TTY=$(tty)
</pre>
<h3>
<span id="Keyblock_resource_.D0.BD.D0.B5_.D1.81.D1.83.D1.89.D0.B5.D1.81.D1.82.D0.B2.D1.83.D0.B5.D1.82"></span><span class="mw-headline" id="Keyblock_resource_не_существует">Keyblock resource не существует</span>
</h3>
<p>Если при попытке импортировать ключи вы получаете ошибку:
</p>
<pre>gpg: keyblock resource '<i>gnupg_home</i>/pubring.kbx': No such file or directory
</pre>
<p>это потому что GnuPG не создаст свой домашний каталог, если его ещё нет. Просто создайте его вручную:
</p>
<pre>$ mkdir -m 700 <i>gnupg_home</i>
</pre>
<h2>
<span id=".D0.A1.D0.BC.D0.BE.D1.82.D1.80.D0.B8.D1.82.D0.B5_.D1.82.D0.B0.D0.BA.D0.B6.D0.B5"></span><span class="mw-headline" id="Смотрите_также">Смотрите также</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://gnupg.org/">Домашняя страница GNU Privacy Guard</a></li>
<li><a rel="nofollow" class="external text" href="https://futureboy.us/pgp.html">Alan Eliasen's GPG Tutorial</a></li>
<li>
<a href="https://tools.ietf.org/html/rfc4880" class="extiw" title="rfc:4880">RFC 4880</a> — "OpenPGP Message Format"</li>
<li><a rel="nofollow" class="external text" href="https://help.riseup.net/en/security/message-security/openpgp/gpg-best-practices">gpg.conf recommendations and best practices</a></li>
<li><a href="https://fedoraproject.org/wiki/Creating_GPG_Keys" class="extiw" title="fedora:Creating GPG Keys">Fedora:Creating GPG Keys</a></li>
<li><a href="https://wiki.debian.org/Subkeys" class="extiw" title="debian:Subkeys">Debian:Subkeys</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/lfit/itpol/blob/master/protecting-code-integrity.md">Protecting code integrity with PGP</a></li>
<li><a rel="nofollow" class="external text" href="https://sanctum.geek.nz/arabesque/series/gnu-linux-crypto/">A more comprehensive gpg Tutorial</a></li>
<li><a rel="nofollow" class="external text" href="https://www.reddit.com/r/GPGpractice/">/r/GPGpractice - сабреддит для тренировки использования GnuPG.</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../ru/Category:Encryption.html" title="Category:Encryption (Русский)">Encryption (Русский)</a></li>
<li><a href="../ru/Category:Email.html" title="Category:Email (Русский)">Email (Русский)</a></li>
<li><a href="../ru/Category:GNU.html" title="Category:GNU (Русский)">GNU (Русский)</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=GnuPG_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=793740">https://wiki.archlinux.org/index.php?title=GnuPG_(Русский)&amp;oldid=793740</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 2 December 2023, at 07:29.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
