<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Power management (Русский)/Suspend and hibernate (Русский) - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.45.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Power_management_Русский_Suspend_and_hibernate_Русский rootpage-Power_management_Русский skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Низкоуровневый_интерфейс_(swsusp)" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%9D%D0%B8%D0%B7%D0%BA%D0%BE%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D0%B5%D0%B2%D1%8B%D0%B9_%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81_(swsusp)">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Низкоуровневый интерфейс (swsusp)</span>
			</div>
		</a>
		
		<ul id="toc-Низкоуровневый_интерфейс_(swsusp)-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Интерфейс_высокого_уровня_(systemd)" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%98%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81_%D0%B2%D1%8B%D1%81%D0%BE%D0%BA%D0%BE%D0%B3%D0%BE_%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D1%8F_(systemd)">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Интерфейс высокого уровня (systemd)</span>
			</div>
		</a>
		
		<ul id="toc-Интерфейс_высокого_уровня_(systemd)-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Изменение_режима_сна" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%98%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D1%80%D0%B5%D0%B6%D0%B8%D0%BC%D0%B0_%D1%81%D0%BD%D0%B0">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Изменение режима сна</span>
			</div>
		</a>
		
		<ul id="toc-Изменение_режима_сна-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Гибернация" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%93%D0%B8%D0%B1%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D1%8F">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Гибернация</span>
			</div>
		</a>
		
			<button aria-controls="toc-Гибернация-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Гибернация subsection</span>
			</button>
		
		<ul id="toc-Гибернация-sublist" class="vector-toc-list">
			<li id="toc-Про_размер_раздела/файла_подкачки" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D1%80%D0%BE_%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%80_%D1%80%D0%B0%D0%B7%D0%B4%D0%B5%D0%BB%D0%B0/%D1%84%D0%B0%D0%B9%D0%BB%D0%B0_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>Про размер раздела/файла подкачки</span>
				</div>
			</a>
			
			<ul id="toc-Про_размер_раздела/файла_подкачки-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Настройка_initramfs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_initramfs">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.2</span>
					<span>Настройка initramfs</span>
				</div>
			</a>
			
			<ul id="toc-Настройка_initramfs-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Передача_расположения_гибернации_в_initramfs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D0%B5%D1%80%D0%B5%D0%B4%D0%B0%D1%87%D0%B0_%D1%80%D0%B0%D1%81%D0%BF%D0%BE%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_%D0%B3%D0%B8%D0%B1%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D0%B8_%D0%B2_initramfs">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.3</span>
					<span>Передача расположения гибернации в initramfs</span>
				</div>
			</a>
			
			<ul id="toc-Передача_расположения_гибернации_в_initramfs-sublist" class="vector-toc-list">
				<li id="toc-Указание_расположения_гибернации_вручную" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%A3%D0%BA%D0%B0%D0%B7%D0%B0%D0%BD%D0%B8%D0%B5_%D1%80%D0%B0%D1%81%D0%BF%D0%BE%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F_%D0%B3%D0%B8%D0%B1%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D0%B8_%D0%B2%D1%80%D1%83%D1%87%D0%BD%D1%83%D1%8E">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.3.1</span>
					<span>Указание расположения гибернации вручную</span>
				</div>
			</a>
			
			<ul id="toc-Указание_расположения_гибернации_вручную-sublist" class="vector-toc-list">
				<li id="toc-Получение_смещения_файла_подкачки" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D1%81%D0%BC%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D1%8F_%D1%84%D0%B0%D0%B9%D0%BB%D0%B0_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.3.1.1</span>
					<span>Получение смещения файла подкачки</span>
				</div>
			</a>
			
			<ul id="toc-Получение_смещения_файла_подкачки-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Изменение_алгоритма_сжатия_образа_при_гибернации" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%98%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC%D0%B0_%D1%81%D0%B6%D0%B0%D1%82%D0%B8%D1%8F_%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%B0_%D0%BF%D1%80%D0%B8_%D0%B3%D0%B8%D0%B1%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D0%B8">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.4</span>
					<span>Изменение алгоритма сжатия образа при гибернации</span>
				</div>
			</a>
			
			<ul id="toc-Изменение_алгоритма_сжатия_образа_при_гибернации-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Использование_файла_подкачки_для_гибернации_вместе_с_zram" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%B0_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8_%D0%B4%D0%BB%D1%8F_%D0%B3%D0%B8%D0%B1%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D0%B8_%D0%B2%D0%BC%D0%B5%D1%81%D1%82%D0%B5_%D1%81_zram">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.5</span>
					<span>Использование файла подкачки для гибернации вместе с zram</span>
				</div>
			</a>
			
			<ul id="toc-Использование_файла_подкачки_для_гибернации_вместе_с_zram-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Гибернация_в_тонкий_том_LVM" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%93%D0%B8%D0%B1%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D1%8F_%D0%B2_%D1%82%D0%BE%D0%BD%D0%BA%D0%B8%D0%B9_%D1%82%D0%BE%D0%BC_LVM">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.6</span>
					<span>Гибернация в тонкий том LVM</span>
				</div>
			</a>
			
			<ul id="toc-Гибернация_в_тонкий_том_LVM-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Отключение_zswap_writeback_и_использование_подкачки_только_для_гибернации" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9E%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_zswap_writeback_%D0%B8_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8_%D1%82%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE_%D0%B4%D0%BB%D1%8F_%D0%B3%D0%B8%D0%B1%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D0%B8">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.7</span>
					<span>Отключение zswap writeback и использование подкачки только для гибернации</span>
				</div>
			</a>
			
			<ul id="toc-Отключение_zswap_writeback_и_использование_подкачки_только_для_гибернации-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Хуки_сна" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A5%D1%83%D0%BA%D0%B8_%D1%81%D0%BD%D0%B0">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Хуки сна</span>
			</div>
		</a>
		
			<button aria-controls="toc-Хуки_сна-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Хуки сна subsection</span>
			</button>
		
		<ul id="toc-Хуки_сна-sublist" class="vector-toc-list">
			<li id="toc-Пользовательские_юниты_systemd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D1%81%D0%BA%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D1%8B_systemd">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>Пользовательские юниты systemd</span>
				</div>
			</a>
			
			<ul id="toc-Пользовательские_юниты_systemd-sublist" class="vector-toc-list">
				<li id="toc-Комбинированный_юнит" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9A%D0%BE%D0%BC%D0%B1%D0%B8%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B9_%D1%8E%D0%BD%D0%B8%D1%82">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1.1</span>
					<span>Комбинированный юнит</span>
				</div>
			</a>
			
			<ul id="toc-Комбинированный_юнит-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Хуки_в_/usr/lib/systemd/system-sleep" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A5%D1%83%D0%BA%D0%B8_%D0%B2_/usr/lib/systemd/system-sleep">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2</span>
					<span>Хуки в /usr/lib/systemd/system-sleep</span>
				</div>
			</a>
			
			<ul id="toc-Хуки_в_/usr/lib/systemd/system-sleep-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Советы_и_рекомендации" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A1%D0%BE%D0%B2%D0%B5%D1%82%D1%8B_%D0%B8_%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D0%B0%D1%86%D0%B8%D0%B8">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Советы и рекомендации</span>
			</div>
		</a>
		
			<button aria-controls="toc-Советы_и_рекомендации-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Советы и рекомендации subsection</span>
			</button>
		
		<ul id="toc-Советы_и_рекомендации-sublist" class="vector-toc-list">
			<li id="toc-Автоматическая_разблокировка_при_пробуждении_в_доверенных_местах" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%90%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F_%D1%80%D0%B0%D0%B7%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D1%80%D0%B8_%D0%BF%D1%80%D0%BE%D0%B1%D1%83%D0%B6%D0%B4%D0%B5%D0%BD%D0%B8%D0%B8_%D0%B2_%D0%B4%D0%BE%D0%B2%D0%B5%D1%80%D0%B5%D0%BD%D0%BD%D1%8B%D1%85_%D0%BC%D0%B5%D1%81%D1%82%D0%B0%D1%85">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.1</span>
					<span>Автоматическая разблокировка при пробуждении в доверенных местах</span>
				</div>
			</a>
			
			<ul id="toc-Автоматическая_разблокировка_при_пробуждении_в_доверенных_местах-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Полное_отключение_сна" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D0%BE%D0%BB%D0%BD%D0%BE%D0%B5_%D0%BE%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D1%81%D0%BD%D0%B0">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.2</span>
					<span>Полное отключение сна</span>
				</div>
			</a>
			
			<ul id="toc-Полное_отключение_сна-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Технология_Intel_Rapid_Start_(IRST)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A2%D0%B5%D1%85%D0%BD%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D1%8F_Intel_Rapid_Start_(IRST)">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.3</span>
					<span>Технология Intel Rapid Start (IRST)</span>
				</div>
			</a>
			
			<ul id="toc-Технология_Intel_Rapid_Start_(IRST)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Отслеживание_заряда_батареи_во_время_сна" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9E%D1%82%D1%81%D0%BB%D0%B5%D0%B6%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B7%D0%B0%D1%80%D1%8F%D0%B4%D0%B0_%D0%B1%D0%B0%D1%82%D0%B0%D1%80%D0%B5%D0%B8_%D0%B2%D0%BE_%D0%B2%D1%80%D0%B5%D0%BC%D1%8F_%D1%81%D0%BD%D0%B0">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.4</span>
					<span>Отслеживание заряда батареи во время сна</span>
				</div>
			</a>
			
			<ul id="toc-Отслеживание_заряда_батареи_во_время_сна-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Решение_проблем" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#%D0%A0%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">7</span>
				<span>Решение проблем</span>
			</div>
		</a>
		
			<button aria-controls="toc-Решение_проблем-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Решение проблем subsection</span>
			</button>
		
		<ul id="toc-Решение_проблем-sublist" class="vector-toc-list">
			<li id="toc-ACPI_OS_NAME" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ACPI_OS_NAME">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.1</span>
					<span>ACPI_OS_NAME</span>
				</div>
			</a>
			
			<ul id="toc-ACPI_OS_NAME-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Ждущий_или_спящий_режим_не_работает_или_сбоит" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%96%D0%B4%D1%83%D1%89%D0%B8%D0%B9_%D0%B8%D0%BB%D0%B8_%D1%81%D0%BF%D1%8F%D1%89%D0%B8%D0%B9_%D1%80%D0%B5%D0%B6%D0%B8%D0%BC_%D0%BD%D0%B5_%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82_%D0%B8%D0%BB%D0%B8_%D1%81%D0%B1%D0%BE%D0%B8%D1%82">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.2</span>
					<span>Ждущий или спящий режим не работает или сбоит</span>
				</div>
			</a>
			
			<ul id="toc-Ждущий_или_спящий_режим_не_работает_или_сбоит-sublist" class="vector-toc-list">
				<li id="toc-Ошибки_устройств_USB" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#%D0%9E%D1%88%D0%B8%D0%B1%D0%BA%D0%B8_%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2_USB">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.2.1</span>
					<span>Ошибки устройств USB</span>
				</div>
			</a>
			
			<ul id="toc-Ошибки_устройств_USB-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Wake-on-LAN" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Wake-on-LAN">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.3</span>
					<span>Wake-on-LAN</span>
				</div>
			</a>
			
			<ul id="toc-Wake-on-LAN-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Система_мгновенно_пробуждается_из_ждущего_режима" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0_%D0%BC%D0%B3%D0%BD%D0%BE%D0%B2%D0%B5%D0%BD%D0%BD%D0%BE_%D0%BF%D1%80%D0%BE%D0%B1%D1%83%D0%B6%D0%B4%D0%B0%D0%B5%D1%82%D1%81%D1%8F_%D0%B8%D0%B7_%D0%B6%D0%B4%D1%83%D1%89%D0%B5%D0%B3%D0%BE_%D1%80%D0%B5%D0%B6%D0%B8%D0%BC%D0%B0">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.4</span>
					<span>Система мгновенно пробуждается из ждущего режима</span>
				</div>
			</a>
			
			<ul id="toc-Система_мгновенно_пробуждается_из_ждущего_режима-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Система_не_выключается_после_перехода_в_спящий_режим" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0_%D0%BD%D0%B5_%D0%B2%D1%8B%D0%BA%D0%BB%D1%8E%D1%87%D0%B0%D0%B5%D1%82%D1%81%D1%8F_%D0%BF%D0%BE%D1%81%D0%BB%D0%B5_%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4%D0%B0_%D0%B2_%D1%81%D0%BF%D1%8F%D1%89%D0%B8%D0%B9_%D1%80%D0%B5%D0%B6%D0%B8%D0%BC">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.5</span>
					<span>Система не выключается после перехода в спящий режим</span>
				</div>
			</a>
			
			<ul id="toc-Система_не_выключается_после_перехода_в_спящий_режим-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Операционная_система_не_найдена_(или_загружается_не_та_ОС)_при_включении_после_спящего_режима" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9E%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%B0%D1%8F_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0_%D0%BD%D0%B5_%D0%BD%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D0%B0_(%D0%B8%D0%BB%D0%B8_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B6%D0%B0%D0%B5%D1%82%D1%81%D1%8F_%D0%BD%D0%B5_%D1%82%D0%B0_%D0%9E%D0%A1)_%D0%BF%D1%80%D0%B8_%D0%B2%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B8_%D0%BF%D0%BE%D1%81%D0%BB%D0%B5_%D1%81%D0%BF%D1%8F%D1%89%D0%B5%D0%B3%D0%BE_%D1%80%D0%B5%D0%B6%D0%B8%D0%BC%D0%B0">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.6</span>
					<span>Операционная система не найдена (или загружается не та ОС) при включении после спящего режима</span>
				</div>
			</a>
			
			<ul id="toc-Операционная_система_не_найдена_(или_загружается_не_та_ОС)_при_включении_после_спящего_режима-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Файл_подкачки_в_/home" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A4%D0%B0%D0%B9%D0%BB_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8_%D0%B2_/home">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.7</span>
					<span>Файл подкачки в /home</span>
				</div>
			</a>
			
			<ul id="toc-Файл_подкачки_в_/home-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-ПК_не_пробуждается_из_сна_на_материнских_платах_A520I_и_B550I" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%9F%D0%9A_%D0%BD%D0%B5_%D0%BF%D1%80%D0%BE%D0%B1%D1%83%D0%B6%D0%B4%D0%B0%D0%B5%D1%82%D1%81%D1%8F_%D0%B8%D0%B7_%D1%81%D0%BD%D0%B0_%D0%BD%D0%B0_%D0%BC%D0%B0%D1%82%D0%B5%D1%80%D0%B8%D0%BD%D1%81%D0%BA%D0%B8%D1%85_%D0%BF%D0%BB%D0%B0%D1%82%D0%B0%D1%85_A520I_%D0%B8_B550I">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.8</span>
					<span>ПК не пробуждается из сна на материнских платах A520I и B550I</span>
				</div>
			</a>
			
			<ul id="toc-ПК_не_пробуждается_из_сна_на_материнских_платах_A520I_и_B550I-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Fn-кнопка_сна_на_ноутбуке_не_работает" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Fn-%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D0%B0_%D1%81%D0%BD%D0%B0_%D0%BD%D0%B0_%D0%BD%D0%BE%D1%83%D1%82%D0%B1%D1%83%D0%BA%D0%B5_%D0%BD%D0%B5_%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.9</span>
					<span>Fn-кнопка сна на ноутбуке не работает</span>
				</div>
			</a>
			
			<ul id="toc-Fn-кнопка_сна_на_ноутбуке_не_работает-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Система_зависает_на_60_секунд,_а_затем_просыпается_или_зависает_после_пробуждения" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0_%D0%B7%D0%B0%D0%B2%D0%B8%D1%81%D0%B0%D0%B5%D1%82_%D0%BD%D0%B0_60_%D1%81%D0%B5%D0%BA%D1%83%D0%BD%D0%B4,_%D0%B0_%D0%B7%D0%B0%D1%82%D0%B5%D0%BC_%D0%BF%D1%80%D0%BE%D1%81%D1%8B%D0%BF%D0%B0%D0%B5%D1%82%D1%81%D1%8F_%D0%B8%D0%BB%D0%B8_%D0%B7%D0%B0%D0%B2%D0%B8%D1%81%D0%B0%D0%B5%D1%82_%D0%BF%D0%BE%D1%81%D0%BB%D0%B5_%D0%BF%D1%80%D0%BE%D0%B1%D1%83%D0%B6%D0%B4%D0%B5%D0%BD%D0%B8%D1%8F">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.10</span>
					<span>Система зависает на 60 секунд, а затем просыпается или зависает после пробуждения</span>
				</div>
			</a>
			
			<ul id="toc-Система_зависает_на_60_секунд,_а_затем_просыпается_или_зависает_после_пробуждения-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Спящий_режим_при_использовании_нескольких_операционных_систем" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#%D0%A1%D0%BF%D1%8F%D1%89%D0%B8%D0%B9_%D1%80%D0%B5%D0%B6%D0%B8%D0%BC_%D0%BF%D1%80%D0%B8_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B8_%D0%BD%D0%B5%D1%81%D0%BA%D0%BE%D0%BB%D1%8C%D0%BA%D0%B8%D1%85_%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D1%8B%D1%85_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.11</span>
					<span>Спящий режим при использовании нескольких операционных систем</span>
				</div>
			</a>
			
			<ul id="toc-Спящий_режим_при_использовании_нескольких_операционных_систем-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar no-font-mode-scale">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Power management (Русский)/Suspend and hibernate (Русский)</span></h1>
							
</header>
				<div class="vector-column-end no-font-mode-scale">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <bdi dir="ltr"><a href="../../ru/Power_management.html" title="Power management (Русский)">Power management (Русский)</a></bdi>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="ru" dir="ltr">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Состояние перевода:</strong> На этой странице представлен перевод статьи <a href="../../en/Power_management/Suspend_and_hibernate.html" title="Power management/Suspend and hibernate">Power management/Suspend and hibernate</a>. Дата последней синхронизации: 26 января 2026. Вы можете <a href="../../ru/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Русский)">помочь</a> синхронизировать перевод, если в английской версии произошли <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Power_management/Suspend_and_hibernate&amp;diff=0&amp;oldid=856370">изменения</a>.</div>
<div class="archwiki-template-meta-related-articles">
<p>Ссылки по теме</p>
<ul>
<li><a href="../../ru/Systemd.html" title="Systemd (Русский)">systemd (Русский)</a></li>
<li><a href="../../en/ff5e702357518ad44291a7999064a5d0.html" class="mw-redirect" title="Управление питанием">Управление питанием</a></li>
<li><a href="../../en/Wakeup_triggers.html" class="mw-redirect" title="Wakeup triggers">Wakeup triggers</a></li>
<li><a href="../../en/f197186ea8e844202fd9d3c3b6c8dd6f.html" class="mw-redirect" title="Пространство подкачки">Пространство подкачки</a></li>
</ul>
</div>
<p>Существует <a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/pm/sleep-states.html">несколько режимов</a> приостановки работы компьютера, в частности:
</p>
<dl>
<dt>Suspend to idle</dt>
<dd>Intel называет его <a rel="nofollow" class="external text" href="https://www.intel.com/content/www/us/en/docs/vtune-profiler/user-guide/2023-0/s0ix-states.html">S0ix</a>, Microsoft — <a rel="nofollow" class="external text" href="https://docs.microsoft.com/en-us/windows-hardware/design/device-experiences/modern-standby">Modern Standby</a> (ранее «Connected Standby»), а ядро — <a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/pm/sleep-states.html#suspend-to-idle">S2Idle</a>. Предназначен для использования вместо <a href="https://en.wikipedia.org/wiki/ru:ACPI#.D0.93.D0.BB.D0.BE.D0.B1.D0.B0.D0.BB.D1.8C.D0.BD.D1.8B.D0.B5_.D1.81.D0.BE.D1.81.D1.82.D0.BE.D1.8F.D0.BD.D0.B8.D1.8F" class="extiw" title="wikipedia:ru:ACPI">состояния S3</a> в поддерживаемых системах, обеспечивая идентичное энергосбережение, но значительно сокращая время пробуждения. <div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет</strong> Хотя в <a rel="nofollow" class="external text" href="https://www.dell.com/support/kbdoc/en-us/000143524/the-battery-drains-quicker-than-expected-on-a-dell-notebook-with-modern-standby-mode-enabled">Windows</a> или <a rel="nofollow" class="external text" href="https://support.apple.com/guide/mac-help/mh40773/mac">macOS</a> это состояние может привести к разряду батареи, поскольку они могут пробуждать устройства для подключения к сети, Linux эту функцию в настоящее время не использует и не должен быть подвержен этой проблеме.</div>
</dd>
<dt>Suspend to RAM (ждущий режим)</dt>
<dd>Состояние <b>S3</b> по определению ACPI. Отключает питание большинства устройств компьютера, кроме оперативной памяти, которая продолжает хранить в себе состояние компьютера для его восстановления при пробуждении. Из-за большой экономии энергии рекомендуется, чтобы ноутбуки автоматически входили в этот режим при работе от батареи и закрытой крышке (или когда пользователь неактивен в течение некоторого времени).</dd>
<dt>Suspend to disk (спящий режим, гибернация)</dt>
<dd>Состояние <b>S4</b> по определению ACPI. Сохраняет состояние машины в <a href="../../ru/Swap.html" title="Swap (Русский)">подкачку</a> и полностью выключает её. При включении питания состояние восстанавливается. До этого момента энергопотребление равно <a href="https://en.wikipedia.org/wiki/Standby_power" class="extiw" title="wikipedia:Standby power">нулю</a>.</dd>
<dt>Hybrid suspend (гибридный спящий режим)</dt>
<dd>Гибрид ждущего и спящего режимов, иногда называется <b>suspend to both</b>. Сохраняет состояние машины в подкачку, но не выключает её. Вместо этого выполняется переход в обычный ждущий режим. Поэтому, если батарея не разряжена, система может возобновить работу мгновенно. Если батарея разряжена, система может восстановить своё состояние с диска, что намного медленнее, чем возобновление работы из ОЗУ, но состояние не будет потеряно.</dd>
</dl>
<p>Ядро обеспечивает базовые функции, а некоторые интерфейсы высокого уровня выполняют дополнительные действия для обработки проблемных аппаратных драйверов / модулей ядра (например, повторная инициализация видеокарты).
</p>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Низкоуровневый_интерфейс_(swsusp)">
<span id=".D0.9D.D0.B8.D0.B7.D0.BA.D0.BE.D1.83.D1.80.D0.BE.D0.B2.D0.BD.D0.B5.D0.B2.D1.8B.D0.B9_.D0.B8.D0.BD.D1.82.D0.B5.D1.80.D1.84.D0.B5.D0.B9.D1.81_.28swsusp.29"></span>Низкоуровневый интерфейс (swsusp)</h2></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание</strong> Хотя интерфейс ядра можно использовать напрямую (и это будет работать быстрее, поскольку не выполняется дополнительная обработка в userspace), рекомендуется использовать <a href="#%D0%98%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81_%D0%B2%D1%8B%D1%81%D0%BE%D0%BA%D0%BE%D0%B3%D0%BE_%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D1%8F_(systemd)">интерфейс высокого уровня</a>. Он лучше справляется с выполнением дополнительных проверок безопасности, а также предоставляет механизмы хуков, которые помогают наладить работу системы перед сном и после него: например, настроить аппаратные часы, восстановить подключение к беспроводной сети и т. д.</div>
<p>Можно отправить сигнал перехода в сон напрямую во встроенный в ядро программный код (swsusp); точный метод и состояние зависят от уровня аппаратной поддержки. В современных ядрах основным механизмом является запись соответствующих значений в <code>/sys/power/state</code>.
</p>
<p>Смотрите <a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/pm/sleep-states.html#basic-sysfs-interfaces-for-system-suspend-and-hibernation">документацию ядра</a> для подробностей.
</p>
<div class="mw-heading mw-heading2"><h2 id="Интерфейс_высокого_уровня_(systemd)">
<span id=".D0.98.D0.BD.D1.82.D0.B5.D1.80.D1.84.D0.B5.D0.B9.D1.81_.D0.B2.D1.8B.D1.81.D0.BE.D0.BA.D0.BE.D0.B3.D0.BE_.D1.83.D1.80.D0.BE.D0.B2.D0.BD.D1.8F_.28systemd.29"></span>Интерфейс высокого уровня (systemd)</h2></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание</strong> Задача интерфейса высокого уровня — предоставить программы и скрипты, которые могут быть запущены для перехода в сон, а также способы выполнения дополнительных действий перед переходом в сон и после пробуждения из сна. Для автоматического перехода в сон по нажатию кнопок питания, щелчкам в меню или событиям, связанным с крышкой ноутбука, обратитесь к разделу <a href="../../en/ff5e702357518ad44291a7999064a5d0.html#%D0%A1%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D1%8F_ACPI" class="mw-redirect" title="Управление питанием">Управление питанием#События ACPI</a>.</div>
<p><a href="../../ru/Systemd.html" title="Systemd (Русский)">systemd</a> предоставляет собственные команды для ждущего, спящего и гибридного режимов сна. Это интерфейс, используемый в Arch Linux по умолчанию.
</p>
<p>Команда <code>systemctl suspend</code> должна работать из коробки. Для <code>systemctl hibernate</code> может понадобиться предварительная настройка, описанная в разделе <a href="#%D0%93%D0%B8%D0%B1%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D1%8F">#Гибернация</a>.
</p>
<p>Также есть ещё два режима, комбинирующих ждущий и спящий режимы:
</p>
<ul>
<li>
<code>systemctl hybrid-sleep</code> сохраняет состояние системы одновременно и в оперативной памяти, и на диске, благодаря чему отключение питания не приводит к потере данных. Этот режим также называют <i>suspend to both</i>.</li>
<li>
<code>systemctl suspend-then-hibernate</code> изначально переводит систему в ждущий режим на максимально возможное время, затем по сигналу от аппаратных часов она просыпается и переходит в гибернацию. Время срабатывания аппаратных часов указывается в настройке <code>HibernateDelaySec</code> в файле <span class="plainlinks archwiki-template-man" title="$ man 5 systemd-sleep.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-sleep.conf.5">systemd-sleep.conf(5)</a></span>. Значение по умолчанию вычисляется на основе скорости разряда батареи так, чтобы к моменту пробуждения оставалось 5% заряда; если батареи нет, то значение по умолчанию 2 часа. Вычисление производится на основе измерения уровня заряда батареи после времени, указанного в настройке <code>SuspendEstimationSec</code> в <span class="plainlinks archwiki-template-man" title="$ man 5 systemd-sleep.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-sleep.conf.5">systemd-sleep.conf(5)</a></span>: после истечения указанного времени система ненадолго проснётся для выполнения измерения (измерение также производится при пробуждении пользователем).</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет</strong> systemd с версии 256 поддерживает автоматический выбор наиболее подходящего режима сна с помощью новой команды <code>systemctl sleep</code>. По умолчанию она пытается использовать <code>suspend-then-hibernate</code>, в случае отсутствия его поддержки пробует <code>suspend</code>, а если не поддерживается и он, то <code>hibernate</code>. Смотрите <span class="plainlinks archwiki-template-man" title="$ man 1 systemctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemctl.1">systemctl(1)</a></span> для более подробной информации.</div>
<p>Смотрите раздел <a href="#%D0%A5%D1%83%D0%BA%D0%B8_%D1%81%D0%BD%D0%B0">#Хуки сна</a> для получения дополнительной информации о настройке хуков, связанных с режимами сна. Также смотрите <span class="plainlinks archwiki-template-man" title="$ man 1 systemctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemctl.1">systemctl(1)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-sleep"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-sleep.8">systemd-sleep(8)</a></span> и <span class="plainlinks archwiki-template-man" title="$ man 7 systemd.special"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.special.7">systemd.special(7)</a></span>.
</p>
<div class="mw-heading mw-heading2"><h2 id="Изменение_режима_сна">
<span id=".D0.98.D0.B7.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D1.80.D0.B5.D0.B6.D0.B8.D0.BC.D0.B0_.D1.81.D0.BD.D0.B0"></span>Изменение режима сна</h2></div>
<p>В системах, где режим S0ix не обеспечивает такой же экономии энергии, как обычный ждущий режим S3, или когда экономия энергии предпочтительнее быстрого возобновления работы, возможно изменение режима сна, используемого по умолчанию.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет</strong> S0ix призван обеспечивать такую же или лучшую экономию энергии, как и S3. Для проверки, сможете вы заставить его работать как задумано, смотрите записи в блоге Intel: <a rel="nofollow" class="external text" href="https://web.archive.org/web/20230614200816/https://01.org/blogs/qwang59/2018/how-achieve-s0ix-states-linux">How to achieve S0ix states in Linux</a>, <a rel="nofollow" class="external text" href="https://web.archive.org/web/20230614200306/https://01.org/blogs/qwang59/2020/linux-s0ix-troubleshooting">Linux S0ix Troubleshooting</a> и <a rel="nofollow" class="external text" href="https://web.archive.org/web/20230503102522/https://01.org/blogs/thac0/2019/idling-efficiently-linux-case-study">Idling Efficiently on Linux: A Case Study</a>. Пользователи систем Intel могут использовать <a rel="nofollow" class="external text" href="https://github.com/intel/S0ixSelftestTool">S0ixSelftestTool</a>. Пользователи систем AMD могут использовать <a rel="nofollow" class="external text" href="https://git.kernel.org/pub/scm/linux/kernel/git/superm1/amd-debug-tools.git/about/">amd-debug-tools</a>.</div>
<p>Выполните следующую команду, чтобы увидеть все режимы, о поддержке которых заявляет оборудование (текущий режим показан в квадратных скобках<a rel="nofollow" class="external autonumber" href="https://docs.kernel.org/admin-guide/pm/sleep-states.html#basic-sysfs-interfaces-for-system-suspend-and-hibernation">[1]</a>):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ cat /sys/power/mem_sleep</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[s2idle] shallow deep
</pre>
<table class="wikitable sortable">
<caption>Поддерживаемые режимы сна в mem_sleep
</caption>
<tbody>
<tr>
<th>Строка в mem_sleep</th>
<th>Режим сна
</th>
</tr>
<tr>
<td>s2idle</td>
<td>
<a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/pm/sleep-states.html#suspend-to-idle">suspend-to-idle</a>
</td>
</tr>
<tr>
<td>shallow</td>
<td>
<a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/pm/sleep-states.html#standby">standby</a>
</td>
</tr>
<tr>
<td>deep</td>
<td>
<a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/pm/sleep-states.html#suspend-to-ram">suspend-to-RAM</a>
</td>
</tr>
</tbody>
</table>
<p>Если <code>deep</code> отсутствует, для начала проверьте, нет ли в UEFI каких-нибудь настроек для него, обычно в разделе <i>Power</i> или <i>Sleep state</i> или похожей формулировке, с опциями <i>Windows 10</i>, <i>Windows and Linux</i> или <i>S3/Modern standby support</i> для режима S0ix, и <i>Legacy</i>, <i>Linux</i>, <i>Linux S3</i> или <i>S3 enabled</i> для режима S3. В противном случае можно продолжать использовать <code>s2idle</code>, рассмотрите возможность использования <a href="#%D0%93%D0%B8%D0%B1%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D1%8F">гибернации</a> (спящего режима) или исправления таблицы <a href="../../en/DSDT.html" title="DSDT">DSDT</a> (или поиска исправленной версии в интернете).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание</strong> Последнее решение, скорее всего, вызовет проблемы. Производители перестали исправлять ошибки режима S3 с тех пор, как системы, поставляемые с Windows, стали по умолчанию использовать «Modern standby»; если они сами не предлагают этот режим, то, вероятно, он сломан.</div>
<p>Убедитесь, что оборудование не испытывает проблем с режимом S3, протестировав несколько циклов сна после изменения режима:
</p>
<pre># echo deep &gt; /sys/power/mem_sleep
</pre>
<p>Если проблем не обнаружено, можно сделать изменение постоянным с помощью параметра <code>MemorySleepMode</code> в <span class="plainlinks archwiki-template-man" title="$ man 5 systemd-sleep.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-sleep.conf.5">systemd-sleep.conf(5)</a></span>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/sleep.conf.d/mem-deep.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Sleep]
MemorySleepMode=deep</pre>
<p>или с помощью <a href="../../ru/Kernel_parameters.html" title="Kernel parameters (Русский)">параметра ядра</a> <code>mem_sleep_default=deep</code>.
</p>
<p>Иногда сломанная прошивка сообщает о поддержке <code>deep</code>, в то время как реально поддерживается только <code>s2idle</code>. В этом случае альтернативный способ использования <code>s2idle</code> доступен через параметр <code>SuspendState</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/sleep.conf.d/freeze.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Sleep]
SuspendState=freeze</pre>
<div class="mw-heading mw-heading2"><h2 id="Гибернация">
<span id=".D0.93.D0.B8.D0.B1.D0.B5.D1.80.D0.BD.D0.B0.D1.86.D0.B8.D1.8F"></span>Гибернация</h2></div>
<p>Чтобы использовать спящий режим, вам нужно создать <a href="../../ru/Swap.html" title="Swap (Русский)">раздел или файл подкачки</a>, <a href="#%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0_initramfs">настроить initramfs</a> так, чтобы процесс возобновления был инициирован в раннем пользовательском пространстве, и указать местоположение подкачки способом, доступным для initramfs, например, через переменную EFI <code>HibernateLocation</code>, которую создаст <a href="../../ru/Systemd.html" title="Systemd (Русский)">systemd</a>, или <a href="../../en/53f6a00c51bbf4759ba613a818c9284c.html" class="mw-redirect" title="Параметр ядра">параметр ядра</a> <code>resume=</code>. Эти три этапа подробно описаны ниже.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание</strong> 
<ul>
<li>Если вы используете <a href="../../ru/Data-at-rest_encryption.html" title="Data-at-rest encryption (Русский)">шифрование</a>, смотрите <a href="../../ru/Dm-crypt/Swap_encryption.html#%D0%A1_%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%BA%D0%BE%D0%B9_%D0%B3%D0%B8%D0%B1%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D0%B8" title="Dm-crypt (Русский)/Swap encryption (Русский)">dm-crypt (Русский)/Swap encryption (Русский)#С поддержкой гибернации</a>.</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-hardened">linux-hardened</a></span> не поддерживает спящий режим, смотрите <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/63648">FS#63648</a>.</li>
<li>
<a href="../../ru/Zram.html#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B2_%D0%BA%D0%B0%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%B5_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8" title="Zram (Русский)">Подкачка в zram</a> не поддерживается, даже если zram настроен на использование резервного устройства в постоянной памяти. Хотя <i>logind</i> предотвратит попытки перехода в спящий режим с подкачкой на zram, в качестве альтернативы можно создать несколько подкачек. Память будет сохраняться в файл подкачки, а другое доступное пространство подкачки будет зарезервировано для zram. Подробнее в разделе <a href="#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%B0_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8_%D0%B4%D0%BB%D1%8F_%D0%B3%D0%B8%D0%B1%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D0%B8_%D0%B2%D0%BC%D0%B5%D1%81%D1%82%D0%B5_%D1%81_zram">#Использование файла подкачки для гибернации вместе с zram</a>.</li>
</ul>
</div>
<div class="mw-heading mw-heading3"><h3 id="Про_размер_раздела/файла_подкачки">
<span id=".D0.9F.D1.80.D0.BE_.D1.80.D0.B0.D0.B7.D0.BC.D0.B5.D1.80_.D1.80.D0.B0.D0.B7.D0.B4.D0.B5.D0.BB.D0.B0.2F.D1.84.D0.B0.D0.B9.D0.BB.D0.B0_.D0.BF.D0.BE.D0.B4.D0.BA.D0.B0.D1.87.D0.BA.D0.B8"></span>Про размер раздела/файла подкачки</h3></div>
<p>Даже если ваш раздел подкачки меньше ОЗУ, всё ещё еще есть большая вероятность успешно перейти в спящий режим. Согласно <a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/pm/sleep-states.html?highlight=image_size#basic-sysfs-interfaces-for-system-suspend-and-hibernation">документации ядра</a>:
</p>
<dl><dd>
<code>/sys/power/image_size</code> управляет размером образа, создаваемого механизмом приостановки на диск. Это может быть строка, представляющая неотрицательное целое число, которое будет использоваться в качестве верхнего предела размера образа в байтах. Механизм приостановки сделает всё возможное, чтобы размер образа не превышал это число. Однако, если это окажется невозможным, он всё равно попытается приостановить систему, используя наименьший возможный размер образа. В частности, если в этот файл записать «0», размер образа будет настолько мал, насколько это возможно. Чтение из этого файла отображает текущее ограничение размера образа, которое по умолчанию установлено на 2/5 доступного ОЗУ.</dd></dl>
<p>Вы можете либо уменьшить значение <code>/sys/power/image_size</code>, чтобы сделать образ как можно меньшим (для небольших разделов подкачки) или увеличить его, чтобы ускорить процесс гибернации.
На системах с большим объёмом оперативной памяти меньшие значения могут существенно увеличить скорость пробуждения. Чтобы сделать изменение постоянным, можно использовать <a href="../../ru/Systemd.html#systemd-tmpfiles_%E2%80%94_%D0%B2%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D1%8B" title="Systemd (Русский)">systemd-tmpfiles</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tmpfiles.d/hibernation_image_size.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#    Path                   Mode UID  GID  Age Argument
w    /sys/power/image_size  -    -    -    -   0
</pre>
<p>Создаваемый образ не может охватывать несколько разделов/файлов подкачки. Он должен полностью помещаться в один раздел/файл подкачки.<a rel="nofollow" class="external autonumber" href="https://docs.kernel.org/power/swsusp.html">[2]</a>
</p>
<div class="mw-heading mw-heading3"><h3 id="Настройка_initramfs">
<span id=".D0.9D.D0.B0.D1.81.D1.82.D1.80.D0.BE.D0.B9.D0.BA.D0.B0_initramfs"></span>Настройка initramfs</h3></div>
<ul><li>Когда используется initramfs с хуком <code>systemd</code> (по умолчанию это так), механизм возобновления уже есть и дополнительные хуки не нужны.</li></ul>
<ul><li>Когда используется <a href="../../ru/Initramfs.html" class="mw-redirect" title="Initramfs (Русский)">initramfs</a> основанный на busybox, с хуком <code>base</code>, в файл <code>/etc/mkinitcpio.conf</code> нужно добавить хук <code>resume</code>. Независимо от того, используется ли метка или UUID, раздел подкачки идентифицируется как устройство udev, поэтому хук <code>resume</code> должен идти <i>после</i> хука <code>udev</code>. Пример, основанный на стандартных параметрах хуков (до включения хука systemd по умолчанию):</li></ul>
<dl><dd><pre>HOOKS=(base udev autodetect microcode modconf kms keyboard keymap consolefont block filesystems <b>resume</b> fsck)</pre></dd></dl>
<dl><dd>Не забудьте <a href="../../ru/Mkinitcpio.html#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BE%D1%87%D0%BD%D0%BE%D0%B3%D0%BE_%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%B0" title="Mkinitcpio (Русский)">пересобрать образ initramfs</a> чтобы эти изменения вступили в силу.</dd></dl>
<dl><dd><div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание</strong> Если доступ к подкачке выполняется через стековые блочные устройства, например, <a href="../../ru/Dm-crypt.html" title="Dm-crypt (Русский)">dm-crypt</a>, <a href="../../ru/RAID.html" class="mw-redirect" title="RAID (Русский)">RAID</a> или <a href="../../ru/LVM.html" class="mw-redirect" title="LVM (Русский)">LVM</a>, конечное устройство должно быть доступно в раннем пользовательском пространстве и до начала процесса возобновления. То есть в таких установках хук <code>resume</code> должен располагаться после соответствующих хуков, таких как <code>encrypt</code>, <code>lvm2</code> и т. д.</div></dd></dl>
<div class="mw-heading mw-heading3"><h3 id="Передача_расположения_гибернации_в_initramfs">
<span id=".D0.9F.D0.B5.D1.80.D0.B5.D0.B4.D0.B0.D1.87.D0.B0_.D1.80.D0.B0.D1.81.D0.BF.D0.BE.D0.BB.D0.BE.D0.B6.D0.B5.D0.BD.D0.B8.D1.8F_.D0.B3.D0.B8.D0.B1.D0.B5.D1.80.D0.BD.D0.B0.D1.86.D0.B8.D0.B8_.D0.B2_initramfs"></span>Передача расположения гибернации в initramfs</h3></div>
<p>Когда система переходит в режим гибернации, содержимое оперативной памяти записывается в подкачку, и в нём также содержится состояние смонтированных файловых систем. Поэтому для возобновления работы из гибернации местоположение записанного содержимого памяти должно быть доступно для initramfs, то есть до монтирования корневой файловой системы.
</p>
<p>Если система загружена в режиме <a href="../../ru/Unified_Extensible_Firmware_Interface.html" title="Unified Extensible Firmware Interface (Русский)">UEFI</a>, <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-sleep"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-sleep.8">systemd-sleep(8)</a></span> автоматически выберет подходящее пространство подкачки для гибернации, и информация об используемом пространстве подкачки сохраняется в переменной EFI <code>HibernateLocation</code>. При следующей загрузке <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-hibernate-resume"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-hibernate-resume.8">systemd-hibernate-resume(8)</a></span> считывает расположение из этой переменной, и система возобновляет работу. Это означает, что выполнение описанных далее шагов необходимо только на системах с <a href="../../ru/Arch_boot_process.html#BIOS" title="Arch boot process (Русский)">BIOS</a> или если вы хотите выбрать конкретную подкачку вручную.
</p>
<div class="mw-heading mw-heading4"><h4 id="Указание_расположения_гибернации_вручную">
<span id=".D0.A3.D0.BA.D0.B0.D0.B7.D0.B0.D0.BD.D0.B8.D0.B5_.D1.80.D0.B0.D1.81.D0.BF.D0.BE.D0.BB.D0.BE.D0.B6.D0.B5.D0.BD.D0.B8.D1.8F_.D0.B3.D0.B8.D0.B1.D0.B5.D1.80.D0.BD.D0.B0.D1.86.D0.B8.D0.B8_.D0.B2.D1.80.D1.83.D1.87.D0.BD.D1.83.D1.8E"></span>Указание расположения гибернации вручную</h4></div>
<p>Можно использовать <a href="../../en/53f6a00c51bbf4759ba613a818c9284c.html" class="mw-redirect" title="Параметр ядра">параметр ядра</a> <code>resume=<i>устройство_подкачки</i></code>. В качестве устройства можно указать любые <a href="../../en/be8feb38641b6491562fb14ebc4b9dd1.html" class="mw-redirect" title="Постоянные имена для блочных устройств">постоянные имена для блочных устройств</a>, например:
</p>
<ul>
<li><code>resume=UUID=4209c845-f495-4c43-8a03-5363dd433153</code></li>
<li><code>resume="PARTLABEL=Swap partition"</code></li>
<li>
<code>resume=/dev/archVolumeGroup/archLogicalVolume</code> — если подкачка расположена на логическом томе <a href="../../ru/LVM.html" class="mw-redirect" title="LVM (Русский)">LVM</a> (UUID и Label тоже должны работать)</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание</strong> Если доступ к подкачке выполняется через стековые блочные устройства, например, зашифрованный контейнер (LUKS), RAID или LVM, параметр <code>resume=</code> должен указывать на конечное/разблокированное устройство, непосредственно содержащее файловую систему с файлом подкачки (также смотрите совет ниже).</div>
<p>Параметры ядра вступят в силу только после перезагрузки. Для немедленного перехода в спящий режим получите из <a href="../../ru/Device_file.html#lsblk" title="Device file (Русский)">lsblk</a> major и minor номера устройства, на котором находится нужный том, и запишите их в формате <code><i>major</i>:<i>minor</i></code> в <code>/sys/power/resume</code>.
</p>
<p>Например, если устройство подкачки имеет номер <code>8:3</code>:
</p>
<pre># echo <i>8:3</i> &gt; /sys/power/resume
</pre>
<p>Если используется файл подкачки, также выполните шаги, описанные в разделе <a href="#%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D1%81%D0%BC%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D1%8F_%D1%84%D0%B0%D0%B9%D0%BB%D0%B0_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8">#Получение смещения файла подкачки</a>.
</p>
<div class="mw-heading mw-heading5"><h5 id="Получение_смещения_файла_подкачки">
<span id=".D0.9F.D0.BE.D0.BB.D1.83.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D1.81.D0.BC.D0.B5.D1.89.D0.B5.D0.BD.D0.B8.D1.8F_.D1.84.D0.B0.D0.B9.D0.BB.D0.B0_.D0.BF.D0.BE.D0.B4.D0.BA.D0.B0.D1.87.D0.BA.D0.B8"></span>Получение смещения файла подкачки</h5></div>
<p>Чтобы использовать <a href="../../ru/Swap.html#%D0%A4%D0%B0%D0%B9%D0%BB_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8" title="Swap (Русский)">файл подкачки</a> для гибернации, нужно в <a href="../../ru/Kernel_parameters.html" title="Kernel parameters (Русский)">параметре ядра</a> <code>resume=</code> указать устройство, содержащее файловую систему, в которой находится этот файл подкачки, а также добавить ещё один параметр <code>resume_offset=</code>, содержащий физическое смещение файла подкачки. <a rel="nofollow" class="external autonumber" href="https://docs.kernel.org/power/swsusp-and-swap-files.html">[3]</a>
</p>
<p>В файловых системах, отличных от <a href="../../ru/Btrfs.html" title="Btrfs (Русский)">Btrfs</a>, значение <code>resume_offset=</code> можно получить, выполнив <code>filefrag -v <i>файл_подкачки</i></code>. Вывод осуществляется в виде таблицы, а искомое значение находится в первой строке столбца <code>physical_offset</code>.
</p>
<p>Например:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># filefrag -v <i>файл_подкачки</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Filesystem type is: ef53
File size of <i>файл_подкачки</i> is 4294967296 (1048576 blocks of 4096 bytes)
 ext:     logical_offset:        physical_offset: length:   expected: flags:
   0:        0..       0:      <b>38912</b>..     38912:      1:
   1:        1..   22527:      38913..     61439:  22527:             unwritten
   2:    22528..   53247:     899072..    929791:  30720:      61440: unwritten
...
</pre>
<p>В данном примере смещение — это <code>38912</code> с двумя точками, и параметр ядра может выглядеть так: <code>resume_offset=38912</code>.
</p>
<p>Чтобы сразу получить смещение:
</p>
<pre># filefrag -v <i>файл_подкачки</i> | awk '$1=="0:" {print substr($4, 1, length($4)-2)}'
</pre>
<p>Для <a href="../../ru/Btrfs.html" title="Btrfs (Русский)">Btrfs</a> не пытайтесь использовать <i>filefrag</i>, поскольку «физическое» смещение, полученное с помощью <i>filefrag</i>, не является реальным физическим смещением на диске; здесь используется виртуальное адресное пространство ради поддержки нескольких устройств.<a rel="nofollow" class="external autonumber" href="https://bugzilla.kernel.org/show_bug.cgi?id=202803">[4]</a> Вместо этого используйте команду <span class="plainlinks archwiki-template-man" title="$ man 8 btrfs-inspect-internal"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/btrfs-inspect-internal.8">btrfs-inspect-internal(8)</a></span>. Например:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># btrfs inspect-internal map-swapfile -r <i>файл_подкачки</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">198122980
</pre>
<p>В данном примере параметр ядра может выглядеть так: <code>resume_offset=198122980</code>.
</p>
<p>Чтобы применить изменение сразу (без перезагрузки), запишите это значение в файл <code>/sys/power/resume_offset</code>. Например, если смещение равно <code>38912</code>:
</p>
<pre># echo 38912 &gt; /sys/power/resume_offset
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет</strong> Получить UUID блочного устройства, на котором находится файл подкачки, можно такой командой: <code>findmnt -no UUID -T <i>файл_подкачки</i></code>
</div>
<div class="mw-heading mw-heading3"><h3 id="Изменение_алгоритма_сжатия_образа_при_гибернации">
<span id=".D0.98.D0.B7.D0.BC.D0.B5.D0.BD.D0.B5.D0.BD.D0.B8.D0.B5_.D0.B0.D0.BB.D0.B3.D0.BE.D1.80.D0.B8.D1.82.D0.BC.D0.B0_.D1.81.D0.B6.D0.B0.D1.82.D0.B8.D1.8F_.D0.BE.D0.B1.D1.80.D0.B0.D0.B7.D0.B0_.D0.BF.D1.80.D0.B8_.D0.B3.D0.B8.D0.B1.D0.B5.D1.80.D0.BD.D0.B0.D1.86.D0.B8.D0.B8"></span>Изменение алгоритма сжатия образа при гибернации</h3></div>
<p>Начиная с Linux 6.9<a rel="nofollow" class="external autonumber" href="https://web.git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=3fec6e5961b77af6a952b77f5c2ea26f7513b216">[5]</a> можно изменить алгоритм сжатия образа памяти, сохраняемого при переходе в спящий режим. Алгоритм, используемый по умолчанию, задаётся параметром <code>CONFIG_HIBERNATION_DEF_COMP</code> во время компиляции ядра, но его можно переопределить во время работы системы.
</p>
<p>Различные алгоритмы сжатия имеют разные характеристики и могут улучшить работу спящего режима в определённых ситуациях. Например, алгоритм LZ4 обеспечивает лучшую скорость распаковки по сравнению с алгоритмом по умолчанию (LZO), что в свою очередь сокращает время пробуждения.
</p>
<p>Выбрать алгоритм сжатия можно двумя способами:
</p>
<p>1) Передав <code>hibernate.compressor</code> в качестве <a href="../../ru/Kernel_parameters.html" title="Kernel parameters (Русский)">параметра ядра</a>:
</p>
<pre>hibernate.compressor=lzo
hibernate.compressor=lz4
</pre>
<p>2) Указав алгоритм во время выполнения:
</p>
<pre># echo lzo &gt; /sys/module/hibernate/parameters/compressor
# echo lz4 &gt; /sys/module/hibernate/parameters/compressor
</pre>
<p>В настоящее время поддерживаются алгоритмы <code>lzo</code> и <code>lz4</code>, при этом LZO является алгоритмом по умолчанию.
</p>
<div class="mw-heading mw-heading3"><h3 id="Использование_файла_подкачки_для_гибернации_вместе_с_zram">
<span id=".D0.98.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D1.84.D0.B0.D0.B9.D0.BB.D0.B0_.D0.BF.D0.BE.D0.B4.D0.BA.D0.B0.D1.87.D0.BA.D0.B8_.D0.B4.D0.BB.D1.8F_.D0.B3.D0.B8.D0.B1.D0.B5.D1.80.D0.BD.D0.B0.D1.86.D0.B8.D0.B8_.D0.B2.D0.BC.D0.B5.D1.81.D1.82.D0.B5_.D1.81_zram"></span>Использование файла подкачки для гибернации вместе с zram</h3></div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет</strong> Вместо того, чтобы создавать несколько пространств подкачки как описано далее, можно <a href="#%D0%9E%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_zswap_writeback_%D0%B8_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8_%D1%82%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE_%D0%B4%D0%BB%D1%8F_%D0%B3%D0%B8%D0%B1%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D0%B8">использовать zswap</a> и при этом получить похожее поведение.</div>
<p>Если для подкачки вы используете zram, но при этом хотите, чтобы работала гибернация, можно подключить два пространства подкачки одновременно — при переходе в спящий режим <a href="../../ru/Systemd.html" title="Systemd (Русский)">systemd</a> всегда будет игнорировать блочные устройства zram <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/16708#issuecomment-1632592375">[6]</a>, поэтому поддержание обоих пространств включенными должно работать без дополнительного вмешательства.
</p>
<p>После <a href="#%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D1%81%D0%BC%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D1%8F_%D1%84%D0%B0%D0%B9%D0%BB%D0%B0_%D0%BF%D0%BE%D0%B4%D0%BA%D0%B0%D1%87%D0%BA%D0%B8">настройки файла подкачки для гибернации</a> следуйте инструкциям в статье <a href="../../ru/Zram.html" title="Zram (Русский)">zram (Русский)</a>. Убедитесь, что подкачка на zram имеет <b>более высокий приоритет</b> (например, <code>pri=100</code>).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание</strong> 
<ul>
<li>
<b>Не создавайте</b> swap-юнит в systemd на лету непосредственно перед переходом в гибернацию, это официально не поддерживается (смотрите systemd issues <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/16708">#16708</a> и <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/30083">#30083</a> на GitHub).</li>
<li>Только ядро отвечает за восстановление анонимных страниц памяти и их подкачку; отсутствие подкачки может привести к нерациональному использованию памяти. Пользователь может управлять приоритетами в задействовании (reclaiming) памяти определённых приложений с помощью параметра <code>memory.low</code> в <a href="../../en/Control_groups.html" class="mw-redirect" title="Control groups">control groups</a>. В целом это более эффективно, чем настройка параметра <a href="../../ru/Swap.html#Swappiness" title="Swap (Русский)">swappiness</a>.</li>
<li>Смотрите также <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/gorman/html/understand/understand014.html">Swap Management в документации ядра</a> и статью <a rel="nofollow" class="external text" href="https://web.archive.org/web/20200924111107/https://softdroid.net/v-zashchitu-svopa-rasprostranennye-zabluzhdeniya">В защиту свопа: распространенные заблуждения</a>.</li>
</ul>
</div>
<div class="mw-heading mw-heading3"><h3 id="Гибернация_в_тонкий_том_LVM">
<span id=".D0.93.D0.B8.D0.B1.D0.B5.D1.80.D0.BD.D0.B0.D1.86.D0.B8.D1.8F_.D0.B2_.D1.82.D0.BE.D0.BD.D0.BA.D0.B8.D0.B9_.D1.82.D0.BE.D0.BC_LVM"></span>Гибернация в тонкий том LVM</h3></div>
<p>Гибернация в тонкий том <a href="../../ru/LVM.html" class="mw-redirect" title="LVM (Русский)">LVM</a> (thinly-provisioned LVM volume) возможна, но необходимо убедиться, что том полностью выделен (fully allocated). В противном случае возобновление работы с него будет неудачным; смотрите <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/50703">FS#50703</a>.
</p>
<p>Вы можете полностью выделить том LVM, просто заполнив его нулями. Например:
</p>
<pre># dd if=/dev/zero of=/dev/vg0/swap bs=1M status=progress
</pre>
<p>Для проверки того, что том полностью выделен, можно использовать:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># lvs</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">  LV                   VG  Attr       LSize   Pool Origin    Data%  Meta%  Move Log Cpy%Sync Convert
  swap                 vg0 Vwi-aot--- 10.00g  pool           100
</pre>
<p>Полностью выделенный том будет отображаться как использующий 100% данных.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно</strong> Не используйте <a href="../../ru/Solid_state_drive.html#TRIM" title="Solid state drive (Русский)">TRIM</a> на тонких томах подкачки, используемых для спящего режима, то есть не используйте параметр <code>discard</code> в <code>/etc/fstab</code> и опцию <code>-d</code>/<code>--discard</code> в <i>swapon</i>. В противном случае используемое пространство будет деаллоцировано.</div>
<div class="mw-heading mw-heading3"><h3 id="Отключение_zswap_writeback_и_использование_подкачки_только_для_гибернации">
<span id=".D0.9E.D1.82.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_zswap_writeback_.D0.B8_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.BF.D0.BE.D0.B4.D0.BA.D0.B0.D1.87.D0.BA.D0.B8_.D1.82.D0.BE.D0.BB.D1.8C.D0.BA.D0.BE_.D0.B4.D0.BB.D1.8F_.D0.B3.D0.B8.D0.B1.D0.B5.D1.80.D0.BD.D0.B0.D1.86.D0.B8.D0.B8"></span>Отключение zswap writeback и использование подкачки только для гибернации</h3></div>
<p>По умолчанию при переполнении пула <a href="../../ru/Zswap.html" title="Zswap (Русский)">zswap</a> начинает выгружать страницы памяти в подкачку (writeback), но в Linux 6.8 появилась <a rel="nofollow" class="external text" href="https://git.kernel.org/linus/501a06fe8e4c185bbda371b8cedbdf1b23a633d8">возможность отключения writeback через cgroup</a>. В юнитах systemd это можно настроить через параметр <code>MemoryZSwapWriteback</code> (документация: <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.resource-control"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.resource-control.5#Memory_Accounting_and_Control">systemd.resource-control(5) § Memory Accounting and Control</a></span>). Можно полностью отключить writeback и предотвратить выгрузку страниц памяти в подкачку, если прописать этот параметр для всех типов юнитов. Таким образом zswap станет работать по сути как zram, но при этом подключенная подкачка позволит использовать гибернацию.
</p>
<p>Чтобы не создавать двенадцать drop-in файлов вручную (для общесистемых и пользовательских типов юнитов <code>scope</code>, <code>service</code>, <code>slice</code>, <code>socket</code>, <code>mount</code>, <code>swap</code>), можно <a href="../../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установить">установить</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zswap-disable-writeback/">zswap-disable-writeback</a></span><sup><small>AUR</small></sup>, который сделает это сам. Затем <a href="../../ru/Zswap.html#%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B8_%D0%B2%D1%8B%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_zswap" title="Zswap (Русский)">включите zswap</a> и перезагрузитесь для применения изменений.
</p>
<p>После перезагрузки запустите какую-нибудь нагружающую память задачу и проверьте, что zswap действительно ничего не записывает в подкачку:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cat /sys/kernel/debug/zswap/written_back_pages</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">0
</pre>
<div class="mw-heading mw-heading2"><h2 id="Хуки_сна">
<span id=".D0.A5.D1.83.D0.BA.D0.B8_.D1.81.D0.BD.D0.B0"></span>Хуки сна</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Пользовательские_юниты_systemd">
<span id=".D0.9F.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D1.82.D0.B5.D0.BB.D1.8C.D1.81.D0.BA.D0.B8.D0.B5_.D1.8E.D0.BD.D0.B8.D1.82.D1.8B_systemd"></span>Пользовательские юниты systemd</h3></div>
<p><a href="../../ru/Systemd.html" title="Systemd (Русский)">systemd</a> запускает <code>suspend.target</code>, <code>hibernate.target</code>, <code>hybrid-sleep.target</code> или <code>suspend-then-hibernate.target</code> для каждого режима сна соответственно. Также все они подтягивают <code>sleep.target</code>. Вы можете <a href="../../ru/Systemd.html#%D0%9D%D0%B0%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" title="Systemd (Русский)">написать свой файл юнита</a> и связать его с этими target-юнитами, чтобы он запускался перед уходом в сон или после пробуждения из сна. Для общесистемных и пользовательских действий нужно создавать отдельные файлы. Примеры:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/user-suspend@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=User suspend actions
Before=sleep.target

[Service]
User=%I
Type=forking
Environment=DISPLAY=:0
ExecStartPre= -/usr/bin/pkill -u %u unison ; /usr/local/bin/music.sh stop
ExecStart=/usr/bin/sflock
ExecStartPost=/usr/bin/sleep 1

[Install]
WantedBy=sleep.target</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/user-resume@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=User resume actions
After=suspend.target hibernate.target

[Service]
User=%I
Type=simple
ExecStart=/usr/local/bin/ssh-connect.sh

[Install]
WantedBy=suspend.target hibernate.target</pre>
<p>Для использования включайте юниты <code>user-suspend@<i>пользователь</i>.service</code> и/или <code>user-resume@<i>пользователь</i>.service</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание</strong> Так как процесс, запустивший блокировку экрана, может успеть завершиться до того, как экран реально заблокируется, — есть вероятность, что экран не успеет заблокироваться перед уходом в сон, и после пробуждения на экране может на мгновение отобразиться незаблокированный рабочий стол. Добавление небольшой задержки через <code>ExecStartPost=/usr/bin/sleep 1</code> помогает предотвратить это, позволяя блокировщику экрана успеть заблокировать экран.</div>
<p>Пример для общесистемных действий:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/root-suspend.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Local system suspend actions
Before=sleep.target

[Service]
Type=simple
ExecStart=-/usr/bin/pkill sshfs

[Install]
WantedBy=sleep.target</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/root-resume.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Local system resume actions
After=suspend.target hibernate.target

[Service]
Type=simple
ExecStart=/usr/bin/systemctl restart mnt-media.automount

[Install]
WantedBy=suspend.target hibernate.target</pre>
<div class="mw-heading mw-heading4"><h4 id="Комбинированный_юнит">
<span id=".D0.9A.D0.BE.D0.BC.D0.B1.D0.B8.D0.BD.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.BD.D1.8B.D0.B9_.D1.8E.D0.BD.D0.B8.D1.82"></span>Комбинированный юнит</h4></div>
<p>При использовании комбинированного файла юнита один и тот же хук выполняет всю работу для разных фаз (переход в сон и пробуждение) и для разных целей.
</p>
<p>Пример и объяснение:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/wicd-sleep.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Wicd sleep hook
Before=sleep.target
StopWhenUnneeded=yes

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=-/usr/share/wicd/daemon/suspend.py
ExecStop=-/usr/share/wicd/daemon/autoconnect.py

[Install]
WantedBy=sleep.target</pre>
<ul>
<li>
<code>RemainAfterExit=yes</code>: После запуска служба считается активной до тех пор, пока её явно не остановят.</li>
<li>
<code>StopWhenUnneeded=yes</code>: Если служба активна, она будет остановлена, если ни одна другая активная служба не нуждается в ней. В данном конкретном примере она будет остановлена после остановки <code>sleep.target</code>.</li>
<li>Поскольку <code>sleep.target</code> имеет <code>StopWhenUnneeded=yes</code>, хук гарантированно запустится/остановится правильно для различных режимов.</li>
</ul>
<div class="mw-heading mw-heading3"><h3 id="Хуки_в_/usr/lib/systemd/system-sleep">
<span id=".D0.A5.D1.83.D0.BA.D0.B8_.D0.B2_.2Fusr.2Flib.2Fsystemd.2Fsystem-sleep"></span>Хуки в /usr/lib/systemd/system-sleep</h3></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Примечание</strong> Как сказано в <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-sleep"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-sleep.8">systemd-sleep(8)</a></span>, использование этого метода считается хаком. <i>systemd-sleep</i> будет запускать все хуки одновременно, а не последовательно друг за другом. Для более чётко определённого интерфейса с поддержкой указания порядка запуска используйте <a href="#%D0%9F%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D1%81%D0%BA%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D1%8B_systemd">#Пользовательские юниты systemd</a>.</div>
<p><i>systemd-sleep</i> запускает все исполняемые файлы из каталога <code>/usr/lib/systemd/system-sleep/</code>, передавая каждому из них два аргумента:
</p>
<ol>
<li>
<code>pre</code> или <code>post</code> в зависимости от того, переходит ли машина в режим сна или пробуждается.</li>
<li>
<code>suspend</code>, <code>hibernate</code>, <code>hybrid-sleep</code> или <code>suspend-then-hibernate</code> в зависимости от конкретного режима сна.</li>
</ol>
<p>Переменная окружения <code>SYSTEMD_SLEEP_ACTION</code> будет содержать конкретное действие сна, выполняемое в данный момент. В первую очередь это полезно для режима <i>suspend-then-hibernate</i>, при котором значение переменной может быть <code>suspend</code> или <code>hibernate</code>, а также <code>suspend-after-failed-hibernate</code> в случаях, когда гибернация не удалась.
</p>
<p>Вывод любого пользовательского скрипта будет записан в журнал службы <i>systemd-suspend.service</i>, <i>systemd-hibernate.service</i> или <i>systemd-hybrid-sleep.service</i>, который можно посмотреть с помощью <a href="../../ru/Systemd/Journal.html" title="Systemd (Русский)/Journal (Русский)">journalctl</a>:
</p>
<pre># journalctl -b -u systemd-suspend.service
</pre>
<p>Пример пользовательского скрипта сна:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/lib/systemd/system-sleep/example.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
case $1/$2 in
  pre/*)
    echo "Going to $2..."
    ;;
  post/*)
    echo "Waking up from $2..."
    ;;
esac
</pre>
<p>Не забудьте сделать скрипт <a href="../../ru/Help:Reading.html#%D0%A1%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C_%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D0%BD%D1%8F%D0%B5%D0%BC%D1%8B%D0%BC" class="mw-redirect" title="Исполняемым">исполняемым</a>.
</p>
<div class="mw-heading mw-heading2"><h2 id="Советы_и_рекомендации">
<span id=".D0.A1.D0.BE.D0.B2.D0.B5.D1.82.D1.8B_.D0.B8_.D1.80.D0.B5.D0.BA.D0.BE.D0.BC.D0.B5.D0.BD.D0.B4.D0.B0.D1.86.D0.B8.D0.B8"></span>Советы и рекомендации</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Автоматическая_разблокировка_при_пробуждении_в_доверенных_местах">
<span id=".D0.90.D0.B2.D1.82.D0.BE.D0.BC.D0.B0.D1.82.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.B0.D1.8F_.D1.80.D0.B0.D0.B7.D0.B1.D0.BB.D0.BE.D0.BA.D0.B8.D1.80.D0.BE.D0.B2.D0.BA.D0.B0_.D0.BF.D1.80.D0.B8_.D0.BF.D1.80.D0.BE.D0.B1.D1.83.D0.B6.D0.B4.D0.B5.D0.BD.D0.B8.D0.B8_.D0.B2_.D0.B4.D0.BE.D0.B2.D0.B5.D1.80.D0.B5.D0.BD.D0.BD.D1.8B.D1.85_.D0.BC.D0.B5.D1.81.D1.82.D0.B0.D1.85"></span>Автоматическая разблокировка при пробуждении в доверенных местах</h3></div>
<p>При пробуждении из сна можно автоматически разблокировать систему, если она подключена к определённым устройствам или доверенным сетям Wi-Fi.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/local-scripts/resume-unlock.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/bash
# Разблокировка сеанса при нахождении в доверенных местах

function trusted() {
    # Проверка подключения к доверенной сети Wi-Fi
    [[ $(iwgetid -r) == <i>ssid_домашней_сети</i> ]] \
        &amp;&amp; return 0

    # Проверка подключения доверенного USB-устройства
    #lsusb -d <i>xxxx:xxxx</i> &amp;&amp; return 0

    return 1 # Не доверенное
}

for (( i=0; i &lt; 10; i++ )); do
    if trusted; then
        loginctl unlock-sessions
        exit
    fi
    sleep 0.5
done</pre>
<p>Настройте среду рабочего стола на блокировку сеанса при переходе в сон, а затем создайте <a href="#%D0%A5%D1%83%D0%BA%D0%B8_%D1%81%D0%BD%D0%B0">хук сна</a>, который запускает вышеуказанный скрипт после пробуждения. Для проверки статуса Wi-Fi <a href="../../ru/Help:Reading.html#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Установите">установите</a> пакет <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=wireless_tools">wireless_tools</a></span>. Если вы также хотите проверять наличие подключенных USB-устройств, раскомментируйте строку <code>lsusb -d ...</code> в скрипте и введите ID доверенного устройства. Узнать ID подключенных устройств можно с помощью команды <code>lsusb</code>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Полное_отключение_сна">
<span id=".D0.9F.D0.BE.D0.BB.D0.BD.D0.BE.D0.B5_.D0.BE.D1.82.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B5_.D1.81.D0.BD.D0.B0"></span>Полное отключение сна</h3></div>
<p>При использовании устройства в качестве, например, сервера уход в сон может быть не нужен или даже нежелателен. Любое состояние сна можно отключить через <span class="plainlinks archwiki-template-man" title="$ man 5 systemd-sleep.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-sleep.conf.5">systemd-sleep.conf(5)</a></span>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/sleep.conf.d/disable-sleep.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Sleep]
AllowSuspend=no
AllowHibernation=no
AllowHybridSleep=no
AllowSuspendThenHibernate=no</pre>
<div class="mw-heading mw-heading3"><h3 id="Технология_Intel_Rapid_Start_(IRST)">
<span id=".D0.A2.D0.B5.D1.85.D0.BD.D0.BE.D0.BB.D0.BE.D0.B3.D0.B8.D1.8F_Intel_Rapid_Start_.28IRST.29"></span>Технология Intel Rapid Start (IRST)</h3></div>
<p>Intel Rapid Start Technology — это работающий на уровне прошивки метод сна, который позволяет перейти в спящий режим из ждущего через заданный интервал времени или в зависимости от состояния батареи. Он должен быть быстрее и надёжнее, чем обычный спящий режим, поскольку выполняется прошивкой, а не на уровне операционной системы. Как правило, эта функция должна быть включена в прошивке, и она же позволяет выбрать длительность ждущего режима или событие батареи, после которых будет выполнен переход в спящий режим. Однако некоторые устройства, несмотря на поддержку IRST в прошивке, позволяют настраивать его только через драйверы Intel для Windows. В таких случаях модуль ядра intel-rst должен обеспечить настройку событий в Linux.
</p>
<p>При включенной технологии Intel Rapid Start Technology (IRST) для выхода из глубокого сна требуется <a rel="nofollow" class="external text" href="https://mjg59.dreamwidth.org/26022.html">«на несколько секунд больше, чем для выхода из S3, но намного меньше, чем для выхода из спящего режима»</a>.
</p>
<p>Многие системы на базе Intel имеют встроенную поддержку IRST, но для этого требуется специальный раздел на SSD (а не на HDD). OEM-установки Windows могут иметь уже существующий раздел IRST, который можно оставить при установке Arch Linux (вместо очистки и переразметки всего SSD). Он должен отображаться как неотформатированный раздел, равный размеру ОЗУ системы.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Важно</strong> Раздел Intel Rapid Start не зашифрован; «Intel рекомендует отключить технологию Intel Rapid Start, если вы используете программное шифрование диска». <a rel="nofollow" class="external autonumber" href="https://www.intel.com/content/www/us/en/support/articles/000024080/technologies.html">[7]</a>
</div>
<p>Однако если вы собираетесь стереть и переразметить весь диск (или уже сделали это), то раздел IRST необходимо создать заново, если вы планируете использовать эту технологию. Это можно сделать, создав пустой раздел, равный размеру ОЗУ системы, и установив для него тип раздела <a href="https://en.wikipedia.org/wiki/ru:%D0%A2%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0_%D1%80%D0%B0%D0%B7%D0%B4%D0%B5%D0%BB%D0%BE%D0%B2_GUID#.D0.98.D0.B4.D0.B5.D0.BD.D1.82.D0.B8.D1.84.D0.B8.D0.BA.D0.B0.D1.82.D0.BE.D1.80.D1.8B_.28GUID.29_.D1.80.D0.B0.D0.B7.D0.BB.D0.B8.D1.87.D0.BD.D1.8B.D1.85_.D1.82.D0.B8.D0.BF.D0.BE.D0.B2_.D1.80.D0.B0.D0.B7.D0.B4.D0.B5.D0.BB.D0.BE.D0.B2" class="extiw" title="wikipedia:ru:Таблица разделов GUID">GUID</a> <code>D3BFE2DE-3DAF-11DF-BA40-E3A556D89593</code> для <a href="../../ru/Partitioning.html#%D0%A2%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0_%D1%80%D0%B0%D0%B7%D0%B4%D0%B5%D0%BB%D0%BE%D0%B2_GUID" title="Partitioning (Русский)">GPT</a> или <a href="https://en.wikipedia.org/wiki/ru:%D0%93%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BE%D1%87%D0%BD%D0%B0%D1%8F_%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D1%8C#.D0.9A.D0.BE.D0.B4_.D1.82.D0.B8.D0.BF.D0.B0_.D1.80.D0.B0.D0.B7.D0.B4.D0.B5.D0.BB.D0.B0" class="extiw" title="wikipedia:ru:Главная загрузочная запись">ID</a> <code>0x84</code> для <a href="../../ru/Partitioning.html#%D0%93%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BE%D1%87%D0%BD%D0%B0%D1%8F_%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D1%8C_(MBR)" title="Partitioning (Русский)">MBR</a>. Вам также может потребоваться включить поддержку IRST в настройках прошивки вашей системы.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Совет</strong> Время до срабатывания IRST (после приостановки) можно настроить в настройках прошивки системы.</div>
<p>Продолжительность процесса гибернации IRST (то есть копирования «всего содержимого ОЗУ в специальный раздел») зависит от размера ОЗУ системы и скорости SSD и, таким образом, может занять 20–60 секунд. Некоторые системы могут сигнализировать о завершении процесса светодиодным индикатором (LED), например, когда он перестаёт мигать.
</p>
<p>Для настройки IRST через Linux требуется ядро, собранное с <code>CONFIG_INTEL_RST</code>. После загрузки модуля через <code>modprobe intel_rst</code> он должен создать файлы <code>wakeup_events</code> и <code>wakeup_time</code> в каталоге <code>/sys/bus/acpi/drivers/intel_rapid_start/*/</code>, которые можно использовать для настройки. Данный модуль имеет скудную документацию, подробности можно посмотреть в его исходном коде: <a rel="nofollow" class="external text" href="https://github.com/torvalds/linux/blob/143a6252e1b8ab424b4b293512a97cca7295c182/drivers/platform/x86/intel/rst.c">drivers/platform/x86/intel/rst.c</a>.
</p>
<p>Смотрите также <a rel="nofollow" class="external text" href="https://www.intel.com/content/www/us/en/support/articles/000024078/technologies.html">общие вопросы и ответы</a> и <a rel="nofollow" class="external text" href="https://www.intel.com/content/www/us/en/support/articles/000024273/technologies/intel-vpro-platform.html?wapkw=user%20guide%20Intel%20rapid%20start%20">руководства пользователей</a> для технологии Intel Rapid Start.
</p>
<div class="mw-heading mw-heading3"><h3 id="Отслеживание_заряда_батареи_во_время_сна">
<span id=".D0.9E.D1.82.D1.81.D0.BB.D0.B5.D0.B6.D0.B8.D0.B2.D0.B0.D0.BD.D0.B8.D0.B5_.D0.B7.D0.B0.D1.80.D1.8F.D0.B4.D0.B0_.D0.B1.D0.B0.D1.82.D0.B0.D1.80.D0.B5.D0.B8_.D0.B2.D0.BE_.D0.B2.D1.80.D0.B5.D0.BC.D1.8F_.D1.81.D0.BD.D0.B0"></span>Отслеживание заряда батареи во время сна</h3></div>
<p>Для отслеживания потребления энергии во время сна можно использовать скрипт <a rel="nofollow" class="external text" href="https://github.com/equaeghe/batenergy">Batenergy</a>. Он записывает в <a href="../../en/267169aa4f3f76ee26af8df59463c9cf.html" class="mw-redirect" title="Журнал systemd">журнал systemd</a> информацию о текущем заряде батареи перед переходом в сон и после пробуждения из сна. Это также позволяет сравнить потребление энергии между разными режимами S3 / S0x и заметить возможные регрессии после обновления BIOS или ядра. Для работы скрипта нужно установить <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bc">bc</a></span>.
</p>
<div class="mw-heading mw-heading2"><h2 id="Решение_проблем">
<span id=".D0.A0.D0.B5.D1.88.D0.B5.D0.BD.D0.B8.D0.B5_.D0.BF.D1.80.D0.BE.D0.B1.D0.BB.D0.B5.D0.BC"></span>Решение проблем</h2></div>
<div class="mw-heading mw-heading3"><h3 id="ACPI_OS_NAME">ACPI_OS_NAME</h3></div>
<p>Возможно, вы захотите настроить свою <b>таблицу DSDT</b>, чтобы заставить её работать. Смотрите статью <a href="../../en/DSDT.html" title="DSDT">DSDT</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Ждущий_или_спящий_режим_не_работает_или_сбоит">
<span id=".D0.96.D0.B4.D1.83.D1.89.D0.B8.D0.B9_.D0.B8.D0.BB.D0.B8_.D1.81.D0.BF.D1.8F.D1.89.D0.B8.D0.B9_.D1.80.D0.B5.D0.B6.D0.B8.D0.BC_.D0.BD.D0.B5_.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D0.B0.D0.B5.D1.82_.D0.B8.D0.BB.D0.B8_.D1.81.D0.B1.D0.BE.D0.B8.D1.82"></span>Ждущий или спящий режим не работает или сбоит</h3></div>
<p>Часто сообщают о том, что при переходе в ждущий или спящий режим экран становится чёрным, на нём не видно ошибок и ничего нельзя сделать. Эти проблемы наблюдались как на ноутбуках, так и на настольных компьютерах. Переход на более старое ядро, особенно на LTS-ядро, хоть и не является официальным решением, но может исправить ситуацию.
</p>
<p>Проблема может возникнуть при использовании аппаратного сторожевого таймера (по умолчанию отключен, смотрите <code>RuntimeWatchdogSec=</code> в <span class="plainlinks archwiki-template-man" title="$ man 5 systemd-system.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-system.conf.5#OPTIONS">systemd-system.conf(5) § OPTIONS</a></span>). Некорректная работа сторожевого таймера может привести к перезагрузке компьютера до того, как система завершит создание образа.
</p>
<p>Иногда экран становится чёрным из-за инициализации устройств из initramfs. Удаление всех модулей из массива <a href="../../ru/Mkinitcpio.html#MODULES" title="Mkinitcpio (Русский)">MODULES</a>, удаление хука <code>kms</code> и пересборка образа initramfs могут решить эту проблему, в частности, с графическими драйверами для <a href="../../ru/Kernel_mode_setting.html#%D0%A0%D0%B0%D0%BD%D0%BD%D0%B8%D0%B9_%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA_KMS" title="Kernel mode setting (Русский)">раннего запуска KMS</a>. Инициализация таких устройств перед восстановлением состояния системы может привести к неконсистентности, что не позволит системе восстановиться. Это не влияет на пробуждение из ждущего режима. Также посмотрите статью <a rel="nofollow" class="external text" href="https://web.archive.org/web/20230502010825/https://01.org/blogs/rzhang/2015/best-practice-debug-linux-suspend/hibernate-issues">Best practices to debug suspend issues</a>.
</p>
<p>Переход с видеодрайвера <a href="../../ru/ATI.html" title="ATI (Русский)">ATI</a> на более новый <a href="../../ru/AMDGPU.html" title="AMDGPU (Русский)">AMDGPU</a> также может способствовать корректной работе сна.
</p>
<p>Проприетарный драйвер <a href="../../ru/NVIDIA.html" title="NVIDIA (Русский)">NVIDIA</a> сохраняет содержимое видеопамяти на диск при переходе в сон.<a rel="nofollow" class="external autonumber" href="https://us.download.nvidia.com/XFree86/Linux-x86_64/470.63.01/README/powermanagement.html">[8]</a> Убедитесь, что у вас достаточно места на диске, иначе после пробуждения вы можете получить чёрный экран. При других проблемах может помочь <a href="../../ru/Kernel_module.html#%D0%97%D0%B0%D0%BF%D1%80%D0%B5%D1%82_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8" title="Kernel module (Русский)">запрет загрузки модуля</a> <code>nvidiafb</code>. <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=234646">[9]</a>
</p>
<p>На ноутбуках с процессором Intel, в которых загружен модуль <code>intel_lpss_pci</code> для тачпада, может случиться паника ядра при восстановлении (мигающий caps lock) <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=231881">[10]</a>. Модуль нужно добавить в <a href="../../ru/Arch_boot_process.html#initramfs" title="Arch boot process (Русский)">initramfs</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">MODULES=(... intel_lpss_pci ...)</pre>
<p>После чего <a href="../../ru/Mkinitcpio.html#%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BE%D1%87%D0%BD%D0%BE%D0%B3%D0%BE_%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%B0" title="Mkinitcpio (Русский)">пересоберите образ initramfs</a>.
</p>
<div class="mw-heading mw-heading4"><h4 id="Ошибки_устройств_USB">
<span id=".D0.9E.D1.88.D0.B8.D0.B1.D0.BA.D0.B8_.D1.83.D1.81.D1.82.D1.80.D0.BE.D0.B9.D1.81.D1.82.D0.B2_USB"></span>Ошибки устройств USB</h4></div>
<p>Система может не уходить в сон из-за какого-нибудь USB-устройства. Вы можете увидеть такую ошибку:
</p>
<pre>PM: Some devices failed to suspend, or early wake event detected
...
xhci_hcd 0000:02:00.0: PM: failed to suspend async: error -16
</pre>
<p><i>lspci</i> может дать больше информации о проблемном устройстве:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ lspci -s 02:00.0</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">02:00.0 USB controller: Advanced Micro Devices, Inc. [AMD] 500 Series Chipset USB 3.1 XHCI Controller</pre>
<p>Попробуйте отключить устройства, подключенные к этому порту.
</p>
<div class="mw-heading mw-heading3"><h3 id="Wake-on-LAN">Wake-on-LAN</h3></div>
<p>Если функция <a href="../../en/Wake-on-LAN.html" title="Wake-on-LAN">Wake-on-LAN</a> включена, сетевая карта будет потреблять энергию, даже если компьютер находится в спящем режиме.
</p>
<div class="mw-heading mw-heading3"><h3 id="Система_мгновенно_пробуждается_из_ждущего_режима">
<span id=".D0.A1.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D0.B0_.D0.BC.D0.B3.D0.BD.D0.BE.D0.B2.D0.B5.D0.BD.D0.BD.D0.BE_.D0.BF.D1.80.D0.BE.D0.B1.D1.83.D0.B6.D0.B4.D0.B0.D0.B5.D1.82.D1.81.D1.8F_.D0.B8.D0.B7_.D0.B6.D0.B4.D1.83.D1.89.D0.B5.D0.B3.D0.BE_.D1.80.D0.B5.D0.B6.D0.B8.D0.BC.D0.B0"></span>Система мгновенно пробуждается из ждущего режима</h3></div>
<p>Смотрите <a href="../../en/Wakeup_triggers.html#Instantaneous_wakeup_after_suspending" class="mw-redirect" title="Wakeup triggers">Wakeup triggers#Instantaneous wakeup after suspending</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Система_не_выключается_после_перехода_в_спящий_режим">
<span id=".D0.A1.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D0.B0_.D0.BD.D0.B5_.D0.B2.D1.8B.D0.BA.D0.BB.D1.8E.D1.87.D0.B0.D0.B5.D1.82.D1.81.D1.8F_.D0.BF.D0.BE.D1.81.D0.BB.D0.B5_.D0.BF.D0.B5.D1.80.D0.B5.D1.85.D0.BE.D0.B4.D0.B0_.D0.B2_.D1.81.D0.BF.D1.8F.D1.89.D0.B8.D0.B9_.D1.80.D0.B5.D0.B6.D0.B8.D0.BC"></span>Система не выключается после перехода в спящий режим</h3></div>
<p>При переходе в спящий режим система должна полностью выключиться (после сохранения состояния на диск). На некоторых прошивках режим S4 работает ненадёжно. Например, вместо выключения система может перезагрузиться или зависнуть. Если у вас происходит что-то подобное, попробуйте в файле <span class="plainlinks archwiki-template-man" title="$ man 5 sleep.conf.d"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sleep.conf.d.5">sleep.conf.d(5)</a></span> установить для <code>HibernateMode</code> значение <code>shutdown</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/sleep.conf.d/hibernatemode.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Sleep]
HibernateMode=shutdown</pre>
<p>Если всё остальное настроено правильно, после выполнения <code>systemctl hibernate</code> машина должна полностью выключиться, сохранив при этом своё состояние на диск.
</p>
<div class="mw-heading mw-heading3"><h3 id="Операционная_система_не_найдена_(или_загружается_не_та_ОС)_при_включении_после_спящего_режима">
<span id=".D0.9E.D0.BF.D0.B5.D1.80.D0.B0.D1.86.D0.B8.D0.BE.D0.BD.D0.BD.D0.B0.D1.8F_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D0.B0_.D0.BD.D0.B5_.D0.BD.D0.B0.D0.B9.D0.B4.D0.B5.D0.BD.D0.B0_.28.D0.B8.D0.BB.D0.B8_.D0.B7.D0.B0.D0.B3.D1.80.D1.83.D0.B6.D0.B0.D0.B5.D1.82.D1.81.D1.8F_.D0.BD.D0.B5_.D1.82.D0.B0_.D0.9E.D0.A1.29_.D0.BF.D1.80.D0.B8_.D0.B2.D0.BA.D0.BB.D1.8E.D1.87.D0.B5.D0.BD.D0.B8.D0.B8_.D0.BF.D0.BE.D1.81.D0.BB.D0.B5_.D1.81.D0.BF.D1.8F.D1.89.D0.B5.D0.B3.D0.BE_.D1.80.D0.B5.D0.B6.D0.B8.D0.BC.D0.B0"></span>Операционная система не найдена (или загружается не та ОС) при включении после спящего режима</h3></div>
<p>Это может происходить, когда загрузочным диском является внешний диск, и, по-видимому, вызвано ограничением BIOS/прошивки. Прошивка пытается загрузиться с внутреннего диска, в то время как гибернация была выполнена из ОС на внешнем (или другом) диске.
</p>
<p>Установите <code>HibernateMode=shutdown</code>, как показано в разделе <a href="#%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0_%D0%BD%D0%B5_%D0%B2%D1%8B%D0%BA%D0%BB%D1%8E%D1%87%D0%B0%D0%B5%D1%82%D1%81%D1%8F_%D0%BF%D0%BE%D1%81%D0%BB%D0%B5_%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4%D0%B0_%D0%B2_%D1%81%D0%BF%D1%8F%D1%89%D0%B8%D0%B9_%D1%80%D0%B5%D0%B6%D0%B8%D0%BC">#Система не выключается после перехода в спящий режим</a>, чтобы окончательно решить проблему. Если система уже заблокировалась, можно попробовать перезагрузить её 4 раза (каждый раз дожидаясь появления ошибки), что в некоторых BIOS'ах приводит к нормальной загрузке.
</p>
<div class="mw-heading mw-heading3"><h3 id="Файл_подкачки_в_/home">
<span id=".D0.A4.D0.B0.D0.B9.D0.BB_.D0.BF.D0.BE.D0.B4.D0.BA.D0.B0.D1.87.D0.BA.D0.B8_.D0.B2_.2Fhome"></span>Файл подкачки в /home</h3></div>
<p>Если файл подкачки находится в <code>/home/</code>, <i>systemd-logind</i> не сможет получить к нему доступ и выдаст предупреждение <code>Call to Hibernate failed: No such file or directory</code>, а для выполнения <code>systemctl hibernate</code> потребуется аутентификация. Такая конфигурация <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/31100">официально не поддерживается</a>. Два возможных обходных пути описаны в <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/15354#issuecomment-611077881">systemd issue 15354</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="ПК_не_пробуждается_из_сна_на_материнских_платах_A520I_и_B550I">
<span id=".D0.9F.D0.9A_.D0.BD.D0.B5_.D0.BF.D1.80.D0.BE.D0.B1.D1.83.D0.B6.D0.B4.D0.B0.D0.B5.D1.82.D1.81.D1.8F_.D0.B8.D0.B7_.D1.81.D0.BD.D0.B0_.D0.BD.D0.B0_.D0.BC.D0.B0.D1.82.D0.B5.D1.80.D0.B8.D0.BD.D1.81.D0.BA.D0.B8.D1.85_.D0.BF.D0.BB.D0.B0.D1.82.D0.B0.D1.85_A520I_.D0.B8_B550I"></span>ПК не пробуждается из сна на материнских платах A520I и B550I</h3></div>
<p>На некоторых материнских платах с чипсетами A520i и B550i система не может полностью войти в состояние сна или выйти из него. Среди симптомов — система уходит в сон и монитор выключается, в то время как внутренние светодиоды на материнской плате или индикатор питания продолжают гореть. Затем система не выходит из этого состояния и требует «жёсткого» выключения. Если у вас похожие проблемы на AMD-системе, сначала убедитесь, что система полностью обновлена, и проверьте, установлен ли пакет с <a href="../../ru/Microcode.html" title="Microcode (Русский)">микрокодом</a> для AMD.
</p>
<p>Проверьте, что строка, начинающаяся с <code>GPP0</code>, имеет статус enabled:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ cat /proc/acpi/wakeup</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Device	S-state	  Status   Sysfs node
GP12	  S4	*enabled   pci:0000:00:07.1
GP13	  S4	*enabled   pci:0000:00:08.1
XHC0	  S4	*enabled   pci:0000:0b:00.3
GP30	  S4	*disabled
GP31	  S4	*disabled
PS2K	  S3	*disabled
<b>GPP0</b>	  S4	<b>*enabled</b>   pci:0000:00:01.1
GPP8	  S4	*enabled   pci:0000:00:03.1
PTXH	  S4	*enabled   pci:0000:05:00.0
PT20	  S4	*disabled
PT24	  S4	*disabled
PT26	  S4	*disabled
PT27	  S4	*disabled
PT28	  S4	*enabled   pci:0000:06:08.0
PT29	  S4	*enabled   pci:0000:06:09.0
</pre>
<p>Если enabled, вы можете выполнить следующую команду для отключения:
</p>
<pre># echo GPP0 &gt; /proc/acpi/wakeup
</pre>
<p>Теперь протестируйте, выполнив <code>systemctl suspend</code> и дав системе уйти в сон. Затем попробуйте вывести систему из сна через несколько секунд. Если это сработало, вы можете сделать обходной путь постоянным. Создайте <a href="../../ru/Systemd.html#%D0%9D%D0%B0%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" title="Systemd (Русский)">файл юнита systemd</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/toggle-gpp0-to-fix-wakeup.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description="Disable GPP0 to fix suspend issue"

[Service]
ExecStart=/bin/sh -c "/bin/echo GPP0 &gt; /proc/acpi/wakeup"

[Install]
WantedBy=multi-user.target</pre>
<p>Выполните <a href="../../ru/Systemd.html#%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" title="Systemd (Русский)">daemon-reload</a> и <a href="../../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Запустите/включите">запустите/включите</a> этот юнит.
</p>
<p>Другой вариант — создать правило <a href="../../ru/Udev.html" title="Udev (Русский)">udev</a>. Например, если для <code>GPP0</code> соответствует sysfs-узел <code>pci:0000:00:01.1</code> как в примере выше, выполните <code>udevadm info -a -p /sys/bus/pci/devices/0000\:00\:01.1</code> для получения нужной информации и создайте примерно такое правило:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/10-gpp0-acpi-fix.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">KERNEL=="0000:00:01.1", SUBSYSTEM=="pci", DRIVERS=="pcieport", ATTR{vendor}=="0x1022", ATTR{device}=="0x1483", ATTR{power/wakeup}="disabled"</pre>
<p>Демон udev по умолчанию уже отслеживает изменения в системе. При необходимости вы можете <a href="../../ru/Udev.html#%D0%97%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0_%D0%BD%D0%BE%D0%B2%D1%8B%D1%85_%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB" title="Udev (Русский)">перезагрузить правила</a> вручную.
</p>
<div class="mw-heading mw-heading3"><h3 id="Fn-кнопка_сна_на_ноутбуке_не_работает">
<span id="Fn-.D0.BA.D0.BD.D0.BE.D0.BF.D0.BA.D0.B0_.D1.81.D0.BD.D0.B0_.D0.BD.D0.B0_.D0.BD.D0.BE.D1.83.D1.82.D0.B1.D1.83.D0.BA.D0.B5_.D0.BD.D0.B5_.D1.80.D0.B0.D0.B1.D0.BE.D1.82.D0.B0.D0.B5.D1.82"></span>Fn-кнопка сна на ноутбуке не работает</h3></div>
<p>Если независимо от настроек в logind.conf кнопка сна не работает (её нажатие даже не приводит к появлению сообщения в syslog), то logind, вероятно, не отслеживает клавиатуру. <a rel="nofollow" class="external autonumber" href="https://lists.freedesktop.org/archives/systemd-devel/2015-February/028325.html">[11]</a> Выполните:
</p>
<pre># journalctl --grep="Watching system buttons"
</pre>
<p>Вы увидите что-то подобное:
</p>
<pre>May 25 21:28:19 vmarch.lan systemd-logind[210]: Watching system buttons on /dev/input/event2 (Power Button)
May 25 21:28:19 vmarch.lan systemd-logind[210]: Watching system buttons on /dev/input/event3 (Sleep Button)
May 25 21:28:19 vmarch.lan systemd-logind[210]: Watching system buttons on /dev/input/event4 (Video Bus)
</pre>
<p>И клавиатуры здесь скорее всего не окажется. В таком случае посмотрите список подключенных клавиатур:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ stat -c%N /dev/input/by-id/*-kbd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
/dev/input/by-id/usb-SIGMACHIP_USB_Keyboard-event-kbd -&gt; <b>../event6</b>
...</pre>
<p>Теперь получите <code>ATTRS{name}</code> родительского устройства <a rel="nofollow" class="external autonumber" href="https://systemd-devel.freedesktop.narkive.com/Rbi3rjNN/patch-1-2-logind-add-support-for-tps65217-power-button">[12]</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># udevadm info -a /dev/input/<b>event6</b></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
KERNEL=="event6"
...
ATTRS{name}=="SIGMACHIP USB Keyboard"</pre>
<p>Теперь напишите пользовательское правило udev для добавления тега "power-switch":
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/70-power-switch-my.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ACTION=="remove", GOTO="power_switch_my_end"
SUBSYSTEM=="input", KERNEL=="event*", ATTRS{name}=="SIGMACHIP USB Keyboard", TAG+="power-switch"
LABEL="power_switch_my_end"</pre>
<p><a href="../../ru/Udev.html#%D0%97%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0_%D0%BD%D0%BE%D0%B2%D1%8B%D1%85_%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB" title="Udev (Русский)">Перезагрузите правила udev</a> и <a href="../../ru/Help:Reading.html#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%8E%D0%BD%D0%B8%D1%82%D0%B0%D0%BC%D0%B8_systemd" class="mw-redirect" title="Перезапустите">перезапустите</a> службу <code>systemd-logind.service</code>, после чего в журнале должна появиться строка, связанная с клавиатурой: <code>Watching system buttons on /dev/input/event6</code>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Система_зависает_на_60_секунд,_а_затем_просыпается_или_зависает_после_пробуждения">
<span id=".D0.A1.D0.B8.D1.81.D1.82.D0.B5.D0.BC.D0.B0_.D0.B7.D0.B0.D0.B2.D0.B8.D1.81.D0.B0.D0.B5.D1.82_.D0.BD.D0.B0_60_.D1.81.D0.B5.D0.BA.D1.83.D0.BD.D0.B4.2C_.D0.B0_.D0.B7.D0.B0.D1.82.D0.B5.D0.BC_.D0.BF.D1.80.D0.BE.D1.81.D1.8B.D0.BF.D0.B0.D0.B5.D1.82.D1.81.D1.8F_.D0.B8.D0.BB.D0.B8_.D0.B7.D0.B0.D0.B2.D0.B8.D1.81.D0.B0.D0.B5.D1.82_.D0.BF.D0.BE.D1.81.D0.BB.D0.B5_.D0.BF.D1.80.D0.BE.D0.B1.D1.83.D0.B6.D0.B4.D0.B5.D0.BD.D0.B8.D1.8F"></span>Система зависает на 60 секунд, а затем просыпается или зависает после пробуждения</h3></div>
<p>Начиная с версии 256, systemd замораживает <code>user.slice</code> перед уходом в сон. Этот процесс может завершиться неудачей из-за ошибок ядра, особенно при использовании KVM.<a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/33083">[13]</a><a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/33626">[14]</a>
</p>
<p>При этом в журнале будут сообщения <code>Failed to freeze unit 'user.slice'</code>. При возникновении такой проблемы попытка войти в систему (начать другой сеанс) завершится неудачей:
</p>
<pre>pam_systemd(<i>процесс</i>:session): Failed to create session: Job 9876 for unit 'session-6.scope' failed with 'frozen'</pre>
<p>Чтобы временно вернуться к старому поведению, <a href="../../ru/Systemd.html#%D0%A0%D0%B5%D0%B4%D0%B0%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2_%D1%8E%D0%BD%D0%B8%D1%82%D0%BE%D0%B2" class="mw-redirect" title="Отредактируйте">отредактируйте</a> юниты <code>systemd-suspend.service</code>, <code>systemd-hibernate.service</code>, <code>systemd-hybrid-sleep.service</code> и <code>systemd-suspend-then-hibernate.service</code>, создав для каждого drop-in файлы со следующим содержимым:
</p>
<pre>[Service]
Environment=SYSTEMD_SLEEP_FREEZE_USER_SESSIONS=false</pre>
<p>Однако сам этот drop-in файл тоже может помешать системе перейти в режим сна.<a rel="nofollow" class="external autonumber" href="https://gitlab.freedesktop.org/drm/amd/-/issues/4178">[15]</a>
</p>
<div class="mw-heading mw-heading3"><h3 id="Спящий_режим_при_использовании_нескольких_операционных_систем">
<span id=".D0.A1.D0.BF.D1.8F.D1.89.D0.B8.D0.B9_.D1.80.D0.B5.D0.B6.D0.B8.D0.BC_.D0.BF.D1.80.D0.B8_.D0.B8.D1.81.D0.BF.D0.BE.D0.BB.D1.8C.D0.B7.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D0.B8_.D0.BD.D0.B5.D1.81.D0.BA.D0.BE.D0.BB.D1.8C.D0.BA.D0.B8.D1.85_.D0.BE.D0.BF.D0.B5.D1.80.D0.B0.D1.86.D0.B8.D0.BE.D0.BD.D0.BD.D1.8B.D1.85_.D1.81.D0.B8.D1.81.D1.82.D0.B5.D0.BC"></span>Спящий режим при использовании нескольких операционных систем</h3></div>
<p>Если вы используете несколько операционных систем на одном устройстве (включая, но не ограничиваясь, <a href="../../ru/Dual_boot_with_Windows.html" class="mw-redirect" title="Dual boot with Windows (Русский)">двойную загрузку с Windows</a>) и хотите иметь возможность загружаться в другую систему, пока Arch Linux находится в гибернации, нужно быть очень осторожным и не монтировать те разделы, которые примонтированы в системе, ушедшей в сон. Перед монтированием необходимо убедиться, что файловая система была размонтирована перед переходом системы в гибернацию. Это можно сделать с помощью <a href="#%D0%A5%D1%83%D0%BA%D0%B8_%D1%81%D0%BD%D0%B0">хуков сна</a>.
</p>
<p>Эта проблема особенно актуальна для <a href="../../ru/EFI_system_partition.html" title="EFI system partition (Русский)">системного раздела EFI</a>, поскольку ESP обычно используется совместно несколькими системами. В разделе <a href="../../en/EFI_system_partition.html#Hibernation_and_multi_boot_systems" title="EFI system partition">EFI system partition#Hibernation and multi boot systems</a> описаны возможные способы решения проблемы, которые также можно адаптировать для других файловых систем.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../ru/Category:Power_management.html" title="Category:Power management (Русский)">Power management (Русский)</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Power_management_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)/Suspend_and_hibernate_(%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9)&amp;oldid=862820">https://wiki.archlinux.org/index.php?title=Power_management_(Русский)/Suspend_and_hibernate_(Русский)&amp;oldid=862820</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 26 January 2026, at 00:51.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container no-font-mode-scale">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue  vector-search-box-show-thumbnail vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search cdx-typeahead-search--show-thumbnail">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input mw-searchInput" autocomplete="off" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true"><span class="mw-page-title-main">Power management (Русский)/Suspend and hibernate (Русский)</span></div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only reading-lists-bookmark" id="ca-bookmark-sticky-header" tabindex="-1" data-event-name="watch-sticky-bookmark"><span class="vector-icon mw-ui-icon-wikimedia-bookmarkOutline mw-ui-icon-wikimedia-wikimedia-bookmarkOutline"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
