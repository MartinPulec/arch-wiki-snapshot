<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>systemd (Français)/User (Français) - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.43.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Systemd_Français_User_Français rootpage-Systemd_Français skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Fonctionnement" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Fonctionnement">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Fonctionnement</span>
			</div>
		</a>
		
		<ul id="toc-Fonctionnement-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration_de_base" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuration_de_base">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Configuration de base</span>
			</div>
		</a>
		
			<button aria-controls="toc-Configuration_de_base-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration de base subsection</span>
			</button>
		
		<ul id="toc-Configuration_de_base-sublist" class="vector-toc-list">
			<li id="toc-Variables_d'environnement" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Variables_d'environnement">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>Variables d'environnement</span>
				</div>
			</a>
			
			<ul id="toc-Variables_d'environnement-sublist" class="vector-toc-list">
				<li id="toc-Exemple_de_service" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Exemple_de_service">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1.1</span>
					<span>Exemple de service</span>
				</div>
			</a>
			
			<ul id="toc-Exemple_de_service-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-DISPLAY_et_XAUTHORITY" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#DISPLAY_et_XAUTHORITY">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1.2</span>
					<span>DISPLAY et XAUTHORITY</span>
				</div>
			</a>
			
			<ul id="toc-DISPLAY_et_XAUTHORITY-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-PATH" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#PATH">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1.3</span>
					<span>PATH</span>
				</div>
			</a>
			
			<ul id="toc-PATH-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-pam_env" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#pam_env">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1.4</span>
					<span>pam_env</span>
				</div>
			</a>
			
			<ul id="toc-pam_env-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Démarrage_automatique_des_instances_utilisateur_systemd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#D%C3%A9marrage_automatique_des_instances_utilisateur_systemd">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>Démarrage automatique des instances utilisateur systemd</span>
				</div>
			</a>
			
			<ul id="toc-Démarrage_automatique_des_instances_utilisateur_systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Écrire_des_unités_utilisateur" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#%C3%89crire_des_unit%C3%A9s_utilisateur">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Écrire des unités utilisateur</span>
			</div>
		</a>
		
			<button aria-controls="toc-Écrire_des_unités_utilisateur-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Écrire des unités utilisateur subsection</span>
			</button>
		
		<ul id="toc-Écrire_des_unités_utilisateur-sublist" class="vector-toc-list">
			<li id="toc-Exemple" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Exemple">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>Exemple</span>
				</div>
			</a>
			
			<ul id="toc-Exemple-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Exemple_avec_variables" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Exemple_avec_variables">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>Exemple avec variables</span>
				</div>
			</a>
			
			<ul id="toc-Exemple_avec_variables-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Lecture_du_journal" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Lecture_du_journal">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3</span>
					<span>Lecture du journal</span>
				</div>
			</a>
			
			<ul id="toc-Lecture_du_journal-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Fichiers_temporaires" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Fichiers_temporaires">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Fichiers temporaires</span>
			</div>
		</a>
		
		<ul id="toc-Fichiers_temporaires-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Xorg_et_systemd" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Xorg_et_systemd">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Xorg et systemd</span>
			</div>
		</a>
		
			<button aria-controls="toc-Xorg_et_systemd-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Xorg et systemd subsection</span>
			</button>
		
		<ul id="toc-Xorg_et_systemd-sublist" class="vector-toc-list">
			<li id="toc-Connexion_automatique_à_Xorg_sans_gestionnaire_d'affichage" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connexion_automatique_%C3%A0_Xorg_sans_gestionnaire_d'affichage">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>Connexion automatique à Xorg sans gestionnaire d'affichage</span>
				</div>
			</a>
			
			<ul id="toc-Connexion_automatique_à_Xorg_sans_gestionnaire_d'affichage-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Xorg_comme_service_utilisateur_systemd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Xorg_comme_service_utilisateur_systemd">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2</span>
					<span>Xorg comme service utilisateur systemd</span>
				</div>
			</a>
			
			<ul id="toc-Xorg_comme_service_utilisateur_systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Quelques_cas_d'utilisation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Quelques_cas_d'utilisation">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Quelques cas d'utilisation</span>
			</div>
		</a>
		
			<button aria-controls="toc-Quelques_cas_d'utilisation-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Quelques cas d'utilisation subsection</span>
			</button>
		
		<ul id="toc-Quelques_cas_d'utilisation-sublist" class="vector-toc-list">
			<li id="toc-Gestionnaire_de_fenêtres" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Gestionnaire_de_fen%C3%AAtres">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.1</span>
					<span>Gestionnaire de fenêtres</span>
				</div>
			</a>
			
			<ul id="toc-Gestionnaire_de_fenêtres-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Multiplexeur_de_terminal_persistant" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Multiplexeur_de_terminal_persistant">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.2</span>
					<span>Multiplexeur de terminal persistant</span>
				</div>
			</a>
			
			<ul id="toc-Multiplexeur_de_terminal_persistant-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tuer_les_processus_utilisateur_lors_de_la_déconnexion" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Tuer_les_processus_utilisateur_lors_de_la_d%C3%A9connexion">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">7</span>
				<span>Tuer les processus utilisateur lors de la déconnexion</span>
			</div>
		</a>
		
		<ul id="toc-Tuer_les_processus_utilisateur_lors_de_la_déconnexion-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Dépannage" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#D%C3%A9pannage">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">8</span>
				<span>Dépannage</span>
			</div>
		</a>
		
			<button aria-controls="toc-Dépannage-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Dépannage subsection</span>
			</button>
		
		<ul id="toc-Dépannage-sublist" class="vector-toc-list">
			<li id="toc-Runtime_directory_'/run/user/1000'_is_not_owned_by_UID_1000,_as_it_should" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Runtime_directory_'/run/user/1000'_is_not_owned_by_UID_1000,_as_it_should">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.1</span>
					<span>Runtime directory '/run/user/1000' is not owned by UID 1000, as it should</span>
				</div>
			</a>
			
			<ul id="toc-Runtime_directory_'/run/user/1000'_is_not_owned_by_UID_1000,_as_it_should-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Voir_aussi" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Voir_aussi">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">9</span>
				<span>Voir aussi</span>
			</div>
		</a>
		
		<ul id="toc-Voir_aussi-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">systemd (Français)/User (Français)</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 5 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-5" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">5 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-en mw-list-item"><a href="../../en/Systemd/User.html" title="Systemd/User – English" lang="en" hreflang="en" data-title="Systemd/User" data-language-autonym="English" data-language-local-name="English" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-it mw-list-item"><a href="../../it/Systemd/User.html" title="Systemd (Italiano)/User – italiano" lang="it" hreflang="it" data-title="Systemd (Italiano)/User" data-language-autonym="Italiano" data-language-local-name="italiano" class="interlanguage-link-target"><span>Italiano</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Systemd/%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC" title="Systemd/ユーザー – 日本語" lang="ja" hreflang="ja" data-title="Systemd/ユーザー" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../../ru/Systemd/User.html" title="Systemd (Русский)/User – русский" lang="ru" hreflang="ru" data-title="Systemd (Русский)/User" data-language-autonym="Русский" data-language-local-name="русский" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Systemd/User" title="Systemd/User – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" data-title="Systemd/User" data-language-autonym="中文（简体）" data-language-local-name="中文（简体）" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <bdi dir="ltr"><a href="../../fr/Systemd.html" title="Systemd (Français)">Systemd (Français)</a></bdi>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="fr" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>État de la traduction:</strong> Cet article est la version francophone de <a href="../../en/Systemd/User.html" title="Systemd/User">systemd/User</a>. Date de la dernière traduction: 2022-10-03. Vous pouvez aider à synchroniser la traduction s'il y a eu des <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Systemd/User&amp;diff=0&amp;oldid=745141">changements</a> dans la version anglaise.</div>
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../../fr/Systemd.html" title="Systemd (Français)">systemd (Français)</a></li>
<li><a href="../../fr/Getty.html#Connexion_automatique_%C3%A0_la_console" title="Getty (Français)">Getty (Français)#Connexion automatique à la console</a></li>
<li><a href="../../fr/Xinit.html#D%C3%A9marrage_automatique_de_X_%C3%A0_la_connexion" title="Xinit (Français)">Xinit (Français)#Démarrage automatique de X à la connexion</a></li>
</ul>
</div>
<p><a href="../../fr/Systemd.html" title="Systemd (Français)">Systemd</a> offre la possibilité de gérer des services sous le contrôle de l'utilisateur en lui permettant de démarrer, arrêter, activer ou désactiver une <b>unité utilisateur</b>. Cette option est pratique pour les daemons et autres services qui ne sont généralement exécutés que pour un seul utilisateur, comme <a href="../../fr/Music_Player_Daemon.html" title="Music Player Daemon (Français)">mpd</a>, ou pour effectuer des tâches automatisées comme la récupération du courrier électronique. 
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Fonctionnement">Fonctionnement</span></h2>
<p>Selon la configuration par défaut dans <code>/etc/pam.d/system-login</code>, le module <code>pam_systemd</code> lance automatiquement une instance <code>systemd --user</code> lorsque l'utilisateur se connecte pour la première fois. Ce processus survivra tant qu'il y aura une session pour cet utilisateur, et sera tué dès que la dernière session de l'utilisateur sera fermée. Lorsque <a href="#D%C3%A9marrage_automatique_des_instances_utilisateur_systemd">#Démarrage automatique des instances utilisateur systemd</a> est activé, l'instance est démarrée au démarrage et ne sera pas tuée. L'instance utilisateur systemd est responsable de la gestion des services utilisateurs, qui peuvent être utilisés pour exécuter des daemons ou des tâches automatisées, avec tous les avantages de systemd, tels que l'activation des sockets, les timers, le système de dépendances ou le contrôle strict des processus via les cgroups.
</p>
<p>De la même manière que les unités système, les unités utilisateur sont situées dans les répertoires suivants (classés par ordre de préséance ascendante) :
</p>
<ul>
<li>
<code>/usr/lib/systemd/user/</code> où appartiennent les unités fournies par les paquets installés.</li>
<li>
<code>~/.local/share/systemd/user/</code> où appartiennent les unités des paquets qui ont été installés dans le répertoire personnel.</li>
<li>
<code>/etc/systemd/user/</code> où sont placées les unités des utilisateurs du système par l'administrateur système.</li>
<li>
<code>~/.config/systemd/user/</code> où l'utilisateur place ses propres unités.</li>
</ul>
<p>Lorsqu'une instance utilisateur de systemd démarre, elle active la cible par utilisateur <code>default.target</code>. Les autres unités peuvent être contrôlées manuellement avec <code>systemctl --user</code>. Consultez <span class="plainlinks archwiki-template-man" title="$ man 7 systemd.special"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.special.7#UNITS_MANAGED_BY_THE_USER_SERVICE_MANAGER">systemd.special(7) § UNITS MANAGED BY THE USER SERVICE MANAGER</a></span>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Sachez que l'instance <code>systemd --user</code> est un processus par utilisateur, et non par session. La raison en est que la plupart des ressources gérées par les services utilisateur, comme les sockets ou les fichiers d'état, seront par utilisateur (dans le répertoire personnel de l'utilisateur) et non par session. Cela signifie que tous les services utilisateur s'exécutent en dehors d'une session. Par conséquent, les programmes qui doivent être exécutés à l'intérieur d'une session seront probablement interrompus dans les services utilisateur. La façon dont systemd gère les sessions utilisateur est en pleine évolution. Consultez <a rel="nofollow" class="external autonumber" href="https://mail.gnome.org/archives/desktop-devel-list/2014-January/msg00079.html">[1]</a> et <a rel="nofollow" class="external autonumber" href="https://lists.freedesktop.org/archives/systemd-devel/2014-March/017552.html">[2]</a> pour obtenir des indications sur l'avancement.</li>
<li>
<code>systemd --user</code> s'exécute comme un processus distinct du processus <code>systemd --system</code>. Les unités de l'utilisateur ne peuvent pas référencer ou dépendre des unités du système ou des unités d'autres utilisateurs.</li>
</ul>
</div>
<h2><span class="mw-headline" id="Configuration_de_base">Configuration de base</span></h2>
<p>Toutes les unités de l'utilisateur seront placées dans <code>~/.config/systemd/user/</code>. Si vous voulez démarrer les unités à la première connexion, exécutez <code>systemctl --user enable <i>unit</i></code> pour toute unité que vous voulez démarrer automatiquement.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Astuce:</strong> Si vous voulez activer une unité pour tous les utilisateurs plutôt que pour l'utilisateur qui exécute la commande <i>systemctl</i>, exécutez <code>systemctl --global enable <i>unit</i></code> en tant que root. De même pour <code>disable</code>.</div>
<h3>
<span id="Variables_d.27environnement"></span><span class="mw-headline" id="Variables_d'environnement">Variables d'environnement</span>
</h3>
<p>L'instance utilisateur de systemd n'hérite d'aucune des <a href="../../en/Environment_variables.html" title="Environment variables">variables d'environnement</a> définies dans des endroits comme <code>.bashrc</code>, etc. Il existe plusieurs façons de définir les variables d'environnement pour l'instance utilisateur de systemd :
</p>
<ul>
<li>Pour les utilisateurs ayant un répertoire <code>$HOME</code>, créez un fichier <i>.conf</i> dans le répertoire <code>~/.config/environment.d/</code> avec des lignes de la forme <code>NAME=VAL</code>. Affecte uniquement l'unité utilisateur de cet utilisateur. Consultez <span class="plainlinks archwiki-template-man" title="$ man 5 environment.d"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/environment.d.5">environment.d(5)</a></span> pour plus d'informations.</li>
<li>Utiliser l'option <code>DefaultEnvironment</code> dans le fichier <code>/etc/systemd/user.conf</code>. Affecte toutes les unités utilisateur.</li>
<li>Ajouter un fichier de configuration de dépôt dans <code>/etc/systemd/system/user@.service.d/</code>. Affecte toutes les unités utilisateur ; consultez <a href="#Exemple_de_service">#Exemple de service</a>.</li>
<li>A tout moment, utilisez <code>systemctl --user set-environment</code> ou <code>systemctl --user import-environment</code>. Affecte toutes les unités utilisateur démarrées après la définition des variables d'environnement, mais pas les unités qui étaient déjà en cours d'exécution.</li>
<li>Utiliser la commande <code>dbus-update-activation-environment --systemd --all</code> fournie par <a href="../../en/D-Bus.html" class="mw-redirect" title="Dbus">dbus</a>. A le même effet que <code>systemctl --user import-environment</code>, mais affecte également la session D-Bus. Vous pouvez ajouter ceci à la fin de votre fichier d'initialisation du shell.</li>
<li>Pour les variables d'environnement "globales" pour l'environnement de l'utilisateur, vous pouvez utiliser les répertoires <code>environment.d</code> qui sont analysés par certains générateurs. Consultez <span class="plainlinks archwiki-template-man" title="$ man 5 environment.d"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/environment.d.5">environment.d(5)</a></span> et <span class="plainlinks archwiki-template-man" title="$ man 7 systemd.generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.generator.7">systemd.generator(7)</a></span> pour plus d'informations.</li>
<li>Vous pouvez également écrire un script <span class="plainlinks archwiki-template-man" title="$ man 7 systemd.environment-generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.environment-generator.7">systemd.environment-generator(7)</a></span> qui peut produire des variables d'environnement qui varient d'un utilisateur à l'autre, c'est probablement la meilleure façon si vous avez besoin d'environnements par utilisateur (c'est le cas pour <code>XDG_RUNTIME_DIR</code>, <code>DBUS_SESSION_BUS_ADDRESS</code>, etc).</li>
</ul>
<p>Une variable que vous pouvez vouloir définir est <code>PATH</code>.
</p>
<p>Après la configuration, la commande <code>systemctl --user show-environment</code> peut être utilisée pour vérifier que les valeurs sont correctes.
</p>
<h4><span class="mw-headline" id="Exemple_de_service">Exemple de service</span></h4>
<p>Créez le répertoire <a href="../../fr/Systemd.html#Fichiers_de_substitution" title="Systemd (Français)">«drop-in»</a> <code>/etc/systemd/system/user@.service.d/</code> et créez à l'intérieur un fichier ayant l'extension <i>.conf</i> (par exemple <code>local.conf</code>) :
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/user@.service.d/local.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
Environment="PATH=/usr/lib/ccache/bin:/usr/local/bin:/usr/bin:/bin"
Environment="EDITOR=nano -c"
Environment="BROWSER=firefox"
Environment="NO_AT_BRIDGE=1"</pre>
<h4><span class="mw-headline" id="DISPLAY_et_XAUTHORITY">DISPLAY et XAUTHORITY</span></h4>
<p><code>DISPLAY</code> est utilisé par toute application X pour savoir quel affichage utiliser et <code>XAUTHORITY</code> pour fournir un chemin vers le fichier <code>.Xauthority</code> de l'utilisateur et donc le cookie nécessaire pour accéder au serveur X. Si vous prévoyez de lancer des applications X à partir d'unités systemd, ces variables doivent être définies. Systemd fournit un script dans <code>/etc/X11/xinit/xinitrc.d/50-systemd-user.sh</code> pour importer ces variables dans la session de l'utilisateur systemd au lancement de l'application. <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/blob/v219/NEWS#L194">[3]</a> Donc, à moins que vous ne démarriez X d'une manière non standard, les services utilisateurs devraient être conscients des variables <code>DISPLAY</code> et <code>XAUTHORITY</code>.
</p>
<h4><span class="mw-headline" id="PATH">PATH</span></h4>
<p>Si vous personnalisez votre <code>PATH</code> et prévoyez de lancer des applications qui l'utilisent à partir d'unités systemd, vous devez vous assurer que le <code>PATH</code> modifié est défini dans l'environnement systemd. En supposant que vous avez défini votre <code>PATH</code> dans <code>.bash_profile</code>, la meilleure façon de faire connaître à systemd votre <code>PATH</code> modifié est d'ajouter ce qui suit à <code>.bash_profile</code> après la définition de la variable <code>PATH</code> :
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.bash_profile</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">systemctl --user import-environnement PATH
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 	
<ul>
<li>Cela n'affectera pas les services systemd démarrés avant l'importation du <code>PATH</code>.</li>
<li>
<i>systemd</i> ne regarde pas le <code>PATH</code> défini lorsqu'il résout lui-même les binaires sans chemin absolus.</li>
</ul>
</div>
<h4><span class="mw-headline" id="pam_env">pam_env</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Cette façon de définir les variables d'environnement par utilisateur est obsolète et sera supprimée.</div>
<p>Les variables d'environnement peuvent être rendues disponibles par l'utilisation du module <code>pam_env.so</code>. Consultez <a href="../../en/Environment_variables.html#Using_pam_env" title="Environment variables">Environment variables#Using pam_env</a> pour les détails de configuration.
</p>
<h3>
<span id="D.C3.A9marrage_automatique_des_instances_utilisateur_systemd"></span><span class="mw-headline" id="Démarrage_automatique_des_instances_utilisateur_systemd">Démarrage automatique des instances utilisateur systemd</span>
</h3>
<p>L'instance utilisateur systemd est démarrée après la première connexion d'un utilisateur et tuée après la fermeture de la dernière session de l'utilisateur. Parfois, il peut être utile de la lancer juste après le démarrage, et de maintenir l'instance utilisateur systemd en cours d'exécution après la fermeture de la dernière session, par exemple pour avoir un processus utilisateur en cours d'exécution sans aucune session ouverte. Lingering est utilisé à cet effet. Utilisez la commande suivante pour activer le lingering pour un utilisateur spécifique :
</p>
<pre># loginctl enable-linger <i>username</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Attention:</strong> Les services Systemd ne sont <b>pas</b> des sessions, ils s'exécutent en dehors de <i>logind</i>. N'utilisez pas le lingering pour activer la connexion automatique car cela <a href="../../fr/General_troubleshooting.html#Permissions_de_session" title="General troubleshooting (Français)">casse la session</a>.</div>
<h2>
<span id=".C3.89crire_des_unit.C3.A9s_utilisateur"></span><span class="mw-headline" id="Écrire_des_unités_utilisateur">Écrire des unités utilisateur</span>
</h2>
<p>Consultez <a href="../../fr/Systemd.html#%C3%89crire_des_unit%C3%A9s" title="Systemd (Français)">Systemd (Français)#Écrire des unités</a> pour des informations générales sur l'écriture des fichiers d'unités de systemd.
</p>
<h3><span class="mw-headline" id="Exemple">Exemple</span></h3>
<p>Voici un exemple d'une version utilisateur du service mpd :
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/mpd.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Music Player Daemon

[Service]
ExecStart=/usr/bin/mpd --no-daemon

[Install]
WantedBy=default.target</pre>
<h3><span class="mw-headline" id="Exemple_avec_variables">Exemple avec variables</span></h3>
<p>Ci-dessous, le service utilisateur de <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/foldingathome/">foldingathome</a></span><sup><small>AUR</small></sup>, qui tient compte par une variable des répertoires personnels où <a href="../../en/Folding@home.html" title="Folding@home">Folding@home</a> peut trouver certains fichiers :
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/foldingathome-user.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Folding@home distributed computing client
After=network.target

[Service]
Type=simple
WorkingDirectory=%h/.config/fah
ExecStart=/usr/bin/FAHClient
CPUSchedulingPolicy=idle
IOSchedulingClass=3

[Install]
WantedBy=default.target</pre>
<p>Comme détaillé dans <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.unit"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.unit.5#SPECIFIERS">systemd.unit(5) § SPECIFIERS</a></span>, la variable <code>%h</code> est remplacée par le répertoire personnel de l'utilisateur qui exécute le service. Il existe d'autres variables qui peuvent être prises en compte dans les pages de manuel de <a href="../../fr/Systemd.html" title="Systemd (Français)">systemd</a>.
</p>
<h3><span class="mw-headline" id="Lecture_du_journal">Lecture du journal</span></h3>
<p>Le journal de l'utilisateur peut être lu en utilisant la commande analogue :
</p>
<pre>$ journalctl --user
</pre>
<p>Pour spécifier une unité, on peut utiliser
</p>
<pre>$ journalctl --user-unit monunité.service
</pre>
<p>Ou, de manière équivalente
</p>
<pre>$ journalctl --user -u monunité.service
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> journald n'écrira pas de journaux d'utilisateur pour les utilisateurs avec des UIDs inférieurs à 1000, il <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/blob/a33687b792908aa6c9f4c0b22e8935643ee0ddb6/src/journal/journald-server.c#L402">dirigera</a> tout vers le journal du système à la place.</div>
<h2><span class="mw-headline" id="Fichiers_temporaires">Fichiers temporaires</span></h2>
<p><i>systemd-tmpfiles</i> permet aux utilisateurs de gérer des fichiers et des répertoires volatils et temporaires personnalisés, tout comme pour le système dans son ensemble (consultez <a href="../../fr/Systemd.html#systemd-tmpfiles_-_fichiers_temporaires" title="Systemd (Français)">Systemd (Français)#systemd-tmpfiles - fichiers temporaires</a>). Les fichiers de configuration spécifiques à l'utilisateur sont lus dans <code>~/.config/user-tmpfiles.d/</code> et <code>~/.local/share/user-tmpfiles.d/</code>, dans cet ordre. Pour que cette fonctionnalité puisse être utilisée, il est nécessaire d'activer les unités utilisateur systemd nécessaires pour votre utilisateur :
</p>
<pre>$ systemctl --user enable systemd-tmpfiles-setup.service systemd-tmpfiles-clean.timer
</pre>
<p>La syntaxe des fichiers de configuration est la même que celle utilisée dans tout le système. Consultez les pages de manuel <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-tmpfiles"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-tmpfiles.8">systemd-tmpfiles(8)</a></span> et <span class="plainlinks archwiki-template-man" title="$ man 5 tmpfiles.d"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/tmpfiles.d.5">tmpfiles.d(5)</a></span> pour plus de détails.
</p>
<h2><span class="mw-headline" id="Xorg_et_systemd">Xorg et systemd</span></h2>
<p>Il y a plusieurs façons d'exécuter xorg dans les unités systemd. Ci-dessous, il y a deux options, soit en démarrant une nouvelle session utilisateur avec un processus xorg, soit en lançant xorg depuis un service utilisateur systemd.
</p>
<h3>
<span id="Connexion_automatique_.C3.A0_Xorg_sans_gestionnaire_d.27affichage"></span><span class="mw-headline" id="Connexion_automatique_à_Xorg_sans_gestionnaire_d'affichage">Connexion automatique à Xorg sans gestionnaire d'affichage</span>
</h3>
<p>Cette option lancera une unité système qui démarrera une session utilisateur avec un serveur xorg, puis exécutera les <code>~/.xinitrc</code> habituels pour lancer le gestionnaire de fenêtres, etc. Vous devez avoir installé <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xlogin-git/">xlogin-git</a></span><sup><small>AUR</small></sup>. Configurez votre xinitrc comme indiqué dans la section <a href="../../fr/Xinit.html#xinitrc" title="Xinit (Français)">Xinit (Français)#xinitrc</a>.
</p>
<p>La session utilisera son propre daemon dbus, mais divers utilitaires systemd se connecteront automatiquement à l'instance <code>dbus.service</code>. Enfin, <a href="../../fr/Systemd.html#Utilisation_des_unit%C3%A9s" class="mw-redirect" title="Activez">activez</a> le service <code>xlogin@<i>username</i></code> pour une connexion automatique au démarrage. La session utilisateur vit entièrement à l'intérieur d'un scope systemd et tout ce qui se trouve dans la session utilisateur devrait fonctionner parfaitement.
</p>
<h3><span class="mw-headline" id="Xorg_comme_service_utilisateur_systemd">Xorg comme service utilisateur systemd</span></h3>
<p>Alternativement, <a href="../../fr/Xorg.html" title="Xorg (Français)">xorg</a> peut être exécuté à partir d'un service utilisateur systemd. C'est une bonne chose puisque d'autres unités liées à X peuvent être rendues dépendantes de xorg, etc, mais d'un autre côté, cela a quelques inconvénients expliqués ci-dessous.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xorg-server">xorg-server</a></span> fournit une intégration avec systemd de deux manières :
</p>
<ul>
<li>Il peut être exécuté sans privilège, déléguant la gestion des périphériques à logind (consultez les commits de Hans de Goede autour de <a rel="nofollow" class="external text" href="https://gitlab.freedesktop.org/xorg/xserver/-/commit/82863656ec449644cd34a86388ba40f36cea11e9">ce commit</a>).</li>
<li>Peut être transformé en un service activé par socket (consultez <a rel="nofollow" class="external text" href="https://gitlab.freedesktop.org/xorg/xserver/-/commit/b3d3ffd19937827bcbdb833a628f9b1814a6e189">ce commit</a>).</li>
</ul>
<p>Malheureusement, pour pouvoir exécuter xorg en mode non privilégié, il doit être exécuté dans une session. Donc, actuellement, le handicap de l'exécution de xorg en tant que service utilisateur est qu'il doit être exécuté avec les privilèges root (comme avant la 1.16), et ne peut pas profiter du mode non privilégié introduit dans la 1.16.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Ce n'est pas une restriction fondamentale imposée par logind, mais la raison semble être que xorg a besoin de savoir quelle session prendre en charge, et pour l'instant il obtient cette information en appelant <code>GetSessionByPID</code> de <a rel="nofollow" class="external text" href="https://www.freedesktop.org/wiki/Software/systemd/logind">logind</a> en utilisant son propre pid comme argument. Consultez <a rel="nofollow" class="external text" href="https://lists.x.org/archives/xorg-devel/2014-February/040476.html">cette discussion</a> et <a rel="nofollow" class="external text" href="https://gitlab.freedesktop.org/xorg/xserver/-/blob/master/hw/xfree86/os-support/linux/systemd-logind.c">les sources de xorg</a>. Il semble probable que xorg puisse être modifié pour obtenir la session à partir du tty auquel il est attaché, et qu'il puisse ensuite être exécuté sans privilège à partir d'un service utilisateur en dehors d'une session.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Attention:</strong> Sur xorg 1.18, l'activation des sockets semble ne pas fonctionner. Le client qui déclenche l'activation se bloque. Consultez le rapport de bogue amont <a rel="nofollow" class="external autonumber" href="https://gitlab.freedesktop.org/xorg/xserver/issues/491">[4]</a>. Comme solution temporaire, vous pouvez démarrer le serveur xorg sans l'activation des sockets, en vous assurant que les clients se connectent après un délai, afin que le serveur soit complètement démarré. Il semble qu'il n'existe aucun mécanisme permettant d'obtenir une notification de démarrage du serveur X.</div>
<p>Voici comment lancer xorg à partir d'un service utilisateur :
</p>
<p>1. Faites tourner xorg avec les privilèges root pour n'importe quel utilisateur, en éditant <code>/etc/X11/Xwrapper.config</code>. Ceci s'appuie sur <a href="../../fr/Xorg.html#Xorg_en_root" title="Xorg (Français)">Xorg (Français)#Xorg en root</a> en ajoutant la stipulation que cela n'a pas besoin d'être fait depuis une console physique. C'est-à-dire que le défaut de <code>allowed_user</code> de <code>console</code> est remplacé par <code>anybody</code> ; voir <span class="plainlinks archwiki-template-man" title="$ man 1 Xorg.wrap"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/Xorg.wrap.1">Xorg.wrap(1)</a></span>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/X11/Xwrapper.config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">allowed_users=anybody
needs_root_rights=yes</pre>
<p>2. Ajoutez les unités suivantes à <code>~/.config/systemd/user</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/xorg@.socket</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Socket for xorg at display %i

[Socket]
ListenStream=/tmp/.X11-unix/X%i</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/xorg@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Xorg server at display %i

Requires=xorg@%i.socket
After=xorg@%i.socket

[Service]
Type=simple
SuccessExitStatus=0 1

ExecStart=/usr/bin/Xorg :%i -nolisten tcp -noreset -verbose 2 "vt${XDG_VTNR}"</pre>
<p>où <code>${XDG_VTNR}</code> est le terminal virtuel où xorg sera lancé, soit codé en dur dans l'unité de service, soit défini dans l'environnement systemd avec
</p>
<pre>$ systemctl --user set-environment XDG_VTNR=1
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> xorg doit être lancé sur le même terminal virtuel que celui où l'utilisateur s'est connecté. Sinon, logind considérera que la session est inactive.</div>
<p>3. Assurez-vous de configurer la variable d'environnement <code>DISPLAY</code> comme expliqué <a href="#DISPLAY_et_XAUTHORITY">ci-dessus</a>.
</p>
<p>4. Ensuite, pour activer l'activation de la socket pour xorg sur l'affichage 0 et le tty 2, il faut faire :
</p>
<pre>$ systemctl --user set-environment XDG_VTNR=2 # Pour que xorg@.service sache quel vt utiliser
$ systemctl --user start xorg@0.socket # Commence à écouter sur le socket pour l'affichage 0
</pre>
<p>Maintenant, l'exécution de toute application X lancera xorg sur le terminal virtuel 2 automatiquement.
</p>
<p>La variable d'environnement <code>XDG_VTNR</code> peut être définie dans l'environnement systemd à partir de <code>.bash_profile</code>, et l'on peut alors démarrer n'importe quelle application X, y compris un gestionnaire de fenêtres, en tant qu'unité systemd qui dépend de <code>xorg@0.socket</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Attention:</strong> L'exécution actuelle d'un gestionnaire de fenêtres en tant que service utilisateur signifie qu'il fonctionne en dehors d'une session avec les problèmes que cela peut entraîner : <a href="../../fr/General_troubleshooting.html#Permissions_de_session" title="General troubleshooting (Français)">casser la session</a>. Cependant, il semble que les développeurs de systemd aient l'intention de rendre quelque chose comme cela possible. Consultez <a rel="nofollow" class="external autonumber" href="https://mail.gnome.org/archives/desktop-devel-list/2014-January/msg00079.html">[5]</a> et <a rel="nofollow" class="external autonumber" href="https://lists.freedesktop.org/archives/systemd-devel/2014-March/017552.html">[6]</a>
</div>
<h2>
<span id="Quelques_cas_d.27utilisation"></span><span class="mw-headline" id="Quelques_cas_d'utilisation">Quelques cas d'utilisation</span>
</h2>
<h3>
<span id="Gestionnaire_de_fen.C3.AAtres"></span><span class="mw-headline" id="Gestionnaire_de_fenêtres">Gestionnaire de fenêtres</span>
</h3>
<p>Pour exécuter un gestionnaire de fenêtres en tant que service systemd, vous devez d'abord exécuter <a href="#Xorg_comme_service_utilisateur_systemd">#Xorg comme service utilisateur systemd</a>. Dans ce qui suit, nous utiliserons <a href="../../en/Awesome.html" title="Awesome">awesome</a> comme exemple :
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/awesome.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Awesome window manager
After=xorg.target
Requires=xorg.target

[Service]
ExecStart=/usr/bin/awesome
Restart=always
RestartSec=10
 
[Install]
WantedBy=wm.target</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> La section <code>[Install]</code> comprend une partie <code>WantedBy</code>. L'utilisation de <code>systemctl --user enable</code> liera ce service en tant que <code>~/.config/systemd/user/wm.target.wants/<i>window_manager</i>.service</code>, ce qui permettra de le démarrer à la connexion. Il est recommandé d'activer ce service, et non de le lier manuellement.</div>
<h3><span class="mw-headline" id="Multiplexeur_de_terminal_persistant">Multiplexeur de terminal persistant</span></h3>
<p>Plutôt que de vous connecter par défaut à une session de gestionnaire de fenêtres pour votre session utilisateur, vous pouvez souhaiter exécuter automatiquement un multiplexeur de terminal (tel que <a href="../../en/Screen.html" title="Screen">screen</a> ou <a href="../../en/Tmux.html" title="Tmux">tmux</a>) en arrière-plan. 
</p>
<p><a href="../../fr/Help:Reading.html#Postposer,_ajouter,_cr%C3%A9er,_modifier" class="mw-redirect" title="Créez">Créez</a> ce qui suit : 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/multiplexer.target</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Terminal multiplexer
Documentation=info:screen man:screen(1) man:tmux(1)
After=cruft.target
Wants=cruft.target

[Install]
Alias=default.target</pre>
<p>Séparer le login du login X n'est probablement utile que pour ceux qui démarrent sur un TTY au lieu d'un gestionnaire d'affichage (dans ce cas, vous pouvez simplement regrouper tout ce que vous démarrez dans <code>mystuff.target</code>). 
</p>
<p>La dépendance <code>cruft.target</code>, comme la <code>mystuff.target</code> ci-dessus, permet de démarrer tout ce qui doit être exécuté avant le démarrage du multiplexeur (ou que vous voulez démarrer au démarrage sans tenir compte du timing), comme une session du daemon GnuPG.
</p>
<p>Vous devez ensuite créer un service pour votre session multiplexeur. Voici un exemple de service, utilisant tmux comme exemple et utilisant une session gpg-agent qui écrit ses informations dans <code>/tmp/gpg-agent-info</code>. Cette session d'exemple, lorsque vous démarrez X, sera également capable d'exécuter des programmes X, puisque <code>$DISPLAY</code> est défini : 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/tmux.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=tmux: A terminal multiplexer 
Documentation=man:tmux(1)
After=gpg-agent.service
Wants=gpg-agent.service

[Service]
Type=forking
ExecStart=/usr/bin/tmux start
ExecStop=/usr/bin/tmux kill-server
Environment=DISPLAY=:0
EnvironmentFile=/tmp/gpg-agent-info

[Install]
WantedBy=multiplexer.target</pre>
<p><a href="../../fr/Systemd.html#Utilisation_des_unit%C3%A9s" class="mw-redirect" title="Activez">Activez</a> <code>tmux.service</code>, <code>multiplexer.target</code> et tous les services que vous avez créés pour être exécutés par <code>cruft.target</code>, <a href="../../fr/Systemd.html#Utilisation_des_unit%C3%A9s" class="mw-redirect" title="Démarrez">démarrez</a> <code>user@.service</code> comme d'habitude et vous devriez avoir terminé.
</p>
<h2>
<span id="Tuer_les_processus_utilisateur_lors_de_la_d.C3.A9connexion"></span><span class="mw-headline" id="Tuer_les_processus_utilisateur_lors_de_la_déconnexion">Tuer les processus utilisateur lors de la déconnexion</span>
</h2>
<p>Arch Linux construit le paquet <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd">systemd</a></span> avec <code>--without-kill-user-processes</code>, définissant <code>KillUserProcesses</code> à <code>no</code> par défaut. Ce paramètre fait que les processus utilisateur ne sont pas tués lorsque l'utilisateur se déconnecte. Pour modifier ce comportement afin que tous les processus utilisateur soient tués lors de la déconnexion de l'utilisateur, définissez <code>KillUserProcesses=yes</code> dans <code>/etc/systemd/logind.conf</code>. 
</p>
<p>Notez que la modification de ce paramètre casse les multiplexeurs de terminaux tels que <a href="../../en/Tmux.html" title="Tmux">tmux</a> et <a href="../../en/GNU_Screen.html" title="GNU Screen">GNU Screen</a>. Si vous modifiez ce paramètre, vous pouvez toujours utiliser un multiplexeur de terminal en utilisant <code>systemd-run</code> comme suit :
</p>
<pre>$ systemd-run --scope --user <i>command</i> <i>args</i>.
</pre>
<p>Par exemple, pour exécuter <code>screen</code> vous devez faire :
</p>
<pre>$ systemd-run --scope --user screen -S <i>foo</i>
</pre>
<p>L'utilisation de <code>systemd-run</code> ne maintiendra le processus en cours d'exécution après la déconnexion que si l'utilisateur est connecté au moins une fois ailleurs dans le système et que <code>user@.service</code> est toujours en cours d'exécution. 
</p>
<p>Après que l'utilisateur se soit déconnecté de toutes les sessions, <code>user@.service</code> sera également arrêté, par défaut, à moins que l'utilisateur n'ait activé la fonction "lingering" <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/blob/76153ad45f09b6ae45464f2e03d3afefbb4b2afe/NEWS#L274">[7]</a>. Pour permettre aux utilisateurs d'exécuter des tâches à long terme même s'ils sont complètement déconnectés, la fonction "lingering" doit être activée pour eux. Consultez <a href="#D%C3%A9marrage_automatique_des_instances_utilisateur_systemd">#Démarrage automatique des instances utilisateur systemd</a> et <span class="plainlinks archwiki-template-man" title="$ man 1 loginctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/loginctl.1">loginctl(1)</a></span> pour plus de détails.
</p>
<h2>
<span id="D.C3.A9pannage"></span><span class="mw-headline" id="Dépannage">Dépannage</span>
</h2>
<h3>
<span id="Runtime_directory_.27.2Frun.2Fuser.2F1000.27_is_not_owned_by_UID_1000.2C_as_it_should"></span><span class="mw-headline" id="Runtime_directory_'/run/user/1000'_is_not_owned_by_UID_1000,_as_it_should">Runtime directory '/run/user/1000' is not owned by UID 1000, as it should</span>
</h3>
<pre>systemd[1867]: pam_systemd(systemd-user:session): Runtime directory '/run/user/1000' is not owned by UID 1000, as it should.
systemd[1867]: Trying to run as user instance, but $XDG_RUNTIME_DIR is not set
</pre>
<p>Si vous consultez des erreurs de ce type et que votre session de connexion est interrompue, il est possible qu'un autre service système (non utilisateur) sur votre système crée ce répertoire. Cela peut se produire par exemple si vous utilisez un conteneur <a href="../../en/Docker.html" title="Docker">docker</a> qui a un montage bind sur <code>/run/user/1000</code>. Pour résoudre ce problème, vous pouvez soit réparer le conteneur en supprimant le montage, soit désactiver/retarder le service docker.
</p>
<h2><span class="mw-headline" id="Voir_aussi">Voir aussi</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://bitbucket.org/KaiSforza/systemd-user-units/wiki/Home">Le wiki Bitbucket de KaiSforza</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/zoqaeski/systemd-user-units">Les unités de Zoqaeski sur GitHub</a></li>
<li><a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=167115">Fil du forum Arch sur les changements dans les instances utilisateur de systemd 206</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../fr/Category:System_administration.html" title="Category:System administration (Français)">System administration (Français)</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Systemd_(Fran%C3%A7ais)/User_(Fran%C3%A7ais)&amp;oldid=797092">https://wiki.archlinux.org/index.php?title=Systemd_(Français)/User_(Français)&amp;oldid=797092</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 14 January 2024, at 13:45.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki.svg" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul></ul>
</div>
</body>
</html>
