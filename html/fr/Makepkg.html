<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>makepkg (Français) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Makepkg_Français rootpage-Makepkg_Français skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Configuration</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-Informations_sur_le_paquet" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Informations_sur_le_paquet">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Informations sur le paquet</div>
			</a>
			
			<ul id="toc-Informations_sur_le_paquet-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Résultat_du_paquet" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#R%C3%A9sultat_du_paquet">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Résultat du paquet</div>
			</a>
			
			<ul id="toc-Résultat_du_paquet-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Vérification_des_signatures" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#V%C3%A9rification_des_signatures">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Vérification des signatures</div>
			</a>
			
			<ul id="toc-Vérification_des_signatures-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Utilisation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Utilisation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Utilisation</div>
		</a>
		
		<ul id="toc-Utilisation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Trucs_et_astuces" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Trucs_et_astuces">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Trucs et astuces</div>
		</a>
		
			<button aria-controls="toc-Trucs_et_astuces-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Trucs et astuces subsection</span>
			</button>
		
		<ul id="toc-Trucs_et_astuces-sublist" class="vector-toc-list">
			<li id="toc-Réduire_les_temps_de_téléchargement_et_d'extraction_des_sources" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#R%C3%A9duire_les_temps_de_t%C3%A9l%C3%A9chargement_et_d'extraction_des_sources">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Réduire les temps de téléchargement et d'extraction des sources</div>
			</a>
			
			<ul id="toc-Réduire_les_temps_de_téléchargement_et_d'extraction_des_sources-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Construction_de_binaires_optimisés" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Construction_de_binaires_optimis%C3%A9s">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Construction de binaires optimisés</div>
			</a>
			
			<ul id="toc-Construction_de_binaires_optimisés-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Améliorer_les_temps_de_compilation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Am%C3%A9liorer_les_temps_de_compilation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Améliorer les temps de compilation</div>
			</a>
			
			<ul id="toc-Améliorer_les_temps_de_compilation-sublist" class="vector-toc-list">
				<li id="toc-Compilation_parallèle" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Compilation_parall%C3%A8le">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.1</span>Compilation parallèle</div>
			</a>
			
			<ul id="toc-Compilation_parallèle-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Construction_à_partir_de_fichiers_en_mémoire" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Construction_%C3%A0_partir_de_fichiers_en_m%C3%A9moire">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.2</span>Construction à partir de fichiers en mémoire</div>
			</a>
			
			<ul id="toc-Construction_à_partir_de_fichiers_en_mémoire-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Utilisation_d'un_cache_de_compilation" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Utilisation_d'un_cache_de_compilation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.3</span>Utilisation d'un cache de compilation</div>
			</a>
			
			<ul id="toc-Utilisation_d'un_cache_de_compilation-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Générer_de_nouvelles_sommes_de_contrôle" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#G%C3%A9n%C3%A9rer_de_nouvelles_sommes_de_contr%C3%B4le">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4</span>Générer de nouvelles sommes de contrôle</div>
			</a>
			
			<ul id="toc-Générer_de_nouvelles_sommes_de_contrôle-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Utiliser_d'autres_algorithmes_de_compression" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Utiliser_d'autres_algorithmes_de_compression">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.5</span>Utiliser d'autres algorithmes de compression</div>
			</a>
			
			<ul id="toc-Utiliser_d'autres_algorithmes_de_compression-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Utilisation_de_plusieurs_cœurs_pour_la_compression" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Utilisation_de_plusieurs_c%C5%93urs_pour_la_compression">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.6</span>Utilisation de plusieurs cœurs pour la compression</div>
			</a>
			
			<ul id="toc-Utilisation_de_plusieurs_cœurs_pour_la_compression-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Afficher_les_paquets_avec_un_empaqueteur_spécifique" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Afficher_les_paquets_avec_un_empaqueteur_sp%C3%A9cifique">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.7</span>Afficher les paquets avec un empaqueteur spécifique</div>
			</a>
			
			<ul id="toc-Afficher_les_paquets_avec_un_empaqueteur_spécifique-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Construire_des_paquets_32_bits_sur_un_système_64_bits" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Construire_des_paquets_32_bits_sur_un_syst%C3%A8me_64_bits">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.8</span>Construire des paquets 32 bits sur un système 64 bits</div>
			</a>
			
			<ul id="toc-Construire_des_paquets_32_bits_sur_un_système_64_bits-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Dépannage" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#D%C3%A9pannage">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Dépannage</div>
		</a>
		
			<button aria-controls="toc-Dépannage-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Dépannage subsection</span>
			</button>
		
		<ul id="toc-Dépannage-sublist" class="vector-toc-list">
			<li id="toc-Spécification_du_répertoire_d'installation_pour_les_paquets_basés_sur_QMAKE" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Sp%C3%A9cification_du_r%C3%A9pertoire_d'installation_pour_les_paquets_bas%C3%A9s_sur_QMAKE">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Spécification du répertoire d'installation pour les paquets basés sur QMAKE</div>
			</a>
			
			<ul id="toc-Spécification_du_répertoire_d'installation_pour_les_paquets_basés_sur_QMAKE-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-WARNING:_Package_contains_reference_to_$srcdir" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#WARNING:_Package_contains_reference_to_$srcdir">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>WARNING: Package contains reference to $srcdir</div>
			</a>
			
			<ul id="toc-WARNING:_Package_contains_reference_to_$srcdir-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Makepkg_ne_parvient_pas_à_télécharger_les_dépendances_lorsqu'il_est_derrière_un_proxy" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Makepkg_ne_parvient_pas_%C3%A0_t%C3%A9l%C3%A9charger_les_d%C3%A9pendances_lorsqu'il_est_derri%C3%A8re_un_proxy">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Makepkg ne parvient pas à télécharger les dépendances lorsqu'il est derrière un proxy</div>
			</a>
			
			<ul id="toc-Makepkg_ne_parvient_pas_à_télécharger_les_dépendances_lorsqu'il_est_derrière_un_proxy-sublist" class="vector-toc-list">
				<li id="toc-Activer_le_proxy_en_définissant_son_URL_dans_la_XferCommand" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Activer_le_proxy_en_d%C3%A9finissant_son_URL_dans_la_XferCommand">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3.1</span>Activer le proxy en définissant son URL dans la XferCommand</div>
			</a>
			
			<ul id="toc-Activer_le_proxy_en_définissant_son_URL_dans_la_XferCommand-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Activer_le_proxy_via_env_keep_de_sudo" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Activer_le_proxy_via_env_keep_de_sudo">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3.2</span>Activer le proxy via env_keep de sudo</div>
			</a>
			
			<ul id="toc-Activer_le_proxy_via_env_keep_de_sudo-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Makepkg_échoue,_mais_make_aboutit" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Makepkg_%C3%A9choue,_mais_make_aboutit">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>Makepkg échoue, mais make aboutit</div>
			</a>
			
			<ul id="toc-Makepkg_échoue,_mais_make_aboutit-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Voir_aussi" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Voir_aussi">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Voir aussi</div>
		</a>
		
		<ul id="toc-Voir_aussi-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">makepkg (Français)</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 6 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-6" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">6 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-en mw-list-item"><a href="../en/Makepkg.html" title="Makepkg – English" lang="en" hreflang="en" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/Makepkg.html" title="Makepkg – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Makepkg" title="Makepkg – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/Makepkg.html" title="Makepkg – português" lang="pt" hreflang="pt" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Makepkg.html" title="Makepkg – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Makepkg" title="Makepkg – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="fr" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>État de la traduction:</strong> Cet article est la version francophone de <a href="../en/Makepkg.html" title="Makepkg">makepkg</a>. Date de la dernière traduction: 2022-04-30. Vous pouvez aider à synchroniser la traduction s'il y a eu des <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Makepkg&amp;diff=0&amp;oldid=712251">changements</a> dans la version anglaise.</div>
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Creating_packages.html" title="Creating packages">Creating packages</a></li>
<li><a href="../fr/PKGBUILD.html" title="PKGBUILD (Français)">PKGBUILD (Français)</a></li>
<li><a href="../en/.SRCINFO.html" title=".SRCINFO">.SRCINFO</a></li>
<li><a href="../fr/Arch_User_Repository.html" title="Arch User Repository (Français)">Arch User Repository (Français)</a></li>
<li><a href="../fr/Pacman.html" title="Pacman (Français)">pacman (Français)</a></li>
<li><a href="../fr/Official_repositories.html" title="Official repositories (Français)">Official repositories (Français)</a></li>
<li><a href="../fr/Arch_build_system.html" class="mw-redirect" title="Arch Build System (Français)">Arch Build System (Français)</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/pacman/pacman/blob/master/scripts/makepkg.sh.in">makepkg</a> est un script pour automatiser la construction de paquets. Les conditions requises pour utiliser ce script sont une plate-forme Unix capable de compiler et un <a href="../fr/PKGBUILD.html" title="PKGBUILD (Français)">PKGBUILD</a>.
</p>
<p>makepkg est fourni par le paquet <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman">pacman</a></span>.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>Consultez <span class="plainlinks archwiki-template-man" title="$ man 5 makepkg.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.conf.5">makepkg.conf(5)</a></span> pour plus de détails sur les options de configuration de <i>makepkg</i>.
</p>
<p>La configuration du système est disponible dans <code>/etc/makepkg.conf</code>, mais les changements spécifiques à l'utilisateur peuvent être effectués dans <code>$XDG_CONFIG_HOME/pacman/makepkg.conf</code> ou <code>~/.makepkg.conf</code>. Il est recommandé de vérifier la configuration avant de construire des paquets.
</p>
<h3><span class="mw-headline" id="Informations_sur_le_paquet">Informations sur le paquet</span></h3>
<p>Chaque paquet est étiqueté avec des métadonnées identifiant entre autres le <i>packager</i>. Par défaut, les paquets compilés par l'utilisateur sont marqués avec <code>Unknown Packager</code>. Si plusieurs utilisateurs compilent des paquets sur un système, ou si l'un d'entre eux distribue des paquets à d'autres utilisateurs, il est utile de fournir un contact réel. Ceci peut être fait en définissant la variable <code>PACKAGER</code> dans <code>makepkg.conf</code>.
</p>
<p>Pour vérifier cela sur un paquet installé :
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ pacman -Qi <i>package</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Packager : John Doe &lt;john@doe.com&gt;
...
</pre>
<p>Pour générer automatiquement des paquets signés, définissez également la variable <code>GPGKEY</code> dans <code>makepkg.conf</code>.
</p>
<h3>
<span id="R.C3.A9sultat_du_paquet"></span><span class="mw-headline" id="Résultat_du_paquet">Résultat du paquet</span>
</h3>
<p>Par défaut, <i>makepkg</i> crée les archives du paquet dans le répertoire de travail et télécharge les données sources directement dans le répertoire <code>src/</code>. Des chemins personnalisés peuvent être configurés, par exemple pour conserver tous les paquets construits dans <code>~/build/packages/</code> et toutes les sources dans <code>~/build/sources/</code>.
</p>
<p>Configurez les variables suivantes <code>makepkg.conf</code> si nécessaire :
</p>
<ul>
<li>
<code>PKGDEST</code> - répertoire pour le stockage des paquets résultants</li>
<li>
<code>SRCDEST</code> - répertoire pour le stockage des données <a href="../fr/PKGBUILD.html#source" title="PKGBUILD (Français)">source</a> (des liens symboliques seront placés vers <code>src/</code> s'il pointe ailleurs)</li>
<li>Répertoire <code>SRCPKGDEST</code> - répertoire pour stocker les paquets sources résultants (construits avec <code>makepkg -S</code>)</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Astuce:</strong> Le répertoire <code>PKGDEST</code> peut être nettoyé avec par exemple <code>paccache -c ~/build/packages/</code> comme décrit dans <a href="../fr/Pacman.html#Nettoyage_du_cache_des_paquets" title="Pacman (Français)">Pacman (Français)#Nettoyage du cache des paquets</a>.</div>
<h3>
<span id="V.C3.A9rification_des_signatures"></span><span class="mw-headline" id="Vérification_des_signatures">Vérification des signatures</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> La vérification des signatures implémentée dans <i>makepkg</i> n'utilise pas le trousseau de clés de pacman, mais celui de l'utilisateur.<a rel="nofollow" class="external autonumber" href="http://allanmcrae.com/2015/01/two-pgp-keyrings-for-package-management-in-arch-linux/">[1]</a>
</div>
<p>Si un fichier de signature sous la forme <i>.sig</i> ou <i>.asc</i> fait partie du tableau source de <a href="../fr/PKGBUILD.html" title="PKGBUILD (Français)">PKGBUILD</a>, <i>makepkg</i> tente automatiquement de <a href="../en/GnuPG.html#Verify_a_signature" title="GnuPG">vérifier</a> ce fichier. Si le trousseau de l'utilisateur ne contient pas la clé publique nécessaire à la vérification de la signature, <i>makepkg</i> interrompra l'installation avec un message indiquant que la clé PGP n'a pas pu être vérifiée. 
</p>
<p>Si une clé publique nécessaire pour un paquet est manquante, le <a href="../fr/PKGBUILD.html" title="PKGBUILD (Français)">PKGBUILD</a> contiendra très probablement une entrée <a href="../fr/PKGBUILD.html#validpgpkeys" title="PKGBUILD (Français)">validpgpkeys</a> avec les ID de clé requis. <a href="../en/GnuPG.html#Import_a_public_key" title="GnuPG">Importez</a>-la manuellement ou trouvez-la <a href="../en/GnuPG.html#Use_a_keyserver" title="GnuPG">sur un serveur de clés</a> et importez-la à partir de là.
</p>
<h2><span class="mw-headline" id="Utilisation">Utilisation</span></h2>
<p>Avant de continuer, <a href="../fr/Pacman.html#Installation_de_paquets" title="Pacman (Français)">installez</a> le groupe <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=base-devel">base-devel</a></span>. Les paquets appartenant à ce groupe n'ont pas besoin d'être listés comme dépendances au moment de la construction (<i>makedepends</i>) dans les fichiers <a href="../fr/PKGBUILD.html" title="PKGBUILD (Français)">PKGBUILD</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Assurez-vous que <a href="../fr/Sudo.html" title="Sudo (Français)">Sudo</a> est configuré correctement pour les commandes passées à <a href="../fr/Pacman.html" title="Pacman (Français)">pacman</a>.</li>
<li>L'exécution de <i>makepkg</i> en tant que root est <a rel="nofollow" class="external text" href="https://lists.archlinux.org/archives/list/pacman-dev@lists.archlinux.org/message/ZLRXMUGXULDHLTGSRYVGVWG3BVATV3OY/">interdite</a>. <a rel="nofollow" class="external autonumber" href="https://gitlab.archlinux.org/pacman/pacman/blob/master/NEWS">[2]</a> Outre le fait qu'un <code>PKGBUILD</code> peut contenir des commandes arbitraires, la construction en tant que root est généralement considérée comme dangereuse. <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=67561">[3]</a> Les utilisateurs qui n'ont pas accès à un compte utilisateur normal devraient exécuter makepkg avec l'utilisateur <a rel="nofollow" class="external text" href="http://allanmcrae.com/2015/01/replacing-makepkg-asroot/">nobody</a>.</li>
</ul>
</div>
<p>Pour construire un paquet, il faut d'abord créer un <a href="../fr/PKGBUILD.html" title="PKGBUILD (Français)">PKGBUILD</a>, ou script de construction, comme décrit dans <a href="../en/Creating_packages.html" title="Creating packages">Création de paquets (en)</a>. Les scripts existants sont disponibles dans l'arbre <a href="../fr/Arch_build_system.html" title="Arch build system (Français)">Arch Build System</a> <i>(ABS)</i> ou de l'<a href="../fr/Arch_User_Repository.html" title="Arch User Repository (Français)">Arch User Repository</a> <i>(AUR)</i>. Une fois en possession d'un <code>PKGBUILD</code>, allez dans le répertoire où il est enregistré et exécutez la commande suivante pour construire le paquet :
</p>
<pre>$ makepkg
</pre>
<p>Si les dépendances requises sont manquantes, <i>makepkg</i> émettra un avertissement avant d'échouer. Pour construire le paquet et installer les dépendances nécessaires, ajoutez le paramètre <code>-s</code>/<code>--syncdeps</code> :
</p>
<pre>$ makepkg --syncdeps
</pre>
<p>L'ajout du paramètre <code>-r</code>/<code>--rmdeps</code> fait que <i>makepkg</i> supprime les dépendances make plus tard, qui ne sont plus nécessaires. Si vous construisez constamment des paquets, pensez à utiliser <a href="../fr/Pacman/Tips_and_tricks.html#Suppression_des_paquets_inutilis%C3%A9s_(orphelins)" title="Pacman (Français)/Tips and tricks (Français)">Pacman (Français)/Tips and tricks (Français)#Suppression des paquets inutilisés (orphelins)</a> de temps en temps à la place.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Ces dépendances doivent être disponibles dans les dépôts configurés ; consultez <a href="../fr/Pacman.html#D%C3%A9p%C3%B4ts_et_miroirs" title="Pacman (Français)">Pacman (Français)#Dépôts et miroirs</a> pour plus de détails. Alternativement, on peut installer manuellement les dépendances avant la construction (<code>pacman -S --asdeps <i>dep1</i> <i>dep2</i></code>).</li>
<li>Seules les valeurs globales sont utilisées lors de l'installation des dépendances, c'est-à-dire que toute modification effectuée dans la fonction d'empaquetage d'un paquet divisé ne sera pas utilisée.</li>
</ul>
</div>
<p>Une fois que toutes les dépendances sont satisfaites et que le paquet se construit avec succès, un fichier paquet (<code><i>pkgname</i>-<i>pkgver</i>.pkg.tar.zst</code>) sera créé dans le répertoire de travail. Pour l'installer, utilisez <code>-i</code>/<code>--install</code>. (comme <code>pacman -U <i>pkgname</i>-<i>pkgver</i>.pkg.tar.zst</code>) :
</p>
<pre>$ makepkg --install
</pre>
<p>Pour nettoyer les fichiers et répertoires restants, comme les fichiers extraits dans le <code>$srcdir</code>, ajoutez l'option <code>-c</code>/<code>--clean</code>. Cette option est utile pour les constructions multiples du même paquet ou la mise à jour de la version du paquet, tout en utilisant le même répertoire de construction. Elle empêche les fichiers obsolètes et résiduels d'être reportés dans les nouvelles constructions :
</p>
<pre>$ makepkg --clean
</pre>
<p>Pour en savoir plus, consultez <span class="plainlinks archwiki-template-man" title="$ man 8 makepkg"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.8">makepkg(8)</a></span>.
</p>
<h2><span class="mw-headline" id="Trucs_et_astuces">Trucs et astuces</span></h2>
<h3>
<span id="R.C3.A9duire_les_temps_de_t.C3.A9l.C3.A9chargement_et_d.27extraction_des_sources"></span><span class="mw-headline" id="Réduire_les_temps_de_téléchargement_et_d'extraction_des_sources">Réduire les temps de téléchargement et d'extraction des sources</span>
</h3>
<p>Utilisez <code>SRCDEST</code>, en particulier lors de la construction de <a href="../en/VCS_package_guidelines.html" title="VCS package guidelines">paquets récupérant les sources par un logiciel de contrôle de version</a>, pour gagner du temps lors de la récupération et de la décompression des sources lors des reconstructions ultérieures.
</p>
<h3>
<span id="Construction_de_binaires_optimis.C3.A9s"></span><span class="mw-headline" id="Construction_de_binaires_optimisés">Construction de binaires optimisés</span>
</h3>
<p>Une amélioration des performances du logiciel empaqueté peut être obtenue en activant les optimisations du compilateur pour la machine hôte. L'inconvénient est que les binaires compilés pour une architecture de processeur spécifique ne fonctionneront pas correctement sur d'autres machines. Sur les machines x86_64, il y a rarement des gains de performances réels assez significatifs pour justifier d'investir du temps dans la reconstruction des paquets officiels.
</p>
<p>Cependant, il est très facile de réduire les performances en utilisant des paramètres de compilation "non standard". De nombreuses optimisations du compilateur ne sont utiles que dans certaines situations et ne devraient pas être appliquées sans discernement à tous les paquets. À moins que des tests de référence ne soient disponibles pour prouver que quelque chose est plus rapide, il y a de fortes chances que ce ne soit pas le cas ! Les articles du wiki Gentoo <a href="https://wiki.gentoo.org/wiki/GCC_optimization" class="extiw" title="gentoo:GCC optimization">GCC optimization</a> et <a href="https://wiki.gentoo.org/wiki/Safe_CFLAGS" class="extiw" title="gentoo:Safe CFLAGS">Safe CFLAGS</a> fournissent des informations plus détaillées sur l'optimisation des compilateurs.
</p>
<p>Les options passées à un compilateur C/C++ (par exemple <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gcc">gcc</a></span> ou <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=clang">clang</a></span>) sont contrôlées par les variables d'environnement <code>CFLAGS</code>, <code>CXXFLAGS</code>, et <code>CPPFLAGS</code>. Pour une utilisation dans le système de construction Arch, <i>makepkg</i> expose ces variables d'environnement comme options de configuration dans <code>makepkg.conf</code>. Les valeurs par défaut sont configurées pour produire des binaires génériques qui peuvent être installés sur une large gamme de machines.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Gardez à l'esprit que tous les systèmes de compilation n'utilisent pas les variables configurées dans <code>makepkg.conf</code>. Par exemple, <i>cmake</i> ne tient pas compte de la variable d'environnement des options du préprocesseur, <code>CPPFLAGS</code>. Par conséquent, de nombreux <a href="../fr/PKGBUILD.html" title="PKGBUILD (Français)">PKGBUILDs</a> contiennent des solutions de contournement avec des options spécifiques au système de construction utilisé par le logiciel paqueté.</li>
<li>La configuration fournie avec le code source dans le <code>Makefile</code> ou un argument spécifique dans la ligne de commande de compilation est prioritaire et peut potentiellement remplacer celle dans <code>makepkg.conf</code>.</li>
</ul>
</div>
<p>GCC peut détecter et activer automatiquement des optimisations sûres spécifiques à l'architecture. Pour utiliser cette fonctionnalité, supprimez d'abord les paramètres <code>-march</code> et <code>-mtune</code>, puis ajoutez <code>-march=native</code>. Par exemple :
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CFLAGS="<b>-march=native</b> -O2 -pipe -fno-plt"
CXXFLAGS="${CFLAGS}"</pre>
<p>Pour consulter les paramètres activés, exécutez :
</p>
<pre>$ gcc -march=native -v -Q --help=target
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Spécifier des valeurs différentes au lieu de <code>-march=native</code>, alors <code>-Q --help=target</code> ne fonctionnera pas comme prévu. <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?pid=1616694#p1616694">[4]</a> Pour savoir quelles options sont réellement activées, effectuez une compilation. Consultez <a href="https://wiki.gentoo.org/wiki/Safe_CFLAGS#Manual" class="extiw" title="gentoo:Safe CFLAGS">Gentoo:Safe CFLAGS#Manual</a> pour obtenir des instructions.</div>
<p>À partir de la version 5.2.2 de <code>pacman</code>, <code>makepkg.conf</code> inclut également des dérogations pour la variable d'environnement <code>RUSTFLAGS</code>, pour les paramètres donnés au compilateur Rust. Le compilateur Rust peut également détecter et activer des optimisations spécifiques à l'architecture en ajoutant <code>-C target-cpu=native</code> à la valeur <code>RUSTFLAGS</code> donnée :
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">RUSTFLAGS="-C opt-level=2 <b>-C target-cpu=native</b>"</pre>
<p>Pour consulter les fonctionnalités du CPU que cela va activer, exécutez :
</p>
<pre>$ rustc -C target-cpu=native --print cfg
</pre>
<p>L'exécution de <code>--print cfg</code> sans <code>-C target-cpu=native</code> affichera la configuration par défaut. Le paramètre <code>opt-level</code> peut être changé en <code>3</code>, <code>s</code>, ou <code>z</code> selon les besoins. Consultez <a rel="nofollow" class="external text" href="https://doc.rust-lang.org/rustc/codegen-options/index.html#opt-level">La documentation du compilateur Rust</a> pour plus de détails.
</p>
<h3>
<span id="Am.C3.A9liorer_les_temps_de_compilation"></span><span class="mw-headline" id="Améliorer_les_temps_de_compilation">Améliorer les temps de compilation</span>
</h3>
<h4>
<span id="Compilation_parall.C3.A8le"></span><span class="mw-headline" id="Compilation_parallèle">Compilation parallèle</span>
</h4>
<p>Le système de compilation <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=make">make</a></span> utilise la <a href="../en/Environment_variables.html" title="Environment variables">variable d'environnement</a> <code>MAKEFLAGS</code> pour spécifier des options supplémentaires à <i>make</i>. La variable peut également être définie dans le fichier <code>makepkg.conf</code>.
</p>
<p>Les utilisateurs de systèmes multi-core/multi-processeurs peuvent spécifier le nombre de tâches à exécuter simultanément. Ceci peut être accompli avec l'utilisation de <i>nproc</i> pour déterminer le nombre de processeurs disponibles, par exemple <code>MAKEFLAGS="-j$(nproc)"</code>. Certains <a href="../fr/PKGBUILD.html" title="PKGBUILD (Français)">PKGBUILDs</a> remplacent spécifiquement cela par <code>-j1</code>, à cause de conditions de concurrence critique dans certaines versions ou simplement parce que cela n'est pas pris en charge en premier lieu. Les paquets qui ne se construisent pas à cause de cela devraient être <a href="../en/Bug_reporting_guidelines.html" title="Bug reporting guidelines">signalés</a> sur le suivi des bogues (ou dans le cas des paquets <a href="../fr/Arch_User_Repository.html" title="Arch User Repository (Français)">AUR</a>, au mainteneur du paquet) après s'être assuré que l'erreur est bien causée par <code>MAKEFLAGS</code>.
</p>
<p>Consultez <span class="plainlinks archwiki-template-man" title="$ man 1 make"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/make.1">make(1)</a></span> pour une liste complète des options disponibles.
</p>
<h4>
<span id="Construction_.C3.A0_partir_de_fichiers_en_m.C3.A9moire"></span><span class="mw-headline" id="Construction_à_partir_de_fichiers_en_mémoire">Construction à partir de fichiers en mémoire</span>
</h4>
<p>Comme la compilation nécessite de nombreuses opérations d'E/S et la manipulation de petits fichiers, le déplacement du répertoire de travail vers un <a href="../fr/Tmpfs.html" title="Tmpfs (Français)">tmpfs</a> peut améliorer les temps de construction. 
</p>
<p>La variable <code>BUILDDIR</code> peut être temporairement exportée vers <i>makepkg</i> pour définir le répertoire de construction vers un tmpfs existant. Par exemple :
</p>
<pre>$ BUILDDIR=/tmp/makepkg makepkg
</pre>
<p>La configuration persistante peut être faite dans <code>makepkg.conf</code> en décommentant l'option <code>BUILDDIR</code>, qui se trouve à la fin de la section <code>BUILD ENVIRONMENT</code> dans le fichier par défaut <code>/etc/makepkg.conf</code>. En donnant à cette option la valeur <code>BUILDDIR=/tmp/makepkg</code>, on utilisera le système de fichiers temporaires <code>/tmp</code> par défaut de l'Arch.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Évitez de compiler les paquets les plus volumineux dans tmpfs pour ne pas manquer de mémoire.</li>
<li>Le répertoire tmpfs doit être monté sans l'option <code>noexec</code>, sinon il empêchera l'exécution des binaires construits.</li>
<li>Gardez à l'esprit que les paquets compilés dans tmpfs ne persisteront pas après un redémarrage. Envisagez de définir l'option <a href="#R%C3%A9sultat_du_paquet">PKGDEST</a> de manière appropriée pour déplacer le paquet construit automatiquement dans un répertoire persistant.</li>
</ul>
</div>
<h4>
<span id="Utilisation_d.27un_cache_de_compilation"></span><span class="mw-headline" id="Utilisation_d'un_cache_de_compilation">Utilisation d'un cache de compilation</span>
</h4>
<p>L'utilisation de <a href="../en/Ccache.html" title="Ccache">ccache</a> peut améliorer les temps de construction en mettant en cache les résultats des compilations pour une utilisation successive.
</p>
<h3>
<span id="G.C3.A9n.C3.A9rer_de_nouvelles_sommes_de_contr.C3.B4le"></span><span class="mw-headline" id="Générer_de_nouvelles_sommes_de_contrôle">Générer de nouvelles sommes de contrôle</span>
</h3>
<p>Installez <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman-contrib">pacman-contrib</a></span> et exécutez la commande suivante dans le même répertoire que le fichier PKGBUILD pour générer de nouvelles sommes de contrôle :
</p>
<pre>$ updpkgsums
</pre>
<p><code>updpkgsums</code> utilise <code>makepkg --geninteg</code> pour générer les sommes de contrôle. Consultez <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1933763#p1933763">cette discussion du forum</a> pour plus de détails.
</p>
<p>Les sommes de contrôle peuvent également être obtenues avec, par exemple, <code>sha256sum</code> et ajoutées au tableau <code>sha256sums</code> à la main.
</p>
<h3>
<span id="Utiliser_d.27autres_algorithmes_de_compression"></span><span class="mw-headline" id="Utiliser_d'autres_algorithmes_de_compression">Utiliser d'autres algorithmes de compression</span>
</h3>
<p>Pour accélérer à la fois l'empaquetage et l'installation, avec pour contrepartie des archives de paquets plus volumineuses, modifiez <code>PKGEXT</code>.
</p>
<p>Par exemple, l'exemple suivant ne compresse pas le fichier du paquet, qui n'aura pas besoin d'être décompressé lors de l'<a href="../fr/Pacman.html#Installation_de_paquets" title="Pacman (Français)">installation</a> :
</p>
<pre>$ PKGEXT='.pkg.tar' makepkg
</pre>
<p>Comme autre exemple, ce qui suit utilise l'algorithme lzop, avec le paquet <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lzop">lzop</a></span> requis :
</p>
<pre>$ PKGEXT='.pkg.tar.lzo' makepkg
</pre>
<p>Pour rendre l'un de ces paramètres permanent, définissez <code>PKGEXT</code> dans <code>/etc/makepkg.conf</code>.
</p>
<h3>
<span id="Utilisation_de_plusieurs_c.C5.93urs_pour_la_compression"></span><span class="mw-headline" id="Utilisation_de_plusieurs_cœurs_pour_la_compression">Utilisation de plusieurs cœurs pour la compression</span>
</h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xz">xz</a></span> prend en charge <a href="https://en.wikipedia.org/wiki/fr:Symmetric_multiprocessing" class="extiw" title="wikipedia:fr:Symmetric multiprocessing">plusieurs processeurs en simultané</a> via le paramètre <code>--threads</code> pour accélérer la compression. Par exemple, pour laisser makepkg utiliser autant de cœurs de CPU que possible pour compresser les paquets, éditez le tableau <code>COMPRESSXZ</code> dans <code>/etc/makepkg.conf</code> :
</p>
<pre>COMPRESSXZ=(xz -c -z <b>--threads=0</b> -)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pigz">pigz</a></span> est une implémentation parallèle qui remplace sans autres modifications <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gzip">gzip</a></span> et utilise par défaut tous les cœurs disponibles du CPU (le paramètre <code>-p/--processes</code> peut être utilisé pour utiliser moins de cœurs) :
</p>
<pre>COMPRESSGZ=('<i>pigz</i> -c -f -n)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pbzip2">pbzip2</a></span> est une implémentation parallèle qui remplace sans autres modifications <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bzip2">bzip2</a></span> et utilise également tous les cœurs de processeur disponibles par défaut. Le paramètre <code>-p#</code> peut être utilisé pour utiliser moins de cœurs (note : pas d'espace entre le <code>-p</code> et le nombre de cœurs).
</p>
<pre>COMPRESSBZ2=(<b>pbzip2</b> -c -f)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=zstd">zstd</a></span> prend en charge <a href="https://en.wikipedia.org/wiki/fr:Symmetric_multiprocessing" class="extiw" title="wikipedia:fr:Symmetric multiprocessing">plusieurs processeurs en simultané</a> via le paramètre <code>--threads</code> pour accélérer la compression. Par exemple, pour laisser makepkg utiliser autant de cœurs de CPU que possible pour compresser les paquets, éditez le tableau <code>COMPRESSZST</code> dans <code>/etc/makepkg.conf</code> :
</p>
<pre>COMPRESSZST=(zstd -c -z -q <b>--threads=0</b> -)
</pre>
<h3>
<span id="Afficher_les_paquets_avec_un_empaqueteur_sp.C3.A9cifique"></span><span class="mw-headline" id="Afficher_les_paquets_avec_un_empaqueteur_spécifique">Afficher les paquets avec un empaqueteur spécifique</span>
</h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=expac">expac</a></span> est un utilitaire d'extraction de base de données de pacman. Cette commande affiche tous les paquets installés sur le système avec le packager nommé <i>nomdupaquet</i> :
</p>
<pre>$ expac "%n %p" | grep "<i>packagername</i>" | colonne -t
</pre>
<p>Cette commande affiche tous les paquets installés sur le système avec l'empaqueteur défini dans la variable <code>/etc/makepkg</code> <code>PACKAGER</code> et montre seulement les paquets qui sont dans un dépôt défini dans <code>/etc/pacman.conf</code>.
</p>
<pre>$ . /etc/makepkg.conf ; grep -xvFf &lt;(pacman -Qqm) &lt;(expac "%n\t%p" | grep "$PACKAGER$" | cut -f1)
</pre>
<h3>
<span id="Construire_des_paquets_32_bits_sur_un_syst.C3.A8me_64_bits"></span><span class="mw-headline" id="Construire_des_paquets_32_bits_sur_un_système_64_bits">Construire des paquets 32 bits sur un système 64 bits</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Attention:</strong> Des erreurs ont été signalées lors de l'utilisation de cette méthode pour construire le paquet <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span>.</div>
<p>Tout d'abord, activez le dépôt <a href="../fr/Official_repositories.html#multilib" title="Official repositories (Français)">multilib</a> et <a href="../fr/Pacman.html#Installation_de_paquets" title="Pacman (Français)">installez</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=multilib-devel">multilib-devel</a></span>.
</p>
<p>Créez ensuite un fichier de configuration 32 bits
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.makepkg.i686.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CARCH="i686"
CHOST="i686-unknown-linux-gnu"
CFLAGS="-m32 -march=i686 -mtune=generic -O2 -pipe"
CXXFLAGS="${CFLAGS}"
LDFLAGS="-m32 -Wl,-O1,--sort-common,--as-needed,-z,relro"</pre>
<p>et invoquez makepkg comme suit
</p>
<pre>$ linux32 makepkg --config ~/.makepkg.i686.conf
</pre>
<h2>
<span id="D.C3.A9pannage"></span><span class="mw-headline" id="Dépannage">Dépannage</span>
</h2>
<h3>
<span id="Sp.C3.A9cification_du_r.C3.A9pertoire_d.27installation_pour_les_paquets_bas.C3.A9s_sur_QMAKE"></span><span class="mw-headline" id="Spécification_du_répertoire_d'installation_pour_les_paquets_basés_sur_QMAKE">Spécification du répertoire d'installation pour les paquets basés sur QMAKE</span>
</h3>
<p>Le fichier makefile généré par <i>qmake</i> utilise la variable d'environnement <code>INSTALL_ROOT</code> pour spécifier où le programme doit être installé. Ainsi, cette fonction d'empaquetage devrait fonctionner :
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">PKGBUILD</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
package() {
	cd "$srcdir/${pkgname%-git}" ($srcdir/${pkgname%-git})
	make INSTALL_ROOT="$pkgdir" install
}
...</pre>
<p>Notez que qmake doit également être configuré de manière appropriée. Par exemple, mettez ceci dans le fichier <i>.pro</i> correspondant :
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">VotreProjet.pro</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
target.path = /usr/local/bin
INSTALLATIONS += cible
...</pre>
<h3>
<span id="WARNING:_Package_contains_reference_to_.24srcdir"></span><span class="mw-headline" id="WARNING:_Package_contains_reference_to_$srcdir">WARNING: Package contains reference to $srcdir</span>
</h3>
<p>D'une manière ou d'une autre, les chaînes littérales contenues dans les variables <code>$srcdir</code> ou <code>$pkgdir</code> se sont retrouvées dans l'un des fichiers installés dans le paquet.
</p>
<p>Pour identifier ces fichiers, exécutez la commande suivante depuis le répertoire de construction de <i>makepkg</i> :
</p>
<pre>$ grep -R "$PWD/src" pkg/
</pre>
<p>Une cause possible serait l'utilisation de la macro <code>__FILE__</code> dans le code C/C++ avec le chemin complet passé au compilateur.
</p>
<h3>
<span id="Makepkg_ne_parvient_pas_.C3.A0_t.C3.A9l.C3.A9charger_les_d.C3.A9pendances_lorsqu.27il_est_derri.C3.A8re_un_proxy"></span><span class="mw-headline" id="Makepkg_ne_parvient_pas_à_télécharger_les_dépendances_lorsqu'il_est_derrière_un_proxy">Makepkg ne parvient pas à télécharger les dépendances lorsqu'il est derrière un proxy</span>
</h3>
<p>Lorsque <i>makepkg</i> appelle les dépendances, il appelle pacman pour installer les paquets, ce qui nécessite des privilèges administratifs via <i>sudo</i>. Cependant, <i>sudo</i> ne passe aucune <a href="../en/Environment_variables.html" title="Environment variables">variable d'environnement</a> à l'environnement privilégié, et inclut les variables liées au proxy <code>ftp_proxy</code>, <code>http_proxy</code>, <code>https_proxy</code>, et <code>no_proxy</code>.
</p>
<p>Afin de faire fonctionner <i>makepkg</i> derrière un proxy, invoquez l'une des méthodes suivantes.
</p>
<h4>
<span id="Activer_le_proxy_en_d.C3.A9finissant_son_URL_dans_la_XferCommand"></span><span class="mw-headline" id="Activer_le_proxy_en_définissant_son_URL_dans_la_XferCommand">Activer le proxy en définissant son URL dans la XferCommand</span>
</h4>
<p>La XferCommand peut être configurée pour utiliser l'URL du proxy souhaité dans <code>/etc/pacman.conf</code>.  Ajoutez ou décommentez la ligne suivante dans <code>pacman.conf</code> <a rel="nofollow" class="external autonumber" href="https://www.mail-archive.com/arch-general@archlinux.org/msg15561.html">[5]</a> :
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
XferCommand = /usr/bin/curl -x http://username:password@proxy.proxyhost.com:80 -L -C - -f -o %o %u
...
</pre>
<h4><span class="mw-headline" id="Activer_le_proxy_via_env_keep_de_sudo">Activer le proxy via env_keep de sudo</span></h4>
<p>Alternativement, on peut vouloir utiliser l'option <code>env_keep</code> de sudo, qui permet de préserver des variables données l'environnement privilégié. Consultez <a href="../en/Sudo.html#Environment_variables" title="Sudo">Sudo#Environment variables</a> pour plus d'informations.
</p>
<h3>
<span id="Makepkg_.C3.A9choue.2C_mais_make_aboutit"></span><span class="mw-headline" id="Makepkg_échoue,_mais_make_aboutit">Makepkg échoue, mais make aboutit</span>
</h3>
<p>Si quelque chose se compile avec succès avec <i>make</i>, mais échoue avec <i>makepkg</i>, c'est presque certainement parce que <code>/etc/makepkg.conf</code> définit une variable de compilation incompatible.  Essayez d'ajouter ces paramètres au tableau PKGBUILD <code>options</code> :
</p>
<p><code>!buildflags</code>, pour empêcher ses <code>CPPFLAGS</code>, <code>CFLAGS</code>, <code>CXXFLAGS</code>, et <code>LDFLAGS</code>} par défaut.
</p>
<p><code>!makeflags</code>, pour empêcher sa valeur par défaut <code>MAKEFLAGS</code>.
</p>
<p><code>!debug</code>, pour empêcher son défaut <code>DEBUG_CFLAGS</code>, et <code>DEBUG_CXXFLAGS</code>, au cas où le PKGBUILD est un build de débogage.
</p>
<p>Si l'un d'entre eux résout le problème, cela pourrait justifier un rapport de bogue en amont en supposant que le paramètre incriminé a été identifié.
</p>
<h2><span class="mw-headline" id="Voir_aussi">Voir aussi</span></h2>
<ul>
<li><span class="plainlinks archwiki-template-man" title="$ man 8 makepkg"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.8">makepkg(8)</a></span></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 5 makepkg.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.conf.5">makepkg.conf(5)</a></span></li>
<li><a rel="nofollow" class="external text" href="https://gist.github.com/Earnestly/bebad057f40a662b5cc3">Un bref tour du processus Makepkg</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/pacman/pacman/blob/master/scripts/makepkg.sh.in">code source de makepkg</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../fr/Category:Package_development.html" title="Category:Package development (Français)">Package development (Français)</a></li>
<li><a href="../fr/Category:About_Arch.html" title="Category:About Arch (Français)">About Arch (Français)</a></li>
<li><a href="../fr/Category:Commands.html" title="Category:Commands (Français)">Commands (Français)</a></li>
</ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Makepkg_(Fran%C3%A7ais)&amp;oldid=799295">https://wiki.archlinux.org/index.php?title=Makepkg_(Français)&amp;oldid=799295</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 1 February 2024, at 18:07.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
