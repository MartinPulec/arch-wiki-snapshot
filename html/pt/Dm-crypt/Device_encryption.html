<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>dm-crypt (Português)/Device encryption (Português) - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.45.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Dm-crypt_Português_Device_encryption_Português rootpage-Dm-crypt_Português skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Preparação" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Prepara%C3%A7%C3%A3o">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Preparação</span>
			</div>
		</a>
		
		<ul id="toc-Preparação-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Utilização_do_cryptsetup" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Utiliza%C3%A7%C3%A3o_do_cryptsetup">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Utilização do cryptsetup</span>
			</div>
		</a>
		
			<button aria-controls="toc-Utilização_do_cryptsetup-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Utilização do cryptsetup subsection</span>
			</button>
		
		<ul id="toc-Utilização_do_cryptsetup-sublist" class="vector-toc-list">
			<li id="toc-Senhas_e_chaves_do_cryptsetup" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Senhas_e_chaves_do_cryptsetup">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>Senhas e chaves do cryptsetup</span>
				</div>
			</a>
			
			<ul id="toc-Senhas_e_chaves_do_cryptsetup-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Opções_de_encriptação" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Op%C3%A7%C3%B5es_de_encripta%C3%A7%C3%A3o">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Opções de encriptação</span>
			</div>
		</a>
		
			<button aria-controls="toc-Opções_de_encriptação-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Opções de encriptação subsection</span>
			</button>
		
		<ul id="toc-Opções_de_encriptação-sublist" class="vector-toc-list">
			<li id="toc-Opções_de_encriptação_para_o_modo_LUKS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Op%C3%A7%C3%B5es_de_encripta%C3%A7%C3%A3o_para_o_modo_LUKS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>Opções de encriptação para o modo LUKS</span>
				</div>
			</a>
			
			<ul id="toc-Opções_de_encriptação_para_o_modo_LUKS-sublist" class="vector-toc-list">
				<li id="toc-Tempo_de_iteração" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Tempo_de_itera%C3%A7%C3%A3o">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.1</span>
					<span>Tempo de iteração</span>
				</div>
			</a>
			
			<ul id="toc-Tempo_de_iteração-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Opções_de_encriptação_para_o_modo_plain" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Op%C3%A7%C3%B5es_de_encripta%C3%A7%C3%A3o_para_o_modo_plain">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>Opções de encriptação para o modo plain</span>
				</div>
			</a>
			
			<ul id="toc-Opções_de_encriptação_para_o_modo_plain-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Criptografando_dispositivos_com_cryptsetup" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Criptografando_dispositivos_com_cryptsetup">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Criptografando dispositivos com cryptsetup</span>
			</div>
		</a>
		
			<button aria-controls="toc-Criptografando_dispositivos_com_cryptsetup-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Criptografando dispositivos com cryptsetup subsection</span>
			</button>
		
		<ul id="toc-Criptografando_dispositivos_com_cryptsetup-sublist" class="vector-toc-list">
			<li id="toc-Criptografando_dispositivos_com_o_modo_LUKS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Criptografando_dispositivos_com_o_modo_LUKS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>Criptografando dispositivos com o modo LUKS</span>
				</div>
			</a>
			
			<ul id="toc-Criptografando_dispositivos_com_o_modo_LUKS-sublist" class="vector-toc-list">
				<li id="toc-Formatando_partições_LUKS" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Formatando_parti%C3%A7%C3%B5es_LUKS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1.1</span>
					<span>Formatando partições LUKS</span>
				</div>
			</a>
			
			<ul id="toc-Formatando_partições_LUKS-sublist" class="vector-toc-list">
				<li id="toc-Usando_LUKS_para_formatar_partições_com_um_arquivo-chave" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Usando_LUKS_para_formatar_parti%C3%A7%C3%B5es_com_um_arquivo-chave">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1.1.1</span>
					<span>Usando LUKS para formatar partições com um arquivo-chave</span>
				</div>
			</a>
			
			<ul id="toc-Usando_LUKS_para_formatar_partições_com_um_arquivo-chave-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Abrindo/Mapeando_partições_LUKS_com_o_mapeador_de_dispositivos" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Abrindo/Mapeando_parti%C3%A7%C3%B5es_LUKS_com_o_mapeador_de_dispositivos">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1.2</span>
					<span>Abrindo/Mapeando partições LUKS com o mapeador de dispositivos</span>
				</div>
			</a>
			
			<ul id="toc-Abrindo/Mapeando_partições_LUKS_com_o_mapeador_de_dispositivos-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Usando_TPM_para_armazenar_chaves" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Usando_TPM_para_armazenar_chaves">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1.3</span>
					<span>Usando TPM para armazenar chaves</span>
				</div>
			</a>
			
			<ul id="toc-Usando_TPM_para_armazenar_chaves-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Criptografando_dispositivos_com_o_modo_plain" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Criptografando_dispositivos_com_o_modo_plain">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.2</span>
					<span>Criptografando dispositivos com o modo plain</span>
				</div>
			</a>
			
			<ul id="toc-Criptografando_dispositivos_com_o_modo_plain-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Ações_específicas_do_cryptsetup_para_o_LUKS" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#A%C3%A7%C3%B5es_espec%C3%ADficas_do_cryptsetup_para_o_LUKS">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Ações específicas do cryptsetup para o LUKS</span>
			</div>
		</a>
		
			<button aria-controls="toc-Ações_específicas_do_cryptsetup_para_o_LUKS-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Ações específicas do cryptsetup para o LUKS subsection</span>
			</button>
		
		<ul id="toc-Ações_específicas_do_cryptsetup_para_o_LUKS-sublist" class="vector-toc-list">
			<li id="toc-Gerenciamento_de_chaves" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Gerenciamento_de_chaves">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>Gerenciamento de chaves</span>
				</div>
			</a>
			
			<ul id="toc-Gerenciamento_de_chaves-sublist" class="vector-toc-list">
				<li id="toc-Adicionando_chaves_do_LUKS" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Adicionando_chaves_do_LUKS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1.1</span>
					<span>Adicionando chaves do LUKS</span>
				</div>
			</a>
			
			<ul id="toc-Adicionando_chaves_do_LUKS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Removendo_chaves_do_LUKS" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Removendo_chaves_do_LUKS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1.2</span>
					<span>Removendo chaves do LUKS</span>
				</div>
			</a>
			
			<ul id="toc-Removendo_chaves_do_LUKS-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Backup_e_restauração" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Backup_e_restaura%C3%A7%C3%A3o">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2</span>
					<span>Backup e restauração</span>
				</div>
			</a>
			
			<ul id="toc-Backup_e_restauração-sublist" class="vector-toc-list">
				<li id="toc-Backup_usando_o_cryptsetup" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Backup_usando_o_cryptsetup">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2.1</span>
					<span>Backup usando o cryptsetup</span>
				</div>
			</a>
			
			<ul id="toc-Backup_usando_o_cryptsetup-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Restauração_usando_o_cryptsetup" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Restaura%C3%A7%C3%A3o_usando_o_cryptsetup">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2.2</span>
					<span>Restauração usando o cryptsetup</span>
				</div>
			</a>
			
			<ul id="toc-Restauração_usando_o_cryptsetup-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Re-criptografando_dispositivos" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Re-criptografando_dispositivos">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.3</span>
					<span>Re-criptografando dispositivos</span>
				</div>
			</a>
			
			<ul id="toc-Re-criptografando_dispositivos-sublist" class="vector-toc-list">
				<li id="toc-Criptografando_um_sistema_de_arquivos_preexistente_não_encriptado" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Criptografando_um_sistema_de_arquivos_preexistente_n%C3%A3o_encriptado">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.3.1</span>
					<span>Criptografando um sistema de arquivos preexistente não encriptado</span>
				</div>
			</a>
			
			<ul id="toc-Criptografando_um_sistema_de_arquivos_preexistente_não_encriptado-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Re-criptografando_uma_partição_LUKS_preexistente" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Re-criptografando_uma_parti%C3%A7%C3%A3o_LUKS_preexistente">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.3.2</span>
					<span>Re-criptografando uma partição LUKS preexistente</span>
				</div>
			</a>
			
			<ul id="toc-Re-criptografando_uma_partição_LUKS_preexistente-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Convertendo_de_LUKS1_para_LUKS2_e_revertendo" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Convertendo_de_LUKS1_para_LUKS2_e_revertendo">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.4</span>
					<span>Convertendo de LUKS1 para LUKS2 e revertendo</span>
				</div>
			</a>
			
			<ul id="toc-Convertendo_de_LUKS1_para_LUKS2_e_revertendo-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Redimensionando_os_dispositivos_criptografados" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Redimensionando_os_dispositivos_criptografados">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Redimensionando os dispositivos criptografados</span>
			</div>
		</a>
		
			<button aria-controls="toc-Redimensionando_os_dispositivos_criptografados-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Redimensionando os dispositivos criptografados subsection</span>
			</button>
		
		<ul id="toc-Redimensionando_os_dispositivos_criptografados-sublist" class="vector-toc-list">
			<li id="toc-LVM_em_LUKS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#LVM_em_LUKS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.1</span>
					<span>LVM em LUKS</span>
				</div>
			</a>
			
			<ul id="toc-LVM_em_LUKS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Sistema_de_arquivos_de_loopback" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Sistema_de_arquivos_de_loopback">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.2</span>
					<span>Sistema de arquivos de loopback</span>
				</div>
			</a>
			
			<ul id="toc-Sistema_de_arquivos_de_loopback-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Dispositivo_com_integridade_protegida" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Dispositivo_com_integridade_protegida">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.3</span>
					<span>Dispositivo com integridade protegida</span>
				</div>
			</a>
			
			<ul id="toc-Dispositivo_com_integridade_protegida-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Arquivos-chave/keyfiles" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Arquivos-chave/keyfiles">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">7</span>
				<span>Arquivos-chave/keyfiles</span>
			</div>
		</a>
		
			<button aria-controls="toc-Arquivos-chave/keyfiles-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Arquivos-chave/keyfiles subsection</span>
			</button>
		
		<ul id="toc-Arquivos-chave/keyfiles-sublist" class="vector-toc-list">
			<li id="toc-Tipos_de_arquivo-chave" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Tipos_de_arquivo-chave">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.1</span>
					<span>Tipos de arquivo-chave</span>
				</div>
			</a>
			
			<ul id="toc-Tipos_de_arquivo-chave-sublist" class="vector-toc-list">
				<li id="toc-Texto_simples_(passphrase)" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Texto_simples_(passphrase)">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.1.1</span>
					<span>Texto simples (passphrase)</span>
				</div>
			</a>
			
			<ul id="toc-Texto_simples_(passphrase)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Caracteres_aleatórios" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Caracteres_aleat%C3%B3rios">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.1.2</span>
					<span>Caracteres aleatórios</span>
				</div>
			</a>
			
			<ul id="toc-Caracteres_aleatórios-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Binário" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Bin%C3%A1rio">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.1.3</span>
					<span>Binário</span>
				</div>
			</a>
			
			<ul id="toc-Binário-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Criando_um_arquivo-chave_com_caracteres_aleatórios" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Criando_um_arquivo-chave_com_caracteres_aleat%C3%B3rios">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.2</span>
					<span>Criando um arquivo-chave com caracteres aleatórios</span>
				</div>
			</a>
			
			<ul id="toc-Criando_um_arquivo-chave_com_caracteres_aleatórios-sublist" class="vector-toc-list">
				<li id="toc-Armazenando_o_arquivo-chave_em_um_sistema_de_arquivos" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Armazenando_o_arquivo-chave_em_um_sistema_de_arquivos">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.2.1</span>
					<span>Armazenando o arquivo-chave em um sistema de arquivos</span>
				</div>
			</a>
			
			<ul id="toc-Armazenando_o_arquivo-chave_em_um_sistema_de_arquivos-sublist" class="vector-toc-list">
				<li id="toc-Sobrescrevendo_com_segurança_os_arquivos-chave_armazenados" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Sobrescrevendo_com_seguran%C3%A7a_os_arquivos-chave_armazenados">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.2.1.1</span>
					<span>Sobrescrevendo com segurança os arquivos-chave armazenados</span>
				</div>
			</a>
			
			<ul id="toc-Sobrescrevendo_com_segurança_os_arquivos-chave_armazenados-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Armazenando_o_arquivo-chave_no_tmpfs_(com_swapping_desativado)" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Armazenando_o_arquivo-chave_no_tmpfs_(com_swapping_desativado)">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.2.2</span>
					<span>Armazenando o arquivo-chave no tmpfs (com swapping desativado)</span>
				</div>
			</a>
			
			<ul id="toc-Armazenando_o_arquivo-chave_no_tmpfs_(com_swapping_desativado)-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Configurando_o_LUKS_para_utilizar_o_arquivo-chave" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Configurando_o_LUKS_para_utilizar_o_arquivo-chave">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.3</span>
					<span>Configurando o LUKS para utilizar o arquivo-chave</span>
				</div>
			</a>
			
			<ul id="toc-Configurando_o_LUKS_para_utilizar_o_arquivo-chave-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Manualmente_abrindo_uma_partição_com_um_arquivo-chave" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Manualmente_abrindo_uma_parti%C3%A7%C3%A3o_com_um_arquivo-chave">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.4</span>
					<span>Manualmente abrindo uma partição com um arquivo-chave</span>
				</div>
			</a>
			
			<ul id="toc-Manualmente_abrindo_uma_partição_com_um_arquivo-chave-sublist" class="vector-toc-list">
				<li id="toc-Com_um_aquivo-chave_em_um_dispositivo_externo" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Com_um_aquivo-chave_em_um_dispositivo_externo">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.4.1</span>
					<span>Com um aquivo-chave em um dispositivo externo</span>
				</div>
			</a>
			
			<ul id="toc-Com_um_aquivo-chave_em_um_dispositivo_externo-sublist" class="vector-toc-list">
				<li id="toc-Configurando_o_mkinitcpio" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Configurando_o_mkinitcpio">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.4.1.1</span>
					<span>Configurando o mkinitcpio</span>
				</div>
			</a>
			
			<ul id="toc-Configurando_o_mkinitcpio-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Configurando_os_parâmetros_de_kernel" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Configurando_os_par%C3%A2metros_de_kernel">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.4.1.2</span>
					<span>Configurando os parâmetros de kernel</span>
				</div>
			</a>
			
			<ul id="toc-Configurando_os_parâmetros_de_kernel-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Com_um_arquivo-chave_embutido_em_initramfs" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Com_um_arquivo-chave_embutido_em_initramfs">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.4.2</span>
					<span>Com um arquivo-chave embutido em initramfs</span>
				</div>
			</a>
			
			<ul id="toc-Com_um_arquivo-chave_embutido_em_initramfs-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar no-font-mode-scale">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">dm-crypt (Português)/Device encryption (Português)</h1>
							
</header>
				<div class="vector-column-end no-font-mode-scale">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <bdi dir="ltr"><a href="../../pt/Dm-crypt.html" title="Dm-crypt (Português)">Dm-crypt (Português)</a></bdi>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="pt" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Status de tradução:</strong> Esse artigo é uma tradução de <a href="../../en/Dm-crypt/Device_encryption.html" title="Dm-crypt/Device encryption">Dm-crypt/Device encryption</a>. Data da última tradução: 2025-03-03. Você pode ajudar a sincronizar a tradução, se houver <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Dm-crypt/Device_encryption&amp;diff=0&amp;oldid=826875">alterações</a> na versão em inglês.</div>
<p>Esta página mostra como utilizar <i>dm-crypt</i> pela linha de comando para criptografar um sistema.
</p>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Preparação">
<span id="Prepara.C3.A7.C3.A3o"></span>Preparação</h2></div>
<p>Antes de usar <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span>, tenha certeza que o <a href="../../en/4bc259b8fff5100de1e0c3534db0f93c.html" class="mw-redirect" title="Módulo de kernel">módulo de kernel</a> <code>dm_crypt</code> está carregado.
</p>
<div class="mw-heading mw-heading2"><h2 id="Utilização_do_cryptsetup">
<span id="Utiliza.C3.A7.C3.A3o_do_cryptsetup"></span>Utilização do cryptsetup</h2></div>
<p><span class="plainlinks archwiki-template-man" title="$ man 8 cryptsetup"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cryptsetup.8">cryptsetup(8)</a></span> é uma ferramenta da linha de comando para o <i>dm-crypt</i> criar, acessar e gerenciar dispositivos criptografados. Ela foi expandida para suportar diferentes tipos de encriptação que dependem do mapeador de dispositivos e módulos criptografados (<b>d</b>evice-<b>m</b>apper and the <b>crypt</b>ographic modules). A expansão mais notável foi o LUKS (Linux Unified Key Setup), que guarda todas as informações necessárias para o dm-crypt no próprio disco e abstrai a partição e gerenciamento de chaves com o objetivo de facilitar o uso. Dispositivos acessados via o mapeador de dispositivos são chamados de dispositivos de bloco, do inglês <i>block devices</i>. Para mais informações veja <a href="../../en/Criptografia_de_dados_em_repouso.html#Encripta%C3%A7%C3%A3o_de_dispositivo_de_bloco" class="mw-redirect" title="Criptografia de dados em repouso">Criptografia de dados em repouso#Encriptação de dispositivo de bloco</a>.
</p>
<p>A ferramenta é usada da seguinte forma:
</p>
<pre># cryptsetup <i>ação</i> <i>opções</i> <i>dispositivo</i> <i>nome_do_dm</i>
</pre>
<p>Existem opções e modo de encriptação por padrão, que serão usados se nenhuma outra opção for especificada. Veja com:
</p>
<pre>$ cryptsetup --help
</pre>
<p>Todos os parâmetros, opções e ações por padrão serão listados. A lista completa das opções pode ser encontrada na página do manual. Dependendo do modo de encriptação escolhido e a ação selecionada, os parâmetros podem ser de uso obrigatório ou algo opcional. O resto das seções abaixo apontam os diferenciais com mais detalhes. 
</p>
<p>A encriptação do dispositivo de bloco é rápida, porém a velocidade de desencriptação é também algo a se considerar; é importante escolher com cuidado o algoritmo que será utilizado, mudar a cifra criptográfica de um dispositivo de bloco já criptografado é trabalhoso, portanto verifique a performance do <i>dm-crypt</i> com diferentes parâmetros antes de instalar o sistema:
</p>
<pre>$ cryptsetup benchmark 
</pre>
<p>Fazer um teste antecipado lhe ajudará a decidir qual algoritmo e tamanho de chave você quer usar. Se algumas cifras AES se destacarem com uma grande diferença, estas provavelmente devem ter suporte de hardware na CPU.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica</strong> Se desejar, você pode praticar a encriptação de dispositivos em uma <a href="../../pt/Category:Virtualization.html" class="mw-redirect" title="Virtualização">máquina virtual</a> enquanto ainda estiver aprendendo.</div>
<div class="mw-heading mw-heading3"><h3 id="Senhas_e_chaves_do_cryptsetup">Senhas e chaves do cryptsetup</h3></div>
<p>Um dispositivo de bloco criptografado é protegido por uma chave, da qual pode ser:
</p>
<ul>
<li>uma frase secreta (passphrase), veja <a href="../../pt/Security.html#Senhas" class="mw-redirect" title="Segurança">Segurança#Senhas</a>.</li>
<li>um segredo em um arquivo-chave (keyfile), veja <a href="#Arquivos-chave/keyfiles">#Arquivos-chave/keyfiles</a>.</li>
</ul>
<p>Ambos os tipos de chave possuem tamanhos padrões máximos: senhas podem ser até 512 caracteres e arquivos-chave até 8192 KiB.
</p>
<p>Uma importante distinção do <i>LUKS</i> a se notar é que a chave é usada para desbloquear a chave mestre do dispositivo criptografado com LUKS, e a mesma pode mudar com acesso pelo root. Outros modos de encriptação não suportam mudança na chave depois de definida, pois não há a utilização de uma chave mestre na encriptação por estes modos. Veja <a href="../../en/Criptografia_de_dados_em_repouso.html#Encripta%C3%A7%C3%A3o_de_dispositivo_de_bloco" class="mw-redirect" title="Criptografia de dados em repouso">Criptografia de dados em repouso#Encriptação de dispositivo de bloco</a> para detalhes.
</p>
<div class="mw-heading mw-heading2"><h2 id="Opções_de_encriptação">
<span id="Op.C3.A7.C3.B5es_de_encripta.C3.A7.C3.A3o"></span>Opções de encriptação</h2></div>
<p><i>Cryptsetup</i> suporta diferentes modos de operações de encriptação com o uso pelo <i>dm-crypt</i>: 
</p>
<ul>
<li>
<code>--type luks</code> para usar a versão padrão do LUKS (LUKS1 com <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span> &lt; 2.1.0, LUKS2 com <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span> ≥ 2.1.0),</li>
<li>
<code>--type luks1</code> para usar LUKS1, a versão anterior do LUKS,</li>
<li>
<code>--type luks2</code> para usar LUKS2, a atual versão do LUKS que introduz extensões adicionais,</li>
<li>
<code>--hw-opal-only</code> para encriptação baseada em hardware em dispositivos com suporte ao padrão TCG OPAL. Veja sobre na página em inglês: <a href="../../en/Self-encrypting_drives.html#Using_cryptsetup" title="Self-encrypting drives">Dispositivos de encriptação própria#Usando cryptsetup</a> e <span class="plainlinks archwiki-template-man" title="$ man 8 cryptsetup"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cryptsetup.8#SED_(SELF_ENCRYPTING_DRIVE)_OPAL_EXTENSION">cryptsetup(8) § SED (SELF ENCRYPTING DRIVE) OPAL EXTENSION</a></span>.</li>
<li>
<code>--hw-opal</code> para encriptação de hardware OPAL com uma camada de criptografia em software com dm-crypt.</li>
<li>
<code>--type plain</code> para usar o modo plain do dm-crypt,</li>
<li>
<code>--type loopaes</code> para o modo legado <i>loopaes</i>,</li>
<li>
<code>--type tcrypt</code> para o modo de compatibilidade com <a href="../../en/VeraCrypt.html" class="mw-redirect" title="TrueCrypt">TrueCrypt</a>.</li>
<li>
<code>--type bitlk</code> para modo de compatibilidade com <a href="https://en.wikipedia.org/wiki/BitLocker" class="extiw" title="wikipedia:BitLocker">BitLocker</a>. Veja <span class="plainlinks archwiki-template-man" title="$ man 8 cryptsetup"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cryptsetup.8#BITLK_(WINDOWS_BITLOCKER_COMPATIBLE)_EXTENSION">cryptsetup(8) § BITLK (WINDOWS BITLOCKER COMPATIBLE) EXTENSION</a></span>.</li>
</ul>
<p>As opções básicas de criptografia para as cifras e hashes disponíveis podem ser usadas em todos os modos e dependem das funcionalidades de encriptação na infraestrutura do kernel. Todas as que foram carregadas e estão disponíveis para uso como opções no tempo de execução do kernel podem ser vistas com:
</p>
<pre>$ less /proc/crypto 
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica</strong> Se a lista é pequena, execute <code>$ cryptsetup benchmark</code>, do qual irá ativar a busca de módulos disponíveis.</div>
<p>Os tópicos a seguir introduzem as opções de encriptação para os modos <code>luks</code>, <code>luks1</code>, <code>luks2</code> e <code>plain</code>. Note que o conteúdo disposto lista as opções utilizadas em seus respectivos artigos e não todas as disponíveis.
</p>
<div class="mw-heading mw-heading3"><h3 id="Opções_de_encriptação_para_o_modo_LUKS">
<span id="Op.C3.A7.C3.B5es_de_encripta.C3.A7.C3.A3o_para_o_modo_LUKS"></span>Opções de encriptação para o modo LUKS</h3></div>
<p>A ação do <i>cryptsetup</i> para configurar um novo dispositivo do dm-crypt no modo de encriptação LUKS é <code>luksFormat</code>. Diferente do que o nome implica, não formata o dispositivo, mas configura o cabeçalho do dispositivo LUKS e criptografa a chave mestre com as opções criptografadas desejadas.
</p>
<p>Ao fim de criar um novo container do LUKS, juntamente com o conjunto de parâmetros padrões listados pelo <code>cryptsetup --help</code>, simplesmente execute:
</p>
<pre># cryptsetup luksFormat <i>dispositivo</i>
</pre>
<p>Desde a versão 2.4.0 de cryptsetup o comando acima é o equivalente a:  
</p>
<pre># cryptsetup luksFormat --type luks2 --cipher aes-xts-plain64 --hash sha256 --iter-time 2000 --key-size 256 --pbkdf argon2id --use-urandom --verify-passphrase luksFormat <i>dispositivo</i>
</pre>
<p>Um comparativo das opções padrões com as especificações criptográficas mais bem discriminadas, acompanhado de comentários, foi feito nos exemplos da tabela abaixo:
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Opções</th>
<th>Padrão do cryptsetup 2.1.0</th>
<th>Exemplo</th>
<th>Comentários
</th>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--cipher
<p>-c
</p>
</th>
<td>
<code>aes-xts-plain64</code>
</td>
<td>
<code>aes-xts-plain64</code>
</td>
<td>
<a rel="nofollow" class="external text" href="https://www.kernel.org/pub/linux/utils/cryptsetup/v1.6/v1.6.0-ReleaseNotes">A versão 1.6.0</a> mudou o padrão para uma <a href="../../en/Criptografia_de_dados_em_repouso.html#Cifras_e_modos_de_opera%C3%A7%C3%A3o" class="mw-redirect" title="Criptografia de dados em repouso">cifra</a> do AES no modo <a href="https://en.wikipedia.org/wiki/Disk_encryption_theory#XEX-based_tweaked-codebook_mode_with_ciphertext_stealing_.28XTS.29" class="extiw" title="wikipedia:Disk encryption theory">XTS</a> (veja o item 5.16 <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions#5-security-aspects">do FAQ</a>). Não é recomendado o uso da cifra padrão anterior <code>--cipher aes-cbc-essiv</code> devido a seus conhecidos <a href="https://en.wikipedia.org/wiki/Disk_encryption_theory#Cipher-block_chaining_.28CBC.29" class="extiw" title="wikipedia:Disk encryption theory">problemas</a> e <a rel="nofollow" class="external text" href="https://www.jakoblell.com/blog/2013/12/22/practical-malleability-attack-against-cbc-encrypted-luks-partitions/">ataques</a> práticos contra eles.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--key-size
<p>-s
</p>
</th>
<td>
<code>256</code> (<code>512</code> for XTS)
</td>
<td>
<code>512</code>
</td>
<td>Por padrão uma chave com tamanho de 512 bit é usada para cifras XTS. Note no entanto que <a href="https://en.wikipedia.org/wiki/Disk_encryption_theory#XEX-based_tweaked-codebook_mode_with_ciphertext_stealing_.28XTS.29" class="extiw" title="wikipedia:Disk encryption theory">XTS divide a chave no meio</a>, resultando no uso do AES-256.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--hash
<p>-h
</p>
</th>
<td>
<code>sha256</code>
</td>
<td>
<code>sha512</code>
</td>
<td>O algoritmo de Hash usado para <a href="../../en/Criptografia_de_dados_em_repouso.html#Metadados_criptogr%C3%A1ficos" class="mw-redirect" title="Criptografia de dados em repouso">derivação de chave</a>. A versão 1.7.0 mudou o padrão de <code>sha1</code> para <code>sha256</code> "<i>não por segurança [mas] principalmente para previnir problemas de compabilidade em sistemas onde SHA1 já estava [em] desuso </i>"<a rel="nofollow" class="external autonumber" href="https://www.kernel.org/pub/linux/utils/cryptsetup/v1.7/v1.7.0-ReleaseNotes">[1]</a>. O antigo padrão do <code>sha1</code> pode ainda ser usado por compatibilidade com versões mais velhas do <i>cryptsetup</i> desde que é <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions#5-security-aspects">considerada segura</a> (veja o item 5.20).
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--iter-time
<p>-i
</p>
</th>
<td>
<code>2000</code>
</td>
<td>
<code>5000</code>
</td>
<td>Número de milisegundos a serem esperados com o processamento da senha PBKDF. A versão 1.7.0 mudou o padrão de <code>1000</code> para <code>2000</code> com o objetivo de "<i>tentar manter a contagem da interação do PBKDF2 alta o bastante e também ainda aceitável pelos usuários.</i>"<a rel="nofollow" class="external autonumber" href="https://www.kernel.org/pub/linux/utils/cryptsetup/v1.7/v1.7.0-ReleaseNotes">[2]</a>. Esta opção é somente relevante para operações do LUKS que definem ou mudam senhas, tais como <code>luksFormat</code> ou <code>luksAddKey</code>. Especificando 0 como parâmetro seleciona o padrão compilado.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--use-urandom
</th>
<td>
<code>--use-urandom</code>
</td>
<td>
<code>--use-random</code>
</td>
<td>Seleciona qual <a href="../../en/Random_number_generator.html" class="mw-redirect" title="Random number generator">gerador de números randômicos</a> vai ser utilizado. Note que a <i>blocking pool</i>, ou seja, <a rel="nofollow" class="external text" href="https://lwn.net/Articles/808575/">o bloqueio para gerar mais entropia com /dev/random, foi removido</a>. Portanto a flag <code>--use-random</code> é agora equivalente ao <code>--use-urandom</code>.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--verify-passphrase
</th>
<td>Yes
</td>
<td>-
</td>
<td>Habilitado por padrão no Arch Linux para <code>luksFormat</code> e <code>luksAddKey</code>.
</td>
</tr>
<tr>
<th>--sector-size
</th>
<td>
<code>512</code> ou <code>4096</code> (dependente do dispositivo)
</td>
<td>
<code>4096</code>
</td>
<td>Configura o tamanho do setor em bytes para o uso com encriptação de disco. O padrão é <code>4096</code> para dispositivos de bloco que anunciam a si mesmos como 4Kn ou 512e e <code>512</code> é para aqueles que anunciam a si próprios como 512n. Aumentar o tamanho do setor de 512 bytes para 4096 bytes pode melhorar desempenho na maioria dos dispositivos de armazenamentos modernos. Veja em <a href="../../en/Advanced_Format.html#dm-crypt" title="Advanced Format">Advanced Format#dm-crypt</a>.
</td>
<td>
</td>
</tr>
</tbody>
</table>
<p>As propriedades das funcionalidades e opções do LUKS são descritas nas especificações do <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/-/raw/master/docs/on-disk-format.pdf">LUKS1</a> (pdf) e <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/-/raw/master/docs/on-disk-format-luks2.pdf">LUKS2</a> (pdf).
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica</strong> A apresentação dos desenvolvedores do projeto <a rel="nofollow" class="external text" href="https://mbroz.fedorapeople.org/talks/devconf2016-luks2.pdf">devconfcz2016</a> resume as motivações das principais atualizações das especificações do LUKS2. Veja também as principais mudanças do cryptsetup (v2) nas <a rel="nofollow" class="external text" href="https://mirrors.edge.kernel.org/pub/linux/utils/cryptsetup/v2.0/v2.0.0-ReleaseNotes">anotações publicadas da segunda versão</a>.</div>
<div class="mw-heading mw-heading4"><h4 id="Tempo_de_iteração">
<span id="Tempo_de_itera.C3.A7.C3.A3o"></span>Tempo de iteração</h4></div>
<p>Retirado de <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/-/wikis/FrequentlyAskedQuestions#2-setup">cryptsetup FAQ§2.1</a> e <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/-/wikis/FrequentlyAskedQuestions#3-common-problems">§3.4</a>:
</p>
<dl>
<dd>O tempo de desbloqueio para um espaço de chave (keyslot) [...] é calculado ao configurar a senha. Por padrão é em torno de 1 segundo (2 segundos para LUKS2). [...]</dd>
<dd>A iteração da senha é baseada no tempo, e portanto o nível de segurança depende do poder da CPU no sistema do qual o container do LUKS foi criado. [...]</dd>
<dd>Se você configurar uma senha em uma máquina rápida e então desbloqueá-la em uma máquina lenta, o tempo para destravamento pode ser bem maior.</dd>
</dl>
<p>Levando isso em consideração, é então sempre melhor criar um container na máquina que será acessada com mais frequência.
</p>
<p>Acesse os links e veja o resto das seções mencionadas acima para dicas de como ajustar corretamente o tempo de iteração, em caso de surgir a necessidade para tal.
</p>
<div class="mw-heading mw-heading3"><h3 id="Opções_de_encriptação_para_o_modo_plain">
<span id="Op.C3.A7.C3.B5es_de_encripta.C3.A7.C3.A3o_para_o_modo_plain"></span>Opções de encriptação para o modo plain</h3></div>
<p>No modo <i>plain</i> do dm-crypt, não existe chave mestre no dispositivo, consequentemente não é necessário defini-lá. As opções de encriptação são empregadas diretamente para criar a mapeação entre o disco criptografado e um dispositivo nomeado. O mapeamento pode ser criado na partição ou no dispositivo todo. Nesse último caso não é necessário uma tabela de partição.
</p>
<p>O mapeamento do modo <i>plain</i> com os parâmetros padrão do cryptsetup pode ser feito com:
</p>
<pre># cryptsetup open --type plain <i>opções</i>  <i>dispositivo</i> <i>dmnome</i>
</pre>
<p>Ao executar o comando será solicitada a senha, que deve possuir uma entropia muito alta, e a opção <code>--verify-passphrase</code> pode ser usada, mas não é um padrão. Em geral é recomendável anotar as opções de encriptação usadas durante a criação, pois tais opções não são derivadas do dispositivo criptografado, ou de um arquivo-chave (keyfile) opcional, além disso o código que define as opções padrões pode mudar.
</p>
<p>Logo abaixo há uma comparação dos parâmetros definidos como padrão com o exemplo em <a href="../../en/Dm-crypt/Criptografando_todo_um_sistema.html#dm-crypt_plain" class="mw-redirect" title="Dm-crypt/Criptografando todo um sistema">dm-crypt/Criptografando todo um sistema#dm-crypt plain</a>:
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Opção</th>
<th>Padrão do cryptsetup 2.7.0</th>
<th>Exemplo</th>
<th>Comentário
</th>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--hash
<p>-h
</p>
</th>
<td>
<code>sha256</code>
</td>
<td>-
</td>
<td>O hash é usado para criar a chave com a senha; não é usado em uma keyfile.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--cipher
<p>-c
</p>
</th>
<td>
<code>aes-xts-plain64</code>
</td>
<td>
<code>aes-xts-plain64</code>
</td>
<td>As cifras consistem de três pares: geradores cifra-modo_de_opeação-IV. Veja <a href="../../en/Criptografia_de_dados_em_repouso.html#Cifras_e_modos_de_opera%C3%A7%C3%A3o" class="mw-redirect" title="Criptografia de dados em repouso">Criptografia de dados em repouso#Cifras e modos de operação</a> para uma explicação dessas configurações, e a <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/DMCrypt">documentação do DMCrypt</a> para os modos disponíveis.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--key-size
<p>-s
</p>
</th>
<td>
<code>256</code>
</td>
<td>
<code>512</code>
</td>
<td>O tamanho da chave (em bits). O tamanho dependerá da cifra utilizada e do <i>chainmode</i> em uso. O <a href="https://en.wikipedia.org/wiki/Disk_encryption_theory#XEX-based_tweaked-codebook_mode_with_ciphertext_stealing_.28XTS.29" class="extiw" title="wikipedia:Disk encryption theory">modo XTS requer o dobro de tamanho de chave</a> do CBC.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--size
<p>-b
</p>
</th>
<td>Tamanho real do disco alvo
</td>
<td>- (utilizado o padrão)
</td>
<td>Limita o tamanho máximo do dispositivo (em setores de 512-byte).
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--offset
<p>-o
</p>
</th>
<td>
<code>0</code>
</td>
<td>
<code>0</code>
</td>
<td>O quanto pular do inicio do disco alvo (setores de 512-byte) antes de começar o mapeamento
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--skip
<p>-p
</p>
</th>
<td>
<code>0</code>
</td>
<td>
<code>2048</code> (512B×2048=1MiB serão pulados)
</td>
<td>O número de setores de 512-byte de dados criptografados a pular para o cálculo de vetor de inicialização (IV).
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--key-file
<p>-d
</p>
</th>
<td>A senha será usada por padrão
</td>
<td>
<code>/dev/sd<i>Z</i></code> (ou, por exemplo, <code>/boot/keyfile.enc</code>)
</td>
<td>O dispositivo ou arquivo a ser usado como chave. Veja <a href="#Arquivos-chave/keyfiles">#Arquivos-chave/keyfiles</a> para mais detalhes.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--keyfile-offset
</th>
<td>
<code>0</code>
</td>
<td>
<code>0</code>
</td>
<td>Distância do início do arquivo onde a chave começa (em bytes). Esta opção é suportada a partir da versão 1.6.7 do <i>cryptsetup</i>.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--keyfile-size
<p>-l
</p>
</th>
<td>
<code>8192kB</code>
</td>
<td>- (utilizado o padrão)
</td>
<td>Limita os bytes lidos da keyfile. Esta opção é suportada a partir da versão 1.6.7 do <i>cryptsetup</i>.
</td>
</tr>
<tr>
<th>--sector-size
</th>
<td>
<code>512</code>
</td>
<td>
<code>4096</code>
</td>
<td>Configura o tamanho do setor em bytes com o uso de encriptação no disco. O padrão é <code>512</code> para tudo exceto em dispositivos de bloco 4kn. AUmentar o tamanho do setor de 512 bytes para 4096 bytes pode proporcionar melhor desempenho na maior parte dos dispositivos de armazenamento modernos. Veja a página em inglẽs em <a href="../../en/Advanced_Format.html#dm-crypt" title="Advanced Format">Advanced Format#dm-crypt</a>.
</td>
</tr>
</tbody>
</table>
<p>Ao usar o dispositivo <code>/dev/sd<i>X</i></code>, o exemplo da coluna acima da direita resulta em:
</p>
<pre># cryptsetup open --type plain --cipher=aes-xts-plain64 --offset=0 --skip=2048 --key-file=/dev/sd<i>Z</i> --key-size=512 --sector-size 4096 /dev/sdX enc
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção</strong> Diferentemente de criptografar com LUKS, o comando acima deve ser executado de maneira <i>completa</i>, independentemente de quais sejam as necessidades de mapeamento a serem restabelecidas, então é importante lembrar detalhes sobre a cifra, hash e de arquivo-chave (keyfile). Não dependa do padrão do cryptsetup, pois tais parâmetros mudam entre versões.</div>
<p>Nós podemos checar se o mapeamento foi feito com:
</p>
<pre># fdisk -l
</pre>
<p>O dispositivo mapeado deve aparecer como <code>/dev/mapper/enc</code>.
</p>
<div class="mw-heading mw-heading2"><h2 id="Criptografando_dispositivos_com_cryptsetup">Criptografando dispositivos com cryptsetup</h2></div>
<p>Esta seção mostra como empregar as opções para criar novos dispositivos de bloco criptografados e acessá-los manualmente.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção</strong> O suporte de LUKS2 para o GRUB é limitado. Veja <a href="../../pt/GRUB.html#/boot_criptografado" title="GRUB (Português)">GRUB (Português)#/boot criptografado</a> para detalhes. Use LUKS2 com PBKDF2 (<code>cryptsetup luksFormat --pbkdf pbkdf2</code>) para partições que o GRUB precisará abrir.</div>
<div class="mw-heading mw-heading3"><h3 id="Criptografando_dispositivos_com_o_modo_LUKS">Criptografando dispositivos com o modo LUKS</h3></div>
<div class="mw-heading mw-heading4"><h4 id="Formatando_partições_LUKS">
<span id="Formatando_parti.C3.A7.C3.B5es_LUKS"></span>Formatando partições LUKS</h4></div>
<p>Para configurar uma partição criptografada LUKS, execute:
</p>
<pre># cryptsetup luksFormat <i>dispositivo</i>
</pre>
<p>Lhe será solicitado uma senha e também a verificação desta.
</p>
<p>Veja <a href="#Op%C3%A7%C3%B5es_de_encripta%C3%A7%C3%A3o_para_o_modo_LUKS">#Opções de encriptação para o modo LUKS</a> para opções da linha de comando.
</p>
<p>Você pode checar os resultados com:
</p>
<pre># cryptsetup luksDump <i>dispositivo</i>
</pre>
<p>Note que a saída vai mostrar a informação do cabeçalho da cifra criptográfica, como também as chaves em uso da partição LUKS. 
</p>
<p>O seguinte exemplo criará uma partição raiz criptografada no <code>/dev/sda1</code> usando a cifra AES padrão no modo XTS com uma efetiva encriptação de 256-bit
</p>
<pre># cryptsetup luksFormat -s 512 /dev/sda1
</pre>
<div class="mw-heading mw-heading5"><h5 id="Usando_LUKS_para_formatar_partições_com_um_arquivo-chave">
<span id="Usando_LUKS_para_formatar_parti.C3.A7.C3.B5es_com_um_arquivo-chave"></span>Usando LUKS para formatar partições com um arquivo-chave</h5></div>
<p>Na criação de uma partição criptografada LUKS, uma keyfile pode ser associada usando:
</p>
<pre># cryptsetup luksFormat <i>dispositivo</i> <i>/caminho/para/keyfile</i>
</pre>
<p>Veja <a href="#Arquivos-chave/keyfiles">#Arquivos-chave/keyfiles</a> para instruções de como gerar e gerenciar keyfiles.
</p>
<div class="mw-heading mw-heading4"><h4 id="Abrindo/Mapeando_partições_LUKS_com_o_mapeador_de_dispositivos">
<span id="Abrindo.2FMapeando_parti.C3.A7.C3.B5es_LUKS_com_o_mapeador_de_dispositivos"></span>Abrindo/Mapeando partições LUKS com o mapeador de dispositivos</h4></div>
<p>Uma vez que os containers LUKS foram criados, eles podem ser abertos.
</p>
<p>Para abrir um container LUKS voce precisa definir o nome do novo dispositivo mapeado. Isto alerta o kernel que <code><i>dispositivo</i></code> está criptografado e deve ser acessado através do LUKS usando o <code>/dev/mapper/<i>dm_nome</i></code> para nao sobrescrever os dados criptografados. Para se proteger deste tipo de acidente, leia sobre como fazer <a href="#Backup_e_restaura%C3%A7%C3%A3o">backup do cabeçalho criptografado</a> depois de terminar a configuração.
</p>
<p>Para abrir um container LUKS criptografado execute:
</p>
<pre># cryptsetup open <i>dispositivo</i> <i>dm_nome</i>
</pre>
<p>Será solicitada a senha para abrir o container. Normalmente o nome do dispositivo mapeado é uma breve descrição da função do container mapeado.
Por exemplo, o comando a seguir abre uma partição root <code>/dev/sda1</code> com LUKS, mapeia com o mapeador de dispositivos (device mapper) e nomeia-a como <code>root</code>:
</p>
<pre># cryptsetup open /dev/sda1 root
</pre>
<p>Uma vez aberto, a nomeação da partição root é definida como <code>/dev/mapper/root</code>, ao invés de ser o nome da partição (como por exemplo <code>/dev/sda1</code>).
</p>
<p>Para configurar um LVM em cima da camada de criptografia, o arquivo do dispositivo definido para o grupo de volume descriptografado será algo semelhante a <code>/dev/mapper/root</code>, ao invés de <code>/dev/sda1</code>. O LVM então fornecerá nomes adicionais para todos os volumes lógicos criados, como por exemplo <code>/dev/lvmpool/root</code> e <code>/dev/lvmpool/swap</code>.
</p>
<p>Para escrever dados criptografados dentro da partição a mesma deve ser acessada pelo nome do dispositivo mapeado. O primeiro passo para o acesso tipicamente será <a href="../../en/Sistemas_de_arquivos.html#Criar_um_sistema_de_arquivos" class="mw-redirect" title="Sistemas de arquivos">ao criar um sistema de arquivos</a>. Por exemplo:
</p>
<pre># mkfs.ext4 /dev/mapper/root
</pre>
<p>O dispositivo <code>/dev/mapper/root</code> então pode ser <a href="../../pt/File_systems.html#Montar_um_sistema_de_arquivos" class="mw-redirect" title="Monta">montado</a> como qualquer partição.
</p>
<p>Para fechar o container do LUKS, desmonte a partição e execute:
</p>
<pre># cryptsetup close root
</pre>
<div class="mw-heading mw-heading4"><h4 id="Usando_TPM_para_armazenar_chaves">Usando TPM para armazenar chaves</h4></div>
<p>Veja a página em inglês: <a href="../../en/Trusted_Platform_Module.html#LUKS_encryption" title="Trusted Platform Module">Trusted Platform Module#LUKS encryption</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Criptografando_dispositivos_com_o_modo_plain">Criptografando dispositivos com o modo plain</h3></div>
<p>Ambas as operações de criação e do acesso subsequente ao <i>dm-crypt</i> criptografado no modo plain não precisam mais do que o uso da ação <i>cryptsetup</i> <code>open</code> com os <a href="#Op%C3%A7%C3%B5es_de_encripta%C3%A7%C3%A3o_para_o_modo_plain">parâmetros</a> corretos. A seguir é mostrado dois exemplos de dispositivos que não são root, mas com a adição de um truque para empilhar ambos (ou seja, o segundo é criado dentro do primeiro). Obviamente, colocar mais camadas de criptografia dobra o uso de recursos. O caso de uso ilustrado abaixo é somente um outro exemplo da utilização das opções de cifra.
</p>
<p>O primeiro mapeamento é criado com as opções padrões do modo plain do <i>cryptsetup</i>, como descrito na coluna esquerda da tabela acima.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup --type plain -v open /dev/sd<i>xY</i> plain1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">WARNING: Using default options for cipher (aes-xts-plain64, key size 256 bits) that could be incompatible with older versions.
WARNING: Using default options for hash (sha256) that could be incompatible with older versions.
For plain mode, always use options --cipher, --key-size and if no keyfile is used, then also --hash.
Enter passphrase for /dev/sd<i>xY</i>:
Command successful.
</pre>
<p>A mensagem de forma traduzida:
</p>
<pre>AVISO: Usando opções padrões para a cifra (aes-xts-plain64, chave com tamanho 256 bits) que podem ser incompatíveis com versões mais antigas.
AVISO: Usando opções padrões para o hash (sha256) que podem ser incompatíveis com versões mais antigas.
Para o modo plain, sempre use as opções --cipher, --key-size e se nenhum arquivo-chave for usado, então inclua também --hash.
Digite a senha para /dev/sd<i>xY</i>:
Comando bem sucedido.
</pre>
<p>Agora por dentro do bloco nós podemos adicionar um segundo dispositivo de bloco, do qual usará parâmetros diferentes de criptografia e (opcionalmente) um offset. Crie um sistema de arquivos e monte-o.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup --type plain --cipher=serpent-xts-plain64 --hash=sha256 --key-size=256 --offset=10  open /dev/mapper/plain1 plain2</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter passphrase for /dev/mapper/plain1:</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># lsblk -p</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> NAME
 /dev/sda
 ├─/dev/sd<i>xY</i>
 │ └─/dev/mapper/plain1
 │   └─/dev/mapper/plain2
 ...
</pre>
<pre># mkfs -t ext2 /dev/mapper/plain2
# mount -t ext2 /dev/mapper/plain2 /mnt
# echo "Dispositivo empilhado. Uma senha para cada macaco no seu galho" &gt; /mnt/empilhado.txt
</pre>
<p>Feche o dispositivo para checar se o acesso funciona:
</p>
<pre># cryptsetup close plain2
# cryptsetup close plain1
</pre>
<p>Primeiro, vamos tentar abrir o sistema de arquivos diretamente:
</p>
<pre># cryptsetup --type plain --cipher=serpent-xts-plain64 --hash=sha256 --key-size=256 --offset=10 open /dev/sd<i>xY</i> plain2
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># mount -t ext2 /dev/mapper/plain2 /mnt</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">mount: /mnt: wrong fs type, bad option, bad superblock on /dev/mapper/plain2, missing codepage or helper program, or other error.
       dmesg(1) may have more information after failed mount system call.
</pre>
<p>A mensagem de forma traduzida:
</p>
<pre>montagem: /mnt/: tipo errado de fs (sistema de arquivos), opção ruim, superbloco ruim em /dev/mappper/plain2, codepage ou programa ajudante em falta, ou outro erro.
       dmesg(1) talvez tenha mais informações após a falha da chamada de sistema da montagem.
</pre>
<p>Por que não deu certo? O ponto de início de "plain2" (<code>10</code>) ainda está criptografado com a cifra do "plain1". Ele só pode ser acessado através do mapeamento de dispositivos empilhados. O erro, no entanto, é arbitrário, então tentar acessar com uma senha incorreta ou com opções erradas, irá resultar no mesmo. Para o modo plain do <i>dm-crypt</i>, a ação <code>open</code> não apresentará erros por si só.
</p>
<p>Tentando novamente, mas agora na ordem correta:
</p>
<pre># cryptsetup close plain2    # dispositivo mapeado disfuncional da tentativa anterior
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup --type plain open /dev/sd<i>xY</i> plain1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">WARNING: Using default options for cipher (aes-xts-plain64, key size 256 bits) that could be incompatible with older versions.
WARNING: Using default options for hash (sha256) that could be incompatible with older versions.
For plain mode, always use options --cipher, --key-size and if no keyfile is used, then also --hash.
Enter passphrase for /dev/mapper/sd<i>xY</i>:
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup --type plain --cipher=serpent-xts-plain64 --hash=sha256 --key-size=256 --offset=10 open /dev/mapper/plain1 plain2</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter passphrase for /dev/mapper/plain1:</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># mount /dev/mapper/plain2 /mnt &amp;&amp; cat /mnt/empilhado.txt</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Dispositivo empilhado. Uma senha para cada macaco no seu galho.
</pre>
<p><i>dm-crypt</i> irá cuidar da criptografia empilhada com alguns modos misturados também. Por exemplo o modo LUKS poderia ser empilhado no dispositivo mapeado "plain1". Seu cabeçalho deve estar criptografado dentro do "plain1".
</p>
<p>A opção <code>--shared</code> está somente disponível para o modo plain. Com esta um dispositivo pode ser segmentado em diferentes dispositivos mapeados sem sobreposição. Isto será exemplificado a seguir, usando um modo de cifra compatível com <i>loopaes</i> para o "plain2":
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup --type plain --offset 0 --size 1000 open /dev/sd<i>xY</i> plain1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">WARNING: Using default options for cipher (aes-xts-plain64, key size 256 bits) that could be incompatible with older versions.
WARNING: Using default options for hash (sha256) that could be incompatible with older versions.
For plain mode, always use options --cipher, --key-size and if no keyfile is used, then also --hash.
Enter passphrase for /dev/sd<i>xY</i>:</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup --type plain --offset 1000 --size 1000 --shared --cipher=aes-cbc-lmk --hash=sha256 open /dev/sd<i>xY</i> plain2</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">WARNING: Using default options for cipher (aes-xts-plain64, key size 256 bits) that could be incompatible with older versions.
WARNING: Using default options for hash (sha256) that could be incompatible with older versions.
For plain mode, always use options --cipher, --key-size and if no keyfile is used, then also --hash.
Enter passphrase for /dev/sd<i>xY</i>:</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># lsblk -p</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME
dev/sd<i>xY</i>
├─/dev/sd<i>xY</i>
│ ├─/dev/mapper/plain1
│ └─/dev/mapper/plain2
...
</pre>
<p>Como a árvore de dispositivos mostra, ambos residem no mesmo nível, elas não estão empilhadas e "plain2" pode ser aberto individualmente.
</p>
<div class="mw-heading mw-heading2"><h2 id="Ações_específicas_do_cryptsetup_para_o_LUKS">
<span id="A.C3.A7.C3.B5es_espec.C3.ADficas_do_cryptsetup_para_o_LUKS"></span>Ações específicas do cryptsetup para o LUKS</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Gerenciamento_de_chaves">Gerenciamento de chaves</h3></div>
<p>É possível definir chaves adicionais para um container LUKS. Permitindo a criação do acesso a chaves para backup de dados seguro: Na prática conhecida como key escrow, uma chave é usada para utilização diária, outra guardada para ganhar acesso ao container caso a senha seja esquecida ou a keyfile foi perdida/danificada. Um diferente espaço de chave também pode ser usado para garantir acesso de um container para um usuário ao adicionar uma segunda chave e mais tarde removê-la.
</p>
<p>Uma vez que o container criptografado foi criado, o espaço de chave (key slot) 0 é criado (se nenhum outro foi definido manualmente). Espaços de chave adicionais são numerados de 1 a 7. Os espaços de chave utilizados podem ser vistos com:
</p>
<pre># cryptsetup luksDump /dev/<i>dispositivo</i>
</pre>
<p>Onde <i>dispositivo</i> é o dispositivo de bloco que contém o cabeçalho do LUKS. Este e todos os seguintes comandos nesta seção funcionam em backups de cabeçalho também.
</p>
<div class="mw-heading mw-heading4"><h4 id="Adicionando_chaves_do_LUKS">Adicionando chaves do LUKS</h4></div>
<p>Para adicionar novos slots de chave use a ação <code>luksAddKey</code>. Por segurança, será sempre solicitada, mesmo que o dispositivo já esteja destrancado, uma chave preexistente válida ("any existing passphrase") antes que a nova senha seja solicitada:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksAddKey /dev/<i>dispositivo</i> [<i>/caminho/para/keyfile_adicional</i>]</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter any existing passphrase:
Enter new passphrase for key slot:
Verify passphrase: 
</pre>
<p>Se <code><i>/caminho/para/keyfile_adicional</i></code> for dado, cryptsetup adicionará a <code><i>keyfile_adicional</i></code>. Se não, o comando pedirá uma nova senha. Para autorizar a ação com uma <i>keyfile</i> existente, a opção <code>--key-file</code> ou <code>-d</code> seguida pela "antiga" <code><i>keyfile</i></code> irá tentar destrancar o dispositivo passando por todos os espaços de chave (keyslots) com arquivo-chaves (keyfile) registrados:
</p>
<pre># cryptsetup luksAddKey /dev/<i>dispositivo</i> [<i>/caminho/para/keyfile_adicional</i>] -d <i>/caminho/para/keyfile</i>
</pre>
<p>Se é desejado usar múltiplas chaves e mudar ou remover elas, a opção <code>--key-slot</code> ou <code>-S</code> pode ser usada para especificar o slot: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksAddKey /dev/<i>dispositivo</i> -S 6</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">AVISO: O parâmetro --key-slot é usado para um novo número de keyslot.
Enter any existing passphrase:
Enter new passphrase for key slot: 
Verify passphrase:
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksDump /dev/<i>device</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Keyslots: 
...
<b>6</b>: luks2
      Key: 	     512 bits
      Priority:  normal
...
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica</strong> Com LUKS2 é possível designar prioridades para keyslots individuais, veja <span class="plainlinks archwiki-template-man" title="$ man 8 cryptsetup-config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cryptsetup-config.8">cryptsetup-config(8)</a></span>. Por exemplo, se o slot acima <code>6</code> pretende abrir um dispositivo ao inicializar o sistema, execute <code>cryptsetup config --priority prefer --key-slot 6 /dev/<i>device</i></code> como root.</div>
<p>Para mostrar uma ação associada neste exemplo, nós decidimos aproveitar para mudar a chave:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksChangeKey /dev/<i>dispositivo</i> -S 6</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter passphrase to be changed: 
Enter new passphrase:
Verify passphrase:
</pre>
<p>Antes de removê-la.
</p>
<div class="mw-heading mw-heading4"><h4 id="Removendo_chaves_do_LUKS">Removendo chaves do LUKS</h4></div>
<p>Existem três diferentes ações para remover chaves do cabeçalho: 
</p>
<ul>
<li>
<code>luksRemoveKey</code> é usado para remover uma chave por especificar sua senha/kefile.</li>
<li>
<code>luksKillSlot</code> pode ser usado para remover uma chave específica (usando outra chave). Isto é extremamente útil se você esqueceu uma senha, perdeu uma keyfile ou não tem acesso a ela.</li>
<li>
<code>luksErase</code> é usado para rapidamente remover <b>todas</b> as chaves ativas.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção</strong> 
<ul>
<li>Todas as ações acima podem ser usadas para apagar irrevogavelmente a última chave ativa de um dispositivo criptografado!</li>
<li>O comando <code>erase</code> <b>não irá</b> solicitar por uma senha válida! Isto não irá <a href="../../en/Dm-crypt/Preparando_a_unidade_de_armazenamento.html#Apagar_o_cabe%C3%A7alho_do_LUKS" class="mw-redirect" title="Dm-crypt/Preparando a unidade de armazenamento">apagar o cabeçalho do LUKS</a>, mas sim todos os espaços de chave (keyslots) de uma vez só, então você não conseguirá mais acessar a menos que você tenha um backup válido do cabeçalho do LUKS.</li>
<li>Ao usar o comando <code>erase</code> em uma partição criptografada por hardware <a href="../../en/Self-encrypting_drives.html" class="mw-redirect" title="OPAL">OPAL</a>, o cabeçalho do LUKS será apagado juntamente com todo o conjunto de travamento criptografado pelo OPAL. Diferentemente de criptografia por software, esta ação torna o dispositivo irrecuperável, mesmo que seja usado um backup de um cabeçalho LUKS válido.</li>
</ul>
</div>
<p>Considerando os avisos acima, é essencial que a chave que desejamos <b>manter</b> seja válida. Uma forma fácil de checar é abrir o dispositivo com a opção <code>-v</code>, do qual irá especificar o espaço que a chave ocupa:  
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup --test-passphrase -v open /dev/<i>dispositivo</i> </pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">No usable token is available.
Enter passphrase for /dev/<i>dispositivo</i>: 
Key slot 1 unlocked.
Command successful.
</pre>
<p>Agora sim podemos remover a chave adicionada na subseção anterior ao usar a devida senha:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksRemoveKey /dev/<i>dispositivo</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter LUKS passphrase to be deleted:
</pre>
<p>Se for usada a mesma senha para dois espaços, a primeira ocorrência de espaço que tiver a senha vai ser apagado. Somente executando novamente a segunda vai ser apagada. 
</p>
<p>Alternativamente, é possível especificar o espaço de chave: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksKillSlot /dev/<i>dispositivo</i> 6</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter any remaining LUKS passphrase:
</pre>
<p>Note que em ambos os casos nenhuma confirmação é necessária.
</p>
<p>Reiterando o que foi falado acima: Se a mesma senha foi usada para o espaço 1 e 6, ambos os espaços com a senha devem ter sido apagados agora.
</p>
<div class="mw-heading mw-heading3"><h3 id="Backup_e_restauração">
<span id="Backup_e_restaura.C3.A7.C3.A3o"></span>Backup e restauração</h3></div>
<p>Se o cabeçalho de um container criptografado com LUKS é destruído, você não vai conseguir descriptografar seus dados. Tão problemático quanto esquecer a senha ou modificar/perder a keyfile. Danos podem acontecer por sua própria responsabilidade ao particionar novamente o disco depois ou por programas de terceiros que interpretam errado a tabela de partições. Então, ter um backup do cabeçalho e guardá-lo em outro lugar pode ser uma boa ideia.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota</strong> Se uma das senhas das partições criptografadas com LUKS for revelada, você deve retirá-la em <i>todas</i> as cópias do cabeçalho, até mesmo estes que você fez o backup. De outro modo, uma cópia do cabeçalho criptografado que a usa pode ser utilizado para determinar a chave mestre que pode ser usada para abrir o container relacionado (até mesmo o seu atual, não somente o do backup). Se a chave mestre for descoberta, você vai ter que re-criptografar todo seu container. Veja o <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions#6-backup-and-data-recovery">PAQ do LUKS</a> para mais detalhes.</div>
<div class="mw-heading mw-heading4"><h4 id="Backup_usando_o_cryptsetup">Backup usando o cryptsetup</h4></div>
<p>A ação <code>luksHeaderBackup</code> do cryptsetup faz o backup do cabeçalho LUKS e os espaços de chave:
</p>
<pre># cryptsetup luksHeaderBackup /dev/<i>dispositivo</i> --header-backup-file <i>/mnt/backup/arquivo.img</i>
</pre>
<p>Onde <code><i>dispositivo</i></code> é a partição que contém o volume LUKS.
</p>
<p>Você poderá também criar um backup do cabeçalho em texto puro dentro de um <a href="../../en/Tmpfs.html" title="Tmpfs">tmpfs</a> e criptografá-lo, com por exemplo: <a href="../../en/GnuPG.html" class="mw-redirect" title="GPG">GPG</a>, antes de escrevê-lo em um armazenamento persistente:
</p>
<pre># mount --mkdir -t tmpfs -o noswap tmpfs /root/<i>tmp</i>/
# cryptsetup luksHeaderBackup /dev/<i>dispositivo</i> --header-backup-file /root/<i>tmp</i>/<i>arquivo</i>.img
# gpg --recipient <i>User ID</i> --encrypt /root/<i>tmp</i>/<i>arquivo</i>.img 
# cp /root/<i>tmp</i>/<i>arquivo</i>.img.gpg /mnt/<i>backup</i>/
# umount /root/<i>tmp</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica</strong> A opção <code>noswap</code> garante que o sistema de arquivos não será colocado em swap no disco.</div>
<div class="mw-heading mw-heading4"><h4 id="Restauração_usando_o_cryptsetup">
<span id="Restaura.C3.A7.C3.A3o_usando_o_cryptsetup"></span>Restauração usando o cryptsetup</h4></div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção</strong> Restaurar o cabeçalho errado ou restaurar para uma partição não criptografada pode resultar em perda de dados! A ação não pode fazer uma verificação se o cabeçalho é o <i>correto</i> para dado dispositivo.</div> 
<p>Para evitar a restauração de um cabeçalho errado, você pode antecipadamente verificar se funciona ao usá-lo como um cabeçalho remoto, ou seja, com a opção <code>--header</code>: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup -v --header /mnt/<i>backup</i>/<i>arquivo</i>.img open /dev/<i>dispositivo</i> test</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">No usable token is available.
Enter passphrase for /dev/<i>dispositivo</i>:
Key slot 0 unlocked.
Command successful.
</pre>
<pre># mount /dev/mapper/test /mnt/test &amp;&amp; ls /mnt/test 
# umount /mnt/test 
# cryptsetup close test 
</pre>
<p>Agora que a verificação foi bem sucedida, a restauração pode ser feita: 
</p>
<pre># cryptsetup luksHeaderRestore /dev/<i>dispositivo</i> --header-backup-file ./mnt/<i>backup</i>/<i>arquivo</i>.img
</pre>
<p>Todos os espaços de chave (keyslots) foram sobrescrevidos; agora, logo após terminada a ação do comando, somente os espaços de chave ativos do arquivo de backup devem estar disponíveis.
</p>
<div class="mw-heading mw-heading3"><h3 id="Re-criptografando_dispositivos">Re-criptografando dispositivos</h3></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> cryptsetup 2.2 usando LUKS2 (com um cabeçalho de 16 MiB) suporta encriptação/decriptação/re-encriptação com o dispositivo online.<a rel="nofollow" class="external autonumber" href="https://mirrors.edge.kernel.org/pub/linux/utils/cryptsetup/v2.2/v2.2.0-ReleaseNotes">[3]</a> (Discuss in <a href="../../en/Talk:Dm-crypt/Device_encryption.html" title="Talk:Dm-crypt/Device encryption">talk:dm-crypt/Device encryption</a>)</div>
</div>
<p>A ação <code>reencrypt</code> do cryptsetup permite re-criptografar dispositivos LUKS. Para dispositivos em LUKS2, a re-criptografia talvez possa ser feita online, isto é, com o dispositivo montado. O mesmo possui suporte para múltiplos processos de re-criptografia em paralelo e é resiliente a falhas de sistema. Uma re-criptografia de dispositivos em LUKS1 só pode ser feita offline (dispositivo desmontado), com apenas um único processo e é menos resiliente.
</p>
<p>Veja <span class="plainlinks archwiki-template-man" title="$ man 8 cryptsetup-reencrypt"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cryptsetup-reencrypt.8">cryptsetup-reencrypt(8)</a></span> para conhecer os modos de operação e as opções.
</p>
<p>É possível mudar <a href="#Op%C3%A7%C3%B5es_de_encripta%C3%A7%C3%A3o_para_o_modo_LUKS">#Opções de encriptação para o modo LUKS</a>. Isto também pode ser usado para converter um sistema de arquivos não encriptado preexistente para um criptografado com LUKS, ou para permanentemente remover a criptografia de um dispositivo (usando a opção <code>--decrypt</code>); veja a página em inglês <a href="../../en/Removing_system_encryption.html" title="Removing system encryption"><i>Removendo a criptografia do sistema</i></a> para mais informações. Uma re-criptografia também é viável para cabeçalhos LUKS desanexados, mas tenha em mente o aviso anterior sobre a opção <code>--header</code>. Uma re-criptografia para outros modos sem ser o LUKS (por exemplo, modo plain) não é suportado.
</p>
<p>Criptografar novamente pode ser usado com a função de preservar a segurança dos dados, logo após que uma senha ou uma <a href="#Arquivos-chave/keyfiles">keyfile</a> foi comprometida <i>e</i> não há como ter certeza se alguma cópia do cabeçalho foi adquirida. Por exemplo, se houve somente o conhecimento de alguma senha por alguém sem autorização (<i>shoulder-surfed</i>), mas nenhum acesso físico/lógico ocorreu, então alterar a respectiva senha/chave deverá ser o bastante (<a href="#Gerenciamento_de_chaves">#Gerenciamento de chaves</a>).
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção</strong> Sempre tenha um <b>backup adequado e de confiança</b> disponível e verifique duas vezes as opções especificadas antes de usar a ferramenta!</div>
<p>As demonstrações a seguir são exemplos de como criptografar uma partição com um sistema de arquivos não encriptado anteriormente, como também sobre como re-criptografar um dispositivo LUKS já existente.
</p>
<div class="mw-heading mw-heading4"><h4 id="Criptografando_um_sistema_de_arquivos_preexistente_não_encriptado">
<span id="Criptografando_um_sistema_de_arquivos_preexistente_n.C3.A3o_encriptado"></span>Criptografando um sistema de arquivos preexistente não encriptado</h4></div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica</strong> Se você está tentando criptografar uma partição root preexistente, talvez seja melhor criar uma partição boot separada sem criptografia, do qual será montada em <code>/boot</code> (veja <a href="../../en/Dm-crypt/Encrypting_an_entire_system.html#Preparing_the_boot_partition" title="Dm-crypt/Encrypting an entire system">Dm-crypt/Encrypting an entire system#Preparing the boot partition</a>). Não é algo estritamente necessário, mas possui algumas vantagens:
<ul>
<li>Se <code>/boot</code> estiver localizado dentro de uma partição root criptografada, o sistema pedirá a senha duas vezes quando a máquina for ligada. A primeira vez acontecerá quando o gerenciador de boot tentar ler os arquivos dentro da partição criptografada <code>/boot</code>. A segunda vez é quando o kernel tentar montar a partição criptografada <a rel="nofollow" class="external autonumber" href="https://opencraft.com/blog/tutorial-encrypting-an-existing-root-partition-in-ubuntu-with-dm-crypt-and-luks/">[4]</a>. Provavelmente este não é o comportamento que você deseja e o mesmo pode ser evitado ao separar a partição boot e não criptografá-la.</li>
<li>Alguns aplicativos de restauração de sistema (por exemplo, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=timeshift">timeshift</a></span>) não irão funcionar se <code>/boot</code> estiver dentro de uma partição criptografada <a rel="nofollow" class="external autonumber" href="https://github.com/teejee2008/timeshift/issues/280">[5]</a>.</li>
</ul>
<p>Em resumo, crie uma partição com um tamanho de pelo menos 260MiB, se necessário. Veja como em <a href="../../pt/Partitioning.html#/boot" title="Partitioning (Português)">Particionamento#/boot</a>.
</p>
</div>
<p>Um cabeçalho do LUKS sempre é armazenado no início do dispositivo. Já que usualmente um sistema de arquivos preexistente usa todos os setores da partição, o primeiro passo é diminuir o espaço alocado para o cabeçalho do LUKS.
</p>
<p>O cabeçalho <a href="#Op%C3%A7%C3%B5es_de_encripta%C3%A7%C3%A3o_para_o_modo_LUKS">padrão</a> do LUKS2 precisa de 16MiB. Se o sistema de arquivos atual ocupa todo o espaço disponível, nós teremos que diminuí-lo para ao menos este tamanho. Para diminuir um sistema de arquivos <code>ext4</code> preexistente em <code>/dev/sda<i>xY</i></code> para o atual menor espaço possível:
</p>
<pre># umount /mnt
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># e2fsck -f /dev/sd<i>xY</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">e2fsck 1.46.5 (30-Dec-2021)
Pass 1: Checking inodes, blocks, and sizes
...
/dev/sda6: 12/166320 files (0.0% non-contiguous), 28783/665062 blocks
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># resize2fs -p -M /dev/sd<i>xY</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">resize2fs 1.46.5 (30-Dec-2021)
Resizing the filesystem on /dev/sda<i>xY</i> to 26347 (4k) blocks.
The filesystem on /dev/sdaX is now 26347 (4k) blocks long.
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica</strong> Diminuir para o mínimo de espaço com <code>-M</code> pode demorar um bom tempo. Você talvez prefira calcular um tamanho de somente 32MiB menor que o tamanho atual ao invés de usar <code>-M</code>.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção</strong> O sistema de arquivos deve ser encolhido ao passo que o dispositivo subjacente (por exemplo, uma partição) se mantenha com o tamanho original. Algumas ferramentas gráficas (por exemplo, <a href="../../en/Parted.html" class="mw-redirect" title="Gparted">Gparted</a>) talvez redimensionem tanto o sistema de arquivos quanto a partição, e com isso pode ocorrer perda de dados depois da encriptação.</div>
<p>Agora vamos criptografá-la. Ao usar a cifra padrão não há necessidade de especificá-la:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup reencrypt --encrypt --reduce-device-size 32M /dev/sd<i>xY</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">

WARNING!
========
This will overwrite data on LUKS2-temp-12345678-9012-3456-7890-123456789012.new irrevocably.

Are you sure? (Type 'yes' in capital letters): YES
Enter passphrase for LUKS2-temp-12345678-9012-3456-7890-123456789012.new:
Verify passphrase:
</pre>
<p>O aviso traduzido seria:
</p>
<pre>

ATENÇÃO!
========
Isto irá sobrescrever os dados em LUKS2-temp-12345678-9012-3456-7890-123456789012.new irrevogavelmente.

Tem certeza? (Digite 'yes' em letras maiúsculas): YES
Digite a passphrase para LUKS2-temp-12345678-9012-3456-7890-123456789012.new:
Verifique a passphrase:
</pre>
<p>Depois que acabar, toda a partição <code>/dev/sd<i>xY</i></code> estará criptografada, não somente o espaço que o sistema de arquivos foi diminuído. Para finalizar, estenda o sistema de arquivos original <code>ext4</code> para ocupar todo o espaço disponível novamente, do qual agora reside a partição criptografa:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup open /dev/sd<i>xY</i> recrypt</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter passphrase for /dev/sd<i>xY</i>:
...
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># resize2fs /dev/mapper/recrypt</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">resize2fs 1.43-WIP (18-May-2015)
Resizing the filesystem on /dev/mapper/recrypt to 664807 (4k) blocks.
The filesystem on /dev/mapper/recrypt is now 664807 (4k) blocks long.
</pre>
<pre># mount /dev/mapper/recrypt /mnt
</pre>
<p>O sistema de arquivos agora está pronto para uso. Você talvez possa querer agora adicioná-lo no seu <a href="../../pt/Crypttab.html" class="mw-redirect" title="Crypttab (Português)">crypttab</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica</strong> Se você somente criptografou sua partição root, talvez você precise realizar alguns ajustes pós-encriptação.
<ol>
<li>Configure mkinitcpio e os parâmetros de kernel. Veja na página em inglês <a href="../../en/Dm-crypt/System_configuration.html#Unlocking_in_early_userspace" title="Dm-crypt/System configuration">dm-crypt/System configuration#Unlocking in early userspace</a>.</li>
<li>Atualizar a entrada de <code>/</code> em <a href="../../pt/Fstab.html" title="Fstab (Português)">fstab</a> para o uso do especificador de volume do dispositivo destravado (por exemplo, <a href="../../pt/Persistent_block_device_naming.html#by-uuid" title="Persistent block device naming (Português)">UUID</a>).</li>
</ol>
</div>
<div class="mw-heading mw-heading4"><h4 id="Re-criptografando_uma_partição_LUKS_preexistente">
<span id="Re-criptografando_uma_parti.C3.A7.C3.A3o_LUKS_preexistente"></span>Re-criptografando uma partição LUKS preexistente</h4></div>
<p>Neste exemplo um dispositivo LUKS que já existe é criptografado novamente.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção</strong> <i>Nunca</i> re-criptografe sem um '<i>backup adequado e de confiança</i>! Se você estiver re-criptografando por conta de um vazamento de senha (por exemplo, após ser vigiado pela tática do <i>shoulder-surfing</i>), use <code>luksChangeKey</code> <i>antes</i> de re-criptografar e/ou de criar um backup.</div>
<p>Para encriptar novamente um dispositivo juntamente com as opções de encriptação utilizadas atualmente, tais opções não precisam ser especificadas:
</p>
<pre># cryptsetup reencrypt /dev/sd<i>xY</i>
</pre>
<p>Chaves existentes permanecem ao re-criptografar um dispositivo com uma outra cifra e/ou hash diferente.
</p>
<p>Outro caso de uso para a re-criptografia seria para aqueles dispositivos LUKS que não possuem as atuais opções de encriptação. Nestes casos, você deve especificar as novas opções desejadas. Note que um cabeçalho LUKS2 permite encriptação por espaço de chave individual, portanto a re-criptografia será aplicada apenas para o segmento do dado.
</p>
<p>A habilidade de mudar o cabeçalho do LUKS talvez seja limitada pelo tamanho. Por exemplo, se o dispositivo era inicialmente criptografado com LUKS1 usando o modo CBC de cifra e 128 bit de tamanho de chave, o cabeçalho do LUKS será metade do tamanho dos já mencionados <code>4096</code> setores: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksDump /dev/sd<i>xY</i> | grep -e "mode" -e "Payload" -e "MK bits"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Cipher mode:   	cbc-essiv:sha256
Payload offset:	<b>2048</b>
MK bits:       	128
</pre>
<p>Para atualizar as opções de encriptação de tal dispositivo, considere primeiramente <a href="#Convertendo_de_LUKS1_para_LUKS2_e_revertendo">converter</a> o cabeçalho para LUKS2 e só assim re-criptografar. Se a conversão falhar por conta de um tamanho de cabeçalho inadequado, você provavelmente precisará criptografar novamente com a opção <code>--reduce-device-size</code>, da qual disponibilizará mais espaço para o cabeçalho maior. Porém, este processo deve ser feito antes de re-criptografar com as novas opções de encriptação almejadas. Da mesma forma, mantenha em mente que ambos os métodos possuem riscos, que são inerentes de seus processos: tanto para o cabeçalho durante a conversão, quanto para os dados do sistema de arquivos se os mesmos estiverem em uso e você precisar liberar espaço.
</p>
<div class="mw-heading mw-heading3"><h3 id="Convertendo_de_LUKS1_para_LUKS2_e_revertendo">Convertendo de LUKS1 para LUKS2 e revertendo</h3></div>
<p>A ferramenta do <i>cryptsetup</i> possui a ação <code>convert</code> para conversão de cabeçalhos no formato LUKS1 e LUKS2. É aconselhável criar um <a href="#Backup_usando_o_cryptsetup">backup do cabeçalho</a> antes de fazer a conversão. Neste processo o argumento <code>--type</code> é um <b>requerimento</b>.
</p>
<p>Migração do LUKS1 para LUKS2:
</p>
<pre># crytpsetup convert --type luks2 /dev/sd<i>xY</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota</strong> O tamanho do cabeçalho do LUKS será de 16MiB ao invés de 2MiB.</div>
<p>Para retroceder ao LUKS1 (por exemplo, para inicializar o sistema pelo <a href="../../en/GRUB.html#Encrypted_/boot" title="GRUB">GRUB com criptografia em /boot</a>):
</p>
<pre># cryptsetup convert --type luks1  /dev/sd<i>xY</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota</strong> Conversão do LUKS2 para LUKS1 <b>não é</b> sempre possível. Você talvez presencie o seguinte erro:
<pre><i>Cannot convert to LUKS1 format - keyslot 0 is not LUKS1 compatible.</i> 
</pre>
<p>De forma traduzida: 
</p>
<pre>Não é possível converter para o formato LUKS1 - espaço de chave 0 não é compatível com LUKS1.
</pre>
<p>Se o container estiver usando Argon2, então é preciso converter para PBKDF2, de forma que seja compatível com LUKS1.
</p>
<pre># cryptsetup luksConvertKey --pbkdf2 /dev/sd<i>xY</i>
</pre>
</div>
<div class="mw-heading mw-heading2"><h2 id="Redimensionando_os_dispositivos_criptografados">Redimensionando os dispositivos criptografados</h2></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Esta seção precisa ser reescrita para introduzir mais genericamente o redimensionamento. Talvez junto com o <a href="../../en/Resizing_LVM-on-LUKS.html" title="Resizing LVM-on-LUKS">Resizing LVM-on-LUKS</a>. (Discuss in <a href="../../en/Talk:Dm-crypt/Device_encryption.html" title="Talk:Dm-crypt/Device encryption">talk:dm-crypt/Device encryption</a>)</div>
</div>
<p>Se um dispositivo de armazenamento criptografado com dm-crypt está sendo clonado (com uma ferramenta como o <a href="../../pt/Dd.html" title="Dd (Português)">dd</a>) para outro dispositivo maior, ou se a partição estiver sendo expandida ou encolhida, o sistema de arquivos subjacente precisará ser redimensionado. Para dispositivos baseados em LUKS, este é o único passao necessário, pois LUKS não armazena nenhuma informação sobre o tamanho da partição e usa o tamanho total como padrão, ou seja, quando nenhum parâmetro <code>--size</code> é passado. Para este fim, siga os passos habituais necessários na página em inglês: <a href="../../en/Parted.html#Resizing_partitions" title="Parted"><i>resize a partition</i></a>. Um exemplo para o dispositivo LUKS criptografado <code>/dev/sdX2</code> que contém um sistema de arquivos <i>ext4</i> que precisa ser expandido seria: 
</p>
<p>Primeiramente, redimensione a partição subjacente com <a href="../../en/Parted.html" title="Parted">Parted</a> ou <a href="../../en/Fdisk.html" title="Fdisk">fdisk</a>. Um detalhe importante: ao encolher uma partição, isto precisa ser feito por último. Agora, abra o seu dispositivo e redimensione o sistema de arquivos: 
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção</strong> Considere fazer um backup dos seus dados antes de redimensionar e não monte o respectivo sistema de arquivos.</div>
<pre># cryptsetup luksOpen /dev/sdX2 sdX2
# e2fsck /dev/mapper/sdX2
# resize2fs /dev/mapper/sdX2  # Usa todo o espaço disponível da partição LUKS alargada.
</pre>
<p>Depois de montar o dispositivo LUKS mapeado que aumentou de tamanho, ele pode ser usado da mesma forma como antes.
</p>
<pre># mount /dev/mapper/sdX2 /mnt/sdX2_expandido
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota</strong> cryptsetup-resize é um comando para redimensionar uma partição mapeada ativamente e normalmente não é preciso usar ao redimensionar um sistema de arquivos <i>ext2/3/4</i>.</div>
<div class="mw-heading mw-heading3"><h3 id="LVM_em_LUKS">LVM em LUKS</h3></div>
<p>Veja a página em inglês: <a href="../../en/Resizing_LVM-on-LUKS.html" title="Resizing LVM-on-LUKS"><i>Resizing LVM on LUKS</i></a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Sistema_de_arquivos_de_loopback">Sistema de arquivos de loopback</h3></div>
<p>Assuma que um sistema de arquivos de loopback criptografado está no arquivo <code>grande_segredo</code>, ligado ao <code>/dev/loop0</code>, mapeado como <code>segredo</code> e montado em <code>/mnt/segredo</code>, como no exemplo presente em <a href="../../en/2f927aac425f6489880e149be1b9b36e.html#Dispositivo_de_loop" class="mw-redirect" title="Dm-crypt/Criptografando um sistema de arquivos não raiz">dm-crypt/Criptografando um sistema de arquivos não raiz#Dispositivo de loop</a>.
</p>
<p>Se o container está mapeado e/ou montado, o desmonte e/ou feche:
</p>
<pre># umount /mnt/segredo
# cryptsetup close segredo
# losetup -d /dev/loop0
</pre>
<p>Depois, expanda o arquivo do container com o tamanho dos dados que você deseja adicionar. Neste exemplo, o arquivo será expandido em 1MiB × 1024, que é 1GiB.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção</strong> Tenha a absoluta certeza e confirme que você está usando as opções <code>oflag=append conv=notrunc</code>, senão você irá sobrescrever o arquivo ao invés de adicionar os dados ao final dele. Fazer um backup antes desse passo é fortemente recomendado.</div>
<pre># dd if=/dev/urandom of=/grande_segredo bs=1M count=1024 iflag=fullblock oflag=append conv=notrunc status=progress
</pre>
<p>Agora mapeie o container para o dispositivo de loop:
</p>
<pre># losetup /dev/loop0 grande_segredo
# cryptsetup open /dev/loop0 segredo
</pre>
<p>Depois disso, redimensione a parte criptografada do container para o novo tamanho máximo do arquivo container:
</p>
<pre># cryptsetup resize segredo
</pre>
<p>Finalmente, cheque o sistema de arquivos e, se está ok, o redimensione (exemplo para ext2/3/4):
</p>
<pre># e2fsck -f /dev/mapper/segredo
# resize2fs /dev/mapper/segredo
</pre>
<p>É possível, então, montar o container novamente:
</p>
<pre># mount /dev/mapper/segredo /mnt/segredo
</pre>
<div class="mw-heading mw-heading3"><h3 id="Dispositivo_com_integridade_protegida">Dispositivo com integridade protegida</h3></div>
<p>Se o dispositivo foi formatado com suporte a integridade (por exemplo, <code>--integrity hmac-sha256</code>) e o dispositivo de bloco não volátil foi encolhido, então ele não poderá ser aberto. O resultado é o seguinte erro: <code>device-mapper: reload ioctl on failed: Invalid argument</code>, ou de forma traduzida: <code>mapeador-dispositivos: recarregar ioctl falhou: Argumento inválido</code>.
</p>
<p>Para consertar esse problema sem ter que limpar os dados do dispositivo novamente, ele pode ser formatado com a chave mestre criada anteriormente (mantendo assim as <i>tags</i> por setor válidas).
</p>
<pre># cryptsetup luksDump /dev/sdX2 --dump-master-key --master-key-file=/tmp/chave-mestre-em-tmpfs.key
# cryptsetup luksFormat /dev/sdX2 --type luks2 --integrity hmac-sha256 --master-key-file=/tmp/chave-mestre-em-tmpfs.key --integrity-no-wipe
# rm /tmp/chave-mestre-em-tmpfs.key
</pre>
<div class="mw-heading mw-heading2"><h2 id="Arquivos-chave/keyfiles">
<span id="Arquivos-chave.2Fkeyfiles"></span>Arquivos-chave/keyfiles</h2></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota</strong> Esta seção descreve o uso de um arquivo-chave em texto puro. Se deseja criptografar o arquivo para conseguir autenticação de dois fatores, veja a página em inglês: <a href="../../en/Dm-crypt/Specialties.html#Using_GPG,_LUKS,_or_OpenSSL_encrypted_keyfiles" title="Dm-crypt/Specialties"><i>Using GPG, LUKS or OpenSSL encrypted keyfiles</i></a> para saber mais detalhes. De toda forma, considere ler esta seção.</div>
<p><b>O que é um arquivo-chave/keyfile?</b>
</p>
<p>Um arquivo-chave, também denominado como "keyfile", é um arquivo cujo os dados são usados como senha para abrir um volume criptografado. Significa que se tal arquivo é perdido ou modificado, destrancar e abrir o volume pode não ser mais possível.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica</strong> Adicione uma senha em texto simples (passphrase) além da keyfile para evitar a situação citada acima.</div>
<p><b>Por que usar um arquivo-chave/keyfile?</b>
</p>
<p>Existem muitos tipos de keyfiles. Cada tipo possui suas vantagens e desvantagens, dos quais estão resumidos abaixo:
</p>
<div class="mw-heading mw-heading3"><h3 id="Tipos_de_arquivo-chave">Tipos de arquivo-chave</h3></div>
<div class="mw-heading mw-heading4"><h4 id="Texto_simples_(passphrase)">
<span id="Texto_simples_.28passphrase.29"></span>Texto simples (passphrase)</h4></div>
<p>Este é um arquivo-chave que contém uma senha em texto simples, também denominado como "passphrase". O benefício deste tipo de arquivo-chave é que se caso o arquivo for perdido, o dado contido nele é conhecido e foi facilmente memorizado pelo proprietário do volume criptografado. Todavia, isto não trás nenhuma segurança extra ao digitar e confirmar a senha durante o começo da inicialização do sistema.
</p>
<p>Exemplo:
</p>
<p><code>correct horse battery staple</code>
</p>
<p>Também poderia ser:
</p>
<p><code>correto cavalo bateria grampo</code>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota</strong> A keyfile que contém a senha não deve ter quebra de linha, ou seja, uma <i>newline</i> dentro dela. Uma opção é criá-la usando:
<pre># printf '%s' '<i>sua_senha</i>' | install -m 0600 /dev/stdin /etc/cryptsetup-keys.d/<i>arquivo-chave</i>.key
</pre>
<p>Se o arquivo contém caracteres especiais, como aspas ou barras invertidas, ao invés de espaçar estes caracteres, é recomendado simplesmente editar o arquivo-chave, digitando diretamente ou copiando e colando a senha, e então remover a quebra de linha com um comando útil em perl de uma linha:
</p>
<pre># perl -pi -e 'chomp if eof' /etc/cryptsetup-keys.d/<i>arquivo-chave</i>.key
</pre>
</div>
<div class="mw-heading mw-heading4"><h4 id="Caracteres_aleatórios">
<span id="Caracteres_aleat.C3.B3rios"></span>Caracteres aleatórios</h4></div>
<p>Este tipo de keyfile contém um bloco de texto randômico. O benefício deste tipo de arquivo-chave é que é muito mais resistente a ataques de dicionário do que uma senha em texto simples. Um ponto forte a considerar em situações em que há a possibilidade de usá-la, é o comprimento de dado criado. Por não ser uma <i>string</i> feita para ser memorizada por uma pessoa como senha, é algo trivial criar arquivos contendo milhares de caractetes aleatórios como uma chave. A desvantagem é que se este arquivo é perdido ou modificado, muito provavelmente o acesso ao volume criptografado será igualmente perdido, se caso também não houver uma senha de backup. 
</p>
<p>Um arquivo-chave com texto randômico pode usar qualquer tipo de conjunto de caracteres, porém manter a portabilidade para letras em ASCII e em números pode facilitar as coisas; como em ocasiões que o layout do teclado ou o suporte para Unicode é precário, como ao digitar uma senha de emergência no estágio de destravamento na inicialização do LUKS, ou ao mensurar arquivos-chaves com utilitários de POSIX antigos com Unicode primitivo. Nestes casos, você pode gerar uma string desta forma:
</p>
<pre>$ tr -dc [:alnum:]' &lt;/dev/urandom | head -c64
</pre>
<p>Exemplo: <code>rTCBW6j1dI2aYC5KcD6Ar38rBGN2DkWyang3RT7pdMGpdf1kRuMXi8EBHKu0BJ8X</code>
</p>
<p>Alternativamente, um arquivo-chave de caracteres aleatórios em Unicode (UTF-8) pode se aparentar de tal maneira:
</p>
<p>Exemplo: <code>W[�5ODó?Oéµ»9���¬hjT}­�DÐ§íŽ�uLÝæ�Ýœ�§aþ�óx±)Ñ)l­éeð��ú=èe</code>
</p>
<div class="mw-heading mw-heading4"><h4 id="Binário">
<span id="Bin.C3.A1rio"></span>Binário</h4></div>
<p>É um arquivo binário que foi definido como keyfile. Quando identificar candidatos para uma keyfile, é recomendado que escolha fotos relativamente estáticas como fotos, músicas, vídeos. A vantagem, esses arquivos tem outras funções que dificultam a sua identificação como keyfile. Ao invês de ter um arquivo de texto com uma grande quantidade de texto randômico, a keyfile vai ser considerada como um arquivo de mídia normal. A desvantagem, se o arquivo for perdido ou mudado, provavelmente não será mais possível acessar o volume criptografado sem outra chave. Adicionalmente, existe teoricamente uma perda de aleatoriedade se comparado com um arquivo de texto randômico. Isto é devido ao fato que imagens, vídeos e músicas tem uma relação intríseca entre bits de dados vizinhos que não existe num texto randômico. No entanto isto é controverso e nunca foi publicamente explorado.
</p>
<p>Exemplo: imagens, texto, video ...
</p>
<div class="mw-heading mw-heading3"><h3 id="Criando_um_arquivo-chave_com_caracteres_aleatórios">
<span id="Criando_um_arquivo-chave_com_caracteres_aleat.C3.B3rios"></span>Criando um arquivo-chave com caracteres aleatórios</h3></div>
<div class="mw-heading mw-heading4"><h4 id="Armazenando_o_arquivo-chave_em_um_sistema_de_arquivos">Armazenando o arquivo-chave em um sistema de arquivos</h4></div>
<p>Um arquivo-chave pode ser de conteúdo e tamanho arbitrários. 
</p>
<p>Aqui é utilizado o <code>dd</code> para gerar um arquivo-chave de 2048 bytes aleatórios, e então armazenando no arquivo <code>/etc/cryptsetup-keys.d/minhakeyfile.key</code>:
</p>
<pre># dd bs=512 count=4 if=/dev/random iflag=fullblock | install -m 0600 /dev/stdin /etc/cryptsetup-keys.d/minha_keyfile.key
</pre>
<p>Se você planeja guardar a keyfile em um dispositivo externo, você pode simplesmente mudar o arquivo de saída para o diretório correspondente:
</p>
<pre># dd bs=512 count=4 if=/dev/random of=/run/media/<i>usuário</i>/<i>pendrive</i>/minha_keyfile.key iflag=fullblock
</pre>
<div class="mw-heading mw-heading5"><h5 id="Sobrescrevendo_com_segurança_os_arquivos-chave_armazenados">
<span id="Sobrescrevendo_com_seguran.C3.A7a_os_arquivos-chave_armazenados"></span>Sobrescrevendo com segurança os arquivos-chave armazenados</h5></div>
<p>Se você guardou a sua keyfile temporária em uma unidade de armazenamento e quer deletá-la, use algo parecido com isso:
</p>
<pre># shred --remove --zero minha_keyfile
</pre>
<p>Para sobrescrever com segurança, em sistemas de arquivos arcaicos, como FAT ou ext2, isto deve bastar, considerando que são sistemas de arquivos com <i>journaling</i> (ou seja, sistemas de arquivos que rastreiam e registram os eventos antes mesmo de serem efetivados na parte principal de gravação). Ao usar hardware de memória em flash e em outros casos é recomendado <a href="../../en/Securely_wipe_disk.html" title="Securely wipe disk">apagar o dispositivo inteiro</a>.
</p>
<div class="mw-heading mw-heading4"><h4 id="Armazenando_o_arquivo-chave_no_tmpfs_(com_swapping_desativado)">
<span id="Armazenando_o_arquivo-chave_no_tmpfs_.28com_swapping_desativado.29"></span>Armazenando o arquivo-chave no tmpfs (com swapping desativado)</h4></div>
<p>Alternativamente, você pode montar um <a href="../../en/Tmpfs.html" title="Tmpfs">tmpfs</a> com a função de <i>swapping</i> desativada para guardar a keyfile temporariamente:
</p>
<pre># mount --mkdir -t tmpfs -o noswap tmpfs /root/meu_tmpfs
# cd /root/meu_tmpfs
</pre>
<p>A vantagem é que ela reside na RAM e não em um disco físico, portanto o arquivo-chave não pode ser recuperado depois de desmontar o tmpfs. Depois de copiar a keyfile para outro sistema de arquivos seguro e persistente, desmonte o tmpfs novamente com:
</p>
<pre># umount /root/meu_tmpfs
</pre>
<div class="mw-heading mw-heading3"><h3 id="Configurando_o_LUKS_para_utilizar_o_arquivo-chave">Configurando o LUKS para utilizar o arquivo-chave</h3></div>
<p>Adicione um espaço de chave (keyslot) para a keyfile no cabeçalho do LUKS:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksAddKey /dev/sda2 /etc/cryptsetup-keys.d/minha_keyfile.key</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter any existing passphrase:
</pre>
<div class="mw-heading mw-heading3"><h3 id="Manualmente_abrindo_uma_partição_com_um_arquivo-chave">
<span id="Manualmente_abrindo_uma_parti.C3.A7.C3.A3o_com_um_arquivo-chave"></span>Manualmente abrindo uma partição com um arquivo-chave</h3></div>
<p>Use a opção <code>--key-file</code> quando for abrir um dispositivo LUKS:
</p>
<pre># cryptsetup open /dev/sda2 <i>dm_nome</i> --key-file /etc/cryptsetup-keys.d/minha_keyfile.key
</pre>
<div class="mw-heading mw-heading4"><h4 id="Com_um_aquivo-chave_em_um_dispositivo_externo">Com um aquivo-chave em um dispositivo externo</h4></div>
<div class="mw-heading mw-heading5"><h5 id="Configurando_o_mkinitcpio">Configurando o mkinitcpio</h5></div>
<p>Você deve adicionar o módulo de kernel usado pelo <a href="../../en/Sistema_de_arquivos.html" class="mw-redirect" title="Sistema de arquivos">sistema de arquivos</a> junto com o <a href="../../pt/Mkinitcpio.html#MODULES" title="Mkinitcpio (Português)">conjunto de módulos</a> em <code>/etc/mkinitcpio.conf</code>. Por exemplo, adicione <code>ext4</code> se o sistema de arquivos for <a href="../../pt/Ext4.html" title="Ext4 (Português)">Ext4</a> ou <code>vfat</code> no caso de um em <a href="../../en/FAT.html" title="FAT">FAT</a>:
</p>
<pre>MODULES=(vfat)
</pre>
<p>Se houver menssagens sobre um "bad superblock" e "bad codepage" na inicialização, é necessário então que o sistema carregue um módulo de codepage extra. Você talvez precise do módulo <code>nls_iso8859-1</code> para a codepage <code>iso8859-1</code>.
</p>
<p><a href="../../en/Gere_novamente_o_initramfs.html" class="mw-redirect" title="Gere novamente o initramfs">Gere novamente o initramfs</a>.
</p>
<div class="mw-heading mw-heading5"><h5 id="Configurando_os_parâmetros_de_kernel">
<span id="Configurando_os_par.C3.A2metros_de_kernel"></span>Configurando os parâmetros de kernel</h5></div>
<ul>
<li>Para um initramfs baseado em busybox que usa o hook <a href="../../pt/Dm-crypt/System_configuration.html#Usando_o_hook_encrypt" title="Dm-crypt (Português)/System configuration (Português)">encrypt</a>, veja <a href="../../pt/Dm-crypt/System_configuration.html#cryptkey" title="Dm-crypt (Português)/System configuration (Português)">dm-crypt/Configuração de Sistema#cryptkey</a>.</li>
<li>Para um initramfs baseado em systemd que usa o hook <a href="../../en/e90e6c51a35f947e9a37e0983b6b2e16.html#Usando_o_hook_sd-encrypt" class="mw-redirect" title="Dm-crypt/Configuração do sistema">sd-encrypt</a>, veja <a href="../../pt/Dm-crypt/System_configuration.html#rd.luks.key" title="Dm-crypt (Português)/System configuration (Português)">dm-crypt/Configuração de Sistema#rd.luks.key</a>.</li>
</ul>
<div class="mw-heading mw-heading4"><h4 id="Com_um_arquivo-chave_embutido_em_initramfs">Com um arquivo-chave embutido em initramfs</h4></div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção</strong> Use uma keyfile dentro do initramfs <b>somente</b> se você proteger a keyfile suficientemente com:
<ul>
<li>Alguma forma de autenticação prévia no processo de inicialização. De outro modo, o dispositivo vai ser aberto automaticamente, e com isso destruir totalmente o propósito da criptografia.</li>
<li>
<code>/boot</code> é criptografado. De outro modo, a raiz de outra instalação (incluindo o <a href="../../en/86d829e2ec7d3d50c4ba8e87ea709300.html#Inicializar_o_ambiente_live" class="mw-redirect" title="Guia de instalação">ambiente live</a>) pode extrair sua chave do initramfs, e descriptografar o dispositivo sem qualquer outro meio de autenticação.</li>
</ul>
</div>
<p>Este método permite o uso de um arquivo-chave escolhido especialmente para ser incorporado ao <a href="../../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">initramfs</a> e pego pelo <a href="../../pt/Mkinitcpio.html#HOOKS" title="Mkinitcpio (Português)">hook</a> <code>encrypt</code> para abrir o sistema de arquivos raiz (<code>cryptdevice</code>) automaticamente. Pode ser útil ao usar o recurso de encriptação <a href="../../pt/GRUB.html#/boot_criptografado" title="GRUB (Português)">cryptodisk na inicialização do GRUB</a>, e com isso evitar a digitação e confirmação de duas senhas durante a inicialização.
</p>
<p><a href="#Criando_um_arquivo-chave_com_caracteres_aleat%C3%B3rios">Gere um arquivo-chave</a>, defina permissões apropriadas e a <a href="#Adicionando_chaves_do_LUKS">adicione como uma chave do LUKS</a>:
</p>
<pre># dd bs=512 count=4 if=/dev/random iflag=fullblock | install -m 0600 /dev/stdin /etc/cryptsetup-keys.d/root.key
# cryptsetup luksAddKey /dev/sd<i>X#</i> /etc/cryptsetup-keys.d/root.key
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota</strong> O initramfs é gerado pelo mkinitcpio com as <a href="../../pt/File_permissions_and_attributes.html" title="File permissions and attributes (Português)">permissões</a> configuradas em <code>600</code> por padrão, então usuários comuns do sistema não conseguem ler o conteúdo da keyfile através do initramfs gerado.</div>
<p>Inclua a chave no <a href="../../pt/Mkinitcpio.html#BINARIES_e_FILES" title="Mkinitcpio (Português)">arranjo de arquivos do mkinitcpio</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">FILES=(/etc/cryptsetup-keys.d/root.key)</pre>
<p><a href="../../en/Gere_novamente_o_initramfs.html" class="mw-redirect" title="Gere novamente o initramfs">Gere novamente o initramfs</a>.
</p>
<p>Para o hook <code>encrypt</code>, o arquivo-chave é especificado com o parâmetro de kernel <code>cryptkey=</code>: no caso do initramfs, a sintaxe é <code>rootfs:<i>caminho/para/arquivo-chave</i></code>. O nome padrão e caminho definido é: <code>/crypto_keyfile.bin</code>. É possível omitir <code>cryptkey</code> se o initramfs conter uma chave válida neste caminho. Veja <a href="../../pt/Dm-crypt/System_configuration.html#cryptkey" title="Dm-crypt (Português)/System configuration (Português)">dm-crypt/Configuração de Sistema#cryptkey</a>.
</p>
<p>Para o exemplo acima, configure o seguinte parâmetro de kernel ao usar um initramfs baseado em busybox com o hook <code>encrypt</code>:
</p>
<pre># cryptkey=rootfs:/etc/cryptsetup-keys.d/root.key
</pre>
<p>Se, caso o contrário, for usado o hook <code>sd-encrypt</code>, o arquivo-chave é especificado com o parâmetro de kernel <code>rd.luks.key=</code>: no caso do initramfs, a sintaxe é <code>/<i>caminho/para/arquivo-chave</i></code>. O nome padrão e caminho definido é: <code>/etc/cryptsetup-keys.d/<i>nome</i>.key</code> (o <code><i>nome</i></code> é o mesmo que <i>dm_nome</i>, ou seja, o nome do dispositivo mapeado para descriptografar em <a href="#Criptografando_dispositivos_com_o_modo_LUKS">#Criptografando dispositivos com o modo LUKS</a>). É possível omitir <code>rd.luks.key</code> se o initramfs conter uma chave válida neste caminho. Veja <a href="../../pt/Dm-crypt/System_configuration.html#rd.luks.key" title="Dm-crypt (Português)/System configuration (Português)">dm-crypt/Configuração do sistema#rd.luks.key</a>.
</p>
<p>Na próxima inicialização, você deverá somente precisar entrar com a senha de desencriptação do container uma vez.
</p>
<p>(<a rel="nofollow" class="external text" href="https://www.pavelkogan.com/2014/05/23/luks-full-disk-encryption/#bonus-login-once">fonte</a>)
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../pt/Category:Data-at-rest_encryption.html" title="Category:Data-at-rest encryption (Português)">Data-at-rest encryption (Português)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Dm-crypt_(Portugu%C3%AAs)/Device_encryption_(Portugu%C3%AAs)&amp;oldid=850618">https://wiki.archlinux.org/index.php?title=Dm-crypt_(Português)/Device_encryption_(Português)&amp;oldid=850618</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 25 October 2025, at 10:38.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container no-font-mode-scale">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue  vector-search-box-show-thumbnail vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search cdx-typeahead-search--show-thumbnail">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input mw-searchInput" autocomplete="off" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true">dm-crypt (Português)/Device encryption (Português)</div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only reading-lists-bookmark" id="ca-bookmark-sticky-header" tabindex="-1" data-event-name="watch-sticky-bookmark"><span class="vector-icon mw-ui-icon-wikimedia-bookmarkOutline mw-ui-icon-wikimedia-wikimedia-bookmarkOutline"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
