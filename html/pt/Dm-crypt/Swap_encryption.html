<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>dm-crypt (Português)/Swap encryption (Português) - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.45.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Dm-crypt_Português_Swap_encryption_Português rootpage-Dm-crypt_Português skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Sem_suporte_a_suspender_para_o_disco" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Sem_suporte_a_suspender_para_o_disco">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Sem suporte a suspender para o disco</span>
			</div>
		</a>
		
			<button aria-controls="toc-Sem_suporte_a_suspender_para_o_disco-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Sem suporte a suspender para o disco subsection</span>
			</button>
		
		<ul id="toc-Sem_suporte_a_suspender_para_o_disco-sublist" class="vector-toc-list">
			<li id="toc-UUID_e_LABEL" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#UUID_e_LABEL">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.1</span>
					<span>UUID e LABEL</span>
				</div>
			</a>
			
			<ul id="toc-UUID_e_LABEL-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Desabilitando_hibernação_nos_ambientes_desktop" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Desabilitando_hiberna%C3%A7%C3%A3o_nos_ambientes_desktop">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.2</span>
					<span>Desabilitando hibernação nos ambientes desktop</span>
				</div>
			</a>
			
			<ul id="toc-Desabilitando_hibernação_nos_ambientes_desktop-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Com_suporte_a_suspender_para_o_disco" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Com_suporte_a_suspender_para_o_disco">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Com suporte a suspender para o disco</span>
			</div>
		</a>
		
			<button aria-controls="toc-Com_suporte_a_suspender_para_o_disco-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Com suporte a suspender para o disco subsection</span>
			</button>
		
		<ul id="toc-Com_suporte_a_suspender_para_o_disco-sublist" class="vector-toc-list">
			<li id="toc-LVM_dentro_do_LUKS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#LVM_dentro_do_LUKS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>LVM dentro do LUKS</span>
				</div>
			</a>
			
			<ul id="toc-LVM_dentro_do_LUKS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Usando_uma_partição_swap" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Usando_uma_parti%C3%A7%C3%A3o_swap">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>Usando uma partição swap</span>
				</div>
			</a>
			
			<ul id="toc-Usando_uma_partição_swap-sublist" class="vector-toc-list">
				<li id="toc-Hook_do_mkinitcpio" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Hook_do_mkinitcpio">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2.1</span>
					<span>Hook do mkinitcpio</span>
				</div>
			</a>
			
			<ul id="toc-Hook_do_mkinitcpio-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Usando_um_arquivo_swap" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Usando_um_arquivo_swap">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3</span>
					<span>Usando um arquivo swap</span>
				</div>
			</a>
			
			<ul id="toc-Usando_um_arquivo_swap-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Problemas_conhecidos" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Problemas_conhecidos">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Problemas conhecidos</span>
			</div>
		</a>
		
		<ul id="toc-Problemas_conhecidos-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar no-font-mode-scale">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">dm-crypt (Português)/Swap encryption (Português)</h1>
							
</header>
				<div class="vector-column-end no-font-mode-scale">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <bdi dir="ltr"><a href="../../pt/Dm-crypt.html" title="Dm-crypt (Português)">Dm-crypt (Português)</a></bdi>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="pt" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Status de tradução:</strong> Esse artigo é uma tradução de <a href="../../en/Dm-crypt/Swap_encryption.html" title="Dm-crypt/Swap encryption">dm-crypt/Swap encryption</a>. Data da última tradução: 2021-02-15. Você pode ajudar a sincronizar a tradução, se houver <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Dm-crypt/Swap_encryption&amp;diff=0&amp;oldid=651200">alterações</a> na versão em inglês.</div>
<p>Dependendo da necessidade, diferentes métodos podem ser usados para criptografar a partição <a href="../../pt/Swap.html" title="Swap (Português)">swap</a>. Uma configuração onde a partição swap é criptografada na inicialização oferece maior proteção dos dados, devido a evitar uma situação onde fragmentos de arquivos sensíveis colocados lá, e que não foram sobrescrevidos, estejam alcançáveis. No entanto, criptografar a swap em cada inicialização impossibilita a suspensão para o disco.
</p>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Sem_suporte_a_suspender_para_o_disco">Sem suporte a suspender para o disco</h2></div>
<p>Em sistemas onde suspender para o disco (hibernação) não é desejado, <code>/etc/crypttab</code> pode ser usado para abrir a partição swap com uma senha randômica com o modo plain do dm-crypt no tempo de inicialização. Ao desligar o sistema, a senha aleartória é descartada, fazendo os dados criptografados inacessíveis.
</p>
<p>Para habilitar esta funcionalidade, simplesmente descomente a linha que começa com <code>swap</code> no <code>/etc/crypttab</code>. Mude o parâmetro <code>&lt;dispositivo&gt;</code> para seu dispositivo swap. Por exemplo, deve parecer com:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># &lt;name&gt;  &lt;device&gt;    &lt;password&gt;     &lt;options&gt;
swap      /dev/sd<i>X#</i>   /dev/urandom   swap,cipher=aes-xts-plain64,size=256</pre>
<p>Isto vai mapear <code>/dev/sd<i>X#</i></code> para <code>/dev/mapper/swap</code> e assim esta pode ser adicionada em <code>/etc/fstab</code> como uma swap normal. Se você tinha uma partição swap não criptografada antes, não se esqueça de desabilitá-la - ou reutilizar sua entrada do <a href="../../pt/Fstab.html" title="Fstab (Português)">fstab</a> ao mudar o dispositivo para <code>/dev/mapper/swap</code>. As opções padrão devem ser o suficiente para a maioria dos usuários. Para outras opções e uma explicação de cada coluna, veja <span class="plainlinks archwiki-template-man" title="$ man 5 crypttab"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/crypttab.5">crypttab(5)</a></span> e também <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions#2-setup">2.3 do FAQ do cryptsetup</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção</strong> Tudo que estiver dentro do dispositivo nomeado vai ser permanentemente <b>deletado</b>. É perigoso usar a nomeação simples do kernel para o dispositivo swap, desde que a ordem pode mudar a cada inicialização (<i>exemplo</i>, <code>/dev/sda</code>, <code>/dev/sdb</code>). Opções são:
<ul>
<li>Usar caminhos do <code>by-id</code> e <code>by-path</code>. No entanto, estes dois são sucetíveis a mudanças no hardware. Veja <a href="../../en/0ba82b42eedfeccd2dfbba5044411a67.html#by-id_e_by-path" class="mw-redirect" title="Nomeação persistente de dispositivo de bloco">nomeação persistente de dispositivo de bloco#by-id e by-path</a>.</li>
<li>Usar um nome do volume lógico do <a href="../../pt/LVM.html" title="LVM (Português)">LVM</a>.</li>
<li>Usar o método descrito em <a href="#UUID_e_LABEL">#UUID e LABEL</a>. Labels e <a href="../../en/0ba82b42eedfeccd2dfbba5044411a67.html#by-uuid" class="mw-redirect" title="Nomeação persistente de dispositivo de bloco">UUIDS</a> <b>não podem</b> ser usados diretamente devido a criação e encriptação do dispositivo swap a cada inicialização com <code>mkswap</code>, veja o <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions#2-setup">FAQ do cryptsetup</a>.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota</strong> A configuração da partição swap pode algumas vezes falhar, veja a <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/10179">issue do systemd 10179</a>.</div>
<p>Para usar o nomeação persistente <code>by-id</code>, primeiro identifique o dispositivo swap:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># find -L /dev/disk -samefile /dev/<i>sdX#</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/disk/by-id/ata-WDC_WD2500BEVT-22ZCT0_WD-WXE908VF0470-part<i>X</i>
/dev/disk/by-id/wwn-0x60015ee0000b237f-part<i>X</i>
</pre>
<p>Então o use como uma referência persistente para a partição (se dois resultados são retornados como acima, use qualquer um deles):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># &lt;name&gt;  &lt;device&gt;                                                         &lt;password&gt;     &lt;options&gt;
swap      /dev/disk/by-id/ata-WDC_WD2500BEVT-22ZCT0_WD-WXE908VF0470-partX  /dev/urandom   swap,cipher=aes-cbc-essiv:sha256,size=256</pre>
<p>Depois de inicializar para ativar a swap criptografada, você vai notar que ao rodar <code>swapon -s</code> vai ser mostrado uma entrada arbitária para o dispositivo mapeado (exemplo, <code>/dev/dm-1</code>), enquanto o comando <code>lsblk</code> mostra <b>crypt</b> na coluna <code>FSTYPE</code>. Devido a cada inicialização ser criptografada novamente, o UUID de <code>/dev/mapper/swap</code> vai mudar toda vez.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota</strong> Se a partição escolhida para swap foi antes uma partição LUKS, crypttab não vai sobrescrever esta partição. Isto é uma medida de segurança para prevenir perda de dados por acidental má-identificação da partição swap no crypttab. Para usar a partição o <a href="../../en/Dm-crypt/Preparando_a_unidade_de_armazenamento.html#Apagar_o_cabe%C3%A7alho_do_LUKS" class="mw-redirect" title="Dm-crypt/Preparando a unidade de armazenamento">cabeçalho do LUKS deve ser sobrescrito</a> uma vez.</div>
<div class="mw-heading mw-heading3"><h3 id="UUID_e_LABEL">UUID e LABEL</h3></div>
<p>É perigoso usar a nomeação simples de dispositivos do kernel, como <code>/dev/sdX#</code> e <code>/dev/disk/by-id/ata-SERIAL-partX</code>, para criptografar a swap com o crypttab. Uma pequena mudança no nome dos dispositivos ou particionamento pode acarretar na perda de seus dados na próxima inicialização. O mesmo se você usar o PARTUUID e então usar esta partição para alguma outra coisa e se esquecer de remover a respectiva entrada do crypttab.
</p>
<p>É mais confiável identificar a partição correta ao dar um genuíno UUID ou LABEL. Por padrão isto não funciona devido ao dm-crypt e <code>mkswap</code> sobrescreverem qualquer coisa presente na partição, incluindo o UUID e LABEL. No entanto é possível especificar o início (offset) da swap. Isto permite criar um minúsculo e vazio sistema de arquivos com o objetivo de prover um UUID ou LABEL persistente para a encriptação da swap.
</p>
<p>Crie um <a href="../../en/Sistema_de_arquivos.html" class="mw-redirect" title="Sistema de arquivos">sistema de arquivos</a>, com uma LABEL de sua escolha:
</p>
<pre># mkfs.ext2 -L <i>cryptswap</i> /dev/sd<i>X#</i> 1M
</pre>
<p>O parâmetro não usual depois do nome do dispositivo limita o tamanho do sistema de arquivos para 1 MiB, deixando espaço para a swap criptografada.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># blkid /dev/sdX#</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/sdX#: LABEL="cryptswap" UUID="b72c384e-bd3c-49aa-b7a7-a28ea81a2605" TYPE="ext2"</pre>
<p>Com isso, <code>/dev/sdX#</code> agora pode facilmente ser identificada por ambos UUID ou LABEL, independente do nome do dispositivo ou até mesmo o número da partição que podem mudar no futuro. Modifique as entradas do <code>/etc/crypttab</code> e <code>/etc/fstab</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># &lt;name&gt; &lt;device&gt;             &lt;password&gt;    &lt;options&gt;
swap     LABEL=<i>cryptswap</i>      /dev/urandom  swap,offset=2048,cipher=aes-xts-plain64,size=512</pre>
<p>Observe o <i>offset</i>: são 2048 setores de 512 bytes, então 1 MiB. Desta maneira a swap criptografada não vai afetar o LABEL/UUID do sistema de arquivos, e o alinhamento de dados vai funcionar também.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># &lt;filesystem&gt;     &lt;dir&gt;  &lt;type&gt;  &lt;options&gt;  &lt;dump&gt;  &lt;pass&gt;
/dev/mapper/swap   none   swap    defaults   0       0</pre>
<p>Ao usar esta configuração, o <i>cryptswap</i> vai somente usar a partição com o LABEL correspondente, independente do que o nome do dispositivo pode ser. Se você decidir formatar e usar a partição para outra coisa, o LABEL vai ser perdido, logo, na próxima inicialização nada deve ser sobrescrito.
</p>
<div class="mw-heading mw-heading3"><h3 id="Desabilitando_hibernação_nos_ambientes_desktop">
<span id="Desabilitando_hiberna.C3.A7.C3.A3o_nos_ambientes_desktop"></span>Desabilitando hibernação nos ambientes desktop</h3></div>
<p>Ambientes desktop podem não detectar automaticamente que a partição swap é randomicamente criptografada e não pode ser usada para suspender para o disco.
</p>
<p><a href="../../pt/Xfce.html" class="mw-redirect" title="Xfce (Português)">Xfce</a> pode ser configurado para esconder seu botão de <i>Hibernação</i> ao executar este comando:
</p>
<pre>$ xfconf-query -c xfce4-session -np /shutdown/ShowHibernate -t bool -s false
</pre>
<div class="mw-heading mw-heading2"><h2 id="Com_suporte_a_suspender_para_o_disco">Com suporte a suspender para o disco</h2></div>
<p>Para resumir depois de suspender o computador para o disco (hibernar), é necessário manter o espaço swap intacto. Por isso, tenha uma partição ou arquivo swap criptografada com LUKS, que pode ser guardada no disco ou colocada na inicialização.
</p>
<p>Os três seguintes métodos são alternativas que possibilitam suspender para o disco. Se você aplicar qualquer uma delas, entenda que dados críticos podem ter sido colocados na swap e potencialmente permanecer por um longo período de tempo (até que sejam sobrescritos). Para reduzir o risco, considere montar um sistema que criptografa a swap novamente, por exemplo, a cada vez que o sistema é desligado normalmente, junto com o método de sua escolha.
</p>
<div class="mw-heading mw-heading3"><h3 id="LVM_dentro_do_LUKS">LVM dentro do LUKS</h3></div>
<p>Se o swap está no grupo de volumes lógicos que é ativado no initramfs, simplesmente siga as instruções em <a href="../../pt/Power_management/Suspend_and_hibernate.html#Hiberna%C3%A7%C3%A3o" class="mw-redirect" title="Hibernação">Hibernação</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Usando_uma_partição_swap">
<span id="Usando_uma_parti.C3.A7.C3.A3o_swap"></span>Usando uma partição swap</h3></div>
<p>Para resumir de uma partição swap criptografada, esta deve ser aberta durante o initramfs.
</p>
<ul>
<li>Quando usar o initramfs padrão baseado no busybox com o hook <a href="../../en/e90e6c51a35f947e9a37e0983b6b2e16.html#Usando_o_hook_encrypt" class="mw-redirect" title="Dm-crypt/Configuração do sistema">encrypt</a>, siga as instruções em <a href="#Hook_do_mkinitcpio">#Hook do mkinitcpio</a>.</li>
<li>Quando usar o initramfs baseado no systemd com o hook <a href="../../pt/Sd-encrypt.html" class="mw-redirect" title="Sd-encrypt (Português)">sd-encrypt</a>, adicione os parâmetros adicionais do <code>rd.luks</code> para abrir a partição swap.</li>
</ul>
<div class="mw-heading mw-heading4"><h4 id="Hook_do_mkinitcpio">Hook do mkinitcpio</h4></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota</strong> Esta seção é somente aplicável quando usar o hook <code>encrypt</code>, que pode abrir somente um dispositivo (<a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/23182">FS#23182</a>). Com o hook <code>sd-encrypt</code> múltiplos dispositivos podem ser abertos, veja <a href="../../en/e90e6c51a35f947e9a37e0983b6b2e16.html#Usando_o_hook_sd-encrypt" class="mw-redirect" title="Dm-crypt/Configuração do sistema">dm-crypt/Configuração do sistema#Usando o hook sd-encrypt</a>.</div>
<p>Se o swap está em um dispositivo diferente do sistema de arquivos da partição raiz, este não vai ser aberto pelo hook <code>encrypt</code>, o <i>resume</i> vai tomar lugar antes que o <code>/etc/crypttab</code> seja lido, por isso é necessário criar um hook e colocá-lo em <code>/etc/mkinitcpio.conf</code> para abrir o dispositivo swap criptografado com LUKS antes dessa situação.
</p>
<p>Se você deseja usar a partição que é atualmente usada pelo sistema, você vai ter que desativá-la primeiro:
</p>
<pre># swapoff /dev/&lt;dispositivo&gt;
</pre>
<p>Tenha certeza de remover qualquer linha em <code>/etc/crypttab</code> apontando para este dispositivo.
</p>
<p>Se você está usando uma <a href="../../pt/Partitioning.html" class="mw-redirect" title="Partição">partição</a> swap existente, e esta está numa tabela de partição GPT, você vai precisar usar o <a href="../../en/GPT_fdisk.html" class="mw-redirect" title="Gdisk">gdisk</a> para definir o <a href="../../en/GPT_fdisk.html#Prevent_GPT_partition_automounting" class="mw-redirect" title="Gdisk">atributo de partição 63 "do not automount"</a> ("não monte automaticamente") nela. Isto vai prevenir o systemd-gpt-auto-generator de descobrir e habilitar a partição na inicialização.
</p>
<p>A seguinte configuração tem a desvantagem de inserir manualmente uma senha adicional para a partição swap toda vez que ligar o sistema.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção</strong> Não use esta configuração com uma keyfile se <code>/boot</code> não está criptografado. Leia sobre o problema reportado <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Talk:Dm-crypt&amp;oldid=255742#Suspend_to_disk_instructions_are_insecure">aqui</a> (em inglês). Alternativamente, use uma keyfile criptografada com gnupg, de acordo com <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=120181isto">esta página no forum</a> (em inglês).</div>
<p>Formate o container criptografado para a partição swap, crie um espaço de chave para uma senha memorizável.
</p>
<pre># cryptsetup luksFormat /dev/&lt;dispositivo&gt;
</pre>
<p>Abra a partição em <code>/dev/mapper</code>:
</p>
<pre># cryptsetup open /dev/&lt;dispositivo&gt; dispositivoSwap
</pre>
<p>Crie o sistema de arquivos para a swap dentro da partição mapeada:
</p>
<pre># mkswap /dev/mapper/dispositivoSwap
</pre>
<p>Agora faça um hook para abrir a swap na inicialização. Você pode <a href="../../pt/Help:Reading.html#Instala%C3%A7%C3%A3o_de_pacotes" class="mw-redirect" title="Instala">instalar</a> e configurar o <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-openswap/">mkinitcpio-openswap</a></span><sup><small>AUR</small></sup>, ou seguir as seguintes instruções. Crie um arquivo contendo o seguinte comando de abertura:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/hooks/openswap</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">run_hook ()
{
    cryptsetup open /dev/&lt;dispositivo&gt; dispositivoSwap
}
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção</strong> Montar o sistema de arquivos <a rel="nofollow" class="external text" href="https://docs.kernel.org/power/swsusp.html">é perigoso e destrutivo</a>. A keyfile não deve ser lida de um sistema de arquivos que estava montado quando o sistema foi suspenso.</div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Adicionar instruções que não levam a perda de dados. (Discuss in <a href="../../en/Talk:Dm-crypt/Swap_encryption.html" title="Talk:Dm-crypt/Swap encryption">talk:dm-crypt/Swap encryption</a>)</div>
</div>
<p>Para abrir o dispositivo swap ao digitar a senha ou
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/hooks/openswap</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">run_hook ()
{
    ## opcional: Para evitar condição de corrida
    x=0;
    while [ ! -b /dev/mapper/&lt;dispositivo-raiz&gt; ] &amp;&amp; [ $x -le 10 ]; do
       x=$((x+1))
       sleep .2
    done
    ## Fim do opcional

    mkdir dispositivo_da_chave
    mount /dev/mapper/&lt;dispositivo-raiz&gt; dispositivo_da_chave
    cryptsetup open --key-file dispositivo_da_chave/&lt;caminho-para-a-chave&gt; /dev/&lt;dispositivo&gt; dispositivoSwap
    umount dispositivo_da_chave
}
</pre>
<p>Para abrir o dispositivo swap com uma keyfile do dispositivo raiz criptografado.
</p>
<p>Em alguns computadores, condições de corrida podem ocorrer quando o mkinitcpio tenta montar o dispositivo antes dele ser aberto e a enumeração de dispositivos ainda está incompleta. O bloco <i>opcional</i> vai atrasar o processo de inicialização em 2 segundos até que o dispositivo raiz esteja pronto para ser montado.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota</strong> Se a swap está em um SSD e Discard/TRIM é desejado, a opção <code>--allow-discards</code> precisa ser adicionada para a linha do cryptsetup no hook openswap acima. Veja <a href="../../en/Dm-crypt/Specialties.html#Discard/TRIM_support_for_solid_state_drives_(SSD)" title="Dm-crypt/Specialties">Dm-crypt/Specialties#Discard/TRIM support for solid state drives (SSD)</a> ou <a href="../../en/Solid_state_drive.html" class="mw-redirect" title="SSD">SSD</a> para mais informações sobre discard. Também adicione a opção de montagem 'discard' para a entrada do dispositivo swap no fstab.</div>
<p>Crie e edite o arquivo de configuração do hook:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/install/openswap</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">build ()
{
   add_runscript
}
help ()
{
cat&lt;&lt;HELPEOF
  Isto abre a partição swap criptografada /dev/&lt;dispositivo&gt; em /dev/mapper/dispositivoSwap
HELPEOF
}
</pre>
<p>Adicione o hook <code>openswap</code> no vetor <code>HOOKS</code> no <code>/etc/mkinitcpio.conf</code>, entre <code>encrypt</code> e <code>filesystems</code>. Não se esqueça de adicionar o hook <code>resume</code> depois de <code>openswap</code>
</p>
<pre>HOOKS=(... encrypt openswap resume filesystems ...)
</pre>
<p><a href="../../en/Gere_novamente_o_initramfs.html" class="mw-redirect" title="Gere novamente o initramfs">Gere novamente o initramfs</a>.
</p>
<p>Coloque a partição mapeada no <code>/etc/fstab</code> ao adicionar a seguinte linha:
</p>
<pre>/dev/mapper/dispositivoSwap swap swap defaults 0 0
</pre>
<p>Configure seu sistema para resumir com o <code>/dev/mapper/dispositivoSwap</code>. Por exemplo, se você usa <a href="../../pt/GRUB.html" title="GRUB (Português)">GRUB</a> com suporte a hibernação do kernel, adicione o parâmetro do kernel <code>resume=/dev/mapper/dispositivoSwap</code> na variável <code>GRUB_CMDLINE_LINUX_DEFAULT</code> em <code>/etc/default/grub</code>. Uma linha do kernel com a raiz e swap criptografada pode parecer com isso:
</p>
<pre>kernel /vmlinuz-linux cryptdevice=/dev/sda2:raiz root=/dev/mapper/raiz resume=/dev/mapper/dispositivoSwap ro
</pre>
<p>Na inicialização, o hook <code>openswap</code> vai abrir a partição swap para que o kernel possa usá-la. Se você usar hooks especiais para resumir da hibernação, tenha certeza de que eles estão <b>depois</b> do <code>openswap</code> no vetor <code>HOOKS</code>. Note que devido ao initrd abrir a swap, não é necessário ter uma entrada para <i>dispositivoSwap</i> em <code>/etc/crypttab</code>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Usando_um_arquivo_swap">Usando um arquivo swap</h3></div>
<p>Um arquivo swap pode ser usado para reservar um espaço swap dentro de uma partição existente e isto também pode ser feito dentro de uma partição criptografada.
</p>
<p>Siga as instruções para criação do arquivo swap em <a href="../../pt/Swap.html#Arquivo_swap" title="Swap (Português)">Swap#Arquivo swap</a> e configure a hibernação de acordo com <a href="../../en/556053739f1b88bd475e1b8651f8ec94.html#Adquirindo_o_offset_de_um_arquivo_swap" class="mw-redirect" title="Suspensão e hibernação">Suspensão e hibernação#Adquirindo o offset de um arquivo swap</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota</strong> Quando resumir de um arquivo swap, o parâmetro <code>resume</code> deve apontar para o dispositivo aberto/mapeado que contém o sistema de arquivos com o arquivo swap.</div>
<div class="mw-heading mw-heading2"><h2 id="Problemas_conhecidos">Problemas conhecidos</h2></div>
<ul><li>
<code>Stopped (with error) /dev/dm-1</code> nos logs. Veja a <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/1620">issue do systemd 1620</a>.</li></ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../pt/Category:Data-at-rest_encryption.html" title="Category:Data-at-rest encryption (Português)">Data-at-rest encryption (Português)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Dm-crypt_(Portugu%C3%AAs)/Swap_encryption_(Portugu%C3%AAs)&amp;oldid=857886">https://wiki.archlinux.org/index.php?title=Dm-crypt_(Português)/Swap_encryption_(Português)&amp;oldid=857886</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 20 December 2025, at 20:03.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container no-font-mode-scale">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue  vector-search-box-show-thumbnail vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search cdx-typeahead-search--show-thumbnail">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input mw-searchInput" autocomplete="off" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true">dm-crypt (Português)/Swap encryption (Português)</div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only reading-lists-bookmark" id="ca-bookmark-sticky-header" tabindex="-1" data-event-name="watch-sticky-bookmark"><span class="vector-icon mw-ui-icon-wikimedia-bookmarkOutline mw-ui-icon-wikimedia-wikimedia-bookmarkOutline"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
