<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Snapper (Português) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Snapper_Português rootpage-Snapper_Português skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Instalação" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Instala%C3%A7%C3%A3o">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Instalação</div>
		</a>
		
		<ul id="toc-Instalação-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Criando_uma_nova_configuração" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Criando_uma_nova_configura%C3%A7%C3%A3o">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Criando uma nova configuração</div>
		</a>
		
		<ul id="toc-Criando_uma_nova_configuração-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Tirando_snapshots" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tirando_snapshots">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Tirando snapshots</div>
		</a>
		
			<button aria-controls="toc-Tirando_snapshots-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tirando snapshots subsection</span>
			</button>
		
		<ul id="toc-Tirando_snapshots-sublist" class="vector-toc-list">
			<li id="toc-Snapshots_automáticos_da_linha_do_tempo" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Snapshots_autom%C3%A1ticos_da_linha_do_tempo">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Snapshots automáticos da linha do tempo</div>
			</a>
			
			<ul id="toc-Snapshots_automáticos_da_linha_do_tempo-sublist" class="vector-toc-list">
				<li id="toc-Ativar/desativar" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Ativar/desativar">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.1</span>Ativar/desativar</div>
			</a>
			
			<ul id="toc-Ativar/desativar-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Definir_limites_de_snapshots" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Definir_limites_de_snapshots">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.2</span>Definir limites de snapshots</div>
			</a>
			
			<ul id="toc-Definir_limites_de_snapshots-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Alterar_as_frequências_de_snapshot_e_limpeza" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Alterar_as_frequ%C3%AAncias_de_snapshot_e_limpeza">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.3</span>Alterar as frequências de snapshot e limpeza</div>
			</a>
			
			<ul id="toc-Alterar_as_frequências_de_snapshot_e_limpeza-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Snapshots_manuais" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Snapshots_manuais">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Snapshots manuais</div>
			</a>
			
			<ul id="toc-Snapshots_manuais-sublist" class="vector-toc-list">
				<li id="toc-Snapshots_individuais" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Snapshots_individuais">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.1</span>Snapshots individuais</div>
			</a>
			
			<ul id="toc-Snapshots_individuais-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Snapshots_pré/pós" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Snapshots_pr%C3%A9/p%C3%B3s">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.2</span>Snapshots pré/pós</div>
			</a>
			
			<ul id="toc-Snapshots_pré/pós-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Snapshots_na_inicialização" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Snapshots_na_inicializa%C3%A7%C3%A3o">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Snapshots na inicialização</div>
			</a>
			
			<ul id="toc-Snapshots_na_inicialização-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Gerenciando_snapshots" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Gerenciando_snapshots">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Gerenciando snapshots</div>
		</a>
		
			<button aria-controls="toc-Gerenciando_snapshots-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Gerenciando snapshots subsection</span>
			</button>
		
		<ul id="toc-Gerenciando_snapshots-sublist" class="vector-toc-list">
			<li id="toc-Listar_configurações" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Listar_configura%C3%A7%C3%B5es">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Listar configurações</div>
			</a>
			
			<ul id="toc-Listar_configurações-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Listar_snapshots" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Listar_snapshots">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Listar snapshots</div>
			</a>
			
			<ul id="toc-Listar_snapshots-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Excluir_um_snapshot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Excluir_um_snapshot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Excluir um snapshot</div>
			</a>
			
			<ul id="toc-Excluir_um_snapshot-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Acesso_para_usuários_não_root" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Acesso_para_usu%C3%A1rios_n%C3%A3o_root">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>Acesso para usuários não root</div>
			</a>
			
			<ul id="toc-Acesso_para_usuários_não_root-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Dicas_e_truques" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Dicas_e_truques">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Dicas e truques</div>
		</a>
		
			<button aria-controls="toc-Dicas_e_truques-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Dicas e truques subsection</span>
			</button>
		
		<ul id="toc-Dicas_e_truques-sublist" class="vector-toc-list">
			<li id="toc-Envolvendo_transações_do_pacman_em_snapshots" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Envolvendo_transa%C3%A7%C3%B5es_do_pacman_em_snapshots">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Envolvendo transações do pacman em snapshots</div>
			</a>
			
			<ul id="toc-Envolvendo_transações_do_pacman_em_snapshots-sublist" class="vector-toc-list">
				<li id="toc-Backup_de_partições_boot_não_Btrfs_em_transações_do_pacman" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Backup_de_parti%C3%A7%C3%B5es_boot_n%C3%A3o_Btrfs_em_transa%C3%A7%C3%B5es_do_pacman">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.1</span>Backup de partições boot não Btrfs em transações do pacman</div>
			</a>
			
			<ul id="toc-Backup_de_partições_boot_não_Btrfs_em_transações_do_pacman-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Backup_incremental_para_unidade_externa" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Backup_incremental_para_unidade_externa">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Backup incremental para unidade externa</div>
			</a>
			
			<ul id="toc-Backup_incremental_para_unidade_externa-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Layout_do_sistema_de_arquivos_sugerido" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Layout_do_sistema_de_arquivos_sugerido">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Layout do sistema de arquivos sugerido</div>
			</a>
			
			<ul id="toc-Layout_do_sistema_de_arquivos_sugerido-sublist" class="vector-toc-list">
				<li id="toc-Configuração_do_snapper_e_do_ponto_de_montagem" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Configura%C3%A7%C3%A3o_do_snapper_e_do_ponto_de_montagem">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.1</span>Configuração do snapper e do ponto de montagem</div>
			</a>
			
			<ul id="toc-Configuração_do_snapper_e_do_ponto_de_montagem-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Restaurando_/_para_seu_snapshot_anterior" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Restaurando_/_para_seu_snapshot_anterior">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.2</span>Restaurando / para seu snapshot anterior</div>
			</a>
			
			<ul id="toc-Restaurando_/_para_seu_snapshot_anterior-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Excluindo_arquivos_de_snapshots" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Excluindo_arquivos_de_snapshots">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>Excluindo arquivos de snapshots</div>
			</a>
			
			<ul id="toc-Excluindo_arquivos_de_snapshots-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Evitando_lentidão" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Evitando_lentid%C3%A3o">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5</span>Evitando lentidão</div>
			</a>
			
			<ul id="toc-Evitando_lentidão-sublist" class="vector-toc-list">
				<li id="toc-updatedb" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#updatedb">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.1</span>updatedb</div>
			</a>
			
			<ul id="toc-updatedb-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Desativar_grupos_de_cotas" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Desativar_grupos_de_cotas">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.2</span>Desativar grupos de cotas</div>
			</a>
			
			<ul id="toc-Desativar_grupos_de_cotas-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Contar_o_número_de_snapshots" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Contar_o_n%C3%BAmero_de_snapshots">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.3</span>Contar o número de snapshots</div>
			</a>
			
			<ul id="toc-Contar_o_número_de_snapshots-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Preservando_arquivos_de_log" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Preservando_arquivos_de_log">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.6</span>Preservando arquivos de log</div>
			</a>
			
			<ul id="toc-Preservando_arquivos_de_log-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Solução_de_problemas" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Solu%C3%A7%C3%A3o_de_problemas">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Solução de problemas</div>
		</a>
		
			<button aria-controls="toc-Solução_de_problemas-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Solução de problemas subsection</span>
			</button>
		
		<ul id="toc-Solução_de_problemas-sublist" class="vector-toc-list">
			<li id="toc-Logs_do_snapper" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Logs_do_snapper">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>Logs do snapper</div>
			</a>
			
			<ul id="toc-Logs_do_snapper-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Erro_de_E/S" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Erro_de_E/S">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2</span>Erro de E/S</div>
			</a>
			
			<ul id="toc-Erro_de_E/S-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Snapshots_órfãos_causando_desperdício_de_espaço_em_disco" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Snapshots_%C3%B3rf%C3%A3os_causando_desperd%C3%ADcio_de_espa%C3%A7o_em_disco">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.3</span>Snapshots órfãos causando desperdício de espaço em disco</div>
			</a>
			
			<ul id="toc-Snapshots_órfãos_causando_desperdício_de_espaço_em_disco-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Veja_também" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Veja_tamb%C3%A9m">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Veja também</div>
		</a>
		
		<ul id="toc-Veja_também-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Snapper (Português)</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-en mw-list-item"><a href="../en/Snapper.html" title="Snapper – English" lang="en" hreflang="en" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Snapper" title="Snapper – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Snapper" title="Snapper – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="pt" dir="ltr">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Status de tradução:</strong> Esse artigo é uma tradução de <a href="../en/Snapper.html" title="Snapper">Snapper</a>. Data da última tradução: 2022-08-02. Você pode ajudar a sincronizar a tradução, se houver <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Snapper&amp;diff=0&amp;oldid=739865">alterações</a> na versão em inglês.</div>
<div class="archwiki-template-meta-related-articles">
<p>Artigos relacionados</p>
<ul>
<li><a href="../pt/Btrfs.html" title="Btrfs (Português)">Btrfs</a></li>
<li><a href="../pt/Mkinitcpio.html" title="Mkinitcpio (Português)">mkinitcpio</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="http://snapper.io">Snapper</a> é uma ferramenta criada por Arvin Schnell, do openSUSE, que ajuda no gerenciamento de snapshots de subvolumes do <a href="../pt/Btrfs.html" title="Btrfs (Português)">Btrfs</a> e volumes <a href="../pt/LVM.html" title="LVM (Português)">LVM</a> com provisionamento <i>thin</i>. Ele pode criar e comparar snapshots, reverter entre snapshots e oferecer suporte a linhas de tempo de snapshots automáticos.
</p>
<meta property="mw:PageProp/toc">
<h2>
<span id="Instala.C3.A7.C3.A3o"></span><span class="mw-headline" id="Instalação">Instalação</span>
</h2>
<p><a href="../pt/Help:Reading.html#Instala%C3%A7%C3%A3o_de_pacotes" class="mw-redirect" title="Instale">Instale</a> o pacote <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=snapper">snapper</a></span>. A versão de desenvolvimento <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snapper-git/">snapper-git</a></span><sup><small>AUR</small></sup> também está disponível.
</p>
<p>Adicionalmente, interfaces gráficas estão disponíveis com <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snapper-gui-git/">snapper-gui-git</a></span><sup><small>AUR</small></sup> e <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/btrfs-assistant/">btrfs-assistant</a></span><sup><small>AUR</small></sup>.
</p>
<h2>
<span id="Criando_uma_nova_configura.C3.A7.C3.A3o"></span><span class="mw-headline" id="Criando_uma_nova_configuração">Criando uma nova configuração</span>
</h2>
<p>Antes de criar uma configuração do snapper para um subvolume Btrfs, o subvolume já deve existir. Caso contrário você deve <a href="../pt/Btrfs.html#Criando_um_subvolume" title="Btrfs (Português)">criá-lo</a> antes de gerar uma configuração do snapper.
</p>
<p>Para criar uma nova configuração do snapper chamada <code><i>config</i></code> para o subvolume Btrfs em <code><i>/caminho/para/subvolume</i></code>, execute:
</p>
<pre># snapper -c <i>config</i> create-config <i>/caminho/para/subvolume</i>
</pre>
<p>Isso vai:
</p>
<ul>
<li>Criar um arquivo de configuração em <code>/etc/snapper/configs/<i>config</i></code> com base no modelo padrão de <code>/usr/share/snapper/config-templates</code>.</li>
<li>Criar um subvolume em <code><i>/caminho/para/subvolume</i>/.snapshots</code> onde serão armazenados futuros snapshots para esta configuração. O caminho de um snapshot é <code><i>/caminho/para/subvolume</i>/.snapshots/<i>#</i>/snapshot</code>, onde <code><i>#</i></code> é o número do snapshot.</li>
<li>Adicionar <code><i>config</i></code> a <code>SNAPPER_CONFIGS</code> em <code>/etc/conf.d/snapper</code>.</li>
</ul>
<p>Por exemplo, para criar um arquivo de configuração para o subvolume montado em <code>/</code>, execute:
</p>
<pre># snapper -c root create-config /
</pre>
<p>Neste ponto, a configuração está ativa. Se seu daemon <a href="../en/Cron.html" title="Cron">cron</a> estiver em execução, o snapper fará <a href="#Snapshots_autom%C3%A1ticos_da_linha_do_tempo">#Snapshots automáticos da linha do tempo</a>. Se você não usar um daemon <a href="../en/Cron.html" title="Cron">cron</a>, precisará usar o serviço e o timer do systemd. Consulte <a href="#Ativar/desativar">#Ativar/desativar</a>.
</p>
<p>Veja também <span class="plainlinks archwiki-template-man" title="$ man 5 snapper-configs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/snapper-configs.5">snapper-configs(5)</a></span>.
</p>
<h2><span class="mw-headline" id="Tirando_snapshots">Tirando snapshots</span></h2>
<h3>
<span id="Snapshots_autom.C3.A1ticos_da_linha_do_tempo"></span><span class="mw-headline" id="Snapshots_automáticos_da_linha_do_tempo">Snapshots automáticos da linha do tempo</span>
</h3>
<p>Uma linha do tempo de snapshots pode ser criada com um número configurável de snapshots mantidos de hora em hora, diariamente, semanalmente, mensalmente e anualmente. Quando a linha do tempo está habilitada, por padrão, um snapshot é criado uma vez por hora. Uma vez por dia, os snapshots são limpos pelo algoritmo de limpeza da linha do tempo. Consulte as variáveis <code>TIMELINE_*</code> em <span class="plainlinks archwiki-template-man" title="$ man 5 snapper-configs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/snapper-configs.5">snapper-configs(5)</a></span> para detalhes.
</p>
<h4>
<span id="Ativar.2Fdesativar"></span><span class="mw-headline" id="Ativar/desativar">Ativar/desativar</span>
</h4>
<p>Se você tiver um daemon <a href="../en/Cron.html" title="Cron">cron</a>, esse recurso deve iniciar automaticamente. Para desativá-lo, edite o arquivo de configuração correspondente ao subvolume que você não deseja que tenha esse recurso e defina:
</p>
<pre>TIMELINE_CREATE="no"
</pre>
<p>Se você não tiver um daemon <a href="../en/Cron.html" title="Cron">cron</a>, poderá usar os units fornecidos pelo systemd. <a href="../pt/Systemd.html#Usando_units" class="mw-redirect" title="Inicie">Inicie</a> e <a href="../pt/Systemd.html#Usando_units" class="mw-redirect" title="Habilite">habilite</a> <code>snapper-timeline.timer</code> para iniciar a linha de tempo automática do snapshot. Além disso, <a href="../pt/Systemd.html#Usando_units" class="mw-redirect" title="Inicie">inicie</a> e <a href="../pt/Systemd.html#Usando_units" class="mw-redirect" title="Habilite">habilite</a> <code>snapper-cleanup.timer</code> para limpar periodicamente os snapshots mais antigos.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Se você tiver um daemon cron e também habilitar os units do systemd, isso pode resultar na criação de snapshots duplicados. Se você deseja desabilitar a integração do cron enquanto estiver usando os units do systemd, uma solução possível é não instalar os arquivos cron do pacote snapper por meio das opções de configuração <a href="../pt/Pacman.html#Pular_arquivos_para_n%C3%A3o_serem_instalados_no_sistema" title="Pacman (Português)">NoExtract</a> e <a href="../pt/Pacman.html#Pular_arquivos_para_n%C3%A3o_serem_atualizados" title="Pacman (Português)">NoUpgrade</a> do <a href="../pt/Pacman.html" title="Pacman (Português)">pacman</a>. Veja <a rel="nofollow" class="external autonumber" href="https://unix.stackexchange.com/questions/425570/snapper-has-recently-started-performing-duplicate-snapshots-each-hour">[1]</a>.</div>
<h4><span class="mw-headline" id="Definir_limites_de_snapshots">Definir limites de snapshots</span></h4>
<p>As configuração padrão manterá 10 snapshots por hora, 10 diários, 10 mensais e 10 anuais. Você pode querer mudar isso na configuração, especialmente em subvolumes ocupados como <code>/</code>. Consulte <a href="#Evitando_lentid%C3%A3o">#Evitando lentidão</a>.
</p>
<p>Aqui está uma seção de exemplo de uma configuração chamada <code><i>config</i></code> com apenas 5 snapshots por hora, 7 diários, nenhum mensal e nenhum anual:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/snapper/configs/<i>config</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">TIMELINE_MIN_AGE="1800"
TIMELINE_LIMIT_HOURLY="5"
TIMELINE_LIMIT_DAILY="7"
TIMELINE_LIMIT_WEEKLY="0"
TIMELINE_LIMIT_MONTHLY="0"
TIMELINE_LIMIT_YEARLY="0"</pre>
<h4>
<span id="Alterar_as_frequ.C3.AAncias_de_snapshot_e_limpeza"></span><span class="mw-headline" id="Alterar_as_frequências_de_snapshot_e_limpeza">Alterar as frequências de snapshot e limpeza</span>
</h4>
<p>Se você estiver usando os timers fornecidos pelo systemd, você pode <a href="../pt/Systemd.html#Editando_units_fornecidas" class="mw-redirect" title="Editar">editá-los</a> para alterar a frequência de snapshots e limpeza.
</p>
<p>Por exemplo, ao editar o <code>snapper-timeline.timer</code>, adicione o seguinte para tornar a frequência a cada cinco minutos, em vez de por hora:
</p>
<pre>[Timer]
OnCalendar=
OnCalendar=*:0/5
</pre>
<p>Ao editar <code>snapper-cleanup.timer</code>, você precisa alterar <code>OnUnitActiveSec</code>. Para que as limpezas ocorram a cada hora em vez de todos os dias, adicione:
</p>
<pre>[Timer]
OnUnitActiveSec=1h
</pre>
<p>Veja <a href="../pt/Systemd/Timers.html" title="Systemd (Português)/Timers (Português)">systemd/Timers</a> e <a href="../pt/Systemd.html#Arquivos_drop-in" title="Systemd (Português)">systemd#Arquivos drop-in</a>.
</p>
<h3><span class="mw-headline" id="Snapshots_manuais">Snapshots manuais</span></h3>
<h4><span class="mw-headline" id="Snapshots_individuais">Snapshots individuais</span></h4>
<p>Por padrão, o snapper tira snapshots do tipo <i>single</i>, não tendo nenhum relação especial com outros snapshots.
</p>
<p>Para tirar um snapshot de um subvolume manualmente, faça:
</p>
<pre># snapper -c <i>config</i> create --description <i>desc</i>
</pre>
<p>O comando acima não usa nenhum algoritmo de limpeza, portanto, o snapshot é armazenado permanentemente ou até ser <a href="#Excluir_um_snapshot">excluído</a>.
</p>
<p>Para definir um algoritmo de limpeza, use o sinalizador <code>-c</code> após <code>create</code> e escolha <code>number</code>, <code>timeline</code>, <code>pre</code>, ou <code>post</code>. <code>number</code> configura o snapper para remover periodicamente snapshots que excederam um número definido no arquivo de configuração. Por exemplo, para criar um snapshot que usa o algoritmo <code>number</code> para limpeza, faça:
</p>
<pre># snapper -c <i>config</i> create -c number
</pre>
<p>Veja <a href="#Snapshots_autom%C3%A1ticos_da_linha_do_tempo">#Snapshots automáticos da linha do tempo</a> para saber como os snapshots <code>timeline</code> funcionam e veja <a href="#Snapshots_pr%C3%A9/p%C3%B3s">#Snapshots pré/pós</a> sobre como <code>pre</code> e <code>post</code> funcionam.
</p>
<h4>
<span id="Snapshots_pr.C3.A9.2Fp.C3.B3s"></span><span class="mw-headline" id="Snapshots_pré/pós">Snapshots pré/pós</span>
</h4>
<p>O outro tipo de snapshots - snapshots <i>pré/pós</i> - devem ser criados como um par, um antes e outro depois de uma alteração significativa (como uma atualização do sistema).
</p>
<p>Se a mudança significativa é/pode ser invocada por um único comando, então <code>snapper create --command</code> pode ser usado para invocar o comando e criar automaticamente snapshots <i>pré/pós</i>:
</p>
<pre># snapper -c <i>config</i> create --command <i>comando</i>
</pre>
<p>Alternativamente, os snapshots <i>pré/pós</i> podem ser criados manualmente.
</p>
<p>Primeiro crie um snapshot <i>pré</i>:
</p>
<pre># snapper -c <i>config</i> create -t pre -p
</pre>
<p>Anote o número do novo snapshot (é necessário para criar o instantâneo <i>pós</i>).
</p>
<p>Agora execute as ações que irão modificar o sistema de arquivos (<i>por exemplo</i>, instalar um novo programa, atualizar, etc.).
</p>
<p>Finalmente, crie o snapshot <i>pós</i>, substituindo <code><i>N</i></code> pelo número do snapshot <i>pré</i>:
</p>
<pre># snapper -c <i>config</i> create -t post --pre-number <i>N</i>
</pre>
<p>Veja também <a href="#Envolvendo_transa%C3%A7%C3%B5es_do_pacman_em_snapshots">#Envolvendo transações do pacman em snapshots</a>.
</p>
<h3>
<span id="Snapshots_na_inicializa.C3.A7.C3.A3o"></span><span class="mw-headline" id="Snapshots_na_inicialização">Snapshots na inicialização</span>
</h3>
<p>Para que o snapper tire um snapshot da configuração do <code>root</code>, <a href="../pt/Systemd.html#Usando_units" class="mw-redirect" title="Habilite">habilite</a> <code>snapper-boot.timer</code>. (Esses snapshots são do tipo <i>single</i>.)
</p>
<h2><span class="mw-headline" id="Gerenciando_snapshots">Gerenciando snapshots</span></h2>
<h3>
<span id="Listar_configura.C3.A7.C3.B5es"></span><span class="mw-headline" id="Listar_configurações">Listar configurações</span>
</h3>
<p>Para listar todas as <a href="#Criando_uma_nova_configura%C3%A7%C3%A3o">configurações</a> que foram criadas faça:
</p>
<pre># snapper list-configs
</pre>
<h3><span class="mw-headline" id="Listar_snapshots">Listar snapshots</span></h3>
<p>Para listar os snapshots tirados para uma determinada configuração <i>config</i>, faça:
</p>
<pre># snapper -c <i>config</i> list
</pre>
<h3><span class="mw-headline" id="Excluir_um_snapshot">Excluir um snapshot</span></h3>
<p>Para excluir um snapshot de número <code><i>N</i></code> faça:
</p>
<pre># snapper -c <i>config</i> delete <i>N</i>
</pre>
<p>Vários snapshots podem ser excluídos de uma só vez. Por exemplo, para excluir os snapshots 65 e 70 da configuração <i>root</i>, faça:
</p>
<pre># snapper -c root delete 65 70
</pre>
<p>Para excluir um intervalo de snapshots, neste exemplo entre os snapshots 65 e 70 da configuração <i>root</i>, faça:
</p>
<pre># snapper -c root delete 65-70
</pre>
<p>Para imediatamente liberar o espaço usado pelo(s) snapshot(s), use <code>--sync</code>:
</p>
<pre># snapper -c root delete --sync 65
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Ao excluir um snapshot <i>pré</i>, você deve sempre excluir o snapshot <i>pós</i> correspondente e vice-versa.</div>
<h3>
<span id="Acesso_para_usu.C3.A1rios_n.C3.A3o_root"></span><span class="mw-headline" id="Acesso_para_usuários_não_root">Acesso para usuários não root</span>
</h3>
<p>Cada configuração é criada com o usuário root e, por padrão, apenas o root pode vê-la e acessá-la.
</p>
<p>Para poder listar os snapshots de uma determinada configuração para um usuário específico, basta alterar o valor de <code>ALLOW_USERS</code> em seu arquivo <code>/etc/snapper/configs/<i>config</i></code>. Agora você deve ser capaz de executar <code>snapper -c <i>config</i> list</code> como um usuário normal.
</p>
<p>Eventualmente, você deseja poder navegar no diretório <code>.snapshots</code> com um usuário, mas o proprietário deste diretório deve permanecer como root. Portanto, você deve alterar o proprietário do grupo por um grupo contendo o usuário de seu interesse, como <code>users</code> por exemplo:
</p>
<pre># chmod a+rx .snapshots
# chown :users .snapshots
</pre>
<h2><span class="mw-headline" id="Dicas_e_truques">Dicas e truques</span></h2>
<h3>
<span id="Envolvendo_transa.C3.A7.C3.B5es_do_pacman_em_snapshots"></span><span class="mw-headline" id="Envolvendo_transações_do_pacman_em_snapshots">Envolvendo transações do pacman em snapshots</span>
</h3>
<p>Existem alguns pacotes usados para criar snapshots automaticamente em uma transação do pacman:
</p>
<ul><li>
<b>snap-pac</b> — Faz com que o pacman use automaticamente o snapper para criar <a href="#Snapshots_pr%C3%A9/p%C3%B3s">snapshots pré/pós</a> como o YaST do openSUSE. Usa <a href="../pt/Pacman.html#Hooks" class="mw-redirect" title="Hooks do pacman">hooks do pacman</a>.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/wesbarnett/snap-pac">https://github.com/wesbarnett/snap-pac</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=snap-pac">snap-pac</a></span>
</dd></dl>
<ul><li>
<b>snap-pac-grub</b> — Adicionalmente atualiza as entradas do <a href="../pt/GRUB.html" title="GRUB (Português)">GRUB</a> para o <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub-btrfs">grub-btrfs</a></span> depois que o <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=snap-pac">snap-pac</a></span> fez os snapshots. Também usa <a href="../pt/Pacman.html#Hooks" class="mw-redirect" title="Hooks do pacman">hooks do pacman</a>.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/maximbaz/snap-pac-grub">https://github.com/maximbaz/snap-pac-grub</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snap-pac-grub/">snap-pac-grub</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>refind-btrfs</b> — Adiciona entradas ao <a href="../en/REFInd.html" title="REFInd">rEFInd</a> depois que <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=snap-pac">snap-pac</a></span> fez os snapshots.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/Venom1991/refind-btrfs">https://github.com/Venom1991/refind-btrfs</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/refind-btrfs/">refind-btrfs</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>snp</b> — Envolve qualquer comando shell em um snapshot pré-pós do snapper, por exemplo <code>snp pacman -Syu</code>.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://gist.github.com/erikw/5229436">https://gist.github.com/erikw/5229436</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snp/">snp</a></span><sup><small>AUR</small></sup>
</dd></dl>
<h4>
<span id="Backup_de_parti.C3.A7.C3.B5es_boot_n.C3.A3o_Btrfs_em_transa.C3.A7.C3.B5es_do_pacman"></span><span class="mw-headline" id="Backup_de_partições_boot_não_Btrfs_em_transações_do_pacman">Backup de partições boot não Btrfs em transações do pacman</span>
</h4>
<p>Se sua partição <code>/boot</code> estiver em um sistema de arquivos não Btrfs (por exemplo, um <a href="../pt/EFI_system_partition.html" class="mw-redirect" title="ESP (Português)">ESP</a>), você não poderá fazer backups do snapper com ela. Veja <a href="../pt/System_backup.html#Snapshots_e_parti%C3%A7%C3%A3o_/boot" class="mw-redirect" title="Backup do sistema">Backup do sistema#Snapshots e partição /boot</a> para copiar a partição de inicialização automaticamente em uma atualização do kernel para sua raiz Btrfs com um hook. Isso também funciona bem junto com <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=snap-pac">snap-pac</a></span>.
</p>
<h3><span class="mw-headline" id="Backup_incremental_para_unidade_externa">Backup incremental para unidade externa</span></h3>
<p>Algumas ferramentas podem usar o snapper para automatizar backups. Consulte <a href="../en/Btrfs.html#Incremental_backup_to_external_drive" title="Btrfs">Backup incremental para unidade externa</a>.
</p>
<h3><span class="mw-headline" id="Layout_do_sistema_de_arquivos_sugerido">Layout do sistema de arquivos sugerido</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> O layout a seguir se destina a <i>não</i> ser usado com <code>snapper rollback</code>, mas destina-se a aliviar os problemas inerentes de <a href="#Restaurando_/_para_seu_snapshot_anterior">#Restaurando / para seu snapshot anterior</a>. Veja este <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=194491">este tópico do fórum</a>.</div>
<p>Aqui está um layout de sistema de arquivos sugerido para restaurar facilmente o subvolume <code>@</code> que está montado na raiz de um snapshot anterior:
</p>
<table class="wikitable">
<caption>Layout do sistema de arquivos
</caption>
<tbody>
<tr>
<th>Subvolume</th>
<th>Ponto de montagem
</th>
</tr>
<tr>
<td>@</td>
<td>/
</td>
</tr>
<tr>
<td>@home</td>
<td>/home
</td>
</tr>
<tr>
<td>@snapshots</td>
<td>/.snapshots
</td>
</tr>
<tr>
<td>@var_log</td>
<td>/var/log
</td>
</tr>
</tbody>
</table>
<pre>subvolid=5
  |
  ├── @ -|
  |     diretórios contidos:
  |       ├── /usr
  |       ├── /bin
  |       ├── /.snapshots
  |       ├── ...
  |
  ├── @home
  ├── @snapshots
  ├── @var_log
  └── @...
</pre>
<p>Os subvolumes <code>@...</code> são montados em qualquer outro diretório que deva ter seu próprio subvolume.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> 
<ul>
<li>Ao tirar um snapshot de <code>@</code> (montado na raiz <code>/</code>), outros subvolumes não são incluídos no snapshot. Mesmo que um subvolume esteja aninhado abaixo de <code>@</code>, um snapshot de <code>@</code> <i><b>não</b></i> o incluirá. Crie configurações de snapper para subvolumes adicionais além de <code>@</code> dos quais você deseja manter snapshots.</li>
<li>Devido a uma <a href="../pt/Btrfs.html#Arquivo_swap" title="Btrfs (Português)">limitação do Btrfs</a>, os volumes de snapshot não podem conter <a href="../pt/Swap.html#Arquivo_swap" title="Swap (Português)">arquivos swap</a>. Coloque o arquivo swap em outro subvolume ou crie uma <a href="../pt/Swap.html#Parti%C3%A7%C3%A3o_swap" title="Swap (Português)">partição swap</a>.</li>
</ul>
</div>
<p>Se você restaurar seu sistema para um snapshot anterior de <code>@</code>, esses outros subvolumes não serão afetados. Por exemplo, isso permite que você restaure <code>@</code> para um snapshot anterior enquanto mantém seu <code>/home</code> inalterado, devido ao subvolume que está montado em <code>/home</code>.
</p>
<p>Esse layout permite que o utilitário snapper tire snapshots regulares de <code>/</code>, ao mesmo tempo que facilita a restauração de <code>/</code> de um <i>Arch Live CD</i> se ele não inicializar.
</p>
<p>Nesse cenário, após a configuração inicial, o snapper não precisa de alterações e funcionará conforme o esperado.
</p>
<h4>
<span id="Configura.C3.A7.C3.A3o_do_snapper_e_do_ponto_de_montagem"></span><span class="mw-headline" id="Configuração_do_snapper_e_do_ponto_de_montagem">Configuração do snapper e do ponto de montagem</span>
</h4>
<p>Supõe-se que o subvolume <code>@</code> esteja montado na raiz <code>/</code>. Também é assumido que <code>/.snapshots</code> <i>não</i> é montado e <i>não</i> existe como pasta, isso pode ser garantido pelos comandos:
</p>
<pre># umount /.snapshots
# rm -r /.snapshots
</pre>
<p>Então <a href="#Criando_uma_nova_configura%C3%A7%C3%A3o">crie uma nova configuração</a> para <code>/</code>. O Snapper create-config cria automaticamente um subvolume <code>.snapshots</code> com o subvolume raiz <code>@</code> como seu pai, que não é necessário para o layout do sistema de arquivos sugerido e pode ser excluído.
</p>
<pre># btrfs subvolume delete /.snapshots
</pre>
<p>Após excluir o subvolume, recrie o diretório <code>/.snapshots</code>.
</p>
<pre># mkdir /.snapshots
</pre>
<p>Agora <a href="../pt/File_systems.html#Montar_um_sistema_de_arquivos" class="mw-redirect" title="Monte">monte</a> <code>@snapshots</code> em <code>/.snapshots</code>. Por exemplo, para um sistema de arquivos localizado em <code>/dev/sda1</code>:
</p>
<pre># mount -o subvol=@snapshots /dev/sda1 /.snapshots
</pre>
<p>Para tornar esta montagem permanente, adicione uma entrada ao seu <a href="../pt/Fstab.html" title="Fstab (Português)">fstab</a>.
</p>
<p>Ou se você tiver uma entrada fstab existente, remonte o subvolume do snapshot:
</p>
<pre># mount -a
</pre>
<p>Dê à pasta a <a href="../pt/File_permissions_and_attributes.html#M%C3%A9todo_num%C3%A9rico" class="mw-redirect" title="Permissões">permissão</a> <code>750</code>.
</p>
<p>Isso fará com que todos os snapshots criados pelo snapper sejam armazenados fora do subvolume <code>@</code>, para que <code>@</code> possa ser facilmente substituído a qualquer momento sem perder os snapshots do snapper.
</p>
<h4>
<span id="Restaurando_.2F_para_seu_snapshot_anterior"></span><span class="mw-headline" id="Restaurando_/_para_seu_snapshot_anterior">Restaurando / para seu snapshot anterior</span>
</h4>
<p>Para restaurar o <code>/</code> usando um dos snapshots do snapper, primeiro inicialize em um USB/CD <i>live</i> do Arch Linux.
</p>
<p><a href="../pt/File_systems.html#Montar_um_sistema_de_arquivos" class="mw-redirect" title="Monte">Monte</a> o subvolume de nível superior (subvolid=5). Ou seja, omita quaisquer sinalizadores de montagem <code>subvolid</code> ou <code>subvol</code>.
</p>
<p>Encontre o número do snapshot que você deseja recuperar:
</p>
<pre>grep -r '&lt;date&gt;' /mnt/@snapshots/*/info.xml
</pre>
<p>A saída deve se parecer com isso, há uma linha para cada snapshot, para que você possa combinar facilmente o número e a data de cada snapshot.
</p>
<pre> /mnt/@snapshots/<i>número</i>/info.xml: &lt;date&gt;2021-07-26 22:00:00&lt;/date&gt;
</pre>
<p>Lembre-se do <code><i>número</i></code>.
</p>
<p>Agora, mova <code>@</code> para outro local (<i>por ex.</i> <code>/@.broken</code>) para salvar uma cópia do sistema atual. Alternativamente, simplesmente delete <code>@</code> usando <code>btrfs subvolume delete /mnt/@</code>.
</p>
<p>Crie um snapshot de leitura e gravação (<i>read-write</i>) do snapshot somente leitura (<i>read-only</i>) que o snapper tirou:
</p>
<pre># btrfs subvolume snapshot /mnt/@snapshots/<i>número</i>/snapshot /mnt/@
</pre>
<p>Onde <code><i>número</i></code> é o número do snapshot do snapper que você deseja restaurar.
</p>
<p>Se <code>subvolid</code> foi usado para a opção de entrada de montagem <code>/</code> no <a href="../pt/Fstab.html" title="Fstab (Português)">fstab</a>, em vez de <code>/caminho/para/subvolume</code>, altere subvolid no para o novo subvolid.
</p>
<pre># btrfs subvolume list /mnt | grep @$ # Verifique o novo subvolid
# grep "/ " /mnt/@/etc/fstab          # Verifique o subvolid antigo
# vim /mnt/@/etc/fstab                # Edite
</pre>
<p>Altere também a configuração do bootloader, como refind_linux.conf, se ele contiver o subvolid.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> Você também pode usar a ferramenta de reversão automática feita para este layout: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snapper-rollback/">snapper-rollback</a></span><sup><small>AUR</small></sup>. Edite o arquivo de configuração em <code>/etc/snapper-rollback.conf</code> para corresponder ao seu sistema.</div>
<h3><span class="mw-headline" id="Excluindo_arquivos_de_snapshots">Excluindo arquivos de snapshots</span></h3>
<p>Se você deseja excluir um arquivo ou pasta específica de snapshots anteriores sem excluir os próprios snapshots, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snappers/">snappers</a></span><sup><small>AUR</small></sup> é um script que adiciona essa funcionalidade ao Snapper. Esse script também pode ser usado para manipular snapshots anteriores de várias outras maneiras que o Snapper não suporta atualmente.
</p>
<p>Se você deseja remover um arquivo sem usar um script extra, basta <a rel="nofollow" class="external text" href="https://unix.stackexchange.com/a/149933">fazer com que seu subvolume do snapshot tenha permissões de leitura e escrita</a>, o que você pode fazer com:
</p>
<pre># btrfs property set /caminho/para/.snapshots/&lt;num_do_snapshot&gt;/snapshot ro false
</pre>
<p>Verifique se <code>ro=false</code>:
</p>
<pre># btrfs property get /caminho/para/.snapshots/&lt;num_do_snapshot&gt;/snapshot
ro=false
</pre>
<p>Agora você pode modificar arquivos em <code>/caminho/para/.snapshots/&lt;num_do_snapshot&gt;/snapshot</code> normalmente. Você pode usar um loop de shell para trabalhar em seus snapshots em massa.
</p>
<h3>
<span id="Evitando_lentid.C3.A3o"></span><span class="mw-headline" id="Evitando_lentidão">Evitando lentidão</span>
</h3>
<p>Manter muitos snapshots por um longo período de tempo em um sistema de arquivos ocupado como <code>/</code>, onde muitas atualizações do sistema acontecem ao longo do tempo, pode causar lentidão séria. Você pode evitar isso:
</p>
<ul>
<li>
<a href="../pt/Btrfs.html#Criando_um_subvolume" title="Btrfs (Português)">Criando</a> subvolumes para coisas que não valem a pena serem capturadas, como <code>/var/cache/pacman/pkg</code>, <code>/var/abs</code>, <code>/var/tmp</code> e <code>/srv</code>.</li>
<li>Editando as configurações padrão para snapshots por hora/diário/mensal/anual ao usar <a href="#Snapshots_autom%C3%A1ticos_da_linha_do_tempo">#Snapshots automáticos da linha do tempo</a>.</li>
</ul>
<h4><span class="mw-headline" id="updatedb">updatedb</span></h4>
<p>Por padrão, <code>updatedb</code> (veja <a href="../pt/Mlocate.html" title="Mlocate (Português)">mlocale</a>) também indexará o diretório <code>.snapshots</code> criado pelo snapper, o que pode causar lentidão grave e uso excessivo de memória se você tiver muitos snapshots. Você pode impedir que <code>updatedb</code> indexe sobre ele editando:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/updatedb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PRUNENAMES = ".snapshots"</pre>
<h4><span class="mw-headline" id="Desativar_grupos_de_cotas">Desativar grupos de cotas</span></h4>
<p>Há relatos de lentidão significativa causada por grupos de cotas, se, por exemplo, <code>snapper ls</code> levar muitos minutos para retornar um resultado, essa pode ser a causa. Consulte <a rel="nofollow" class="external autonumber" href="https://www.reddit.com/r/btrfs/comments/fmucrq/btrfs_snapshots_make_entire_system_lag_cpu_usage/">[2]</a>.
</p>
<p>Para determinar se os grupos de cotas estão ou não habilitados, use o seguinte comando:
</p>
<pre># btrfs qgroup show /
</pre>
<p>Os grupos de cotas podem ser desativados com:
</p>
<pre># btrfs quota disable /
</pre>
<h4>
<span id="Contar_o_n.C3.BAmero_de_snapshots"></span><span class="mw-headline" id="Contar_o_número_de_snapshots">Contar o número de snapshots</span>
</h4>
<p>Se a desativação de grupos de cotas não ajudou na lentidão, pode ser útil contar o número de snapshots, isso pode ser feito com:
</p>
<pre># btrfs subvolume list -s / | wc -l
</pre>
<h3><span class="mw-headline" id="Preservando_arquivos_de_log">Preservando arquivos de log</span></h3>
<p>É recomendado criar um subvolume para <code>/var/log</code> para que os snapshots de <code>/</code> o excluam. Dessa forma, se um snapshot de <code>/</code> for restaurado, seus arquivos de log também não serão revertidos para o estado anterior. Isso facilita a solução de problemas.
</p>
<h2>
<span id="Solu.C3.A7.C3.A3o_de_problemas"></span><span class="mw-headline" id="Solução_de_problemas">Solução de problemas</span>
</h2>
<h3><span class="mw-headline" id="Logs_do_snapper">Logs do snapper</span></h3>
<p>O Snapper grava todas as atividades em <code>/var/log/snapper.log</code> - verifique este arquivo primeiro se achar que algo está errado.
</p>
<p>Se você tiver problemas com snapshots de hora em hora/diários/semanais, a causa mais comum para isso até agora foi que o serviço cronie (ou qualquer daemon cron que você está usando) não estava em execução.
</p>
<h3>
<span id="Erro_de_E.2FS"></span><span class="mw-headline" id="Erro_de_E/S">Erro de E/S</span>
</h3>
<p>Se você receber um 'IO Error' ao tentar criar um snapshot, certifique-se de que o diretório <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=164404">.snapshots</a> associado ao subvolume que você está tentando fazer o snapshot é um subvolume por si só.
</p>
<p>Outra causa possível é que o diretório .snapshots não tem root como proprietário (Você encontrará <code>Btrfs.cc(openInfosDir):219 - .snapshots must have owner root</code> em <code>/var/log /snapper.log</code>).
</p>
<h3>
<span id="Snapshots_.C3.B3rf.C3.A3os_causando_desperd.C3.ADcio_de_espa.C3.A7o_em_disco"></span><span class="mw-headline" id="Snapshots_órfãos_causando_desperdício_de_espaço_em_disco">Snapshots órfãos causando desperdício de espaço em disco</span>
</h3>
<p>É possível que os instantâneos sejam 'perdidos', onde ainda existem no disco, mas não são rastreados pelo snapper. Isso pode resultar em uma grande quantidade de espaço em disco desperdiçado e não contabilizado. Para verificar isso, compare a saída de 
</p>
<pre># snapper -c &lt;config&gt; list
</pre>
<p>com 
</p>
<pre># btrfs subvolume list -o &lt;subvolume pai&gt;/.snapshots 
</pre>
<p>Qualquer subvolume na segunda lista que não esteja presente na primeira é órfão e pode ser <a href="../pt/Btrfs.html#Excluindo_um_subvolume" title="Btrfs (Português)">excluído</a> manualmente.
</p>
<h2>
<span id="Veja_tamb.C3.A9m"></span><span class="mw-headline" id="Veja_também">Veja também</span>
</h2>
<ul>
<li><a rel="nofollow" class="external text" href="http://snapper.io/">Página inicial do Snapper</a></li>
<li><a rel="nofollow" class="external text" href="https://en.opensuse.org/Portal:Snapper">Portal openSUSE Snapper</a></li>
<li><a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Main_Page">Página inicial do Btrfs</a></li>
<li><a rel="nofollow" class="external text" href="https://web.archive.org/web/20160327174528/https://www.linux.com/news/enterprise/systems-management/878490-snapper-suses-ultimate-btrfs-snapshot-manager/">Linux.com: Snapper: o Ultimate Btrfs Snapshot Manager do SUSE</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../pt/Category:File_systems.html" title="Category:File systems (Português)">File systems (Português)</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Snapper_(Portugu%C3%AAs)&amp;oldid=763931">https://wiki.archlinux.org/index.php?title=Snapper_(Português)&amp;oldid=763931</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 12 January 2023, at 10:41.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
