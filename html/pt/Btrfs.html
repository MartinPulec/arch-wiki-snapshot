<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Btrfs (Português) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Btrfs_Português rootpage-Btrfs_Português skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Preparação" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Prepara%C3%A7%C3%A3o">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Preparação</div>
		</a>
		
		<ul id="toc-Preparação-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Criação_do_sistema_de_arquivos" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Cria%C3%A7%C3%A3o_do_sistema_de_arquivos">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Criação do sistema de arquivos</div>
		</a>
		
			<button aria-controls="toc-Criação_do_sistema_de_arquivos-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Criação do sistema de arquivos subsection</span>
			</button>
		
		<ul id="toc-Criação_do_sistema_de_arquivos-sublist" class="vector-toc-list">
			<li id="toc-Sistema_de_arquivos_em_um_único_dispositivo" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Sistema_de_arquivos_em_um_%C3%BAnico_dispositivo">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Sistema de arquivos em um único dispositivo</div>
			</a>
			
			<ul id="toc-Sistema_de_arquivos_em_um_único_dispositivo-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Sistema_de_arquivos_com_vários_dispositivos" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Sistema_de_arquivos_com_v%C3%A1rios_dispositivos">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Sistema de arquivos com vários dispositivos</div>
			</a>
			
			<ul id="toc-Sistema_de_arquivos_com_vários_dispositivos-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Configurando_o_sistema_de_arquivos" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Configurando_o_sistema_de_arquivos">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Configurando o sistema de arquivos</div>
		</a>
		
			<button aria-controls="toc-Configurando_o_sistema_de_arquivos-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configurando o sistema de arquivos subsection</span>
			</button>
		
		<ul id="toc-Configurando_o_sistema_de_arquivos-sublist" class="vector-toc-list">
			<li id="toc-Copy-on-Write_(CoW)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Copy-on-Write_(CoW)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Copy-on-Write (CoW)</div>
			</a>
			
			<ul id="toc-Copy-on-Write_(CoW)-sublist" class="vector-toc-list">
				<li id="toc-Desativando_CoW" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Desativando_CoW">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.1</span>Desativando CoW</div>
			</a>
			
			<ul id="toc-Desativando_CoW-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Compressão" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Compress%C3%A3o">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Compressão</div>
			</a>
			
			<ul id="toc-Compressão-sublist" class="vector-toc-list">
				<li id="toc-Visualizar_tipos_e_proporções_de_compactação" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Visualizar_tipos_e_propor%C3%A7%C3%B5es_de_compacta%C3%A7%C3%A3o">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.1</span>Visualizar tipos e proporções de compactação</div>
			</a>
			
			<ul id="toc-Visualizar_tipos_e_proporções_de_compactação-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Subvolumes" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Subvolumes">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Subvolumes</div>
			</a>
			
			<ul id="toc-Subvolumes-sublist" class="vector-toc-list">
				<li id="toc-Criando_um_subvolume" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Criando_um_subvolume">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.1</span>Criando um subvolume</div>
			</a>
			
			<ul id="toc-Criando_um_subvolume-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Listando_subvolumes" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Listando_subvolumes">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.2</span>Listando subvolumes</div>
			</a>
			
			<ul id="toc-Listando_subvolumes-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Excluindo_um_subvolume" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Excluindo_um_subvolume">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.3</span>Excluindo um subvolume</div>
			</a>
			
			<ul id="toc-Excluindo_um_subvolume-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Montando_subvolumes" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Montando_subvolumes">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.4</span>Montando subvolumes</div>
			</a>
			
			<ul id="toc-Montando_subvolumes-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Montando_o_subvolume_como_root" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Montando_o_subvolume_como_root">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.5</span>Montando o subvolume como root</div>
			</a>
			
			<ul id="toc-Montando_o_subvolume_como_root-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Alterando_o_subvolume_padrão" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Alterando_o_subvolume_padr%C3%A3o">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.6</span>Alterando o subvolume padrão</div>
			</a>
			
			<ul id="toc-Alterando_o_subvolume_padrão-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Quota" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Quota">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4</span>Quota</div>
			</a>
			
			<ul id="toc-Quota-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Intervalo_de_confirmação" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Intervalo_de_confirma%C3%A7%C3%A3o">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.5</span>Intervalo de confirmação</div>
			</a>
			
			<ul id="toc-Intervalo_de_confirmação-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-TRIM_do_SSD" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#TRIM_do_SSD">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.6</span>TRIM do SSD</div>
			</a>
			
			<ul id="toc-TRIM_do_SSD-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Uso" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Uso">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Uso</div>
		</a>
		
			<button aria-controls="toc-Uso-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Uso subsection</span>
			</button>
		
		<ul id="toc-Uso-sublist" class="vector-toc-list">
			<li id="toc-Arquivo_swap" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Arquivo_swap">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Arquivo swap</div>
			</a>
			
			<ul id="toc-Arquivo_swap-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Exibindo_espaço_usado/livre" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Exibindo_espa%C3%A7o_usado/livre">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Exibindo espaço usado/livre</div>
			</a>
			
			<ul id="toc-Exibindo_espaço_usado/livre-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Desfragmentação" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Desfragmenta%C3%A7%C3%A3o">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Desfragmentação</div>
			</a>
			
			<ul id="toc-Desfragmentação-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-RAID" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#RAID">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>RAID</div>
			</a>
			
			<ul id="toc-RAID-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Scrub" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Scrub">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.5</span>Scrub</div>
			</a>
			
			<ul id="toc-Scrub-sublist" class="vector-toc-list">
				<li id="toc-Iniciar_manualmente" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Iniciar_manualmente">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.5.1</span>Iniciar manualmente</div>
			</a>
			
			<ul id="toc-Iniciar_manualmente-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Comece_com_um_serviço_ou_timer" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Comece_com_um_servi%C3%A7o_ou_timer">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.5.2</span>Comece com um serviço ou timer</div>
			</a>
			
			<ul id="toc-Comece_com_um_serviço_ou_timer-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Balance" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Balance">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.6</span>Balance</div>
			</a>
			
			<ul id="toc-Balance-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Snapshots" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Snapshots">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.7</span>Snapshots</div>
			</a>
			
			<ul id="toc-Snapshots-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enviar/receber" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enviar/receber">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.8</span>Enviar/receber</div>
			</a>
			
			<ul id="toc-Enviar/receber-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Desduplicação" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Desduplica%C3%A7%C3%A3o">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.9</span>Desduplicação</div>
			</a>
			
			<ul id="toc-Desduplicação-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Redimensionando" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Redimensionando">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.10</span>Redimensionando</div>
			</a>
			
			<ul id="toc-Redimensionando-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Problemas_conhecidos" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Problemas_conhecidos">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Problemas conhecidos</div>
		</a>
		
			<button aria-controls="toc-Problemas_conhecidos-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Problemas conhecidos subsection</span>
			</button>
		
		<ul id="toc-Problemas_conhecidos-sublist" class="vector-toc-list">
			<li id="toc-Criptografia" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Criptografia">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Criptografia</div>
			</a>
			
			<ul id="toc-Criptografia-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Problemas_de_verificação_do_btrfs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Problemas_de_verifica%C3%A7%C3%A3o_do_btrfs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Problemas de verificação do btrfs</div>
			</a>
			
			<ul id="toc-Problemas_de_verificação_do_btrfs-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Dicas_e_truques" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Dicas_e_truques">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Dicas e truques</div>
		</a>
		
			<button aria-controls="toc-Dicas_e_truques-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Dicas e truques subsection</span>
			</button>
		
		<ul id="toc-Dicas_e_truques-sublist" class="vector-toc-list">
			<li id="toc-Disco_Btrfs_sem_partições" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Disco_Btrfs_sem_parti%C3%A7%C3%B5es">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>Disco Btrfs sem partições</div>
			</a>
			
			<ul id="toc-Disco_Btrfs_sem_partições-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Conversão_de_Ext3/4_para_Btrfs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Convers%C3%A3o_de_Ext3/4_para_Btrfs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2</span>Conversão de Ext3/4 para Btrfs</div>
			</a>
			
			<ul id="toc-Conversão_de_Ext3/4_para_Btrfs-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Aceleração_do_hardware_do_checksum" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Acelera%C3%A7%C3%A3o_do_hardware_do_checksum">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.3</span>Aceleração do hardware do checksum</div>
			</a>
			
			<ul id="toc-Aceleração_do_hardware_do_checksum-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Recuperação_de_corrupção" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Recupera%C3%A7%C3%A3o_de_corrup%C3%A7%C3%A3o">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.4</span>Recuperação de corrupção</div>
			</a>
			
			<ul id="toc-Recuperação_de_corrupção-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Inicializando_em_snapshots" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Inicializando_em_snapshots">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.5</span>Inicializando em snapshots</div>
			</a>
			
			<ul id="toc-Inicializando_em_snapshots-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Use_subvolumes_Btrfs_com_systemd-nspawn" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Use_subvolumes_Btrfs_com_systemd-nspawn">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.6</span>Use subvolumes Btrfs com systemd-nspawn</div>
			</a>
			
			<ul id="toc-Use_subvolumes_Btrfs_com_systemd-nspawn-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Reduzindo_atualizações_de_metadados_de_tempo_de_acesso" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Reduzindo_atualiza%C3%A7%C3%B5es_de_metadados_de_tempo_de_acesso">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.7</span>Reduzindo atualizações de metadados de tempo de acesso</div>
			</a>
			
			<ul id="toc-Reduzindo_atualizações_de_metadados_de_tempo_de_acesso-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Backup_incremental_para_unidade_externa" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Backup_incremental_para_unidade_externa">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.8</span>Backup incremental para unidade externa</div>
			</a>
			
			<ul id="toc-Backup_incremental_para_unidade_externa-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Solução_de_problemas" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Solu%C3%A7%C3%A3o_de_problemas">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Solução de problemas</div>
		</a>
		
			<button aria-controls="toc-Solução_de_problemas-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Solução de problemas subsection</span>
			</button>
		
		<ul id="toc-Solução_de_problemas-sublist" class="vector-toc-list">
			<li id="toc-GRUB" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#GRUB">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1</span>GRUB</div>
			</a>
			
			<ul id="toc-GRUB-sublist" class="vector-toc-list">
				<li id="toc-Deslocamento_da_partição" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Deslocamento_da_parti%C3%A7%C3%A3o">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1.1</span>Deslocamento da partição</div>
			</a>
			
			<ul id="toc-Deslocamento_da_partição-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Raiz_ausente" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Raiz_ausente">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1.2</span>Raiz ausente</div>
			</a>
			
			<ul id="toc-Raiz_ausente-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Tempo_limite_de_montagem_esgotado" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Tempo_limite_de_montagem_esgotado">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2</span>Tempo limite de montagem esgotado</div>
			</a>
			
			<ul id="toc-Tempo_limite_de_montagem_esgotado-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-BTRFS:_open_ctree_falhou" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#BTRFS:_open_ctree_falhou">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.3</span>BTRFS: open_ctree falhou</div>
			</a>
			
			<ul id="toc-BTRFS:_open_ctree_falhou-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-btrfs_check" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#btrfs_check">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.4</span>btrfs check</div>
			</a>
			
			<ul id="toc-btrfs_check-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Veja_também" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Veja_tamb%C3%A9m">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>Veja também</div>
		</a>
		
		<ul id="toc-Veja_também-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Btrfs (Português)</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 7 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-7" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">7 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-de mw-list-item"><a href="https://wiki.archlinux.de/title/Arch_auf_BtrFS" title="Arch auf BtrFS – Deutsch" lang="de" hreflang="de" class="interlanguage-link-target"><span>Deutsch</span></a></li>
<li class="interlanguage-link interwiki-en mw-list-item"><a href="../en/Btrfs.html" title="Btrfs – English" lang="en" hreflang="en" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/Btrfs.html" title="Btrfs – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-it mw-list-item"><a href="../it/Btrfs.html" title="Btrfs – italiano" lang="it" hreflang="it" class="interlanguage-link-target"><span>Italiano</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Btrfs" title="Btrfs – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Btrfs.html" title="Btrfs – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Btrfs" title="Btrfs – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="pt" dir="ltr">
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Status de tradução:</strong> Esse artigo é uma tradução de <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a>. Data da última tradução: 2022-08-11. Você pode ajudar a sincronizar a tradução, se houver <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Btrfs&amp;diff=0&amp;oldid=741207">alterações</a> na versão em inglês.</div>
<div class="archwiki-template-meta-related-articles">
<p>Artigos relacionados</p>
<ul>
<li><a href="../pt/File_systems.html" class="mw-redirect" title="Sistemas de arquivos">Sistemas de arquivos</a></li>
<li><a href="../pt/Snapper.html" title="Snapper (Português)">Snapper</a></li>
<li><a href="../pt/Dm-crypt/Encrypting_an_entire_system.html#Subvolumes_do_Btrfs_com_swap" class="mw-redirect" title="Dm-crypt/Criptografando todo um sistema">dm-crypt/Criptografando todo um sistema#Subvolumes do Btrfs com swap</a></li>
</ul>
</div>
<p>Da <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Main_Page">Wiki do Btrfs</a> (traduzido):
</p>
<dl><dd>O Btrfs é uma cópia moderna do sistema de arquivos de gravação (Copy-on-Write) para Linux, destinada a implementar recursos avançados, ao mesmo tempo em que se concentra na tolerância a falhas, reparo e fácil administração. Desenvolvido em conjunto em várias empresas, o Btrfs é licenciado sob a GPL e aberto à contribuição de qualquer pessoa.</dd></dl>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> O Btrfs possui alguns recursos instáveis. Veja o <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Status">Status</a> na Wiki do Btrfs, <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/FAQ#Is_Btrfs_stable.3F">O Btrfs é estável?</a> e <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Getting_started">Começando</a> para informações mais detalhadas. Veja a sessão <a href="#Problemas_conhecidos">#Problemas conhecidos</a>.</div>
<meta property="mw:PageProp/toc">
<h2>
<span id="Prepara.C3.A7.C3.A3o"></span><span class="mw-headline" id="Preparação">Preparação</span>
</h2>
<p>Para utilitários do userspace <a href="../pt/Help:Reading.html#Instala%C3%A7%C3%A3o_de_pacotes" class="mw-redirect" title="Instale">instale</a> o pacote <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=btrfs-progs">btrfs-progs</a></span> necessário para as operações básicas.
</p>
<p>Se você precisar inicializar a partir de um sistema de arquivos Btrfs (ou seja, seu kernel e initramfs residem em uma partição Btrfs), verifique se o seu <a href="../pt/Arch_boot_process.html#Gerenciador_de_boot" class="mw-redirect" title="Gerenciador de boot">gerenciador de boot</a> suporta Btrfs.
</p>
<h2>
<span id="Cria.C3.A7.C3.A3o_do_sistema_de_arquivos"></span><span class="mw-headline" id="Criação_do_sistema_de_arquivos">Criação do sistema de arquivos</span>
</h2>
<p>Veja, a seguir como criar um novo <a href="../pt/File_systems.html" class="mw-redirect" title="Sistema de arquivos">sistema de arquivos</a> Btrfs. Para converter uma partição ext3/4 em Btrfs, veja <a href="#Convers%C3%A3o_de_Ext3/4_para_Btrfs">#Conversão de Ext3/4 para Btrfs</a>. Para usar uma configuração sem partição, Veja <a href="#Disco_Btrfs_sem_parti%C3%A7%C3%B5es">#Disco Btrfs sem partições</a>.
</p>
<p>Veja <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.btrfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.btrfs.8">mkfs.btrfs(8)</a></span> para mais informações.
</p>
<h3>
<span id="Sistema_de_arquivos_em_um_.C3.BAnico_dispositivo"></span><span class="mw-headline" id="Sistema_de_arquivos_em_um_único_dispositivo">Sistema de arquivos em um único dispositivo</span>
</h3>
<p>Para criar um sistema de arquivos Btrfs na partição <code>/dev/<i>partição</i></code>:
</p>
<pre># mkfs.btrfs -L <i>minhaEtiqueta</i> /dev/<i>partição</i>
</pre>
<p>O tamanho de nó (<i>nodesize</i>) padrão do Btrfs para metadados é 16 KB, enquanto o tamanho de setor padrão para dados é igual ao tamanho da página e detectado automaticamente. Para usar um tamanho de nó maior para metadados (deve ser um múltiplo do tamanho do setor, até 64 KB é permitido), especifique um valor para o <code>nodesize</code> por meio da opção <code>-n</code> conforme mostrado neste exemplo usando blocos de 32 KB:
</p>
<pre># mkfs.btrfs -L <i>minhaEtiqueta</i> -n 32k /dev/<i>partição</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> De acordo com <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.btrfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.btrfs.8#OPTIONS">mkfs.btrfs(8) § OPTIONS</a></span>, "[o] tamanho de nó menor aumenta a fragmentação, mas leva a mais altas que, por sua vez, levam a menor contenção de bloqueio. Tamanhos de nó mais altos proporcionam melhor compactação e menos fragmentação ao custo de operações de memória mais caras ao atualizar os blocos de metadados".</div>
<h3>
<span id="Sistema_de_arquivos_com_v.C3.A1rios_dispositivos"></span><span class="mw-headline" id="Sistema_de_arquivos_com_vários_dispositivos">Sistema de arquivos com vários dispositivos</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> Os modos RAID 5 e RAID 6 do Btrfs são fatalmente falhos e não devem ser usados para "nada além de testes com dados descartáveis". <a rel="nofollow" class="external text" href="https://lore.kernel.org/linux-btrfs/20200627032414.GX10769@hungrycats.org/">Lista de problemas conhecidos e soluções parciais.</a> Consulte <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/RAID56">a página do Btrfs em RAID5 e RAID6</a> para atualizações de status (parece não estar atualizado).</div>
<p>Vários dispositivos podem ser usados para criar um RAID. Os níveis de RAID suportados incluem RAID 0, RAID 1, RAID 10, RAID 5 e RAID 6. A partir do kernel 5.5 RAID1c3 e RAID1c4 para 3 e 4 cópias do nível RAID 1. Os níveis de RAID podem ser configurados separadamente para dados e metadados usando as opções <code>-d</code> e <code>-m</code>, respectivamente. Por padrão, os dados têm uma cópia (<code>single</code>) e os metadados são espelhados (<code>raid1</code>). Isso é semelhante à criação de uma <a href="https://en.wikipedia.org/wiki/JBOD" class="extiw" title="w:JBOD">configuração JBOD</a>, onde os discos são vistos como um sistema de arquivos, mas os arquivos não são duplicados. Consulte <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Using_Btrfs_with_Multiple_Devices">Usando Btrfs com vários dispositivos</a> para obter mais informações sobre como criar um volume RAID Btrfs.
</p>
<pre># mkfs.btrfs -d single -m raid1 /dev/<i>partição1</i> /dev/<i>partição2</i> ...
</pre>
<p>Você deve incluir o hook <code>udev</code> ou o hook <code>btrfs</code> em <code>/etc/mkinitcpio.conf</code> para usar vários dispositivos Btrfs em uma pool. Veja o artigo <a href="../pt/Mkinitcpio.html#Hooks_comuns" title="Mkinitcpio (Português)">Mkinitcpio#Hooks comuns</a> para mais informações.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> 
<ul>
<li>É possível adicionar dispositivos a um sistema de arquivos com vários dispositivos posteriormente. Veja o <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Using_Btrfs_with_Multiple_Devices">Artigo da Wiki do Btrfs</a> para mais informações.</li>
<li>Os dispositivos podem ter tamanhos diferentes. No entanto, só se uma unidade em uma configuração RAID for maior que as outras, esse espaço extra não será usado.</li>
<li>Alguns <a href="../pt/Arch_boot_process.html#Gerenciador_de_boot" class="mw-redirect" title="Gerenciador de boot">gerenciadores de boot</a> como <a href="../en/Syslinux.html" title="Syslinux">Syslinux</a> não suportam sistemas de arquivos com vários dispositivos.</li>
<li>O Btrfs não lê automaticamente do dispositivo mais rápido, portanto, misturar diferentes tipos de discos resulta em desempenho inconsistente. Consulte <a rel="nofollow" class="external autonumber" href="https://stackoverflow.com/a/55408367">[1]</a> para obter detalhes.</li>
</ul>
</div>
<p>Veja <a href="#RAID">#RAID</a> para obter conselhos sobre manutenção específica para sistemas de arquivos Btrfs de vários dispositivos.
</p>
<h2><span class="mw-headline" id="Configurando_o_sistema_de_arquivos">Configurando o sistema de arquivos</span></h2>
<h3>
<span id="Copy-on-Write_.28CoW.29"></span><span class="mw-headline" id="Copy-on-Write_(CoW)">Copy-on-Write (CoW)</span>
</h3>
<p>Por padrão, o Btrfs usa <a href="https://en.wikipedia.org/wiki/copy-on-write" class="extiw" title="wikipedia:copy-on-write">copy-on-write</a> para todos os arquivos o tempo todo. As gravações não substituem os dados no local; em vez disso, uma cópia modificada do bloco é gravada em um novo local e os metadados são atualizados para apontar para o novo local. Veja a <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/SysadminGuide#Copy_on_Write_.28CoW.29">seção Guia Sysadmin do Btrfs</a> para detalhes de implementação, bem como vantagens e desvantagens.
</p>
<h4><span class="mw-headline" id="Desativando_CoW">Desativando CoW</span></h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> Desabilitar CoW em Btrfs também desabilita checksums. Btrfs não será capaz de detectar arquivos <code>nodatacow</code> corrompidos. Quando combinado com RAID 1, quedas de energia ou outras fontes de corrupção podem fazer com que os dados fiquem fora de sincronia.</div>
<p>Para desativar copy-on-write de arquivos recém-criados em um subvolume montado, use a opção de montagem <code>nodatacow</code>. Isso afetará apenas os arquivos recém-criados. A cópia na gravação ainda acontecerá para arquivos existentes. A opção <code>nodatacow</code> também desativa a compactação. Veja <span class="plainlinks archwiki-template-man" title="$ man 5 btrfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/btrfs.5">btrfs(5)</a></span> para detalhes.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> De <span class="plainlinks archwiki-template-man" title="$ man 5 btrfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/btrfs.5#MOUNT_OPTIONS">btrfs(5) § MOUNT OPTIONS</a></span> (traduzido): "em um único sistema de arquivos, não é possível montar alguns subvolumes com <code>nodatacow</code> e outros com <code>datacow</code>. A opção de montagem do primeiro subvolume montado se aplica a quaisquer outros subvolumes."</div>
<p>Para desativar copy-on-write de arquivos/diretórios únicos,:
</p>
<pre>$ chattr +C <i>/diretório/arquivo</i>
</pre>
<p>Isso desabilitará copy-on-write para aquelas operações nas quais há apenas uma referência ao arquivo. Se houver mais de uma referência, por exemplo devido a clones de arquivo (leves ou não) ou snapshots do sistema de arquivos, o copy-on-write ainda ocorre. Observe que a partir do <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=coreutils">coreutils</a></span> 9.0, <code>cp</code> tenta realizar cópias leves por padrão — veja <span class="plainlinks archwiki-template-man" title="$ man 1 cp"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cp.1">cp(1)</a></span> para mais detalhes.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> De <span class="plainlinks archwiki-template-man" title="$ man 1 chattr"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/chattr.1">chattr(1)</a></span> (traduzido): "Para Btrfs, o sinalizador '<code>C</code>' deve ser definido em arquivos novos ou vazios. Se estiver definido em um arquivo que já possui blocos de dados, fica indefinido quando os blocos atribuídos ao arquivo estarão totalmente estáveis. Se o sinalizador '<code>C</code>' estiver definido em um diretório, ele não terá efeito no diretório, mas os novos arquivos criados nesse diretório terão o atributo <code>No_COW</code>."</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> De acordo com a nota acima, você pode usar o seguinte truque para desativar Copy-on-Write em arquivos existentes em um diretório:
<pre>$ mv <i>/caminho/para/diretório</i> <i>/caminho/para/diretório_antigo</i>
$ mkdir <i>/caminho/para/diretório</i>
$ chattr +C <i>/caminho/para/diretório</i>
$ cp -a --reflink=never <i>/caminho/para/diretório_antigo/.</i> <i>/caminho/para/diretório</i>
$ rm -rf <i>/caminho/para/diretório_antigo</i>
</pre>
Certifique-se de que os dados não sejam usados durante este processo. Observe também que <code>mv</code> ou <code>cp</code> sem <code>--reflink=never</code> conforme descrito abaixo não funcionar.</div>
<h3>
<span id="Compress.C3.A3o"></span><span class="mw-headline" id="Compressão">Compressão</span>
</h3>
<p>Btrfs suporta <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Compression">compressão transparente e automática</a>. Isso reduz o tamanho dos arquivos e aumenta significativamente a vida útil da mídia baseada em flash, reduzindo a amplificação de gravação. Veja <a href="https://fedoraproject.org/wiki/Changes/BtrfsByDefault#Compression" class="extiw" title="fedora:Changes/BtrfsByDefault">Fedora:Changes/BtrfsByDefault#Compression</a>, <a rel="nofollow" class="external autonumber" href="https://lists.fedoraproject.org/archives/list/devel@lists.fedoraproject.org/message/NTV77NFF6NDZM3QTPUM2TQZ5PCM6GOO2/">[2]</a> e <a rel="nofollow" class="external autonumber" href="https://pagure.io/fedora-btrfs/project/issue/36#comment-701551">[3]</a>. Ela também pode <a rel="nofollow" class="external text" href="https://www.phoronix.com/scan.php?page=article&amp;item=btrfs_compress_2635&amp;num=1">melhorar o desempenho</a>, em alguns casos (por exemplo, thread único com E/S de arquivo pesado), enquanto obviamente prejudica o desempenho em outros casos (por exemplo, tarefas multi-threaded e/ou com uso intensivo de CPU com E/S de arquivo grande). O melhor desempenho geralmente é alcançado com os algoritmos de compactação mais rápidos, <i>zstd</i> e <i>lzo</i>, e alguns <a rel="nofollow" class="external text" href="https://www.phoronix.com/scan.php?page=article&amp;item=btrfs-zstd-compress">benchmarks</a> fornecem comparações detalhadas.
</p>
<p><code>compress=<i>alg</i></code> é uma opção de montagem ativada automaticamente considerando todos os arquivos para compactação, onde <code><i>alg</i></code> e também <code>zlib</code>, <code>lzo</code>, <code>zstd</code>, ou <code>no</code> (sem compressão). Usando esta opção, o btrfs verificará se a compactação da primeira parte dos dados a reduz. Se isso acontecer, toda a gravação nesse arquivo será compactada. Caso contrário, nada será compactado. Com esta opção, se a primeira parte da gravação não diminuir, nenhuma compactação será aplicada à gravação, mesmo que o restante dos dados diminua tremendamente. <a rel="nofollow" class="external autonumber" href="https://btrfs.wiki.kernel.org/index.php/Compression#What_happens_to_incompressible_files.3F">[4]</a> Isso é feito para evitar que o disco aguarde para começar a gravar até que todos os dados a serem gravados sejam totalmente fornecidos ao btrfs e compactados.
</p>
<p>A opção de montagem <code>compress=<i>alg</i></code> permite considerar automaticamente cada arquivo para compactação, onde <code><i>alg</i></code> é <code>zlib</code>, <code>lzo</code>, <code>zstd</code> ou <code>no</code> (para nenhuma compactação). Usando esta opção, o btrfs verificará se a compactação da primeira parte dos dados os reduz. Se isso acontecer, toda a gravação nesse arquivo será compactada. Se isso não acontecer, nada disso é compactado. Com essa opção, se a primeira parte da gravação não diminuir, nenhuma compactação será aplicada à gravação, mesmo que o restante dos dados reduza tremendamente <a rel="nofollow" class="external autonumber" href="https://btrfs.wiki.kernel.org/index.php/Compression#What_happens_to_incompressible_files.3F">[5]</a>. Isso é feito para evitar que o disco espere para iniciar a gravação até que todos os dados a serem gravados sejam totalmente fornecidos ao btrfs e compactados.
</p>
<p>A opção de montagem <code>compress-force=<i>alg</i></code> pode ser usada em vez disso, o que faz com que o btrfs ignore a verificação se a compactação reduz a primeira parte e habilita a tentativa de compactação automática para cada arquivo. Na pior das hipóteses, isso pode causar (um pouco) mais uso da CPU sem nenhum propósito. No entanto, testes empíricos em vários sistemas de uso misto mostraram uma melhoria significativa de cerca de 10% de compactação de disco ao usar <code>compress-force=<i>zstd</i></code> em vez de apenas <code>compress=<i>zstd</i></code>, que também tinha 10% de compactação de disco.
</p>
<p>Somente os arquivos criados ou modificados após a adição da opção de montagem serão compactados.
</p>
<p>Para aplicar compactação a arquivos existentes, use o comando <code>btrfs filesystem defragment -c<i>alg</i></code>, onde <code><i>alg</i></code> é <code>zlib</code>, <code>lzo</code> ou <code>zstd</code>. Por exemplo, para recompactar todo o sistema de arquivos com <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=zstd">zstd</a></span>, execute o seguinte comando:
</p>
<pre># btrfs filesystem defragment -r -v -czstd /
</pre>
<p>Para habilitar a compactação ao instalar o Arch em uma partição Btrfs vazia, use a opção <code>compress</code> quando <a href="../pt/File_systems.html#Montar_um_sistema_de_arquivos" class="mw-redirect" title="Monta">montar</a> o sistema de arquivos: <code>mount -o compress=zstd /dev/sd<i>xY</i> /mnt/</code>. Durante a configuração, adicione <code>compress=zstd</code> para as opções de montagem do sistema de arquivos raiz no <a href="../pt/Fstab.html" title="Fstab (Português)">fstab</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> A compactação também pode ser habilitada por arquivo sem usar a opção de montagem <code>compress</code>; para isso, aplique <code>chattr +c</code> ao arquivo. Quando aplicado a diretórios, fará com que novos arquivos sejam automaticamente compactados à medida que forem chegando.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> 
<ul>
<li>Sistemas usando kernels mais antigos ou <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=btrfs-progs">btrfs-progs</a></span> sem suporte a<code>zstd</code> podem não conseguir ler ou reparar seu sistema de arquivos se você usar esta opção.</li>
<li>
<a href="../pt/GRUB.html" title="GRUB (Português)">GRUB</a> introduziu suporte a <i>zstd</i> na versão 2.04. Certifique-se de atualizar o gerenciador de boot instalado em seu MBR/ESP desde então, executando <code>grub-install</code> com as opções apropriadas para a configuração de BIOS/UEFI, pois isso não é feito automaticamente. Veja <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/63235">FS#63235</a>.</li>
</ul>
</div>
<h4>
<span id="Visualizar_tipos_e_propor.C3.A7.C3.B5es_de_compacta.C3.A7.C3.A3o"></span><span class="mw-headline" id="Visualizar_tipos_e_proporções_de_compactação">Visualizar tipos e proporções de compactação</span>
</h4>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=compsize">compsize</a></span> obtém uma lista de arquivos (ou um sistema de arquivos btrfs inteiro) e mede os tipos de compactação usados e as taxas de compactação efetivas. O tamanho descompactado pode não corresponder ao número fornecido por outros programas, como <span class="plainlinks archwiki-template-man" title="$ man 1 du"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/du.1">du(1)</a></span>, porque cada extensão é contada uma vez, mesmo que seja revinculada várias vezes, e mesmo que parte dela não seja mais usada em nenhum lugar, mas não tenha sido coletada como lixo. A opção <code>-x</code> o mantém em um único sistema de arquivos, o que é útil em situações como <code>compsize -x /</code> para evitar que ele tente procurar em subdiretórios não-btrfs e falhe em toda a execução.
</p>
<h3><span class="mw-headline" id="Subvolumes">Subvolumes</span></h3>
<p>"Um subvolume btrfs não é um dispositivo de bloco (e não pode ser tratado como um), em vez disso, um subvolume btrfs pode ser pensado como um espaço para nome do arquivo POSIX. Este espaço para nome pode ser acessado através do subvolume de nível superior do sistema de arquivos, ou pode ser montado por si próprio." <a rel="nofollow" class="external autonumber" href="https://btrfs.wiki.kernel.org/index.php/SysadminGuide#Subvolumes">[6]</a>
</p>
<p>Cada sistema de arquivos Btrfs possui um subvolume de nível superior com o ID 5. Ele pode ser montado como <code>/</code> (por padrão), ou outro subvolume pode ser <a href="#Listando_subvolumes">mountado</a>. Os subvolumes podem ser movimentados no sistema de arquivos e são mais identificados pelo ID do que pelo caminho.
</p>
<p>Consulte os seguintes links para obter mais detalhes:
</p>
<ul>
<li><a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/SysadminGuide#Subvolumes">Btrfs Wiki SysadminGuide#Subvolumes</a></li>
<li><a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Getting_started#Basic_Filesystem_Commands">Btrfs Wiki Getting started#Basic Filesystem Commands</a></li>
<li><a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Trees">Btrfs Wiki Trees</a></li>
</ul>
<h4><span class="mw-headline" id="Criando_um_subvolume">Criando um subvolume</span></h4>
<p>Para criar um subvolume:
</p>
<pre># btrfs subvolume create <i>/caminho/para/subvolume</i>
</pre>
<h4><span class="mw-headline" id="Listando_subvolumes">Listando subvolumes</span></h4>
<p>Para ver uma lista dos subvolumes atuais e seus IDs em <code><i>caminho</i></code>:
</p>
<pre># btrfs subvolume list -p <i>caminho</i>
</pre>
<h4><span class="mw-headline" id="Excluindo_um_subvolume">Excluindo um subvolume</span></h4>
<p>Para excluir um subvolume:
</p>
<pre># btrfs subvolume delete <i>/caminho/para/subvolume</i>
</pre>
<p>Desde o Linux 4.18, também é possível excluir um subvolume como um diretório regular (<code>rm -r</code>, <code>rmdir</code>).
</p>
<h4><span class="mw-headline" id="Montando_subvolumes">Montando subvolumes</span></h4>
<p>Os subvolumes podem ser montados como partições do sistema de arquivos usando a opção de montagem <code>subvol=<i>/caminho/para/subvolume</i></code> ou <code>subvolid=<i>id-do-objeto</i></code>. Por exemplo, você pode ter um subvolume chamado <code>subvol_root</code> e montá-lo como <code>/</code>. Pode-se imitar partições tradicionais do sistema de arquivos criando vários subvolumes no nível superior do sistema de arquivos e, em seguida, montando-os nos pontos de montagem apropriados. É preferível montar usando <code>subvol=<i>/caminho/para/subvolume</i></code>, em vez do subvolid, pois o subvolid pode mudar ao restaurar <a href="#Snapshots">#Snapshots</a>, exigindo uma mudança de configuração de montagem.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Dica:</strong> A alteração dos layouts de subvolume é simplificada ao não usar o subvolume de nível superior (ID=5) como <code>/</code> (o que é feito por padrão). Em vez disso, considere criar um subvolume para abrigar seus dados reais e montá-lo como <code>/</code>.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> De <span class="plainlinks archwiki-template-man" title="$ man 5 btrfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/btrfs.5#MOUNT_OPTIONS">btrfs(5) § MOUNT OPTIONS</a></span>:
<dl><dd>A maioria das opções de montagem se aplicam ao <b>sistema de arquivos inteiro</b>, e somente as opções para o primeiro subvolume a ser montado terão efeito. Isso ocorre devido à falta de implementação e pode mudar no futuro.</dd></dl>
<p>Veja o <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/FAQ#Can_I_mount_subvolumes_with_different_mount_options.3F">FAQ da Wiki do Btrfs</a> para quais opções de montagem podem ser usadas por subvolume.
</p>
</div>
<p>Veja <a href="../pt/Snapper.html#Layout_do_sistema_de_arquivos_sugerido" title="Snapper (Português)">Snapper#Layout do sistema de arquivos sugerido</a>, <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/SysadminGuide#Managing_Snapshots">Btrfs SysadminGuide#Managing Snapshots</a> e <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/SysadminGuide#Layout">Btrfs SysadminGuide#Layout</a> para obter exemplos de layouts de sistema de arquivos usando subvolumes.
</p>
<p>Veja <span class="plainlinks archwiki-template-man" title="$ man 5 btrfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/btrfs.5">btrfs(5)</a></span> para obter uma lista completa das opções de montagem específicas do btrfs.
</p>
<h4><span class="mw-headline" id="Montando_o_subvolume_como_root">Montando o subvolume como root</span></h4>
<p>Para usar um subvolume como o ponto de montagem raiz, especifique o subvolume por meio de um <a href="../pt/Kernel_parameters.html" class="mw-redirect" title="Parâmetro do kernel">parâmetro do kernel</a> usando <code>rootflags=subvol=<i>/caminho/para/subvolume</i></code>. Edite o ponto de montagem raiz em <code>/etc/fstab</code> e especifique a opção de montagem <code>subvol=</code>. Alternativamente, o subvolume pode ser especificado com seu ID, <code>rootflags=subvolid=<i>id-do-objeto</i></code> como parâmetro do kernel e <code>subvolid=<i>id-do-objeto</i></code> como opção de montagem em <code>/etc/fstab</code>. É preferível montar usando <code>subvol=<i>/caminho/para/subvolume</i></code>, em vez do subvolid, pois o subvolid pode mudar ao restaurar <a href="#Snapshots">#Snapshots</a>, exigindo uma mudança na configuração de montagem, ou então o sistema não inicializará.
</p>
<h4>
<span id="Alterando_o_subvolume_padr.C3.A3o"></span><span class="mw-headline" id="Alterando_o_subvolume_padrão">Alterando o subvolume padrão</span>
</h4>
<p>O subvolume padrão é montado se não houver <code>subvol=</code> opção de montagem é fornecida. Para alterar o subvolume padrão, faça:
</p>
<pre># btrfs subvolume set-default <i>id-do-subvolume</i> /
</pre>
<p>onde <i>id-do-subvolume</i> pode ser encontrado por <a href="#Listando_subvolumes">listando</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Após alterar o subvolume padrão em um sistema com <a href="../pt/GRUB.html" title="GRUB (Português)">GRUB</a>, você deveria executar <code>grub-install</code> novamente para notificar o carregador de inicialização sobre as alterações. Veja <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1615373">este tópico do fórum</a>.</div>
<p>Alterando o subvolume padrão com <code>btrfs subvolume set-default</code> tornará o nível superior do sistema de arquivos inacessível, exceto pelo uso das opções de montagem <code>subvol=/</code> ou <code>subvolid=5</code> <a rel="nofollow" class="external autonumber" href="https://btrfs.wiki.kernel.org/index.php/SysadminGuide">[7]</a>.
</p>
<h3><span class="mw-headline" id="Quota">Quota</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> O Qgroup ainda não está estável e a combinação de quota com (muitos) snapshots de subvolumes pode causar problemas de desempenho, por exemplo, ao excluir snapshots. Além disso, existem vários outros <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Quota_support#Known_issues">problemas conhecidos</a>.</div>
<p>O suporte a quota no Btrfs é implementado em um nível de subvolume pelo uso de grupos de quota ou qgroup: a cada subvolume é atribuído um grupo de quota na forma de <i> 0 / subvolume_id </i> por padrão. No entanto, é possível criar um grupo de cotas usando qualquer número, se desejado.
</p>
<p>Para usar qgroups, você precisa habilitar o quota primeiro usando
</p>
<pre># btrfs quota enable <i>caminho</i>
</pre>
<p>A partir deste ponto, os subvolumes recém-criados serão controlados por esses grupos.
Para habilitá-los retrospectivamente para subvolumes já existentes, ative o quota normalmente, crie um qgroup (grupo de quota) para cada um desses subvolumes usando seu <i> subvolume_id </i> e redigitalize-os:
</p>
<pre># btrfs subvolume list <i>caminho</i> | cut -d' ' -f2 | xargs -I{} -n1 btrfs qgroup create 0/{} <i>caminho</i>
# btrfs quota rescan <i>caminho</i>
</pre>
<p>Grupos de quota no Btrfs formam uma hierarquia de árvore, na qual qgroups são anexados a subvolumes. Os limites de tamanho são definidos por qgroup e se aplicam quando qualquer limite é atingido na árvore que contém um determinado subvolume.
</p>
<p>Os limites dos grupos de quota podem ser aplicados ao uso total de dados, uso não compartilhado de dados, uso de dados compactados ou ambos. A cópia e a exclusão de arquivos podem afetar os limites, pois o limite não compartilhado de outro qgroup pode mudar se os arquivos do volume original forem excluídos e apenas uma cópia restar. Por exemplo, um snapshot novo compartilha quase todos os blocos com o subvolume original; as novas gravações em um subvolume aumentam em direção ao limite exclusivo; as exclusões de dados comuns em um volume aumentam em direção ao limite exclusivo no outro.
</p>
<p>Para aplicar um limite a um qgroup, use o comando <code>btrfs qgroup limit</code>. Dependendo do seu uso, use um limite total, um limite não compartilhado (<code>-e</code>) ou limite compactadot (<code>-c</code>). Para mostrar o uso e os limites de um determinado caminho em um sistema de arquivos, use
</p>
<pre># btrfs qgroup show -reF <i>caminho</i>
</pre>
<h3>
<span id="Intervalo_de_confirma.C3.A7.C3.A3o"></span><span class="mw-headline" id="Intervalo_de_confirmação">Intervalo de confirmação</span>
</h3>
<p>A resolução na qual os dados são gravados no sistema de arquivos é ditada pelo próprio Btrfs e pelas configurações de todo o sistema. O padrão do Btrfs é um intervalo de ponto de verificação de 30 segundos no qual novos dados são confirmados no sistema de arquivos. Isso pode ser alterado anexando a opção de montagem <code>commit</code> em <code>/etc/fstab</code> para a partição btrfs.
</p>
<pre>LABEL=arch64 / btrfs defaults,noatime,compress=zstd,commit=120 0 0
</pre>
<p>As configurações de todo o sistema também afetam os intervalos de confirmação. Eles incluem os arquivos em <code>/proc/sys/vm/*</code> e estão fora do escopo deste artigo da wiki. A documentação do kernel para eles está disponível em <a rel="nofollow" class="external free" href="https://docs.kernel.org/admin-guide/sysctl/vm.html">https://docs.kernel.org/admin-guide/sysctl/vm.html</a>.
</p>
<h3><span class="mw-headline" id="TRIM_do_SSD">TRIM do SSD</span></h3>
<p>Um sistema de arquivos Btrfs pode liberar blocos não utilizados de uma unidade SSD que suporta o comando TRIM. A partir da versão 5.6 do kernel, há suporte a descarte assíncrono, ativado com a opção mount <code>discard=async</code>. As extensões liberadas não são descartadas imediatamente, mas agrupadas e aparadas posteriormente por um thread de trabalho separado, melhorando a latência de consolidação.
</p>
<p>Mais informações sobre como ativar e usar o TRIM podem ser encontradas em <a href="../en/Solid_state_drive.html#TRIM" class="mw-redirect" title="Solid State Drives">Solid State Drives#TRIM</a>.
</p>
<h2><span class="mw-headline" id="Uso">Uso</span></h2>
<h3><span class="mw-headline" id="Arquivo_swap">Arquivo swap</span></h3>
<p><a href="../pt/Swap.html#Arquivo_swap" class="mw-redirect" title="Arquivo swap">Arquivos swap</a> no Btrfs são suportados desde o kernel Linux 5.0 <a rel="nofollow" class="external autonumber" href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=ed46ff3d423780fa5173b38a844bf0fdb210a2a7">[8]</a>. A maneira correta de inicializar um swap file é primeiro criar um subvolume do qual não se tenha snapshots para hospedar o arquivo e, em seguida, denifir o atributo <code>No_COW</code> em todo o diretório com <a href="../pt/File_permissions_and_attributes.html#Atributos_de_arquivos" class="mw-redirect" title="Atributos de arquivo">chattr</a>.
</p>
<pre># chattr +C <i>/caminho/para/subvolume_do_swap</i>
</pre>
<p>A partir de agora qualquer novo arquivo criado dentro do subvolume do swap terá o atributo <code>No_COW</code> definido.
</p>
<p>Continue com as etapas em <a href="../pt/Swap.html#Cria%C3%A7%C3%A3o_de_arquivo_swap" class="mw-redirect" title="Arquivo swap">Arquivo swap#Criação de arquivo swap</a>. A configuração da hibernação para um arquivo swap é descrita em <a href="../pt/Power_management/Suspend_and_hibernate.html#Hiberna%C3%A7%C3%A3o" class="mw-redirect" title="Hibernação">Hibernação</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Desde o kernel Linux 5.0, o Btrfs possui suporte nativo ao swap file com algumas limitações:
<ul>
<li>O arquivo swap não pode estar em um subvolume de snapshot. O procedimento adequado é criar um novo subvolume para colocar o arquivo swap.</li>
<li>Ele não suporta arquivos swap em sistemas de arquivos que abrangem vários dispositivos. Veja <span class="plainlinks archwiki-template-man" title="$ man 5 btrfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/btrfs.5#SWAPFILE_SUPPORT">btrfs(5) § SWAPFILE SUPPORT</a></span> e <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1849371#p1849371">discussão nos fóruns do Arch</a>.</li>
</ul>
</div>
<h3>
<span id="Exibindo_espa.C3.A7o_usado.2Flivre"></span><span class="mw-headline" id="Exibindo_espaço_usado/livre">Exibindo espaço usado/livre</span>
</h3>
<p>Ferramentas gerais de espaço de usuário linux, como <span class="plainlinks archwiki-template-man" title="$ man 1 df"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/df.1">df(1)</a></span> relatam imprecisamente o espaço livre em uma partição Btrfs. É recomendado usar <code>btrfs filesystem usage</code> para consultar partições Btrfs. Por exemplo, para um detalhamento completo da alocação de dispositivos e estatísticas de uso:
</p>
<pre># btrfs filesystem usage /
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> O comando <code>btrfs filesystem usage</code> atualmente não funciona corretamente com os níveis de RAID <code>RAID5/RAID6</code>.</div>
<p>Alternativamente, <code>btrfs filesystem df</code> permite uma verificação rápida do uso do espaço alocado sem a necessidade de executar como root:
</p>
<p><br>	
</p>
<pre>$ btrfs filesystem df /
</pre>
<p>Veja <a rel="nofollow" class="external autonumber" href="https://btrfs.wiki.kernel.org/index.php/FAQ#How_much_free_space_do_I_have.3F">[9]</a> para mais informações.
</p>
<p>As mesmas limitações se aplicam a ferramentas que analisam o uso de espaço para algum subconjunto do sistema de arquivos, como <span class="plainlinks archwiki-template-man" title="$ man 1 du"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/du.1">du(1)</a></span> ou <span class="plainlinks archwiki-template-man" title="$ man 1 ncdu"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ncdu.1">ncdu(1)</a></span>, pois não levam em consideração reflinks, snapshots e compressão. Em vez disso, veja <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/btdu/">btdu</a></span><sup><small>AUR</small></sup> e <a href="#Visualizar_tipos_e_propor%C3%A7%C3%B5es_de_compacta%C3%A7%C3%A3o">compsize</a> para alternativas compatíveis com Btrfs.
</p>
<h3>
<span id="Desfragmenta.C3.A7.C3.A3o"></span><span class="mw-headline" id="Desfragmentação">Desfragmentação</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong>  Uma grande regressão no kernel Linux versão 5.16.x &lt; 5.16.5 faz com que a desfragmentação Btrfs faça um loop infinito em alguns sistemas, afetando tanto a desfragmentação manual quanto a automática. Isso causa cargas extremas de E/S nas unidades afetadas, o que pode reduzir bastante sua vida útil e afetar seu desempenho. Como tal, não é recomendado usar <code>autodefrag</code> nessas versões, deve-se usar <code>noautodefrag</code> para garantir que a desfragmentação online esteja desabilitada. Veja <a rel="nofollow" class="external autonumber" href="https://www.reddit.com/r/linux/comments/sgybyr/psa_linux_516_has_major_regression_in_btrfs/">[10]</a> e <a rel="nofollow" class="external autonumber" href="https://lore.kernel.org/linux-btrfs/CAEwRaO4y3PPPUdwYjNDoB9m9CLzfd3DFFk2iK1X6OyyEWG5-mg@mail.gmail.com/">[11]</a>.</div>
<p>O Btrfs suporta a desfragmentação online através da opção de montagem <code>autodefrag</code>, veja <span class="plainlinks archwiki-template-man" title="$ man 5 btrfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/btrfs.5#MOUNT_OPTIONS">btrfs(5) § MOUNT OPTIONS</a></span>. Para desfragmentar manualmente sua raiz, use:
</p>
<pre># btrfs filesystem defragment -r /
</pre>
<p>Usar o comando acima sem a opção <code>-r</code> resultará na desfragmentação apenas dos metadados mantidos pelo subvolume que contém o diretório. Isso permite a desfragmentação de um único arquivo simplesmente especificando o caminho.
</p>
<p>Desfragmentar um arquivo que tenha uma cópia COW (uma cópia de snapshot ou uma feita com <code>cp</code> ou bcp) e usar a opção <code>-c</code> com um algoritmo de compactação pode resultar em dois arquivos não relacionados, aumentando efetivamente o uso do disco.
</p>
<h3><span class="mw-headline" id="RAID">RAID</span></h3>
<p>O Btrfs oferece "RAID" nativo para <a href="#Sistema_de_arquivos_com_v%C3%A1rios_dispositivos">#Sistema de arquivos com vários dispositivos</a>. Os recursos notáveis que diferenciam o btrfs RAID do <a href="../pt/RAID.html" title="RAID (Português)">mdadm</a> são arrays redundantes de autorrecuperação e balanceamento online. Veja <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Using_Btrfs_with_Multiple_Devices">a página wiki do Btrfs</a> para obter mais informações. A página sysadmin do Btrfs também <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/SysadminGuide#RAID_and_data_replication">tem uma seção</a> com um pouco mais de conhecimento técnico.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong>  O código de paridade RAID (RAID 5/6) contém vários erros sérios de perda de dados. Veja a página <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/RAID56">RAID5/6</a> da Wiki do Btrfs e um relatório de bug na <a rel="nofollow" class="external text" href="https://lore.kernel.org/linux-btrfs/8695beeb-f991-28c4-cf6b-8c92339e468f@inwind.it/">lista de discussão linux-btrfs</a> para informações mais detalhadas. Em junho de 2020, alguém postou uma <a rel="nofollow" class="external text" href="https://lore.kernel.org/linux-btrfs/20200627030614.GW10769@hungrycats.org/">lista abrangente de problemas atuais</a> e um <a rel="nofollow" class="external text" href="https://lore.kernel.org/linux-btrfs/20200627032414.GX10769@hungrycats.org/">guia de recuperação útil</a>.</div>
<h3><span class="mw-headline" id="Scrub">Scrub</span></h3>
<p>O <a rel="nofollow" class="external text" href="https://btrfs.readthedocs.io/en/latest/Glossary.html">Glossário da Wiki do Btrfs</a> afirma que o Btrfs scrub é "[uma] ferramenta de verificação de sistema de arquivos online. Lê todos os dados e metadados no sistema de arquivos e usa checksums e cópias duplicadas do armazenamento RAID para identificar e reparar quaisquer dados corrompidos".
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Um processo scrub em execução impedirá que o sistema seja suspenso, veja <a rel="nofollow" class="external text" href="https://lore.kernel.org/linux-btrfs/20140227190656.GA28338@merlins.org/">este tópico</a> para obter detalhes.
</div>
<h4><span class="mw-headline" id="Iniciar_manualmente">Iniciar manualmente</span></h4>
<p>Para iniciar uma limpeza (em segundo plano) no sistema de arquivos que contém <code>/</code>:
</p>
<pre># btrfs scrub start /
</pre>
<p>Para verificar o status de uma limpeza em execução:
</p>
<pre># btrfs scrub status /
</pre>
<h4>
<span id="Comece_com_um_servi.C3.A7o_ou_timer"></span><span class="mw-headline" id="Comece_com_um_serviço_ou_timer">Comece com um serviço ou timer</span>
</h4>
<p>O pacote <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=btrfs-progs">btrfs-progs</a></span> traz o unit <code>btrfs-scrub@.timer</code> para executar o scrub mensalmente no ponto de montagem especificado. <a href="../pt/Systemd.html#Usando_units" class="mw-redirect" title="Habilite">Habilite</a> o temporizador com um caminho de escape, por exemplo <code>btrfs-scrub@-.timer</code> para <code>/</code> e <code>btrfs-scrub@home.timer</code> para <code>/home</code>. Você pode usar <code>systemd-escape -p <i>/caminho/para/ponto_de_montagem</i></code> para escapar do caminho (<i>path</i>), veja <span class="plainlinks archwiki-template-man" title="$ man 1 systemd-escape"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-escape.1">systemd-escape(1)</a></span> para detalhes.
</p>
<p>Você também pode executar o scrub <a href="../pt/Systemd.html#Usando_units" class="mw-redirect" title="Inicia">iniciando</a> <code>btrfs-scrub@.service</code> (com o mesmo caminho codificado). A vantagem disso sobre <code>btrfs scrub</code> (como usuário root) é que os resultados do scrub serão registrados no <a href="../pt/Systemd/Journal.html" class="mw-redirect" title="Journal do systemd">journal do systemd</a>.
</p>
<p>Em unidades NVMe grandes com resfriamento insuficiente (por exemplo, em um laptop), a execução do scrub pode ler a unidade com rapidez e tempo suficientes para deixá-la muito quente. Se estiver executando scrubs com systemd, você pode facilmente limitar a taxa de <i>scrubbing</i> com a opção <code>IOReadBandwidthMax</code> descrita em <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.resource-control"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.resource-control.5">systemd.resource-control(5)</a></span> usando um <a href="../pt/Systemd.html#Arquivos_drop-in" title="Systemd (Português)">arquivo drop-in</a>.
</p>
<h3><span class="mw-headline" id="Balance">Balance</span></h3>
<p>"O balance passa todos os dados no sistema de arquivos pelo alocador novamente. Destina-se principalmente a reequilibrar os dados no sistema de arquivos entre os dispositivos quando um dispositivo é adicionado ou removido. O balance regenerará cópias ausentes dos níveis redundantes de RAID, se um dispositivo falhou."<a rel="nofollow" class="external autonumber" href="https://btrfs.readthedocs.io/en/latest/Glossary.html">[12]</a> Veja a <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/FAQ#What_does_.22balance.22_do.3F">página FAQ</a>.
</p>
<p>Em um sistema de arquivos de dispositivo único, o balance também pode ser útil para (temporariamente) reduzir a quantidade de blocos de dados alocados, mas não utilizados (meta). Às vezes, isso é necessário para corrigir <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/FAQ#Help.21_Btrfs_claims_I.27m_out_of_space.2C_but_it_looks_like_I_should_have_lots_left.21">problemas "filesystem full"</a>.
</p>
<pre># btrfs balance start --bg /
# btrfs balance status /
</pre>
<h3><span class="mw-headline" id="Snapshots">Snapshots</span></h3>
<p>"Um snapshot é simplesmente um subvolume que compartilha seus dados (e metadados) com outros subvolumes, usando os recursos btrfs COW ". Veja o <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/SysadminGuide#Snapshots">SysadminGuide#Snapshots da Wiki do Btrfs</a> para detalhes.
</p>
<p>Para criar um snapshot:
</p>
<pre># btrfs subvolume snapshot <i>fonte</i> [<i>destino</i>/]<i>nome</i>
</pre>
<p>Para criar um snapshot somente leitura, adicione a opção <code>-r</code>. Para criar uma versão modificável de um snapshot somente leitura, basta criar um snapshot dele.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> 
<ul>
<li>É possível que um snapshot seja convertido no local de somente leitura (<i>read-only</i>) para gravável (<i>writable</i>). No entanto, isso não é recomendado porque <a rel="nofollow" class="external text" href="https://lore.kernel.org/linux-btrfs/06e92a0b-e71b-eb21-edb5-9d2a5513b718@gmail.com/">causa problemas</a> com qualquer envio/recebimento incremental futuro. Criar um novo instantâneo gravável evita esses problemas.</li>
<li>Os snapshots não são recursivos. Cada subvolume aninhado será um diretório vazio dentro do snapshot.</li>
</ul>
</div>
<h3>
<span id="Enviar.2Freceber"></span><span class="mw-headline" id="Enviar/receber">Enviar/receber</span>
</h3>
<p>Um subvolume pode ser enviado para stdout ou um arquivo usando o comando <code>send</code>. Isso geralmente é mais útil quando direcionado para o comando do Btrfs <code>receive</code>. Por exemplo, para enviar um snapshot chamado <code>/backup_da_raiz</code> (talvez de um snapshot que você fez do <code>/</code> mais cedo) para <code>/backup</code>, você faria o seguinte:
</p>
<pre># btrfs send /backup_da_raiz | btrfs receive /backup
</pre>
<p>O snapshot enviado <i>deve</i> ser somente leitura. O comando acima é útil para copiar um subvolume para um dispositivo externo (por exemplo, um dispositivo USB montado em <code>/backup</code>).
</p>
<p>Você também pode enviar apenas a diferença entre dois snapshots. Por exemplo, se você já enviou uma cópia do <code>backup_da_raiz</code> acima e fez um novo snapshot somente leitura em seu sistema chamado <code>novo_backup_da_raiz</code>, então, para enviar apenas a diferença incremental para <code>/backup</code>, faça:
</p>
<pre># btrfs send -p /backup_da_raiz /novo_backup_da_raiz | btrfs receive /backup
</pre>
<p>Agora, um novo subvolume chamado <code>novo_backup_da_raiz</code> estará presente em <code>/backup</code>.
</p>
<p>Veja a <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Incremental_Backup">página da Wiki do Btrfs sobre backup incremental</a> e <a href="#Backup_incremental_para_unidade_externa">#Backup incremental para unidade externa</a> para saber como usá-lo e para ferramentas que automatizam o processo.
</p>
<h3>
<span id="Desduplica.C3.A7.C3.A3o"></span><span class="mw-headline" id="Desduplicação">Desduplicação</span>
</h3>
<p>Usando copy-on-write, O Btrfs pode copiar arquivos ou subvolumes inteiros sem copiar os dados. No entanto, sempre que um arquivo é alterado, uma nova cópia <i> adequada </i> é criada. A desduplicação leva isso um passo adiante, identificando ativamente blocos de dados que compartilham seqüências comuns e combinando-os em uma extensão com a mesma semântica copy-on-write.
</p>
<p>As ferramentas dedicadas para desduplicar uma partição formatada em Btrfs incluem <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=duperemove">duperemove</a></span> e <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bees">bees</a></span>. Pode-se também querer apenas desduplicar dados em um nível baseado em arquivo, em vez de usar, por exemplo, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=rmlint">rmlint</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/jdupes/">jdupes</a></span><sup><small>AUR</small></sup> ou <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dduper-git/">dduper-git</a></span><sup><small>AUR</small></sup>. Para uma visão geral dos recursos disponíveis desses programas e informações adicionais, consulte essa <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Deduplication#Batch">página da Wiki</a>.
</p>
<p>Além disso, os desenvolvedores do Btrfs estão trabalhando na desduplicação inband (também conhecida como síncrona ou inline), o que significa que a desduplicação é feita ao gravar novos dados no sistema de arquivos. Atualmente, ainda é um experimento desenvolvido fora da árvore. Usuários dispostos a testar o novo recurso devem ler a <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/User_notes_on_dedupe">página apropriada da wiki do kernel</a>.
</p>
<h3><span class="mw-headline" id="Redimensionando">Redimensionando</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> Para evitar perda de dados, certifique-se de fazer backup de seus dados antes de iniciar qualquer tarefa de redimensionamento.</div>
<p>Você pode aumentar um sistema de arquivos até o espaço máximo disponível no dispositivo ou especificar um tamanho exato. Certifique-se de aumentar o tamanho do dispositivo ou volume lógico antes de tentar aumentar o tamanho do sistema de arquivos. Ao especificar um tamanho exato para o sistema de arquivos, tanto aumentando-o quanto diminuindo-o, certifique-se de que o novo tamanho atenda às seguintes condições:
</p>
<ul>
<li>O novo tamanho deve ser maior que o tamanho dos dados existentes; caso contrário, ocorrerá perda de dados.</li>
<li>O novo tamanho deve ser igual ou menor que o tamanho do dispositivo atual porque o tamanho do sistema de arquivos não pode se estender além do espaço disponível.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Se você planeja também diminuir o tamanho do volume lógico que contém o sistema de arquivos, certifique-se de diminuir o tamanho do sistema de arquivos antes de tentar diminuir o tamanho do dispositivo ou volume lógico.</div>
<p>Para estender o tamanho do sistema de arquivos para o tamanho máximo disponível do dispositivo:
</p>
<pre># btrfs filesystem resize max /
</pre>
<p>Para estender o sistema de arquivos para um tamanho específico:
</p>
<pre># btrfs filesystem resize <i>tamanho</i> /
</pre>
<p>Substitua <code><i>tamanho</i></code> pelo tamanho desejado em bytes. Você também pode especificar unidades no valor, como K (kibibytes), M (mebibytes) ou G (gibibytes). Alternativamente, você pode especificar um aumento ou diminuição do tamanho atual prefixando o valor com um sinal de mais (+) ou menos (-), respectivamente:
</p>
<h2><span class="mw-headline" id="Problemas_conhecidos">Problemas conhecidos</span></h2>
<p>Algumas limitações devem ser conhecidas antes de tentar.
</p>
<h3><span class="mw-headline" id="Criptografia">Criptografia</span></h3>
<p>O Btrfs não tem suporte nativo à criptografia, mas <a rel="nofollow" class="external text" href="https://lwn.net/Articles/700487/">pode</a> ter no futuro. Os usuários podem criptografar a partição antes de executar <code>mkfs.btrfs</code>. Veja <a href="../pt/Dm-crypt/Encrypting_an_entire_system.html#Subvolumes_do_Btrfs_com_swap" class="mw-redirect" title="Dm-crypt/Criptografando todo um sistema">dm-crypt/Criptografando todo um sistema#Subvolumes do Btrfs com swap</a>.
</p>
<p>Os sistemas de arquivos Btrfs existentes podem usar algo como <a href="../en/EncFS.html" title="EncFS">EncFS</a> ou <a href="../en/VeraCrypt.html" class="mw-redirect" title="TrueCrypt">TrueCrypt</a>, embora talvez sem alguns dos recursos do Btrfs.
</p>
<h3>
<span id="Problemas_de_verifica.C3.A7.C3.A3o_do_btrfs"></span><span class="mw-headline" id="Problemas_de_verificação_do_btrfs">Problemas de verificação do btrfs</span>
</h3>
<p>A ferramenta <code>btrfs check</code> possui problemas conhecidos e não deve ser executada sem leitura adicional, consulte a seção <a href="#btrfs_check">#btrfs check</a>.
</p>
<h2><span class="mw-headline" id="Dicas_e_truques">Dicas e truques</span></h2>
<h3>
<span id="Disco_Btrfs_sem_parti.C3.A7.C3.B5es"></span><span class="mw-headline" id="Disco_Btrfs_sem_partições">Disco Btrfs sem partições</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> A maioria dos usuários não deseja esse tipo de configuração e, em vez disso, deve instalar o Btrfs em uma partição normal. Além disso, o GRUB desencoraja fortemente a instalação em um disco sem partição.</div>
<p>O Btrfs pode ocupar um dispositivo de armazenamento de dados inteiro, substituindo os esquemas de particionamento <a href="../pt/Partitioning.html#Master_Boot_Record" class="mw-redirect" title="MBR (Português)">MBR</a> ou <a href="../pt/Partitioning.html#Tabela_de_Parti%C3%A7%C3%A3o_GUID" class="mw-redirect" title="GPT (Português)">GPT</a>, usando <a href="#Subvolumes">subvolumes</a> para simular partições. No entanto, não é necessário usar uma configuração sem partição para simplesmente <a href="#Cria%C3%A7%C3%A3o_do_sistema_de_arquivos">criar um sistema de arquivos Btrfs</a> em uma <a href="../pt/Partitioning.html" class="mw-redirect" title="Partição">partição</a> existente que foi criada usando outro método. Existem algumas limitações nas configurações de disco único sem partição:
</p>
<ul>
<li>Não é possível colocar outros <a href="../pt/File_systems.html" class="mw-redirect" title="Sistemas de arquivos">sistemas de arquivos</a> em outra partição no mesmo disco.</li>
<li>Devido ao ponto anterior, não é possível ter uma <a href="../pt/EFI_system_partition.html" class="mw-redirect" title="ESP (Português)">ESP</a> neste disco. Outro dispositivo é necessário para a inicialização do <a href="../en/Unified_Extensible_Firmware_Interface.html" class="mw-redirect" title="UEFI">UEFI</a>.</li>
<li>Se estiver usando uma versão do kernel Linux anterior a 5.0, você não pode usar <a href="../pt/Swap.html" class="mw-redirect" title="Espaço swap">espaço swap</a> porque o Btrfs não suportava <a href="../pt/Swap.html#Arquivo_swap" class="mw-redirect" title="Arquivo swap">arquivos swap</a> pré-5.0 e não há lugar para criar <a href="../pt/Swap.html#Parti%C3%A7%C3%A3o_swap" title="Swap (Português)">partição swap</a>
</li>
</ul>
<p>Para substituir a tabela de partição existente com Btrfs, execute o seguinte comando:
</p>
<pre># mkfs.btrfs /dev/sd<i>X</i>
</pre>
<p>Por exemplo, use <code>/dev/sda</code> ao invés de <code>/dev/sda1</code>. O último formata uma partição existente em vez de substituir todo o esquema de particões. Como a partição raiz está em Btrfs, verifique se <code>btrfs</code> é compilado no kernel, ou coloque <code>btrfs</code> dentro do <a href="../pt/Mkinitcpio.html#MODULES" title="Mkinitcpio (Português)">arranjo MODULES do mkinitcpio</a> e <a href="../pt/Mkinitcpio.html#Cria%C3%A7%C3%A3o_e_ativa%C3%A7%C3%A3o_de_imagem" class="mw-redirect" title="Gere novamente o initramfs">gere novamente o initramfs</a>.
</p>
<p>Instale o <a href="../pt/Arch_boot_process.html#Gerenciador_de_boot" class="mw-redirect" title="Gerenciador de boot">gerenciador de boot</a> como você faria para um dispositivo de armazenamento de dados com <a href="../pt/Partitioning.html#Master_Boot_Record" class="mw-redirect" title="MBR (Português)">Master Boot Record</a>. Veja <a href="../en/Syslinux.html#Manually" title="Syslinux">Syslinux#Manually</a> ou <a href="../en/GRUB/Tips_and_tricks.html#Install_to_partition_or_partitionless_disk" title="GRUB/Tips and tricks">GRUB/Tips and tricks#Install to partition or partitionless disk</a>. Se o seu kernel não inicializar devido a <code>Failed to mount /sysroot.</code>, por favor adicione <code>GRUB_PRELOAD_MODULES="btrfs"</code> em <code>/etc/default/grub</code> e gere a configuração do grub (<a href="../pt/GRUB.html#Gerar_o_arquivo_de_configura%C3%A7%C3%A3o_principal" title="GRUB (Português)">GRUB#Gerar o arquivo de configuração principal</a>).
</p>
<h3>
<span id="Convers.C3.A3o_de_Ext3.2F4_para_Btrfs"></span><span class="mw-headline" id="Conversão_de_Ext3/4_para_Btrfs">Conversão de Ext3/4 para Btrfs</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> Existem muitos relatórios na lista de discussão btrfs sobre conversões incompletas, corrompidas ou quebradas. Certifique-se de ter backups <i>funcionando</i> de todos os dados que você não pode perder. Veja <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Conversion_from_Ext3">Conversão de Ext3</a> na wiki do Btrfs para mais informações.
</div>
<p>Inicialize a partir de um CD de instalação e converta fazendo:
</p>
<pre># btrfs-convert /dev/<i>partição</i>
</pre>
<p>Monte a partição e teste a conversão verificando os arquivos. Certifique-se de alterar o <code>/etc/fstab</code> para refletir a alteração (em <b>type</b> altere para <code>btrfs</code> e em<b>pass</b> [o último campo] altere para <code>0</code>, pois o Btrfs não faz uma verificação do sistema de arquivos na inicialização). Observe também que o UUID da partição será alterado, portanto, atualize o fstab de acordo ao usar UUIDs. Entre no sistema atráves do <code>chroot</code> e reconstrua sua lista de menus de bootloaders (veja <a href="../pt/Install_Arch_Linux_from_existing_Linux.html" class="mw-redirect" title="Instalar a partir de um Linux existente">Instalar a partir de um Linux existente</a>). Se estiver convertendo um sistema de arquivos raiz, enquanto ainda estiver em chroot, execute <code>mkinitcpio -p linux</code> para regenerar o initramfs ou o sistema não inicializará com sucesso.
</p>
<p>Depois de confirmar que não há problemas, conclua a conversão excluindo o subvolume de backup <code>ext2_saved</code>. Observe que você não pode reverter para ext3/4 sem ele.
</p>
<pre># btrfs subvolume delete /ext2_saved
</pre>
<p>Finalmente <a href="#Balance">equilibre</a> o sistema de arquivos para recuperar o espaço.
</p>
<p>Lembre-se que alguns aplicativos que foram instalados anteriormente precisam ser adaptados ao Btrfs.
</p>
<h3>
<span id="Acelera.C3.A7.C3.A3o_do_hardware_do_checksum"></span><span class="mw-headline" id="Aceleração_do_hardware_do_checksum">Aceleração do hardware do checksum</span>
</h3>
<p>O CRC32 é uma nova instrução no Intel SSE4.2. Para verificar se a soma de verificação (<i>checksum</i>) do Btrfs é acelerada por hardware:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># dmesg | grep crc32c</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Btrfs loaded, crc32c=crc32c-intel</pre>
<p>Se você ver <code>crc32c=crc32c-generic</code>, provavelmente é porque sua partição raiz é Btrfs, e você terá que compilar <code>crc32c-intel</code> no kernel para fazê-lo funcionar. Colocar <code>crc32c-intel</code> em <a href="../pt/Mkinitcpio.html" title="Mkinitcpio (Português)">mkinitcpio.conf</a> <i>não</i> funciona.
</p>
<h3>
<span id="Recupera.C3.A7.C3.A3o_de_corrup.C3.A7.C3.A3o"></span><span class="mw-headline" id="Recuperação_de_corrupção">Recuperação de corrupção</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> A ferramenta <code>btrfs check</code> tem problemas conhecidos, consulte a seção <a href="#btrfs_check">#btrfs check</a>
</div>
<p><i>btrfs-check</i> não pode ser usado em um sistema de arquivos montado. Para poder usar o <i> btrfs-check</i> sem inicializar a partir de um USB ativo, adicione-o ao ramdisk inicial:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">BINARIES=(btrfs)</pre>
<p><a href="../pt/Mkinitcpio.html#Cria%C3%A7%C3%A3o_e_ativa%C3%A7%C3%A3o_de_imagem" class="mw-redirect" title="Gere novamente o initramfs">Gere novamente o initramfs</a>.
</p>
<p>Então, se houver um problema na inicialização, o utilitário estará disponível para reparo.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Se o processo fsck tiver que invalidar o cache de espaço (e/ou outros caches?) então é normal que uma inicialização subsequente seja interrompida por um tempo (isso pode gerar mensagens do console sobre a interrupção da transação btrfs). O sistema deve se recuperar disso depois de um tempo.</div>
<p>Veja a <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Btrfsck">página da Wiki do Btrfs</a> para mais informações.
</p>
<h3><span class="mw-headline" id="Inicializando_em_snapshots">Inicializando em snapshots</span></h3>
<p>Para inicializar em um snapshot, o mesmo procedimento se aplica para montar um subvolume como sua partição raiz, conforme fornecido na seção [[#Montando o subvolume como root|]], porque os snapshots podem ser montados como subvolumes.
</p>
<ul>
<li>Se estiver usando o <a href="../pt/GRUB.html" title="GRUB (Português)">GRUB</a>, você poderá preencher automaticamente seu menu de inicialização com os snapshots do Btrfs ao regenerar o arquivo de configuração com a ajuda do <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub-btrfs">grub-btrfs</a></span> ou <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/grub-btrfs-git/">grub-btrfs-git</a></span><sup><small>AUR</small></sup>.</li>
<li>Se estiver usando <a href="../en/REFInd.html" title="REFInd">rEFInd</a> você pode preencher automaticamente seu menu de inicialização com snapshots do Btrfs com a ajuda de <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/refind-btrfs/">refind-btrfs</a></span><sup><small>AUR</small></sup>, depois de <a href="../pt/Systemd.html#Usando_units" class="mw-redirect" title="Habilitar">habilitar</a> <code>refind-btrfs.service</code>.</li>
</ul>
<h3><span class="mw-headline" id="Use_subvolumes_Btrfs_com_systemd-nspawn">Use subvolumes Btrfs com systemd-nspawn</span></h3>
<p>Consulte os artigos <a href="../en/Systemd-nspawn.html#Use_Btrfs_subvolume_as_container_root" title="Systemd-nspawn">Systemd-nspawn#Use Btrfs subvolume as container root</a> e <a href="../en/Systemd-nspawn.html#Use_temporary_Btrfs_snapshot_of_container" title="Systemd-nspawn">Systemd-nspawn#Use temporary Btrfs snapshot of container</a>.
</p>
<h3>
<span id="Reduzindo_atualiza.C3.A7.C3.B5es_de_metadados_de_tempo_de_acesso"></span><span class="mw-headline" id="Reduzindo_atualizações_de_metadados_de_tempo_de_acesso">Reduzindo atualizações de metadados de tempo de acesso</span>
</h3>
<p>Devido à natureza copy-on-write do Btrfs, simplesmente acessar arquivos pode acionar a cópia e gravação de metadados. Reduzir a frequência das atualizações de tempo de acesso pode eliminar esse uso inesperado do disco e aumentar o desempenho. Veja <a href="../pt/Fstab.html#Op%C3%A7%C3%B5es_atime" title="Fstab (Português)">fstab#Opções atime</a> para as opções disponíveis.
</p>
<h3><span class="mw-headline" id="Backup_incremental_para_unidade_externa">Backup incremental para unidade externa</span></h3>
<p>Os pacotes a seguir usam <code>btrfs send</code> e <code>btrfs receive</code> para enviar backups incrementalmente para uma unidade externa. Consulte a documentação para ver as diferenças na implementação, recursos e requisitos.
</p>
<ul><li>
<b>btrbk</b> — Ferramenta para criar snapshots e backups remotos de subvolumes Btrfs.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/digint/btrbk">https://github.com/digint/btrbk</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=btrbk">btrbk</a></span>
</dd></dl>
<ul><li>
<b>snap-sync</b> — Usa snapshots do <a href="../pt/Snapper.html" title="Snapper (Português)">Snapper</a> para fazer backup em uma unidade externa ou máquina remota.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/wesbarnett/snap-sync.git">https://github.com/wesbarnett/snap-sync.git</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=snap-sync">snap-sync</a></span>
</dd></dl>
<ul><li>
<b>snapsync</b> — Uma ferramenta de sincronização para o <a href="../pt/Snapper.html" title="Snapper (Português)">Snapper</a>.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/doudou/snapsync">https://github.com/doudou/snapsync</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ruby-snapsync/">ruby-snapsync</a></span><sup><small>AUR</small></sup>
</dd></dl>
<p>O pacote a seguir permite fazer backup de snapshots do snapper para sistemas de arquivos não Btrfs.
</p>
<ul><li>
<b>snapborg</b> — Ferramenta semelhante ao borgmatic que integra snapshots do snapper com backups do <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=borg">borg</a></span>.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/enzingerm/snapborg">https://github.com/enzingerm/snapborg</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snapborg/">snapborg</a></span><sup><small>AUR</small></sup>
</dd></dl>
<h2>
<span id="Solu.C3.A7.C3.A3o_de_problemas"></span><span class="mw-headline" id="Solução_de_problemas">Solução de problemas</span>
</h2>
<p>Veja o <a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Problem_FAQ">FAQ de problemas do Btrfs</a> para solução de problemas gerais.
</p>
<h3><span class="mw-headline" id="GRUB">GRUB</span></h3>
<h4>
<span id="Deslocamento_da_parti.C3.A7.C3.A3o"></span><span class="mw-headline" id="Deslocamento_da_partição">Deslocamento da partição</span>
</h4>
<p>O problema de deslocamento pode ocorrer quando você tenta incorporar <code>core.img</code> em um disco particionado. Isso significa que <a href="../Special:Diff/319474.html" title="Special:Diff/319474">está tudo bem</a> para incorporar o <code>core.img</code> do GRUB em um pool Btrfs em um disco sem partição (por exemplo <code>/dev/sd<i>X</i></code>) diretamente.
</p>
<p><a href="../pt/GRUB.html" title="GRUB (Português)">GRUB</a> pode inicializar partições Btrfs, porém o módulo pode ser maior que outros <a href="../pt/File_systems.html" class="mw-redirect" title="Sistemas de arquivos">sistemas de arquivos</a>. E o arquivo <code>core.img</code> feito pelo <code>grub-install</code> pode não caber nos primeiros 63 setores (31,5 KiB) da unidade entre o MBR e a primeira partição. Ferramentas de particionamento atualizadas, como <code>fdisk</code> e <code>gdisk</code> evitam esse problema compensando a primeira partição em aproximadamente 1MiB ou 2MiB.
</p>
<h4><span class="mw-headline" id="Raiz_ausente">Raiz ausente</span></h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Sugere a edição manual de um arquivo sem configuração. (Discuss in <a href="../en/Talk:Btrfs.html#Should_not_suggest_to_edit_files_in_/usr/share" title="Talk:Btrfs">Talk:Btrfs#Should not suggest to edit files in /usr/share</a>)</div>
</div>
<p>Se experenciando o seguinte erro <code>error no such device: root</code> ao inicializar a partir de uma configuração de estilo RAID, edite <code>/usr/share/grub/grub-mkconfig_lib</code> e remova as duas aspas da linha <code>echo "  search --no-floppy --fs-uuid --set=root ${hints} ${fs_uuid}"</code>. Gere novamente a configuração do GRUB e o sistema deve inicializar sem erros.
</p>
<h3><span class="mw-headline" id="Tempo_limite_de_montagem_esgotado">Tempo limite de montagem esgotado</span></h3>
<p>Às vezes, especialmente com grandes arrays RAID 1, a montagem pode atingir o tempo limite durante a inicialização com uma mensagem do journal como:
</p>
<pre>Jan 25 18:05:12 host systemd[1]: storage.mount: Mounting timed out. Terminating.
Jan 25 18:05:46 host systemd[1]: storage.mount: Mount process exited, code=killed, status=15/TERM
Jan 25 18:05:46 host systemd[1]: storage.mount: Failed with result 'timeout'.
Jan 25 18:05:46 host systemd[1]: Failed to mount /storage.
Jan 25 18:05:46 host systemd[1]: Startup finished in 32.943s (firmware) + 3.097s (loader) + 7.247s (kernel)&gt;
Jan 25 18:05:46 host kernel: BTRFS error (device sda): open_ctree failed</pre>
<p>Isso pode ser facilmente contornado fornecendo um tempo limite mais longo por meio da opção de montagem específica do systemd <code>x-systemd.mount-timeout</code> em <a href="../pt/Fstab.html" title="Fstab (Português)">fstab</a>. Por exemplo:
</p>
<pre>/dev/sda                /storage    btrfs       rw,relatime,x-systemd.mount-timeout=5min  0 0
</pre>
<h3><span class="mw-headline" id="BTRFS:_open_ctree_falhou">BTRFS: open_ctree falhou</span></h3>
<p>Em novembro de 2014, pareceu haver um bug no <a href="../pt/Systemd.html" title="Systemd (Português)">systemd</a> ou no <a href="../pt/Mkinitcpio.html" title="Mkinitcpio (Português)">mkinitcpio</a> causando o seguinte erro em sistemas que usam Btrfs em vários dispositivos usando o hook <code>btrfs</code> em <code>mkinitcpio.conf</code>:
</p>
<pre>BTRFS: open_ctree failed
mount: wrong fs type, bad option, bad superblock on /dev/sdb2, missing codepage or helper program, or other error

In some cases useful info is found in syslog - try dmesg|tail or so.

You are now being dropped into an emergency shell.
</pre>
<p>Uma solução é remover <code>btrfs</code> do array <code>HOOKS</code> em <code>/etc/mkinitcpio.conf</code> e, em vez disso, adicionar <code>btrfs</code> ao array <code>MODULES</code>. Em seguida, <a href="../pt/Mkinitcpio.html#Cria%C3%A7%C3%A3o_e_ativa%C3%A7%C3%A3o_de_imagem" class="mw-redirect" title="Gere novamente o initramfs">gere novamente o initramfs</a> e reinicie.
</p>
<p>Você receberá o mesmo erro se tentar montar um arranjo raid sem um dos dispositivos. Nesse caso, você deve adicionar a opção de montagem <code>degraded</code> para <code>/etc/fstab</code>. Se sua raiz reside no array, você também deve adicionar <code>rootflags=degraded</code> para os <a href="../pt/Kernel_parameters.html" class="mw-redirect" title="Parâmetros do kernel">parâmetros do kernel</a>.
</p>
<p>Desde agosto de 2016, uma possível solução alternativa para esse bug é montar o array por uma única unidade apenas em <code>/etc/fstab</code>, e permitir que o Btrfs descubra e anexe as outras unidades automaticamente. Identificadores baseados em grupo, como UUID e LABEL, parecem contribuir para a falha. Por exemplo, uma array RAID1 de dois dispositivos que consiste em 'disco1' e 'disco2' terá um UUID alocado para ele, mas em vez de usar o UUID, use apenas <code>/dev/mapper/disco1</code> no <code>/etc/fstab</code>. Para obter uma explicação mais detalhada, consulte a seguinte <a rel="nofollow" class="external text" href="https://web.archive.org/web/20161108175034/http://blog.samcater.com/fix-for-btrfs-open_ctree-failed-when-running-root-fs-on-raid-1-or-raid10-arch-linux/">postagem no blog</a>.
</p>
<p>Outra solução possível é remover o hook <code>udev</code> no <a href="../pt/Mkinitcpio.html" title="Mkinitcpio (Português)">mkinitcpio.conf</a> e substituir ele pelo hook <code>systemd</code>. Nesse caso, <code>btrfs</code> <b>não</b> deve estar nos vetores <code>HOOKS</code> ou <code>MODULES</code>.
</p>
<p>Veja a <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=189845">discussão no fórum</a> e <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/42884">FS#42884</a> para mais informações e discussão.
</p>
<h3><span class="mw-headline" id="btrfs_check">btrfs check</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Atenção:</strong> Como o Btrfs está em desenvolvimento pesado, especialmente o comando <code>btrfs check</code>, é altamente recomendável criar um <a href="../pt/System_maintenance.html#Backup" title="System maintenance (Português)">backup</a> e consultar <span class="plainlinks archwiki-template-man" title="$ man 8 btrfs-check"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/btrfs-check.8">btrfs-check(8)</a></span> antes de executar <code>btrfs check</code> com a opção <code>--repair</code>.</div>
<p>O comando <span class="plainlinks archwiki-template-man" title="$ man 8 btrfs-check"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/btrfs-check.8">btrfs-check(8)</a></span> pode ser usado para verificar ou reparar um sistema de arquivos Btrfs não montado. No entanto, essa ferramenta de reparo ainda é imatura e não é capaz de reparar certos erros do sistema de arquivos, mesmo aqueles que não tornam o sistema de arquivos desmontável.
</p>
<h2>
<span id="Veja_tamb.C3.A9m"></span><span class="mw-headline" id="Veja_também">Veja também</span>
</h2>
<ul>
<li>
<b>Site oficial</b>
<ul>
<li><a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/">Btrfs Wiki</a></li>
<li><a rel="nofollow" class="external text" href="https://btrfs.readthedocs.io">Btrfs Documentation</a></li>
</ul>
</li>
<li>
<b>Relacionado a desempenho</b>
<ul>
<li><a rel="nofollow" class="external text" href="https://superuser.com/questions/432188/should-i-put-my-multi-device-btrfs-filesystem-on-disk-partitions-or-raw-devices">Btrfs on raw disks?</a></li>
<li><a rel="nofollow" class="external text" href="https://lore.kernel.org/linux-btrfs/CAKcLGm_MKEdTiHFBd-b-v2sN5gJmgFRqsykzWRXTVqUw4O6Acw@mail.gmail.com/">Varying leafsize and nodesize in Btrfs</a></li>
<li><a rel="nofollow" class="external text" href="https://lore.kernel.org/linux-btrfs/jgui4j$th5$1@dough.gmane.org/">Btrfs support for efficient SSD operation (data blocks alignment)</a></li>
<li><a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/FAQ#Is_Btrfs_optimized_for_SSD.3F">Is Btrfs optimized for SSDs?</a></li>
<li>
<b>Benchmark de opções de montagem do Phoronix</b>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.phoronix.com/scan.php?page=article&amp;item=linux-58-filesystems">Linux 5.8</a></li>
<li><a rel="nofollow" class="external text" href="https://www.phoronix.com/scan.php?page=article&amp;item=linux-50-filesystems">Linux 5.0</a></li>
<li><a rel="nofollow" class="external text" href="https://www.phoronix.com/scan.php?page=article&amp;item=btrfs-mount-linux49">Linux 4.9</a></li>
<li><a rel="nofollow" class="external text" href="https://www.phoronix.com/scan.php?page=article&amp;item=linux_314_btrfs">Linux 3.14</a></li>
<li><a rel="nofollow" class="external text" href="https://www.phoronix.com/scan.php?page=article&amp;item=linux_btrfs_311&amp;num=1">Linux 3.11</a></li>
<li><a rel="nofollow" class="external text" href="https://www.phoronix.com/scan.php?page=news_item&amp;px=MTM0OTU">Linux 3.9</a></li>
<li><a rel="nofollow" class="external text" href="https://www.phoronix.com/scan.php?page=article&amp;item=btrfs_linux37_mounts&amp;num=1">Linux 3.7</a></li>
<li><a rel="nofollow" class="external text" href="https://www.phoronix.com/scan.php?page=article&amp;item=linux_btrfs_options&amp;num=1">Linux 3.2</a></li>
</ul>
</li>
<li><a rel="nofollow" class="external text" href="https://blog.erdemagaoglu.com/post/4605524309/lzo-vs-snappy-vs-lzf-vs-zlib-a-comparison-of">Lzo vs. zLib</a></li>
</ul>
</li>
<li>
<b>Diversos</b>
<ul>
<li><a href="https://www.funtoo.org/BTRFS_Fun" class="extiw" title="funtoo:BTRFS Fun">Funtoo:BTRFS Fun</a></li>
<li>
<a rel="nofollow" class="external text" href="https://www.phoronix.com/scan.php?page=news_item&amp;px=MTA0ODU">Avi Miller presenting Btrfs</a> at SCALE 10x, January 2012.</li>
<li>
<a rel="nofollow" class="external text" href="https://www.phoronix.com/scan.php?page=news_item&amp;px=MTA4Mzc">Summary of Chris Mason's talk</a> from LFCS 2012</li>
<li>
<a rel="nofollow" class="external text" href="https://git.kernel.org/?p/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=35054394c4b3cecd52577c2662c84da1f3e73525">Btrfs: stop providing a bmap operation to avoid swapfile corruptions</a> 2009-01-21</li>
<li><a rel="nofollow" class="external text" href="https://marc.merlins.org/perso/btrfs/post_2014-03-22_Btrfs-Tips_-Doing-Fast-Incremental-Backups-With-Btrfs-Send-and-Receive.html">Doing Fast Incremental Backups With Btrfs Send and Receive</a></li>
</ul>
</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../pt/Category:File_systems.html" title="Category:File systems (Português)">File systems (Português)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Btrfs_(Portugu%C3%AAs)&amp;oldid=803528">https://wiki.archlinux.org/index.php?title=Btrfs_(Português)&amp;oldid=803528</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 16 March 2024, at 11:07.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
