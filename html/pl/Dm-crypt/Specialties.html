<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Dm-crypt (Polski)/Specialties (Polski) - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Dm-crypt_Polski_Specialties_Polski rootpage-Dm-crypt_Polski skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Zabezpieczanie_niezaszyfrowanej_partycji_rozruchowej" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Zabezpieczanie_niezaszyfrowanej_partycji_rozruchowej">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Zabezpieczanie niezaszyfrowanej partycji rozruchowej</div>
		</a>
		
			<button aria-controls="toc-Zabezpieczanie_niezaszyfrowanej_partycji_rozruchowej-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Zabezpieczanie niezaszyfrowanej partycji rozruchowej subsection</span>
			</button>
		
		<ul id="toc-Zabezpieczanie_niezaszyfrowanej_partycji_rozruchowej-sublist" class="vector-toc-list">
			<li id="toc-Uruchamianie_z_urządzenia_wymiennego" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Uruchamianie_z_urz%C4%85dzenia_wymiennego">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Uruchamianie z urządzenia wymiennego</div>
			</a>
			
			<ul id="toc-Uruchamianie_z_urządzenia_wymiennego-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-chkboot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#chkboot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>chkboot</div>
			</a>
			
			<ul id="toc-chkboot-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-mkinitcpio-chkcryptoboot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#mkinitcpio-chkcryptoboot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>mkinitcpio-chkcryptoboot</div>
			</a>
			
			<ul id="toc-mkinitcpio-chkcryptoboot-sublist" class="vector-toc-list">
				<li id="toc-Instalacja" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Instalacja">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.1</span>Instalacja</div>
			</a>
			
			<ul id="toc-Instalacja-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Technical_Overview" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Technical_Overview">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.2</span>Technical Overview</div>
			</a>
			
			<ul id="toc-Technical_Overview-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Inne_metody" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Inne_metody">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.4</span>Inne metody</div>
			</a>
			
			<ul id="toc-Inne_metody-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Używanie_zaszyfrowanych_plików_kluczy_GPG,_LUKS_lub_OpenSSL" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#U%C5%BCywanie_zaszyfrowanych_plik%C3%B3w_kluczy_GPG,_LUKS_lub_OpenSSL">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Używanie zaszyfrowanych plików kluczy GPG, LUKS lub OpenSSL</div>
		</a>
		
		<ul id="toc-Używanie_zaszyfrowanych_plików_kluczy_GPG,_LUKS_lub_OpenSSL-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Zdalne_odblokowanie_partycji_root_(lub_innej)" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Zdalne_odblokowanie_partycji_root_(lub_innej)">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Zdalne odblokowanie partycji root (lub innej)</div>
		</a>
		
			<button aria-controls="toc-Zdalne_odblokowanie_partycji_root_(lub_innej)-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Zdalne odblokowanie partycji root (lub innej) subsection</span>
			</button>
		
		<ul id="toc-Zdalne_odblokowanie_partycji_root_(lub_innej)-sublist" class="vector-toc-list">
			<li id="toc-Zdalne_odblokowanie_(haki:_systemd,_systemd-tool)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Zdalne_odblokowanie_(haki:_systemd,_systemd-tool)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Zdalne odblokowanie (haki: systemd, systemd-tool)</div>
			</a>
			
			<ul id="toc-Zdalne_odblokowanie_(haki:_systemd,_systemd-tool)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Zdalne_odblokowanie_(haki:_netconf,_dropbear,_tinyssh,_ppp)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Zdalne_odblokowanie_(haki:_netconf,_dropbear,_tinyssh,_ppp)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Zdalne odblokowanie (haki: netconf, dropbear, tinyssh, ppp)</div>
			</a>
			
			<ul id="toc-Zdalne_odblokowanie_(haki:_netconf,_dropbear,_tinyssh,_ppp)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Zdalne_odblokowanie_przez_Wi-Fi_(haki:_buduj_własne)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Zdalne_odblokowanie_przez_Wi-Fi_(haki:_buduj_w%C5%82asne)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Zdalne odblokowanie przez Wi-Fi (haki: buduj własne)</div>
			</a>
			
			<ul id="toc-Zdalne_odblokowanie_przez_Wi-Fi_(haki:_buduj_własne)-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Obsługa_Discard_/_TRIM_dla_dysków_półprzewodnikowych_(SSD)" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Obs%C5%82uga_Discard_/_TRIM_dla_dysk%C3%B3w_p%C3%B3%C5%82przewodnikowych_(SSD)">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Obsługa Discard / TRIM dla dysków półprzewodnikowych (SSD)</div>
		</a>
		
		<ul id="toc-Obsługa_Discard_/_TRIM_dla_dysków_półprzewodnikowych_(SSD)-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Szyfrowanie_hakiem_i_wiele_dysków" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Szyfrowanie_hakiem_i_wiele_dysk%C3%B3w">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Szyfrowanie hakiem i wiele dysków</div>
		</a>
		
			<button aria-controls="toc-Szyfrowanie_hakiem_i_wiele_dysków-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Szyfrowanie hakiem i wiele dysków subsection</span>
			</button>
		
		<ul id="toc-Szyfrowanie_hakiem_i_wiele_dysków-sublist" class="vector-toc-list">
			<li id="toc-Rozszerzanie_LVM_na_wielu_dyskach" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Rozszerzanie_LVM_na_wielu_dyskach">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Rozszerzanie LVM na wielu dyskach</div>
			</a>
			
			<ul id="toc-Rozszerzanie_LVM_na_wielu_dyskach-sublist" class="vector-toc-list">
				<li id="toc-Dodanie_nowego_dysku" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Dodanie_nowego_dysku">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.1</span>Dodanie nowego dysku</div>
			</a>
			
			<ul id="toc-Dodanie_nowego_dysku-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Rozszerzanie_woluminu_logicznego" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Rozszerzanie_woluminu_logicznego">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.2</span>Rozszerzanie woluminu logicznego</div>
			</a>
			
			<ul id="toc-Rozszerzanie_woluminu_logicznego-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Modyfikowanie_haków_szyfrowania_dla_wielu_partycji" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Modyfikowanie_hak%C3%B3w_szyfrowania_dla_wielu_partycji">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Modyfikowanie haków szyfrowania dla wielu partycji</div>
			</a>
			
			<ul id="toc-Modyfikowanie_haków_szyfrowania_dla_wielu_partycji-sublist" class="vector-toc-list">
				<li id="toc-Główny_system_plików_obejmujący_wiele_partycji" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#G%C5%82%C3%B3wny_system_plik%C3%B3w_obejmuj%C4%85cy_wiele_partycji">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.1</span>Główny system plików obejmujący wiele partycji</div>
			</a>
			
			<ul id="toc-Główny_system_plików_obejmujący_wiele_partycji-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Wiele_partycji_innych_niż_root" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Wiele_partycji_innych_ni%C5%BC_root">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.2</span>Wiele partycji innych niż root</div>
			</a>
			
			<ul id="toc-Wiele_partycji_innych_niż_root-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Szyfrowany_system_za_pomocą_oddzielnego_nagłówka_LUKS" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Szyfrowany_system_za_pomoc%C4%85_oddzielnego_nag%C5%82%C3%B3wka_LUKS">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Szyfrowany system za pomocą oddzielnego nagłówka LUKS</div>
		</a>
		
			<button aria-controls="toc-Szyfrowany_system_za_pomocą_oddzielnego_nagłówka_LUKS-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Szyfrowany system za pomocą oddzielnego nagłówka LUKS subsection</span>
			</button>
		
		<ul id="toc-Szyfrowany_system_za_pomocą_oddzielnego_nagłówka_LUKS-sublist" class="vector-toc-list">
			<li id="toc-Używanie_haka_systemd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#U%C5%BCywanie_haka_systemd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>Używanie haka systemd</div>
			</a>
			
			<ul id="toc-Używanie_haka_systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Modyfikowanie_haka_szyfrowania" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Modyfikowanie_haka_szyfrowania">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2</span>Modyfikowanie haka szyfrowania</div>
			</a>
			
			<ul id="toc-Modyfikowanie_haka_szyfrowania-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Szyfrowanie_/boot_i_odłączony_nagłówek_LUKS_na_USB" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Szyfrowanie_/boot_i_od%C5%82%C4%85czony_nag%C5%82%C3%B3wek_LUKS_na_USB">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Szyfrowanie /boot i odłączony nagłówek LUKS na USB</div>
		</a>
		
			<button aria-controls="toc-Szyfrowanie_/boot_i_odłączony_nagłówek_LUKS_na_USB-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Szyfrowanie /boot i odłączony nagłówek LUKS na USB subsection</span>
			</button>
		
		<ul id="toc-Szyfrowanie_/boot_i_odłączony_nagłówek_LUKS_na_USB-sublist" class="vector-toc-list">
			<li id="toc-Przygotowywanie_urządzeń_dyskowych" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Przygotowywanie_urz%C4%85dze%C5%84_dyskowych">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1</span>Przygotowywanie urządzeń dyskowych</div>
			</a>
			
			<ul id="toc-Przygotowywanie_urządzeń_dyskowych-sublist" class="vector-toc-list">
				<li id="toc-Przygotowanie_klucza_USB" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Przygotowanie_klucza_USB">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1.1</span>Przygotowanie klucza USB</div>
			</a>
			
			<ul id="toc-Przygotowanie_klucza_USB-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Główny_napęd" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#G%C5%82%C3%B3wny_nap%C4%99d">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1.2</span>Główny napęd</div>
			</a>
			
			<ul id="toc-Główny_napęd-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Procedura_instalacji_i_niestandardowe_szyfrowanie_hook" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Procedura_instalacji_i_niestandardowe_szyfrowanie_hook">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2</span>Procedura instalacji i niestandardowe szyfrowanie hook</div>
			</a>
			
			<ul id="toc-Procedura_instalacji_i_niestandardowe_szyfrowanie_hook-sublist" class="vector-toc-list">
				<li id="toc-Boot_Loader" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Boot_Loader">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2.1</span>Boot Loader</div>
			</a>
			
			<ul id="toc-Boot_Loader-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Zmiana_pliku_klucza_LUKS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Zmiana_pliku_klucza_LUKS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.3</span>Zmiana pliku klucza LUKS</div>
			</a>
			
			<ul id="toc-Zmiana_pliku_klucza_LUKS-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Dm-crypt (Polski)/Specialties (Polski)</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-en mw-list-item"><a href="../../en/Dm-crypt/Specialties.html" title="Dm-crypt/Specialties – English" lang="en" hreflang="en" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-es mw-list-item"><a href="../../es/Dm-crypt/Specialties.html" title="Dm-crypt (Español)/Specialties – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Dm-crypt/%E7%89%B9%E8%A8%98%E4%BA%8B%E9%A0%85" title="Dm-crypt/特記事項 – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <a href="../../pl/Dm-crypt.html" title="Dm-crypt (Polski)">Dm-crypt (Polski)</a>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="pl" dir="ltr">
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:Tango-preferences-desktop-locale.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs to be <a href="../../en/ArchWiki:Contributing.html#Translating" title="ArchWiki:Contributing">translated</a>.</b></p>
<div>
<b>Notes:</b> No updates since 2018-07-31 (Discuss in <a rel="nofollow" class="external text" href="../../pl/Talk:Dm-crypt/Specialties.html">Talk:Dm-crypt (Polski)/Specialties (Polski)</a>)</div>
</div>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Zabezpieczanie_niezaszyfrowanej_partycji_rozruchowej">Zabezpieczanie niezaszyfrowanej partycji rozruchowej</span></h2>
<p>Partycja <code>/boot</code> i <a href="../../en/Partitioning.html#Master_Boot_Record" class="mw-redirect" title="Master Boot Record">Master Boot Record</a> to dwa obszary dysku, które nie są zaszyfrowane, nawet w <a href="../../pl/Dm-crypt/Encrypting_an_entire_system.html" title="Dm-crypt (Polski)/Encrypting an entire system (Polski)">encrypted root</a>. Zwykle nie można ich zaszyfrować, ponieważ <a href="../../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> i BIOS (odpowiednio) nie mogą odblokować kontenera dm-crypt, aby kontynuować proces uruchamiania. Wyjątkiem jest <a href="../../en/GRUB.html" title="GRUB">GRUB</a>, który uzyskał funkcję odblokowania LUKSa zaszyfrowanego <code>/boot</code> - patrz <a href="../../pl/Dm-crypt/Encrypting_an_entire_system.html#Szyfrowana_partycja_rozruchowa_(GRUB)" title="Dm-crypt (Polski)/Encrypting an entire system (Polski)">dm-crypt (Polski)/Encrypting an entire system (Polski)#Szyfrowana partycja rozruchowa (GRUB)</a>.
</p>
<p>W tej sekcji opisano kroki, które można podjąć w celu zwiększenia bezpieczeństwa procesu rozruchu.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Należy pamiętać, że zabezpieczenie partycji <code>/boot</code> i MBR może złagodzić liczne ataki podczas rozruchu, ale systemy skonfigurowane w ten sposób mogą nadal być podatne na sabotaż BIOS/UEFI/firmware, sprzętowe keyloggery, zimne ataki rozruchowe i wiele innych zagrożeń, które są poza zakresem tego artykułu. Omówienie problemów związanych z zaufaniem systemu oraz ich związek z szyfrowaniem na pełnym dysku można znaleźć na stronie <a rel="nofollow" class="external autonumber" href="https://www.youtube.com/watch?v=pKeiKYA03eE">[1]</a>.</div>
<h3>
<span id="Uruchamianie_z_urz.C4.85dzenia_wymiennego"></span><span class="mw-headline" id="Uruchamianie_z_urządzenia_wymiennego">Uruchamianie z urządzenia wymiennego</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Systemd wersja 230 generatora cryptsetup emituje <code>RequiresMountsFor</code> dla pliku kluczy crypto. Dlatego też, gdy system plików przechowujący ten plik zostanie odłączony, zatrzymuje również usługę cryptsetup. Takie zachowanie jest niepoprawne, ponieważ system plików i kryptokey są wymagane tylko raz, gdy kontener kryptograficzny jest początkowo skonfigurowany. Zobacz <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/3816">systemd issue 3816</a>.</div>
<p>Używanie nośnika wymienego do uruchamiania systemu jest dość prostą procedurą i oferuje znaczną poprawę bezpieczeństwa przed niektórymi rodzajami ataków. Dwie wrażliwe części systemu wykorzystujące <a href="../../pl/Dm-crypt/Encrypting_an_entire_system.html" title="Dm-crypt (Polski)/Encrypting an entire system (Polski)">zaszyfrowany system plików root</a> to
</p>
<ul>
<li>
<a href="../../en/Partitioning.html#Master_Boot_Record" class="mw-redirect" title="Master Boot Record">Master Boot Record</a>, i</li>
<li>partycja <code>/boot</code>
</li>
</ul>
<p>Te muszą być przechowywane niezaszyfrowane w celu uruchomienia systemu. Aby zabezpieczyć je przed manipulacją, zaleca się przechowywanie ich na wymiennym nośniku, takim jak dysk USB, i uruchamianie z tego dysku zamiast dysku twardego. Tak długo, jak utrzymujesz dysk ze sobą przez cały czas, możesz mieć pewność, że te komponenty nie zostały zmodyfikowane, dzięki czemu uwierzytelnianie będzie o wiele bezpieczniejsze podczas odblokowywania systemu.
</p>
<p>Zakłada się, że masz już skonfigurowany system z dedykowaną partycją zamontowaną w <code>/boot</code>. Jeśli nie, wykonaj kroki opisane w <a href="../../en/Dm-crypt/System_configuration.html#Kernel_parameters" title="Dm-crypt/System configuration">dm-crypt/System configuration#Kernel parameters</a>, zastępując dysk twardy dyskiem wymiennym.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Musisz upewnić się, że twój system obsługuje uruchamianie z wybranego nośnika, czy to dysku USB, zewnętrznego dysku twardego, karty SD, czy cokolwiek innego.</div>
<p>Przygotuj dysk wymienny (<code>/dev/sdx</code>).
</p>
<pre># gdisk /dev/sdx #format if necessary. Alternatively, cgdisk, fdisk, cfdisk, gparted...
# mkfs.ext2 /dev/sdx1
# mount /dev/sdx1 /mnt
</pre>
<p>Copy your existing <code>/boot</code> contents to the new one.
</p>
<p>Skopiuj istniejącą zawartość  <code>/boot</code> na nową.
</p>
<pre># cp -ai /boot/* /mnt/
</pre>
<p>Zainstaluj nową partycję. Nie zapomnij zaktualizować pliku <a href="../../en/Fstab.html" class="mw-redirect" title="Fstab (Polski)">fstab</a>.
</p>
<pre># umount /boot
# umount /mnt
# mount /dev/sdx1 /boot
# genfstab -p -U / &gt; /etc/fstab
</pre>
<p>Zaktualizuj <a href="../../en/GRUB.html" title="GRUB">GRUB</a>. <code>grub-mkconfig</code> powinien automatycznie wykryć nowy identyfikator UUID partycji, ale niestandardowe wpisy menu mogą wymagać ręcznej aktualizacji.
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg
# grub-install /dev/sdx #install to the removable device, not the hard disk.
</pre>
<p>Uruchom ponownie i przetestuj nową konfigurację. Pamiętaj, aby odpowiednio ustawić kolejność uruchamiania urządzenia w systemie BIOS lub <a href="../../en/Unified_Extensible_Firmware_Interface.html" class="mw-redirect" title="UEFI">UEFI</a>. Jeśli uruchomienie systemu nie powiedzie się, nadal można uruchomić komputer z dysku twardego, aby rozwiązać problem.
</p>
<h3><span class="mw-headline" id="chkboot">chkboot</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> chkboot makes a <code>/boot</code> partition <b>tamper-evident</b>, not <b>tamper-proof</b>. By the time the chkboot script is run, you have already typed your password into a potentially compromised boot loader, kernel, or initrd. If your system fails the chkboot integrity test, no assumptions can be made about the security of your data.</div>
<p>Odnosząc się do artykułu z magazynu ct (wydanie 3/12, strona 146, 01.16.2012, <a rel="nofollow" class="external autonumber" href="https://www.heise.de/ct/inhalt/2012/03/6/">[2]</a>) poniższy skrypt sprawdza pliki w katalogu / boot pod kątem zmian sumy kontrolnej SHA-1, i-węzła i zajętych bloków na dysku twardym. Sprawdza także główny rekord rozruchowy. Skrypt nie może zapobiec pewnym typom ataków, ale wiele z nich jest trudniejszych. Konfiguracja samego skryptu nie jest przechowywana w niezaszyfrowanej partycji <code>/boot</code>.
Z zablokowanym / wyłączonym zaszyfrowanym systemem, utrudnia to niektórym napastnikom, ponieważ nie jest oczywiste, że automatyczne porównywanie sumy kontrolnej partycji jest wykonywane po starcie systemu. Jednak osoba atakująca, która przewiduje takie środki ostrożności, może manipulować oprogramowaniem układowym, aby uruchomić własny kod nad jądrem i przechwycić dostęp do systemu plików, np. do rozruchu i przedstawienia niezakodowanych plików. Ogólnie rzecz biorąc, żadne środki bezpieczeństwa poniżej poziomu oprogramowania układowego nie są w stanie zagwarantować zaufania i fałszowania dowodów.
</p>
<p>Dostępny jest skrypt z instrukcją  <a rel="nofollow" class="external text" href="ftp://ftp.heise.de/pub/ct/listings/1203-146.zip">instalacji</a>(autor: Juergen Schmidt, ju at heisec.de; Licencja: GPLv2). Istnieje również pakiet <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/chkboot/">chkboot</a></span><sup><small>AUR</small></sup> do zainstalowania.
</p>
<p>Po instalacji dodaj plik usługi (pakiet zawiera jeden oparty na następujących elementach) i włącz go:
</p>
<pre>[Unit]
Description=Check that boot is what we want
Requires=basic.target
After=basic.target

[Service]
Type=oneshot
ExecStart=/usr/local/bin/chkboot.sh

[Install]
WantedBy=multi-user.target
</pre>
<p>Istnieje małe zastrzeżenie dla systemd. W chwili pisania tego tekstu oryginalny skrypt <code>chkboot.sh</code> zawiera puste miejsce na początku #! <code><u> </u>#!/bin/bash</code> które musi zostać usunięte, aby usługa mogła pomyślnie się uruchomić.
</p>
<p>Ponieważ <code>/usr/local/bin/chkboot_user.sh</code> musi zostać wykonany zaraz po zalogowaniu, musisz dodać go do <a href="../../en/Autostarting.html" class="mw-redirect" title="Autostart">autostartu</a> (np. w KDE -&gt; <i>System Settings -&gt; Startup and Shutdown -&gt; Autostart</i>; GNOME 3: <i>gnome-session-properties</i>).
</p>
<p>W Arch Linuksie zmiany w <code>/boot</code> są dość częste, na przykład po aktualizacji kerneli. Dlatego pomocne może być korzystanie ze skryptów przy każdej pełnej aktualizacji systemu. Jednym ze sposobów, aby to zrobić:
</p>
<pre>#!/bin/bash
#
# Note: Insert your &lt;user&gt;  and execute it with sudo for pacman &amp; chkboot to work automagically
#
echo "Pacman update [1] Quickcheck before updating" &amp; 
sudo -u &lt;user&gt; /usr/local/bin/chkboot_user.sh		# insert your logged on &lt;user&gt; 
/usr/local/bin/chkboot.sh
sync							# sync disks with any results 
sudo -u &lt;user&gt; /usr/local/bin/chkboot_user.sh		# insert your logged on &lt;user&gt; 
echo "Pacman update [2] Syncing repos for pacman" 
pacman -Syu
/usr/local/bin/chkboot.sh
sync	
sudo -u &lt;user&gt; /usr/local/bin/chkboot_user.sh		# insert your logged on &lt;user&gt;
echo "Pacman update [3] All done, let us roll on ..."
</pre>
<h3><span class="mw-headline" id="mkinitcpio-chkcryptoboot">mkinitcpio-chkcryptoboot</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Ten hak nie szyfruje kodu rdzenia (MBR) <a href="../../en/GRUB.html" title="GRUB">GRUB</a>-a ani kodu pośredniczącego EFI, ani nie chroni przed sytuacjami, gdy atakujący jest w stanie zmodyfikować zachowanie bootloadera, aby złamać jądro i / lub initramfs w czasie wykonywania.</div>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-chkcryptoboot/">mkinitcpio-chkcryptoboot</a></span><sup><small>AUR</small></sup> jest haczykiem <a href="../../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a>, który przeprowadza kontrole integralności podczas wczesnej przestrzeni użytkownika i radzi, aby użytkownik nie wprowadzał swojego hasła do partycji głównej, jeśli system wydaje się być zagrożony. Bezpieczeństwo uzyskuje się za pomocą zaszyfrowanej partycji rozruchowej, która jest odblokowywana za pomocą modułu <code>cryptodisk.mod</code>  GRUB-a oraz partycji root systemu plików, która jest szyfrowana hasłem innym niż poprzednie. W ten sposób initramfs i jądro są zabezpieczone przed ingerencją w trybie offline, a partycja root może pozostać bezpieczna, nawet jeśli hasło <code>/boot</code> partycji zostało wprowadzone na zaatakowanej maszynie (pod warunkiem, że hak chkcryptoboot wykryje kompromis i samo nie zostanie naruszone podczas uruchamiania w czasie wykonywania))
</p>
<p>Ten haczyk wymaga odblokowania wersji <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub">grub</a></span> &gt; = 2.00 i dedykowanej partycji zaszyfrowanej / <code>/boot</code> LUKS z własnym hasłem, aby być bezpiecznym.
</p>
<h4><span class="mw-headline" id="Instalacja">Instalacja</span></h4>
<p>Zainstaluj <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-chkcryptoboot/">mkinitcpio-chkcryptoboot</a></span><sup><small>AUR</small></sup> i edytuj <code>/etc/default/chkcryptoboot.conf</code>. Jeśli chcesz wykryć, czy partycja rozruchowa została pominięta, zmodyfikuj zmienne <code>CMDLINE_NAME</code> i <code>CMDLINE_VALUE</code> , wartościami znanymi tylko Tobie. Możesz skorzystać z porady dotyczącej używania dwóch skrótów, jak sugeruje się tuż po instalacji. Należy również wprowadzić odpowiednie zmiany w <a href="../../en/Kernel_parameters.html" class="mw-redirect" title="Kernel command line">linii poleceń jądra</a> w <code>/etc/default/grub</code>. Zmodyfikuj linię <code>HOOKS=</code>  w pliku <code>/etc/mkinitcpio.conf</code> i hak <code>chkcryptoboot</code> przed <code>encrypt</code>. Po zakończeniu <a href="../../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">zregeneruj initramfs</a>.
</p>
<h4><span class="mw-headline" id="Technical_Overview">Technical Overview</span></h4>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-chkcryptoboot/">mkinitcpio-chkcryptoboot</a></span><sup><small>AUR</small></sup> składa się z haka instalacyjnego i haka uruchomieniowego dla mkinitcpio. Hook instalacyjny uruchamia się za każdym razem, gdy initramfs jest przebudowywany i miesza skrót GRUB <a href="../../en/Unified_Extensible_Firmware_Interface.html" class="mw-redirect" title="EFI">EFI</a> <code>$esp/EFI/grub_uefi/grubx64.efi</code>) (w przypadku systemów <a href="../../en/Unified_Extensible_Firmware_Interface.html" class="mw-redirect" title="UEFI">UEFI</a>) lub pierwsze 446 bajtów dysku, na którym zainstalowany jest GRUB (w przypadku systemów BIOS) i przechowuje wartości mieszania wewnątrz initramfs zlokalizowanych wewnątrz partycji zaszyfrowanej / <code>/boot</code>. Po uruchomieniu systemu GRUB pyta o hasło <code>/boot</code>, a następnie wywołuje tę samą operację skrótu i porównuje wynikowe hashy, zanim poprosi o hasło do partycji głównej. Jeśli nie pasują, hak wyświetli następujący błąd:
</p>
<pre>CHKCRYPTOBOOT ALERT!
CHANGES HAVE BEEN DETECTED IN YOUR BOOT LOADER EFISTUB!
YOU ARE STRONGLY ADVISED NOT TO ENTER YOUR ROOT CONTAINER PASSWORD!
Please type uppercase yes to continue:
</pre>
<p>Oprócz skrótu programu ładującego, hak sprawdza również parametry działającego jądra względem tych skonfigurowanych w pliku <code>/etc/default/chkcryptoboot.conf</code>. Jest to sprawdzane zarówno w czasie wykonywania, jak i po zakończeniu procesu rozruchu. Pozwala to haczykowi wykryć, czy konfiguracja GRUB-a nie została ominięta w czasie wykonywania, a następnie wykryć, czy cała partycja  {ic|/boot}} nie została ominięta.
</p>
<p>W systemach BIOS hak tworzy hash pierwszego bootloadera GRUB-a (instalowanego do pierwszych 446 bajtów urządzenia rozruchowego) w celu porównania w późniejszych procesach rozruchowych. Główny drugi etap GRUB-a bootloadera <code>core.img</code> nie jest sprawdzany.
</p>
<h3><span class="mw-headline" id="Inne_metody">Inne metody</span></h3>
<p>Alternatywnie do powyższych skryptów można skonfigurować za pomocą <a href="../../en/AIDE.html" title="AIDE">AIDE</a>, którą można dostosować za pomocą bardzo elastycznego pliku konfiguracyjnego.
</p>
<p>Chociaż jedna z tych metod powinna służyć większości użytkowników, nie rozwiązuje ona wszystkich problemów związanych z bezpieczeństwem związanym z niezaszyfrowaną partycją <code>/boot</code>. Jedno podejście, które stara się zapewnić w pełni uwierzytelniony łańcuch rozruchowy, zostało opublikowane w POTTS jako praca naukowa w celu wdrożenia struktury uwierzytelniania <a rel="nofollow" class="external text" href="https://www1.informatik.uni-erlangen.de/stark">STARK</a>.
</p>
<p>Potwierdzenie koncepcji POTTS wykorzystuje Arch Linux jako podstawową dystrybucję i implementuje łańcuch rozruchowy systemu
</p>
<ul>
<li>POTTS - menu startowe dla monitu o jednorazowe potwierdzenie uwierzytelnienia</li>
<li>TrustedGrub - a implementacja <a href="../../en/GRUB_Legacy.html" title="GRUB Legacy">GRUB Legacy</a>, która uwierzytelnia jądro i initramfs względem rejestrów układów TPM</li>
<li>TRESOR - łatka jądra, która implementuje AES, ale utrzymuje klucz główny nie w pamięci RAM, ale w rejestrach procesora podczas pracy.</li>
</ul>
<p>As part of the thesis <a rel="nofollow" class="external text" href="http://13.tc/p/potts/manual.html">installation</a> instructions based on Arch Linux (ISO as of 2013-01) have been published. If you want to try it, be aware these tools are not in standard repositories and the solution will be time consuming to maintain.
</p>
<p>W ramach pracy zostały opublikowane instrukcje <a rel="nofollow" class="external text" href="http://13.tc/p/potts/manual.html">instalacji</a> oparte na Arch Linux (ISO od 2013-01). Jeśli chcesz go wypróbować, pamiętaj, że te narzędzia nie znajdują się w standardowych repozytoriach, a rozwiązanie będzie wymagało czasu.
</p>
<h2>
<span id="U.C5.BCywanie_zaszyfrowanych_plik.C3.B3w_kluczy_GPG.2C_LUKS_lub_OpenSSL"></span><span class="mw-headline" id="Używanie_zaszyfrowanych_plików_kluczy_GPG,_LUKS_lub_OpenSSL">Używanie zaszyfrowanych plików kluczy GPG, LUKS lub OpenSSL</span>
</h2>
<p>następujące posty na forum podają instrukcje użycia uwierzytelniania dwuetapowego, gpg lub openssl zaszyfrowanych kluczy, zamiast pliku klucza tekstowego opisanego wcześniej w tym artykule wiki <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=120243">System Encryption using LUKS with GPG encrypted keys</a>:
</p>
<ul>
<li>GnuPG: <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=943338#p943338">Post regarding GPG encrypted keys</a> Ten post zawiera ogólne instrukcje.</li>
<li>OpenSSL: <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=947805#p947805">Post regarding OpenSSL encrypted keys</a> Ten post ma tylko <code>ssldec</code> haki.</li>
<li>OpenSSL: <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=155393">Post regarding OpenSSL salted bf-cbc encrypted keys</a> Ten post ma <code>bfkf</code> initcpio przechwytuje, instaluje i zaszyfrowane skrypty generujące skrypty keyfile.</li>
<li>LUKS: <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1502651#p1502651">Post regarding LUKS encrypted keys</a> z <code>lukskey</code> hakiem initcpio. Lub <a href="#Szyfrowanie_/boot_i_od%C5%82%C4%85czony_nag%C5%82%C3%B3wek_LUKS_na_USB">#Szyfrowanie /boot i odłączony nagłówek LUKS na USB</a> poniżej z niestandardowym hakiem do szyfrowania dla initcpio.</li>
</ul>
<p>Zauważ, że:
</p>
<ul><li>Możesz wykonać powyższe instrukcje tylko z dwiema partycjami podstawowymi, jedną partycją rozruchową (wymaganą z powodu szyfrowania) i jedną podstawową partycją LVM. Na partycji LVM możesz mieć tyle partycji, ile potrzebujesz, ale co najważniejsze powinna zawierać przynajmniej partycje woluminu root, swap i home logical wolumin. Dodatkową zaletą jest posiadanie tylko jednego pliku klucza dla wszystkich partycji oraz możliwość hibernacji komputera (zawieszenie na dysk), w którym partycja wymiany jest szyfrowana. Jeśli zdecydujesz się na to, twoje haki w <code>/etc/mkinitcpio.conf</code> powinny wyglądać tak:<pre>HOOKS=( ... usb usbinput (etwo or ssldec) encrypt (if using openssl) lvm2 resume ... )</pre> i powinieneś dodać</li></ul>
<pre>resume=/dev/&lt;VolumeGroupName&gt;/&lt;LVNameOfSwap&gt;</pre>
<p> do <a href="../../en/Kernel_parameters.html" title="Kernel parameters">parametrów jądra</a>.
</p>
<ul>
<li>Jeśli musisz tymczasowo przechowywać zaszyfrowany plik klucza gdzieś, nie przechowuj ich na niezaszyfrowanym dysku. Nawet lepiej pamiętaj o zapisaniu ich w pamięci RAM, takich jak <code>/dev/shm</code>
</li>
<li>Jeśli chcesz użyć pliku klucza szyfrowanego GPG, musisz użyć statycznie skompilowanej wersji GnuPG 1.4 lub możesz edytować haki i użyć tego pakietu AUR <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/gnupg1/">gnupg1</a></span><sup><small>AUR</small></sup>
</li>
<li>Możliwe, że aktualizacja OpenSSL może przerwać niestandardowe <code>ssldec</code> wymienione w drugim poście na forum.</li>
</ul>
<h2>
<span id="Zdalne_odblokowanie_partycji_root_.28lub_innej.29"></span><span class="mw-headline" id="Zdalne_odblokowanie_partycji_root_(lub_innej)">Zdalne odblokowanie partycji root (lub innej)</span>
</h2>
<p>Jeśli chcesz móc zdalnie ponownie uruchomić system w pełni zaszyfrowany LUKS lub uruchomić go za pomocą usługi <a href="../../en/Wake-on-LAN.html" title="Wake-on-LAN">Wake-on-LAN</a> będziesz potrzebował sposobu na wprowadzenie hasła dla partycji / woluminu root podczas uruchamiania. Można to osiągnąć, uruchamiając hak <a href="../../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a>, który konfiguruje interfejs sieciowy. Niektóre pakiety wymienione poniżej udostępniają różne <a href="../../en/Mkinitcpio.html#Build_hooks" title="Mkinitcpio">konfiguracje mkinitcpio</a> w celu ułatwienia konfiguracji.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Pamiętaj, aby używać nazw urządzeń jądra dla interfejsu sieciowego (np. <code>eth0</code>)), a nie dla <a href="../../en/Udev.html" title="Udev">udev's</a> (np. <code>enp1s0</code>), ponieważ te nie będą działać.</li>
<li>Konieczne może być dodanie modułu dla karty sieciowej <a href="../../en/Network_configuration/Ethernet.html#Device_driver" title="Network configuration/Ethernet">ethernet</a> lub <a href="../../en/Network_configuration/Wireless.html#Device_driver" title="Network configuration/Wireless">bezprzewodowej</a> do tablicy <a href="../../en/Mkinitcpio.html#MODULES" title="Mkinitcpio">MODULES</a>.</li>
</ul>
</div>
<h3>
<span id="Zdalne_odblokowanie_.28haki:_systemd.2C_systemd-tool.29"></span><span class="mw-headline" id="Zdalne_odblokowanie_(haki:_systemd,_systemd-tool)">Zdalne odblokowanie (haki: systemd, systemd-tool)</span>
</h3>
<p>AUR pakiet <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-systemd-tool">mkinitcpio-systemd-tool</a></span> zapewnia <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd">systemd</a></span>-centric mkinitcpio hook o nazwie <i>systemd-tool</i> z następującym zestawem funkcji dla systemd w initramfs:
</p>
<table class="wikitable">

<tbody><tr style="vertical-align:top;">
<td width="50%" style="padding:10px;">
<p>Podstawowe funkcje zapewniane przez hak:
</p>
<ul>
<li>ujednolicona konfiguracja systemd + mkinitcpio</li>
<li>automatyczne przydzielanie zasobów binarnych i konfiguracyjnych</li>
<li>wywoływanie skryptów mkinitcpio i funkcji wbudowanych na żądanie</li>
</ul>
</td>
<td width="50%" style="padding:10px;">
<p>Funkcje oferowane przez dołączone jednostki serwisowe:
</p>
<ul>
<li>initrd debugging</li>
<li>wczesna konfiguracja sieci</li>
<li>interaktywna powłoka użytkownika</li>
<li>zdalny dostęp ssh w initrd</li>
<li>cryptsetup + niestandardowy agent hasła</li>
</ul>
</td>
</tr></tbody>
</table>
<p>Pakiet <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-systemd-tool">mkinitcpio-systemd-tool</a></span> wymaga <a href="../../en/Mkinitcpio.html#Common_hooks" title="Mkinitcpio">haka systemowego</a>. Aby uzyskać więcej informacji, zapoznaj się z plikiem <a rel="nofollow" class="external text" href="https://github.com/random-archer/mkinitcpio-systemd-tool/blob/master/README.md">README</a> projektu oraz dostępnymi domyślnymi <a rel="nofollow" class="external text" href="https://github.com/random-archer/mkinitcpio-systemd-tool">plikami jednostek usług systemowych</a>, aby rozpocząć.
</p>
<p>Zalecane haki to: <code>base autodetect modconf block filesystems keyboard fsck systemd systemd-tool</code>.
</p>
<h3>
<span id="Zdalne_odblokowanie_.28haki:_netconf.2C_dropbear.2C_tinyssh.2C_ppp.29"></span><span class="mw-headline" id="Zdalne_odblokowanie_(haki:_netconf,_dropbear,_tinyssh,_ppp)">Zdalne odblokowanie (haki: netconf, dropbear, tinyssh, ppp)</span>
</h3>
<p>Inną kombinacją pakietów zapewniającą zdalne logowanie do initcpio jest <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-netconf">mkinitcpio-netconf</a></span> i <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-ppp/">mkinitcpio-ppp</a></span><sup><small>AUR</small></sup> (do zdalnego odblokowania za pomocą połączenia <a href="https://en.wikipedia.org/wiki/Point-to-Point_Protocol" class="extiw" title="wikipedia:Point-to-Point Protocol">PPP</a> przez Internet) along w z serwerem <a href="../../en/Secure_Shell.html" class="mw-redirect" title="SSH">SSH</a>. Możesz użyć albo <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-dropbear">mkinitcpio-dropbear</a></span> lub <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-tinyssh">mkinitcpio-tinyssh</a></span>. Te haki nie instalują żadnej powłoki, więc musisz także <a href="../../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">zainstalować</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-utils">mkinitcpio-utils</a></span>pakiet. Poniższe instrukcje mogą być używane w dowolnej kombinacji powyższych pakietów. Gdy istnieją różne ścieżki, zostanie to odnotowane.
</p>
<ol>
<li>Jeśli nie masz jeszcze pary kluczy SSH, <a href="../../en/SSH_keys.html#Generating_an_SSH_key_pair" title="SSH keys">wygeneruj</a> ją w systemie klienta (tym, który będzie używany do odblokowania zdalnego komputera). Jeśli zdecydujesz się użyć <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-tinyssh">mkinitcpio-tinyssh</a></span>, masz możliwość użycia klawiszy <a href="../../en/SSH_keys.html#Ed25519" title="SSH keys">Ed25519 keys</a>.</li>
<li>Wstaw swój klucz publiczny SSH (tj. Ten, który zwykle umieszczasz na hostach, abyś mógł wejść bez hasła lub tego, które właśnie utworzyłeś i który kończy się na .pub) do pliku <code>/etc/dropbear/root_key</code> lub <code>/etc/tinyssh/root_key</code>. <div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Ta metoda może później zostać użyta do dodania innych kluczy publicznych SSH w razie potrzeby; W przypadku zwykłego skopiowania zawartości plików <code>~/.ssh/authorized_keys</code>, należy sprawdzić, czy zawiera on tylko klucze, których zamierzasz użyć do odblokowania zdalnego komputera. Dodając dodatkowe klucze, zregeneruj swój initrd również za pomocą <code>mkinitcpio</code>. Zobacz też <a href="../../en/OpenSSH.html#Protection" title="OpenSSH">OpenSSH#Protection</a>.</div>
</li>
<li>Dodaj wszystkie trzy <code>&lt;netconf and/or ppp&gt; &lt;dropbear lub tinyssh&gt; encryptssh</code> <a href="../../en/Mkinitcpio.html#HOOKS" title="Mkinitcpio">hooks</a> przed <code>filesystems</code> w tablicy "HOOKS" w <code>/etc/mkinitcpio.conf</code> (<code>encryptssh</code> zastępuje hook <code>encrypt</code>). Następnie zregeneruj <a href="../../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">initramfs</a>. <div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Hak <code>net</code> dostarczony przez <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-nfs-utils">mkinitcpio-nfs-utils</a></span> nie jest potrzebny.</div>
</li>
<li>Skonfiguruj wymagany parametr <code>cryptdevice=</code> dodaj <a href="../../en/Dm-crypt/System_configuration.html#Kernel_parameters" title="Dm-crypt/System configuration">parametr</a> polecenia <code>ip=</code> <a href="../../en/Kernel_parameters.html" title="Kernel parameters">parametr komendy jądra</a> do bootloadera za pomocą odpowiednich argumentów. Na przykład, jeśli serwer DHCP nie przypisuje statycznego adresu IP do systemu zdalnego, co utrudnia dostęp przez SSH po ponownym uruchomieniu, można jawnie podać adres IP, który ma być używany <pre>ip=192.168.1.1:::::eth0:none</pre>Alternatywnie można również określić maskę podsieci i bramę wymaganą przez sieć:<pre>ip=192.168.1.1::192.168.1.254:255.255.255.0::eth0:none</pre> <div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Od wersji 0.0.4 programu <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-netconf">mkinitcpio-netconf</a></span> można zagnieżdżać wiele parametrów <code>ip=</code>  w celu skonfigurowania wielu interfejsów. Nie można mieszać go z <code>ip=dhcp</code> (<code>ip=:::::eth0:dhcp</code>) sam. Interfejs musi zostać określony.</div>
<pre>ip=ip=192.168.1.1:::::eth0:none:ip=172.16.1.1:::::eth1:none</pre> Aby uzyskać szczegółowy opis, spójrz na odpowiednią <a href="../../en/Mkinitcpio.html#Using_net" title="Mkinitcpio">sekcję mkinitcpio</a>. Po zakończeniu zaktualizuj konfigurację swojego <a href="../../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">bootloadera</a>.</li>
<li>Na koniec zrestartuj system zdalny i spróbuj <a href="../../en/OpenSSH.html#Client_usage" title="OpenSSH">ssh do niego</a>, <b>jawnie określając nazwę użytkownika "root"</b> (nawet jeśli konto root jest wyłączone na komputerze, ten użytkownik root jest używany tylko w initrd w celu odblokowania systemu zdalnego). Jeśli korzystasz z pakietu <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-dropbear">mkinitcpio-dropbear</a></span> i masz zainstalowany pakiet <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span>, najprawdopodobniej nie otrzymasz żadnych ostrzeżeń przed zalogowaniem się, ponieważ konwertuje on i używa tych samych kluczy hosta, co używa openssh (oprócz kluczy Ed25519, ponieważ dropbear ich nie obsługuje). Jeśli używasz <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-tinyssh">mkinitcpio-tinyssh</a></span>, masz możliwość zainstalowania <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tinyssh-convert">tinyssh-convert</a></span><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">broken link</a>: replaced by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tinyssh">tinyssh</a></span>]</sup> lub <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/tinyssh-convert-git/">tinyssh-convert-git</a></span><sup><small>AUR</small></sup>, dzięki czemu możesz użyć tych samych kluczy, co twoja instalacja <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span> (obecnie tylko klucze Ed25519). W obu przypadkach powinieneś uruchomić <a href="../../en/OpenSSH.html#Daemon_management" title="OpenSSH">demona ssh</a> przynajmniej raz, używając dostarczonych jednostek systemd, aby klucze mogły zostać wygenerowane jako pierwsze. Po ponownym uruchomieniu komputera pojawi się monit o podanie hasła w celu odblokowania urządzenia root. System zakończy proces uruchamiania, a następnie możesz ssh do niego, <a href="../../en/OpenSSH.html#Client_usage" title="OpenSSH">jak zwykle</a> (z wybranym użytkownikiem zdalnym).</li>
</ol>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Jeśli chcesz po prostu dobre rozwiązanie do zdalnego montowania innych zaszyfrowanych partycji (takich jak <code>/home</code>), możesz zajrzeć do [<a rel="nofollow" class="external free" href="https://bbs.archlinux.org/viewtopic.php?pid=880484">https://bbs.archlinux.org/viewtopic.php?pid=880484</a> tego wątku na forum.</div>
<h3>
<span id="Zdalne_odblokowanie_przez_Wi-Fi_.28haki:_buduj_w.C5.82asne.29"></span><span class="mw-headline" id="Zdalne_odblokowanie_przez_Wi-Fi_(haki:_buduj_własne)">Zdalne odblokowanie przez Wi-Fi (haki: buduj własne)</span>
</h3>
<p>Hak sieciowy jest zwykle używany z połączeniem ethernetowym. Jeśli chcesz skonfigurować komputer tylko z siecią bezprzewodową i odblokować go przez Wi-Fi, możesz utworzyć niestandardowy hak, aby połączyć się z siecią Wi-Fi przed uruchomieniem haka sieciowego.
</p>
<p>Poniższy przykład pokazuje konfigurację za pomocą adaptera USB, łączącego się z siecią Wi-Fi chronioną WPA2-PSK. Jeśli użyjesz na przykład WEP lub innego programu ładującego, być może będziesz musiał zmienić niektóre rzeczy.
</p>
<ol>
<li>Zmodyfikuj <code>/etc/mkinitcpio.conf</code>:
<ul>
<li>Dodaj potrzebny moduł jądra do konkretnego adaptera Wi-Fi</li>
<li>Dołącz pliki binarne <code>wpa_passphrase</code> i <code>wpa_supplicant</code>.</li>
<li>Dodaj hak <code>wifi</code> (lub nazwę do wyboru, jest to niestandardowy hak, który zostanie utworzony) przed hakiem <code>net</code>. <pre>MODULES=(<i>module</i>)<br>BINARIES=(wpa_passphrase wpa_supplicant)<br>HOOKS=(base udev autodetect ... <b>wifi</b> net ... dropbear encryptssh ...)</pre>
</li>
</ul>
</li>
<li>Utwórz hak <code>wifi</code>  w <code>/etc/initcpio/hooks/wifi</code>: <pre>run_hook ()<br>{<br>	# sleep a couple of seconds so wlan0 is setup by kernel<br>	sleep 5<br><br>	# set wlan0 to up<br>	ip link set wlan0 up<br><br>	# assocciate with wifi network<br>	# 1. save temp config file<br>	wpa_passphrase "<i>network ESSID</i>" "<i>pass phrase</i>" &gt; /tmp/wifi<br><br>	# 2. assocciate<br>	wpa_supplicant -B -D nl80211,wext -i wlan0 -c /tmp/wifi<br><br>	# sleep a couple of seconds so that wpa_supplicant finishes connecting<br>	sleep 5<br><br>	# wlan0 should now be connected and ready to be assigned an ip by the net hook<br>}<br><br>run_cleanuphook ()<br>{<br>	# kill wpa_supplicant running in the background<br>	killall wpa_supplicant<br><br>	# set wlan0 link down<br>	ip link set wlan0 down<br><br>	# wlan0 should now be fully disconnected from the wifi network<br>}</pre>
</li>
<li>Utwórz plik instalacyjny hook w <code>/etc/initcpio/install/wifi</code>: <pre>build ()<br>{<br>	add_runscript<br>}<br>help ()<br>{<br>cat&lt;&lt;HELPEOF<br>	Enables wifi on boot, for dropbear ssh unlocking of disk.<br>HELPEOF<br>}</pre>
</li>
<li>Dodaj <code>ip=:::::wlan0:dhcp</code> do <a href="../../en/Kernel_parameters.html" title="Kernel parameters">parametrów jądra</a>. Usuń <code>ip=:::::eth0:dhcp</code>, aby nie było konfliktu.</li>
<li>Opcjonalnie utwórz dodatkowy wpis rozruchowy z parametrem jądra <code>ip=:::::eth0:dhcp</code>.</li>
<li>
<a href="../../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">Zregenerować initramfs</a>.</li>
<li>Update the configuration of your <a href="../../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a>.</li>
</ol>
<p>Pamiętaj, aby skonfigurować <a href="../../en/Network_configuration/Wireless.html" class="mw-redirect" title="Wifi">wifi</a>, aby móc zalogować się po pełnym uruchomieniu systemu. Jeśli nie możesz połączyć się z siecią Wi-Fi, spróbuj nieco wydłużyć czas uśpienia.
</p>
<h2>
<span id="Obs.C5.82uga_Discard_.2F_TRIM_dla_dysk.C3.B3w_p.C3.B3.C5.82przewodnikowych_.28SSD.29"></span><span class="mw-headline" id="Obsługa_Discard_/_TRIM_dla_dysków_półprzewodnikowych_(SSD)">Obsługa Discard / TRIM dla dysków półprzewodnikowych (SSD)</span>
</h2>
<p>Użytkownicy <a href="../../en/Solid_state_drive.html" title="Solid state drive">solid state drive</a>  powinni mieć świadomość, że domyślnie polecenia TRIM nie są włączane przez urządzenie mapujące urządzenia, tj. Urządzenia blokowe są montowane bez opcji <code>discard</code> chyba że zastąpi się domyślną.
</p>
<p>Opiekunowie device-mapper wyraźnie dali do zrozumienia, że obsługa TRIM nigdy nie będzie domyślnie włączona na urządzeniach dm-crypt ze względu na potencjalne konsekwencje dla bezpieczeństwa <a rel="nofollow" class="external autonumber" href="http://www.saout.de/pipermail/dm-crypt/2011-September/002019.html">[3]</a><a rel="nofollow" class="external autonumber" href="http://www.saout.de/pipermail/dm-crypt/2012-April/002420.html">[4]</a> Minimalny wyciek danych w postaci uwolnionych informacji blokowych, być może wystarczających do określenia używanego systemu plików, może wystąpić na urządzeniach z włączoną obsługą TRIM. Ilustracja i omówienie problemów wynikających z aktywacji TRIM jest dostępna na <a rel="nofollow" class="external text" href="https://asalor.blogspot.de/2011/08/trim-dm-crypt-problems.html">blogu</a> programisty cryptsetup. Jeśli obawiasz się o takie czynniki, pamiętaj, że zagrożenia mogą się sumować: na przykład, jeśli Twoje urządzenie jest nadal szyfrowane za pomocą domyślnego szyfrowania (cryptsetup &lt;1.6.0) <code>--cipher aes-cbc-essiv</code>, więcej informacji wyciek może nastąpić więcej wycieków informacji z przyciętej obserwacji sektora niż z bieżącą wartością <a href="../../pl/Dm-crypt/Device_encryption.html#Opcje_szyfrowania_dla_trybu_LUKS" title="Dm-crypt (Polski)/Device encryption (Polski)">domyślną</a>.
</p>
<p>Można wyróżnić następujące przypadki:
</p>
<ul><li>Urządzenie jest szyfrowane za pomocą domyślnego trybu LUKS dm-crypt:
<ul>
<li>Domyślnie nagłówek LUKS jest przechowywany na początku urządzenia, a użycie polecenia TRIM jest przydatne do ochrony modyfikacji nagłówka. Jeśli na przykład zhakowane hasło LUKS zostanie odwołane, bez TRIM stary nagłówek będzie ogólnie dostępny do odczytu aż do nadpisania przez inną operację; jeśli dysk zostanie skradziony w międzyczasie, atakujący mogą teoretycznie znaleźć sposób na zlokalizowanie starego nagłówka i użyć go do odszyfrowania zawartości za pomocą złamanego hasła. Zobacz <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions#5-security-aspects">cryptsetup FAQ, section 5.19 What about SSDs, Flash and Hybrid Drives?</a> i <a rel="nofollow" class="external text" href="https://www.reddit.com/r/archlinux/comments/2f370s/full_disk_encryption_on_an_ssd/ck5p5c5">Full disk encryption on an ssd</a>.</li>
<li>TRIM można pozostawić wyłączony, jeśli problemy bezpieczeństwa wymienione w górnej części tej sekcji są uważane za gorsze zagrożenie niż powyższy punkt.</li>
</ul>
</li></ul>
<dl><dd>Zobacz też <a href="../../en/Securely_wipe_disk.html#Flash_memory" title="Securely wipe disk">Securely wipe disk#Flash memory</a>.</dd></dl>
<ul><li>Urządzenie jest szyfrowane w trybie zwykłym dm-crypt lub nagłówek LUKS jest przechowywany <a href="#Szyfrowany_system_za_pomoc%C4%85_oddzielnego_nag%C5%82%C3%B3wka_LUKS">osobno</a>:
<ul>
<li>Jeśli wymagana wiarygodność jest wymagana, TRIM <b>nigdy</b> nie powinien być używany ze względu na rozważania u góry tej sekcji lub użycie szyfrowania zostanie podane.</li>
<li>Jeśli wiarygodna zaprzeczalność nie jest wymagana, TRIM może być wykorzystany do zwiększenia wydajności, pod warunkiem, że zagrożenia bezpieczeństwa opisane na początku tej sekcji nie budzą obaw.</li>
</ul>
</li></ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Przed włączeniem TRIM na dysku upewnij się, że urządzenie w pełni obsługuje polecenia TRIM lub może nastąpić utrata danych. Zobacz <a href="../../en/Solid_state_drive.html#TRIM" class="mw-redirect" title="Solid State Drives">Solid State Drives#TRIM</a>.</div>
<p>W <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> 3.1 i nowszych, obsługa przejścia tranzytowego TRM w dm-crypt może być przełączana podczas tworzenia urządzenia lub montowania za pomocą polecenia dmsetup. Obsługa tej opcji istnieje również w wersji <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span> 1.4.0  i nowszych. Aby dodać obsługę podczas rozruchu, musisz dodać: <code>:allow-discards</code>  do opcji <code>cryptdevice</code>. Opcja TRIM może wyglądać następująco:
</p>
<pre>cryptdevice=/dev/sdaX:root:allow-discards
</pre>
<p>Dla głównych opcji konfiguracyjnych <code>cryptdevice</code> przed: <code>:allow-discards</code> zobacz <a href="../../en/Dm-crypt/System_configuration.html" title="Dm-crypt/System configuration">Dm-crypt/System configuration</a>.
</p>
<p>Jeśli używasz initrd opartego na systemd, musisz przekazać:
</p>
<pre>rd.luks.options=discard
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Opcja <code>rd.luks.options=discard</code> kernel nie ma żadnego wpływu na urządzenia zawarte w pliku <code>/etc/crypttab</code> pliku obrazu initramfs (<code>/etc/crypttab.initramfs</code> na prawdziwym root). Musisz podać opcję <code>discard</code>  w <code>/etc/crypttab.initramfs</code>.</div>
<p>Oprócz opcji jądra, wymagane jest również okresowe uruchamianie <code>fstrim</code> lub montowanie systemu plików (np. <code>/dev/mapper/root</code> w tym przykładzie) z opcją <code>discard</code> w <code>/etc/fstab</code>. Szczegółowe informacje można znaleźć na stronie <a href="../../en/Solid_state_drive.html#TRIM" class="mw-redirect" title="TRIM">TRIM</a>.
</p>
<p>Dla urządzeń LUKS odblokowanych przez <code>/etc/crypttab</code> użyj opcji <code>discard</code>, np .:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">luks-123abcdef-etc UUID=123abcdef-etc none discard</pre>
<p>Gdy odblokowujesz ręcznie urządzenia na konsoli, użyj <code>--allow-discards</code>.
</p>
<p>W LUKS2 możesz ustawić opcję <code>allow-discards</code>  jako flagę domyślną dla urządzenia, otwierając ją raz z opcją <code>--persistent</code>:
</p>
<pre># cryptsetup --allow-discards --persistent open --type luks2 /dev/sdaX root
</pre>
<p>Możesz potwierdzić, że flaga jest ustawiona trwale w nagłówku LUKS2, patrząc na wynik <code>cryptsetup luksDump</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksDump /dev/sdaX | grep Flags</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Flags:          allow-discards
</pre>
<p>W każdym przypadku możesz sprawdzić, czy urządzenie faktycznie zostało otwarte z odrzutami, sprawdzając wynik <code>dmsetup table</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># dmsetup table</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">luks-123abcdef-etc: 0 1234567 crypt aes-xts-plain64 000etc000 0 8:2 4096 1 allow_discards
</pre>
<h2>
<span id="Szyfrowanie_hakiem_i_wiele_dysk.C3.B3w"></span><span class="mw-headline" id="Szyfrowanie_hakiem_i_wiele_dysków">Szyfrowanie hakiem i wiele dysków</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> <code>sd-encrypt</code> hook obsługuje odblokowywanie wielu urządzeń. Można je podać w wierszu komend jądra lub w <code>/etc/crypttab.initramfs</code>. Zobacz <a href="../../en/Dm-crypt/System_configuration.html#Using_encrypt_hook" title="Dm-crypt/System configuration">dm-crypt/System configuration#Using encrypt hook</a>.</div>
<p>Szyfrowanie pozwala tylko na pojedynczy wpis <code>cryptdevice=</code> <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/23182">FS#23182</a>). W konfiguracjach systemowych z wieloma napędami może to być ograniczenie, ponieważ <i>dm-crypt</i> nie ma funkcji, która mogłaby przekroczyć fizyczne urządzenie. Na przykład w "LVM na LUKS": Cała LVM istnieje wewnątrz LUKS mapper. Jest to całkowicie w porządku dla systemu z jednym napędem, ponieważ istnieje tylko jedno urządzenie do odszyfrowania. Ale co się stanie, gdy chcesz zwiększyć rozmiar LVM? Nie możesz, przynajmniej nie bez modyfikowania haka <code>encrypt</code>.
</p>
<p>W poniższych sekcjach krótko pokazano alternatywne rozwiązania, aby przezwyciężyć ograniczenie. Pierwszy dotyczy sposobu rozszerzenia <a href="../../pl/Dm-crypt/Encrypting_an_entire_system.html#LUKS_na_LVM" title="Dm-crypt (Polski)/Encrypting an entire system (Polski)">LUKS na instalację LVM</a> na nowy dysk. Drugi z modyfikowaniem haka <code>encrypt</code> w celu odblokowania wielu dysków w konfiguracjach LUKS bez LVM.
</p>
<h3><span class="mw-headline" id="Rozszerzanie_LVM_na_wielu_dyskach">Rozszerzanie LVM na wielu dyskach</span></h3>
<p>Zarządzanie wieloma dyskami jest podstawową funkcją <a href="../../en/LVM.html" title="LVM">LVM</a> i główną przyczyną elastyczności partycjonowania. Może być również używany z <i>dm-crypt</i>, ale tylko wtedy, gdy LVM jest używany jako pierwszy element odwzorowujący. W takich <a href="../../pl/Dm-crypt/Encrypting_an_entire_system.html#LUKS_na_LVM" title="Dm-crypt (Polski)/Encrypting an entire system (Polski)">LUKS na instalacji LVM</a> LVM zaszyfrowane urządzenia są tworzone wewnątrz woluminów logicznych (z oddzielnym hasłem/kluczem na wolumin). Poniżej opisano kroki mające na celu rozszerzenie tej konfiguracji na inny dysk.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Utworzyć kopię zapasową! Chociaż zmiana rozmiaru systemów plików może być standardowa, należy pamiętać, że operacje mogą się nie udać, a poniższe mogą nie mieć zastosowania w konkretnej instalacji. Ogólnie rzecz biorąc, rozszerzenie systemu plików na wolne miejsce na dysku jest mniej problematyczne niż jego zmniejszenie. Dotyczy to w szczególności, gdy używane są ułożone elementy odwzorowujące, jak to ma miejsce w następnym przykładzie.</div>
<h4><span class="mw-headline" id="Dodanie_nowego_dysku">Dodanie nowego dysku</span></h4>
<p>Po pierwsze, może być pożądane przygotowanie nowego dysku zgodnie z przygotowaniem <a href="../../pl/Dm-crypt/Drive_preparation.html" title="Dm-crypt (Polski)/Drive preparation (Polski)">dm-crypt (Polski)/Drive preparation (Polski)</a>. Po drugie, jest podzielony na partycje jako LVM, np. cała przestrzeń jest przydzielona do <code>/dev/sdY1</code> z typem partycji <code>8E00</code> (Linux LVM). Po trzecie, nowy dysk/partycja jest dołączona do istniejącej grupy woluminów LVM, np.:
</p>
<pre># pvcreate /dev/sdY1
# vgextend MyStorage /dev/sdY1
</pre>
<h4><span class="mw-headline" id="Rozszerzanie_woluminu_logicznego">Rozszerzanie woluminu logicznego</span></h4>
<p>W kolejnym kroku, przydział nowej przestrzeni dyskowej, wolumin logiczny, który ma zostać rozszerzony, musi zostać odłączony. Można go wykonać dla partycji root <code>cryptdevice</code> ale w tym przypadku procedurę należy wykonać z poziomu Arch Install ISO.
</p>
<p>W tym przykładzie zakłada się, że wolumin logiczny dla <code>/home</code> ((lv-name <code>homevol</code>) zostanie rozszerzony o świeżą przestrzeń dyskową:
</p>
<pre># umount /home
# fsck /dev/mapper/home
# cryptsetup luksClose /dev/mapper/home
# lvextend -l +100%FREE MyStorage/homevol
</pre>
<p>Teraz wolumen logiczny jest rozszerzony, a kontener LUKS jest następny:
</p>
<pre># cryptsetup open /dev/MyStorage/homevol home
# umount /home      # as a safety, in case it was automatically remounted
# cryptsetup --verbose resize home
</pre>
<p>Wreszcie, sam system plików jest zmieniany:
</p>
<pre># e2fsck -f /dev/mapper/home
# resize2fs /dev/mapper/home
</pre>
<p>Gotowe! Jeśli poszedł do planu, <code>/home</code> można ponownie złożyć i obejmuje teraz zakres na nowy dysk:
</p>
<pre># mount /dev/mapper/home /home
</pre>
<p>Zauważ, że zmiana <code>cryptsetup resize</code> nie wpływa na klucze szyfrowania, a te nie uległy zmianie.
</p>
<h3>
<span id="Modyfikowanie_hak.C3.B3w_szyfrowania_dla_wielu_partycji"></span><span class="mw-headline" id="Modyfikowanie_haków_szyfrowania_dla_wielu_partycji">Modyfikowanie haków szyfrowania dla wielu partycji</span>
</h3>
<h4>
<span id="G.C5.82.C3.B3wny_system_plik.C3.B3w_obejmuj.C4.85cy_wiele_partycji"></span><span class="mw-headline" id="Główny_system_plików_obejmujący_wiele_partycji">Główny system plików obejmujący wiele partycji</span>
</h4>
<p>Możliwe jest zmodyfikowanie haka szyfrowania, aby umożliwić odszyfrowanie root'a (<code>/</code>) podczas startu systemu. Jeden sposób:
</p>
<pre># cp /usr/lib/initcpio/install/encrypt /etc/initcpio/install/encrypt2
# cp /usr/lib/initcpio/hooks/encrypt  /etc/initcpio/hooks/encrypt2
# sed -i "s/cryptdevice/cryptdevice2/" /etc/initcpio/hooks/encrypt2
# sed -i "s/cryptkey/cryptkey2/" /etc/initcpio/hooks/encrypt2
</pre>
<p>Dodaj <code>cryptdevice2=</code>  do swoich opcji rozruchowych (i <code>cryptkey2=</code> w razie potrzeby), i dodaj hook <code>encrypt2</code> do swojego pliku <a href="../../en/Mkinitcpio.html#Configuration" class="mw-redirect" title="Mkinitcpio.conf">mkinitcpio.conf</a> przed jego odbudowaniem. Zobacz <a href="../../en/Dm-crypt/System_configuration.html" title="Dm-crypt/System configuration">dm-crypt/System configuration</a>.
</p>
<h4>
<span id="Wiele_partycji_innych_ni.C5.BC_root"></span><span class="mw-headline" id="Wiele_partycji_innych_niż_root">Wiele partycji innych niż root</span>
</h4>
<p>Być może masz wymóg korzystania z <code>encrypt</code> przechwytywania na partycji innej niż root. Arch nie obsługuje tego z pudełka, ale możesz łatwo zmienić wartości cryptdev i cryptname w <code>/lib/initcpio/hooks/encrypt</code> (pierwszy na partycję <code>/dev/sd*</code>, drugi na nazwę, którą chcesz przypisywać). To powinno wystarczyć.
</p>
<p>Dużą zaletą jest to, że możesz mieć wszystko zautomatyzowane, podczas gdy konfiguracja <code>/etc/crypttab</code> z zewnętrznym plikiem klucza (np. Plik klucza nie znajduje się na żadnej wewnętrznej partycji dysku twardego) może być uciążliwa - musisz upewnić się, że USB/FireWire / ... urządzenie zostanie zamontowane przed zaszyfrowaną partycją, co oznacza, że musisz zmienić kolejność <code>/etc/fstab</code> (przynajmniej).
</p>
<p>Oczywiście, jeśli pakiet <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span> zostanie uaktualniony, będziesz musiał ponownie zmienić ten skrypt. W przeciwieństwie do <code>/etc/crypttab</code>, obsługiwana jest tylko jedna partycja, ale z kilkoma dalszymi włamaniami powinno być możliwe odblokowanie wielu partycji.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Why not use the supported Grub2 right away? See also <a href="../../en/Mkinitcpio.html#Using_RAID" title="Mkinitcpio">mkinitcpio#Using RAID</a> (Discuss in <a rel="nofollow" class="external text" href="../../pl/Talk:Dm-crypt/Specialties.html">Talk:Dm-crypt (Polski)/Specialties (Polski)</a>)</div>
</div>
<p>Jeśli chcesz to zrobić na partycji programowego RAID, musisz jeszcze zrobić jeszcze jedną rzecz. Samo ustawienie urządzenia <code>/dev/mdX</code> w <code>/lib/initcpio/hooks/encrypt</code> nie wystarcza; hak <code>encrypt</code> nie uda się znaleźć klucza z jakiegoś powodu i nie poprosi o podanie hasła. Wygląda na to, że urządzenia RAID nie są przywoływane aż do uruchomienia haka <code>encrypt</code>. Możesz rozwiązać ten problem, umieszczając macierz RAID w katalogu <code>/boot/grub/menu.lst</code>, np.
</p>
<pre>kernel /boot/vmlinuz-linux md=1,/dev/hda5,/dev/hdb5
</pre>
<p>Jeśli skonfigurujesz partycję root jako RAID, zauważysz podobieństwa z tą konfiguracją. <a href="../../en/GRUB.html" title="GRUB">GRUB</a> radzi sobie z wieloma definicjami tablic:
</p>
<pre>kernel /boot/vmlinuz-linux root=/dev/md0 ro md=0,/dev/sda1,/dev/sdb1 md=1,/dev/sda5,/dev/sdb5,/dev/sdc5
</pre>
<h2>
<span id="Szyfrowany_system_za_pomoc.C4.85_oddzielnego_nag.C5.82.C3.B3wka_LUKS"></span><span class="mw-headline" id="Szyfrowany_system_za_pomocą_oddzielnego_nagłówka_LUKS">Szyfrowany system za pomocą oddzielnego nagłówka LUKS</span>
</h2>
<p>Ten przykład jest zgodny z tym samym ustawieniem, co w <a href="../../pl/Dm-crypt/Encrypting_an_entire_system.html#Zwyk%C5%82y_dm-crypt" title="Dm-crypt (Polski)/Encrypting an entire system (Polski)">dm-crypt (Polski)/Encrypting an entire system (Polski)#Zwykły dm-crypt</a>, które należy przeczytać najpierw przed wykonaniem tego przewodnika.
</p>
<p>Używając oddzielnego nagłówka, zaszyfrowane urządzenie blokowe przenosi tylko zaszyfrowane dane, co daje <a href="https://en.wikipedia.org/wiki/Deniable_encryption" class="extiw" title="wikipedia:Deniable encryption">dyskretne szyfrowanie</a>, o ile istnienie nagłówka nie jest znane atakującym. Jest podobne do używania <a href="../../pl/Dm-crypt/Encrypting_an_entire_system.html#Zwyk%C5%82y_dm-crypt" title="Dm-crypt (Polski)/Encrypting an entire system (Polski)">Zwykły dm-crypt</a>, ale z zaletami LUKS, takimi jak wielokrotne hasła dla klucza głównego i pochodnej klucza.Co więcej, użycie oddzielnego nagłówka oferuje formę uwierzytelniania dwuskładnikowego z łatwiejszą konfiguracją niż <a href="#U%C5%BCywanie_zaszyfrowanych_plik%C3%B3w_kluczy_GPG,_LUKS_lub_OpenSSL">przy użyciu zaszyfrowanych plików kluczy GPG lub OpenSSL</a>, a jednocześnie ma wbudowane zapytanie o hasło dla wielokrotnych prób. Zobacz <a href="../../en/Data-at-rest_encryption.html#Cryptographic_metadata" class="mw-redirect" title="Disk encryption">Disk encryption#Cryptographic metadata</a> po więcej informacji.
</p>
<p>Zobacz <a href="../../pl/Dm-crypt/Device_encryption.html#Opcje_szyfrowania_dla_trybu_LUKS" title="Dm-crypt (Polski)/Device encryption (Polski)">dm-crypt (Polski)/Device encryption (Polski)#Opcje szyfrowania dla trybu LUKS</a> dla opcji szyfrowania przed wykonaniem pierwszego kroku, aby skonfigurować zaszyfrowaną partycję systemową i utworzyć plik nagłówkowy do użycia z <code>cryptsetup</code>:
</p>
<pre># dd if=/dev/zero of=header.img bs=4M count=1 conv=notrunc
# cryptsetup luksFormat --type luks2 /dev/sdX --align-payload 8192 --header header.img
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Używając opcji <code>--header</code>, <code>--align-payload</code> pozwala określić początek zaszyfrowanych danych na urządzeniu. Rezerwując miejsce na początku urządzenia, możesz później ponownie <a href="../../pl/Dm-crypt/Device_encryption.html#Przywracanie_za_pomoc%C4%85_cryptsetup" title="Dm-crypt (Polski)/Device encryption (Polski)">podłączyć nagłówek LUKS</a> Zobacz <span class="plainlinks archwiki-template-man" title="$ man 8 cryptsetup"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cryptsetup.8">cryptsetup(8)</a></span> dla wartości obsługiwanych przez <code>--align-payload</code>.</div>
<p>Otwórz kontener:
</p>
<pre># cryptsetup open --header header.img /dev/sdX enc
</pre>
<p>Teraz postępuj zgodnie z <a href="../../pl/Dm-crypt/Encrypting_an_entire_system.html#Przygotowywanie_partycji,_kt%C3%B3re_nie_s%C4%85_uruchomione" title="Dm-crypt (Polski)/Encrypting an entire system (Polski)">LVM na konfiguracji LUKS</a> do swoich wymagań. To samo dotyczy <a href="../../pl/Dm-crypt/Encrypting_an_entire_system.html#Przygotowanie_partycji_rozruchowej_4" title="Dm-crypt (Polski)/Encrypting an entire system (Polski)">przygotowywania partycji rozruchowej</a> na urządzeniu wymiennym (ponieważ w przeciwnym razie nie ma sensu posiadanie oddzielnego pliku nagłówkowego do odblokowania zaszyfrowanego dysku). Następnie przenieś plik <code>header.img</code>:
</p>
<pre># mv header.img /mnt/boot
</pre>
<p>Postępuj zgodnie z procedurą instalacji aż do kroku mkinitcpio (powinieneś już być <code>arch-chroot</code> wewnątrz zaszyfrowanego systemu).
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Zauważysz, że ponieważ partycja systemowa ma tylko "losowe" dane, nie ma ona tablicy partycji, a przez to <code>UUID</code> ani <code>LABEL</code>.. Ale nadal możesz mieć spójne mapowanie za pomocą <a href="../../en/Persistent_block_device_naming.html#by-id_and_by-path" title="Persistent block device naming">Persistent block device naming#by-id and by-path</a>. Na przykład. używanie identyfikatora dysku <code>/dev/disk/by-id/</code>.</div>
<p>Istnieją dwie opcje dla initramfs do obsługi odłączonego nagłówka LUKS.
</p>
<h3>
<span id="U.C5.BCywanie_haka_systemd"></span><span class="mw-headline" id="Używanie_haka_systemd">Używanie haka systemd</span>
</h3>
<p>Najpierw utwórz <code>/etc/crypttab.initramfs</code> i dodaj do niego zaszyfrowane urządzenie. Składnia jest zdefiniowana w <span class="plainlinks archwiki-template-man" title="$ man 5 crypttab"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/crypttab.5">crypttab(5)</a></span>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab.initramfs</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">enc	/dev/disk/by-id/<i>your-disk_id</i>	none	header=/boot/header.img</pre>
<p>Zmodyfikuj plik <code>/etc/mkinitcpio.conf</code> , aby <a href="../../en/Mkinitcpio.html#Common_hooks" title="Mkinitcpio">używał systemd</a> i dodaj nagłówek do <code>FILES</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
FILES=(<b>/boot/header.img</b>)
...
HOOKS=(base <b>systemd</b> autodetect <b>keyboard</b> <b>sd-vconsole</b> modconf block <b>sd-encrypt</b> <b>sd-lvm2</b> filesystems fsck)
...</pre>
<p><a href="../../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">Zregeneruj initramfs</a>  i gotowe.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Żadne parametry cryptsetup nie muszą być przekazywane do wiersza poleceń jądra, ponieważ <code>/etc/crypttab.initramfs</code> zostanie dodane jako <code>/etc/crypttab</code> do initramfs. Jeśli chcesz je określić w wierszu komend jądra, zobacz <a href="../../en/Dm-crypt/System_configuration.html#Using_encrypt_hook" title="Dm-crypt/System configuration">dm-crypt/System configuration#Using encrypt hookdla</a> obsługiwanych opcji.</div>
<h3><span class="mw-headline" id="Modyfikowanie_haka_szyfrowania">Modyfikowanie haka szyfrowania</span></h3>
<p>Ta metoda pokazuje, jak zmodyfikować hak <code>encrypt</code>, aby użyć oddzielnego nagłówka LUKS.
Teraz <code>encrypt</code> hak musi zostać zmodyfikowany, aby umożliwić <code>cryptsetup</code> użycie osobnego nagłówka ((<a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/42851">FS#42851</a>; podstawowe źródło i pomysł dla tych zmian opublikowanych w BBS). Utwórz kopię, aby nie została nadpisana w aktualizacji mkinitcpio:
</p>
<pre># cp /usr/lib/initcpio/hooks/encrypt /etc/initcpio/hooks/encrypt2
# cp /usr/lib/initcpio/install/encrypt /etc/initcpio/install/encrypt2
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/hooks/encrypt2 (around line 52)</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">warn_deprecated() {
    echo "The syntax 'root=${root}' where '${root}' is an encrypted volume is deprecated"
    echo "Use 'cryptdevice=${root}:root root=/dev/mapper/root' instead."
}

<b>local headerFlag=false</b>
for cryptopt in ${cryptoptions//,/ }; do
    case ${cryptopt} in
        allow-discards)
            cryptargs="${cryptargs} --allow-discards"
            ;;  
        <b>header)
            cryptargs="${cryptargs} --header /boot/header.img"
            headerFlag=true
            ;;</b>
        *)  
            echo "Encryption option '${cryptopt}' not known, ignoring." &gt;&amp;2 
            ;;  
    esac
done

if resolved=$(resolve_device "${cryptdev}" ${rootdelay}); then
    if <b>$headerFlag || </b>cryptsetup isLuks ${resolved} &gt;/dev/null 2&gt;&amp;1; then
        [ ${DEPRECATED_CRYPT} -eq 1 ] &amp;&amp; warn_deprecated
        dopassphrase=1</pre>
<p>Teraz zmodyfikuj plik <a href="../../en/Mkinitcpio.html#Configuration" class="mw-redirect" title="Mkinitcpio.conf">mkinitcpio.conf</a>, aby dodać haki <code>encrypt2</code> i <code>lvm2</code>, <code>header.img</code> do <code>FILES</code> i <code>loop</code> do MODULES, oprócz innych konfiguracji system wymaga:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
MODULES=(<b>loop</b>)
...
FILES=(<b>/boot/header.img</b>)
...
HOOKS=(base udev autodetect <b>keyboard</b> <b>keymap</b> consolefont modconf block <b>encrypt2</b> <b>lvm2</b> filesystems fsck)
...</pre>
<p>Jest to wymagane, aby nagłówek LUKS był dostępny podczas rozruchu, umożliwiając odszyfrowanie systemu, zwalniając nas z bardziej skomplikowanej konfiguracji, aby zamontować inne oddzielne urządzenie USB w celu uzyskania dostępu do nagłówka. Po tej konfiguracji tworzony jest <a href="../../en/Mkinitcpio.html#Image_creation_and_activation" title="Mkinitcpio">initramfs</a>.
</p>
<p>Następnie <a href="../../pl/Dm-crypt/Encrypting_an_entire_system.html#Konfiguracja_bootloadera" title="Dm-crypt (Polski)/Encrypting an entire system (Polski)">bootlader</a>  jest skonfigurowany tak, aby określał <code>cryptdevice=</code> również przekazywanie nowej opcji <code>header</code> dla tej instalacji:
</p>
<pre>cryptdevice=/dev/disk/by-id/<i>your-disk_id</i>:enc:header
</pre>
<p>Aby zakończyć, wykonaj <a href="../../pl/Dm-crypt/Encrypting_an_entire_system.html#Po_instalacji" title="Dm-crypt (Polski)/Encrypting an entire system (Polski)">dm-crypt (Polski)/Encrypting an entire system (Polski)#Po instalacji</a> jest szczególnie przydatny w przypadku partycji <code>/boot</code> na nośniku USB.
</p>
<h2>
<span id="Szyfrowanie_.2Fboot_i_od.C5.82.C4.85czony_nag.C5.82.C3.B3wek_LUKS_na_USB"></span><span class="mw-headline" id="Szyfrowanie_/boot_i_odłączony_nagłówek_LUKS_na_USB">Szyfrowanie /boot i odłączony nagłówek LUKS na USB</span>
</h2>
<p>Zamiast osadzać plik <code>header.img</code> i keyfile w obrazie <a href="../../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">initramfs</a>, ta konfiguracja sprawi, że twój system będzie całkowicie zależny od klucza USB, a nie tylko obrazu boot i od zaszyfrowanego pliku klucza wewnątrz zaszyfrowanej partycji rozruchowej. Ponieważ nagłówek i plik klucza nie są zawarte w obrazie initramfs, a niestandardowy zaszyfrowanie jest przeznaczone specjalnie dla identyfikatora USB, dosłownie potrzebujesz klucza USB do rozruchu. Ponieważ nagłówek i plik klucza nie są zawarte w obrazie <a href="../../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">initramfs</a>, a niestandardowy zaszyfrowanie jest przeznaczone specjalnie dla identyfikatora USB <a href="../../en/Persistent_block_device_naming.html#by-id_and_by-path" title="Persistent block device naming">by-id</a>, dosłownie potrzebujesz klucza USB do rozruchu.
</p>
<p>W przypadku dysku USB, ponieważ szyfrujesz dysk i plik klucza w środku, najlepiej jest kaskadować szyfry, aby nie używać tego samego dwa razy. To, czy atak typu <a href="https://en.wikipedia.org/wiki/Meet-in-the-middle_attack" class="extiw" title="wikipedia:Meet-in-the-middle attack">meet-in-the-middle</a> będzie faktycznie wykonalny, jest dyskusyjne. Możesz użyć twofish-serpent lub serpent-twofish.
</p>
<h3>
<span id="Przygotowywanie_urz.C4.85dze.C5.84_dyskowych"></span><span class="mw-headline" id="Przygotowywanie_urządzeń_dyskowych">Przygotowywanie urządzeń dyskowych</span>
</h3>
<p>Zakłada się, że <code>sdb</code> będzie napędem USB, a <code>sda</code> będzie głównym dyskiem twardym.
</p>
<p>Przygotuj urządzenia zgodnie z <a href="../../pl/Dm-crypt/Drive_preparation.html" title="Dm-crypt (Polski)/Drive preparation (Polski)">dm-crypt (Polski)/Drive preparation (Polski)</a>.
</p>
<h4><span class="mw-headline" id="Przygotowanie_klucza_USB">Przygotowanie klucza USB</span></h4>
<p>Użyj <a href="../../en/GPT_fdisk.html" title="GPT fdisk">GPT fdisk</a>, aby podzielić dysk na partycje zgodnie z <a href="../../pl/Dm-crypt/Encrypting_an_entire_system.html#Przygotowanie_dysku_5" title="Dm-crypt (Polski)/Encrypting an entire system (Polski)">pokazanym tu układem</a>, z tym wyjątkiem, że powinien zawierać tylko pierwsze dwie partycje. Oto, co następuje:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># gdisk /dev/sdb</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048         1050623   512.0 MiB   EF00  EFI System
   2         1050624         1460223   200.0 MiB   8300  Linux filesystem
</pre>
<p>Przed uruchomieniem <code>cryptsetup</code> najpierw sprawdź <a href="../../pl/Dm-crypt/Device_encryption.html#Opcje_szyfrowania_dla_trybu_LUKS" title="Dm-crypt (Polski)/Device encryption (Polski)">opcje Szyfrowania dla LUKS</a> i <a href="../../en/Data-at-rest_encryption.html#Ciphers_and_modes_of_operation" title="Data-at-rest encryption">Szyfrów oraz tryby działania</a>, aby wybrać pożądane ustawienia.
</p>
<p><a href="../../pl/Dm-crypt/Encrypting_an_entire_system.html#Przygotowanie_partycji_rozruchowej_4" title="Dm-crypt (Polski)/Encrypting an entire system (Polski)">Przygotuj partycję rozruchową</a>, ale nie <code>mount</code> jeszcze żadnej partycji i <a href="../../en/EFI_system_partition.html#Format_the_partition" title="EFI system partition">sformatuj partycję systemową EFI</a>.
</p>
<pre># mount /dev/mapper/cryptboot /mnt
# dd if=/dev/urandom of=/mnt/key.img bs=<i>filesize</i> count=1
# cryptsetup --align-payload=1 luksFormat /mnt/key.img
# cryptsetup open /mnt/key.img lukskey
</pre>
<p><i>filesize</i> jest w bajtach, ale może być poprzedzone przyrostkiem takim jak <code>M</code>. Zbyt mały plik sprawi, że będziesz nieprzyjemny <code>Requested offset is beyond real size of device /dev/loop0</code> error. Jako przybliżone odniesienie, utworzenie pliku 4M spowoduje jego pomyślne zaszyfrowanie. Powinieneś uczynić plik większym, niż potrzeba, ponieważ zaszyfrowane urządzenie będzie trochę mniejsze niż rozmiar pliku.
</p>
<p>Przy dużym pliku możesz użyć opcji <code>--keyfile-offset=<i>offset</i></code> i <code>--keyfile-size=<i>size</i></code> aby przejść do właściwej pozycji. <a rel="nofollow" class="external autonumber" href="https://wiki.gentoo.org/wiki/Custom_Initramfs#Encrypted_keyfile">[5]</a>
</p>
<p>Teraz powinieneś mieć <code>lukskey</code> otwarty w urządzeniu pętlowym (pod spodem <code>/dev/loop1</code>) zmapowane jako <code>/dev/mapper/lukskey</code>.
</p>
<h4>
<span id="G.C5.82.C3.B3wny_nap.C4.99d"></span><span class="mw-headline" id="Główny_napęd">Główny napęd</span>
</h4>
<pre># truncate -s 2M /mnt/header.img
# cryptsetup --key-file=/dev/mapper/lukskey --keyfile-offset=<i>offset</i> --keyfile-size=<i>size</i> luksFormat /dev/sda --align-payload 4096 --header /mnt/header.img
</pre>
<p>Wybierz <i>offset</i> i rozmiar w bajtach (8192 bajty to maksymalny rozmiar pliku klucza dla <code>cryptsetup</code>)
</p>
<pre># cryptsetup open --header /mnt/header.img --key-file=/dev/mapper/lukskey --keyfile-offset=<i>offset</i> --keyfile-size=<i>size</i> /dev/sda enc
# cryptsetup close lukskey
# umount /mnt
</pre>
<p>Wykonaj czynności <a href="../../pl/Dm-crypt/Encrypting_an_entire_system.html#Przygotowywanie_wolumin%C3%B3w_logicznych" title="Dm-crypt (Polski)/Encrypting an entire system (Polski)">Przygotowywanie woluminów logicznych</a> w celu skonfigurowania LVM na LUKS.
</p>
<p>Zobacz <a href="../../en/Partitioning.html#Discrete_partitions" title="Partitioning">Partitioning#Discrete partitions</a> dla zaleceń dotyczących rozmiaru twoich partycji.
</p>
<p>Po zamontowaniu partycji root <code>mount</code> zaszyfrowaną partycję rozruchową jako <code>/mnt/boot</code> i partycję ESP lub EFI jako <code>/mnt/boot/efi</code>.
</p>
<h3><span class="mw-headline" id="Procedura_instalacji_i_niestandardowe_szyfrowanie_hook">Procedura instalacji i niestandardowe szyfrowanie hook</span></h3>
<p>Postępuj zgodnie z <a href="../../pl/Installation_guide.html" title="Installation guide (Polski)">instrukcją instalacji</a> aż do kroku <code>mkinitcpio</code>, ale nie rób jeszcze tego, a następnie pomiń procedury partycjonowania, formatowania i motowania, ponieważ zostały już wykonane.
</p>
<p>Aby zaszyfrować konfigurację, musisz zbudować własny hak, który jest na szczęście łatwy do zrobienia i tutaj jest kod, którego potrzebujesz. Będziesz musiał postępować zgodnie z <a href="../../en/Persistent_block_device_naming.html#by-id_and_by-path" title="Persistent block device naming">Persistent block device naming#by-id and by-path</a> aby obliczyć własne wartości <code>by-id</code> dla dysku USB i głównego dysku twardego (są one połączone -&gt; do <code>sda</code> lub <code>sdb</code>)).
</p>
<p>Powinieneś używać <code>by-id</code> pomocniczego zamiast tylko <code>sda</code> lub <code>sdb</code>, ponieważ <code>sdX</code> może się zmienić, to gwarantuje, że jest to właściwe urządzenie.
</p>
<p>Możesz nazywać <code>customencrypthook</code>, co tylko chcesz, a niestandardowe haki do budowania można umieszczać w <code>hooks</code> i instalować foldery w <code>/etc/initcpio</code>. Zachowaj kopię zapasową obu plików (przenieś je do partycji <code>/home</code> lub katalogu <code>/home</code> / home po jej utworzeniu). <code>/usr/bin/ash</code> to nie literówka.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/hooks/customencrypthook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/ash

run_hook() {
    modprobe -a -q dm-crypt &gt;/dev/null 2&gt;&amp;1
    modprobe loop
    [ "${quiet}" = "y" ] &amp;&amp; CSQUIET="&gt;/dev/null"

    while [ ! -L '/dev/disk/by-id/<i>usbdrive</i>-part2' ]; do
     echo 'Waiting for USB'
     sleep 1
    done

    cryptsetup open /dev/disk/by-id/<i>usbdrive</i>-part2 cryptboot
    mkdir -p /mnt
    mount /dev/mapper/cryptboot /mnt
    cryptsetup open /mnt/key.img lukskey
    cryptsetup --header /mnt/header.img --key-file=/dev/mapper/lukskey --keyfile-offset=''offset'' --keyfile-size=''size'' open /dev/disk/by-id/<i>harddrive</i> enc
    cryptsetup close lukskey
    umount /mnt
}
</pre>
<p>Dysk <code><i>usbdrive</i></code> to Twój <code>by-id</code> napędu USB, a <code><i>harddrive</i></code> jest twoim głównym dyskiem twardym.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Można również zamknąć <code>cryptboot</code> przy użyciu <code>cryptsetup close</code>, ale jego otwarcie ułatwia instalowanie aktualizacji systemu za pomocą Pacmana i regenerację initramfs za pomocą <a href="../../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a>. Partycja <code>/boot</code> musi być zamontowana dla aktualizacji wpływających na <a href="../../en/Kernel.html" title="Kernel">kernel</a> lub <a href="../../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">Initramfs</a>, a initramfs będzie automatycznie generowany ponownie po tych aktualizacjach.</div>
<pre># cp /usr/lib/initcpio/install/encrypt /etc/initpcio/install/customencrypthook
</pre>
<p>Teraz edytuj skopiowany plik i usuń sekcję <code>help()</code>, ponieważ nie jest to konieczne.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf (edit this only do not replace it, these are just excerpts of the necessary parts)</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">MODULES=(loop)
...
HOOKS=(base udev autodetect modconf block customencrypthook lvm2 filesystems keyboard fsck)</pre>
<p><code>files=()</code> i <code>binaries=()</code> są puste i nie powinieneś zastępować tablicy <code>HOOKS=(...)</code> całkowicie po prostu edytuj w <code>customencrypthook lvm2</code> po <code>block</code> i przed <code>filesystems</code> i upewnij się, że <code>systemd</code>, <code>sd-lvm2</code>, i <code>encrypt</code> są usunięte.
</p>
<h4><span class="mw-headline" id="Boot_Loader">Boot Loader</span></h4>
<p>Zakończ <a href="../../pl/Installation_guide.html#Initramfs" title="Installation guide (Polski)">Podręcznik instalacji</a> od kroku <code>mkinitcpio</code> Do rozruchu potrzebny jest <a href="../../en/GRUB.html" title="GRUB">GRUB</a> lub <a href="../../en/Unified_Extensible_Firmware_Interface.html#efibootmgr" class="mw-redirect" title="Efibootmgr">efibootmgr</a>. Uwaga: możesz użyć <a href="../../en/GRUB.html" title="GRUB">GRUB</a>-a do obsługi zaszyfrowanych dysków, <a href="../../pl/Dm-crypt/Encrypting_an_entire_system.html#Konfiguracja_bootloadera" title="Dm-crypt (Polski)/Encrypting an entire system (Polski)">konfigurując program ładujący</a>, ale edycja <code>GRUB_CMDLINE_LINUX</code> nie jest konieczna dla tej konfiguracji.
</p>
<p>Lub użyj bezpośredniego UEFI Secure boot, generując klucze za pomocą <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/cryptboot/">cryptboot</a></span><sup><small>AUR</small></sup>, a następnie podpisując initramfs i jądro i tworząc startowy plik .efi dla twojego katalogu <code>/boot/efi</code> z <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sbupdate-git/">sbupdate-git</a></span><sup><small>AUR</small></sup>. Przed użyciem cryptboot lub sbupdate zanotuj ten fragment z <a href="../../en/Unified_Extensible_Firmware_Interface/Secure_Boot.html#Using_your_own_keys" class="mw-redirect" title="Secure Boot">Secure Boot#Using your own keys</a>:
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Zauważ, że <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/cryptboot/">cryptboot</a></span><sup><small>AUR</small></sup>  wymaga, aby zaszyfrowana partycja rozruchowa była określona w <code>/etc/crypttab</code>przed uruchomieniem, a jeśli używasz go w połączeniu z <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sbupdate-git/">sbupdate-git</a></span><sup><small>AUR</small></sup>, sbupdate oczekuje, że pliki <code>/boot/efikeys/db.*</code> utworzone przez cryptboot będą pisane wielkimi literami jak <code>DB.*</code> chyba, że skonfigurowano inaczej w <code>/etc/default/sbupdate</code>. Użytkownicy, którzy nie używają systemd do obsługi szyfrowania, mogą nie mieć niczego w swoim pliku <code>/etc/crypttab</code> i musieliby utworzyć wpis.
</div>
<pre># efibootmgr -c -d /dev/<i>device</i> -p <i>partition_number</i> -L "Arch Linux Signed" -l "EFI\Arch\linux-signed.efi"
</pre>
<p>Zobacz <span class="plainlinks archwiki-template-man" title="$ man 8 efibootmgr"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/efibootmgr.8">efibootmgr(8)</a></span>, aby uzyskać wyjaśnienie opcji.
</p>
<p>Upewnij się, że porządek rozruchowy stawia <code>Arch Linux Signed</code> jako pierwszy. Jeśli nie, zmień go za pomocą <code>efibootmgr -o XXXX,YYYY,ZZZZ</code>.
</p>
<h3><span class="mw-headline" id="Zmiana_pliku_klucza_LUKS">Zmiana pliku klucza LUKS</span></h3>
<pre># cryptsetup --header /boot/header.img --key-file=/dev/mapper/lukskey --keyfile-offset=<i>offset</i> --keyfile-size=<i>size</i> luksChangeKey /dev/mapper/enc /dev/mapper/lukskey2 --new-keyfile-size=<i>newsize</i> --new-keyfile-offset=<i>newoffset</i>
</pre>
<p>Następnie <code>cryptsetup close lukskey</code> i <a href="../../en/Securely_wipe_disk.html#shred" title="Securely wipe disk">shred</a> lub <a href="../../en/Securely_wipe_disk.html#dd" title="Securely wipe disk">dd</a> stary plik klucza z losowymi danymi przed usunięciem, a następnie upewnij się, że nowy plik klucza ma zmienioną nazwę na starą: <code>key.img</code> lub inną nazwę.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../pl/Category:Data-at-rest_encryption.html" title="Category:Data-at-rest encryption (Polski)">Data-at-rest encryption (Polski)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Translateme.html" title="Category:Pages or sections flagged with Template:Translateme">Pages or sections flagged with Template:Translateme</a></li>
<li><a href="../../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
<li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Dm-crypt_(Polski)/Specialties_(Polski)&amp;oldid=790318">https://wiki.archlinux.org/index.php?title=Dm-crypt_(Polski)/Specialties_(Polski)&amp;oldid=790318</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 18 October 2023, at 11:11.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
