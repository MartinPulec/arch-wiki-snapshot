<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>dm-crypt (Español)/Device encryption (Español) - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Dm-crypt_Español_Device_encryption_Español rootpage-Dm-crypt_Español skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Preparación" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Preparaci%C3%B3n">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Preparación</div>
		</a>
		
		<ul id="toc-Preparación-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Utilización_de_cryptsetup" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Utilizaci%C3%B3n_de_cryptsetup">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Utilización de cryptsetup</div>
		</a>
		
			<button aria-controls="toc-Utilización_de_cryptsetup-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Utilización de cryptsetup subsection</span>
			</button>
		
		<ul id="toc-Utilización_de_cryptsetup-sublist" class="vector-toc-list">
			<li id="toc-Contraseñas_y_claves_de_cryptsetup" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Contrase%C3%B1as_y_claves_de_cryptsetup">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Contraseñas y claves de  cryptsetup</div>
			</a>
			
			<ul id="toc-Contraseñas_y_claves_de_cryptsetup-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Opciones_de_cifrado_con_dm-crypt" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Opciones_de_cifrado_con_dm-crypt">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Opciones de cifrado con dm-crypt</div>
		</a>
		
			<button aria-controls="toc-Opciones_de_cifrado_con_dm-crypt-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Opciones de cifrado con dm-crypt subsection</span>
			</button>
		
		<ul id="toc-Opciones_de_cifrado_con_dm-crypt-sublist" class="vector-toc-list">
			<li id="toc-Opciones_de_cifrado_para_la_modalidad_LUKS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Opciones_de_cifrado_para_la_modalidad_LUKS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Opciones de cifrado para la modalidad LUKS</div>
			</a>
			
			<ul id="toc-Opciones_de_cifrado_para_la_modalidad_LUKS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Opciones_de_cifrado_para_la_modalidad_plain" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Opciones_de_cifrado_para_la_modalidad_plain">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Opciones de cifrado para la modalidad plain</div>
			</a>
			
			<ul id="toc-Opciones_de_cifrado_para_la_modalidad_plain-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Cifrar_dispositivos_con_cryptsetup" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Cifrar_dispositivos_con_cryptsetup">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Cifrar dispositivos con cryptsetup</div>
		</a>
		
			<button aria-controls="toc-Cifrar_dispositivos_con_cryptsetup-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Cifrar dispositivos con cryptsetup subsection</span>
			</button>
		
		<ul id="toc-Cifrar_dispositivos_con_cryptsetup-sublist" class="vector-toc-list">
			<li id="toc-Cifrar_dispositivos_con_la_modalidad_LUKS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Cifrar_dispositivos_con_la_modalidad_LUKS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Cifrar dispositivos con la modalidad LUKS</div>
			</a>
			
			<ul id="toc-Cifrar_dispositivos_con_la_modalidad_LUKS-sublist" class="vector-toc-list">
				<li id="toc-Formatear_particiones_LUKS" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Formatear_particiones_LUKS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.1</span>Formatear particiones LUKS</div>
			</a>
			
			<ul id="toc-Formatear_particiones_LUKS-sublist" class="vector-toc-list">
				<li id="toc-Utilizar_LUKS_para_formatear_particiones_con_un_archivo_de_claves" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Utilizar_LUKS_para_formatear_particiones_con_un_archivo_de_claves">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.1.1</span>Utilizar LUKS para formatear particiones con un archivo de claves</div>
			</a>
			
			<ul id="toc-Utilizar_LUKS_para_formatear_particiones_con_un_archivo_de_claves-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Desbloquear/mapear_particiones_LUKS_con_el_mapeador_de_dispositivos" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Desbloquear/mapear_particiones_LUKS_con_el_mapeador_de_dispositivos">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.2</span>Desbloquear/mapear particiones LUKS con el mapeador de dispositivos</div>
			</a>
			
			<ul id="toc-Desbloquear/mapear_particiones_LUKS_con_el_mapeador_de_dispositivos-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Cifrar_dispositivos_con_la_modalidad_plain" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Cifrar_dispositivos_con_la_modalidad_plain">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Cifrar dispositivos con la modalidad plain</div>
			</a>
			
			<ul id="toc-Cifrar_dispositivos_con_la_modalidad_plain-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Acciones_de_cryptsetup_específicas_para_LUKS" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Acciones_de_cryptsetup_espec%C3%ADficas_para_LUKS">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Acciones de cryptsetup específicas para LUKS</div>
		</a>
		
			<button aria-controls="toc-Acciones_de_cryptsetup_específicas_para_LUKS-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Acciones de cryptsetup específicas para LUKS subsection</span>
			</button>
		
		<ul id="toc-Acciones_de_cryptsetup_específicas_para_LUKS-sublist" class="vector-toc-list">
			<li id="toc-Gestión_de_claves" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Gesti%C3%B3n_de_claves">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Gestión de claves</div>
			</a>
			
			<ul id="toc-Gestión_de_claves-sublist" class="vector-toc-list">
				<li id="toc-Añadir_claves_LUKS" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#A%C3%B1adir_claves_LUKS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.1</span>Añadir claves LUKS</div>
			</a>
			
			<ul id="toc-Añadir_claves_LUKS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Eliminar_claves_LUKS" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Eliminar_claves_LUKS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.2</span>Eliminar claves LUKS</div>
			</a>
			
			<ul id="toc-Eliminar_claves_LUKS-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Copia_de_seguridad_y_restauración" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Copia_de_seguridad_y_restauraci%C3%B3n">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Copia de seguridad y restauración</div>
			</a>
			
			<ul id="toc-Copia_de_seguridad_y_restauración-sublist" class="vector-toc-list">
				<li id="toc-Realizar_copia_de_seguridad_utilizando_cryptsetup" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Realizar_copia_de_seguridad_utilizando_cryptsetup">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.1</span>Realizar copia de seguridad utilizando cryptsetup</div>
			</a>
			
			<ul id="toc-Realizar_copia_de_seguridad_utilizando_cryptsetup-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Restaurar_utilizando_cryptsetup" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Restaurar_utilizando_cryptsetup">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.2</span>Restaurar utilizando cryptsetup</div>
			</a>
			
			<ul id="toc-Restaurar_utilizando_cryptsetup-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Copia_de_seguridad_y_restauración_manuales" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Copia_de_seguridad_y_restauraci%C3%B3n_manuales">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.3</span>Copia de seguridad y restauración manuales</div>
			</a>
			
			<ul id="toc-Copia_de_seguridad_y_restauración_manuales-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Volver_a_cifrar_dispositivos" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Volver_a_cifrar_dispositivos">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Volver a cifrar dispositivos</div>
			</a>
			
			<ul id="toc-Volver_a_cifrar_dispositivos-sublist" class="vector-toc-list">
				<li id="toc-Cifrar_un_sistema_de_archivos_no_cifrado" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Cifrar_un_sistema_de_archivos_no_cifrado">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.1</span>Cifrar un sistema de archivos no cifrado</div>
			</a>
			
			<ul id="toc-Cifrar_un_sistema_de_archivos_no_cifrado-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Recifrar_una_partición_LUKS_existente" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Recifrar_una_partici%C3%B3n_LUKS_existente">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.2</span>Recifrar una partición LUKS existente</div>
			</a>
			
			<ul id="toc-Recifrar_una_partición_LUKS_existente-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Cambiar_el_tamaño_de_dispositivos_cifrados" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Cambiar_el_tama%C3%B1o_de_dispositivos_cifrados">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Cambiar el tamaño de dispositivos cifrados</div>
		</a>
		
			<button aria-controls="toc-Cambiar_el_tamaño_de_dispositivos_cifrados-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Cambiar el tamaño de dispositivos cifrados subsection</span>
			</button>
		
		<ul id="toc-Cambiar_el_tamaño_de_dispositivos_cifrados-sublist" class="vector-toc-list">
			<li id="toc-Sistema_de_archivos_de_loopback" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Sistema_de_archivos_de_loopback">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>Sistema de archivos de loopback</div>
			</a>
			
			<ul id="toc-Sistema_de_archivos_de_loopback-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Archivos_de_claves" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Archivos_de_claves">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Archivos de claves</div>
		</a>
		
			<button aria-controls="toc-Archivos_de_claves-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Archivos de claves subsection</span>
			</button>
		
		<ul id="toc-Archivos_de_claves-sublist" class="vector-toc-list">
			<li id="toc-Tipos_de_archivos_de_claves" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Tipos_de_archivos_de_claves">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1</span>Tipos de archivos de claves</div>
			</a>
			
			<ul id="toc-Tipos_de_archivos_de_claves-sublist" class="vector-toc-list">
				<li id="toc-Frase_de_contraseña" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Frase_de_contrase%C3%B1a">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1.1</span>Frase de contraseña</div>
			</a>
			
			<ul id="toc-Frase_de_contraseña-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Texto_aleatorio" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Texto_aleatorio">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1.2</span>Texto aleatorio</div>
			</a>
			
			<ul id="toc-Texto_aleatorio-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Binario" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Binario">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1.3</span>Binario</div>
			</a>
			
			<ul id="toc-Binario-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Crear_un_archivo_claves_con_caracteres_aleatorios" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Crear_un_archivo_claves_con_caracteres_aleatorios">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2</span>Crear un archivo claves con caracteres aleatorios</div>
			</a>
			
			<ul id="toc-Crear_un_archivo_claves_con_caracteres_aleatorios-sublist" class="vector-toc-list">
				<li id="toc-Almacenar_el_archivo_de_claves_en_un_sistema_de_archivos" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Almacenar_el_archivo_de_claves_en_un_sistema_de_archivos">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2.1</span>Almacenar el archivo de claves en un sistema de archivos</div>
			</a>
			
			<ul id="toc-Almacenar_el_archivo_de_claves_en_un_sistema_de_archivos-sublist" class="vector-toc-list">
				<li id="toc-Sobrescribir_de_forma_segura_los_archivos_de_claves_almacenados" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Sobrescribir_de_forma_segura_los_archivos_de_claves_almacenados">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2.1.1</span>Sobrescribir de forma segura los archivos de claves almacenados</div>
			</a>
			
			<ul id="toc-Sobrescribir_de_forma_segura_los_archivos_de_claves_almacenados-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Almacenar_el_archivo_de_claves_en_ramfs" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Almacenar_el_archivo_de_claves_en_ramfs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2.2</span>Almacenar el archivo de claves en ramfs</div>
			</a>
			
			<ul id="toc-Almacenar_el_archivo_de_claves_en_ramfs-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Configurar_LUKS_para_que_haga_uso_del_archivo_de_claves" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Configurar_LUKS_para_que_haga_uso_del_archivo_de_claves">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.3</span>Configurar LUKS para que haga uso del archivo de claves</div>
			</a>
			
			<ul id="toc-Configurar_LUKS_para_que_haga_uso_del_archivo_de_claves-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Desbloquear_manualmente_una_partición_usando_un_archivo_de_claves" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Desbloquear_manualmente_una_partici%C3%B3n_usando_un_archivo_de_claves">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.4</span>Desbloquear manualmente una partición usando un archivo de claves</div>
			</a>
			
			<ul id="toc-Desbloquear_manualmente_una_partición_usando_un_archivo_de_claves-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Desbloquear_la_partición_raíz_en_el_arranque" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Desbloquear_la_partici%C3%B3n_ra%C3%ADz_en_el_arranque">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.5</span>Desbloquear la partición raíz en el arranque</div>
			</a>
			
			<ul id="toc-Desbloquear_la_partición_raíz_en_el_arranque-sublist" class="vector-toc-list">
				<li id="toc-Con_un_archivo_de_claves_almacenado_en_un_medio_externo" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Con_un_archivo_de_claves_almacenado_en_un_medio_externo">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.5.1</span>Con un archivo de claves almacenado en un medio externo</div>
			</a>
			
			<ul id="toc-Con_un_archivo_de_claves_almacenado_en_un_medio_externo-sublist" class="vector-toc-list">
				<li id="toc-Configurar_mkinitcpio" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Configurar_mkinitcpio">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.5.1.1</span>Configurar mkinitcpio</div>
			</a>
			
			<ul id="toc-Configurar_mkinitcpio-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Configurar_parámetros_del_kernel" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Configurar_par%C3%A1metros_del_kernel">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.5.1.2</span>Configurar parámetros del kernel</div>
			</a>
			
			<ul id="toc-Configurar_parámetros_del_kernel-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Con_un_archivo_de_clave_incrustado_en_initramfs" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Con_un_archivo_de_clave_incrustado_en_initramfs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.5.2</span>Con un archivo de clave incrustado en initramfs</div>
			</a>
			
			<ul id="toc-Con_un_archivo_de_clave_incrustado_en_initramfs-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">dm-crypt (Español)/Device encryption (Español)</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 5 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-5" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">5 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-en mw-list-item"><a href="../../en/Dm-crypt/Device_encryption.html" title="Dm-crypt/Device encryption – English" lang="en" hreflang="en" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Dm-crypt/%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E6%9A%97%E5%8F%B7%E5%8C%96" title="Dm-crypt/デバイスの暗号化 – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pl mw-list-item"><a href="../../pl/Dm-crypt/Device_encryption.html" title="Dm-crypt (Polski)/Device encryption – polski" lang="pl" hreflang="pl" class="interlanguage-link-target"><span>Polski</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../../pt/Dm-crypt/Device_encryption.html" title="Dm-crypt (Português)/Device encryption – português" lang="pt" hreflang="pt" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Dm-crypt/Device_encryption" title="Dm-crypt/Device encryption – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <a href="../../es/Dm-crypt.html" title="Dm-crypt (Español)">Dm-crypt (Español)</a>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="es" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-box archwiki-template-box-note">Esta traducción de <a href="../../en/Dm-crypt/Device_encryption.html" title="Dm-crypt/Device encryption">Dm-crypt/Device encryption</a> fue revisada el <b>2019-09-18</b>. Si existen <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Dm-crypt/Device_encryption&amp;diff=0&amp;oldid=582798">cambios</a> puede <a href="../../es/ArchWiki:Translation_Team/Contributing.html" title="ArchWiki:Translation Team (Español)/Contributing (Español)">actualizarla</a> o avisar al <a href="../../es/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Español)">equipo de traducción</a>.</div>
<p>Esta sección explica cómo utilizar manualmente <i>dm-crypt</i> desde la línea de órdenes para cifrar un sistema.
</p>
<meta property="mw:PageProp/toc">
<h2>
<span id="Preparaci.C3.B3n"></span><span class="mw-headline" id="Preparación">Preparación</span>
</h2>
<p>Antes de usar <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span>, debe asegurarse de que el <a href="../../es/Kernel_module.html" title="Kernel module (Español)">módulo del kernel</a> <code>dm_crypt</code> esté cargado.
</p>
<h2>
<span id="Utilizaci.C3.B3n_de_cryptsetup"></span><span class="mw-headline" id="Utilización_de_cryptsetup">Utilización de cryptsetup</span>
</h2>
<p><i>Cryptsetup</i> es la herramienta de línea de órdenes para interactuar con <i>dm-crypt</i>, para crear, acceder y gestionar dispositivos cifrados. La herramienta se expandió posteriormente para admitir diferentes tipos de cifrado que dependen de los módulos del kernel de Linux <b>d</b>evice-<b>m</b>apper y <b>crypt</b>ographic. La expansión más notable fue para la extensión de configuración de clave unificada de Linux («<i>Linux Unified Key Setup</i>» siglas en inglés <a href="https://en.wikipedia.org/wiki/es:LUKS" class="extiw" title="wikipedia:es:LUKS">LUKS</a>), que almacena toda la información de configuración necesaria para dm-crypt en el propio disco y abstrae la partición y la gestión de claves en un intento por mejorar la facilidad de uso. Los dispositivos a los que se accede a través de <i>device-mapper</i> se denominan dispositivos de bloque. Para obtener más información, consulte <a href="../../es/Data-at-rest_encryption.html#Cifrar_dispositivos_de_bloques" class="mw-redirect" title="Disk encryption (Español)">Disk encryption (Español)#Cifrar dispositivos de bloques</a>. 
</p>
<p>La herramienta se utiliza de la siguiente manera:
</p>
<pre># cryptsetup &lt;OPCIONES&gt; &lt;acción&gt; &lt;opciones-específicas-de-la-acción&gt; &lt;dispositivo&gt; &lt;nombre_dispositivo_mapeado&gt;
</pre>
<p>Cryptsetup tiene valores predeterminados en su compilación para las opciones y el modo de cifrado, que se utilizarán si no se especifican otros en la línea de órdenes. Mire esto:
</p>
<pre>$ cryptsetup --help
</pre>
<p>que enumera las opciones, las acciones y los parámetros predeterminados para los modos de cifrado en ese orden. Una lista completa de opciones se puede encontrar en la página del manual.
Como los diferentes parámetros son obligatorios u opcionales, según el modo de encriptación y la acción, las siguientes secciones señalan las diferencias más destacadas. El cifrado de dispositivos de bloques es rápido, pero la velocidad también importa mucho. Debido a que es difícil cambiar el <a href="https://en.wikipedia.org/wiki/es:CS-Cipher" class="extiw" title="wikipedia:es:CS-Cipher">algoritmo de cifrado</a> de un dispositivo de bloque después de la configuración, es importante verificar el rendimiento de <i>dm-crypt</i> para los parámetros individuales de antemano:
</p>
<pre>$ cryptsetup benchmark 
</pre>
<p>puede proporcionar orientación sobre la decisión de un algoritmo de cifrado y un tamaño de clave antes de su instalación. Si ciertos cifrados AES sobresalen con un rendimiento considerablemente mayor, estos son probablemente los que tienen soporte de hardware en la CPU.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Sugerencia:</strong> Es posible que desee practicar el cifrado de un disco duro virtual en una <a href="../../es/Category:Virtualization.html" title="Category:Virtualization (Español)">máquina virtual</a> para aprender.</div>
<h3>
<span id="Contrase.C3.B1as_y_claves_de_cryptsetup"></span><span class="mw-headline" id="Contraseñas_y_claves_de_cryptsetup">Contraseñas y claves de  cryptsetup</span>
</h3>
<p>Un dispositivo de bloque encriptado está protegido por una clave. Una clave es, o bien:
</p>
<ul>
<li>una frase de contraseña, ver <a href="../../en/Security.html#Passwords" title="Security">Security#Passwords</a>; o bien,</li>
<li>un archivo de claves, ver <a href="#Archivos_de_claves">#Archivos de claves</a>.</li>
</ul>
<p>Ambos tipos de clave tienen tamaños máximos predeterminados: las frases de contraseña (o simplemente, contraseña) pueden tener hasta 512 caracteres y los archivos de clave hasta 8192kiB.
</p>
<p>Una distinción importante de <i>LUKS</i> que se debe tener en cuenta en este punto es que la clave se utiliza para desbloquear la clave maestra de un dispositivo cifrado con LUKS y se puede cambiar con acceso de privilegios de root. Otros modos de cifrado no admiten el cambio de la clave después de la configuración, ya que no emplean una clave maestra para el cifrado. Consulte <a href="../../es/Data-at-rest_encryption.html#Cifrar_dispositivos_de_bloques" class="mw-redirect" title="Disk encryption (Español)">Disk encryption (Español)#Cifrar dispositivos de bloques</a> para más detalles.
</p>
<h2><span class="mw-headline" id="Opciones_de_cifrado_con_dm-crypt">Opciones de cifrado con dm-crypt</span></h2>
<p><i>Cryptsetup</i> admite diferentes modos de operación de cifrado para usar con <i>dm-crypt</i>:
</p>
<ul>
<li>
<code>--type luks</code> para usar la versión de formato LUKS predeterminada (LUKS1 con <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span> &lt; 2.1.0, LUKS2 con <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span> ≥ 2.1.0),</li>
<li>
<code>--type luks1</code> para usar LUKS1, la versión más común de LUKS,</li>
<li>
<code>--type luks2</code> para usar LUKS2, la última versión disponible de LUKS que permite extensiones adicionales,</li>
<li>
<code>--type plain</code> para usar el modo plain de dm-crypt,</li>
<li>
<code>--type loopaes</code>, para un modo heredado de loopaes,</li>
<li>
<code>--type tcrypt</code>, para un modo de compatibilidad con <a href="../../en/VeraCrypt.html" class="mw-redirect" title="TrueCrypt">TrueCrypt</a>.</li>
</ul>
<p>Las opciones criptográficas básicas para algoritmo de cifrado y <a href="https://en.wikipedia.org/wiki/es:Funci%C3%B3n_hash" class="extiw" title="wikipedia:es:Función hash">funciones hash</a> disponibles se pueden utilizar para todos las modalidades y se basan en las características del <a href="https://en.wikipedia.org/wiki/es:Front-end_y_back-end" class="extiw" title="wikipedia:es:Front-end y back-end">backend</a> <a href="https://en.wikipedia.org/wiki/es:Criptograf%C3%ADa" class="extiw" title="wikipedia:es:Criptografía">criptográfico</a> del kernel. Todos los que se cargan en tiempo de ejecución y disponible para usar como opciones se pueden ver con:
</p>
<pre>$ less /proc/crypto 
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Sugerencia:</strong> Si la lista es corta, ejecute <code>$ cryptsetup benchmark</code> que activará la carga de los módulos disponibles.</div>
<p>A continuación se presentan las opciones de cifrado para los modos <code>luks</code>, <code>luks1</code>, <code>luks2</code> y <code>plain</code>. Tenga en cuenta que las tablas enumeran las opciones utilizadas en los ejemplos respectivos de este artículo y no todas las disponibles.
</p>
<h3><span class="mw-headline" id="Opciones_de_cifrado_para_la_modalidad_LUKS">Opciones de cifrado para la modalidad LUKS</span></h3>
<p>La acción <i>cryptsetup</i> para configurar un nuevo dispositivo dm-crypt en la modalidad de cifrado LUKS es <i>luksFormat</i>. El nombre es engañoso pues no formatea el dispositivo, pero configura el encabezado del dispositivo LUKS y cifra la clave maestra con las opciones criptográficas deseadas.
</p>
<p>Como LUKS es el modo de cifrado predeterminado, todo lo que necesita para crear un nuevo dispositivo LUKS con parámetros predeterminados (<code>-v</code> es opcional) es:
</p>
<pre># cryptsetup -v luksFormat <i>dispositivo</i>
</pre>
<p>Para que sirva de comparación, podemos especificar las opciones predeterminadas manualmente también:
</p>
<pre># cryptsetup -v --type luks --cipher aes-xts-plain64 --key-size 256 --hash sha256 --iter-time 2000 --use-urandom --verify-passphrase luksFormat <i>dispositivo</i>
</pre>
<p>Los valores predeterminados se comparan con un ejemplo de especificación criptográficamente superior en la tabla siguiente, que se acompañan de comentarios:
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Opciones</th>
<th>Cryptsetup 2.1.0 por defecto</th>
<th>Ejemplo</th>
<th>Comentario
</th>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--cipher
<p>-c
</p>
</th>
<td>
<code>aes-xts-plain64</code>
</td>
<td>
<code>aes-xts-plain64</code>
</td>
<td>
<a rel="nofollow" class="external text" href="https://www.kernel.org/pub/linux/utils/cryptsetup/v1.6/v1.6.0-ReleaseNotes">Release 1.6.0</a> cambió los valores predeterminados a un <a href="../../en/Data-at-rest_encryption.html#Ciphers_and_modes_of_operation" class="mw-redirect" title="Disk encryption">algoritmo de cifrado</a> AES en modo <a href="https://en.wikipedia.org/wiki/Disk_encryption_theory#XEX-based_tweaked-codebook_mode_with_ciphertext_stealing_.28XTS.29" class="extiw" title="wikipedia:Disk encryption theory">XTS</a> (ver elemento 5.16  <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions#5-security-aspects">de FAQ</a>). Se recomienda no utilizar el valor predeterminado anterior <code>--cipher aes-cbc-essiv</code> debido a su conocido <a href="https://en.wikipedia.org/wiki/Disk_encryption_theory#Cipher-block_chaining_.28CBC.29" class="extiw" title="wikipedia:Disk encryption theory">problema</a> y prácticos <a rel="nofollow" class="external text" href="https://www.jakoblell.com/blog/2013/12/22/practical-malleability-attack-against-cbc-encrypted-luks-partitions/">ataques</a> contra ellos.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--key-size
<p>-s
</p>
</th>
<td>
<code>256</code> (<code>512</code> para XTS)
</td>
<td>
<code>512</code>
</td>
<td>Por defecto, se utiliza un tamaño de clave de 512 bits para algoritmo de cifrado XTS. Sin embargo, tenga en cuenta que <a href="https://en.wikipedia.org/wiki/Disk_encryption_theory#XEX-based_tweaked-codebook_mode_with_ciphertext_stealing_.28XTS.29" class="extiw" title="wikipedia:Disk encryption theory">XTS divide la clave suministrada a la mitad</a>, así que esto da como resultado el uso de AES-256.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--hash
<p>-h
</p>
</th>
<td>
<code>sha256</code>
</td>
<td>
<code>sha512</code>
</td>
<td>Algoritmo de hash utilizado para <a href="../../es/Data-at-rest_encryption.html#Metadatos_criptogr%C3%A1ficos" class="mw-redirect" title="Disk encryption (Español)">derivación de clave</a>. La versión 1.7.0 cambió los valores predeterminados de <code>sha1</code> a <code>sha256</code> «<i>no por razones de seguridad [sino] principalmente para evitar problemas de compatibilidad en sistemas endurecidos donde SHA1 ya está [siendo] eliminado</i>»<a rel="nofollow" class="external autonumber" href="https://www.kernel.org/pub/linux/utils/cryptsetup/v1.7/v1.7.0-ReleaseNotes">[1]</a>. El antiguo valor predeterminado de <code>sha1</code> todavía se puede utilizar para la compatibilidad con versiones anteriores de <i>cryptsetup</i>, ya que es <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions#5-security-aspects">considerado seguro</a> (ver elemento 5.20).
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--iter-time
<p>-i
</p>
</th>
<td>
<code>2000</code>
</td>
<td>
<code>5000</code>
</td>
<td>Número de milisegundos para gastar con el procesamiento de la frase de contraseña PBKDF2. La versión 1.7.0 cambió los valores predeterminados de <code>1000</code> a <code>2000</code> paraa «<i>tratar de mantener el recuento de iteraciones PBKDF2 lo suficientemente alto y también aceptable para los usuarios.</i>»<a rel="nofollow" class="external autonumber" href="https://www.kernel.org/pub/linux/utils/cryptsetup/v1.7/v1.7.0-ReleaseNotes">[2]</a>. Esta opción solo es relevante para las operaciones LUKS que establecen o cambien frases de contraseña, como <i>luksFormat</i> o <i>luksAddKey</i>. Al especificar 0 como parámetro, se selecciona el valor predeterminado compilado.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--use-{u,}random
</th>
<td>
<code>--use-urandom</code>
</td>
<td>
<code>--use-random</code>
</td>
<td>Selecciona qué <a href="../../en/Random_number_generation.html" class="mw-redirect" title="Random number generator">generador de números aleatorios</a> usar. Por citar la página del manual de cryptsetup: «En una situación de baja entropía (por ejemplo, en un sistema integrado), ambas selecciones son problemáticas. El uso de /dev/urandom puede dar lugar a claves débiles. El uso de /dev/random puede bloquear mucho tiempo, potencialmente para siempre, si no es suficiente la entropía puede ser cosechada por el kernel».
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--verify-passphrase
<p>-y
</p>
</th>
<td>Sí
</td>
<td>-
</td>
<td>Por defecto solo para luksFormat y luksAddKey. No hay necesidad de escribir para Arch Linux con la modalidad LUKS en este momento.
</td>
</tr>
</tbody>
</table>
<p>Las propiedades y características de LUKS se describen en la <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/Specification">especificación de LUKS1</a> (pdf) y en las especificaciones de <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/blob/master/docs/on-disk-format-luks2.pdf">LUKS2</a> (pdf).
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Sugerencia:</strong> Véase la presentación resumida del proyecto de los desarrolladores <a rel="nofollow" class="external text" href="https://mbroz.fedorapeople.org/talks/DevConf2016/devconf2016-luks2.pdf">devconfcz2016</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">enlace roto</a> 2024-03-03]</sup> (pdf) que motiva la actualización de la especificación principal a LUKS2.</div>
<h3><span class="mw-headline" id="Opciones_de_cifrado_para_la_modalidad_plain">Opciones de cifrado para la modalidad plain</span></h3>
<p>En la modalidad <i>plain</i> de dm-crypt, no hay una clave maestra en el dispositivo, por lo tanto, no es necesario configurarla. En su lugar, las opciones de cifrado que se emplearán se utilizan directamente para crear la asignación entre un disco cifrado y un dispositivo con nombre. El mapeado se puede crear frente a una partición o a un dispositivo completo. En este último caso, ni siquiera se necesita una tabla de particiones.
</p>
<p>Para crear una mapeado de modo <i>plain</i> con los parámetros predeterminados de cryptsetup:
</p>
<pre># cryptsetup &lt;opciones&gt; open --type plain &lt;dispositivo&gt; &lt;nombre-dispositivo-mapeado&gt;
</pre>
<p>Al ejecutarlo se le pedirá una contraseña, que debería tener una entropía muy alta.
A continuación, se muestra la comparación de los parámetros predeterminados con el ejemplo en <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html#Modalidad_plain_de_dm-crypt" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">dm-crypt/Encrypting an entire system (Español)#Modalidad plain de dm-crypt</a>
</p>

 	+	
<table class="wikitable">
<tbody>
<tr>
<th>Opción</th>
<th>Cryptsetup 2.1.0 por defecto</th>
<th>Ejemplo</th>
<th>Comentario
</th>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--hash
<p>-h
</p>
</th>
<td>
<code>ripemd160</code>
</td>
<td>-
</td>
<td>El hash se utiliza para crear la clave desde la frase de contraseña; no se utiliza en un archivo de claves.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--cipher
<p>-c
</p>
</th>
<td>
<code>aes-cbc-essiv:sha256</code>
</td>
<td>
<code>aes-xts-plain64</code>
</td>
<td>El cifrado consta de tres partes: generador cipher-chainmode-IV (vector de inicialización). Consulte <a href="../../es/Data-at-rest_encryption.html#Algoritmos_de_cifrado_y_modalidades_de_operaci%C3%B3n" class="mw-redirect" title="Disk encryption (Español)">Disk encryption (Español)#Algoritmos de cifrado y modalidades de operación</a> para obtener una explicación de esta configuración, y la <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/DMCrypt">DMCrypt documentación</a> para algunas de las opciones disponibles.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--key-size
<p>-s
</p>
</th>
<td>
<code>256</code>
</td>
<td>
<code>512</code>
</td>
<td>El tamaño de la clave (en bits). El tamaño dependerá del algoritmo que se use y también del modo de cadena (chainmode) en uso. El modo Xts requiere el doble del tamaño que la clave de cbc.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--size
<p>-b
</p>
</th>
<td>tamaño real del disco de destino
</td>
<td>
<code>2048</code> (el dispositivo mapeado será de 512B×2048=1MiB)
</td>
<td>Limite del tamaño máximo del dispositivo (en sectores de 512 bytes).
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--offset
<p>-o
</p>
</th>
<td>
<code>0</code>
</td>
<td>
<code>0</code>
</td>
<td>El desplazamiento desde el principio del disco de destino (en sectores de 512 bytes) a partir del cual se inicia el mapeado
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--skip
<p>-p	
</p>
</th>
<td>
<code>0</code>
</td>
<td>
<code>2048</code> (512B×2048=1MiB se saltará)
</td>
<td>El número de sectores de datos cifrados de 512 bytes que se omiten al principio.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--key-file
<p>-d
</p>
</th>
<td>por defecto utiliza una frase de contraseña
</td>
<td>
<code>/dev/sd<i>Z</i></code> (o, por ejemplo, <code>/boot/keyfile.enc</code>)
</td>
<td>El dispositivo o archivo que se utilizará como clave. Consulte <a href="#Archivos_de_claves">#Archivos de claves</a> para más detalles.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--keyfile-offset
</th>
<td>
<code>0</code>
</td>
<td>
<code>0</code>
</td>
<td>Desplazamiento desde el principio del archivo donde se inicia la clave (en bytes). Esta opción es compatible desde <i> cryptsetup </i> 1.6.7 en adelante.
</td>
</tr>
<tr>
<th style="text-align:right;white-space:nowrap;">--keyfile-size
<p>-l
</p>
</th>
<td>
<code>8192kB</code>
</td>
<td>- (se aplica por defecto)
</td>
<td>Limita los bytes leídos del archivo clave. Esta opción es compatible desde <i>cryptsetup</i> 1.6.7 en adelante.
</td>
</tr>
</tbody>
</table>
<p>Utilizando el dispositivo <code>/dev/sd<i>X</i></code>, la columna de ejemplo de arriba daría como resultado:
</p>
<pre># cryptsetup --cipher=aes-xts-plain64 --offset=0 --key-file=/dev/sd<i>Z</i> --key-size=512 open --type=plain /dev/sdX enc
</pre>
<p>A diferencia del cifrado con LUKS, la orden anterior debe ejecutarse <i>en su totalidad</i> siempre que el mapeado deba restablecerse, por lo que es importante recordar los datos de cifrado, el hash y el archivo claves.
Ahora podemos comprobar que el mapeo se ha realizado:
</p>
<pre># fdisk -l
</pre>
<p>Debería existir una entrada para <code>/dev/mapper/enc</code>.
</p>
<h2><span class="mw-headline" id="Cifrar_dispositivos_con_cryptsetup">Cifrar dispositivos con cryptsetup</span></h2>
<p>Esta sección muestra cómo emplear las opciones para crear nuevos dispositivos de bloques encriptados y acceder a ellos manualmente.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> GRUB no admite encabezados LUKS2; vea <a rel="nofollow" class="external text" href="https://savannah.gnu.org/bugs/?55093">GRUB bug #55093</a>. Por lo tanto, si planea <a href="../../en/GRUB.html#Encrypted_/boot" title="GRUB">desbloquear una partición de arranque cifrada con GRUB</a>, especifique <code>--type luks1</code> en dispositivos encriptados a los que GRUB deberá acceder.</div>
<h3><span class="mw-headline" id="Cifrar_dispositivos_con_la_modalidad_LUKS">Cifrar dispositivos con la modalidad LUKS</span></h3>
<h4><span class="mw-headline" id="Formatear_particiones_LUKS">Formatear particiones LUKS</span></h4>
<p>Para configurar una partición como una partición cifrada con LUKS, ejecute:
</p>
<pre># cryptsetup luksFormat <i>dispositivo</i>
</pre>
<p>A continuación, se le solicitará que ingrese una contraseña y la verifique.
</p>
<p>Consulte <a href="#Opciones_de_cifrado_para_la_modalidad_LUKS">#Opciones de cifrado para la modalidad LUKS</a> para ver las opciones de la línea de órdenes.
</p>
<p>Puede consultar los resultados con:
</p>
<pre># cryptsetup luksDump <i>dispositivo</i>
</pre>
<p>Notará que el volcado no solo muestra la información del algoritmo de cifrado del encabezado, sino también las ranuras de claves en uso para la partición LUKS.
</p>
<p>El siguiente ejemplo creará una partición raíz cifrada en <code>/dev/sda1</code> utilizando el algoritmo de cifrado <a href="https://en.wikipedia.org/wiki/es:Advanced_Encryption_Standard" class="extiw" title="wikipedia:es:Advanced Encryption Standard">AES</a> predeterminado en modo XTS con un cifrado efectivo de 256 bits:
</p>
<pre># cryptsetup -s 512 luksFormat /dev/sda1
</pre>
<h5><span class="mw-headline" id="Utilizar_LUKS_para_formatear_particiones_con_un_archivo_de_claves">Utilizar LUKS para formatear particiones con un archivo de claves</span></h5>
<p>Al crear una nueva partición encriptada con LUKS, se puede asociar un archivo de claves con la partición al crearla, ejecutando:
</p>
<pre># cryptsetup luksFormat <i>dispositivo</i> <i>/ruta/a/archivo_de_claves</i>
</pre>
<p>Consulte <a href="#Archivos_de_claves">#Archivos de claves</a> para obtener instrucciones sobre cómo generar y gestionar archivos de claves.
</p>
<h4>
<span id="Desbloquear.2Fmapear_particiones_LUKS_con_el_mapeador_de_dispositivos"></span><span class="mw-headline" id="Desbloquear/mapear_particiones_LUKS_con_el_mapeador_de_dispositivos">Desbloquear/mapear particiones LUKS con el mapeador de dispositivos</span>
</h4>
<p>Una vez que se han creado las particiones LUKS, se pueden desbloquear.
</p>
<p>El proceso de desbloqueo asignará a las particiones un nuevo nombre de dispositivo utilizando el mapeador de dispositivos («<i>device mapper</i>»). Esto alerta al kernel de que el <code><i>dispositivo</i></code> es, en realidad, un dispositivo cifrado y debe redireccionarlo a través de LUKS utilizando <code>/dev/mapper/<i>nombre_dispositivo_mapeado</i></code> para no sobrescribir los datos encriptados. Para protegerse contra la sobrescritura accidental, lea acerca de las posibilidades para <a href="#Copia_de_seguridad_y_restauraci%C3%B3n">realizar una copia de seguridad del encabezado cifrado</a> después de finalizar la configuración.
</p>
<p>Para abrir una partición cifrada con LUKS ejecute:
</p>
<pre># cryptsetup open <i>dispositivo</i> <i>nombre_dispositivo_mapeado</i>
</pre>
<p>A continuación, se le solicitará la contraseña para desbloquear la partición. Por lo general, el nombre del dispositivo mapeado es descriptivo de la función de la partición que se le asigna. Por ejemplo, la siguiente orden desbloquea una partición <code>/dev/sda1</code> cifrada con luks y le asignamos un dispositivo mapeado llamado <code>cryptroot</code>:
</p>
<pre># cryptsetup open /dev/sda1 cryptroot 
</pre>
<p>Una vez abierta, la dirección del dispositivo de la partición raíz será <code>/dev/mapper/cryptroot</code>, en lugar de la partición en sí (por ejemplo, <code>/dev/sda1</code>).
</p>
<p>Para configurar LVM sobre la capa de cifrado, el dispositivo para el grupo de volúmenes descifrados sería algo como <code>/dev/mapper/cryptroot</code>, en lugar de <code>/dev/sda1</code>. LVM le dará nombres adicionales a todos los volúmenes lógicos creados, por ejemplo, <code>/dev/lvmpool/root</code> y <code>/dev/lvmpool/swap</code>.
</p>
<p>Para escribir datos encriptados en la partición se debe acceder a través del nombre mapeado del dispositivo. El primer paso de acceso generalmente será <a href="../../es/File_systems.html#Crear_un_sistema_de_archivos" title="File systems (Español)">crear un sistema de archivos</a>. Por ejemplo:
</p>
<pre># mkfs -t ext4 /dev/mapper/cryptroot
</pre>
<p>El dispositivo <code>/dev/mapper/cryptroot</code> puede ser <a href="../../en/File_systems.html#Mount_a_file_system" class="mw-redirect" title="Mount">montado</a> como cualquier otra partición.
</p>
<p>Para cerrar el contenedor luks, desmonte la partición y escriba:
</p>
<pre># cryptsetup close cryptroot
</pre>
<h3><span class="mw-headline" id="Cifrar_dispositivos_con_la_modalidad_plain">Cifrar dispositivos con la modalidad plain</span></h3>
<p>La creación y el acceso subsiguiente de un cifrado en modo plain de <i>dm-crypt</i> no requieren más que usar la acción <i>cryptsetup</i> <code>open</code> con los <a href="#Opciones_de_cifrado_para_la_modalidad_plain">parámetros</a> correctos. Lo siguiente muestra  dos ejemplos de dispositivos que no son raíz, pero agrega una peculiaridad al apilar ambos (es decir, el segundo se crea dentro del primero). Obviamente, apilar el cifrado duplica la sobrecarga. El caso usado aquí es simplemente para ilustrar otro ejemplo de la utilzación de la opción del algoritmo de cifrado.
</p>
<p>Se crea un primer mapeado con los valores predeterminados del modo plain de <i>cryptsetup</i>, como se describe en la columna izquierda de la tabla de arriba
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup --type plain -v open /dev/sdaX plain1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter passphrase: 
Command successful.
</pre>
<p>Ahora agregamos el segundo dispositivo de bloque en su interior, utilizando diferentes parámetros de cifrado y con un desplazamiento —offset— (opcional), creamos un sistema de archivos y lo montamos:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup --type plain --cipher=serpent-xts-plain64 --hash=sha256 --key-size=256 --offset=10  open /dev/mapper/plain1 plain2</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter passphrase:</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># lsblk -p</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> NAME                                                     
 /dev/sda                                     
 ├─/dev/sdaX          
 │ └─/dev/mapper/plain1     
 │   └─/dev/mapper/plain2              
 ...
</pre>
<pre># mkfs -t ext2 /dev/mapper/plain2
# mount -t ext2 /dev/mapper/plain2 /mnt
# echo "This is stacked. one passphrase per foot to shoot." &gt; /mnt/stacked.txt
</pre>
<p>Cerramos la pila para comprobar que funciona el acceso:
</p>
<pre># cryptsetup close plain2
# cryptsetup close plain1
</pre>
<p>Primero, intentemos abrir el sistema de archivos directamente:
</p>
<pre># cryptsetup --type plain --cipher=serpent-xts-plain64 --hash=sha256 --key-size=256 --offset=10 open /dev/sdaX plain2
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># mount -t ext2 /dev/mapper/plain2 /mnt</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">mount: wrong fs type, bad option, bad superblock on /dev/mapper/plain2,
      missing codepage or helper program, or other error
</pre>
<p>¿Por qué no ha funcionado? Porque el bloque de inicio de «plain2» (<code>10</code>) todavía está cifrado con el algoritmo de cifrado de «plain1». Solo se puede acceder a través del mapeador apilado. El error es arbitrario, sin embargo, daría el mismo resultado si probráramos con una contraseña incorrecta o con las opciones de cifrado incorrectas. Para la modalidad plain de <i>dm-crypt</i>, la acción <code>open</code> no generará errores.
</p>
<p>Intentémoslo de nuevo en el orden correcto:
</p>
<pre># cryptsetup close plain2 # mapeador disfuncional del intento anterior
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup --type plain open /dev/sdaX plain1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter passphrase:
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup --type plain --cipher=serpent-xts-plain64 --hash=sha256 --key-size=256 --offset=10 open /dev/mapper/plain1 plain2</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter passphrase:</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># mount /dev/mapper/plain2 /mnt &amp;&amp; cat /mnt/stacked.txt</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">This is stacked. one passphrase per foot to shoot.
</pre>
<p><i>dm-crypt</i> también manejará el cifrado apilado con algunos modos mixtos. Por ejemplo, el modo LUKS podría apilarse sobre el mapeador «plain1». Su encabezado se cifraría dentro de «plain1» cuando se cierra.
</p>
<p>Disponible solo para la modalidad plain está la opción <code>--shared</code>. Con ella, un solo dispositivo se puede segmentar en diferentes mapeadores no superpuestos. Lo hacemos en el siguiente ejemplo, usando un modo de algoritmo de cifrado compatible con <i>loopaes</i>, para «plain2» esta vez:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup --type plain --offset 0 --size 1000 open /dev/sdaX plain1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter passphrase:</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup --type plain --offset 1000 --size 1000 --shared --cipher=aes-cbc-lmk --hash=sha256 open /dev/sdaX plain2</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter passphrase:</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># lsblk -p</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME                    
dev/sdaX                    
├─/dev/sdaX               
│ ├─/dev/mapper/plain1     
│ └─/dev/mapper/plain2     
...
</pre>
<p>Como muestra el árbol del dispositivo, ambos dispositivos mapeados residen en el mismo nivel, es decir, no están apilados y «plain2» se puede abrir individualmente.
</p>
<h2>
<span id="Acciones_de_cryptsetup_espec.C3.ADficas_para_LUKS"></span><span class="mw-headline" id="Acciones_de_cryptsetup_específicas_para_LUKS">Acciones de cryptsetup específicas para LUKS</span>
</h2>
<h3>
<span id="Gesti.C3.B3n_de_claves"></span><span class="mw-headline" id="Gestión_de_claves">Gestión de claves</span>
</h3>
<p>Es posible definir hasta 8 claves diferentes por partición LUKS. Esto permite al usuario crear claves de acceso para guardar una copia de respaldo: es lo que llamamos custodia de clave, una clave se usa para el uso diario, otra se mantiene en custodia para obtener acceso a la partición en caso de que se olvide la frase de contraseña diaria o o se pierda/dañe un archivo de claves. También se podría usar una ranura de claves diferente para otorgar acceso a una partición a un usuario emitiéndole una segunda clave y luego revocándosela.
</p>
<p>Una vez que se ha creado una partición cifrada, se crea con ella la ranura de claves inicial 0 (si no se ha especificado ninguna otra forma manual). Las ranuras de claves adicionales están numeradas del 1 al 7. Las ranuras de claves utilizadas se pueden ver emitiendo:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksDump /dev/&lt;dispositivo&gt; | grep BLED</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Key Slot 0: ENABLED
Key Slot 1: ENABLED
Key Slot 2: ENABLED
Key Slot 3: DISABLED
Key Slot 4: DISABLED
Key Slot 5: DISABLED
Key Slot 6: DISABLED
Key Slot 7: DISABLED
</pre>
<p>Donde &lt;dispositivo&gt; es el volumen que contiene el encabezado LUKS. Esta y las demás órdenes en esta sección también funcionan en los archivos de respaldo del encabezado.
</p>
<h4>
<span id="A.C3.B1adir_claves_LUKS"></span><span class="mw-headline" id="Añadir_claves_LUKS">Añadir claves LUKS</span>
</h4>
<p>Agregar nuevas ranuras de claves («<i>keylot</i>») se logra usando cryptsetup con la acción <code>luksAddKey</code>. Por razones de seguridad, se solicitará siempre una clave válida existente («any passphrase») antes de que se pueda ingresar otra nueva, lo cual es aplicable también para dispositivos ya desbloqueados:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksAddKey /dev/&lt;dispositivo&gt; (/ruta/a/&lt;archivo_de_claves_adicional&gt;)</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter any passphrase:
Enter new passphrase for key slot:
Verify passphrase: 
</pre>
<p>Si se proporciona la <code>/ruta/al/&lt;archivo_de_claves_adicional&gt;</code>, cryptsetup agregará una nueva ranura de claves para el &lt;archivo_de_claves_adicional&gt;. De lo contrario, se le pedirá una nueva frase de contraseña dos veces. Para usar un <i>archivo de claves</i> existente que autorice la acción, la opción <code>--key-file</code> o <code>-d</code> seguida de la opción «antiguo» &lt;archivo_de_claves&gt; intentará desbloquear todas las ranuras de archivos de claves disponibles:
</p>
<pre># cryptsetup luksAddKey /dev/&lt;dispositivo&gt; (/ruta/a/&lt;archivo_de_claves_adicional&gt;) -d /ruta/a/&lt;archivo_de_claves&gt;
</pre>
<p>Si está decidido a usar varias claves y cambiarlas o revocarlas después, la opción <code>--key-slot</code> o <code>-S</code> se puede usar para especificar la ranura en cuestión:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksAddKey /dev/&lt;dispositivo&gt; -S 6</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter any passphrase: 
Enter new passphrase for key slot: 
Verify passphrase:
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksDump /dev/sda8 | grep 'Slot 6'</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Key Slot 6: ENABLED
</pre>
<p>Para mostrar una acción asociada en este ejemplo, decidimos cambiar la clave de inmediato:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksChangeKey /dev/&lt;dispositivo&gt; -S 6</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter LUKS passphrase to be changed: 
Enter new LUKS passphrase:
</pre>
<p>Antes de continuar retirándolo.
</p>
<h4><span class="mw-headline" id="Eliminar_claves_LUKS">Eliminar claves LUKS</span></h4>
<p>Hay tres acciones diferentes para eliminar claves del encabezado:
</p>
<ul>
<li>
<code>luksRemoveKey</code> se usa para eliminar una clave al especificar su contraseña/archivo de claves.</li>
<li>
<code>luksKillSlot</code> puede usarse para eliminar una clave de una ranura de clave específica (usando otra clave). Obviamente, esto es extremadamente útil si ha olvidado una frase de contraseña, perdió un archivo de claves o no tiene acceso a él.</li>
<li>
<code>luksErase</code> se usa para eliminar rápidamente <b>todas</b> las claves activas.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> 
<ul>
<li>¡Todas las acciones anteriores se pueden usar para eliminar irrevocablemente la última clave activa para un dispositivo cifrado!</li>
<li>La orden <code>luksErase</code> se agregó en la versión 1.6.4 para acceder rápidamente al dispositivo. ¡Esta acción <b>no</b> pedirá una frase de contraseña válida! No <a href="../../en/Dm-crypt/Drive_preparation.html#Wipe_LUKS_header" title="Dm-crypt/Drive preparation">limpia el encabezado de LUKS</a>, sino todos los conjuntos de claves de una vez y, por lo tanto, no podrá recuperar el acceso a menos que tenga una copia de seguridad válida del encabezado de LUKS .</li>
</ul>
</div>
<p>Para la advertencia anterior, es bueno saber que la clave que queremos <b>mantener</b> es válida. Una comprobación fácil es desbloquear el dispositivo con la opción <code>-v</code>, que especificará qué ranura ocupa:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup -v open /dev/&lt;dispositivo&gt; testcrypt</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter passphrase for /dev/&lt;dispositivo&gt;: 
Key slot 1 unlocked.
Command successful.
</pre>
<p>Ahora podemos eliminar la clave agregada en la subsección anterior usando su frase de contraseña:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksRemoveKey /dev/&lt;dispositivo&gt;</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter LUKS passphrase to be deleted:
</pre>
<p>Si hubiéramos usado la misma frase de contraseña para dos ranuras de claves, la primera ranura se borraría ahora. Solo ejecutándolo de nuevo eliminaría la segunda.
</p>
<p>Alternativamente, podemos especificar la ranura de la clave:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"> # cryptsetup luksKillSlot /dev/&lt;dispositivo&gt; 6 </pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Ingrese cualquier frase de contraseña LUKS restante:
</pre>
<p>Tenga en cuenta que en ambos casos, no se requerirá confirmación.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksKillSlot /dev/&lt;dispositivo&gt; 6</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter any remaining LUKS passphrase:
</pre>
<p>Para repetir la advertencia anterior: si se hubiera utilizado la misma frase de contraseña para las ranuras de claves 1 y 6, ambas se habrían eliminado.
</p>
<h3>
<span id="Copia_de_seguridad_y_restauraci.C3.B3n"></span><span class="mw-headline" id="Copia_de_seguridad_y_restauración">Copia de seguridad y restauración</span>
</h3>
<p>Si el encabezado de una partición encriptada con LUKS se destruye, no podrá descifrar sus datos. Es un dilema tan grande como olvidar la frase de contraseña o dañar un archivo de claves utilizado para desbloquear la partición. Puede dañarse por un fallo propio al volver a particionar el disco posteriormente o por programas de terceros que malinterpretan la tabla de particiones. Por lo tanto, tener una copia de seguridad del encabezado y almacenarlo en otro disco puede ser una buena idea.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Si una de las frases de acceso de las particiones cifradas con LUKS se ve comprometida, debe revocarla en <i>cada</i> copia del encabezado cifrado, incluso aquellas de las que haya realizado una copia de seguridad. De lo contrario, se puede usar una copia de repaldo del encabezado que usa la frase de contraseña comprometida para determinar la clave maestra que, a su vez, puede usarse para descifrar la partición asociada (incluso su partición real, no solo la versión respaldada). Por otro lado, si la clave maestra se ve comprometida, debe volver a cifrar toda la partición. Consulte <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions#6-backup-and-data-recovery">FAQ de LUKS</a> para obtener más detalles.</div>
<h4><span class="mw-headline" id="Realizar_copia_de_seguridad_utilizando_cryptsetup">Realizar copia de seguridad utilizando cryptsetup</span></h4>
<p>La acción <code>luksHeaderBackup</code> de Cryptsetup almacena una copia de seguridad binaria de la cabecera LUKS y del área de ranuras de claves:
</p>
<pre># cryptsetup luksHeaderBackup /dev/&lt;dispositivo&gt; --header-backup-file /mnt/&lt;backup&gt;/&lt;file&gt;.img
</pre>
<p>donde &lt;dispositivo&gt; es la partición que contiene el volumen LUKS.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Sugerencia:</strong> También puede hacer una copia de seguridad del encabezado de texto sin formato en ramfs y cifrarlo en el ejemplo con gpg antes de escribir en el depósito persistente de la copia de seguridad, ejecutando las órdenes de abajo.</div>
<pre># mkdir /root/&lt;tmp&gt;/
# mount ramfs /root/&lt;tmp&gt;/ -t ramfs
# cryptsetup luksHeaderBackup /dev/&lt;dispositivo&gt; --header-backup-file /root/&lt;tmp&gt;/&lt;file&gt;.img
# gpg2 --recipient &lt;User ID&gt; --encrypt /root/&lt;tmp&gt;/&lt;file&gt;.img 
# cp /root/&lt;tmp&gt;/&lt;file&gt;.img.gpg /mnt/&lt;backup&gt;/
# umount /root/&lt;tmp&gt;
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> Tmpfs puede acudir al disco duro si tiene poca memoria, por lo que no se recomienda aquí.</div>
<h4><span class="mw-headline" id="Restaurar_utilizando_cryptsetup">Restaurar utilizando cryptsetup</span></h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> ¡Restaurar el encabezado incorrecto o restaurar una partición sin cifrar causará la pérdida de datos! La acción no puede realizar una verificación sobre si el encabezado es en realidad el correcto para ese dispositivo en particular.</div>
<p>Con el fin de evitar la restauración de un encabezado incorrecto, puede asegurarse de que funciona si lo usa primero como un <code>--header</code> remoto:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup -v --header /mnt/&lt;backup&gt;/&lt;file&gt;.img open /dev/&lt;dispositivo&gt; test</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Key slot 0 unlocked.
Command successful.
</pre>
<pre># mount /dev/mapper/test /mnt/test &amp;&amp; ls /mnt/test 
# umount /mnt/test 
# cryptsetup close test 
</pre>
<p>Ahora que la comprobación se realizó correctamente, la restauración se puede realizar:
</p>
<pre># cryptsetup luksHeaderRestore /dev/&lt;dispositivo&gt; --header-backup-file ./mnt/&lt;backup&gt;/&lt;file&gt;.img
</pre>
<p>Ahora que todas las áreas de las ranuras de claves están sobrescritas; solo las ranuras de claves activas del archivo de respaldo estarán disponibles después de emitir la orden.
</p>
<h4>
<span id="Copia_de_seguridad_y_restauraci.C3.B3n_manuales"></span><span class="mw-headline" id="Copia_de_seguridad_y_restauración_manuales">Copia de seguridad y restauración manuales</span>
</h4>
<p>El encabezado siempre reside al comienzo del dispositivo y también se puede realizar una copia de seguridad sin acceso a <i>cryptsetup</i>. Primero tiene que averiguar el desplazamiento («<i>offset</i>») de la carga útil de la partición encriptada:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksDump /dev/&lt;dispositivo&gt; | grep "Payload offset"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Payload offset:	4040
</pre>
<p>Segundo, controle el tamaño del sector de la unidad:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># fdisk -l /dev/&lt;dispositivo&gt; | grep "Sector size"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Sector size (logical/physical): 512 bytes / 512 bytes
</pre>
<p>Ahora que conoce los valores, puede hacer una copia de seguridad del encabezado con una simple orden dd:
</p>
<pre># dd if=/dev/&lt;dispositivo&gt; of=/ruta/a/&lt;archivo&gt;.img bs=512 count=4040
</pre>
<p>y almacenarlo de forma segura.
</p>
<p>Luego, se puede realizar una restauración utilizando los mismos valores que los usados cuando se realizó la copia de seguridad:
</p>
<pre># dd if=./&lt;archivo&gt;.img of=/dev/&lt;dispositivo&gt; bs=512 count=4040
</pre>
<h3><span class="mw-headline" id="Volver_a_cifrar_dispositivos">Volver a cifrar dispositivos</span></h3>
<p>El paquete <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span> contiene la herramienta <i>cryptsetup-reencrypt</i>. Se puede usar para convertir un sistema de archivos sin cifrar existente a uno LUKS cifrado (opción <code>--new</code>) y eliminar permanentemente el cifrado LUKS (<code>--decrypt</code>) de un dispositivo. Como su nombre sugiere, también se puede usar para volver a cifrar un dispositivo cifrado con LUKS existente, sin embargo, no es posible volver a cifrarlo para un encabezado LUKS separado u otras modalidades de cifrado (por ejemplo, modo plain). Para volver a cifrar es posible cambiar las <a href="#Opciones_de_cifrado_para_la_modalidad_LUKS">#Opciones de cifrado para la modalidad LUKS</a>. Las acciones <i>cryptsetup-reencrypt</i> solo se pueden realizar en dispositivos sin montar. Consulte <span class="plainlinks archwiki-template-man" title="$ man 8 cryptsetup-reencrypt"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cryptsetup-reencrypt.8">cryptsetup-reencrypt(8)</a></span> para obtener más información.
</p>
<p>Una aplicación del recifrado puede ser asegurar los datos nuevamente después de que una frase de contraseña o <a href="#Archivos_de_claves">#Archivos de claves</a> hayan sido comprometidos <i>y</i> no se puede estar seguro de que no se haya obtenido una copia del encabezado LUKS. Por ejemplo, si solo se ha utilizado el sistema cifrado por una frase de contraseña pero no se ha tenido acceso físico/lógico al dispositivo, sería suficiente cambiar solo la frase de contraseña/clave respectiva (<a href="#Gesti%C3%B3n_de_claves">#Gestión de claves</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> ¡Asegúrese siempre de que esté disponible una <b>copia de seguridad fiable</b> y verifique las opciones que especifique antes de usar la herramienta!</div>
<p>A continuación se muestra un ejemplo para cifrar una partición del sistema de archivos sin cifrar, así como un nuevo cifrado de un dispositivo cifrado con LUKS existente.
</p>
<h4><span class="mw-headline" id="Cifrar_un_sistema_de_archivos_no_cifrado">Cifrar un sistema de archivos no cifrado</span></h4>
<p>Un encabezado de cifrado LUKS siempre se almacena al principio del dispositivo. Como a un sistema de archivos existente generalmente se le asignarán todos los sectores de partición, el primer paso es reducirlo para hacer espacio para el encabezado LUKS.
</p>
<p>Las algoritmos de cifrado <a href="#Opciones_de_cifrado_para_la_modalidad_LUKS">predeterminado</a> para cifrar LUKS requieren <code>4096</code> sectores de 512 bytes. Verificamos el espacio y lo mantenemos simple al reducir el sistema de archivos <code>ext4</code> existente en <code>/dev/sdaX</code> a su mínimo actual posible:
</p>
<pre># umount /mnt
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># e2fsck -f /dev/sdaX</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">e2fsck 1.43-WIP (18-May-2015)
Pass 1: Checking inodes, blocks, and sizes
...
/dev/sda6: 12/166320 files (0.0% non-contiguous), 28783/665062 blocks
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># resize2fs -M /dev/sdaX</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">resize2fs 1.43-WIP (18-May-2015)
Resizing the filesystem on /dev/sdaX to 26347 (4k) blocks.
The filesystem on /dev/sdaX is now 26347 (4k) blocks long.
</pre>
<p>Ahora lo ciframos, utilizando el algoritmo de cifrado predeterminado, el cual no tenemos que especificarlo explícitamente.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup-reencrypt /dev/sdaX --new  --reduce-device-size 4096S</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter new passphrase: 
Verify passphrase:
Finished, time 00:05.126,  952 MiB written, speed 185,7 MiB/s
</pre>
<p>Una vez finalizado, el cifrado se habrá realizado en la partición completa, es decir, no solo el espacio al que se redujo el sistema de archivos (<code>sdaX</code> tiene <code>2.6GiB</code> y la CPU utilizada en el ejemplo no tiene instrucciones AES de hardware). Como paso final, extendemos nuevamente el sistema de archivos del dispositivo ahora encriptado para que ocupe el espacio disponible:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup open /dev/sdaX recrypt</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter passphrase for /dev/sdaX: 
...
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># resize2fs /dev/mapper/recrypt</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">resize2fs 1.43-WIP (18-May-2015)
Resizing the filesystem on /dev/mapper/recrypt to 664807 (4k) blocks.
The filesystem on /dev/mapper/recrypt is now 664807 (4k) blocks long.
</pre>
<pre># mount /dev/mapper/recrypt /mnt
</pre>
<p>y ya estará hecho.
</p>
<h4>
<span id="Recifrar_una_partici.C3.B3n_LUKS_existente"></span><span class="mw-headline" id="Recifrar_una_partición_LUKS_existente">Recifrar una partición LUKS existente</span>
</h4>
<p>En este ejemplo, se vuelve a cifrar un dispositivo LUKS existente.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> ¡Vuelva a verificar que se han especificado las opciones de cifrado para <i>cryptsetup-reencrypt</i> correctamente y <i>nunca</i> recifre  sin tener una <b>copia de seguridad fiable</b>!</div>
<p>Para volver a cifrar un dispositivo con sus opciones de cifrado existentes, no es necesario especificarlas. Un simple:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup-reencrypt /dev/sdaX</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter passphrase for key slot 0: 
Progress: 100,0%, ETA 00:00, 2596 MiB written, speed  36,5 MiB/s
</pre>
<p>lo realiza.
</p>
<p>Un posible caso de uso es volver a cifrar los dispositivos LUKS que tienen opciones de cifrado no actuales. Además de la advertencia anterior sobre la especificación de las opciones correctamente, la capacidad de cambiar el encabezado LUKS también puede verse limitada por su tamaño. Por ejemplo, si el dispositivo se cifró inicialmente utilizando un algoritmo de cifrado del <a href="https://en.wikipedia.org/wiki/es:Modos_de_operaci%C3%B3n_de_una_unidad_de_cifrado_por_bloques#Modo_CBC_.28Cipher-block_chaining.29" class="extiw" title="wikipedia:es:Modos de operación de una unidad de cifrado por bloques">modo CBC</a> y un tamaño de clave de 128 bits, el encabezado LUKS tendrá la mitad del tamaño de los <code>4096</code> sectores mencionados anteriormente:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksDump /dev/sdaX |grep -e "mode" -e "Payload" -e "MK bits"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Cipher mode:   	cbc-essiv:sha256
Payload offset:	<b>2048</b>
MK bits:       	128
</pre>
<p>Si bien es posible actualizar el cifrado de un dispositivo de este tipo, actualmente solo es posible en dos pasos. Primero, vuelva a encriptar con las mismas opciones de encriptación, pero use la opción <code>--reduce-device-size</code> para hacer el espacio del encabezado LUKS más grande. En segundo lugar, vuelva a cifrar todo el dispositivo con el cifrado deseado. Por este motivo y por el hecho de que se debe crear una copia de seguridad en cualquier caso, la creación de un nuevo dispositivo cifrado para restaurar es siempre la opción más rápida.
</p>
<h2>
<span id="Cambiar_el_tama.C3.B1o_de_dispositivos_cifrados"></span><span class="mw-headline" id="Cambiar_el_tamaño_de_dispositivos_cifrados">Cambiar el tamaño de dispositivos cifrados</span>
</h2>
<p>Si un dispositivo de almacenamiento cifrado con dm-crypt se clona (con una herramienta como dd) a otro dispositivo más grande, el dispositivo dm-crypt subyacente debe redimensionarse para usar todo el espacio.
</p>
<p>El dispositivo de destino es /dev/sdX2 en este ejemplo, se utilizará todo el espacio disponible adyacente a la partición:
</p>
<pre># cryptsetup luksOpen /dev/sdX2 sdX2
# cryptsetup resize sdX2
</pre>
<p>Entonces el sistema de archivos subyacente debe ser redimensionado.
</p>
<h3><span class="mw-headline" id="Sistema_de_archivos_de_loopback">Sistema de archivos de loopback</span></h3>
<p>Suponga que un sistema de archivos loopback cifrado está almacenado en un archivo <code>/bigsecret</code>, vinculado a <code>/dev/loop0</code>, mapeado a <code>secret</code> y montado en <code>/mnt/secret</code>, como en el ejemplo en <a href="../../es/Dm-crypt/Encrypting_a_non-root_file_system.html#Dispositivo_loop" title="Dm-crypt (Español)/Encrypting a non-root file system (Español)">dm-crypt (Español)/Encrypting a non-root file system (Español)#Dispositivo loop</a>.
</p>
<p>Si el archivo contenedor está actualmente mapeado y/o montado, desmóntelo y/o ciérrelo:
</p>
<pre># umount /mnt/secret
# cryptsetup close secret
# losetup -d /dev/loop0
</pre>
<p>A continuación, expanda el archivo contenedor con el tamaño de los datos que desea agregar. En este ejemplo, el archivo se expandirá con 1M * 1024, que es 1G.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> Asegúrese bien de usar <b>dos</b> <code>&gt;</code>, en lugar de solo uno, de lo contrario, sobrescribirá el archivo en lugar de agregar contenido. Se recomienda hacer una copia de seguridad antes de este paso.</div>
<pre># dd if=/dev/urandom bs=1M count=1024 | cat - &gt;&gt; /bigsecret
</pre>
<p>Ahora mapee el contenedor al dispositivo de loop:
</p>
<pre># losetup /dev/loop0 /bigsecret
# cryptsetup open /dev/loop0 secret
</pre>
<p>Después de esto, cambie el tamaño de la parte cifrada del contenedor al nuevo tamaño máximo del archivo contenedor:
</p>
<pre># cryptsetup resize secret
</pre>
<p>Finalmente, realice una comprobación del sistema de archivos y, si está bien, cambie su tamaño (ejemplo para ext2/3/4):
</p>
<pre># e2fsck -f /dev/mapper/secret
# resize2fs /dev/mapper/secret
</pre>
<p>Ahora puede montar el contenedor de nuevo:
</p>
<pre># mount /dev/mapper/secret /mnt/secret
</pre>
<h2><span class="mw-headline" id="Archivos_de_claves">Archivos de claves</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Esta sección describe el uso de un archivo de claves de texto plano. Si desea cifrar su archivo de claves dándole una autenticación de dos factores, consulte <a href="../../en/Dm-crypt/Specialties.html#Using_GPG,_LUKS,_or_OpenSSL_Encrypted_Keyfiles" title="Dm-crypt/Specialties">Using GPG or OpenSSL Encrypted Keyfiles</a> para obtener más información, pero no deje de leer esta sección.</div>
<p><b>¿Qué es un archivo de claves?</b>
</p>
<p>Un archivo de claves es un archivo cuyos datos se utilizan como frase de contraseña para desbloquear un volumen cifrado.
Eso significa que si un archivo de este tipo se pierde o se modifica, ya no será posible descifrar el volumen.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Sugerencia:</strong> Defina una frase de contraseña además del archivo de claves para el acceso de respaldo a los volúmenes cifrados en caso de que el archivo de claves definido se pierda o cambie.</div>
<p><b>¿Por qué usar un archivo de claves?</b>
</p>
<p>Hay muchos tipos de archivos de claves. Cada tipo de archivo de claves utilizado tiene ventajas y desventajas que se resumen a continuación:
</p>
<h3><span class="mw-headline" id="Tipos_de_archivos_de_claves">Tipos de archivos de claves</span></h3>
<h4>
<span id="Frase_de_contrase.C3.B1a"></span><span class="mw-headline" id="Frase_de_contraseña">Frase de contraseña</span>
</h4>
<p>Este es un archivo de claves que contiene una frase de contraseña simple. El beneficio de este tipo de archivo de claves es que si se pierde el archivo, los datos que contiene son conocidos y, con suerte, recordados fácilmente por el propietario del volumen cifrado. Sin embargo, la desventaja es que esto no agrega ninguna seguridad al ingresar una frase de contraseña durante la fase inicial del sistema.
</p>
<p>Ejemplo: <code>1234</code>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> El archivo de claves que contiene la contraseña no debe contener una nueva línea en él. Una opción es crearlo usando:
<pre># echo -n 'your_passphrase' &gt; /ruta/a/&lt;archivo_de_claves&gt;
# chown root:root /ruta/a/&lt;archivo_de_claves&gt;; chmod 400 /ruta/a/&lt;archivo_de_claves&gt;
</pre>
</div>
<h4><span class="mw-headline" id="Texto_aleatorio">Texto aleatorio</span></h4>
<p>Este es un archivo de claves que contiene un bloque de caracteres aleatorios. La ventaja de este tipo de archivo de claves es que es mucho más resistente a los <a href="https://en.wikipedia.org/wiki/es:Ataque_de_diccionario" class="extiw" title="wikipedia:es:Ataque de diccionario">ataques de diccionario</a> que una simple frase de contraseña. Se puede utilizar una fuerza adicional de archivos de claves en esta situación, que es la longitud de los datos utilizados. Dado que no se trata de una cadena que debe memorizar una persona para su entrada, es intrascendente crear archivos que contengan miles de caracteres aleatorios como clave. La desventaja es que si este archivo se pierde o cambia, lo más probable es que no sea posible acceder al volumen cifrado sin una frase de contraseña de respaldo.
</p>
<p>Ejemplo: <code>fjqweifj830149-57 819y4my1-38t1934yt8-91m 34co3;t8y;9p3y-</code>
</p>
<h4><span class="mw-headline" id="Binario">Binario</span></h4>
<p>Este es un archivo binario que se ha definido como un archivo de claves. Al identificar archivos como candidatos para un archivo de claves, se recomienda elegir archivos que sean relativamente estáticos, como fotos, música, videoclips. La ventaja de estos archivos es que cumplen una doble función que puede dificultar su identificación como archivos de claves. En lugar de tener un archivo de texto con una gran cantidad de texto aleatorio, el archivo de claves se verá como un archivo de imagen normal o un clip de música para el observador casual. La desventaja es que si este archivo se pierde o cambia, lo más probable es que no sea posible acceder al volumen cifrado sin una frase de contraseña de respaldo. Además, existe una pérdida teórica de aleatoriedad en comparación con un archivo de texto generado aleatoriamente. Esto se debe al hecho de que las imágenes, los videos y la música tienen alguna relación intrínseca entre los bits de datos vecinos que no existe para un archivo de texto aleaotorio. Sin embargo, esto es controvertido y nunca ha sido explotado públicamente.
</p>
<p>Ejemplo: imágenes, texto, video, ...
</p>
<h3><span class="mw-headline" id="Crear_un_archivo_claves_con_caracteres_aleatorios">Crear un archivo claves con caracteres aleatorios</span></h3>
<h4><span class="mw-headline" id="Almacenar_el_archivo_de_claves_en_un_sistema_de_archivos">Almacenar el archivo de claves en un sistema de archivos</span></h4>
<p>Un archivo de claves puede ser de contenido y tamaño arbitrario.
</p>
<p>Aquí <code>dd</code> se utiliza para generar un archivo de claves de 2048 bytes aleatorios, almacenándolo en el archivo <code>/etc/mi_archivo_de_claves</code>:
</p>
<pre># dd bs=512 count=4 if=/dev/random of=/etc/mi_archivo_de_claves iflag=fullblock
</pre>
<p>Si planea almacenar el archivo de claves en un dispositivo externo, también puede simplemente cambiar el archivo de salida al directorio correspondiente:
</p>
<pre># dd bs=512 count=4 if=/dev/random of=/media/usbstick/mi_archivo_de_claves iflag=fullblock
</pre>
<p>Para denegar cualquier acceso para otros usuarios, entonces limítelo a <code>root</code>:
</p>
<pre># chmod 600 /etc/mi_archivo_de_claves
</pre>
<h5><span class="mw-headline" id="Sobrescribir_de_forma_segura_los_archivos_de_claves_almacenados">Sobrescribir de forma segura los archivos de claves almacenados</span></h5>
<p>Si almacenó su archivo de claves temporalmente en un dispositivo de almacenamiento físico y desea eliminarlo, recuerde no solo eliminar el archivo de claves sin más, sino usar algo como:
</p>
<pre># shred --remove --zero mi_archivo_de_claves
</pre>
<p>para sobrescribirlo de forma segura. Para sistemas de archivos tradicionales como FAT o ext2, esto será suficiente, mientras que en el caso de sistemas de archivos con registro por diario, hardware de memoria flash y otros casos, se recomienda encarecidamente <a href="../../en/Securely_wipe_disk.html" title="Securely wipe disk">limpiar todo el dispositivo</a>.
</p>
<h4><span class="mw-headline" id="Almacenar_el_archivo_de_claves_en_ramfs">Almacenar el archivo de claves en ramfs</span></h4>
<p>Alternativamente, puede montar un ramfs para almacenar el archivo de claves temporalmente:
</p>
<pre># mkdir /root/myramfs
# mount ramfs /root/myramfs/ -t ramfs
# cd /root/myramfs
</pre>
<p>La ventaja es que reside en la memoria RAM y no en un disco físico, por lo que no se puede recuperar después de desmontar la ramfs. Después de copiar el archivo de claves en otro sistema de archivos seguro y persistente, desmonte la ramfs nuevamente con:
</p>
<pre># umount /root/myramfs
</pre>
<h3><span class="mw-headline" id="Configurar_LUKS_para_que_haga_uso_del_archivo_de_claves">Configurar LUKS para que haga uso del archivo de claves</span></h3>
<p>Agregue una ranura de claves para el archivo de claves al encabezado LUKS:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksAddKey /dev/sda2 /etc/mi_archivo_de_claves</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter any LUKS passphrase:
key slot 0 unlocked.
Command successful.
</pre>
<h3>
<span id="Desbloquear_manualmente_una_partici.C3.B3n_usando_un_archivo_de_claves"></span><span class="mw-headline" id="Desbloquear_manualmente_una_partición_usando_un_archivo_de_claves">Desbloquear manualmente una partición usando un archivo de claves</span>
</h3>
<p>Utilice la opción <code>--key-file</code> al abrir el dispositivo LUKS:
</p>
<pre># cryptsetup open /dev/sda2 <i>nombre_dispositivo_mapeado</i> --key-file /etc/mi_archivo_de_claves
</pre>
<h3>
<span id="Desbloquear_la_partici.C3.B3n_ra.C3.ADz_en_el_arranque"></span><span class="mw-headline" id="Desbloquear_la_partición_raíz_en_el_arranque">Desbloquear la partición raíz en el arranque</span>
</h3>
<p>Esto es simplemente cuestión de configurar <a href="../../en/Mkinitcpio.html" class="mw-redirect" title="Mkinitcpio (Español)">mkinitcpio (Español)</a> para incluir los módulos o archivos necesarios y configurar el <a href="../../es/Kernel_parameters.html" title="Kernel parameters (Español)">parámetro del kernel</a> <a href="../../en/Dm-crypt/System_configuration.html#cryptkey" title="Dm-crypt/System configuration">cryptkey</a> para saber dónde encontrar el archivo de claves.
</p>
<p>Dos casos se tratan a continuación:
</p>
<ol>
<li>usar un archivo de claves almacenado en un medio externo (aquí una memoria USB);</li>
<li>usar un archivo de claves incrustado en initramfs.</li>
</ol>
<h4><span class="mw-headline" id="Con_un_archivo_de_claves_almacenado_en_un_medio_externo">Con un archivo de claves almacenado en un medio externo</span></h4>
<h5><span class="mw-headline" id="Configurar_mkinitcpio">Configurar mkinitcpio</span></h5>
<p>Debe agregar un módulo en <code>/etc/mkinitcpio.conf</code> para el sistema de archivos de la unidad (el módulo <code>vfat</code> en el siguiente ejemplo):
</p>
<pre>MODULES=(vfat)
</pre>
<p>En este ejemplo, se supone que utiliza una unidad USB con formato FAT (módulo <code>vfat</code>). Reemplace esos nombres de módulos si usa otro sistema de archivos en su memoria USB (por ejemplo, <code>ext2</code>) u otra página de códigos. Si el sistema se queja de la existencia de un superbloque defectuoso y una página de códigos incorrecta en el arranque, entonces necesita un módulo de página de códigos adicional para cargar. Por ejemplo, es posible que necesite el módulo <code>nls_iso8859-1</code> para la página de códigos <code>iso8859-1</code>.
</p>
<p>Si tiene un teclado no estadounidense, puede resultar útil cargar la distribución del teclado antes de que se le solicite ingresar la contraseña para desbloquear la partición raíz en el inicio. Para esto, necesitará el hook <code>keymap</code> antes de <code>encrypt</code>.
</p>
<p><a href="../../en/Mkinitcpio.html#Image_creation_and_activation" title="Mkinitcpio">regenere initramfs</a>.
</p>
<h5>
<span id="Configurar_par.C3.A1metros_del_kernel"></span><span class="mw-headline" id="Configurar_parámetros_del_kernel">Configurar parámetros del kernel</span>
</h5>
<p>Agregue las siguientes opciones a los <a href="../../es/Kernel_parameters.html" title="Kernel parameters (Español)">parámetros del kernel</a> si usa el hook <code>encrypt</code>. Si usa <code>sd-encrypt</code> vea <a href="../../en/Dm-crypt/System_configuration.html#Using_systemd-cryptsetup-generator" title="Dm-crypt/System configuration">dm-crypt/System configuration#Using systemd-cryptsetup-generator</a>.
</p>
<pre>cryptdevice=/dev/<i>&lt;partición1&gt;</i>:root cryptkey=/dev/<i>&lt;partición2&gt;</i>:&lt;tipo-de-sistema-de-archivos&gt;:&lt;ruta&gt;
</pre>
<p>Por ejemplo:
</p>
<pre>cryptdevice=/dev/sda3:root cryptkey=/dev/sdb1:vfat:/keys/secretkey
</pre>
<p>La elección de un nombre de archivo plano para su clave proporciona un bit de <a href="https://en.wikipedia.org/wiki/es:Seguridad_por_oscuridad" class="extiw" title="wikipedia:es:Seguridad por oscuridad">«seguridad por oscuridad»</a>, pero tenga en cuenta que la línea de órdenes del kernel se registra en el log del kernel (<i>dmesg</i>). El archivo de claves no puede ser un archivo oculto, lo que significa que el nombre de archivo no puede comenzar con un punto, o el hook <code>encrypt</code> no podrá encontrar el archivo de claves durante el proceso de arranque. Alternativamente, se podría ocultar el archivo de claves entre las particiones y usarlo:
</p>
<pre>cryptkey=/dev/sdb1:offset:size
</pre>
<p>Como ventaja, es más difícil eliminar la clave accidentalmente.
</p>
<p>No se garantiza que la denominación de nodos de dispositivos como <code>/dev/sdb1</code> permanezca igual en todos los reinicios. En su lugar, es más fiable acceder al dispositivo con los <a href="../../es/Persistent_block_device_naming.html" title="Persistent block device naming (Español)">nombre de dispositivo de bloque persistente</a> de udev. Para asegurarse de que el hook <code>encrypt</code> encuentre su archivo de claves al leerlo desde un dispositivo de almacenamiento externo, se deben usar nombres de dispositivos de bloques persistentes. Consulte el artículo <a href="../../es/Persistent_block_device_naming.html" title="Persistent block device naming (Español)">persistent block device naming (Español)</a>.
</p>
<h4><span class="mw-headline" id="Con_un_archivo_de_clave_incrustado_en_initramfs">Con un archivo de clave incrustado en initramfs</span></h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> Utilice un archivo de claves incrustado <b>solo</b> si tiene de antemano algún tipo de mecanismo de autenticación que proteja suficientemente el archivo de claves. De lo contrario, se producirá el descifrado automático, anulando por completo el propósito de bloquear el cifrado del dispositivo.</div>
<p>Este método permite usar un archivo de claves con un nombre especial que se incrustará en <a href="../../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">initramfs</a> y se rescatará por el <a href="../../en/Mkinitcpio.html#HOOKS" title="Mkinitcpio">hook</a> <code>encrypt</code> para desbloquear el sistema de archivos raíz (<code>cryptdevice</code>) automáticamente. Puede ser útil aplicar cuando se usa la función <a href="../../en/GRUB.html#Encrypted_/boot" title="GRUB">cifrar GRUB en fase temprana</a>, para evitar el ingreso de dos frases de contraseña durante el inicio.
</p>
<p>El hook <code>encrypt</code> permite al usuario especificar un archivo de claves con el parámetro del kernel <code>cryptkey</code>: en el caso de initramfs, la sintaxis es <code>rootfs:<i>ruta</i></code>. Consulte <a href="../../en/Dm-crypt/System_configuration.html#cryptkey" title="Dm-crypt/System configuration">dm-crypt/System configuration#cryptkey</a>. Además, este parámetro del kernel utiliza de manera predeterminada <code>/crypto_keyfile.bin</code>, y si initramfs contiene una clave válida con este nombre, el descifrado se producirá automáticamente sin necesidad de configurar el parámetro <code>cryptkey</code>.
</p>
<p>Si usa <code>sd-encrypt</code> en lugar de <code>encrypt</code>, especifique la ubicación del archivo de claves con el parámetro del kernel <code>rd.luks.key</code>. Consulte <a href="../../en/Dm-crypt/System_configuration.html#rd.luks.key" title="Dm-crypt/System configuration">dm-crypt/System configuration#rd.luks.key</a>.
</p>
<p><a href="#Crear_un_archivo_claves_con_caracteres_aleatorios">Genere el archivo de claves</a>, otórguele los permisos adecuados y <a href="#A%C3%B1adir_claves_LUKS">agréguelo como una clave LUKS</a>:
</p>
<pre># dd bs=512 count=4 if=/dev/random of=/crypto_keyfile.bin iflag=fullblock
# chmod 600 /crypto_keyfile.bin
# chmod 600 /boot/initramfs-linux*
# cryptsetup luksAddKey /dev/sdX# /crypto_keyfile.bin
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> Cuando los permisos de initramfs están configurados en 644 (por defecto), todos los usuarios podrán volcar el archivo de claves. Asegúrese de que los permisos sigan siendo 600 si instala un nuevo kernel.</div>
<p>Incluya la clave en la <a href="../../en/Mkinitcpio.html#BINARIES_and_FILES" title="Mkinitcpio">matriz de FILES de mkinitcpio</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">FILES=(/crypto_keyfile.bin)</pre>
<p>Finalmente <a href="../../en/Mkinitcpio.html#Image_creation_and_activation" title="Mkinitcpio">regenere initramfs</a>.
</p>
<p>En el siguiente reinicio, solo debe ingresar la frase de contraseña de descifrado del contenedor una vez.
</p>
<p>(<a rel="nofollow" class="external text" href="https://www.pavelkogan.com/2014/05/23/luks-full-disk-encryption/#bonus-login-once">fuente</a>)
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../es/Category:Data-at-rest_encryption.html" title="Category:Data-at-rest encryption (Español)">Data-at-rest encryption (Español)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Dm-crypt_(Espa%C3%B1ol)/Device_encryption_(Espa%C3%B1ol)&amp;oldid=802026">https://wiki.archlinux.org/index.php?title=Dm-crypt_(Español)/Device_encryption_(Español)&amp;oldid=802026</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 3 March 2024, at 10:10.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
