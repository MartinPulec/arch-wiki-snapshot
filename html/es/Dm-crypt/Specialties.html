<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>dm-crypt (Español)/Specialties (Español) - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Dm-crypt_Español_Specialties_Español rootpage-Dm-crypt_Español skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Asegurar_la_partición_de_arranque_no_cifrada" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Asegurar_la_partici%C3%B3n_de_arranque_no_cifrada">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Asegurar la partición de arranque no cifrada</div>
		</a>
		
			<button aria-controls="toc-Asegurar_la_partición_de_arranque_no_cifrada-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Asegurar la partición de arranque no cifrada subsection</span>
			</button>
		
		<ul id="toc-Asegurar_la_partición_de_arranque_no_cifrada-sublist" class="vector-toc-list">
			<li id="toc-Arrancar_desde_un_dispositivo_extraíble" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Arrancar_desde_un_dispositivo_extra%C3%ADble">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Arrancar desde un dispositivo extraíble</div>
			</a>
			
			<ul id="toc-Arrancar_desde_un_dispositivo_extraíble-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-chkboot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#chkboot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>chkboot</div>
			</a>
			
			<ul id="toc-chkboot-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-mkinitcpio-chkcryptoboot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#mkinitcpio-chkcryptoboot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>mkinitcpio-chkcryptoboot</div>
			</a>
			
			<ul id="toc-mkinitcpio-chkcryptoboot-sublist" class="vector-toc-list">
				<li id="toc-Instalación" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Instalaci%C3%B3n">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.1</span>Instalación</div>
			</a>
			
			<ul id="toc-Instalación-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Descripción_técnica" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Descripci%C3%B3n_t%C3%A9cnica">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.2</span>Descripción técnica</div>
			</a>
			
			<ul id="toc-Descripción_técnica-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-AIDE" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#AIDE">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.4</span>AIDE</div>
			</a>
			
			<ul id="toc-AIDE-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-STARK" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#STARK">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.5</span>STARK</div>
			</a>
			
			<ul id="toc-STARK-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Utilizar_archivos_de_claves_cifrados_con_GPG,_LUKS_o_OpenSSL" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Utilizar_archivos_de_claves_cifrados_con_GPG,_LUKS_o_OpenSSL">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Utilizar archivos de claves cifrados con GPG, LUKS o OpenSSL</div>
		</a>
		
		<ul id="toc-Utilizar_archivos_de_claves_cifrados_con_GPG,_LUKS_o_OpenSSL-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Desbloqueo_remoto_de_la_partición_(u_otro_volumen)_raíz" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Desbloqueo_remoto_de_la_partici%C3%B3n_(u_otro_volumen)_ra%C3%ADz">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Desbloqueo remoto de la partición (u otro volumen) raíz</div>
		</a>
		
			<button aria-controls="toc-Desbloqueo_remoto_de_la_partición_(u_otro_volumen)_raíz-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Desbloqueo remoto de la partición (u otro volumen) raíz subsection</span>
			</button>
		
		<ul id="toc-Desbloqueo_remoto_de_la_partición_(u_otro_volumen)_raíz-sublist" class="vector-toc-list">
			<li id="toc-Desbloqueo_remoto_(hooks:_systemd,_systemd-tool)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Desbloqueo_remoto_(hooks:_systemd,_systemd-tool)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Desbloqueo remoto (hooks: systemd, systemd-tool)</div>
			</a>
			
			<ul id="toc-Desbloqueo_remoto_(hooks:_systemd,_systemd-tool)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Desbloqueo_remoto_(hooks:_netconf,_dropbear,_tinyssh,_ppp)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Desbloqueo_remoto_(hooks:_netconf,_dropbear,_tinyssh,_ppp)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Desbloqueo remoto (hooks: netconf, dropbear, tinyssh, ppp)</div>
			</a>
			
			<ul id="toc-Desbloqueo_remoto_(hooks:_netconf,_dropbear,_tinyssh,_ppp)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Desbloqueo_remoto_a_través_de_wifi_(hooks:_construya_el_suyo_propio)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Desbloqueo_remoto_a_trav%C3%A9s_de_wifi_(hooks:_construya_el_suyo_propio)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Desbloqueo remoto a través de wifi (hooks: construya el suyo propio)</div>
			</a>
			
			<ul id="toc-Desbloqueo_remoto_a_través_de_wifi_(hooks:_construya_el_suyo_propio)-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Soporte_Discard/TRIM_para_unidades_de_estado_sólido_(SSD)" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Soporte_Discard/TRIM_para_unidades_de_estado_s%C3%B3lido_(SSD)">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Soporte Discard/TRIM para unidades de estado sólido (SSD)</div>
		</a>
		
		<ul id="toc-Soporte_Discard/TRIM_para_unidades_de_estado_sólido_(SSD)-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-El_hook_encrypt_y_varios_discos" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#El_hook_encrypt_y_varios_discos">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>El hook encrypt y varios discos</div>
		</a>
		
			<button aria-controls="toc-El_hook_encrypt_y_varios_discos-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle El hook encrypt y varios discos subsection</span>
			</button>
		
		<ul id="toc-El_hook_encrypt_y_varios_discos-sublist" class="vector-toc-list">
			<li id="toc-Expandir_LVM_en_varios_discos" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Expandir_LVM_en_varios_discos">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Expandir LVM en varios discos</div>
			</a>
			
			<ul id="toc-Expandir_LVM_en_varios_discos-sublist" class="vector-toc-list">
				<li id="toc-Añadir_una_nueva_unidad" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#A%C3%B1adir_una_nueva_unidad">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.1</span>Añadir una nueva unidad</div>
			</a>
			
			<ul id="toc-Añadir_una_nueva_unidad-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Extender_el_volumen_lógico" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Extender_el_volumen_l%C3%B3gico">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.2</span>Extender el volumen lógico</div>
			</a>
			
			<ul id="toc-Extender_el_volumen_lógico-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Modificar_el_hook_encrypt_para_varias_particiones" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Modificar_el_hook_encrypt_para_varias_particiones">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Modificar el hook encrypt para varias particiones</div>
			</a>
			
			<ul id="toc-Modificar_el_hook_encrypt_para_varias_particiones-sublist" class="vector-toc-list">
				<li id="toc-Sistema_de_archivos_raíz_que_abarca_múltiples_particiones" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Sistema_de_archivos_ra%C3%ADz_que_abarca_m%C3%BAltiples_particiones">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.1</span>Sistema de archivos raíz que abarca múltiples particiones</div>
			</a>
			
			<ul id="toc-Sistema_de_archivos_raíz_que_abarca_múltiples_particiones-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Múltiples_particiones_no_root" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#M%C3%BAltiples_particiones_no_root">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.2</span>Múltiples particiones no root</div>
			</a>
			
			<ul id="toc-Múltiples_particiones_no_root-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Sistema_cifrado_usando_un_encabezado_LUKS_separado" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Sistema_cifrado_usando_un_encabezado_LUKS_separado">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Sistema cifrado usando un encabezado LUKS separado</div>
		</a>
		
			<button aria-controls="toc-Sistema_cifrado_usando_un_encabezado_LUKS_separado-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Sistema cifrado usando un encabezado LUKS separado subsection</span>
			</button>
		
		<ul id="toc-Sistema_cifrado_usando_un_encabezado_LUKS_separado-sublist" class="vector-toc-list">
			<li id="toc-Utilizar_el_hook_systemd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Utilizar_el_hook_systemd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>Utilizar el hook systemd</div>
			</a>
			
			<ul id="toc-Utilizar_el_hook_systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Modificar_el_hook_encrypt" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Modificar_el_hook_encrypt">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2</span>Modificar el hook encrypt</div>
			</a>
			
			<ul id="toc-Modificar_el_hook_encrypt-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-/boot_cifrado_y_un_encabezado_LUKS_separado_en_USB" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#/boot_cifrado_y_un_encabezado_LUKS_separado_en_USB">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>/boot cifrado y un encabezado LUKS separado en USB</div>
		</a>
		
			<button aria-controls="toc-/boot_cifrado_y_un_encabezado_LUKS_separado_en_USB-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle /boot cifrado y un encabezado LUKS separado en USB subsection</span>
			</button>
		
		<ul id="toc-/boot_cifrado_y_un_encabezado_LUKS_separado_en_USB-sublist" class="vector-toc-list">
			<li id="toc-Preparar_las_particiones_de_los_discos" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Preparar_las_particiones_de_los_discos">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1</span>Preparar las particiones de los discos</div>
			</a>
			
			<ul id="toc-Preparar_las_particiones_de_los_discos-sublist" class="vector-toc-list">
				<li id="toc-Preparar_la_llave_USB" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Preparar_la_llave_USB">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1.1</span>Preparar la llave USB</div>
			</a>
			
			<ul id="toc-Preparar_la_llave_USB-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Preparar_la_unidad_principal" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Preparar_la_unidad_principal">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1.2</span>Preparar la unidad principal</div>
			</a>
			
			<ul id="toc-Preparar_la_unidad_principal-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Procedimiento_de_instalación_y_personalización_del_hook_encrypt" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Procedimiento_de_instalaci%C3%B3n_y_personalizaci%C3%B3n_del_hook_encrypt">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2</span>Procedimiento de instalación y personalización del hook encrypt</div>
			</a>
			
			<ul id="toc-Procedimiento_de_instalación_y_personalización_del_hook_encrypt-sublist" class="vector-toc-list">
				<li id="toc-Cargador_de_arranque" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Cargador_de_arranque">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2.1</span>Cargador de arranque</div>
			</a>
			
			<ul id="toc-Cargador_de_arranque-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Cambiar_el_archivo_de_claves_LUKS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Cambiar_el_archivo_de_claves_LUKS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.3</span>Cambiar el archivo de claves LUKS</div>
			</a>
			
			<ul id="toc-Cambiar_el_archivo_de_claves_LUKS-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">dm-crypt (Español)/Specialties (Español)</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-en mw-list-item"><a href="../../en/Dm-crypt/Specialties.html" title="Dm-crypt/Specialties – English" lang="en" hreflang="en" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Dm-crypt/%E7%89%B9%E8%A8%98%E4%BA%8B%E9%A0%85" title="Dm-crypt/特記事項 – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pl mw-list-item"><a href="../../pl/Dm-crypt/Specialties.html" title="Dm-crypt (Polski)/Specialties – polski" lang="pl" hreflang="pl" class="interlanguage-link-target"><span>Polski</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <a href="../../es/Dm-crypt.html" title="Dm-crypt (Español)">Dm-crypt (Español)</a>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="es" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-box archwiki-template-box-note">Esta traducción de <a href="../../en/Dm-crypt/Specialties.html" title="Dm-crypt/Specialties">Dm-crypt/Specialties</a> fue revisada el <b>2018-11-22</b>. Si existen <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Dm-crypt/Specialties&amp;diff=0&amp;oldid=552071">cambios</a> puede <a href="../../es/ArchWiki:Translation_Team/Contributing.html" title="ArchWiki:Translation Team (Español)/Contributing (Español)">actualizarla</a> o avisar al <a href="../../es/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Español)">equipo de traducción</a>.</div>
<meta property="mw:PageProp/toc">
<h2>
<span id="Asegurar_la_partici.C3.B3n_de_arranque_no_cifrada"></span><span class="mw-headline" id="Asegurar_la_partición_de_arranque_no_cifrada">Asegurar la partición de arranque no cifrada</span>
</h2>
<p>La partición <code>/boot</code> y el <a href="../../en/Partitioning.html#Master_Boot_Record" class="mw-redirect" title="Partitioning (Español)">Master Boot Record</a> son ​​las dos áreas del disco que no están cifradas, incluso en una configuración de <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">raíz cifrada</a>. Por lo general, no se pueden cifrar porque el <a href="../../es/Arch_boot_process.html#Gestor_de_arranque" class="mw-redirect" title="Boot loader (Español)">gestor de arranque</a> y la BIOS (respectivamente) no pueden desbloquear un contenedor dm-crypt para continuar el proceso de arranque. Una excepción es <a href="../../es/GRUB.html" title="GRUB (Español)">GRUB (Español)</a>, que tiene una función para desbloquear <code>/boot</code> cifrado —véase <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html#Cifrar_partici%C3%B3n_de_arranque_(GRUB)" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">dm-crypt/Encrypting an entire system (Español)#Cifrar partición de arranque (GRUB)</a>—. 
</p>
<p>Esta sección describe los pasos que se pueden tomar para hacer que el proceso de arranque sea más seguro.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> Tenga en cuenta que proteger la partición <code>/boot</code> y el MBR puede mitigar los numerosos ataques que se pueden producir durante el proceso de arranque, pero los sistemas configurados de esta manera pueden ser vulnerables a la manipulación de la BIOS/UEFI/firmware, a través de los <a href="https://en.wikipedia.org/wiki/es:Keylogger" class="extiw" title="wikipedia:es:Keylogger">registradores de teclas</a> del hardware, los <a href="https://en.wikipedia.org/wiki/es:Ataque_de_arranque_en_fr%C3%ADo" class="extiw" title="wikipedia:es:Ataque de arranque en frío">ataques de arranque en frío</a> y muchas otras amenazas cuyo estudio queda fuera del alcance de este artículo. Para obtener una descripción general de los problemas relacionados con la fiabilidad del sistema y cómo se relacionan con el cifrado del disco completo, consulte <a rel="nofollow" class="external autonumber" href="https://www.youtube.com/watch?v=pKeiKYA03eE">[1]</a>.</div>
<h3>
<span id="Arrancar_desde_un_dispositivo_extra.C3.ADble"></span><span class="mw-headline" id="Arrancar_desde_un_dispositivo_extraíble">Arrancar desde un dispositivo extraíble</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> En la versión 230 de systemd, cryptsetup generador emite <code>RequiresMountsFor</code> para el archivo de claves de cifrado. Por lo tanto, cuando el sistema de archivos que contiene este archivo no está montado, también detiene el servicio cryptsetup. Este comportamiento es incorrecto porque el sistema de archivos y la clave de cifrado solo se requieren una vez, cuando el contenedor criptográfico está inicialmente configurado. Consulte <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/3816">systemd issue 3816</a>.</div>
<p>El uso de un dispositivo separado para iniciar un sistema es un procedimiento bastante sencillo y ofrece una mejora de seguridad significativa contra algunos tipos de ataques. En un <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">sistema de archivos raíz cifrado</a> hay dos partes que emplea el sistema que resultan vulnerables, estas son:
</p>
<ul>
<li>el <a href="../../en/Partitioning.html#Master_Boot_Record" class="mw-redirect" title="Master Boot Record">Master Boot Record</a>, y</li>
<li>la partición <code>/boot</code>.</li>
</ul>
<p>Estos deben almacenarse sin cifrar para que el sistema pueda iniciarse. Para protegerlos de manipulación indebida, es recomendable almacenarlos en un medio extraíble, como una unidad USB, y arrancar desde esa unidad en lugar del disco duro. Siempre que tenga su disco USB a buen recaudo, puede estar seguro de que esos componentes no han sido manipulados, lo que hace que la autenticación sea mucho más segura al desbloquear el sistema.
</p>
<p>Se supone que ya tiene su sistema configurado con una partición dedicada montada en <code>/boot</code>. Si no lo hace, siga los pasos indicados en <a href="../../es/Dm-crypt/System_configuration.html#Cargador_de_arranque" class="mw-redirect" title="Dm-crypt/System configuration (Español)">dm-crypt/System configuration (Español)#Cargador de arranque</a>, sustituyendo su disco duro por una unidad extraíble.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Debe asegurarse de que su sistema admita el arranque desde el medio elegido, ya sea una unidad USB, un disco duro externo, una tarjeta SD o cualquier otro medio.</div>
<p>Prepare la unidad extraíble (<code>/dev/sdx</code>).
</p>
<pre># gdisk /dev/sdx #formatear si es necesario. Alternativamente, utilice cgdisk, fdisk, cfdisk, gparted...
# mkfs.ext2 /dev/sdx1
# mount /dev/sdx1 /mnt
</pre>
<p>Copie los contenidos existentes de <code>/boot</code> en el nuevo.
</p>
<pre># cp -ai /boot/* /mnt/
</pre>
<p>Monte la nueva partición. No olvide actualizar su archivo <a href="../../es/Fstab.html" title="Fstab (Español)">fstab (Español)</a> en consecuencia.
</p>
<pre># umount /boot
# umount /mnt
# mount /dev/sdx1 /boot
# genfstab -p -U / &gt; /etc/fstab
</pre>
<p>Actualice <a href="../../es/GRUB.html" title="GRUB (Español)">GRUB (Español)</a>. El script <code>grub-mkconfig</code> debería detectar el nuevo UUID de la partición automáticamente, pero es posible que las entradas del menú personalizado deban actualizarse manualmente.
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg
# grub-install /dev/sdx #intalar en el dispositivo extraíble, no en el disco duro.
</pre>
<p>Reinicie y pruebe la nueva configuración. Recuerde configurar en la BIOS o  en <a href="../../es/Unified_Extensible_Firmware_Interface.html" title="Unified Extensible Firmware Interface (Español)">Unified Extensible Firmware Interface (Español)</a> el orden de inicio del dispositivo desde el que arrancar. Si el sistema no se inicia, aún debería poder iniciar desde el disco duro para corregir el problema.
</p>
<h3><span class="mw-headline" id="chkboot">chkboot</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> chkboot realiza <b>una prueba de comprobación posencendido</b> de una partición <code>/boot</code>, no <b>una prueba de comprobación preencendido</b>. Cuando se ejecuta el script chkboot, ya se ha ingresado la contraseña, por lo que su cargador de arranque, el kernel o initrd pueden quedar potencialmente comprometidos. Si el sistema da fallo tras la prueba de integridad de chkboot, no se podrá garantizar la seguridad de sus datos.</div>
<p>Remitiéndonos al artículo de ct-magazine (Número 3/12, página 146, 01.16.2012, <a rel="nofollow" class="external autonumber" href="https://www.heise.de/ct/inhalt/2012/03/6/">[2]</a>), el siguiente script comprueba los archivos presentes en <code>/boot</code> para cambios de <a href="https://en.wikipedia.org/wiki/es:Funci%C3%B3n_hash" class="extiw" title="wikipedia:es:Función hash">hash</a> <a href="https://en.wikipedia.org/wiki/es:Secure_Hash_Algorithm#SHA-1" class="extiw" title="wikipedia:es:Secure Hash Algorithm">SHA-1</a>, <a href="https://en.wikipedia.org/wiki/es:Inodo" class="extiw" title="wikipedia:es:Inodo">inodo</a> y bloques ocupados en el disco duro. También verifica el <a href="../../en/Partitioning.html#Master_Boot_Record" class="mw-redirect" title="Partitioning (Español)">Master Boot Record</a>. El script no puede evitar cierto tipo de ataques, pero otros muchos los hace más difíciles. Ninguna configuración del script en sí misma se almacena en <code>/boot</code> que no está cifrado. Con un sistema cifrado bloqueado/apagado, esto hace que sea más difícil para algunos atacantes porque no es evidente que se realice una comparación de suma de comprobación automática de la partición en el arranque. Sin embargo, un atacante que anticipe estas precauciones puede manipular el firmware para ejecutar su propio código en la parte superior del kernel e interceptar el acceso al sistema de archivos, por ejemplo, a <code>boot</code>, y este le presente los archivos no protegidos. En general, ninguna medida de seguridad por debajo del nivel del firmware puede garantizar la fiabilidad y la evidencia de falsificación.
</p>
<p>El script con instrucciones de instalación está <a rel="nofollow" class="external text" href="ftp://ftp.heise.de/pub/ct/listings/1203-146.zip">disponible</a> (Author: Juergen Schmidt, ju at heisec.de; License: GPLv2), También hay un paquete <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/chkboot/">chkboot</a></span><sup><small>AUR</small></sup> para <a href="../../es/Help:Reading.html#Instalaci%C3%B3n_de_paquetes" title="Help:Reading (Español)">instalar</a>.
</p>
<p>Después de la instalación, agregue un archivo de servicio (el paquete incluye uno basado en lo siguiente) y <a href="../../es/Systemd.html#Utilizar_las_unidades" title="Systemd (Español)">actívelo</a>:
</p>
<pre>[Unit]
Description=Check that boot is what we want
Requires=basic.target
After=basic.target

[Service]
Type=oneshot
ExecStart=/usr/local/bin/chkboot.sh

[Install]
WantedBy=multi-user.target
</pre>
<p>Hay una pequeña advertencia para systemd. Al momento de escribir (este artículo), el script original <code>chkboot.sh</code> suministrado contiene un espacio vacío al comienzo de <code><u> </u>#!/bin/bash</code> que debe ser eliminado para que el servicio se inicie con éxito.
</p>
<p>Como <code>/usr/local/bin/chkboot_user.sh</code> debe ejecutarse justo después del inicio de sesión, debe agregarlo al <a href="../../es/Autostarting.html" title="Autostarting (Español)">inicio automático</a> (por ejemplo, en KDE -&gt; <i>Configuración del sistema -&gt; Inicio y apagado -&gt; Autostart </i>; en GNOME 3: <i>gnome-session-properties</i>).
</p>
<p>Con Arch Linux, los cambios en <code>/boot</code> son bastante frecuentes, por ejemplo, con la incorporación de nuevos kernels. Por lo tanto, puede ser útil usar los scripts con cada actualización completa del sistema. Una forma de hacerlo sería:
</p>
<pre>#!/bin/bash
#
# Nota: inserte su &lt;usuario&gt; y ejecútelo con sudo para que pacman y chkboot funcionen automáticamente
#
echo "Pacman update [1] Quickcheck before updating" &amp; 
sudo -u &lt;user&gt; /usr/local/bin/chkboot_user.sh		# insert your logged on &lt;user&gt; 
/usr/local/bin/chkboot.sh
sudo -u &lt;user&gt; /usr/local/bin/chkboot_user.sh		# insert your logged on &lt;user&gt; 
echo "Pacman update [2] Syncing repos for pacman" 
pacman -Syu
/usr/local/bin/chkboot.sh
sudo -u &lt;user&gt; /usr/local/bin/chkboot_user.sh		# insert your logged on &lt;user&gt;
echo "Pacman update [3] All done, let us roll on ..."
</pre>
<h3><span class="mw-headline" id="mkinitcpio-chkcryptoboot">mkinitcpio-chkcryptoboot</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> Este hook no cifra el código <a href="../../en/GRUB.html" title="GRUB">GRUB</a>, el código (MBR) o el apéndice EFI, ni protege contra situaciones en las que un atacante puede modificar el comportamiento del cargador de arranque para comprometer el kernel y/o initramfs en tiempo de ejecución.</div>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-chkcryptoboot/">mkinitcpio-chkcryptoboot</a></span><sup><small>AUR</small></sup> es un hook de <a href="../../en/Mkinitcpio.html" class="mw-redirect" title="Mkinitcpio (Español)">mkinitcpio (Español)</a> que realiza verificaciones de integridad durante el primer espacio de usuario y aconseja al usuario que no ingrese su contraseña para desbloquear la partición raíz si el sistema parece estar comprometido. La seguridad se logra a través de una <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html#Cifrar_partici%C3%B3n_de_arranque_(GRUB)" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">partición de arranque cifrada</a>, que se desbloquea utilizando el módulo <code>cryptodisk.mod</code> para <a href="../../es/GRUB.html#/boot_cifrado" title="GRUB (Español)">GRUB</a>, y una partición del sistema de archivos raíz, que se cifra con una contraseña diferente de la anterior. De esta manera, <a href="../../es/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs (Español)">Initramfs (Español)</a> y el <a href="../../en/Kernel.html" class="mw-redirect" title="Kernel (Español)">kernel (Español)</a> están protegidos contra la manipulación fuera de línea, y la  partición raíz puede permanecer segura incluso si la contraseña de la partición <code>/boot</code> se ingresa en un equipo comprometido (siempre que el hook chkcryptoboot detecte que el equipo se ha visto comprometido, y el mismo no se ha visto comprometido en tiempo de ejecución).
</p>
<p>Este hook requiere la versión &gt;=2.00 del paquete <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub">grub</a></span> para que funcione, y una partición dedicada, <code>/boot</code> cifrada con LUKS con su propia contraseña para que sea seguro.
</p>
<h4>
<span id="Instalaci.C3.B3n"></span><span class="mw-headline" id="Instalación">Instalación</span>
</h4>
<p><a href="../../es/Help:Reading.html#Instalaci%C3%B3n_de_paquetes" title="Help:Reading (Español)">Instale</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-chkcryptoboot/">mkinitcpio-chkcryptoboot</a></span><sup><small>AUR</small></sup> y edite <code>/etc/default/chkcryptoboot.conf</code>. Si desea disponer de la capacidad de detectar si su partición de arranque se baipaseó (o puenteó), modifique las variables <code>CMDLINE_NAME</code> y <code>CMDLINE_VALUE</code> con valores que solo usted conozca. Puede seguir el consejo de usar dos funciones de hash como se sugiere, inmediatamente después de la instalación. Además, asegúrese de hacer los cambios apropiados en la <a href="../../es/Kernel_parameters.html" title="Kernel parameters (Español)">línea de órdenes del kernel</a> en <code>/etc/default/grub</code>. Edite la línea <code>HOOKS=</code> en <code>/etc/mkinitcpio.conf</code>, e inserte el hook <code>chkcryptoboot</code> <b>antes</b> de <code>encrypt</code>. Cuando haya terminado, <a href="../../en/Mkinitcpio.html#Creaci%C3%B3n_de_la_imagen_y_activaci%C3%B3n" class="mw-redirect" title="Mkinitcpio (Español)">regenere initramfs</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">enlace roto</a>: sección no válida]</sup>.
</p>
<h4>
<span id="Descripci.C3.B3n_t.C3.A9cnica"></span><span class="mw-headline" id="Descripción_técnica">Descripción técnica</span>
</h4>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-chkcryptoboot/">mkinitcpio-chkcryptoboot</a></span><sup><small>AUR</small></sup> consiste en un hook de instalación y un hook en tiempo de ejecución para mkinitcpio. El hook de instalación se ejecuta cada vez que se reconstruye initramfs, y comprueba el hash del apéndice de <a href="../../es/EFI_system_partition.html" title="EFI system partition (Español)">EFI system partition (Español)</a> de GRUB (<code>$esp/EFI/grub_uefi/grubx64.efi</code>) (en el caso de los sistemas <a href="../../es/Unified_Extensible_Firmware_Interface.html" title="Unified Extensible Firmware Interface (Español)">Unified Extensible Firmware Interface (Español)</a> ) o los primeros 446 bytes del disco en el que está instalado GRUB (en el caso de los sistemas BIOS), y almacena ese hash dentro de los initramfs ubicados dentro de la partición cifrada <code>/boot</code>. Cuando se inicia el sistema, GRUB solicita la contraseña para desbloquear <code>/boot</code>, luego el hook en tiempo de ejecución realiza la misma operación de comparación de hash antes de solicitar la contraseña de la partición raíz. Si no coinciden, el hook imprimirá un error como este:
</p>
<pre>CHKCRYPTOBOOT ALERT!
CHANGES HAVE BEEN DETECTED IN YOUR BOOT LOADER EFISTUB!
YOU ARE STRONGLY ADVISED NOT TO ENTER YOUR ROOT CONTAINER PASSWORD!
Please type uppercase yes to continue:
</pre>
<p>Además del hash del cargador de arranque, el hook también verifica los parámetros del kernel en ejecución con los configurados en <code>/etc/default/chkcryptoboot.conf</code>. Esto se comprueba tanto en tiempo de ejecución como después de que se realiza el proceso de arranque. Esto permite que el hook detecte si la configuración de GRUB no se baipaseó tanto en el tiempo de ejecución como después, para detectar si la partición <code>/boot</code> completa ha sido manipulada.
</p>
<p>Para los sistemas BIOS, el hook crea un hash del gestor de arranque de la primera etapa de GRUB (instalado en los primeros 446 bytes del dispositivo de arranque) para compararlo en los procesos de arranque posteriores. La segunda etapa principal del gestor de arranque GRUB,  <code>core.img</code>, no será comprobado.
</p>
<h3><span class="mw-headline" id="AIDE">AIDE</span></h3>
<p>Como alternativa a los scripts anteriores, se puede configurar una comprobación de hash con <a href="../../en/AIDE.html" title="AIDE">AIDE</a> que se puede personalizar a través de un archivo de configuración muy flexible.
</p>
<h3><span class="mw-headline" id="STARK">STARK</span></h3>
<p>Si bien alguno de los métodos descritos arriba deberían dar respuesta a la demanda de la mayoría de los usuarios, los mismos no resuelven todos los problemas de seguridad que se pueden presentar asociados con <code>/boot</code> sin cifrar. Un enfoque que intenta proporcionar una cadena de arranque completamente autenticada fue publicado con POTTS como una tesis académica para implementar el marco de autenticación <a rel="nofollow" class="external text" href="https://www1.informatik.uni-erlangen.de/stark">STARK</a>
</p>
<p>La prueba de concepto de POTTS utiliza Arch Linux como una distribución base e implementa una cadena de arranque del sistema con:
</p>
<ul>
<li>POTTS: un menú de inicio para un mensaje de autenticación de una sola vez.</li>
<li>TrustedGrub - una implementación de <a href="../../en/GRUB_Legacy.html" title="GRUB Legacy">GRUB Legacy</a> que autentica el kernel e initramfs contra los registros de <a href="https://en.wikipedia.org/wiki/es:M%C3%B3dulo_de_plataforma_confiable" class="extiw" title="wikipedia:es:Módulo de plataforma confiable">chips TPM</a>.</li>
<li>TRESOR: un parche del kernel que implementa AES pero mantiene la clave maestra no en la RAM sino en los registros de la CPU durante el tiempo de ejecución.</li>
</ul>
<p>Como parte de la tesis <a rel="nofollow" class="external text" href="http://13.tc/p/potts/manual.html">installation</a>, se han publicado instrucciones basadas en Arch Linux (ISO a partir de 2013-01). Si desea probarlo, tenga en cuenta que estas herramientas no se encuentran en los repositorios estándar y que la solución llevará mucho tiempo de mantenimiento.
</p>
<h2>
<span id="Utilizar_archivos_de_claves_cifrados_con_GPG.2C_LUKS_o_OpenSSL"></span><span class="mw-headline" id="Utilizar_archivos_de_claves_cifrados_con_GPG,_LUKS_o_OpenSSL">Utilizar archivos de claves cifrados con GPG, LUKS o OpenSSL</span>
</h2>
<p>Las siguientes publicaciones del foro brindan instrucciones para usar dos factores de autenticación, archivos de claves cifrados con gpg o openssl, en lugar de un archivo de clave de texto plano descrito anteriormente en este artículo wiki <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=120243">System Encryption using LUKS with GPG encrypted keys</a>:
</p>
<ul>
<li>GnuPG: <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=943338#p943338">Post regarding GPG encrypted keys</a> Esta publicación tiene las instrucciones genéricas.</li>
<li>OpenSSL: <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=947805#p947805">Post regarding OpenSSL encrypted keys</a> Esta publicación solo tiene los hooks <code>ssldec</code>.</li>
<li>OpenSSL: <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=155393">Post regarding OpenSSL salted bf-cbc encrypted keys</a> Esta publicación tiene los hooks <code>bfkf</code> de initcpio, install y el script generador del archivo de claves cifrado.</li>
<li>LUKS: <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1502651#p1502651">Post regarding LUKS encrypted keys</a> con un hook <code>lukskey</code> de initcpio. O <a href="#/boot_cifrado_y_un_encabezado_LUKS_separado_en_USB">#/boot cifrado y un encabezado LUKS separado en USB</a> a continuación con un hook encrypt personalizado para initcpio.</li>
</ul>
<p>Tenga en cuenta que:
</p>
<ul>
<li>Puede seguir las instrucciones anteriores con solo dos particiones primarias, una partición de arranque (requerida debido al cifrado) y una partición LVM primaria. Dentro de la partición LVM puede tener tantas particiones como necesite, pero lo más importante es que contenga volumenes lógicos para, al menos, las particiones raíz, de intercambio y «<i>home</i>». Esto tiene la ventaja adicional de tener solo un archivo de claves para todas sus particiones y tener la capacidad de hibernar su equipo (suspender en disco) donde la partición de intercambio está encriptada. Si decide hacerlo, los hooks en <code>/etc/mkinitcpio.conf</code> deberían tener este aspecto: <pre>HOOKS=( ... usb usbinput (etwo o ssldec) encrypt (si se utiliza openssl) lvm2 resume ... )</pre> y debe agregar <pre>resume=/dev/&lt;NombredelGrupodeVolúmenes&gt;/&lt;NombredelVolumenLógicodeIntecambio&gt;</pre> a sus <a href="../../es/Kernel_parameters.html" title="Kernel parameters (Español)">parámetros del kernel</a>.</li>
<li>Si necesita almacenar temporalmente el archivo de claves desencriptado en algún lugar, no lo almacene en un disco sin cifrado. Es mejor asegúrese de guardarlos en la memoria RAM como <code>/dev/shm</code>.</li>
<li>Si desea usar un archivo de claves encriptado con GPG, necesita usar una versión 1.4 de GnuPG compilada estáticamente o puede editar los hooks y usar este paquete AUR <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/gnupg1/">gnupg1</a></span><sup><small>AUR</small></sup>
</li>
<li>Es posible que una actualización de OpenSSL pueda romper el hook <code>ssldec</code> personalizado, mencionada en la segunda publicación del foro.</li>
</ul>
<h2>
<span id="Desbloqueo_remoto_de_la_partici.C3.B3n_.28u_otro_volumen.29_ra.C3.ADz"></span><span class="mw-headline" id="Desbloqueo_remoto_de_la_partición_(u_otro_volumen)_raíz">Desbloqueo remoto de la partición (u otro volumen) raíz</span>
</h2>
<p>Si desea poder reiniciar un sistema totalmente cifrado con LUKS de forma remota, o iniciarlo con un servicio <a href="../../en/Wake-on-LAN.html" title="Wake-on-LAN">Wake-on-LAN</a> <a href="https://en.wikipedia.org/wiki/es:Wake_on_LAN" class="extiw" title="wikipedia:es:Wake on LAN">(véase también)</a>, necesitará una forma de ingresar una frase de contraseña para la partición/volumen raíz en el inicio. Esto se puede lograr ejecutando un hook de <a href="../../en/Mkinitcpio.html" class="mw-redirect" title="Mkinitcpio (Español)">mkinitcpio (Español)</a> que configure una interfaz de red. Algunos de los paquetes que se enumeran a continuación contribuyen con varios <a href="../../en/Mkinitcpio.html#Build_hooks" class="mw-redirect" title="Mkinitcpio (Español)">hooks compilados de mkinitcpio</a> para facilitar la configuración.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> 
<ul>
<li>Tenga en cuenta que debe usar los nombres de dispositivos del kernel para la interfaz de red (por ejemplo, <code>eth0</code>) y no uno de <a href="../../en/Udev.html" class="mw-redirect" title="Udev (Español)">udev (Español)</a> (por ejemplo, <code>enp1s0</code>), ya que no funcionarán.</li>
<li>Podría ser necesario agregar <a href="../../es/Network_configuration.html#Controlador_del_dispositivo" title="Network configuration (Español)">el módulo de su tarjeta de red</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">enlace roto</a>: sección no válida]</sup> a la matriz <a href="../../en/Mkinitcpio.html#M%C3%93DULOS" class="mw-redirect" title="Mkinitcpio (Español)">MODULES</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">enlace roto</a>: sección no válida]</sup>.</li>
</ul>
</div>
<h3>
<span id="Desbloqueo_remoto_.28hooks:_systemd.2C_systemd-tool.29"></span><span class="mw-headline" id="Desbloqueo_remoto_(hooks:_systemd,_systemd-tool)">Desbloqueo remoto (hooks: systemd, systemd-tool)</span>
</h3>
<p>El paquete de AUR <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-systemd-tool">mkinitcpio-systemd-tool</a></span> proporciona un hook <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd">systemd</a></span> pensado para mkinitcpio denominado <i>systemd-tool</i> con el siguiente conjunto de características para systemd en initramfs:
</p>
<table class="wikitable">

<tbody><tr style="vertical-align:top;">
<td width="50%" style="padding:10px;">
<p>Características principales proporcionadas por el hook:
</p>
<ul>
<li>configuración unificada systemd + mkinitcpio</li>
<li>aprovisionamiento automático de recursos binarios y de configuración</li>
<li>invocación bajo demanda de scripts mkinitcpio y funciones en línea</li>
</ul>
</td>
<td width="50%" style="padding:10px;">
<p>Características proporcionadas por las unidades de servicio incluidas:
</p>
<ul>
<li>depuración de errores de initrd</li>
<li>configuración de red temprana</li>
<li>intérprete de órdenes de usuario interactiva</li>
<li>acceso ssh remoto en initrd</li>
<li>cryptsetup + agente de contraseña personalizada</li>
</ul>
</td>
</tr></tbody>
</table>
<p>El paquete <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-systemd-tool">mkinitcpio-systemd-tool</a></span> requiere el <a href="../../en/Mkinitcpio.html#Common_hooks" title="Mkinitcpio">hook systemd</a>. Para obtener más información, lea <a rel="nofollow" class="external text" href="https://github.com/random-archer/mkinitcpio-systemd-tool/blob/master/README.md">README</a> del proyecto, así como el valor predeterminado proporcionado  por defecto por <a rel="nofollow" class="external text" href="https://github.com/random-archer/mkinitcpio-systemd-tool">systemd service unit files</a> para comenzar.
</p>
<p>Los hooks recomendados son: <code> base autodetect modconf block filesystems keyboard fsck systemd systemd-tool</code>.
</p>
<h3>
<span id="Desbloqueo_remoto_.28hooks:_netconf.2C_dropbear.2C_tinyssh.2C_ppp.29"></span><span class="mw-headline" id="Desbloqueo_remoto_(hooks:_netconf,_dropbear,_tinyssh,_ppp)">Desbloqueo remoto (hooks: netconf, dropbear, tinyssh, ppp)</span>
</h3>
<p>Otra combinación de paquetes que proporciona inicios de sesión remotos para initcpio es <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-netconf">mkinitcpio-netconf</a></span> y/o <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-ppp/">mkinitcpio-ppp</a></span><sup><small>AUR</small></sup> (para el desbloqueo remoto usando un <a href="https://en.wikipedia.org/wiki/es:Point-to-Point_Protocol" class="extiw" title="wikipedia:es:Point-to-Point Protocol">Protocolo punto a punto (PPP)</a> —en inglés Point-to-Point Protocol— de conexión a través de Internet) junto con un servidor <a href="../../es/OpenSSH.html" title="OpenSSH (Español)">OpenSSH (Español)</a>. Tiene la opción de usar <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-dropbear">mkinitcpio-dropbear</a></span> o <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-tinyssh">mkinitcpio-tinyssh</a></span>. Esos hooks no instalan ningún intérprete de órdenes, por lo que también debe <a href="../../es/Help:Reading.html#Instalaci%C3%B3n_de_paquetes" title="Help:Reading (Español)">instalar</a> el paquete <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-utils">mkinitcpio-utils</a></span>. Las instrucciones a continuación se pueden utilizar con cualquier combinación de los paquetes anteriores. Cuando haya diferentes caminos, se advertirá.
</p>
<ol>
<li>Si aún no tiene un par de claves SSH, <a href="../../en/SSH_keys.html#Generando_las_llaves_SSH" class="mw-redirect" title="SSH keys (Español)">genere uno</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">enlace roto</a>: sección no válida]</sup> en el sistema cliente (el que se usará para desbloquear la máquina remota). <div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> <code>tinyssh</code> solo admite los tipos de claves <a href="../../en/SSH_keys.html#Ed25519" title="SSH keys">Ed25519</a> y <a href="../../en/SSH_keys.html#ECDSA" title="SSH keys">ECDSA</a>. Si elige usar <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-tinyssh">mkinitcpio-tinyssh</a></span>, necesitará crear/usar una de estas.</div>
</li>
<li>Inserte su clave pública SSH (es decir, la que normalmente coloca en los hosts para poder ingresar sin contraseña, o la que acaba de crear y que termina en <i>.pub </i>) en el archivo <code>/etc/dropbear/root_key</code> o <code>/etc/tinyssh/root_key</code> del equipo remoto. <div class="archwiki-template-box archwiki-template-box-tip">
<strong>Sugerencia:</strong> Este método se puede usar más adelante para agregar otras claves públicas SSH según sea necesario; en el caso de que simplemente esté copiando el contenido el archivo <code>~/.ssh/authorized_keys</code> remoto, asegúrese de verificar que solo contenga las claves que desea utilizar para desbloquear la máquina remota. Si agrega claves adicionales, regenere initrd también usando <code>mkinitcpio</code>. Vea también <a href="../../es/OpenSSH.html#Protecci%C3%B3n" class="mw-redirect" title="Secure Shell (Español)">Secure Shell (Español)#Protección</a>.</div>
</li>
<li>Agregue los tres <a href="../../en/Mkinitcpio.html#HOOKS" class="mw-redirect" title="Mkinitcpio (Español)">hooks</a>,<code>&lt;netconf y/o ppp&gt; &lt;dropbear o tinyssh&gt; encryptssh</code> antes de <code>filesystems</code> dentro de la matriz «HOOKS» en <code>/etc/mkinitcpio.conf</code> (el hook <code>encryptssh</code> reemplaza al hook <code>encrypt</code>). Después <a href="../../en/Mkinitcpio.html#Creaci%C3%B3n_de_la_imagen_y_activaci%C3%B3n" class="mw-redirect" title="Mkinitcpio (Español)">regenere initramfs</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">enlace roto</a>: sección no válida]</sup>. <div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> El hook <code> net</code> proporcionado por <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-nfs-utils">mkinitcpio-nfs-utils</a></span> <b>no</b> es necesario.</div>
</li>
<li>Configure el <a href="../../es/Dm-crypt/System_configuration.html#Cargador_de_arranque" class="mw-redirect" title="Dm-crypt/System configuration (Español)">parámetro</a> <code>cryptdevice=</code> requerido y agregue el <a href="../../es/Kernel_parameters.html" title="Kernel parameters (Español)">parámetro del kernel</a> <code>ip=</code> a la configuración de su gestor de arranque con los argumentos apropiados. Por ejemplo, si el servidor DHCP no atribuye una IP estática a su sistema remoto, lo que dificultaría el acceso con SSH a través de reinicios, puede indicar explícitamente la IP que desea usar:<pre>ip=192.168.1.1:::::eth0:none</pre>Alternativamente, también puede especificar la máscara de subred y la puerta de enlace requeridas por la red:<pre>ip=192.168.1.1::192.168.1.254:255.255.255.0::eth0:none</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> A partir de la versión 0.0.4 de <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-netconf">mkinitcpio-netconf</a></span>, puede anidar múltiples parámetros <code>ip=</code> con el fin de configurar múltiples interfaces. No puede mezclarlo con <code>ip=dhcp</code> (<code>ip=:::::eth0:dhcp</code>) solo. Se debe especificar una interfaz.</div>
<pre>ip=ip=192.168.1.1:::::eth0:none:ip=172.16.1.1:::::eth1:none</pre>Para una descripción detallada eche un vistazo a <a href="../../en/Mkinitcpio.html#Usar_la_red" class="mw-redirect" title="Mkinitcpio (Español)">la sección de mkinitcpio</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">enlace roto</a>: sección no válida]</sup>. Cuando termine, actualice la configuración de su <a href="../../es/Arch_boot_process.html#Gestor_de_arranque" title="Arch boot process (Español)">gestor de arranque</a>.</li>
<li>Finalmente, reinicie el sistema remoto e intente ejecutar <a href="../../es/OpenSSH.html#Cliente" class="mw-redirect" title="Secure Shell (Español)">ssh para él</a>, <b>indicando explícitamente el nombre de usuario «root»</b> (incluso si la cuenta de root está desactivada en la máquina, ya que este usuario root se utiliza solo en initrd con el propósito de desbloquear el sistema remoto). Si está utilizando el paquete <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-dropbear">mkinitcpio-dropbear</a></span> y también tiene el paquete <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span> instalado, lo más probable es que no reciba ninguna advertencia antes de iniciar sesión, ya que convierte y usa el mismo juego de claves openssh del host  (excepto las claves Ed25519, ya que dropbear no las admite). En caso de que esté utilizando <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-tinyssh">mkinitcpio-tinyssh</a></span>, tiene la opción de instalar <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tinyssh-convert">tinyssh-convert</a></span><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">enlace roto</a>: replaced by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tinyssh">tinyssh</a></span>]</sup> o <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/tinyssh-convert-git/">tinyssh-convert-git</a></span><sup><small>AUR</small></sup> para que pueda usar las mismas claves que su instalación <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span> (actualmente solo son claves Ed25519). En cualquier caso, debería haber ejecutado <a href="../../es/OpenSSH.html#Gesti%C3%B3n_del_Demonio" class="mw-redirect" title="Secure Shell (Español)">el demonio ssh</a> al menos una vez, utilizando las unidades systemd suministradas, para que las claves se puedan generar primero. Después de reiniciar la máquina, se le solicitará que introduzca la contraseña para desbloquear el dispositivo raíz. El sistema completará su proceso de arranque y luego puede iniciar sesión en él <a href="../../es/OpenSSH.html#Cliente" class="mw-redirect" title="Secure Shell (Español)">como lo haría normalmente</a> (con el usuario remoto que elija).</li>
</ol>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Sugerencia:</strong> Si simplemente desea una buena solución para montar otras particiones cifradas (como <code>/home</code>) de forma remota, puede consultar <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=880484">este hilo del foro</a>.</div>
<h3>
<span id="Desbloqueo_remoto_a_trav.C3.A9s_de_wifi_.28hooks:_construya_el_suyo_propio.29"></span><span class="mw-headline" id="Desbloqueo_remoto_a_través_de_wifi_(hooks:_construya_el_suyo_propio)">Desbloqueo remoto a través de wifi (hooks: construya el suyo propio)</span>
</h3>
<p>El hook net se usa normalmente con una conexión <a href="https://en.wikipedia.org/wiki/es:Ethernet" class="extiw" title="wikipedia:es:Ethernet">cableada</a>. En caso de que desee configurar un equipo que solo dispone de conexión inalámbrica y desbloquearla a través de wifi, puede crear un hook personalizado para conectarse a una red wifi antes de ejecutar el hook de red, net.
</p>
<p>El siguiente ejemplo muestra una configuración utilizando un adaptador wifi USB, que se conecta a una red wifi protegida con WPA2-PSK. En caso de que utilice, por ejemplo, WEP u otro, es posible que necesite cambiar algunas cosas.
</p>
<ol>
<li>Modifique <code>/etc/mkinitcpio.conf</code>:
<ul>
<li>Agregue el módulo del kernel necesario para su adaptador wifi específico.</li>
<li>Incluya los archivos binarios <code>wpa_passphrase</code> y <code>wpa_supplicant</code>.</li>
<li>Agregue un hook <code>wifi</code> (o el nombre que elija, este es el hook personalizado que se creará) antes del hook <code>net</code>. <pre>MODULES=(<i>módulo</i>)<br>BINARIES=(wpa_passphrase wpa_supplicant)<br>HOOKS=(base udev autodetect ... <b>wifi</b> net ... dropbear encryptssh ...)</pre>
</li>
</ul>
</li>
<li>Cree el hook <code>wifi</code> en <code>/etc/initcpio/hooks/wifi</code>:<pre>run_hook ()<br>{<br>	# demorar unos segundos, dejando que wlan0 sea configurado por kernel<br>	sleep 5<br><br>	# configurar wlan0 a up<br>	ip link configurar wlan0 up<br><br>	# asociar con la red wifi<br>	# 1. guardar el archivo config temporal<br>	wpa_passphrase «<i> network ESSID </i>» «<i> passrase </i>»&gt; /tmp/wifi <br><br>	# 2. crear asociación<br>	wpa_supplicant -B -D nl80211, wext -i wlan0 -c /tmp/wifi<br><br>	# demorar unos segundos para que wpa_supplicant termine de conectarse<br>	sleep 5<br><br>	# wlan0 ahora debería estar conectado y listo para que el hook net pueda asignar una ip<br>}<br><br>	run_cleanuphook ()<br>{<br>	# wpa_supplicant que se ejecuta en segundo plano<br>	killall wpa_supplicant<br><br>	# configurar wlan0 link a down <br>	ip link set wlan0 down<br><br>	# wlan0 ahora debería estar completamente desconectado de la red wifi<br>}</pre>
</li>
<li>Cree el archivo de instalación de hook en<code>/etc/initcpio/install/wifi</code>:<pre>build ()<br>{<br>	add_runscript<br>}<br>help ()<br>{<br>cat&lt;&lt;HELPEOF<br>	Activar wifi en el arranque, para desbloquear dropbear ssh del disco..<br>HELPEOF<br>}</pre>
</li>
<li>Agregue <code>ip=:::::wlan0:dhcp</code> a los <a href="../../es/Kernel_parameters.html" title="Kernel parameters (Español)">parámetros del kernel</a>. Elimine <code>ip=:::::eth0:dhcp</code> para que no entre en conflicto.</li>
<li>Opcionalmente, cree una entrada de arranque adicional con el parámetro del kernel <code>ip=:::::eth0:dhcp</code>.</li>
<li>
<a href="../../en/Mkinitcpio.html#Creaci%C3%B3n_de_la_imagen_y_activaci%C3%B3n" class="mw-redirect" title="Mkinitcpio (Español)">Regenere initramfs</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">enlace roto</a>: sección no válida]</sup>.</li>
<li>Actualice la configuración de su <a href="../../es/Arch_boot_process.html#Gestor_de_arranque" title="Arch boot process (Español)">cargador de arranque</a>.</li>
</ol>
<p>Recuerde configurar <a href="../../en/Network_configuration/Wireless.html" class="mw-redirect" title="Wireless network configuration (Español)">wifi</a>, de modo que pueda iniciar sesión una vez que el sistema haya arrancado completamente. En caso de que no pueda conectarse a la red wifi, intente aumentar los tiempos de demora un poco.
</p>
<h2>
<span id="Soporte_Discard.2FTRIM_para_unidades_de_estado_s.C3.B3lido_.28SSD.29"></span><span class="mw-headline" id="Soporte_Discard/TRIM_para_unidades_de_estado_sólido_(SSD)">Soporte Discard/TRIM para unidades de estado sólido (SSD)</span>
</h2>
<p>Los usuarios de <a href="../../en/Solid_state_drive.html" title="Solid state drive">unidades de estado sólido</a> deben tener en cuenta que, de forma predeterminada, las órdenes <a href="https://en.wikipedia.org/wiki/es:TRIM" class="extiw" title="wikipedia:es:TRIM">TRIM</a> no están activadas por el mapeador de dispositivos, es decir, los dispositivos de bloque se montan sin la opción <code>discard</code> a menos que anule el valor predeterminado.
</p>
<p>Los mantenedores de device-mapper han dejado claro que la compatibilidad con TRIM nunca se activará de forma predeterminada en los dispositivos dm-crypt debido a las posibles implicaciones de seguridad. <a rel="nofollow" class="external autonumber" href="http://www.saout.de/pipermail/dm-crypt/2011-September/002019.html">[3]</a><a rel="nofollow" class="external autonumber" href="http://www.saout.de/pipermail/dm-crypt/2012-April/002420.html">[4]</a> Es posible la fuga mínima de datos en forma de información liberada del bloque, tal vez suficiente para determinar el sistema de archivos en uso, en dispositivos con TRIM activado. Una ilustración y discusión de los problemas que surgen de la activación de TRIM está disponible en el <a rel="nofollow" class="external text" href="https://asalor.blogspot.de/2011/08/trim-dm-crypt-problems.html">blog</a> de un desarrollador de «cryptsetup». Si le preocupan estos factores, también tenga en cuenta que las amenazas pueden aumentar: por ejemplo, si su dispositivo todavía está cifrado con el algoritmo de cifrado predeterminado anterior (cryptsetup &lt;1.6.0) <code>--cipher aes-cbc-essiv</code>, es posible que se produzcan más fugas de información a partir de la observación del sector «<i>trimmed</i>», que con las actuales opciones de cifrado <a href="../../es/Dm-crypt/Device_encryption.html#Opciones_de_cifrado_para_la_modalidad_LUKS" class="mw-redirect" title="Dm-crypt/Device encryption (Español)">predeterminadas</a>.
</p>
<p>Se distinguen los siguientes casos:
</p>
<ul><li>El dispositivo está cifrado con la modalidad LUKS de dm-crypt predeterminado:
<ul>
<li>De forma predeterminada, el encabezado LUKS se almacena al comienzo del dispositivo y usar TRIM es útil para proteger las modificaciones del encabezado. Si, por ejemplo, se revoca una contraseña LUKS comprometida, sin TRIM activado, el encabezado anterior en general todavía estará disponible para leer hasta que otra operación lo sobrescriba; mientras tanto, si se roba la unidad, los atacantes podrían, en teoría, encontrar una manera de localizar el encabezado anterior y usarlo para descifrar el contenido con la contraseña comprometida. Consulte <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions#5-security-aspects">cryptsetup, sección 5.19 ¿Qué hay de las unidades de estado sólido, flash y unidades híbridas?</a> y <a rel="nofollow" class="external text" href="https://www.reddit.com/r/archlinux/comments/2f370s/full_disk_encryption_on_an_ssd/ck5p5c5">Cifrado de disco completo en un ssd</a>.</li>
<li>TRIM puede dejarse desactivado si los problemas de seguridad indicados en la parte superior de esta sección se consideran una amenaza peor que los indicados en la viñeta anterior.</li>
</ul>
</li></ul>
<dl><dd>Véase también <a href="../../en/Securely_wipe_disk.html#Flash_memory" title="Securely wipe disk">Securely wipe disk#Flash memory</a>.</dd></dl>
<ul><li>El dispositivo está cifrado con la modalidad plain de dm-crypt, o el encabezado LUKS se almacena <a href="#/boot_cifrado_y_un_encabezado_LUKS_separado_en_USB">por separado</a>:
<ul>
<li>Si se requiere una <a href="https://en.wikipedia.org/wiki/es:Cifrado_negable" class="extiw" title="wikipedia:es:Cifrado negable">negación plausible</a>, TRIM <b>nunca</b> debe ser usado debido a las consideraciones dadas en la parte superior de esta sección, o el uso del cifrado se dará a conocer.</li>
<li>Si no se requiere una negación plausible, se puede usar TRIM por sus mejoras de rendimiento, siempre que los peligros de seguridad descritos en la parte superior de esta sección no sean motivo de preocupación.</li>
</ul>
</li></ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> Antes de activar TRIM en una unidad, asegúrese de que el dispositivo sea totalmente compatible con las órdenes TRIM, o de lo contrario puede provocar pérdida de datos. Consulte <a href="../../en/Solid_state_drive.html#TRIM" class="mw-redirect" title="Solid State Drives">Solid State Drives#TRIM</a>.</div>
<p>En versiones 3.1 de <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> y posteriores, el soporte para TRIM de dm-crypt se puede alternar al crear el dispositivo o montarlo con dmsetup. El soporte para esta opción también existe en la versión 1.4.0 de <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span> y superior. Para agregar soporte durante el arranque, deberá añadir <code>:allow-discards</code> a la opción <code>cryptdevice</code>. La opción TRIM puede verse así:
</p>
<pre>cryptdevice=/dev/sdaX:root:allow-discards
</pre>
<p>Para las opciones de configuración principales de <code>cryptdevice</code> antes de <code>:allow-discards</code> vea <a href="../../es/Dm-crypt/System_configuration.html" class="mw-redirect" title="Dm-crypt/System configuration (Español)">Dm-crypt/System configuration (Español)</a>.
</p>
<p>Si está utilizando initrd basado en systemd, debe pasar la opción:
</p>
<pre>rd.luks.options=discard
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> La opción <code>rd.luks.options=discard</code> del kernel no tiene ningún efecto en los dispositivos incluidos en el archivo <code>/etc/crypttab</code> para la imagen de initramfs (<code>/etc/crypttab.initramfs</code> en la raíz real). Debe especificar la opción <code>discard</code> en <code>/etc/crypttab.initramfs</code>.</div>
<p>Además de la opción del kernel, también se requiere ejecutar periódicamente <code>fstrim</code> o montar el sistema de archivos (por ejemplo, <code>/dev/mapper/root</code> en este ejemplo) con la opción <code>discard</code> en <code>/etc/fstab</code>. Para obtener más información, consulte la página de <a href="../../en/Solid_state_drive.html#TRIM" class="mw-redirect" title="TRIM">TRIM</a>.
</p>
<p>Para los dispositivos LUKS desbloqueados a través de <code>/etc/crypttab</code> use la opción <code>discard</code>, por ejemplo:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">luks-123abcdef-etc UUID=123abcdef-etc none discard</pre>
<p>Cuando desbloquee manualmente los dispositivos en la consola, use <code>--allow-discards</code>.
</p>
<p>Con LUKS2 puede establecer <code>allow-discards</code> como un indicador predeterminado para un dispositivo abriéndolo una vez con la opción <code>--persistent</code>:
</p>
<pre># cryptsetup --allow-discards --persistent open --type luks2 /dev/sdaX root
</pre>
<p>Puede confirmar que el indicador se ha establecido de forma permanente en el encabezado LUKS2 comprobando la salida de <code>cryptsetup luksDump</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksDump /dev/sdaX | grep Flags</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Flags:          allow-discards
</pre>
<p>En cualquier caso, puede verificar si el dispositivo realmente se abrió con discards inspeccionando la salida de <code>dmsetup table</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># dmsetup table</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">luks-123abcdef-etc: 0 1234567 crypt aes-xts-plain64 000etc000 0 8:2 4096 1 allow_discards
</pre>
<h2><span class="mw-headline" id="El_hook_encrypt_y_varios_discos">El hook encrypt y varios discos</span></h2>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Sugerencia:</strong> El hook <code>sd-encrypt</code> admite el desbloqueo de múltiples dispositivos. Se pueden especificar en la línea de órdenes del kernel o en el archivo <code>/etc/crypttab.initramfs</code>. Consulte <a href="../../es/Dm-crypt/System_configuration.html#Utilizar_el_hook_sd-encrypt" class="mw-redirect" title="Dm-crypt/System configuration (Español)">dm-crypt/System configuration (Español)#Utilizar el hook sd-encrypt</a>.</div>
<p>El hook <code>encrypt</code> solo permite una <b>única</b> entrada <code>cryptdevice=</code> (<a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/23182">FS#23182</a>). En las configuraciones del sistema con múltiples unidades, esto puede ser limitante, ya que <i>dm-crypt</i> no tiene una función que permita exceder al dispositivo físico. Por ejemplo, tomemos «LVM sobre LUKS»: todo el volumen LVM existe dentro de un mapeado LUKS. Esto está perfectamente bien para un sistema de una sola unidad, ya que solo hay un dispositivo para descifrar. Pero, ¿qué sucede cuando desea aumentar el tamaño de LVM? No puede, al menos no sin modificar el hook <code>encrypt</code>.
</p>
<p>Las siguientes secciones muestran sucintamente las alternativas para superar dicha limitación. El primero trata sobre cómo expandir una configuración <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html#LUKS_sobre_LVM" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">LUKS sobre LVM</a> a un nuevo disco. El segundo consiste en la modificación del hook <code>encrypt</code> para poder desbloquear varios discos en las configuraciones LUKS sin LVM.
</p>
<h3><span class="mw-headline" id="Expandir_LVM_en_varios_discos">Expandir LVM en varios discos</span></h3>
<p>La gestión de discos múltiples es una característica básica de <a href="../../es/LVM.html" title="LVM (Español)">LVM (Español)</a> y una de las principales razones para su flexibilidad de particionado. También se puede utilizar con <i>dm-crypt</i>, pero solo si se emplea LVM como primer mapeador. En tal configuración <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html#LUKS_sobre_LVM" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">LUKS sobre LVM</a> los dispositivos encriptados se crean dentro de los volúmenes lógicos (con una clave/contraseña por volumen). Lo siguiente cubre los pasos para saber cómo expandir esa configuración a otro disco.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> Realice una copia de seguridad. Si bien el cambio de tamaño de los sistemas de archivos puede estar estandarizada, tenga en cuenta que las operaciones <b>pueden</b> ir mal y lo explicado a continuación podría no ajustarse a su configuración particular. En general, extender un sistema de archivos para liberar espacio en el disco es menos problemático que reducir uno. Esto se aplica, en particular, cuando se usan mapeadores apilados, como es el caso del siguiente ejemplo.</div>
<h4>
<span id="A.C3.B1adir_una_nueva_unidad"></span><span class="mw-headline" id="Añadir_una_nueva_unidad">Añadir una nueva unidad</span>
</h4>
<p>Primero, prepare un nuevo disco de acuerdo con <a href="../../es/Dm-crypt/Drive_preparation.html" class="mw-redirect" title="Dm-crypt/Drive preparation (Español)">dm-crypt/Drive preparation (Español)</a>.
Segundo, partíciónelo como un LVM, por ejemplo, asigne todo el espacio a <code>/dev/sdY1</code> con el tipo de partición <code>8E00</code> (Linux LVM).
Y tercero, adjunte el nuevo disco/partición al grupo de volúmenes LVM existente, por ejemplo:
</p>
<pre># pvcreate /dev/sdY1
# vgextend MyStorage /dev/sdY1
</pre>
<h4>
<span id="Extender_el_volumen_l.C3.B3gico"></span><span class="mw-headline" id="Extender_el_volumen_lógico">Extender el volumen lógico</span>
</h4>
<p>El siguiente paso, consiste en la asignación final del nuevo espacio del disco al el volumen lógico que se va a extender, para lo cual dicho volumen lógico tiene que ser desmontado. Se puede realizar para la partición raíz <code>cryptdevice</code>, pero en este caso el procedimiento se debe realizar desde una imagen ISO de instalación de Arch.
</p>
<p>En este ejemplo, se supone que el volumen lógico para <code>/home</code> (nombre del volúmen lógico <code>homevol</code>) se expandirá al espacio del disco nuevo:
</p>
<pre># umount /home
# fsck /dev/mapper/home
# cryptsetup luksClose /dev/mapper/home
# lvextend -l +100%FREE MyStorage/homevol
</pre>
<p>Ahora, una vez extendido el volumen lógico, el contenedor LUKS viene a continuación:
</p>
<pre># cryptsetup open /dev/MyStorage/homevol home
# umount /home      # Como seguridad, para el caso de que fuera automática remontar
# cryptsetup --verbose resize home
</pre>
<p>Finalmente, redimensionamos el sistema de archivos:
</p>
<pre># e2fsck -f /dev/mapper/home
# resize2fs /dev/mapper/home
</pre>
<p>¡Hecho! Si este era su plan, <code>/home</code> se puede volver a montar y ahora incluirá el espacio del nuevo disco:
</p>
<pre># mount /dev/mapper/home /home
</pre>
<p>Tenga en cuenta que la acción <code> cryptsetup resize</code> no afecta a las claves de cifrado y, por tanto, estas no habrán cambiado.
</p>
<h3><span class="mw-headline" id="Modificar_el_hook_encrypt_para_varias_particiones">Modificar el hook encrypt para varias particiones</span></h3>
<h4>
<span id="Sistema_de_archivos_ra.C3.ADz_que_abarca_m.C3.BAltiples_particiones"></span><span class="mw-headline" id="Sistema_de_archivos_raíz_que_abarca_múltiples_particiones">Sistema de archivos raíz que abarca múltiples particiones</span>
</h4>
<p>Es posible modificar el hook encrypt para permitir descifrar múltiples unidades de disco duro raíz (<code>/</code>) en el arranque. En un solo paso:
</p>
<pre># cp /usr/lib/initcpio/install/encrypt /etc/initcpio/install/encrypt2
# cp /usr/lib/initcpio/hooks/encrypt  /etc/initcpio/hooks/encrypt2
# sed -i "s/cryptdevice/cryptdevice2/" /etc/initcpio/hooks/encrypt2
# sed -i "s/cryptkey/cryptkey2/" /etc/initcpio/hooks/encrypt2
</pre>
<p>Agregue <code>cryptdevice2=</code> a sus opciones de arranque (y <code>cryptkey2=</code> si es necesario), y agregue el hook <code>encrypt2</code> a <a href="../../en/Mkinitcpio.html" class="mw-redirect" title="Mkinitcpio (Español)">mkinitcpio.conf</a> antes de regenerarlo. Vea <a href="../../es/Dm-crypt/System_configuration.html" class="mw-redirect" title="Dm-crypt/System configuration (Español)">dm-crypt/System configuration (Español)</a>.
</p>
<h4>
<span id="M.C3.BAltiples_particiones_no_root"></span><span class="mw-headline" id="Múltiples_particiones_no_root">Múltiples particiones no root</span>
</h4>
<p>Tal vez tenga la necesidad de usar el hook <code>encrypt</code> en una partición no root. Arch no admite esto de forma automática sino que necesita intervención manual, sin embargo, puede cambiar fácilmente los valores de cryptdev y cryptname en <code>/lib/initcpio/hooks/encrypt</code> (el primero en su partición <code>/dev/sd*</code>, el segundo para el nombre que desea atribuirle). Eso debería bastar.
</p>
<p>La gran ventaja es que puede tener todo automatizado, mientras que configurar <code>/etc/crypttab</code> con un archivo de claves externa (es decir, el archivo de claves no está en ninguna partición interna del disco duro) puede ser una molestia. Asegúrese de que el dispositivo USB/FireWire/... se monte antes que la partición encriptada, lo que significa que debe cambiar el orden de <code>/etc/fstab</code> (al menos).
</p>
<p>Por supuesto, si se actualiza el paquete <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span>, tendrá que cambiar este script nuevamente. A diferencia de <code>/etc/crypttab</code>, solo se admite una partición, pero con un poco más de picardía se pueden desbloquear varias particiones.
</p>
<p>Si desea implementar esto en una partición RAID por software, hay una cosa más que debe hacer. No basta con configurar el dispositivo <code>/dev/mdX</code> en <code>/lib/initcpio/hooks/encrypt</code>; el hook <code>encrypt</code> fallará  al no poder encontrar la clave por algún motivo y tampoco mostrará un prompt para pedirle una contraseña. Parece que los dispositivos RAID no se activan hasta que se ejecuta el hook <code>encrypt</code>. Puede resolver esto colocando la matriz RAID en <code>/boot/grub/menu.lst</code>, así:
</p>
<pre>kernel /boot/vmlinuz-linux md=1,/dev/hda5,/dev/hdb5
</pre>
<p>Si configura su partición raíz como un RAID, advertirá avisos similares con esa configuración. <a href="../../es/GRUB.html" title="GRUB (Español)">GRUB (Español)</a> puede manejar múltiples definiciones de matriz muy bien:
</p>
<pre>kernel /boot/vmlinuz-linux root=/dev/md0 ro md=0,/dev/sda1,/dev/sdb1 md=1,/dev/sda5,/dev/sdb5,/dev/sdc5
</pre>
<h2><span class="mw-headline" id="Sistema_cifrado_usando_un_encabezado_LUKS_separado">Sistema cifrado usando un encabezado LUKS separado</span></h2>
<p>Este ejemplo sigue la misma configuración que en <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html#Modalidad_plain_de_dm-crypt" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">dm-crypt/Encrypting an entire system (Español)#Modalidad plain de dm-crypt</a>, que debería leer primero antes de seguir esta guía.
</p>
<p>Al utilizar un encabezado separado, el dispositivo de bloque cifrado solo transporta datos cifrados, lo que proporciona <a href="https://en.wikipedia.org/wiki/Deniable_encryption" class="extiw" title="wikipedia:Deniable encryption">cifrado denegable</a> siempre que los atacantes no conozcan la existencia de un encabezado. Es similar a usar la <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html#Modalidad_plain_de_dm-crypt" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">modalidad plain de dm-crypt</a>, pero con las ventajas de LUKS como la posibilidad de usar varias contraseñas para desbloquear la clave maestra y la <a href="https://en.wikipedia.org/wiki/es:Funci%C3%B3n_de_derivaci%C3%B3n_de_clave" class="extiw" title="wikipedia:es:Función de derivación de clave">función de derivación de la clave</a>. Además, el uso de un encabezado separado ofrece una forma de <a href="https://en.wikipedia.org/wiki/es:Autenticaci%C3%B3n_de_m%C3%BAltiples_factores" class="extiw" title="wikipedia:es:Autenticación de múltiples factores">autenticación de dos factores</a> con una configuración más fácil que <a href="#Utilizar_archivos_de_claves_cifrados_con_GPG,_LUKS_o_OpenSSL">usar un achivo de claves cifrado con GPG u OpenSSL</a>, ya que tendrá un prompt solicitando la contraseña que permite reintentos múltiples. Consulte <a href="../../es/Data-at-rest_encryption.html#Metadatos_criptogr%C3%A1ficos" class="mw-redirect" title="Disk encryption (Español)">Disk encryption (Español)#Metadatos criptográficos</a> para obtener más información.
</p>
<p>Consulte <a href="../../es/Dm-crypt/Device_encryption.html#Opciones_de_cifrado_para_la_modalidad_LUKS" class="mw-redirect" title="Dm-crypt/Device encryption (Español)">dm-crypt/Device encryption (Español)#Opciones de cifrado para la modalidad LUKS</a> para ver las opciones de cifrado antes de realizar el primer paso para configurar la partición del sistema cifrado y crear un archivo de encabezado para usar con <code>cryptsetup</code>:
</p>
<pre># dd if=/dev/zero of=header.img bs=4M count=1 conv=notrunc
# cryptsetup luksFormat --type luks2 /dev/sdX --align-payload 8192 --header header.img
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Sugerencia:</strong> Cuando use la opción <code>--header</code>, <code>--align-payload</code> permite especificar el inicio de datos cifrados en un dispositivo. Al reservar un espacio al comienzo del dispositivo, tiene la opción posteriormente de <a href="../../es/Dm-crypt/Device_encryption.html#Restaurar_utilizando_cryptsetup" class="mw-redirect" title="Dm-crypt/Device encryption (Español)">volver a colocar el encabezado LUKS</a>. Consulte <span class="plainlinks archwiki-template-man" title="$ man 8 cryptsetup"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cryptsetup.8">cryptsetup(8)</a></span> para conocer los valores admitidos por<code>--align-payload</code>.</div>
<p>Abra el contenedor:
</p>
<pre># cryptsetup open --header header.img /dev/sdX enc
</pre>
<p>Ahora siga los pasos de la <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html#Preparar_las_particiones_que_no_son_de_arranque_(boot)" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">configuración de LVM sobre LUKS</a> según sus necesidades. Lo mismo se aplica a la <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html#Preparar_la_partici%C3%B3n_de_arranque_4" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">preparación de la partición de arranque</a> en el dispositivo extraíble (porque de lo contrario, no tiene sentido tener un archivo de encabezado separado para desbloquear el cifrado disco).
Luego mueva el <code>header.img</code> sobre él:
</p>
<pre># mv header.img /mnt/boot
</pre>
<p>Siga el procedimiento de instalación hasta el paso mkinitcpio (ahora debería realizar <code>arch-chroot</code> dentro del sistema cifrado).
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Sugerencia:</strong> Se dará cuenta de que, como la partición del sistema solo tiene datos «aleatorios», no tiene una tabla de particiones y, por lo tanto, un <code>UUID</code> o un <code>LABEL</code>. Pero aún puede tener una mapeado consistente utilizando el <a href="../../es/Persistent_block_device_naming.html#by-id_y_by-path" title="Persistent block device naming (Español)">Persistent block device naming (Español)#by-id y by-path</a>. Por ejemplo usando la identificación del disco de <code>/dev/disk/by-id/</code>.</div>
<p>Hay dos opciones para que initramfs admita un encabezado LUKS separado.
</p>
<h3><span class="mw-headline" id="Utilizar_el_hook_systemd">Utilizar el hook systemd</span></h3>
<p>Primero cree <code>/etc/crypttab.initramfs</code> y agregue el dispositivo cifrado a él. La sintaxis se define en <span class="plainlinks archwiki-template-man" title="$ man 5 crypttab"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/crypttab.5">crypttab(5)</a></span>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab.initramfs</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">enc	/dev/disk/by-id/<i>your-disk_id</i>	none	header=/boot/header.img</pre>
<p>Modifique <code>/etc/mkinitcpio.conf</code> <a href="../../en/Mkinitcpio.html#Hooks_m%C3%A1s_comunes" class="mw-redirect" title="Mkinitcpio (Español)">para usar systemd</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">enlace roto</a>: sección no válida]</sup> y agregue la imagen header a <code>FILES</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
FILES=(<b>/boot/header.img</b>)
...
HOOKS=(base <b>systemd</b> autodetect <b>keyboard</b> <b>sd-vconsole</b> modconf block <b>sd-encrypt</b> <b>sd-lvm2</b> filesystems fsck)
...</pre>
<p><a href="../../en/Mkinitcpio.html#Creaci%C3%B3n_de_la_imagen_y_activaci%C3%B3n" class="mw-redirect" title="Mkinitcpio (Español)">Regenerar initramfs</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">enlace roto</a>: sección no válida]</sup> y listo.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> No es necesario pasar ningún parámetro cryptsetup a la línea de órdenes del kernel, ya que <code>/etc/crypttab.initramfs</code> se agregará como <code>/etc/crypttab</code> en initramfs. Si desea especificarlos en la línea de órdenes del kernel, consulte <a href="../../es/Dm-crypt/System_configuration.html#Utilizar_el_hook_sd-encrypt" class="mw-redirect" title="Dm-crypt/System configuration (Español)">dm-crypt/System configuration (Español)#Utilizar el hook sd-encrypt</a> para ver las opciones admitidas.</div>
<h3><span class="mw-headline" id="Modificar_el_hook_encrypt">Modificar el hook encrypt</span></h3>
<p>Este método muestra cómo modificar el hook <code>encrypt</code> para usar un encabezado LUKS separado.
Ahora el hook <code>encrypt</code> debe modificarse para que <code>cryptsetup</code> use el encabezado separado (<a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/42851">FS#42851</a>; fuente base e idea para estos cambios <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1076346#p1076346">publicado en BBS</a>). Haga una copia para que no se sobrescriba en una actualización de <a href="../../en/Mkinitcpio.html" class="mw-redirect" title="Mkinitcpio (Español)">mkinitcpio (Español)</a>:
</p>
<pre># cp /usr/lib/initcpio/hooks/encrypt /etc/initcpio/hooks/encrypt2
# cp /usr/lib/initcpio/install/encrypt /etc/initcpio/install/encrypt2
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/hooks/encrypt2 (around line 52)</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">warn_deprecated() {
    echo "The syntax 'root=${root}' where '${root}' is an encrypted volume is deprecated"
    echo "Use 'cryptdevice=${root}:root root=/dev/mapper/root' instead."
}

<b>local headerFlag=false</b>
for cryptopt in ${cryptoptions//,/ }; do
    case ${cryptopt} in
        allow-discards)
            cryptargs="${cryptargs} --allow-discards"
            ;;  
        <b>header)
            cryptargs="${cryptargs} --header /boot/header.img"
            headerFlag=true
            ;;</b>
        *)  
            echo "Encryption option '${cryptopt}' not known, ignoring." &gt;&amp;2 
            ;;  
    esac
done

if resolved=$(resolve_device "${cryptdev}" ${rootdelay}); then
    if <b>$headerFlag || </b>cryptsetup isLuks ${resolved} &gt;/dev/null 2&gt;&amp;1; then
        [ ${DEPRECATED_CRYPT} -eq 1 ] &amp;&amp; warn_deprecated
        dopassphrase=1</pre>
<p>Ahora edite el archivo <a href="../../en/Mkinitcpio.html" class="mw-redirect" title="Mkinitcpio (Español)">mkinitcpio.conf</a> para agregar los hooks <code>encrypt2</code> y <code>lvm2</code> a <code>HOOKS</code>,  el archivo <code>header.img</code> a <code>FILES</code> y el modulo <code>loop</code> a <code>MODULES</code>, aparte de otras configuraciones que requiera el sistema:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
MODULES=(<b>loop</b>)
...
FILES=(<b>/boot/header.img</b>)
...
HOOKS=(base udev autodetect <b>keyboard</b> <b>keymap</b> consolefont modconf block <b>encrypt2</b> <b>lvm2</b> filesystems fsck)
...</pre>
<p>Esto es necesario para que el encabezado LUKS esté disponible en el arranque y permita el descifrado del sistema, eximiéndonos de una configuración más complicada como montar otro dispositivo USB separado para acceder al encabezado. Después de esta configuración se creará <a href="../../en/Mkinitcpio.html#Creaci%C3%B3n_de_la_imagen_y_activaci%C3%B3n" class="mw-redirect" title="Mkinitcpio (Español)">initramfs</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">enlace roto</a>: sección no válida]</sup>.
</p>
<p>A continuación, <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html#Configurar_el_gestor_de_arranque_4" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">configure el cargador de arranque </a> para especificar <code>cryptdevice=</code> pasando también la nueva opción <code>header</code> a dicha configuración:
</p>
<pre>cryptdevice=/dev/disk/by-id/<i>your-disk_id</i>:enc:header
</pre>
<p>Para finalizar, seguimos <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html#Posinstalaci%C3%B3n" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">dm-crypt/Encrypting an entire system (Español)#Posinstalación</a> que es particularmente útil con una partición <code>/boot</code> en un medio de almacenamiento USB.
</p>
<h2>
<span id=".2Fboot_cifrado_y_un_encabezado_LUKS_separado_en_USB"></span><span class="mw-headline" id="/boot_cifrado_y_un_encabezado_LUKS_separado_en_USB">/boot cifrado y un encabezado LUKS separado en USB</span>
</h2>
<p>En lugar de incrustar la imagen <code>header.img</code> y el archivo de claves en <a href="../../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">initramfs</a>, esta configuración hará que su sistema dependa completamente de la llave usb en lugar de tan solo la imagen de arranque, y del archivo de claves cifrado que contiene la partición de arranque cifrada. Como el encabezado y el archivo de claves no están embebidos en la imagen <a href="../../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">initramfs</a> y el hook encrypt personalizado está específicamente para <a href="../../es/Persistent_block_device_naming.html#by-id_y_by-path" title="Persistent block device naming (Español)">by-id</a>, literalmente necesitará la llave usb para arrancar.
</p>
<p>Para la unidad usb, ya que está cifrando la unidad y el archivo de claves en su interior, es preferible colocar en cascada los algoritmos de cifrado para no usar el mismo dos veces. Es discutible si un <a href="https://en.wikipedia.org/wiki/es:ataque_de_intermediario" class="extiw" title="wikipedia:es:ataque de intermediario">ataque de intermediario</a> sería realmente factible. Puede ser <a href="https://en.wikipedia.org/wiki/es:Twofish" class="extiw" title="wikipedia:es:Twofish">twofish</a>-<a href="https://en.wikipedia.org/wiki/es:Serpent" class="extiw" title="wikipedia:es:Serpent">serpent</a> o serpent-twofish.
</p>
<h3><span class="mw-headline" id="Preparar_las_particiones_de_los_discos">Preparar las particiones de los discos</span></h3>
<p>Se asumirá que <code>sdb</code> es la unidad USB, y que <code>sda</code> es el disco duro principal.
</p>
<p>Prepare los dispositivos de acuerdo con <a href="../../es/Dm-crypt/Drive_preparation.html" class="mw-redirect" title="Dm-crypt/Drive preparation (Español)">dm-crypt/Drive preparation (Español)</a>.
</p>
<h4><span class="mw-headline" id="Preparar_la_llave_USB">Preparar la llave USB</span></h4>
<p>Utilice <a href="../../en/GPT_fdisk.html" class="mw-redirect" title="Gdisk">gdisk</a> para particionar el disco según el diseño <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html#Preparar_el_disco_5" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">mostrado aquí</a>, con la excepción de que solo debe incluir las dos primeras particiones. De este modo:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># gdisk /dev/sdb</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048         1050623   512.0 MiB   EF00  EFI System
   2         1050624         1460223   200.0 MiB   8300  Linux filesystem
</pre>
<p>Antes de ejecutar <code>cryptsetup</code>, consulte <a href="../../es/Dm-crypt/Device_encryption.html#Opciones_de_cifrado_para_la_modalidad_LUKS" class="mw-redirect" title="Dm-crypt/Device encryption (Español)">opciones de cifrado para la modalidad LUKS</a> y <a href="../../es/Data-at-rest_encryption.html#Algoritmos_de_cifrado_y_modalidades_de_operaci%C3%B3n" class="mw-redirect" title="Disk encryption (Español)">algoritmos de cifrado y modalidades de operación</a> .
</p>
<p><a href="../../es/Dm-crypt/Encrypting_an_entire_system.html#Preparar_la_partici%C3%B3n_de_arranque_4" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">Prepare la partición de arranque</a> pero no ejecute <code>mount</code> sobre ninguna partición todavía y <a href="../../es/EFI_system_partition.html#Formatear_la_partici%C3%B3n" title="EFI system partition (Español)">formatee la partición del sistema EFI</a>.
</p>
<pre># mount /dev/mapper/cryptboot /mnt
# dd if=/dev/urandom of=/mnt/key.img bs=<i>tamaño_del_archivo</i> count=1
# cryptsetup --align-payload=1 luksFormat /mnt/key.img
# cryptsetup open /mnt/key.img lukskey
</pre>
<p>El <i>tamaño_del_archivo</i> está en bytes pero puede ir seguido de un sufijo como <code>M</code>. Tener un archivo demasiado pequeño le dará un desagradable error <code>Requested offset is beyond real size of device /dev/loop0</code>. Como referencia aproximada, la creación de un archivo de 4M lo cifrará correctamente. Debe hacer que el archivo sea más grande que el espacio necesario, ya que el dispositivo loop cifrado será un poco más pequeño que el tamaño del archivo.
</p>
<p>Con un archivo grande, puede usar <code>--keyfile-offset=<i>desplazamiento</i></code> y <code>--keyfile-size=<i>tamaño</i></code> para navegar a la posición correcta. <a rel="nofollow" class="external autonumber" href="https://wiki.gentoo.org/wiki/Custom_Initramfs#Encrypted_keyfile">[5]</a>
</p>
<p>Ahora debería tener <code>lukskey</code> abierto en un dispositivo loop (en <code>/dev/loop1</code>), mapeado como <code>/dev/mapper/lukskey</code>.
</p>
<h4><span class="mw-headline" id="Preparar_la_unidad_principal">Preparar la unidad principal</span></h4>
<pre># truncate -s 2M /mnt/header.img
# cryptsetup --key-file=/dev/mapper/lukskey --keyfile-offset=<i>desplazamiento</i> --keyfile-size=<i>tamaño</i> luksFormat /dev/sda --align-payload 4096 --header /mnt/header.img
</pre>
<p>Elija un <i>desplazamiento</i> y un <i>tamaño</i> en bytes (8192 bytes es el tamaño máximo de archivo de claves para <code>cryptsetup</code>).
</p>
<pre># cryptsetup open --header /mnt/header.img --key-file=/dev/mapper/lukskey --keyfile-offset=<i>offset</i> --keyfile-size=<i>size</i> /dev/sda enc 
# cryptsetup close lukskey
# umount /mnt
</pre>
<p>Siga con los pasos para la <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html#Preparar_los_vol%C3%BAmenes_l%C3%B3gicos" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">preparación de los volúmenes lógicos</a> para configurar LVM sobre LUKS.
</p>
<p>Consulte <a href="../../en/Partitioning.html#Particiones_dedicadas" class="mw-redirect" title="Partitioning (Español)">Partitioning (Español)#Particiones dedicadas</a><sup>[<a href="../../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">enlace roto</a>: sección no válida]</sup> para obtener recomendaciones sobre el tamaño de sus particiones.
</p>
<p>Una vez que su partición raíz esté montada, realice <code>mount</code> sobre su partición de arranque cifrada como <code>/mnt/boot</code> y su partición del sistema EFI como <code>/mnt/efi</code>.
</p>
<h3>
<span id="Procedimiento_de_instalaci.C3.B3n_y_personalizaci.C3.B3n_del_hook_encrypt"></span><span class="mw-headline" id="Procedimiento_de_instalación_y_personalización_del_hook_encrypt">Procedimiento de instalación y personalización del hook encrypt</span>
</h3>
<p>Siga la <a href="../../es/Installation_guide.html" title="Installation guide (Español)">installation guide (Español)</a> hasta el paso <code>mkinitcpio</code> pero no lo haga todavía, y omita los pasos de partición, formateo y montaje como ya se han hecho.
</p>
<p>Para que la configuración cifrada funcione, necesita crear su propio hook, que afortunadamente es fácil de hacer y aquí está el código que necesita. Tendrá que seguir <a href="../../es/Persistent_block_device_naming.html#by-id_y_by-path" title="Persistent block device naming (Español)">Persistent block device naming (Español)#by-id y by-path</a> para averiguar sus propios valores <code>by-id</code> para el disco usb y para el disco principal (están vinculados -&gt; a <code>sda</code> o <code>sdb</code>).
</p>
<p>Debería usar <code>by-id</code> en lugar de <code>sda</code> o <code>sdb</code> porque <code>sdX</code> puede cambiar, y aquel garantiza que sea el dispositivo correcto .
</p>
<p>Puede nombrar <code>customencrypthook</code> como quiera, y los hooks de compilación personalizados se pueden colocar en las carpetas <code>hooks</code> e <code>install</code> de <code>/etc/initcpio</code>. Mantenga una copia de seguridad de ambos archivos (<code>cp</code> a la partición <code>/home</code> o al directorio <code>/home</code> de su usuario después de crearlos). <code>/usr/bin/ash</code> no es un error tipográfico.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/hooks/customencrypthook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/ash

run_hook() {
    modprobe -a -q dm-crypt &gt;/dev/null 2&gt;&amp;1
    modprobe loop
    [ "${quiet}" = "y" ] &amp;&amp; CSQUIET="&gt;/dev/null"

    while [ ! -L '/dev/disk/by-id/<i>usbdrive</i>-part2' ]; do
     echo 'Waiting for USB'
     sleep 1
    done

    cryptsetup open /dev/disk/by-id/<i>usbdrive</i>-part2 cryptboot
    mkdir -p /mnt
    mount /dev/mapper/cryptboot /mnt
    cryptsetup open /mnt/key.img lukskey
    cryptsetup --header /mnt/header.img --key-file=/dev/mapper/lukskey --keyfile-offset=''offset'' --keyfile-size=''size'' open /dev/disk/by-id/<i>harddrive</i> enc
    cryptsetup close lukskey
    umount /mnt
}
</pre>
<p><code><i>usbdrive</i></code> es su unidad USB <code>by-id</code>, y <code><i>harddrive</i></code> su unidad de disco duro principal <code>by-id</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Sugerencia:</strong> También puede cerrar <code>cryptboot</code> usando <code>cryptsetup close</code>, pero tenerlo abierto facilita el montaje de las actualizaciones del sistema usando <a href="../../es/Pacman.html" title="Pacman (Español)">Pacman (Español)</a> y regenere initramfs con <a href="../../en/Mkinitcpio.html" class="mw-redirect" title="Mkinitcpio (Español)">mkinitcpio (Español)</a>. La partición <code>/boot</code> debe estar montada para las actualizaciones que afectan al <a href="../../en/Kernel.html" class="mw-redirect" title="Kernel (Español)">Kernel (Español)</a> o <a href="../../es/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs (Español)">Initramfs (Español)</a>, e initramfs se regenerará automáticamente después de estas actualizaciones.</div>
<pre># cp /usr/lib/initcpio/install/encrypt /etc/initpcio/install/customencrypthook
</pre>
<p>Ahora edite el archivo copiado y elimine la sección  <code>help()</code> ya que no es necesaria.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf (edite solo esta parte, no lo reemplace, estos son solo extractos de las partes necesarias)</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">MODULES=(loop)
...
HOOKS=(base udev autodetect modconf block customencrypthook lvm2 filesystems keyboard fsck)</pre>
<p>Las matrices <code>files=()</code> y <code>binaries=()</code> están vacías, y no debería tener que reemplazar la matriz <code>HOOKS=(...)</code> completa, basta colocar <code>customencrypthook lvm2</code> después de <code>block</code> y antes de <code>filesystems</code>, y asegúrese de <code>systemd</code>, <code>sd-lvm2</code> y <code>encrypt</code> son quitados.
</p>
<h4><span class="mw-headline" id="Cargador_de_arranque">Cargador de arranque</span></h4>
<p>Finalice la <a href="../../es/Installation_guide.html#Initramfs" title="Installation guide (Español)">guía de instalación</a> desde el paso <code>mkinitcpio</code>. Para arrancar, necesitaría <a href="../../es/GRUB.html" title="GRUB (Español)">GRUB (Español)</a> o <a href="../../es/Unified_Extensible_Firmware_Interface.html#efibootmgr" title="Unified Extensible Firmware Interface (Español)">Unified Extensible Firmware Interface (Español)#efibootmgr</a>. Tenga en cuenta que puede usar <a href="../../es/GRUB.html" title="GRUB (Español)">GRUB (Español)</a> para admitir los discos encriptados mediante la <a href="../../es/Dm-crypt/Encrypting_an_entire_system.html#Configurar_el_gestor_de_arranque_4" class="mw-redirect" title="Dm-crypt/Encrypting an entire system (Español)">configuración del cargador de arranque</a>, pero modificar la línea <code>GRUB_CMDLINE_LINUX</code> no es necesario para esta configuración.
</p>
<p>O use Direct UEFI Secure boot para generar claves con <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/cryptboot/">cryptboot</a></span><sup><small>AUR</small></sup>, firmando luego initramfs y el kernel y creando un archivo de arranque <i>.efi </i> para la partición del sistema EFI con <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sbupdate-git/">sbupdate-git</a></span><sup><small>AUR</small></sup>. Antes de usar cryptboot o sbupdate, observe este extracto de <a href="../../en/Unified_Extensible_Firmware_Interface/Secure_Boot.html#Using_your_own_keys" class="mw-redirect" title="Secure Boot">Secure Boot#Using your own keys</a>:
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Sugerencia:</strong> Tenga en cuenta que <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/cryptboot/">cryptboot</a></span><sup><small>AUR</small></sup> requiere que la partición de arranque cifrada se especifique en <code>/etc/crypttab</code> antes de que se ejecute, y si lo está utilizando en combinación con <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sbupdate-git/">sbupdate-git</a></span><sup><small>AUR</small></sup>, sbupdate espera a que los archivos <code>/boot/efikeys/db.*</code> creados por cryptboot se capitalicen como <code>DB.*</code> a menos que se configure de otro modo en <code>/etc/default/sbupdate</code>. Los usuarios que no usen systemd para manejar el cifrado pueden no tener nada en su archivo <code>/etc/crypttab</code> y necesitarán crear una entrada.
</div>
<pre># efibootmgr -c -d /dev/<i>device</i> -p <i>partition_number</i> -L "Arch Linux Signed" -l "EFI\Arch\linux-signed.efi"
</pre>
<p>Consulte <span class="plainlinks archwiki-template-man" title="$ man 8 efibootmgr"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/efibootmgr.8">efibootmgr(8)</a></span> para obtener una explicación de las opciones.
</p>
<p>Asegúrese de que el orden de inicio ponga <code>Arch Linux Signed</code> primero. Si no es así, cámbielo con <code>efibootmgr -o XXXX,YYYY,ZZZZ</code>.
</p>
<h3><span class="mw-headline" id="Cambiar_el_archivo_de_claves_LUKS">Cambiar el archivo de claves LUKS</span></h3>
<pre># cryptsetup --header /boot/header.img --key-file=/dev/mapper/lukskey --keyfile-offset=<i>offset</i> --keyfile-size=<i>size</i> luksChangeKey /dev/mapper/enc /dev/mapper/lukskey2 --new-keyfile-size=<i>newsize</i> --new-keyfile-offset=<i>newoffset</i>
</pre>
<p>Después, ejecute <code>cryptsetup close lukskey</code>, haga <a href="../../en/Securely_wipe_disk.html#shred" class="mw-redirect" title="Shred">shred</a> o <a href="../../en/Securely_wipe_disk.html#dd" title="Securely wipe disk">dd</a> sobre el archivo de claves antiguo con datos aleatorios antes de borrarlo, y asegúrese de que el nuevo archivo de claves tenga el mismo nombre que el anterior: <code>key.img</code> u otro nombre.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../es/Category:Data-at-rest_encryption.html" title="Category:Data-at-rest encryption (Español)">Data-at-rest encryption (Español)</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="../../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Dm-crypt_(Espa%C3%B1ol)/Specialties_(Espa%C3%B1ol)&amp;oldid=759661">https://wiki.archlinux.org/index.php?title=Dm-crypt_(Español)/Specialties_(Español)&amp;oldid=759661</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 10 December 2022, at 11:57.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
