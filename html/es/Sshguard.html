<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Sshguard (Español) - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.43.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Sshguard_Español rootpage-Sshguard_Español skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Instalación" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Instalaci%C3%B3n">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Instalación</span>
			</div>
		</a>
		
		<ul id="toc-Instalación-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Ajustes" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Ajustes">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Ajustes</span>
			</div>
		</a>
		
			<button aria-controls="toc-Ajustes-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Ajustes subsection</span>
			</button>
		
		<ul id="toc-Ajustes-sublist" class="vector-toc-list">
			<li id="toc-FirewallD" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#FirewallD">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>FirewallD</span>
				</div>
			</a>
			
			<ul id="toc-FirewallD-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-UFW" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#UFW">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>UFW</span>
				</div>
			</a>
			
			<ul id="toc-UFW-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-iptables" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#iptables">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3</span>
					<span>iptables</span>
				</div>
			</a>
			
			<ul id="toc-iptables-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-nftables" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#nftables">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4</span>
					<span>nftables</span>
				</div>
			</a>
			
			<ul id="toc-nftables-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Utilización" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Utilizaci%C3%B3n">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Utilización</span>
			</div>
		</a>
		
			<button aria-controls="toc-Utilización-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Utilización subsection</span>
			</button>
		
		<ul id="toc-Utilización-sublist" class="vector-toc-list">
			<li id="toc-systemd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#systemd">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>systemd</span>
				</div>
			</a>
			
			<ul id="toc-systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-syslog-ng" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#syslog-ng">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>syslog-ng</span>
				</div>
			</a>
			
			<ul id="toc-syslog-ng-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Configuración" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuraci%C3%B3n">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Configuración</span>
			</div>
		</a>
		
			<button aria-controls="toc-Configuración-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuración subsection</span>
			</button>
		
		<ul id="toc-Configuración-sublist" class="vector-toc-list">
			<li id="toc-Umbral_de_la_lista_negra" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Umbral_de_la_lista_negra">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>Umbral de la lista negra</span>
				</div>
			</a>
			
			<ul id="toc-Umbral_de_la_lista_negra-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Ejemplo_moderado_de_baneado" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Ejemplo_moderado_de_baneado">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.2</span>
					<span>Ejemplo moderado de baneado</span>
				</div>
			</a>
			
			<ul id="toc-Ejemplo_moderado_de_baneado-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Baneado_agresivo" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Baneado_agresivo">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.3</span>
					<span>Baneado agresivo</span>
				</div>
			</a>
			
			<ul id="toc-Baneado_agresivo-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Consejos_y_trucos" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Consejos_y_trucos">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Consejos y trucos</span>
			</div>
		</a>
		
			<button aria-controls="toc-Consejos_y_trucos-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Consejos y trucos subsection</span>
			</button>
		
		<ul id="toc-Consejos_y_trucos-sublist" class="vector-toc-list">
			<li id="toc-Desbloquear" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Desbloquear">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>Desbloquear</span>
				</div>
			</a>
			
			<ul id="toc-Desbloquear-sublist" class="vector-toc-list">
				<li id="toc-iptables_2" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#iptables_2">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1.1</span>
					<span>iptables</span>
				</div>
			</a>
			
			<ul id="toc-iptables_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-nftables_2" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#nftables_2">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1.2</span>
					<span>nftables</span>
				</div>
			</a>
			
			<ul id="toc-nftables_2-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Registro" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Registro">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2</span>
					<span>Registro</span>
				</div>
			</a>
			
			<ul id="toc-Registro-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Sshguard (Español)</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-en mw-list-item"><a href="../en/Sshguard.html" title="Sshguard – English" lang="en" hreflang="en" data-title="Sshguard" data-language-autonym="English" data-language-local-name="English" class="interlanguage-link-target"><span>English</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Sshguard" title="Sshguard – 日本語" lang="ja" hreflang="ja" data-title="Sshguard" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Sshguard" title="Sshguard – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" data-title="Sshguard" data-language-autonym="中文（简体）" data-language-local-name="中文（简体）" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="es" dir="ltr">
<div class="archwiki-template-box archwiki-template-box-note">Esta traducción de <a href="../en/Sshguard.html" title="Sshguard">Sshguard</a> fue revisada el <b>2018-09-03</b>. Si existen <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Sshguard&amp;diff=0&amp;oldid=513055">cambios</a> puede <a href="../es/ArchWiki:Translation_Team/Contributing.html" title="ArchWiki:Translation Team (Español)/Contributing (Español)">actualizarla</a> o avisar al <a href="../es/ArchWiki:Translation_Team.html" title="ArchWiki:Translation Team (Español)">equipo de traducción</a>.</div>
<div class="archwiki-template-meta-related-articles">
<p>Artículos relacionados</p>
<ul>
<li><a href="../en/Fail2ban.html" title="Fail2ban">fail2ban</a></li>
<li><a href="../es/OpenSSH.html" class="mw-redirect" title="Secure Shell (Español)">Secure Shell (Español)</a></li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Advertencia:</strong> Utilizar de una lista negra de IP detendrá ataques triviales, pero esto le supondrá el uso de un demonio adicional y de un registro fiable (la partición donde esté /var puede llenarse, especialmente si un atacante está golpeando el servidor). Además, con el conocimiento de su dirección IP, el atacante puede enviar paquetes con un encabezado de fuente falsificado y bloquearlo fuera del servidor. <a href="../en/SSH_keys.html" title="SSH keys">SSH keys</a> le  ofrece una solución elegante al problema del ataque de fuerza bruta, sin tantos inconvenientes.</div>
<p><a rel="nofollow" class="external text" href="https://www.sshguard.net">sshguard</a> es un demonio que protege a <a href="../en/Secure_Shell.html" class="mw-redirect" title="SSH">SSH</a> y otros servicios contra los ataques de fuerza bruta, similar a <a href="../en/Fail2ban.html" title="Fail2ban">fail2ban</a>.
</p>
<p>sshguard es diferente de este último en cuanto que está escrito en C, es más ligero y más simple de usar y con menos características, mientras realiza la función que se espera de él igual de bien.
</p>
<p>sshguard no es vulnerable a la mayoría (o, tal vez, a ninguno) de los análisis de registros, <a rel="nofollow" class="external text" href="https://web.archive.org/web/20120625102244/http://www.ossec.net/main/attacking-log-analysis-tools">vulnerabilidades</a> que han causado problemas para aplicaciones similares.
</p>
<meta property="mw:PageProp/toc">
<h2>
<span id="Instalaci.C3.B3n"></span><span class="mw-headline" id="Instalación">Instalación</span>
</h2>
<p><a href="../es/Help:Reading.html#Instalaci%C3%B3n_de_paquetes" class="mw-redirect" title="Install (Español)">Instale</a> el paquete <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sshguard">sshguard</a></span>.
</p>
<h2><span class="mw-headline" id="Ajustes">Ajustes</span></h2>
<p>sshguard funciona monitorizando <code>/var/log/auth.log</code>, syslog-ng o el <a href="../en/Systemd/Journal.html" class="mw-redirect" title="Systemd journal">journal de systemd</a> para intentos fallidos de inicio de sesión. Para cada intento fallido, el servidor infractor tiene prohibido continuar comunicándose con nuestro equipo durante un tiempo limitado. La cantidad de tiempo predeterminada que el atacante está baneado comienza en 120 segundos, y se incrementa en un factor de 1,5 cada vez que falla en otro intento de iniciar sesión. sshguard se puede configurar para prohibir permanentemente un servidor del que se tienen registrados demasiados intentos fallidos.
</p>
<p>Las prohibiciones temporales y permanentes se realizan añadiendo una entrada en la cadena («<i>chain</i>») «sshguard» en iptables que descarta todos los paquetes del atacante. La prohibición se registra en syslog y termina en <code>/var/log/auth.log</code>, o en el journal de systemd, si se está utilizando este último.
</p>
<p>Debe configurar uno de los siguientes cortafuegos para usarlo con sshguard para que funcione el bloqueo.
</p>
<h3><span class="mw-headline" id="FirewallD">FirewallD</span></h3>
<p>sshguard puede funcionar con Firewalld. Asegúrese, primero, de activar y configurar Firewalld. Para hacer que sshguard escriba en su zona de preferencia, emita las siguientes órdenes:
</p>
<pre># firewallctl zone "&lt;nombre_de_la_zona&gt;" --permanent add rich-rule "rule source ipset=sshguard4 drop"
</pre>
<p>Si usa ipv6, puede emitir la misma orden pero sustituyendo sshguard4 con sshguard6. Se terminaría con:
</p>
<pre># firewall-cmd --reload
</pre>
<p>Puede verificar lo anterior con:
</p>
<pre># firewall-cmd --info-ipset=sshguard4
</pre>
<p>Finalmente, en /etc/sshguard.conf, busque la línea para BACKEND y cámbiela de la siguiente manera
</p>
<pre>BACKEND="/usr/lib/sshguard/sshg-fw-firewalld"
</pre>
<h3><span class="mw-headline" id="UFW">UFW</span></h3>
<p>
Si UFW está instalado y activado, se le debe dar la capacidad de pasar el control de DROP a sshguard. Esto se logra modificando <code>/etc/ufw/before.rules</code> para que contenga las líneas de abajo, que se deben insertar justo después de la sección para los dispositivos loopback. </p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Los usuarios que ejecuten sshd en un puerto no estándar, deben sustituir el mismo en la línea final anterior (donde 22 es el estándar).</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ufw/before.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># permitir todo en loopback
-A ufw-before-input -i lo -j ACCEPT
-A ufw-before-output -o lo -j ACCEPT

# entregar el control de sshd a sshguard
-N sshguard
-A ufw-before-input -p tcp --dport 22 -j sshguard
</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Reinicie</a> ufw después de hacer esta modificación.
</p>
<h3><span class="mw-headline" id="iptables">iptables</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Consulte primero <a href="../en/Iptables.html" title="Iptables">iptables</a> y <a href="../en/Simple_stateful_firewall.html" title="Simple stateful firewall">Simple stateful firewall</a> para configurar un cortafuegos.</div>
<p>Lo principal que requiere la configuración es crear una cadena llamada <code>sshguard</code>, donde sshguard inserta automáticamente reglas para descartar paquetes de red provenientes de servidores peligrosos:
</p>
<pre># iptables -N sshguard
</pre>
<p>A continuación, hay que agregar una regla para saltar desde la cadena <code>INPUT</code> a la cadena <code>sshguard</code>. Esta regla debe añadirse <b>antes</b> de cualquier otra regla que procese los puertos que sshguard protege. Utilice la siguiente línea para proteger FTP y SSH, o vea <a rel="nofollow" class="external text" href="https://web.archive.org/web/20180902011955/https://www.sshguard.net/docs/setup/#netfilter-iptables">esta documentación</a> para más ejemplos.
</p>
<pre># iptables -A INPUT -m multiport -p tcp --destination-ports 21,22 -j sshguard
</pre>
<p>Para guardar las reglas:
</p>
<pre># iptables-save &gt; /etc/iptables/iptables.rules
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Para IPv6, repita los mismos pasos con <i>ip6tables</i> y guarde las reglas con <i>ip6tables-save</i> en <code>/etc/iptables/ip6tables.rules</code>.</div>
<h3><span class="mw-headline" id="nftables">nftables</span></h3>
<p>Edite <code>/etc/sshguard.conf</code> y cambie el valor de <code>BACKEND</code> como sigue:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sshguard.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">BACKEND="/usr/lib/sshguard/sshg-fw-nft-sets"</pre>
<p>Además, necesitará <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">editar</a> el servicio <code>sshguard.service</code> para que <a href="../es/Iptables.html" title="Iptables (Español)">iptables</a> no se ejecute:
</p>
<pre>[Service]
ExecStartPre= 
</pre>
<p>Cuando <a href="../es/Systemd.html#Utilizar_las_unidades" class="mw-redirect" title="Start/enable (Español)">inicie/active</a> el servicio <code>sshguard.service</code>, se agregararán dos nuevas tablas llamadas <code>sshguard</code> en las familias de direcciones <code>ip</code> y <code>ip6</code>, que filtran el tráfico entrante a través de la lista de direcciones IP de sshguard. Las cadenas en la tabla <code>sshguard</code> tienen una prioridad de -10 y, por tanto, se procesarán antes que otras reglas de menor prioridad. Consulte <span class="plainlinks archwiki-template-man" title="$ man 7 sshguard-setup"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sshguard-setup.">7 sshguard-setup( 7)</a></span> y <a href="../en/Nftables.html" title="Nftables">nftables</a> para obtener más información.
</p>
<h2>
<span id="Utilizaci.C3.B3n"></span><span class="mw-headline" id="Utilización">Utilización</span>
</h2>
<h3><span class="mw-headline" id="systemd">systemd</span></h3>
<p><a href="../es/Systemd.html#Utilizar_las_unidades" class="mw-redirect" title="Enable (Español)">Active</a> e <a href="../es/Systemd.html#Utilizar_las_unidades" class="mw-redirect" title="Start (Español)">inicie</a> <code>sshguard.service</code>.
</p>
<h3><span class="mw-headline" id="syslog-ng">syslog-ng</span></h3>
<p>Si tiene <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=syslog-ng">syslog-ng</a></span> instalado, puede iniciar sshguard directamente desde la línea de órdenes.
</p>
<pre>/usr/sbin/sshguard -l /var/log/auth.log -b /var/db/sshguard/blacklist.db
</pre>
<h2>
<span id="Configuraci.C3.B3n"></span><span class="mw-headline" id="Configuración">Configuración</span>
</h2>
<p>La configuración se realiza en el archivo <code>/etc/sshguard.conf</code>, necesario para que <i>sshguard </i> se inicie. Un ejemplo comentado se encuentra en <code>/usr/share/doc/sshguard/sshguard.conf.sample</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Nota:</strong> Las órdenes de tuberías y los indicadores de tiempo de ejecución en las unidades de systemd para <i>sshguard</i> <a rel="nofollow" class="external text" href="https://sourceforge.net/p/sshguard/mailman/message/35709860/">no son compatibles</a>. Tales indicadores se pueden modificar en el archivo de configuración.</div>
<h3><span class="mw-headline" id="Umbral_de_la_lista_negra">Umbral de la lista negra</span></h3>
<p>De forma predeterminada, en el archivo de configuración proporcionado por Arch, los atacantes quedan permanentemente prohibidos una vez que alcanzan un nivel de «peligro» de 120 (o 12 intentos de inicios de sesión fallidos —consulte <a rel="nofollow" class="external text" href="https://web.archive.org/web/20160908055836/http://www.sshguard.net/docs/terminology/#attack-dangerousness">attack dangerousness</a> para más detalles—). Este comportamiento puede modificarse anteponiendo un nivel de peligro distinto en el archivo de la lista negra.
</p>
<pre>BLACKLIST_FILE=200:/var/db/sshguard/blacklist.db
</pre>
<p>El nivel <code>200:</code> en este ejemplo, le dice a sshguard que bloquee permanentemente un servidor después de alcanzar un nivel de peligro de 200.
</p>
<p>Finalmente <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">reinicie</a> <code>sshguard.service</code>.
</p>
<h3><span class="mw-headline" id="Ejemplo_moderado_de_baneado">Ejemplo moderado de baneado</span></h3>
<p>He aquí una regla de prohibición ligeramente más agresiva que la predefinida, para ilustrar otras opciones. Fiscalizamos <a href="../en/OpenSSH.html" class="mw-redirect" title="Sshd">sshd</a> y <a href="../en/Very_Secure_FTP_Daemon.html" class="mw-redirect" title="Vsftpd">vsftpd</a> a través de los registros del <i>journal de systemd</i>.
Bloqueamos a los atacantes después de 2 intentos durante 180 segundos y el tiempo de bloqueo posterior aumentará en un factor de 1,5. Tenga en cuenta que esta función de retraso multiplicativo es interna y no está controlada por la configuración siguiente. Los atacantes son recordados durante 3600 segundos y permanecen en la lista negra después de 10 intentos (10 intentos con un costo de 10 cada uno, lo que explica el parámetro «100» en la configuración de la lista negra).
Bloqueamos no solo la IP del atacante, sino también toda la subred IPv4 24 (notación <a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing" class="extiw" title="wikipedia:Classless Inter-Domain Routing">CIDR</a>).
</p>
<pre>BACKEND="/usr/lib/sshguard/sshg-fw-iptables"
LOGREADER="LANG=C /usr/bin/journalctl -afb -p info -n1 -t sshd -t vsftpd -o cat"
THRESHOLD=20
BLOCK_TIME=180
DETECTION_TIME=3600
BLACKLIST_FILE=100:/var/db/sshguard/blacklist.db
IPV4_SUBNET=24
</pre>
<h3><span class="mw-headline" id="Baneado_agresivo">Baneado agresivo</span></h3>
<p>Para algunos usuarios sometidos a ataques constantes, se puede adoptar una política de prohibición más agresiva. Si está seguro de que los intentos de inicios de sesión fallidos son poco probables que sean accidentales, puede indicar a SSHGuard que prohíba permanentemente los servidores después de un solo intento de inicio de sesión fallido. Modifique los parámetros en el archivo de configuración de la siguiente manera:
</p>
<pre>THRESHOLD=10
BLACKLIST_FILE=10:/var/db/sshguard/blacklist.db
</pre>
<p>Finalmente <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">reinicie</a> <code>sshguard.service</code>.
</p>
<p>Además, para evitar múltiples intentos de autenticación durante una sola conexión, es posible que desee cambiar <code>/etc/ssh/sshd_config</code> definiendo:
</p>
<pre>MaxAuthTries 1
</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Reinicie</a> <code>sshd.service</code> para que este cambio surta efecto.
</p>
<h2><span class="mw-headline" id="Consejos_y_trucos">Consejos y trucos</span></h2>
<h3><span class="mw-headline" id="Desbloquear">Desbloquear</span></h3>
<p>Si la prohibición de una IP la realiza <i>usted mismo</i>, puede esperar a que se desbloquee automáticamente o puede utilizar iptables o nftables para destrabarla.
</p>
<h4><span class="mw-headline" id="iptables_2">iptables</span></h4>
<p>Primero compruebe si la IP está baneada por sshguard:
</p>
<pre># iptables --list sshguard --line-numbers --numeric
</pre>
<p>A continuación, utilice la siguiente orden para desbloquearla, con el número de línea obtenido de la orden anterior:
</p>
<pre># iptables --delete sshguard <i>line-number</i>
</pre>
<p>También deberá eliminar la dirección IP de <code>/var/db/sshguard/blacklist.db</code> para que el desbloqueo sea persistente.
</p>
<h4><span class="mw-headline" id="nftables_2">nftables</span></h4>
<p>Elimine la dirección IP del conjunto de <code>attackers</code>:
</p>
<pre># nft delete element <i>family</i> sshguard attackers { <i>ip_address</i> }
</pre>
<p>donde <code><i>family</i></code> es <code>ip</code> o <code>ip6</code>.
</p>
<h3><span class="mw-headline" id="Registro">Registro</span></h3>
<p>Para ver qué se pasa a través de sshguard, examine el script en <code>/usr/lib/systemd/scripts/sshguard-journalctl</code> y el servicio de systemd <code>sshguard.service</code>. Puede utilizar una orden equivalente para ver los registros en el terminal:
</p>
<pre># journalctl -afb -p info SYSLOG_FACILITY=4 SYSLOG_FACILITY=10
</pre>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../es/Category:Secure_Shell.html" title="Category:Secure Shell (Español)">Secure Shell (Español)</a></li>
<li><a href="../es/Category:Firewalls.html" title="Category:Firewalls (Español)">Firewalls (Español)</a></li>
</ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Sshguard_(Espa%C3%B1ol)&amp;oldid=756879">https://wiki.archlinux.org/index.php?title=Sshguard_(Español)&amp;oldid=756879</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 13 November 2022, at 06:51.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki.svg" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul></ul>
</div>
</body>
</html>
