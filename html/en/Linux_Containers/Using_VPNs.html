<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Linux Containers/Using VPNs - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.3">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Linux_Containers_Using_VPNs rootpage-Linux_Containers skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Container_setup" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Container_setup">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Container setup</div>
		</a>
		
		<ul id="toc-Container_setup-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-OpenVPN_in_server_mode" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#OpenVPN_in_server_mode">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>OpenVPN in server mode</div>
		</a>
		
			<button aria-controls="toc-OpenVPN_in_server_mode-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle OpenVPN in server mode subsection</span>
			</button>
		
		<ul id="toc-OpenVPN_in_server_mode-sublist" class="vector-toc-list">
			<li id="toc-Host_setup" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Host_setup">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Host setup</div>
			</a>
			
			<ul id="toc-Host_setup-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-OpenVPN_in_client_mode" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#OpenVPN_in_client_mode">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>OpenVPN in client mode</div>
		</a>
		
		<ul id="toc-OpenVPN_in_client_mode-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-WireGuard" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#WireGuard">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>WireGuard</div>
		</a>
		
		<ul id="toc-WireGuard-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Firewall_configuration_within_the_container" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Firewall_configuration_within_the_container">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Firewall configuration within the container</div>
		</a>
		
			<button aria-controls="toc-Firewall_configuration_within_the_container-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Firewall configuration within the container subsection</span>
			</button>
		
		<ul id="toc-Firewall_configuration_within_the_container-sublist" class="vector-toc-list">
			<li id="toc-A_hacky_work-around_for_using_a_VPN's_domain_name_in_the_profile" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#A_hacky_work-around_for_using_a_VPN's_domain_name_in_the_profile">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>A hacky work-around for using a VPN's domain name in the profile</div>
			</a>
			
			<ul id="toc-A_hacky_work-around_for_using_a_VPN's_domain_name_in_the_profile-sublist" class="vector-toc-list">
				<li id="toc-On_the_host" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#On_the_host">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.1</span>On the host</div>
			</a>
			
			<ul id="toc-On_the_host-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-From_inside_the_container" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#From_inside_the_container">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.2</span>From inside the container</div>
			</a>
			
			<ul id="toc-From_inside_the_container-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Test_the_service" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Test_the_service">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Test the service</div>
		</a>
		
		<ul id="toc-Test_the_service-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Linux Containers/Using VPNs</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Linux_Containers_%E3%81%A7_OpenVPN_%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88" title="Linux Containers で OpenVPN クライアント – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <a href="../../en/Linux_Containers.html" title="Linux Containers">Linux Containers</a>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../../en/OpenVPN.html" title="OpenVPN">OpenVPN</a></li>
<li><a href="../../en/PeerGuardian_Linux.html" title="PeerGuardian Linux">PeerGuardian Linux</a></li>
<li><a href="../../en/Uncomplicated_Firewall.html" class="mw-redirect" title="Ufw">ufw</a></li>
<li><a href="../../en/WireGuard.html" title="WireGuard">WireGuard</a></li>
</ul>
</div>
<p>This article describes how to setup a <a href="../../en/Linux_Containers.html" class="mw-redirect" title="Linux Container">Linux Container</a> to run several VPN protocols with a "kill switch" for secure/private internet use.  Doing so offers a distinct advantage over using full-blown virtualization like <a href="../../en/VirtualBox.html" title="VirtualBox">VirtualBox</a> or <a href="../../en/QEMU.html" title="QEMU">QEMU</a> in that the resource overhead is minimal by comparison and able to run on low powered devices.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Container_setup">Container setup</span></h2>
<p>Basic setup and understanding of <a href="../../en/Linux_Containers.html" title="Linux Containers">Linux Containers</a> is required.  This article assumes that readers have a base LXC setup and operational.
</p>
<h2><span class="mw-headline" id="OpenVPN_in_server_mode">OpenVPN in server mode</span></h2>
<p>This subsection details some extra setup required for serving OpenVPN in a container.  Users wanting to use a provided OpenVPN profile do not need to read this subsection.
</p>
<h3><span class="mw-headline" id="Host_setup">Host setup</span></h3>
<ol>
<li>The host OS needs a bridge ethernet setup to allow the container to run. Refer to <a href="../../en/Linux_Containers.html#Host_network_configuration" title="Linux Containers">Linux Containers#Host network configuration</a> for this.</li>
<li>One needs to enable packet forwarding.  Refer to <a href="../../en/Internet_sharing.html#Enable_packet_forwarding" title="Internet sharing">Internet sharing#Enable packet forwarding</a> for this.</li>
<li>Although not strictly required, a firewall is highly recommended.</li>
</ol>
<h2><span class="mw-headline" id="OpenVPN_in_client_mode">OpenVPN in client mode</span></h2>
<p>The container's configuration needs to be modified to use OpenVPN as follows:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/lxc/playtime/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...

## for OpenVPN
lxc.mount.entry = /dev/net dev/net none bind,create=dir
lxc.cgroup2.devices.allow = c 10:200 rwm
</pre>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openvpn">openvpn</a></span>.  If using the container to connect to a 3rd party VPN provider, simply place the config file, <code>foo.conf</code>,  in <code>/etc/openvpn/client/foo.conf</code> for use.  To verify OpenVPN functionality within the container, <a href="../../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> OpenVPN via <code>openvpn-client@foo.service</code> and once satisfied <a href="../../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> it to run at boot.
</p>
<p>For other use cases and setup, refer to <a href="../../en/OpenVPN.html" title="OpenVPN">OpenVPN</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Users running OpenVPN within an <i>unprivileged</i> container will need to create a custom systemd unit to start it within the container. In the <a href="../../en/Systemd.html#Replacement_unit_files" class="mw-redirect" title="Replacement unit file">replacement unit file</a> comment out the line beginning with: <code>LimitNPROC...</code>
</div>
<h2><span class="mw-headline" id="WireGuard">WireGuard</span></h2>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=wireguard-tools">wireguard-tools</a></span>.  Users will either have a WireGuard config supplied by a 3rd party VPN service or will be setting up WireGuard to serve in this role.  If using the container to connect to the VPN provider, simply place the config file, <code>foo.conf</code>, in <code>/etc/wireguard/</code> for use.
</p>
<p>To verify WireGuard functionality within the container, <a href="../../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> WireGuard via <code>wg-quick@foo.service</code> and once satisfied <a href="../../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> it to run at boot.
</p>
<p>For other use cases, refer to <a href="../../en/WireGuard.html" title="WireGuard">WireGuard</a>.
</p>
<h2><span class="mw-headline" id="Firewall_configuration_within_the_container">Firewall configuration within the container</span></h2>
<p>A properly configured <a href="../../en/Category:Firewalls.html" class="mw-redirect" title="Firewall">firewall</a> running within the container is <i>highly</i> recommended.  The role of the firewall within the container is two fold:
</p>
<ol>
<li>Provide a functional "kill switch" to maintain privacy should the connection to the VPN fail.</li>
<li>Keep nasty stuff out.</li>
</ol>
<p>This guide uses <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ufw">ufw</a></span> which is easy to configure, but other examples can certainly be used.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> To completely reset ufw's configuration files, call it with the reset argument: <code>ufw reset</code>.</div>
<p>The strategy of a functional "kill switch" is simply to setup a deny policy and then allow specific services and traffic on the VPN device only.  This way if that device's connection is interrupted, there is not a local fallback.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> A limitation of the method shown below is that VPN profiles must not use domain names such as www.myvpn.com, they will need to use the corresponding IP address.  As mentioned above, container DNS resolution will be disabled by design when the VPN is not connected.  Therefore in order to connect, the numerical IP must be provided.</div>
<p>Edit <code>/etc/default/ufw</code> and change the DEFAULT_OUTPUT_POLICY from "ACCEPT" to "DROP":
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/default/ufw</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">DEFAULT_OUTPUT_POLICY="DROP"</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The following commands calling <code>ufw</code> need to be executed as the root user; the "#" sign prefixing these commands per standard wiki notation has been omitted to allow for a clean copy/paste into a terminal.</div>
<p>Setup the deny policy:
</p>
<pre>ufw default deny outgoing
ufw default deny incoming
</pre>
<p>Optionally add any predefined or custom rules defined in a file such as <code>/etc/ufw/applications.d/custom</code>:
</p>
<pre>ufw allow ssh
ufw allow from my-custom-app1
ufw allow from my-custom-app2
</pre>
<p>Optionally further restrict access from the internal LAN IP range or even a single IP address:
</p>
<pre>ufw allow from 192.168.1.0/24
</pre>
<p>Users of WireGuard will have an interface created that bears the same name as the respective configuration file, for example, <code>/etc/wireguard/foo.conf</code> whereas OpenVPN users are likely using <code>tun0</code>.  In the line below, substitute 'foo' with the name of the WireGuard config (omitting the .conf suffix) or if using OpenVPN, substitute 'foo' with tun0 or with whatever device is being used:
</p>
<pre>ufw allow out on foo from any to any
</pre>
<p>Finally, allow access to the IP address of the VPN provider on the expected port and define the expected protocol.  In the line below there are three variables to consider defined as such:
</p>
<ul>
<li>'xxx' represents the IP address of the WireGuard peer/OpenVPN server.  It will be defined in the respective config file provided by the VPN provider.</li>
<li>'yyy' represents the port on which the communication is to take place.  Again, this will be in the config file.</li>
<li>'zzz' represents the protocol to be used and is selected from either udp or tcp.  Note that WireGuard only supports udp whereas OpenVPN supports either.</li>
</ul>
<pre>ufw allow out to xxx port yyy proto zzz
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Repeat this for each IP address (xxx) defined by the VPN provider if multiple servers are expected to be in use.</div>
<p>Start ufw and <a href="../../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>ufw.service</code> to start at boot.
</p>
<h3>
<span id="A_hacky_work-around_for_using_a_VPN.27s_domain_name_in_the_profile"></span><span class="mw-headline" id="A_hacky_work-around_for_using_a_VPN's_domain_name_in_the_profile">A hacky work-around for using a VPN's domain name in the profile</span>
</h3>
<p>If it is desired to use a domain name in the VPN profile, a shell script on the host can pre-resolve it to a numerical IP, and then pass that IP address to the container via storing it in a variable written to a file therein.  That file can in turn be read by a modified VPN systemd service.  It works, but is a bit hacky.
</p>
<p>Edit the two variables to match the container name and the server name corresponding to your use case:
</p>
<h4><span class="mw-headline" id="On_the_host">On the host</span></h4>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bind">bind</a></span> (needed for dig) and create the following script:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/path/to/container-start.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash
# this script should be called as root
container=foo
server=www.myvpnserver.org
 
if ! systemctl is-active lxc@"$container" &amp;&gt;/dev/null; then
  ToUse=$(dig +short "$server")
  [[ -d /var/lib/lxc/$container/rootfs/etc/conf.d ]] || mkdir -p /var/lib/lxc/$container/rootfs/etc/conf.d
  echo "SERVER=$ToUse" &gt; /var/lib/lxc/$container/rootfs/etc/conf.d/server.hack.txt
  systemctl start lxc@"$container"
fi
</pre>
<p>From now on, call that script to start the container.  It will use dig to get the IP address from the domain name and then it will start the container.
</p>
<h4><span class="mw-headline" id="From_inside_the_container">From inside the container</span></h4>
<p>Modify the systemd service starting the VPN as well as create a skeleton profile that can be modified with the IP address defined in <code>/var/lib/lxc/$container/rootfs/etc/conf.d/server.hack.txt</code> by the script we just created.
</p>
<p>To make a skeleton config file, simply rename the live one to another name.
</p>
<p>For example using WireGuard:
</p>
<pre>mv /etc/wireguard/foo.conf /etc/wireguard/foo.skel
</pre>
<p>Now edit <code>/etc/wireguard/foo.skel</code> to substitute the <b>Endpoint = www.myvpnserver.org</b> to <b>@@@</b>, for example:
</p>
<pre>Endpoint = @@@:51820
</pre>
<p>Or if using OpenVPN:
</p>
<pre>mv /etc/openvpn/client/foo.conf /etc/openvpn/client/foo.skel
</pre>
<p>Edit <code>/etc/openvpn/client/foo.skel</code> to substitute the remote <b>www.myvpnserver.org</b> to <b>@@@</b>, for example:
</p>
<pre>remote @@@
</pre>
<p>Finally, create a <a href="../../en/Systemd.html#Drop-in_files" class="mw-redirect" title="Drop-in file">drop-in file</a>, to read in the IP and to substitute it for the actual profile. 
</p>
<p>Example using WireGuard:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/wg-quick@foo.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
EnvironmentFile=-/etc/conf.d/server.hack.txt
ExecStartPre=/bin/bash -ac "sed s/@@@/$SERVER/ &lt;/etc/wireguard/foo.skel &gt;/etc/wireguard/foo.conf"</pre>
<p>Example using OpenVPN:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/openvpn-client@foo.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
EnvironmentFile=-/etc/conf.d/server.hack.txt
ExecStartPre=/bin/bash -ac "sed s/@@@/$SERVER/ &lt;/etc/openvpn/client/foo.skel &gt;/etc/openvpn/client/foo.conf"</pre>
<h2><span class="mw-headline" id="Test_the_service">Test the service</span></h2>
<p>From within the running container, (connected via ssh or via <code>lxc-attach -n playtime</code>) test the setup by exporting a browser to the host's machine X server:
</p>
<pre>$ DISPLAY=:0 firefox
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Connecting over ssh will require allowing the local display to accept connections.  Do so via <code>xhost +SI:localuser:yourusername</code> and then connect via ssh to the container.</div>
<p>The result should be a firefox window in the host's X server with the title, "Mozilla Firefox (playtime)."  A number of websites can be used to verify IP address and status of DNS entries.  Once such site is <a rel="nofollow" class="external text" href="https://ipleak.net">ipleak dot net</a>.
</p>
<p>At this point, only a the DNS entry/entries corresponding to those defined in the profile should be displayed.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../../en/Category:Virtual_Private_Network.html" title="Category:Virtual Private Network">Virtual Private Network</a></li>
<li><a href="../../en/Category:Virtualization.html" title="Category:Virtualization">Virtualization</a></li>
</ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Linux_Containers/Using_VPNs&amp;oldid=815374">https://wiki.archlinux.org/index.php?title=Linux_Containers/Using_VPNs&amp;oldid=815374</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 25 August 2024, at 16:22.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
