<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Unified Extensible Firmware Interface - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Unified_Extensible_Firmware_Interface rootpage-Unified_Extensible_Firmware_Interface skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-UEFI_versions" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#UEFI_versions">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>UEFI versions</div>
		</a>
		
		<ul id="toc-UEFI_versions-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-UEFI_firmware_bitness" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#UEFI_firmware_bitness">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>UEFI firmware bitness</div>
		</a>
		
			<button aria-controls="toc-UEFI_firmware_bitness-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle UEFI firmware bitness subsection</span>
			</button>
		
		<ul id="toc-UEFI_firmware_bitness-sublist" class="vector-toc-list">
			<li id="toc-Checking_the_firmware_bitness" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Checking_the_firmware_bitness">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Checking the firmware bitness</div>
			</a>
			
			<ul id="toc-Checking_the_firmware_bitness-sublist" class="vector-toc-list">
				<li id="toc-From_Linux" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#From_Linux">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.1</span>From Linux</div>
			</a>
			
			<ul id="toc-From_Linux-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-From_macOS" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#From_macOS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.2</span>From macOS</div>
			</a>
			
			<ul id="toc-From_macOS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-From_Microsoft_Windows" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#From_Microsoft_Windows">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.3</span>From Microsoft Windows</div>
			</a>
			
			<ul id="toc-From_Microsoft_Windows-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Linux_kernel_configuration_options_for_UEFI" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Linux_kernel_configuration_options_for_UEFI">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Linux kernel configuration options for UEFI</div>
		</a>
		
		<ul id="toc-Linux_kernel_configuration_options_for_UEFI-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-UEFI_variables" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#UEFI_variables">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>UEFI variables</div>
		</a>
		
			<button aria-controls="toc-UEFI_variables-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle UEFI variables subsection</span>
			</button>
		
		<ul id="toc-UEFI_variables-sublist" class="vector-toc-list">
			<li id="toc-UEFI_variables_support_in_Linux_kernel" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#UEFI_variables_support_in_Linux_kernel">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>UEFI variables support in Linux kernel</div>
			</a>
			
			<ul id="toc-UEFI_variables_support_in_Linux_kernel-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Requirements_for_UEFI_variable_support" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Requirements_for_UEFI_variable_support">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Requirements for UEFI variable support</div>
			</a>
			
			<ul id="toc-Requirements_for_UEFI_variable_support-sublist" class="vector-toc-list">
				<li id="toc-Mount_efivarfs" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Mount_efivarfs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.1</span>Mount efivarfs</div>
			</a>
			
			<ul id="toc-Mount_efivarfs-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Userspace_tools" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Userspace_tools">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Userspace tools</div>
			</a>
			
			<ul id="toc-Userspace_tools-sublist" class="vector-toc-list">
				<li id="toc-efibootmgr" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#efibootmgr">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3.1</span>efibootmgr</div>
			</a>
			
			<ul id="toc-efibootmgr-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Disable_UEFI_variable_access" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Disable_UEFI_variable_access">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>Disable UEFI variable access</div>
			</a>
			
			<ul id="toc-Disable_UEFI_variable_access-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-UEFI_Shell" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#UEFI_Shell">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>UEFI Shell</div>
		</a>
		
			<button aria-controls="toc-UEFI_Shell-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle UEFI Shell subsection</span>
			</button>
		
		<ul id="toc-UEFI_Shell-sublist" class="vector-toc-list">
			<li id="toc-Obtaining_UEFI_Shell" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Obtaining_UEFI_Shell">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Obtaining UEFI Shell</div>
			</a>
			
			<ul id="toc-Obtaining_UEFI_Shell-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Launching_UEFI_Shell" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Launching_UEFI_Shell">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Launching UEFI Shell</div>
			</a>
			
			<ul id="toc-Launching_UEFI_Shell-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Important_UEFI_Shell_commands" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Important_UEFI_Shell_commands">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Important UEFI Shell commands</div>
			</a>
			
			<ul id="toc-Important_UEFI_Shell_commands-sublist" class="vector-toc-list">
				<li id="toc-bcfg" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#bcfg">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.1</span>bcfg</div>
			</a>
			
			<ul id="toc-bcfg-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-map" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#map">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.2</span>map</div>
			</a>
			
			<ul id="toc-map-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-edit" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#edit">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.3</span>edit</div>
			</a>
			
			<ul id="toc-edit-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-UEFI_drivers" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#UEFI_drivers">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>UEFI drivers</div>
		</a>
		
		<ul id="toc-UEFI_drivers-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-UEFI_bootable_media" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#UEFI_bootable_media">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>UEFI bootable media</div>
		</a>
		
			<button aria-controls="toc-UEFI_bootable_media-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle UEFI bootable media subsection</span>
			</button>
		
		<ul id="toc-UEFI_bootable_media-sublist" class="vector-toc-list">
			<li id="toc-Create_UEFI_bootable_USB_from_ISO" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Create_UEFI_bootable_USB_from_ISO">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1</span>Create UEFI bootable USB from ISO</div>
			</a>
			
			<ul id="toc-Create_UEFI_bootable_USB_from_ISO-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Remove_UEFI_boot_support_from_optical_media" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Remove_UEFI_boot_support_from_optical_media">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2</span>Remove UEFI boot support from optical media</div>
			</a>
			
			<ul id="toc-Remove_UEFI_boot_support_from_optical_media-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Testing_UEFI_in_systems_without_native_support" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Testing_UEFI_in_systems_without_native_support">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>Testing UEFI in systems without native support</div>
		</a>
		
			<button aria-controls="toc-Testing_UEFI_in_systems_without_native_support-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Testing UEFI in systems without native support subsection</span>
			</button>
		
		<ul id="toc-Testing_UEFI_in_systems_without_native_support-sublist" class="vector-toc-list">
			<li id="toc-OVMF_for_virtual_machines" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#OVMF_for_virtual_machines">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.1</span>OVMF for virtual machines</div>
			</a>
			
			<ul id="toc-OVMF_for_virtual_machines-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-DUET_for_BIOS_only_systems" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#DUET_for_BIOS_only_systems">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.2</span>DUET for BIOS only systems</div>
			</a>
			
			<ul id="toc-DUET_for_BIOS_only_systems-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">9</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Boot_back_to_Arch_Linux_when_stuck_with_Windows" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Boot_back_to_Arch_Linux_when_stuck_with_Windows">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.1</span>Boot back to Arch Linux when stuck with Windows</div>
			</a>
			
			<ul id="toc-Boot_back_to_Arch_Linux_when_stuck_with_Windows-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enter_firmware_setup_without_function_keys" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enter_firmware_setup_without_function_keys">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.2</span>Enter firmware setup without function keys</div>
			</a>
			
			<ul id="toc-Enter_firmware_setup_without_function_keys-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Userspace_tools_are_unable_to_modify_UEFI_variable_data" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Userspace_tools_are_unable_to_modify_UEFI_variable_data">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.3</span>Userspace tools are unable to modify UEFI variable data</div>
			</a>
			
			<ul id="toc-Userspace_tools_are_unable_to_modify_UEFI_variable_data-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Cannot_create_a_new_boot_entry_with_efibootmgr" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Cannot_create_a_new_boot_entry_with_efibootmgr">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.4</span>Cannot create a new boot entry with efibootmgr</div>
			</a>
			
			<ul id="toc-Cannot_create_a_new_boot_entry_with_efibootmgr-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Windows_changes_boot_order" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Windows_changes_boot_order">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.5</span>Windows changes boot order</div>
			</a>
			
			<ul id="toc-Windows_changes_boot_order-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-USB_media_gets_struck_with_black_screen" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#USB_media_gets_struck_with_black_screen">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.6</span>USB media gets struck with black screen</div>
			</a>
			
			<ul id="toc-USB_media_gets_struck_with_black_screen-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-UEFI_boot_loader_does_not_show_up_in_firmware_menu" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#UEFI_boot_loader_does_not_show_up_in_firmware_menu">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.7</span>UEFI boot loader does not show up in firmware menu</div>
			</a>
			
			<ul id="toc-UEFI_boot_loader_does_not_show_up_in_firmware_menu-sublist" class="vector-toc-list">
				<li id="toc-Default_boot_path_for_removable_drives" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Default_boot_path_for_removable_drives">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.7.1</span>Default boot path for removable drives</div>
			</a>
			
			<ul id="toc-Default_boot_path_for_removable_drives-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Microsoft_Windows_boot_loader_location" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Microsoft_Windows_boot_loader_location">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.7.2</span>Microsoft Windows boot loader location</div>
			</a>
			
			<ul id="toc-Microsoft_Windows_boot_loader_location-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Boot_entries_created_with_efibootmgr_fail_to_show_up_in_UEFI" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Boot_entries_created_with_efibootmgr_fail_to_show_up_in_UEFI">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.8</span>Boot entries created with efibootmgr fail to show up in UEFI</div>
			</a>
			
			<ul id="toc-Boot_entries_created_with_efibootmgr_fail_to_show_up_in_UEFI-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-UEFI_boot_entry_disappears_after_removing_its_referenced_drive" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#UEFI_boot_entry_disappears_after_removing_its_referenced_drive">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.9</span>UEFI boot entry disappears after removing its referenced drive</div>
			</a>
			
			<ul id="toc-UEFI_boot_entry_disappears_after_removing_its_referenced_drive-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Boot_entries_are_randomly_removed" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Boot_entries_are_randomly_removed">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.10</span>Boot entries are randomly removed</div>
			</a>
			
			<ul id="toc-Boot_entries_are_randomly_removed-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">10</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Unified Extensible Firmware Interface</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 4 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-4" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">4 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/Unified_Extensible_Firmware_Interface.html" title="Unified Extensible Firmware Interface – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Unified_Extensible_Firmware_Interface" title="Unified Extensible Firmware Interface – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Unified_Extensible_Firmware_Interface.html" title="Unified Extensible Firmware Interface – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Unified_Extensible_Firmware_Interface" title="Unified Extensible Firmware Interface – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a></li>
<li><a href="../en/Arch_boot_process.html" title="Arch boot process">Arch boot process</a></li>
<li><a href="../en/Partitioning.html#GUID_Partition_Table" class="mw-redirect" title="GUID Partition Table">GUID Partition Table</a></li>
<li><a href="../en/Unified_Extensible_Firmware_Interface/Secure_Boot.html" class="mw-redirect" title="Secure Boot">Secure Boot</a></li>
<li><a href="../en/Unified_kernel_image.html" title="Unified kernel image">Unified kernel image</a></li>
</ul>
</div>
<p>The <a rel="nofollow" class="external text" href="https://www.uefi.org/">Unified Extensible Firmware Interface</a> (UEFI, successor of the EFI) is an interface between operating systems and firmware. It provides a standard environment for booting an operating system and running pre-boot applications.
</p>
<p>It is distinct from the "<a href="../en/Partitioning.html#Master_Boot_Record_(bootstrap_code)" title="Partitioning">MBR boot code</a>" method that was used by legacy <a href="https://en.wikipedia.org/wiki/BIOS" class="extiw" title="wikipedia:BIOS">BIOS</a> systems. See <a href="../en/Arch_boot_process.html" title="Arch boot process">Arch boot process</a> for their differences and the boot process using UEFI. To set up UEFI boot loaders, see <a href="../en/Arch_boot_process.html#Boot_loader" title="Arch boot process">Arch boot process#Boot loader</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Early vendor UEFI implementations may carry more bugs than their BIOS counterparts. Consider using legacy BIOS booting for such systems if you encounter unsolvable issues.</div>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="UEFI_versions">UEFI versions</span></h2>
<ul>
<li>UEFI started as Intel's EFI in versions 1.x.</li>
<li>Later, a group of companies called the UEFI Forum took over its development, which renamed it as Unified EFI starting with version 2.0.</li>
<li>Unless specified as EFI 1.x, EFI and UEFI terms are used interchangeably to denote UEFI 2.x firmware.</li>
<li>Apple's EFI implementation is neither an EFI 1.x version nor UEFI 2.x version but mixes up both. This kind of firmware does not fall under any one (U)EFI specification and therefore is not a standard UEFI firmware. Unless stated explicitly, these instructions are general and some of them may not work or may be different in <a href="../en/Mac.html" title="Mac">Apple Macs</a>.</li>
</ul>
<p>The latest UEFI specification can be found at <a rel="nofollow" class="external free" href="https://uefi.org/specifications">https://uefi.org/specifications</a>.
</p>
<h2><span class="mw-headline" id="UEFI_firmware_bitness">UEFI firmware bitness</span></h2>
<p>Under UEFI, every program whether it is an operating system loader or a utility (e.g. a memory testing or recovery tool), should be an EFI application corresponding to the UEFI firmware bitness/architecture.
</p>
<p>The vast majority of x86_64 systems, including recent Apple Macs, use x64 (64-bit) UEFI firmware. The only known devices that use IA32 (32-bit) UEFI are older (pre 2008) Apple Macs, Intel Atom System-on-Chip systems (as on 2 November 2013)<a rel="nofollow" class="external autonumber" href="https://web.archive.org/web/20201224150025/https://software.intel.com/content/www/us/en/develop/blogs/why-cheap-systems-run-32-bit-uefi-on-x64-systems.html">[1]</a> and some older Intel server boards that are known to operate on Intel EFI 1.10 firmware.
</p>
<p>An x64 UEFI firmware does not include support for launching 32-bit EFI applications (unlike x86_64 Linux and Windows versions which include such support). Therefore the EFI application must be compiled for that specific firmware processor bitness/architecture.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Systems with IA32 UEFI require using a boot loader that supports mixed mode booting. For example, <a href="../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a> or <a href="../en/GRUB.html" title="GRUB">GRUB</a> (installed with the <code>i386-efi</code> target).</div>
<h3><span class="mw-headline" id="Checking_the_firmware_bitness">Checking the firmware bitness</span></h3>
<p>The firmware bitness can be checked from a booted operating system.
</p>
<h4><span class="mw-headline" id="From_Linux">From Linux</span></h4>
<p>On distributions running Linux kernel 4.0 or newer, the UEFI firmware bitness can be found via the sysfs interface. Run:
</p>
<pre>$ cat /sys/firmware/efi/fw_platform_size
</pre>
<p>It will return <code>64</code> for a 64-bit (x64) UEFI or <code>32</code> for a 32-bit (IA32) UEFI. If the file does not exist, then you have not <a href="../en/Installation_guide.html#Verify_the_boot_mode" title="Installation guide">booted in UEFI mode</a>.
</p>
<h4><span class="mw-headline" id="From_macOS">From macOS</span></h4>
<p>Pre-2008 <a href="../en/Mac.html" title="Mac">Macs</a> mostly have IA32 EFI firmware while &gt;=2008 Macs have mostly x64 EFI. All Macs capable of running Mac OS X Snow Leopard 64-bit Kernel have x64 EFI 1.x firmware.
</p>
<p>To find out the arch of the EFI firmware in a Mac, type the following into the Mac OS X terminal:
</p>
<pre>$ ioreg -l -p IODeviceTree | grep firmware-abi
</pre>
<p>If the command returns <code>EFI32</code> then it is IA32 (32-bit) EFI firmware. If it returns <code>EFI64</code> then it is x64 EFI firmware. Most of the Macs do not have UEFI 2.x firmware as Apple's EFI implementation is not fully compliant with UEFI 2.x specification.
</p>
<h4><span class="mw-headline" id="From_Microsoft_Windows">From Microsoft Windows</span></h4>
<p>64-bit versions of Windows do not support booting on a 32-bit UEFI. So, if you have a 32-bit version of Windows booted in UEFI mode, you have a 32-bit UEFI.
</p>
<p>To check the bitness run <code>msinfo32.exe</code>. In the <i>System Summary</i> section look at the values of "System Type" and "BIOS mode".
</p>
<p>For a 64-bit Windows on a 64-bit UEFI it will be <code>System Type: x64-based PC</code> and <code>BIOS mode: UEFI</code>, for a 32-bit Windows on a 32-bit UEFI - <code>System Type: x86-based PC</code> and <code>BIOS mode: UEFI</code>. If the "BIOS mode" is not <code>UEFI</code>, then Windows is not booted in UEFI mode.
</p>
<h2><span class="mw-headline" id="Linux_kernel_configuration_options_for_UEFI">Linux kernel configuration options for UEFI</span></h2>
<p>The required Linux Kernel configuration options<a rel="nofollow" class="external autonumber" href="https://docs.kernel.org/arch/x86/x86_64/uefi.html">[2]</a> for UEFI systems are:
</p>
<pre>CONFIG_RELOCATABLE=y
CONFIG_EFI=y
CONFIG_EFI_STUB=y
CONFIG_X86_SYSFB=y
CONFIG_FB_SIMPLE=y
CONFIG_FRAMEBUFFER_CONSOLE=y
</pre>
<p>UEFI Runtime Variables Support (<b>efivarfs</b> filesystem - <code>/sys/firmware/efi/efivars</code>). This option is important as this is required to manipulate UEFI runtime variables using tools like <a href="#efibootmgr">efibootmgr</a>. The configuration option below has been added in kernel 3.10 and later.
</p>
<pre>CONFIG_EFIVAR_FS=y
</pre>
<p><a href="../en/Partitioning.html#GUID_Partition_Table" class="mw-redirect" title="GUID Partition Table">GUID Partition Table</a> (GPT) configuration option - mandatory for UEFI support
</p>
<pre>CONFIG_EFI_PARTITION=y
</pre>
<p>EFI mixed-mode support - to boot a x86_64 kernel on a IA32 UEFI.
</p>
<pre>CONFIG_EFI_MIXED=y
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> All of the above options are set accordingly in all <a href="../en/Kernel.html#Officially_supported_kernels" title="Kernel">officially supported kernels</a>.</div>
<h2><span class="mw-headline" id="UEFI_variables">UEFI variables</span></h2>
<p>UEFI defines variables through which an operating system can interact with the firmware. UEFI boot variables are used by the boot loader and used by the operating system only for early system start-up. UEFI runtime variables allow an operating system to manage certain settings of the firmware like the UEFI boot manager or managing the keys for UEFI Secure Boot protocol etc. You can get the list using:
</p>
<pre>$ efivar --list
</pre>
<h3><span class="mw-headline" id="UEFI_variables_support_in_Linux_kernel">UEFI variables support in Linux kernel</span></h3>
<p>Linux kernel exposes UEFI variables data to userspace via <b>efivarfs</b> (<b>EFI</b> <b>VAR</b>iable <b>F</b>ile<b>S</b>ystem) interface (<code>CONFIG_EFIVAR_FS</code>) - mounted using <code>efivarfs</code> kernel module at <code>/sys/firmware/efi/efivars</code> - it has no maximum per-variable size limitation and supports UEFI Secure Boot variables. Introduced in kernel 3.8.
</p>
<h3><span class="mw-headline" id="Requirements_for_UEFI_variable_support">Requirements for UEFI variable support</span></h3>
<ol>
<li>Kernel should be booted in UEFI mode via <a href="../en/EFISTUB.html" title="EFISTUB">EFISTUB</a> (optionally using a <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot manager">boot manager</a>) or by a UEFI <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a>, not via BIOS or CSM, or Apple's Boot Camp which is also a CSM.</li>
<li>EFI Runtime Services support should be present in the kernel (<code>CONFIG_EFI=y</code>, check if present with <code>zgrep CONFIG_EFI /proc/config.gz</code>).</li>
<li>EFI Runtime Services in the kernel SHOULD NOT be disabled via the <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel command line">kernel command line</a>, i.e. <code>noefi</code> kernel parameter SHOULD NOT be used.</li>
<li>
<code>efivarfs</code> filesystem should be mounted at <code>/sys/firmware/efi/efivars</code>, otherwise follow <a href="#Mount_efivarfs">#Mount efivarfs</a> section below.</li>
<li>
<code>efivar</code> should list (option <code>-l</code>/<code>--list</code>) the UEFI variables without any error.</li>
</ol>
<p>If UEFI Variables support does not work even after the above conditions are satisfied, try the below workarounds:
</p>
<ol>
<li>If listing of the UEFI variables (<code>efivar -l</code>) leads to <code>efivar: error listing variables: Function not implemented</code> and the system is booted into a <a href="../en/Realtime_kernel_patchset.html" class="mw-redirect" title="Realtime kernel">realtime kernel</a>, add <code>efi=runtime</code> to the <a href="../en/Kernel_parameters.html" title="Kernel parameters">kernel parameters</a> and reboot (efivarfs functionality is disabled by default on those kernels).</li>
<li>See <a href="#Userspace_tools_are_unable_to_modify_UEFI_variable_data">#Userspace tools are unable to modify UEFI variable data</a> for more troubleshooting steps</li>
</ol>
<h4><span class="mw-headline" id="Mount_efivarfs">Mount efivarfs</span></h4>
<p>If <code>efivarfs</code> is not automatically mounted at <code>/sys/firmware/efi/efivars</code> by <a href="../en/Systemd.html" title="Systemd">systemd</a> during boot, then you need to manually mount it to expose UEFI variables to <a href="#Userspace_tools">userspace tools</a> like <i>efibootmgr</i>:
</p>
<pre># mount -t efivarfs efivarfs /sys/firmware/efi/efivars
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The above command should be run <b>both <i>outside</i></b> (i.e. before) <b>and <i>inside</i></b> the <a href="../en/Chroot.html" title="Chroot">chroot</a>, if any.</div>
<p>See <a rel="nofollow" class="external text" href="https://docs.kernel.org/filesystems/efivarfs.html">efivarfs.html</a> for kernel documentation.
</p>
<h3><span class="mw-headline" id="Userspace_tools">Userspace tools</span></h3>
<p>There are few tools that can access/modify the UEFI variables, namely
</p>
<ul><li>
<b>efivar</b> — Library and Tool to manipulate UEFI variables (used by efibootmgr)</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/rhboot/efivar">https://github.com/rhboot/efivar</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=efivar">efivar</a></span>
</dd></dl>
<ul><li>
<b>efibootmgr</b> — Tool to manipulate UEFI Firmware Boot Manager Settings</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/rhboot/efibootmgr">https://github.com/rhboot/efibootmgr</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=efibootmgr">efibootmgr</a></span>
</dd></dl>
<ul><li>
<b>uefivars</b> — Dumps list of UEFI variables with some additional PCI related info (uses efibootmgr code internally)</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/fpmurphy/Various/tree/master/uefivars-2.0">https://github.com/fpmurphy/Various/tree/master/uefivars-2.0</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/uefivars-git/">uefivars-git</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>efitools</b> — Tools for manipulating UEFI secure boot platforms</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://git.kernel.org/pub/scm/linux/kernel/git/jejb/efitools.git">https://git.kernel.org/pub/scm/linux/kernel/git/jejb/efitools.git</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=efitools">efitools</a></span>
</dd></dl>
<ul><li>
<b>Ubuntu's Firmware Test Suite</b> — Test suite that performs sanity checks on Intel/AMD PC firmware</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://wiki.ubuntu.com/FirmwareTestSuite/">https://wiki.ubuntu.com/FirmwareTestSuite/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/fwts-git/">fwts-git</a></span><sup><small>AUR</small></sup>
</dd></dl>
<h4><span class="mw-headline" id="efibootmgr">efibootmgr</span></h4>
<p>You will have to <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=efibootmgr">efibootmgr</a></span> package.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>If <i>efibootmgr</i> does not work on your system, you can reboot into <a href="#UEFI_Shell">#UEFI Shell</a> and use <code>bcfg</code> to create a boot entry for the bootloader.</li>
<li>If you are unable to use <code>efibootmgr</code>, some UEFI firmwares allow users to directly manage UEFI boot entries from within its boot-time interface.  For example, some firmwares have an "Add New Boot Option" choice which enables you to select a local EFI system partition and manually enter the EFI application location e.g. <code>\EFI\refind\refind_x64.efi</code>.</li>
<li>The below commands use <a href="../en/REFInd.html" title="REFInd">rEFInd</a> boot manager as example.</li>
</ul>
</div>
<p>To add a new boot option using <i>efibootmgr</i>, you need to know three things:
</p>
<ol>
<li>The disk containing the <a href="../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a> (ESP). E.g.: <code>/dev/sda</code>, <code>/dev/nvme0n1</code>.</li>
<li>The partition number of the ESP on that disk. The <code><i>Y</i></code> in <code>/dev/sda<i>Y</i></code> or <code>/dev/nvme0n1p<i>Y</i></code>.</li>
<li>The path to the EFI application (relative to the root of the ESP)</li>
</ol>
<p>For example, if you want to add a boot option for <code>/efi/EFI/refind/refind_x64.efi</code> where <code>/efi</code> is the mount point of the ESP, run
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ findmnt /efi</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">TARGET SOURCE    FSTYPE OPTIONS
/efi   /dev/sda1 vfat   rw,flush,tz=UTC</pre>
<p>In this example, <span class="plainlinks archwiki-template-man" title="$ man 8 findmnt"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/findmnt.8">findmnt(8)</a></span> indicates that the ESP is on disk <code>/dev/sda</code> and has partition number 1. The path to the EFI application relative to the root of the ESP is <code>/EFI/refind/refind_x64.efi</code>. So you would create the boot entry as follows:
</p>
<pre># efibootmgr --create --disk /dev/sda --part 1 --loader '\EFI\refind\refind_x64.efi' --label 'rEFInd Boot Manager' --unicode
</pre>
<p>Get an overview of all boot entries:
</p>
<pre># efibootmgr --unicode
</pre>
<p>To set the boot order:
</p>
<pre># efibootmgr --bootorder <i>XXXX</i>,<i>XXXX</i> --unicode
</pre>
<p>Where <i>XXXX</i> is the number that appears in the previous output of <i>efibootmgr</i> command.
</p>
<p>Delete an unwanted entry:
</p>
<pre># efibootmgr --delete-bootnum --bootnum <i>XXXX</i> --unicode
</pre>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 8 efibootmgr"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/efibootmgr.8">efibootmgr(8)</a></span> or <a rel="nofollow" class="external text" href="https://raw.githubusercontent.com/rhinstaller/efibootmgr/master/README">efibootmgr README</a> for more info.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> UEFI specification uses backward slash <code>\</code> as path separator but <i>efibootmgr</i> can automatically convert UNIX-style <code>/</code> path separators.</div>
<h3><span class="mw-headline" id="Disable_UEFI_variable_access">Disable UEFI variable access</span></h3>
<p>Access to the UEFI can potentially cause harm beyond the running operating system level. There are dangerous UEFI exploits like <a rel="nofollow" class="external text" href="https://binarly.io/posts/finding_logofail_the_dangers_of_image_parsing_during_system_boot/index.html">LogoFAIL</a> which allows a malicious actor to take full control over the machine. Even hardware-level bricking is possible in some cases of poor UEFI implementation <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/2402#issuecomment-176806817">[3]</a>.
</p>
<p>So, as the UEFI variables access is not required for daily system usage, you may want to disable it, to avoid potential security breaches or accidental harm.
</p>
<p>Possible solutions are:
</p>
<ul>
<li>Mount <code>efivars</code> in read-only mode using <a href="../en/Fstab.html" title="Fstab">fstab</a>. For example: <pre>efivarfs /sys/firmware/efi/efivars efivarfs ro,nosuid,nodev,noexec 0 0</pre>
</li>
<li>Use the <code>noefi</code> <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> to completely disable OS access to UEFI.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> UEFI <a href="#Userspace_tools">userspace tools</a> cannot be used with a such setup, so perform the all necessary configurations before. Also UEFI-related commands (e.g. <code>systemctl reboot --firmware-setup</code>) will not work either.</div>
<h2><span class="mw-headline" id="UEFI_Shell">UEFI Shell</span></h2>
<p>The UEFI Shell is a shell/terminal for the firmware which allows launching EFI applications which include UEFI bootloaders. Apart from that, the shell can also be used to obtain various other information about the system or the firmware like memory map (memmap), modifying boot manager variables (bcfg), running partitioning programs (diskpart), loading UEFI drivers, editing text files (edit), hexedit etc.
</p>
<h3><span class="mw-headline" id="Obtaining_UEFI_Shell">Obtaining UEFI Shell</span></h3>
<p>You can obtain a BSD licensed UEFI Shell from the TianoCore EDK2 project:
</p>
<ul>
<li>Shell v2:
<ul>
<li>On the Arch install medium: <code>/shellx64.efi</code>. A copy of <code>/usr/share/edk2-shell/x64/Shell_Full.efi</code> from the time the ISO was built.</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=edk2-shell">edk2-shell</a></span> provides x64 Shell for x64 (64-bit) UEFI and IA32 Shell for IA32 (32-bit) UEFI - compiled directly from latest TianoCore EDK2 release.</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/uefi-shell-git/">uefi-shell-git</a></span><sup><small>AUR</small></sup> provides x64 Shell for x64 (64-bit) UEFI and IA32 Shell for IA32 (32-bit) UEFI - compiled directly from latest TianoCore EDK2 source.</li>
</ul>
</li>
<li>Shell v1:
<ul><li>
<a rel="nofollow" class="external text" href="https://github.com/tianocore/edk2/tree/UDK2018/EdkShellBinPkg">Precompiled UEFI Shell v1 binaries</a> from TianoCore (not updated anymore upstream as of Jan 10, 2014).</li></ul>
</li>
<li>Patched shells:
<ul>
<li>
<a rel="nofollow" class="external text" href="https://drive.google.com/uc?export=download&amp;id=1OBXYj6MEs7VAZbYnjD9FxOYcZYIQoq36">Precompiled UEFI Shell v2 binary with bcfg modified to work with UEFI pre-2.3 firmware</a><sup title="Last check status: 403">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2023-07-30 ⓘ]</sup> - from Clover EFI bootloader.</li>
<li>
<a rel="nofollow" class="external text" href="https://github.com/acidanthera/OpenCorePkg/releases">Precompiled UEFI Shell v2 binary for compatibility with a broad range of firmwares</a> - from the OpenCore bootloader. In the release archive: <code>EFI/OC/Tools/OpenShell.efi</code>.</li>
</ul>
</li>
</ul>
<p>Shell v2 works best in UEFI 2.3+ systems and is recommended over Shell v1 in those systems. Shell v1 should work in all UEFI systems irrespective of the spec. version the firmware follows. More information at <a rel="nofollow" class="external text" href="https://github.com/tianocore/tianocore.github.io/wiki/ShellPkg">ShellPkg</a> and the EDK2 mailing list thread—<a rel="nofollow" class="external text" href="https://edk2-devel.narkive.com/zCN4CEnb/inclusion-of-uefi-shell-in-linux-distro-iso">Inclusion of UEFI shell in Linux distro iso</a>.
</p>
<h3><span class="mw-headline" id="Launching_UEFI_Shell">Launching UEFI Shell</span></h3>
<p>Few Asus and other AMI Aptio x64 UEFI firmware based motherboards (from Sandy Bridge onwards) provide an option called <i>Launch EFI Shell from filesystem device</i>. For those motherboards, copy the x64 UEFI Shell to the root of your EFI system partition, named as <code>shellx64.efi</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>The Arch Linux installation medium has <code>shellx64.efi</code> at the root of the volume.</li>
<li>
<a href="../en/REFInd.html" title="REFInd">rEFInd</a> and <a href="../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a> will automatically add a boot menu entry for the UEFI shell if <code>shellx64.efi</code> is in the root of the EFI system partition.</li>
</ul>
</div>
<p>Systems with Phoenix SecureCore Tiano UEFI firmware is known to have embedded UEFI Shell which can be launched using either <code>F6</code>, <code>F11</code> or <code>F12</code> key.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you are unable to launch UEFI Shell from the firmware directly using any of the above mentioned methods, create a <a href="../en/FAT.html" class="mw-redirect" title="FAT32">FAT32</a> USB pen drive with the EFI binary copied as <code><i>/USB_drive_mointpoint</i>/EFI/BOOT/BOOTx64.EFI</code>. This USB should come up in the firmware boot menu. Launching this option will launch the UEFI Shell for you.</div>
<h3><span class="mw-headline" id="Important_UEFI_Shell_commands">Important UEFI Shell commands</span></h3>
<p>UEFI Shell commands usually support <code>-b</code> option which makes output pause after each page. Run <code>help -b</code> to list available internal commands. Available commands are either built into the shell or discrete EFI applications.
</p>
<p>For more info see <a rel="nofollow" class="external text" href="https://software.intel.com/en-us/articles/efi-shells-and-scripting/">Intel Scripting Guide 2008</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2023-07-30 ⓘ]</sup> and <a rel="nofollow" class="external text" href="https://software.intel.com/en-us/articles/uefi-shell">Intel "Course" 2011</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2023-07-30 ⓘ]</sup>.
</p>
<h4><span class="mw-headline" id="bcfg">bcfg</span></h4>
<p><code>bcfg</code> modifies the UEFI NVRAM entries which allows the user to change the boot entries or driver options. This command is described in detail in page 96 (Section 5.3) of the <a rel="nofollow" class="external text" href="https://uefi.org/sites/default/files/resources/UEFI_Shell_2_2.pdf">UEFI Shell Specification 2.2</a> document.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Try <code>bcfg</code> only if <code>efibootmgr</code> fails to create working boot entries on your system.</li>
<li>UEFI Shell v1 official binary does not support <code>bcfg</code> command. See <a href="#Obtaining_UEFI_Shell">#Obtaining UEFI Shell</a> for a modified UEFI Shell v2 binary which may work in UEFI pre-2.3 firmwares.</li>
</ul>
</div>
<p>To dump a list of current boot entries:
</p>
<pre>Shell&gt; bcfg boot dump -v
</pre>
<p>To add a boot menu entry for rEFInd (for example) as 4th (numbering starts from zero) option in the boot menu:
</p>
<pre>Shell&gt; bcfg boot add 3 FS0:\EFI\refind\refind_x64.efi "rEFInd Boot Manager"
</pre>
<p>where <code>FS0:</code> is the mapping corresponding to the EFI system partition and <code>FS0:\EFI\refind\refind_x64.efi</code> is the file to be launched.
</p>
<p>To add an entry to boot directly into your system without a bootloader, configure a boot option using your kernel as an <a href="../en/EFISTUB.html#bcfg" title="EFISTUB">EFISTUB</a>:
</p>
<pre>Shell&gt; bcfg boot add <b>N</b> fs<b>V</b>:\vmlinuz-linux "Arch Linux"
Shell&gt; bcfg boot -opt <b>N</b> "root=<b>/dev/sdX#</b> initrd=\initramfs-linux.img"
</pre>
<p>where <code>N</code> is the priority, <code>V</code> is the volume number of your EFI system partition, and <code>/dev/sdX#</code> is your root partition.
</p>
<p>To remove the 4th boot option:
</p>
<pre>Shell&gt; bcfg boot rm 3
</pre>
<p>To move the boot option #3 to #0 (i.e. 1st or the default entry in the UEFI Boot menu):
</p>
<pre>Shell&gt; bcfg boot mv 3 0
</pre>
<p>For bcfg help text:
</p>
<pre>Shell&gt; help bcfg -v -b
</pre>
<p>or:
</p>
<pre>Shell&gt; bcfg -? -v -b
</pre>
<h4><span class="mw-headline" id="map">map</span></h4>
<p><code>map</code> displays a list of device mappings i.e. the names of available file systems (<code>FS0</code>) and storage devices (<code>blk0</code>).
</p>
<p>Before running file system commands such as <code>cd</code> or <code>ls</code>, you need to change the shell to the appropriate file system by typing its name:
</p>
<pre>Shell&gt; FS0:
FS0:\&gt; cd EFI/
</pre>
<h4><span class="mw-headline" id="edit">edit</span></h4>
<p><code>edit</code> provides a basic text editor with an interface similar to nano, but slightly less functional. It handles UTF-8 encoding and takes care or LF vs CRLF line endings.
</p>
<p>For example, to edit rEFInd's <code>refind.conf</code> in the EFI system partition (<code>FS0:</code> in the firmware),
</p>
<pre>Shell&gt; edit FS0:\EFI\refind\refind.conf
</pre>
<p>Press <code>Ctrl+e</code> for help.
</p>
<h2><span class="mw-headline" id="UEFI_drivers">UEFI drivers</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Explain what are and how to use UEFI drivers. Add automatic UEFI driver loading setup with efibootmgr's <code>-r</code>/<code>--driver</code> option. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Unified_Extensible_Firmware_Interface.html">Talk:Unified Extensible Firmware Interface</a>)</div>
</div>
<p>UEFI drivers are pieces of software that support some functionality. For example, access to NTFS formatted partitions is usually not possible from a UEFI shell. The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=efifs">efifs</a></span> package has drivers that support reading many more file systems from within an EFI shell. A usage example is to copy such driver to a partition that can be accessed from an UEFI shell. Then, from the UEFI shell, issuing commands such as:
</p>
<pre>Shell&gt; load ntfs_x64.efi
Shell&gt; map -r
</pre>
<p>After the map command has been executed, the user should be able to access NTFS formatted partitions from within a UEFI shell.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>
<a href="../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a> automatically loads UEFI drivers from <code><i>esp</i>/EFI/systemd/drivers/</code>.</li>
<li>
<a href="../en/REFInd.html" title="REFInd">rEFInd</a> automatically loads UEFI drivers from the <code>drivers</code> and <code>drivers_x64</code> subdirectories of its own installation directory on the ESP. E.g. <code><i>esp</i>/EFI/refind/drivers_x64/</code>. It can be configured to scan additional directories.</li>
</ul>
</div>
<h2><span class="mw-headline" id="UEFI_bootable_media">UEFI bootable media</span></h2>
<h3><span class="mw-headline" id="Create_UEFI_bootable_USB_from_ISO">Create UEFI bootable USB from ISO</span></h3>
<p>Follow <a href="../en/USB_flash_installation_medium.html#Using_the_ISO_as_is_(BIOS_and_UEFI)" title="USB flash installation medium">USB flash installation medium#Using the ISO as is (BIOS and UEFI)</a>.
</p>
<h3><span class="mw-headline" id="Remove_UEFI_boot_support_from_optical_media">Remove UEFI boot support from optical media</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>This section mentions removing UEFI boot support from a <b>CD/DVD only</b> (Optical Media booting via  EL Torito), not from a USB flash drive.</li>
<li>In order to hide the UEFI equipment on USB stick, use a partition editor after having copied the ISO to the flash drive. Remove the partition of type <code>EF</code>. <b>Do not</b> accept offers to convert to GPT.</li>
</ul>
</div>
<p>Most of the 32-bit EFI Macs and some 64-bit EFI Macs refuse to boot from a UEFI(X64)+BIOS bootable CD/DVD. If one wishes to proceed with the installation using optical media, it might be necessary to remove UEFI support first.
</p>
<p>Extract the ISO skipping the UEFI-specific directories:
</p>
<pre>$ mkdir extracted_iso
$ bsdtar -x --exclude=EFI/ --exclude=loader/ -f archlinux-<i>version</i>-x86_64.iso -C extracted_iso
</pre>
<p>Then rebuild the ISO, excluding the UEFI optical media booting support, using <span class="plainlinks archwiki-template-man" title="$ man 1 xorriso"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/xorriso.1">xorriso(1)</a></span> from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libisoburn">libisoburn</a></span>. Be sure to set the correct volume label, e.g. <code>ARCH_202103</code>; it can be acquired using <span class="plainlinks archwiki-template-man" title="$ man 1 file"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/file.1">file(1)</a></span> on the original ISO.
</p>
<pre>$ xorriso -as mkisofs \
    -iso-level 3 \
    -full-iso9660-filenames \
    -joliet \
    -joliet-long \
    -rational-rock \
    -volid "ARCH_<i>YYYYMM</i>" \
    -appid "Arch Linux Live/Rescue CD" \
    -publisher "Arch Linux &lt;<a rel="nofollow" class="external free" href="https://archlinux.org">https://archlinux.org</a>&gt;" \
    -preparer "prepared by $USER" \
    -eltorito-boot syslinux/isolinux.bin \
    -eltorito-catalog syslinux/boot.cat \
    -no-emul-boot -boot-load-size 4 -boot-info-table \
    -isohybrid-mbr "extracted_iso/syslinux/isohdpfx.bin" \
    -output archlinux-<i>version</i>-x86_64-noUEFI.iso extracted_iso/</pre>
<p>Burn <code>archlinux-<i>version</i>-x86_64-noUEFI.iso</code> to optical media and proceed with installation normally.
</p>
<h2><span class="mw-headline" id="Testing_UEFI_in_systems_without_native_support">Testing UEFI in systems without native support</span></h2>
<h3><span class="mw-headline" id="OVMF_for_virtual_machines">OVMF for virtual machines</span></h3>
<p><a rel="nofollow" class="external text" href="https://github.com/tianocore/tianocore.github.io/wiki/OVMF">OVMF</a> is a TianoCore project to enable UEFI support for Virtual Machines. OVMF contains a sample UEFI firmware and a separate non-volatile variable store for <a href="../en/QEMU.html" title="QEMU">QEMU</a>.
</p>
<p>You can install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=edk2-ovmf">edk2-ovmf</a></span> from the extra repository.
</p>
<p>It is <a rel="nofollow" class="external text" href="https://www.linux-kvm.org/downloads/lersek/ovmf-whitepaper-c770f8c.txt">advised</a> to make a local copy of the non-volatile variable store for your virtual machine:
</p>
<pre>$ cp /usr/share/edk2/x64/OVMF_VARS.4m.fd my_OVMF_VARS.4m.fd
</pre>
<p>To use the OVMF firmware and this variable store, add following to your QEMU command:
</p>
<pre>-drive if=pflash,format=raw,readonly,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
-drive if=pflash,format=raw,file=my_OVMF_VARS.4m.fd
</pre>
<p>For example:
</p>
<pre>$ qemu-system-x86_64 -enable-kvm -m 1G -drive if=pflash,format=raw,readonly,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd -drive if=pflash,format=raw,file=my_OVMF_VARS.4m.fd …
</pre>
<h3><span class="mw-headline" id="DUET_for_BIOS_only_systems">DUET for BIOS only systems</span></h3>
<p>DUET was a TianoCore project that enabled chainloading a full UEFI environment from a BIOS system, in a way similar to BIOS operating system booting. This method is being <a rel="nofollow" class="external text" href="https://www.insanelymac.com/forum/topic/186440-linux-and-windows-uefi-boot-using-tianocore-duet-firmware/">discussed</a> extensively. Pre-build DUET images can be downloaded from one of the <a rel="nofollow" class="external text" href="https://gitlab.com/tianocore_uefi_duet_builds/tianocore_uefi_duet_installer">repos</a><sup title="Last check status: 404 Page Not Found">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2023-04-07 ⓘ]</sup>. Read specific <a rel="nofollow" class="external text" href="https://gitlab.com/tianocore_uefi_duet_builds/tianocore_uefi_duet_installer/blob/master/Migle_BootDuet_INSTALL.txt">instructions</a><sup title="Last check status: 404 Page Not Found">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2023-04-07 ⓘ]</sup> for setting up DUET. However, as of November 2018, the DUET code has been removed from TianoCore git repository.
</p>
<p>You can also try <a href="../en/Clover.html" title="Clover">Clover</a> which provides modified DUET images that may contain some system specific fixes and is more frequently updated compared to the gitlab repos.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Boot_back_to_Arch_Linux_when_stuck_with_Windows">Boot back to Arch Linux when stuck with Windows</span></h3>
<p>To boot back into Arch Linux when you are stuck with Windows, reach <i>Advanced startup</i> in Windows by the Windows PowerShell command <code>shutdown /r /o</code>, or via <i>Settings &gt; Update &amp; Security &gt; Recovery &gt; Advanced startup</i> and select <i>Restart now</i>. When you have reached the <i>Advanced startup</i> menu, choose <i>Use a device</i>, which actually contains your UEFI boot options (not limited to USB or CD, but can also boot operating system in hard drive), and choose "Arch Linux".
</p>
<h3><span class="mw-headline" id="Enter_firmware_setup_without_function_keys">Enter firmware setup without function keys</span></h3>
<p>On some laptops, like <a href="../en/Lenovo_XiaoXin_15are_2020.html" title="Lenovo XiaoXin 15are 2020">Lenovo XiaoXin 15are 2020</a>, using keys like <code>F2</code> or <code>F12</code> does not do anything. This can possibly be fixed by returning laptops to OEM to repair mainboard information, but sometimes this is not possible or not desired. There are however other means to enter firmware setup:
</p>
<ul>
<li>With <a href="../en/Systemd.html#Power_management" title="Systemd">systemctl</a>: <pre>$ systemctl reboot --firmware-setup</pre> This will reboot your computer to firmware setup.</li>
<li>With <a href="../en/GRUB.html" title="GRUB">GRUB</a>: Press <code>c</code> for command line and in GRUB command line use <code>fwsetup</code> to enter firmware setup.</li>
<li>In Windows: Enter <i>Advanced Startup</i>, see <a href="#Boot_back_to_Arch_Linux_when_stuck_with_Windows">#Boot back to Arch Linux when stuck with Windows</a>.</li>
</ul>
<h3><span class="mw-headline" id="Userspace_tools_are_unable_to_modify_UEFI_variable_data">Userspace tools are unable to modify UEFI variable data</span></h3>
<p>If any userspace tool is unable to modify UEFI variable data, check for existence of <code>/sys/firmware/efi/efivars/dump-*</code> files. If they exist, delete them, reboot and retry again.
If the above step does not fix the issue, try booting with <code>efi_no_storage_paranoia</code> kernel parameter to disable kernel UEFI variable storage space check that may prevent writing/modification of UEFI variables.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> <code>efi_no_storage_paranoia</code> should only be used when needed and should not be left as a normal boot option. The effect of this kernel command line parameter turns off a safeguard that was put in place to help avoid the bricking of machines when the NVRAM gets too full. See <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/34641">FS#34641</a> for more information.</div>
<h3><span class="mw-headline" id="Cannot_create_a_new_boot_entry_with_efibootmgr">Cannot create a new boot entry with efibootmgr</span></h3>
<p>Some kernel and <i>efibootmgr</i> version combinations might refuse to create new boot entries. This could be due to lack of free space in the NVRAM. You can try the solution at <a href="#Userspace_tools_are_unable_to_modify_UEFI_variable_data">#Userspace tools are unable to modify UEFI variable data</a>. 
</p>
<p>You can also try to <a href="../en/Downgrading_packages.html" class="mw-redirect" title="Downgrade">downgrade</a> your <i>efibootmgr</i> install to version 0.11.0. This version works with Linux version 4.0.6. See the bug discussion <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/34641">FS#34641</a>, in particular the <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/34641#comment111365">closing comment</a>, for more information.
</p>
<h3><span class="mw-headline" id="Windows_changes_boot_order">Windows changes boot order</span></h3>
<p>If you <a href="../en/Dual_boot_with_Windows.html" title="Dual boot with Windows">dual boot with Windows</a> and your motherboard just boots Windows immediately instead of your chosen EFI application, there are several possible causes and workarounds.
</p>
<ul>
<li>Ensure <a href="../en/Dual_boot_with_Windows.html#Fast_Startup_and_hibernation" title="Dual boot with Windows">Fast Startup</a> is disabled in your Windows power options</li>
<li>Ensure <a href="../en/Unified_Extensible_Firmware_Interface/Secure_Boot.html" class="mw-redirect" title="Secure Boot">Secure Boot</a> is disabled in your firmware (if you are not using a signed boot loader)</li>
<li>Ensure your UEFI boot order does not have Windows Boot Manager set first e.g. using <a href="#efibootmgr">efibootmgr</a> and what you see in the configuration tool of the UEFI. Some motherboards override by default any settings set with efibootmgr by Windows if it detects it. This is confirmed in a Packard Bell laptop.</li>
<li>If your motherboard is booting the default boot path (<code>\EFI\BOOT\BOOTx64.EFI</code>), this file may have been overwritten with the Windows boot loader. Try setting the correct boot path e.g. using <a href="#efibootmgr">efibootmgr</a>.</li>
<li>If the previous steps do not work, you can tell the Windows boot loader to run a different EFI application. From a Windows administrator command prompt <code>bcdedit /set "{bootmgr}" path "\EFI\<i>path</i>\<i>to</i>\<i>app.efi</i>"</code>
</li>
<li>Alternatively, deactivate the Windows Boot Manager by running <code>efibootmgr -A -b <i>bootnumber</i></code> as root. Replace <code><i>bootnumber</i></code> with the actual Windows Boot Manager boot number; you can see it by running <code>efibootmgr</code> with no options.</li>
<li>Alternatively, you can set a startup script in Windows that ensures that the boot order is set correctly every time you boot Windows.
<ol>
<li>Open a command prompt with administrator privileges. Run <code>bcdedit /enum firmware</code> and find your desired boot entry.</li>
<li>Copy the identifier, including the brackets, e.g. <code>{31d0d5f4-22ad-11e5-b30b-806e6f6e6963}</code>
</li>
<li>Create a batch file with the command <code>bcdedit /set "{fwbootmgr}" DEFAULT "<i>{copied-boot-identifier}</i>"</code>
</li>
<li>Open <i>gpedit.msc</i> and under <i>Local Computer Policy &gt; Computer Configuration &gt; Windows Settings &gt; Scripts (Startup/Shutdown)</i>, choose <i>Startup</i>
</li>
<li>Under the <i>Scripts</i> tab, choose the <i>Add</i> button, and select your batch file</li>
</ol>
</li>
</ul>
<dl><dd><dl><dd>Note: <a rel="nofollow" class="external text" href="https://answers.microsoft.com/en-us/windows/forum/windows_10-performance/how-to-install-gpeditmsc-in-window-10/f5e9c4fa-8d46-444c-acd7-5cabaea9fc71">Windows 10 Home does not officially include gpedit.msc, although there are unsupported workarounds to install it manually.</a>
</dd></dl></dd></dl>
<ul><li>Alternatively, Task Scheduler can be used to run a startup script in Windows:
<ol>
<li>Follow steps 1-3 above to create the batch file.</li>
<li>Run <i>taskschd.msc</i>, then choose <i>Create Task...</i> from the <i>Action</i> menu.</li>
<li>On the <i>General</i> tab:
<dl>
<dd>Enter any suitable <i>Name</i> and <i>Description</i>.</dd>
<dd>Ensure the user account selected is an "Administrator", not a "Standard User".</dd>
<dd>Select "<i>Run whether user is logged in or not</i>".</dd>
<dd>Select "<i>Run with highest privileges</i>".</dd>
</dl>
</li>
<li>On the <i>Triggers</i> tab, choose "<i>At startup</i>" from the menu, then click <i>OK</i>.</li>
<li>On the <i>Actions</i> tab, click <i>New...</i>, then <i>Browse...</i>, and locate the batch file from step 1.</li>
<li>On the <i>Conditions tab</i>, untick the <i>Power</i> options so the script runs when on battery power (for laptops).</li>
<li>Click <i>OK</i>, and enter the password of the user account selected in step 4 when prompted.</li>
</ol>
</li></ul>
<h3><span class="mw-headline" id="USB_media_gets_struck_with_black_screen">USB media gets struck with black screen</span></h3>
<p>This issue can occur due to <a href="../en/Kernel_mode_setting.html" class="mw-redirect" title="KMS">KMS</a> issue. Try <a href="../en/Kernel_mode_setting.html#Disabling_modesetting" title="Kernel mode setting">disabling KMS</a> while booting the USB.
</p>
<h3><span class="mw-headline" id="UEFI_boot_loader_does_not_show_up_in_firmware_menu">UEFI boot loader does not show up in firmware menu</span></h3>
<p>Some firmware do not support custom boot entries. They will instead only boot from hardcoded boot entries.
</p>
<p>A typical workaround is to not rely on boot entries in the NVRAM and install the boot loader to one of the common fallback paths on the EFI system partition.
</p>
<p>The following sections describe the fallback paths.
</p>
<h4><span class="mw-headline" id="Default_boot_path_for_removable_drives">Default boot path for removable drives</span></h4>
<p>The UEFI specification defines default file paths for EFI binaries for booting from removable media. The relevant ones are:
</p>
<ul>
<li>
<code><i>esp</i>/EFI/BOOT/BOOTx64.EFI</code> for x64 UEFI</li>
<li>
<code><i>esp</i>/EFI/BOOT/BOOTIA32.EFI</code> for IA32 UEFI.</li>
</ul>
<p>While the specification defines these for removable drives only, most firmware support booting these from any drive.
</p>
<p>See the appropriate <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> article on how to install or migrate the boot loader to the default/fallback boot path.
</p>
<h4><span class="mw-headline" id="Microsoft_Windows_boot_loader_location">Microsoft Windows boot loader location</span></h4>
<p>On certain UEFI motherboards like some boards with an Intel Z77 chipset, adding entries with <code>efibootmgr</code> or <code>bcfg</code> from the UEFI Shell will not work because they do not show up on the boot menu list after being added to NVRAM.
</p>
<p>This issue is caused because the motherboards can only load Microsoft Windows. To solve this you have to place the <i>.efi</i> file in the location that Windows uses.
</p>
<p>Copy the <code>BOOTx64.EFI</code> file from the Arch Linux installation medium (<code>FSO:</code>) to the Microsoft directory your <a href="../en/EFI_system_partition.html" class="mw-redirect" title="ESP">ESP</a> partition on your hard drive (<code>FS1:</code>). Do this by booting into EFI shell and typing:
</p>
<pre>Shell&gt; mkdir FS1:\EFI\Microsoft
Shell&gt; mkdir FS1:\EFI\Microsoft\Boot
Shell&gt; cp FS0:\EFI\BOOT\BOOTx64.EFI FS1:\EFI\Microsoft\Boot\bootmgfw.efi
</pre>
<p>After reboot, any entries added to NVRAM should show up in the boot menu.
</p>
<h3><span class="mw-headline" id="Boot_entries_created_with_efibootmgr_fail_to_show_up_in_UEFI">Boot entries created with efibootmgr fail to show up in UEFI</span></h3>
<p><i>efibootmgr</i> can fail to detect EDD 3.0 and as a result create unusable boot entries in NVRAM. See <a rel="nofollow" class="external text" href="https://github.com/rhboot/efibootmgr/issues/86">efibootmgr issue 86</a> for the details.
</p>
<p>To work around this, when creating boot entries manually, add the <code>-e 3</code> option to the <i>efibootmgr</i> command. E.g.
</p>
<pre># efibootmgr --create --disk /dev/sda --part 1 --loader '\EFI\refind\refind_x64.efi' --label 'rEFInd Boot Manager' --unicode <b>-e 3</b>
</pre>
<p>To fix boot loader installers, like <code>grub-install</code> and <code>refind-install</code>, create a wrapper script <code>/usr/local/bin/efibootmgr</code> and make it <a href="../en/Help:Reading.html#Make_executable" class="mw-redirect" title="Executable">executable</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/local/bin/efibootmgr</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh

exec /usr/bin/efibootmgr -e 3 "$@"
</pre>
<h3><span class="mw-headline" id="UEFI_boot_entry_disappears_after_removing_its_referenced_drive">UEFI boot entry disappears after removing its referenced drive</span></h3>
<p>Some firmware will remove boot entries referencing drives that are not present during boot. This could be an issue when frequently detaching/attaching drives or when booting from a removable drive.
</p>
<p>The solution is to install the <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> to <a href="#Default_boot_path_for_removable_drives">the default/fallback boot path</a>.
</p>
<h3><span class="mw-headline" id="Boot_entries_are_randomly_removed">Boot entries are randomly removed</span></h3>
<p>Some motherboards may remove boot entries due to lack of free space in the NVRAM instead of giving an error at creation. To prevent this from occurring, reduce the amount of boot entries being added by minimizing your entry creation process, as well as reducing the amount of automatic drive boot entries by the <a href="https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface#CSM_booting" class="extiw" title="wikipedia:Unified Extensible Firmware Interface">Compatibility Support Module (CSM)</a> by disabling it from your UEFI settings. See <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1608838#p1608838">BBS#1608838</a>.
</p>
<p>Another reason why boot entries might have been removed is the fact that UEFI specification allows OEMs to do "NVRAM maintenance" during boot process. Those manufacturers do it simply: they just look up for EFI applications in predefined, hardcoded paths on the device. If they fail to find any, they conclude there is no operating system on the device and wipe all boot entries from NVRAM associated with it, because they assume the NVRAM contains some corrupted or outdated data. If you do not plan to install Windows and still want to load the Linux kernel directly from the firmware, one possible workaround is to create an empty file <code><i>esp</i>/EFI/BOOT/BOOTx64.EFI</code>: 
</p>
<pre># mkdir -p <i>esp</i>/EFI/BOOT 
# touch <i>esp</i>/EFI/BOOT/BOOTx64.EFI
</pre>
<p>And restore the deleted boot entry. Now after reboot the motherboard will see the "Fake OS" and should not wipe other boot entries from NVRAM. You can change the fake operating system loader with an actual EFI application if you want, of course, as long as you keep the standard fallback name.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/UEFI" class="extiw" title="wikipedia:UEFI">Wikipedia:UEFI</a></li>
<li>
<a rel="nofollow" class="external text" href="https://www.uefi.org/home/">UEFI Forum</a> - contains the official <a rel="nofollow" class="external text" href="https://uefi.org/specifications">UEFI Specifications</a> - GUID Partition Table is part of UEFI Specification</li>
<li><a rel="nofollow" class="external text" href="https://www.happyassassin.net/2014/01/25/uefi-boot-how-does-that-actually-work-then/">UEFI boot: how does that actually work, then? - A blog post by AdamW</a></li>
<li><a rel="nofollow" class="external text" href="https://docs.kernel.org/arch/x86/x86_64/uefi.html">Linux Kernel UEFI documentation for x86_64 platforms</a></li>
<li><a rel="nofollow" class="external text" href="https://www.intel.com/content/www/us/en/architecture-and-technology/unified-extensible-firmware-interface/efi-homepage-general-technology.html">Intel's page on EFI</a></li>
<li>
<a rel="nofollow" class="external text" href="https://firmware.intel.com/">Intel Architecture Firmware Resource Center</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2023-07-30 ⓘ]</sup>
</li>
<li><a rel="nofollow" class="external text" href="https://web.archive.org/web/20191230095118/https://firmware.intel.com/blog/linux-efi-boot-stub">Matt Fleming - The Linux EFI Boot Stub</a></li>
<li><a rel="nofollow" class="external text" href="https://web.archive.org/web/20190319175019/https://firmware.intel.com/blog/accessing-uefi-variables-linux">Matt Fleming - Accessing UEFI Variables from Linux</a></li>
<li><a rel="nofollow" class="external text" href="https://www.rodsbooks.com/linux-uefi/">Rod Smith - Linux on UEFI: A Quick Installation Guide</a></li>
<li><a rel="nofollow" class="external text" href="https://lore.kernel.org/lkml/20110608192950.GA29235@srcf.ucam.org/">UEFI Boot problems on some newer machines (LKML)</a></li>
<li>
<a rel="nofollow" class="external text" href="https://linuxplumbers.ubicast.tv/videos/plumbing-uefi-into-linux/">LPC 2012 Plumbing UEFI into Linux</a><sup title="Last check status: domain name not resolved">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2021-05-17 ⓘ]</sup>
</li>
<li>
<a rel="nofollow" class="external text" href="https://linuxplumbers.ubicast.tv/videos/uefi-tutorial-part-1/">LPC 2012 UEFI Tutorial : part 1</a><sup title="Last check status: domain name not resolved">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2021-05-17 ⓘ]</sup>
</li>
<li>
<a rel="nofollow" class="external text" href="https://linuxplumbers.ubicast.tv/videos/uefi-tutorial-part-2/">LPC 2012 UEFI Tutorial : part 2</a><sup title="Last check status: domain name not resolved">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2021-05-17 ⓘ]</sup>
</li>
<li>
<a rel="nofollow" class="external text" href="https://www.tianocore.org/">Intel's TianoCore Project</a> for Open-Source UEFI firmware which includes DuetPkg for direct BIOS based booting and OvmfPkg used in QEMU and Oracle VirtualBox</li>
<li><a rel="nofollow" class="external text" href="http://jdebp.info/FGA/efi-boot-process.html">FGA: The EFI boot process</a></li>
<li><a rel="nofollow" class="external text" href="https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/windows-and-gpt-faq">Microsoft's Windows and GPT FAQ</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.com/tianocore_uefi_duet_builds/tianocore_uefi_duet_installer/wikis/Windows_x64_BIOS_to_UEFI">Convert Windows x64 from BIOS-MBR mode to UEFI-GPT mode without Reinstall</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.com/tianocore_uefi_duet_builds/tianocore_uefi_duet_installer/wikis/Linux_Windows_BIOS_UEFI_boot_USB">Create a Linux BIOS+UEFI and Windows x64 BIOS+UEFI bootable USB drive</a></li>
<li><a rel="nofollow" class="external text" href="https://rodsbooks.com/bios2uefi/">Rod Smith - A BIOS to UEFI Transformation</a></li>
<li><a rel="nofollow" class="external text" href="https://web.archive.org/web/20190404074007/https://software.intel.com/en-us/articles/efi-shells-and-scripting/">EFI Shells and Scripting - Intel Documentation</a></li>
<li><a rel="nofollow" class="external text" href="https://web.archive.org/web/20190117223426/https://software.intel.com/en-us/articles/uefi-shell/">UEFI Shell  - Intel Documentation</a></li>
<li><a rel="nofollow" class="external text" href="https://web.archive.org/web/20130929114218/http://www.hpuxtips.es/?q=node/293">UEFI Shell - bcfg command info</a></li>
<li><a rel="nofollow" class="external text" href="https://lwn.net/Articles/632528/">The bootstrap process on EFI systems</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Boot_process.html" title="Category:Boot process">Boot process</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Unified_Extensible_Firmware_Interface&amp;oldid=812264">https://wiki.archlinux.org/index.php?title=Unified_Extensible_Firmware_Interface&amp;oldid=812264</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 11 July 2024, at 18:26.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
