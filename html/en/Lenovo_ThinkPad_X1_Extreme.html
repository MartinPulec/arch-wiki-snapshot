<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-zebra-design-disabled vector-feature-custom-font-size-clientpref-disabled vector-feature-client-preferences-disabled vector-feature-typography-survey-disabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Lenovo ThinkPad X1 Extreme - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.41.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Lenovo_ThinkPad_X1_Extreme rootpage-Lenovo_ThinkPad_X1_Extreme skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-main-menu-container">
		</div>
	<input type="checkbox" id="vector-toc-collapsed-checkbox" class="vector-menu-checkbox">
			<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark vector-sticky-pinned-container">
				<div id="vector-toc-pinned-container" class="vector-pinned-container">
				<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Firmware_update" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Firmware_update">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Firmware update</div>
		</a>
		
		<ul id="toc-Firmware_update-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Video" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Video">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Video</div>
		</a>
		
		<ul id="toc-Video-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-CPU_thermal_throttling" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#CPU_thermal_throttling">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>CPU thermal throttling</div>
		</a>
		
			<button aria-controls="toc-CPU_thermal_throttling-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle CPU thermal throttling subsection</span>
			</button>
		
		<ul id="toc-CPU_thermal_throttling-sublist" class="vector-toc-list">
			<li id="toc-Fix_using_reverse-engineered_DPTF_implementation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Fix_using_reverse-engineered_DPTF_implementation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Fix using reverse-engineered DPTF implementation</div>
			</a>
			
			<ul id="toc-Fix_using_reverse-engineered_DPTF_implementation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Fix_using_dptfxtract_and_manual_DPTF_profile_setting" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Fix_using_dptfxtract_and_manual_DPTF_profile_setting">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Fix using dptfxtract and manual DPTF profile setting</div>
			</a>
			
			<ul id="toc-Fix_using_dptfxtract_and_manual_DPTF_profile_setting-sublist" class="vector-toc-list">
				<li id="toc-Configuring_thermald_to_use_extracted_dptf_tables" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Configuring_thermald_to_use_extracted_dptf_tables">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.1</span>Configuring thermald to use extracted dptf tables</div>
			</a>
			
			<ul id="toc-Configuring_thermald_to_use_extracted_dptf_tables-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Selecting_the_appropriate_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Selecting_the_appropriate_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.2</span>Selecting the appropriate configuration</div>
			</a>
			
			<ul id="toc-Selecting_the_appropriate_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Manually_setting_a_DPTF_profile_to_prevent_temporary_re-throttling" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Manually_setting_a_DPTF_profile_to_prevent_temporary_re-throttling">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.3</span>Manually setting a DPTF profile to prevent temporary re-throttling</div>
			</a>
			
			<ul id="toc-Manually_setting_a_DPTF_profile_to_prevent_temporary_re-throttling-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Disabling_BDPROCHOT_to_prevent_throttling_on_battery" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Disabling_BDPROCHOT_to_prevent_throttling_on_battery">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.4</span>Disabling BDPROCHOT to prevent throttling on battery</div>
			</a>
			
			<ul id="toc-Disabling_BDPROCHOT_to_prevent_throttling_on_battery-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Microphone_noise_reduction" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Microphone_noise_reduction">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Microphone noise reduction</div>
		</a>
		
		<ul id="toc-Microphone_noise_reduction-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Fingerprint_reader" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Fingerprint_reader">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Fingerprint reader</div>
		</a>
		
		<ul id="toc-Fingerprint_reader-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

				</div>
	</nav>
		
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<label id="vector-toc-collapsed-button" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet vector-button-flush-left cdx-button--icon-only" for="vector-toc-collapsed-checkbox" role="button" aria-controls="vector-toc" tabindex="0" title="Table of Contents">
						<span class="vector-icon mw-ui-icon-wikimedia-listBullet"></span>
						<span>Toggle the table of contents</span>
					</label>
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Lenovo ThinkPad X1 Extreme</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Lenovo_ThinkPad_X1_Extreme" title="Lenovo ThinkPad X1 Extreme – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<nav class="vector-page-tools-landmark vector-sticky-pinned-container" aria-label="Page tools">
						<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
			
						</div>
	</nav>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section does not follow the <a href="../en/Help:Laptop_page_guidelines.html" title="Help:Laptop page guidelines">Laptop page guidelines</a>.</b></p>
<div>
<b>Reason:</b> Hardware table needs IDs and a function keys section should be added (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Lenovo_ThinkPad_X1_Extreme.html">Talk:Lenovo ThinkPad X1 Extreme</a>)</div>
</div>
<table class="wikitable" style="float: right;">

<tbody>
<tr>
<th>Hardware</th>
<th>PCI/USB ID</th>
<th>Working?
</th>
</tr>
<tr>
<td>Touchpad</td>
<td></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes
</td>
</tr>
<tr>
<td>Keyboard</td>
<td></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes
</td>
</tr>
<tr>
<td>GPU (Intel)</td>
<td></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes
</td>
</tr>
<tr>
<td>GPU (Nvidia)</td>
<td></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes
</td>
</tr>
<tr>
<td>Webcam</td>
<td></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes
</td>
</tr>
<tr>
<td>Ethernet</td>
<td></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes
</td>
</tr>
<tr>
<td>Bluetooth</td>
<td></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes
</td>
</tr>
<tr>
<td>Card reader</td>
<td></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes
</td>
</tr>
<tr>
<td>Audio</td>
<td></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes
</td>
</tr>
<tr>
<td>Wireless</td>
<td></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes
</td>
</tr>
<tr>
<td>Thunderbolt</td>
<td></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes
</td>
</tr>
<tr>
<td>Fingerprint reader</td>
<td><code>06cb:009a</code></td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">Experimental
</td>
</tr>
</tbody>
</table>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <a href="../en/Lenovo_ThinkPad_P1.html" title="Lenovo ThinkPad P1">Lenovo ThinkPad P1</a> is a workstation version of the same laptop which uses extremely similar hardware. Most of the information on this page should be applicable to P1 models as well.</div>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Firmware_update">Firmware update</span></h2>
<p>A UEFI firmware update is strongly recommended for general use of the laptop - the initial 1.13 version devices seem to ship with contains multiple bugs that can result in bricking the laptop: <a rel="nofollow" class="external text" href="https://www.reddit.com/r/thinkpad/comments/a2g0k4/warning_do_not_change_from_hybrid_graphics_to/">Reddit thread discussing the issue</a>; <a rel="nofollow" class="external text" href="https://www.reddit.com/r/thinkpad/comments/9qreoj/psa_do_not_enable_bios_support_for_thunderbolt/">another Reddit thread discussing a different bricking issue</a>.
</p>
<p>Firmware updates are available via <a href="../en/Fwupd.html" title="Fwupd">fwupd</a>, the Lenovo Vantage application on Windows, or from <a rel="nofollow" class="external text" href="https://pcsupport.lenovo.com/en/en/products/laptops-and-netbooks/thinkpad-x-series-laptops/thinkpad-x1-extreme/downloads">Lenovo's website</a>.
</p>
<p>The latest version, v1.35, is highly recommended. All information on this page assumes the latest firmware.
</p>
<h2><span class="mw-headline" id="Video">Video</span></h2>
<p>Both the HDMI port and DisplayPort outputs created when using either a USB-C adapter or Thunderbolt dock are wired to the Nvidia dGPU.
</p>
<p>A BIOS setting can be used to disable the integrated GPU, and run everything on the dedicated Nvidia card. The dedicated GPU cannot be disabled through firmware, so enabling runtime power management in some form is highly recommended when using the iGPU.
</p>
<h2><span class="mw-headline" id="CPU_thermal_throttling">CPU thermal throttling</span></h2>
<p>This laptop is affected by <a rel="nofollow" class="external text" href="https://forums.lenovo.com/t5/Linux-Discussion/X1C6-T480s-low-cTDP-and-trip-temperature-in-Linux/td-p/4028489">a CPU throttling bug when using Linux</a>.
</p>
<p>Basically, the laptop's firmware uses an implementation of Intel's Dynamic Platform and Thermal Framework (DPTF) that does not work with Linux. While newer generations of ThinkPads have gotten a BIOS update to fix this, a <a rel="nofollow" class="external text" href="https://forums.lenovo.com/t5/Other-Linux-Discussions/X1C6-T480s-low-cTDP-and-trip-temperature-in-Linux/m-p/4028489?page=39#5059290">Lenovo employee confirmed</a> that older affected Thinkpads (including T580, T480, T480s, X1C6, P1G1 and <b>X1E1</b>) will not get the fix.
</p>
<p>A stress test using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=s-tui">s-tui</a></span> indicates that the CPU is limited to 38W/80C at boot, resulting in a sustained all-core frequency of around 2850 MHz on the i7-8750H.
</p>
<h3><span class="mw-headline" id="Fix_using_reverse-engineered_DPTF_implementation">Fix using reverse-engineered DPTF implementation</span></h3>
<p>There is an <a rel="nofollow" class="external text" href="https://mjg59.dreamwidth.org/54923.html">ongoing effort</a> to reverse-engineer DPTF on Linux. Results can be found <a rel="nofollow" class="external text" href="https://github.com/mjg59/thermal_daemon">here</a>. Most of the work has been upstreamed already, though the implementation is still far from complete.
</p>
<p>Starting with kernel 5.12, the work-in-progress can be utilized by installing and enabling <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=thermald">thermald</a></span>, which will attempt to make use of the firmware's adaptive performance policy.
</p>
<p>Unfortunately, the current implementation does not appear to help much on this laptop. While the CPU's limit is raised to 45W/83C, the all-core frequency is erratic, resulting in only a marginal performance improvement.
</p>
<h3><span class="mw-headline" id="Fix_using_dptfxtract_and_manual_DPTF_profile_setting">Fix using dptfxtract and manual DPTF profile setting</span></h3>
<p>Another option, which does result in full performance, is to extract the DPTF tables and use them in combination with a manual change of the DPTF profile.
</p>
<h4><span class="mw-headline" id="Configuring_thermald_to_use_extracted_dptf_tables">Configuring thermald to use extracted dptf tables</span></h4>
<p>First, make sure <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=thermald">thermald</a></span> is installed. Next, use Intel's proprietary <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dptfxtract-bin/">dptfxtract-bin</a></span><sup><small>AUR</small></sup> tool to extract the DPTF tables:
</p>
<pre># dptfxtract
</pre>
<p>This will populate <code>/etc/thermald/</code> with multiple configuration files of the form <code>thermal-conf.xml.*</code>, each of which represents a converted DPTF table.
</p>
<p>The tool also creates a copy of each of these files in the current working directory, so you may want to remove those:
</p>
<pre># rm thermal-conf.xml.*
</pre>
<p>The thermald service file shipped with Arch Linux enables adaptive mode by default. In order to use the extracted tables we have to override it.
</p>
<p>Create the necessary directory if it does not exist already:
</p>
<pre># mkdir -p /etc/systemd/system/thermald.service.d
</pre>
<p>Then create the following file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/thermald.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/thermald --systemd --dbus-enable
</pre>
<p>Afterwards, reload the systemd manager configuration and enable thermald.
</p>
<h4><span class="mw-headline" id="Selecting_the_appropriate_configuration">Selecting the appropriate configuration</span></h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Editing the configuration files in <code>/etc/thermald/</code> is not recommended as it may result in your laptop running out of spec!</div>
<p>Out of all the generated configuration files, thermald will use <code>thermal-conf.xml.auto</code> by default. You can try any of the other configurations by adding the <code>--config-file</code> flag to the <code>override.conf</code> created earlier.
</p>
<p>The default configuration file already unlocks full performance. A stress test indicates that the CPU is now limited to 45W/95C, resulting in a sustained all-core frequency of around 3300 MHz on the i7-8750H.
</p>
<h4><span class="mw-headline" id="Manually_setting_a_DPTF_profile_to_prevent_temporary_re-throttling">Manually setting a DPTF profile to prevent temporary re-throttling</span></h4>
<p>The setup above is not perfect, every time the CPU temperature trips over 80C the laptop's embedded controller (EC) will re-throttle the CPU for a few seconds.
</p>
<p>This issue can be fixed, without 'fighting the EC', by manually setting the adaptive performance DPTF profile using the following script:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">set_dptf_adaptive.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash
# Script that enables the adaptive performance DPTF profile, if available.

# Check for super user privileges.
if (( $EUID != 0 )); then
    echo "ERROR: script requires super user privileges. Exiting!"
    exit 1
fi

# from: https://github.com/torvalds/linux/blob/master/drivers/thermal/intel/int340x_thermal/int3400_thermal.c
adaptive_performance_uuid='63BE270F-1C11-48FD-A6F7-3AF253FF3E2D'

# Check if the adaptive performance profile is supported.
available_uuids=$(cat /sys/devices/platform/INT3400:00/uuids/available_uuids)

if [[ $available_uuids != *$adaptive_performance_uuid* ]]; then
  echo "ERROR: adaptive performance profile not supported. Exiting!"
  exit 1
fi

# Find the INT3400 Thermal driver.
INT3400=$(grep INT3400 /sys/class/thermal/thermal_zone*/type |
          grep Thermal |
          sed '/\/sys\/class\/thermal\/thermal_zone/ s/\/type.*//')

if [[ "$INT3400" == '' ]]; then
  echo "ERROR: unable to find the INT3400 thermal driver. Exiting!"
  exit 1
fi

# Temporarily disable the INT3400 thermal driver.
echo 'disabled' &gt; "$INT3400"/mode

if [[ $(cat "$INT3400"/mode) != 'disabled' ]]; then
  echo "ERROR: unable to disable the INT3400 thermal driver. Exiting!"
  exit 1
fi

# Enable the adaptive performance profile.
echo "$adaptive_performance_uuid" &gt; /sys/devices/platform/INT3400:00/uuids/current_uuid

current_uuid=$(cat /sys/devices/platform/INT3400:00/uuids/current_uuid)
if [[ "$current_uuid" != "$adaptive_performance_uuid" ]]; then
  echo "ERROR: unable to set the adaptive performance profile. Exiting!"
  exit 1
fi

# Re-enable the INT3400 thermal driver.
echo 'enabled' &gt; "$INT3400"/mode

if [[ $(cat "$INT3400"/mode) != 'enabled' ]]; then
  echo "ERROR: unable to re-enable the INT3400 thermal driver. Exiting!"
  exit 1
fi

echo "Successfully set the adaptive performance DPTF profile."
</pre>
<p>Save the script somewhere and create a systemd service for it:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/dptf_adaptive.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Set Intel DPTF policy to adaptive performance

[Service]
Type=oneshot
ExecStart=/path/to/script/set_dptf_adaptive.sh

[Install]
WantedBy=default.target
</pre>
<p>Do not forget to replace <code>/path/to/script/</code> in the service file.
</p>
<p>Finally, reload the systemd manager configuration and enable the service.
</p>
<h4><span class="mw-headline" id="Disabling_BDPROCHOT_to_prevent_throttling_on_battery">Disabling BDPROCHOT to prevent throttling on battery</span></h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> 
<ul>
<li>After this fix the laptop may run hotter than is comfortable when using it on your lap or similar positions.</li>
<li>Disabling BDPROCHOT can be considered a 'nuclear option' in terms of power management. Use at your own risk!</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Writing to MSRs requires that Secure Boot is disabled in the BIOS.</div>
<p>The laptop's performance on battery is far below expectations when using Linux. The cause appears to be something called 'lap mode' (documented by Lenovo, <a rel="nofollow" class="external text" href="https://web.archive.org/web/20190926163900/https://forums.lenovo.com/lnv/attachments/lnv/Special_Interest_Linux/13642/1/Linux%20Thermal%20throttling.pdf">here</a>).
</p>
<p>Basically, when unplugged, the laptop will by default assume that it is being used on the user's lap. And since Linux has no working DPTF implementation to tell the laptop otherwise, it will <i>always</i> assume it is being used the user's lap. Consequently, In order to keep the laptop base at a 'skin friendly' temperature, the laptop's EC throttles the CPU with BDPROCHOT (BiDirectional PROCessor HOT) when one of many thermal sensors trips a predetermined value. Effectively this will keep the CPU at around 70C max while simultaneously preventing the fans from properly spinning up. A repeated on-again off-again all-core stress test causes the CPU to throttle as low as 800 MHz.
</p>
<p>Since there is currently no known way to disable 'lap mode', the only path to full performance on battery is to disable BDPROCHOT altogether. This can be done using the following script:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">bdprochot_disable.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash
# Script that unsets the BDPROCHOT-bit on some Intel CPUs.

# Check for super user privileges.
if (( $EUID != 0 )); then
    echo "ERROR: script requires super user privileges. Exiting!"
    exit 1
fi

# Enable writing to model-specific registers of the CPU.
modprobe msr

# Get current state of the CPU power-related bits (in base-10).
flags=$(rdmsr 0x1FC -d)

# Check if BDPROCHOT-bit is already unset.
if [[ $(("$flags" &amp; 0x00000001)) == 0 ]]; then
    echo "INFO: BDPROCHOT-bit is already unset. Exiting!"
    exit 0
fi

# Unset BRPROCHOT-bit.
wrmsr -a 0x1FC $(("$flags" &amp; 0xfffffffe))

# Check if we were successful.
flags=$(rdmsr 0x1FC -d)

if [[ $(("$flags" &amp; 0x00000001)) == 1 ]]; then
    echo "ERROR: unable to unset BDPROCHOT-bit. Exiting!"
    exit 1
fi

echo "Successfully disabled BDPROCHOT."
</pre>
<p>Save the script somewhere and create a systemd service for it:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/bdprochot_disable.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Disable BDPROCHOT

[Service]
Type=oneshot
ExecStart=/path/to/script/bdprochot_disable.sh

[Install]
WantedBy=default.target
</pre>
<p>A suspend/resume-cycle will cause the EC to re-set the BDPROCHOT-bit.
</p>
<p>Create the following file (and make it executable) to run the script on resume:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/lib/systemd/system-sleep/bdprochot</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh

case "$1" in
    post)
        /path/to/script/bdprochot_disable.sh
        ;;
esac
</pre>
<p>Do not forget to replace <code>/path/to/script/</code> in both files.
</p>
<p>Finally, reload the systemd manager configuration, enable the service and reboot.
</p>
<p>The CPU's performance on battery should now be roughly equal as when plugged in.
</p>
<h2><span class="mw-headline" id="Microphone_noise_reduction">Microphone noise reduction</span></h2>
<p>PulseAudio's <a href="../en/PulseAudio.html#Microphone_echo/noise_cancellation" title="PulseAudio">PulseAudio#Microphone echo/noise cancellation</a> can be used to reduce the amount of microphone noise by adding the following to <code>/etc/pulse/default.pa</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pulse/default.pa</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">### Enable Echo/Noise-Cancellation
load-module module-echo-cancel use_master_format=1 aec_method=webrtc aec_args="beamforming=1 mic_geometry=-0.0257,0,0,0.0257,0,0" source_name=echoCancel_source sink_name=echoCancel_sink
set-default-source echoCancel_source
set-default-sink echoCancel_sink</pre>
<p>The above mic_geometry is specific to the X1 Extreme.
</p>
<p>The module-filter-heuristics and module-filter-apply modules can sometimes result in adding additional noise, so the lines that enable them should be commented out:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pulse/default.pa</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#load-module module-filter-heuristics
#load-module module-filter-apply</pre>
<p>Bad sound quality may also result from audio clipping, which can occur if "Internal Mic Boost" is larger than zero in alsamixer.
</p>
<h2><span class="mw-headline" id="Fingerprint_reader">Fingerprint reader</span></h2>
<p>A reverse engineering effort is ongoing <a rel="nofollow" class="external text" href="https://github.com/uunicorn/python-validity">here</a>, and an experimental driver is available on the AUR as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/python-validity/">python-validity</a></span><sup><small>AUR</small></sup>.
</p>
<p>Upstream libfprint bug is tracked <a rel="nofollow" class="external text" href="https://gitlab.freedesktop.org/libfprint/libfprint/issues/134">here</a>.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external free" href="https://www.lenovo.com/us/en/laptops/thinkpad/thinkpad-x1/ThinkPad-X1-Extreme/p/22TP2TXX1E1">https://www.lenovo.com/us/en/laptops/thinkpad/thinkpad-x1/ThinkPad-X1-Extreme/p/22TP2TXX1E1</a></li>
<li><a rel="nofollow" class="external text" href="https://ubuntu.com/certified/201809-26479">Ubuntu certification page</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Lenovo.html" title="Category:Lenovo">Lenovo</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Laptop_style.html" title="Category:Pages or sections flagged with Template:Laptop style">Pages or sections flagged with Template:Laptop style</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Lenovo_ThinkPad_X1_Extreme&amp;oldid=786590">https://wiki.archlinux.org/index.php?title=Lenovo_ThinkPad_X1_Extreme&amp;oldid=786590</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 31 August 2023, at 17:19.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
