<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Modprobed-db - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Modprobed-db rootpage-Modprobed-db skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Usage" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Usage">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Usage</div>
		</a>
		
			<button aria-controls="toc-Usage-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Usage subsection</span>
			</button>
		
		<ul id="toc-Usage-sublist" class="vector-toc-list">
			<li id="toc-Populating_the_database" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Populating_the_database">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Populating the database</div>
			</a>
			
			<ul id="toc-Populating_the_database-sublist" class="vector-toc-list">
				<li id="toc-Recommendations" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Recommendations">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.1</span>Recommendations</div>
			</a>
			
			<ul id="toc-Recommendations-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Automatic_periodic_database_updates" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Automatic_periodic_database_updates">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.2</span>Automatic periodic database updates</div>
			</a>
			
			<ul id="toc-Automatic_periodic_database_updates-sublist" class="vector-toc-list">
				<li id="toc-Cron" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Cron">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.2.1</span>Cron</div>
			</a>
			
			<ul id="toc-Cron-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-systemd" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#systemd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.2.2</span>systemd</div>
			</a>
			
			<ul id="toc-systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Manually_editing_the_database" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Manually_editing_the_database">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.3</span>Manually editing the database</div>
			</a>
			
			<ul id="toc-Manually_editing_the_database-sublist" class="vector-toc-list">
				<li id="toc-Recommended_modules" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Recommended_modules">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.3.1</span>Recommended modules</div>
			</a>
			
			<ul id="toc-Recommended_modules-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Building_a_kernel_with_modprobed-db" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Building_a_kernel_with_modprobed-db">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Building a kernel with modprobed-db</div>
			</a>
			
			<ul id="toc-Building_a_kernel_with_modprobed-db-sublist" class="vector-toc-list">
				<li id="toc-Traditional_compilation" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Traditional_compilation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.1</span>Traditional compilation</div>
			</a>
			
			<ul id="toc-Traditional_compilation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_the_official_Arch_kernel_PKGBUILD" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Using_the_official_Arch_kernel_PKGBUILD">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.2</span>Using the official Arch kernel PKGBUILD</div>
			</a>
			
			<ul id="toc-Using_the_official_Arch_kernel_PKGBUILD-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_linux-tkg" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Using_linux-tkg">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.3</span>Using linux-tkg</div>
			</a>
			
			<ul id="toc-Using_linux-tkg-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id='toc-Benefits_of_modprobed-db_with_"make_localmodconfig"_in_custom_kernels' class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href='#Benefits_of_modprobed-db_with_"make_localmodconfig"_in_custom_kernels'>
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Benefits of modprobed-db with "make localmodconfig" in custom kernels</div>
		</a>
		
		<ul id='toc-Benefits_of_modprobed-db_with_"make_localmodconfig"_in_custom_kernels-sublist' class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Modprobed-db</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Modprobed-db" title="Modprobed-db – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Kernel.html" class="mw-redirect" title="Kernels">Kernels</a></li>
<li><a href="../en/Unofficial_user_repositories/Repo-ck.html" class="mw-redirect" title="Linux-ck">Linux-ck</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://github.com/graysky2/modprobed-db">modprobed-db</a> is a utility that populates a list of all the <a href="../en/Kernel_module.html" title="Kernel module">kernel modules</a> that have been loaded on a system while running. This list can then be used to disable all the unused modules when <a href="../en/Kernel.html#Compilation" title="Kernel">building your own kernel</a> and significantly reduce the compilation time.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/modprobed-db/">modprobed-db</a></span><sup><small>AUR</small></sup> package.
</p>
<ol>
<li>Run <code>modprobed-db</code> to create <code>$XDG_CONFIG_HOME/modprobed-db.conf</code> if it does not already exist.</li>
<li>Run <code>modprobed-db store</code> to create the <code>$XDG_CONFIG_HOME/modprobed.db</code> database file and populate it with the currently loaded modules.</li>
</ol>
<p><b>Optionally:</b> add modules in the ignore array that you do NOT want counted, for example modules that get built or that are provided by another package.
Some common ones are included by default:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ cat ~/.config/modprobed-db.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">IGNORE=(nvidia vboxdrv vboxnetflt vboxnetadp vboxpci lirc_dev lirc_i2c
osscore oss_hdaudio oss_usb tp_smapi thinkpad_ec
zavl znvpair zunicode zcommon zpios zfs spl splat)</pre>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<h3><span class="mw-headline" id="Populating_the_database">Populating the database</span></h3>
<p>Once the initial database has been created, use <code>modprobed-db list</code> to show the current database modules and <code>modprobed-db store</code> to update the database with the currently loaded kernel modules.
</p>
<h4><span class="mw-headline" id="Recommendations">Recommendations</span></h4>
<p>It is recommended to "use" the official Arch kernel, with <code>modprobed-db</code> installed, for a good amount of time to allow the database to grow based on usage and capture everything the system needs before <a href="#Building_a_kernel_with_modprobed-db">building a kernel without the unneeded modules</a>). Here are some suggested actions to allow appropriate modules to load and get cataloged: 
</p>
<ul>
<li>Mount every kind of <a href="../en/File_systems.html" class="mw-redirect" title="Filesystem">filesystem</a> that will be used.</li>
<li>Insert every kind of removable media that will be used (USB, DVD, CD, etc.).
<ul><li>This includes the mounting of ISO image files if applicable, which uses the <b>loop</b> and <b>isofs</b> modules.</li></ul>
</li>
<li>Use every device on the machine (network interfaces, input devices, webcams, mobile devices, etc.).</li>
<li>Use every desired application, as some depend on kernel modules. For example:
<ul>
<li>IP blocking/filtering software such as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pgl-cli/">pgl-cli</a></span><sup><small>AUR</small></sup> require the <a href="../en/Iptables.html" title="Iptables">iptables</a> kernel module.</li>
<li>Encryption software such as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=veracrypt">veracrypt</a></span> requires cryptography kernel modules. Be sure to mount some encrypted containers so they will actually be loaded.</li>
<li>Certain <a href="../en/QEMU.html" title="QEMU">QEMU</a> configurations require kernel modules.</li>
<li>
<a href="../en/Lm_sensors.html" class="mw-redirect" title="Lm-sensors">lm-sensors</a> requires kernel modules for reading hardware sensors.</li>
</ul>
</li>
<li>Try re-running modprobed-db while running different Linux-kernels; they may include modules not enabled in the other kernels.</li>
</ul>
<p>These suggested actions are to be made in parallel with periodically updating the database with <code>modprobed-db store</code> to capture any newly loaded kernel module.
</p>
<h4><span class="mw-headline" id="Automatic_periodic_database_updates">Automatic periodic database updates</span></h4>
<p>Calls to <code>modprobed-db store</code> can be automated with one of the following methods:
</p>
<h5><span class="mw-headline" id="Cron">Cron</span></h5>
<p>The most convenient method to use modprobed-db is to simply add a crontab entry invoking <code>/usr/bin/modprobed-db store</code> at some regular interval.
</p>
<p>Example running the script once every hour:
</p>
<pre>$ crontab -e
0 */1 * * *   /usr/bin/modprobed-db store &amp;&gt; /dev/null
</pre>
<h5><span class="mw-headline" id="systemd">systemd</span></h5>
<p>Instead of cron, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable/start">enable/start</a> the <code>modprobed-db.service</code> <a href="../en/Systemd/User.html" class="mw-redirect" title="User unit">user unit</a>. It will run modprobed-db in store mode once per 6 hours, and at boot and on shutdown.
</p>
<p>Like any service and timer, the <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Unit status">status</a> of the <code>modprobed-db.service</code> <a href="../en/Systemd/User.html" class="mw-redirect" title="User unit">user unit</a> can be queried.
</p>
<h4><span class="mw-headline" id="Manually_editing_the_database">Manually editing the database</span></h4>
<p>Using the <a href="#Automatic_periodic_database_updates">#Automatic periodic database updates</a> or manually running <code>modprobed-db store</code> is not entirely foolproof:
</p>
<ul>
<li>Some modules get loaded then unloaded between two periodic database updates and may not be captured.</li>
<li>Some modules are used during boot and are not captured by <code>modprobed-db</code> (e.g. <code>efivarfs</code>), they need to be manually added to the <code>modprobed.db</code> file.</li>
</ul>
<p>Thankfully, the <code>modprobed.db</code> database file is a simple text file that contains one kernel module name per line: it can be manually edited to add/remove a module. It is then recommended to run <code>modprobed-db store</code> after a manual edit so the modules get automatically reordered.
</p>
<h5><span class="mw-headline" id="Recommended_modules">Recommended modules</span></h5>
<p>These modules are recommended to be added to the <code>$XDG_CONFIG_HOME/modprobed.db</code> database file as they are broadly used:
</p>
<ul>
<li>
<code>ext4</code>, <code>fat</code>, <code>vfat</code>: to support common <a href="../en/File_systems.html" title="File systems">file systems</a> and the <a href="../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a>
</li>
<li>
<code>nls_ascii</code>, <code>nls_cp437</code>: to support mounting the <a href="../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a>. This is required on <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/linux-xanmod/">linux-xanmod</a></span><sup><small>AUR</small></sup>, on other kernels they may be built-in.</li>
<li>
<code>loop</code>: to mount a file as a file system</li>
<li>
<code>isofs</code>: to mount ISO files</li>
<li>
<code>cifs</code>: for network filesystems like <a href="../en/Samba.html" title="Samba">Samba</a>
</li>
<li>
<code>efivarfs</code>: for mounting the <a href="../en/Unified_Extensible_Firmware_Interface.html#UEFI_variables" class="mw-redirect" title="UEFI">UEFI#UEFI variables</a> file system</li>
<li>
<code>usb_storage</code>: to support <a href="../en/USB_storage_devices.html" title="USB storage devices">USB storage devices</a>
</li>
<li>
<code>usbhid</code>: to support USB input devices</li>
</ul>
<h3><span class="mw-headline" id="Building_a_kernel_with_modprobed-db">Building a kernel with modprobed-db</span></h3>
<p>After the database has been adequately populated, it can be read directly by <a rel="nofollow" class="external text" href="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/README?id=refs/tags/v4.3.3#n205">make localmodconfig</a>.
</p>
<h4><span class="mw-headline" id="Traditional_compilation">Traditional compilation</span></h4>
<p><code>modprobed-db</code> naturally intervenes in a <a href="../en/Kernel/Traditional_compilation.html" title="Kernel/Traditional compilation">traditional compilation workflow</a> during the configuration step with the <a href="../en/Kernel/Traditional_compilation.html#Default_Arch_configuration" title="Kernel/Traditional compilation">default Arch .config file</a>.
</p>
<h4><span class="mw-headline" id="Using_the_official_Arch_kernel_PKGBUILD">Using the official Arch kernel PKGBUILD</span></h4>
<p>The official Arch kernel <code>PKGBUILD</code> can be modified as shown to do this automatically:
</p>
<pre>...
    msg2 "Applying patch $src..."
    patch -Np1 &lt; "../$src"
  done

  msg2 "Setting config..."
  cp ../config .config
  make olddefconfig

  <b>yes "" | make LSMOD=$HOME/.config/modprobed.db localmodconfig</b>

  make -s kernelrelease &gt; ../version
...</pre>
<h4><span class="mw-headline" id="Using_linux-tkg">Using linux-tkg</span></h4>
<p><a rel="nofollow" class="external text" href="https://github.com/Frogging-Family/linux-tkg">linux-tkg</a> offers a user-friendly kernel build script that also includes extra patches oriented towards improving desktop/gaming performance. The use of <code>modprobed-db</code>'s database to strip unneeded modules can be toggled in its configuration file.
</p>
<h2>
<span id="Benefits_of_modprobed-db_with_.22make_localmodconfig.22_in_custom_kernels"></span><span class="mw-headline" id='Benefits_of_modprobed-db_with_"make_localmodconfig"_in_custom_kernels'>Benefits of modprobed-db with "make localmodconfig" in custom kernels</span>
</h2>
<ol>
<li>Significantly reduced compilation time</li>
<li>Unneeded modules are not built, the saved disk space is negligible for desktop computers as it is a relatively small gain (few hundred megabytes).</li>
</ol>
<p>Comparisons using kernel version 5.13.1, where a <a href="../en/Kernel/Traditional_compilation.html" title="Kernel/Traditional compilation">Kernel/Traditional compilation</a> is made with the default Arch configuration.
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Machine CPU</th>
<th># of threads</th>
<th>Compiler</th>
<th>make localmodconfig</th>
<th># of Modules</th>
<th>Total Compilation Time</th>
<th>Kernel Compilation Time</th>
<th>Modules Compilation Time
</th>
</tr>
<tr>
<td>Ryzen 5950X @ 4.55 GHz</td>
<td>32</td>
<td>GCC 11.1.0</td>
<td>No</td>
<td>5442</td>
<td>5m 12s</td>
<td>58s</td>
<td>4m 14s
</td>
</tr>
<tr>
<td>Ryzen 5950X @ 4.55 GHz</td>
<td>32</td>
<td>GCC 11.1.0</td>
<td>Yes</td>
<td>227</td>
<td>1m 32s</td>
<td>57s</td>
<td>35s
</td>
</tr>
<tr>
<td>Ryzen 5950X @ 4.55 GHz</td>
<td>32</td>
<td>Clang 12.0.1</td>
<td>No</td>
<td>5442</td>
<td>9m 5s</td>
<td>1m 13s</td>
<td>7m 52s
</td>
</tr>
<tr>
<td>Ryzen 5950X @ 4.55 GHz</td>
<td>32</td>
<td>Clang 12.0.1</td>
<td>Yes</td>
<td>227</td>
<td>2m 13s</td>
<td>1m 13s</td>
<td>1m
</td>
</tr>
</tbody>
</table>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> These results do not prove that GCC is faster than Clang at building the kernel. The GCC version used in these benchmarks is self built and optimized.</div>
<p>The main results of the benchmark is that 80% of the build time of a "full" kernel is spent on modules. Given that only a fraction of those modules are needed by any given machine, the build time can be reduced by ~70%. The results will vary from one machine to another but should be similar.
</p>
<p>The number of modules can be determined by the following:
</p>
<pre>$ cd /lib/modules/15.13.1-your-custom-kernel
$ find -name '*.ko*' | wc -l
</pre>
<p>The kernel build time is obtained with:
</p>
<pre>$ time make -jx bzImage # Replace "x" with the wanted number of threads
</pre>
<p>then the modules build time is obtained with:
</p>
<pre>$ time make -jx modules # Replace "x" with the wanted number of threads
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li>
<a rel="nofollow" class="external free" href="https://docs.kernel.org/admin-guide/README.html#configuring-the-kernel">https://docs.kernel.org/admin-guide/README.html#configuring-the-kernel</a> for documentation for <code>make localmodconfig</code>
</li>
<li>
<a rel="nofollow" class="external free" href="https://docs.kernel.org/kbuild/kconfig.html">https://docs.kernel.org/kbuild/kconfig.html</a> and the parent directory</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Kernel.html" title="Category:Kernel">Kernel</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Modprobed-db&amp;oldid=811690">https://wiki.archlinux.org/index.php?title=Modprobed-db&amp;oldid=811690</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 1 July 2024, at 06:40.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
