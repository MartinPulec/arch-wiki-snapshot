<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Samba - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Samba rootpage-Samba skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Server" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Server">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Server</div>
		</a>
		
			<button aria-controls="toc-Server-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Server subsection</span>
			</button>
		
		<ul id="toc-Server-sublist" class="vector-toc-list">
			<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Installation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Installation</div>
			</a>
			
			<ul id="toc-Installation-sublist" class="vector-toc-list">
				<li id="toc-Enabling_and_starting_services" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Enabling_and_starting_services">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1.1</span>Enabling and starting services</div>
			</a>
			
			<ul id="toc-Enabling_and_starting_services-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Make_the_server_discoverable" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Make_the_server_discoverable">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1.2</span>Make the server discoverable</div>
			</a>
			
			<ul id="toc-Make_the_server_discoverable-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Configure_firewall" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Configure_firewall">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1.3</span>Configure firewall</div>
			</a>
			
			<ul id="toc-Configure_firewall-sublist" class="vector-toc-list">
				<li id="toc-UFW_Rule" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#UFW_Rule">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1.3.1</span>UFW Rule</div>
			</a>
			
			<ul id="toc-UFW_Rule-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-firewalld_service" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#firewalld_service">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1.3.2</span>firewalld service</div>
			</a>
			
			<ul id="toc-firewalld_service-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Basic_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Basic_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Basic configuration</div>
			</a>
			
			<ul id="toc-Basic_configuration-sublist" class="vector-toc-list">
				<li id="toc-User_management" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#User_management">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2.1</span>User management</div>
			</a>
			
			<ul id="toc-User_management-sublist" class="vector-toc-list">
				<li id="toc-Adding_a_user" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Adding_a_user">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2.1.1</span>Adding a user</div>
			</a>
			
			<ul id="toc-Adding_a_user-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Listing_users" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Listing_users">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2.1.2</span>Listing users</div>
			</a>
			
			<ul id="toc-Listing_users-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Changing_user_password" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Changing_user_password">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2.1.3</span>Changing user password</div>
			</a>
			
			<ul id="toc-Changing_user_password-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Creating_an_anonymous_share" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Creating_an_anonymous_share">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2.2</span>Creating an anonymous share</div>
			</a>
			
			<ul id="toc-Creating_an_anonymous_share-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Advanced_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Advanced_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Advanced configuration</div>
			</a>
			
			<ul id="toc-Advanced_configuration-sublist" class="vector-toc-list">
				<li id="toc-Enable_symlink_following" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Enable_symlink_following">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.1</span>Enable symlink following</div>
			</a>
			
			<ul id="toc-Enable_symlink_following-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enable_server-side_copy_for_macOS_clients" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Enable_server-side_copy_for_macOS_clients">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.2</span>Enable server-side copy for macOS clients</div>
			</a>
			
			<ul id="toc-Enable_server-side_copy_for_macOS_clients-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enable_Usershares" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Enable_Usershares">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.3</span>Enable Usershares</div>
			</a>
			
			<ul id="toc-Enable_Usershares-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Set_and_forcing_permissions" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Set_and_forcing_permissions">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.4</span>Set and forcing permissions</div>
			</a>
			
			<ul id="toc-Set_and_forcing_permissions-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Restrict_protocols_for_better_security" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Restrict_protocols_for_better_security">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.5</span>Restrict protocols for better security</div>
			</a>
			
			<ul id="toc-Restrict_protocols_for_better_security-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Use_native_SMB_transport_encryption" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Use_native_SMB_transport_encryption">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.6</span>Use native SMB transport encryption</div>
			</a>
			
			<ul id="toc-Use_native_SMB_transport_encryption-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Disable_printer_sharing" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Disable_printer_sharing">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.7</span>Disable printer sharing</div>
			</a>
			
			<ul id="toc-Disable_printer_sharing-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Block_certain_file_extensions_on_Samba_share" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Block_certain_file_extensions_on_Samba_share">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.8</span>Block certain file extensions on Samba share</div>
			</a>
			
			<ul id="toc-Block_certain_file_extensions_on_Samba_share-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Improve_throughput" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Improve_throughput">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.9</span>Improve throughput</div>
			</a>
			
			<ul id="toc-Improve_throughput-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enable_access_for_old_clients/devices" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Enable_access_for_old_clients/devices">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.10</span>Enable access for old clients/devices</div>
			</a>
			
			<ul id="toc-Enable_access_for_old_clients/devices-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enable_Spotlight_searching" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Enable_Spotlight_searching">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.11</span>Enable Spotlight searching</div>
			</a>
			
			<ul id="toc-Enable_Spotlight_searching-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Client" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Client">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Client</div>
		</a>
		
			<button aria-controls="toc-Client-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Client subsection</span>
			</button>
		
		<ul id="toc-Client-sublist" class="vector-toc-list">
			<li id="toc-List_public_shares" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#List_public_shares">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>List public shares</div>
			</a>
			
			<ul id="toc-List_public_shares-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-NetBIOS/WINS_host_names" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#NetBIOS/WINS_host_names">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>NetBIOS/WINS host names</div>
			</a>
			
			<ul id="toc-NetBIOS/WINS_host_names-sublist" class="vector-toc-list">
				<li id="toc-Disable_NetBIOS/WINS_support" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Disable_NetBIOS/WINS_support">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.1</span>Disable NetBIOS/WINS support</div>
			</a>
			
			<ul id="toc-Disable_NetBIOS/WINS_support-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Manual_mounting" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Manual_mounting">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Manual mounting</div>
			</a>
			
			<ul id="toc-Manual_mounting-sublist" class="vector-toc-list">
				<li id="toc-Storing_share_passwords" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Storing_share_passwords">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.1</span>Storing share passwords</div>
			</a>
			
			<ul id="toc-Storing_share_passwords-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Automatic_mounting" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Automatic_mounting">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4</span>Automatic mounting</div>
			</a>
			
			<ul id="toc-Automatic_mounting-sublist" class="vector-toc-list">
				<li id="toc-Using_NetworkManager_and_GIO/gvfs" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Using_NetworkManager_and_GIO/gvfs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4.1</span>Using NetworkManager and GIO/gvfs</div>
			</a>
			
			<ul id="toc-Using_NetworkManager_and_GIO/gvfs-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-As_mount_entry" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#As_mount_entry">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4.2</span>As mount entry</div>
			</a>
			
			<ul id="toc-As_mount_entry-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-As_systemd_unit" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#As_systemd_unit">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4.3</span>As systemd unit</div>
			</a>
			
			<ul id="toc-As_systemd_unit-sublist" class="vector-toc-list">
				<li id="toc-automount" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#automount">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4.3.1</span>automount</div>
			</a>
			
			<ul id="toc-automount-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-smbnetfs" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#smbnetfs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4.4</span>smbnetfs</div>
			</a>
			
			<ul id="toc-smbnetfs-sublist" class="vector-toc-list">
				<li id="toc-Daemon" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Daemon">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4.4.1</span>Daemon</div>
			</a>
			
			<ul id="toc-Daemon-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-autofs" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#autofs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4.5</span>autofs</div>
			</a>
			
			<ul id="toc-autofs-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-File_manager_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#File_manager_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.5</span>File manager configuration</div>
			</a>
			
			<ul id="toc-File_manager_configuration-sublist" class="vector-toc-list">
				<li id="toc-GNOME_Files,_Nemo,_Caja,_Thunar_and_PCManFM" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#GNOME_Files,_Nemo,_Caja,_Thunar_and_PCManFM">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.5.1</span>GNOME Files, Nemo, Caja, Thunar and PCManFM</div>
			</a>
			
			<ul id="toc-GNOME_Files,_Nemo,_Caja,_Thunar_and_PCManFM-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-KDE" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#KDE">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.5.2</span>KDE</div>
			</a>
			
			<ul id="toc-KDE-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Other_graphical_environments" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Other_graphical_environments">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.5.3</span>Other graphical environments</div>
			</a>
			
			<ul id="toc-Other_graphical_environments-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Tips and tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Discovering_network_shares" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Discovering_network_shares">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Discovering network shares</div>
			</a>
			
			<ul id="toc-Discovering_network_shares-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Remote_control_of_Windows_computer" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Remote_control_of_Windows_computer">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Remote control of Windows computer</div>
			</a>
			
			<ul id="toc-Remote_control_of_Windows_computer-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Failed_to_start_Samba_SMB/CIFS_server" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Failed_to_start_Samba_SMB/CIFS_server">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Failed to start Samba SMB/CIFS server</div>
			</a>
			
			<ul id="toc-Failed_to_start_Samba_SMB/CIFS_server-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Permission_issues_on_SELinux" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Permission_issues_on_SELinux">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Permission issues on SELinux</div>
			</a>
			
			<ul id="toc-Permission_issues_on_SELinux-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Permission_issues_on_AppArmor" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Permission_issues_on_AppArmor">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Permission issues on AppArmor</div>
			</a>
			
			<ul id="toc-Permission_issues_on_AppArmor-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-No_dialect_specified_on_mount" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#No_dialect_specified_on_mount">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>No dialect specified on mount</div>
			</a>
			
			<ul id="toc-No_dialect_specified_on_mount-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Unable_to_overwrite_files,_permissions_errors" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Unable_to_overwrite_files,_permissions_errors">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.5</span>Unable to overwrite files, permissions errors</div>
			</a>
			
			<ul id="toc-Unable_to_overwrite_files,_permissions_errors-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Windows_clients_keep_asking_for_password_even_if_Samba_shares_are_created_with_guest_permissions" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Windows_clients_keep_asking_for_password_even_if_Samba_shares_are_created_with_guest_permissions">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.6</span>Windows clients keep asking for password even if Samba shares are created with guest permissions</div>
			</a>
			
			<ul id="toc-Windows_clients_keep_asking_for_password_even_if_Samba_shares_are_created_with_guest_permissions-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-Windows_10_1709_and_up_connectivity_problems_-_"Windows_cannot_access"_0x80004005' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#Windows_10_1709_and_up_connectivity_problems_-_"Windows_cannot_access"_0x80004005'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.7</span>Windows 10 1709 and up connectivity problems - "Windows cannot access" 0x80004005</div>
			</a>
			
			<ul id='toc-Windows_10_1709_and_up_connectivity_problems_-_"Windows_cannot_access"_0x80004005-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Error:_Failed_to_retrieve_printer_list:_NT_STATUS_UNSUCCESSFUL" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Error:_Failed_to_retrieve_printer_list:_NT_STATUS_UNSUCCESSFUL">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.8</span>Error: Failed to retrieve printer list: NT_STATUS_UNSUCCESSFUL</div>
			</a>
			
			<ul id="toc-Error:_Failed_to_retrieve_printer_list:_NT_STATUS_UNSUCCESSFUL-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Sharing_a_folder_fails" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Sharing_a_folder_fails">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.9</span>Sharing a folder fails</div>
			</a>
			
			<ul id="toc-Sharing_a_folder_fails-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-"Browsing"_network_fails_with_"Failed_to_retrieve_share_list_from_server"' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#"Browsing"_network_fails_with_"Failed_to_retrieve_share_list_from_server"'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.10</span>"Browsing" network fails with "Failed to retrieve share list from server"</div>
			</a>
			
			<ul id='toc-"Browsing"_network_fails_with_"Failed_to_retrieve_share_list_from_server"-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Protocol_negotiation_failed:_NT_STATUS_INVALID_NETWORK_RESPONSE" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Protocol_negotiation_failed:_NT_STATUS_INVALID_NETWORK_RESPONSE">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.11</span>Protocol negotiation failed: NT_STATUS_INVALID_NETWORK_RESPONSE</div>
			</a>
			
			<ul id="toc-Protocol_negotiation_failed:_NT_STATUS_INVALID_NETWORK_RESPONSE-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Connection_to_SERVER_failed:_(Error_NT_STATUS_UNSUCCESSFUL)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connection_to_SERVER_failed:_(Error_NT_STATUS_UNSUCCESSFUL)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.12</span>Connection to SERVER failed: (Error NT_STATUS_UNSUCCESSFUL)</div>
			</a>
			
			<ul id="toc-Connection_to_SERVER_failed:_(Error_NT_STATUS_UNSUCCESSFUL)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Connection_to_SERVER_failed:_(Error_NT_STATUS_CONNECTION_REFUSED)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connection_to_SERVER_failed:_(Error_NT_STATUS_CONNECTION_REFUSED)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.13</span>Connection to SERVER failed: (Error NT_STATUS_CONNECTION_REFUSED)</div>
			</a>
			
			<ul id="toc-Connection_to_SERVER_failed:_(Error_NT_STATUS_CONNECTION_REFUSED)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Protocol_negotiation_failed:_NT_STATUS_CONNECTION_RESET" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Protocol_negotiation_failed:_NT_STATUS_CONNECTION_RESET">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.14</span>Protocol negotiation failed: NT_STATUS_CONNECTION_RESET</div>
			</a>
			
			<ul id="toc-Protocol_negotiation_failed:_NT_STATUS_CONNECTION_RESET-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Password_Error_when_correct_credentials_are_given_(error_1326)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Password_Error_when_correct_credentials_are_given_(error_1326)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.15</span>Password Error when correct credentials are given (error 1326)</div>
			</a>
			
			<ul id="toc-Password_Error_when_correct_credentials_are_given_(error_1326)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Mapping_reserved_Windows_characters" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Mapping_reserved_Windows_characters">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.16</span>Mapping reserved Windows characters</div>
			</a>
			
			<ul id="toc-Mapping_reserved_Windows_characters-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Folder_shared_inside_graphical_environment_is_not_available_to_guests" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Folder_shared_inside_graphical_environment_is_not_available_to_guests">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.17</span>Folder shared inside graphical environment is not available to guests</div>
			</a>
			
			<ul id="toc-Folder_shared_inside_graphical_environment_is_not_available_to_guests-sublist" class="vector-toc-list">
				<li id="toc-Verify_correct_samba_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Verify_correct_samba_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.17.1</span>Verify correct samba configuration</div>
			</a>
			
			<ul id="toc-Verify_correct_samba_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Verify_correct_shared_folder_creation" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Verify_correct_shared_folder_creation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.17.2</span>Verify correct shared folder creation</div>
			</a>
			
			<ul id="toc-Verify_correct_shared_folder_creation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Verify_folder_access_by_guest" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Verify_folder_access_by_guest">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.17.3</span>Verify folder access by guest</div>
			</a>
			
			<ul id="toc-Verify_folder_access_by_guest-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Mount_error:_Host_is_down" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Mount_error:_Host_is_down">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.18</span>Mount error: Host is down</div>
			</a>
			
			<ul id="toc-Mount_error:_Host_is_down-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Software_caused_connection_abort" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Software_caused_connection_abort">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.19</span>Software caused connection abort</div>
			</a>
			
			<ul id="toc-Software_caused_connection_abort-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Connection_problem_(due_to_authentification_error)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connection_problem_(due_to_authentification_error)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.20</span>Connection problem (due to authentification error)</div>
			</a>
			
			<ul id="toc-Connection_problem_(due_to_authentification_error)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Windows_1709_or_up_does_not_discover_the_samba_server_in_Network_view" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Windows_1709_or_up_does_not_discover_the_samba_server_in_Network_view">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.21</span>Windows 1709 or up does not discover the samba server in Network view</div>
			</a>
			
			<ul id="toc-Windows_1709_or_up_does_not_discover_the_samba_server_in_Network_view-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-GNOME_Files_not_showing_Windows_machines_(version_1709_or_up)_with_shared_folders_in_Network_view" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#GNOME_Files_not_showing_Windows_machines_(version_1709_or_up)_with_shared_folders_in_Network_view">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.22</span>GNOME Files not showing Windows machines (version 1709 or up) with shared folders in Network view</div>
			</a>
			
			<ul id="toc-GNOME_Files_not_showing_Windows_machines_(version_1709_or_up)_with_shared_folders_in_Network_view-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-iOS/iPadOS_Files_can_no_longer_copy-to_Samba_share_on_Arch_Linux_beginning_with_iOS/iPadOS_14.5" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#iOS/iPadOS_Files_can_no_longer_copy-to_Samba_share_on_Arch_Linux_beginning_with_iOS/iPadOS_14.5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.23</span>iOS/iPadOS Files can no longer copy-to Samba share on Arch Linux beginning with iOS/iPadOS 14.5</div>
			</a>
			
			<ul id="toc-iOS/iPadOS_Files_can_no_longer_copy-to_Samba_share_on_Arch_Linux_beginning_with_iOS/iPadOS_14.5-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Slow_initial_connections_from_certain_clients_without_other_performance_problems" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Slow_initial_connections_from_certain_clients_without_other_performance_problems">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.24</span>Slow initial connections from certain clients without other performance problems</div>
			</a>
			
			<ul id="toc-Slow_initial_connections_from_certain_clients_without_other_performance_problems-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-CUPS_managed_printers_are_not_listed" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#CUPS_managed_printers_are_not_listed">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.25</span>CUPS managed printers are not listed</div>
			</a>
			
			<ul id="toc-CUPS_managed_printers_are_not_listed-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Samba</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 5 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-5" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">5 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-de mw-list-item"><a href="https://wiki.archlinux.de/title/Samba" title="Samba – Deutsch" lang="de" hreflang="de" class="interlanguage-link-target"><span>Deutsch</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Samba" title="Samba – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Samba.html" title="Samba – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/Samba.html" title="Samba – português" lang="pt" hreflang="pt" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Samba" title="Samba – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Active_Directory_integration.html" class="mw-redirect" title="Active Directory Integration">Active Directory Integration</a></li>
<li><a href="../en/Samba/Active_Directory_domain_controller.html" title="Samba/Active Directory domain controller">Samba/Active Directory domain controller</a></li>
<li><a href="../en/NFS.html" title="NFS">NFS</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://www.samba.org/">Samba</a> is the standard Windows interoperability suite of programs for Linux and Unix. Since 1992, Samba has provided secure, stable and fast file and print services for all clients using the <a href="https://en.wikipedia.org/wiki/Server_Message_Block" class="extiw" title="wikipedia:Server Message Block">SMB/CIFS</a> protocol, such as all versions of DOS and Windows, OS/2, Linux and many others.
</p>
<p>To share files through Samba, see <a href="#Server">#Server</a> section; to access files shared through Samba on other machines, please see <a href="#Client">#Client</a> section.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Server">Server</span></h2>
<h3><span class="mw-headline" id="Installation">Installation</span></h3>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=samba">samba</a></span> package.
</p>
<p>Samba is configured in the <code>/etc/samba/smb.conf</code> configuration file, which is extensively documented in <span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5">smb.conf(5)</a></span>.
</p>
<p>Because the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=samba">samba</a></span> package does not provide this file, one needs to create it <b>before</b> starting <code>smb.service</code>.
</p>
<p>A documented example as in <code>smb.conf.default</code> from the <a rel="nofollow" class="external text" href="https://git.samba.org/samba.git/?p=samba.git;a=blob_plain;f=examples/smb.conf.default;hb=HEAD">Samba git repository</a> may be used to setup <code>/etc/samba/smb.conf</code>. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> See <a href="../en/Talk:Samba.html#logging_to_systemd" title="Talk:Samba">Talk:Samba#logging to systemd</a>. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Samba.html">Talk:Samba</a>)</div>
</div>
<ul>
<li>The default configuration sets <code>log file</code> to a non-writable location, which will cause errors - apply one of the following workarounds:
<ul>
<li>Change the log file location to a writable path: <code>log file = /var/log/samba/%m.log</code>
</li>
<li>Change logging to a non-file backend solution: <code>logging = syslog</code> with <code>syslog only = yes</code>, or use <code>logging = systemd</code>
</li>
</ul>
</li>
<li>If required; the <code>workgroup</code> specified in the <code>[global]</code> section has to match the Windows workgroup (default <code>WORKGROUP</code>).</li>
<li>The example configuration file exposes the user's home directory to the network with write access. If you see this as a security risk, consider commenting out the entire <code>[homes]</code> section. See <span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5#The_%5Bhomes%5D_section">smb.conf(5) § The [homes] section</a></span> for details.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Whenever you modify the <code>smb.conf</code> file, run the <span class="plainlinks archwiki-template-man" title="$ man 1 testparm"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/testparm.1">testparm(1)</a></span> command to check for syntactic errors.</div>
<h4><span class="mw-headline" id="Enabling_and_starting_services">Enabling and starting services</span></h4>
<p>To provide basic file sharing through SMB, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable/start">enable/start</a> <code>smb.service</code>. See <span class="plainlinks archwiki-template-man" title="$ man 8 smbd"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smbd.8">smbd(8)</a></span> for details.
</p>
<p>If you want to make your server accessible via NetBIOS host name, set the desired name in the <code>netbios name</code> option in <code>smb.conf</code> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable/start">enable/start</a> <code>nmb.service</code>. See <span class="plainlinks archwiki-template-man" title="$ man 8 nmbd"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nmbd.8">nmbd(8)</a></span> for details.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <code>nmb.service</code> is not required. However, it is needed to access Samba servers by hostname (e.g. <code>smb://hostname/</code>) for some hosts. If your network is only composed of machines running Windows 10 or later, consider <a href="#Windows_1709_or_up_does_not_discover_the_samba_server_in_Network_view">installing a WSD daemon as well</a> for your server to appear in the "Network" view.</div>
<h4><span class="mw-headline" id="Make_the_server_discoverable">Make the server discoverable</span></h4>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=avahi">avahi</a></span> package, then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable/start">enable/start</a> <code>avahi-daemon.service</code> to make the samba server discoverable with <a href="../en/Avahi.html" class="mw-redirect" title="Zeroconf">Zeroconf</a>. It should work for most non-Windows file managers (macOS Finder, various GUI-based file managers on Linux &amp; BSD etc.)
</p>
<p>If <code>avahi-daemon.service</code> is not running, the server will still be accessible, just not discoverable, i.e. it will not show up in file managers, but you can still connect to the server directly by IP or domain.
</p>
<p>Windows Explorer relies on the WS-Discovery protocol instead; see <a href="#Windows_1709_or_up_does_not_discover_the_samba_server_in_Network_view">#Windows 1709 or up does not discover the samba server in Network view</a>.
</p>
<h4><span class="mw-headline" id="Configure_firewall">Configure firewall</span></h4>
<p>If you are using a <a href="../en/Category:Firewalls.html" class="mw-redirect" title="Firewall">firewall</a>, do not forget to open required ports (usually 137-139 + 445). For a complete list, see <a rel="nofollow" class="external text" href="https://www.samba.org/~tpot/articles/firewall.html">Samba port usage</a>.
</p>
<h5><span class="mw-headline" id="UFW_Rule">UFW Rule</span></h5>
<p>A <a href="../en/Uncomplicated_Firewall.html" class="mw-redirect" title="Ufw">Ufw</a> App Profile for SMB/CIFS is included by default with the default installation of UFW in <code>ufw-fileserver</code>.
</p>
<p>Allow Samba by running <code>ufw allow CIFS</code> as root.
</p>
<p>If you deleted the profile, create/edit <code>/etc/ufw/applications.d/samba</code> and add the following content:
</p>
<pre>[Samba]
title=LanManager-like file and printer server for Unix
description=The Samba software suite is a collection of programs that implements the SMB/CIFS protocol for unix systems, allowing you to serve files and printers to Windows, NT, OS/2 and DOS clients. This protocol is sometimes also referred to as the LanManager or NetBIOS protocol.
ports=137,138/udp|139,445/tcp
</pre>
<p>Then load the profile into UFW run <code>ufw app update Samba</code> as root.
</p>
<p>Then finally, allow Samba by running <code>ufw allow Samba</code> as root.
</p>
<h5><span class="mw-headline" id="firewalld_service">firewalld service</span></h5>
<p>To configure <a href="../en/Firewalld.html" title="Firewalld">firewalld</a> to allow Samba in the <b>home</b> zone, run:
</p>
<pre># firewall-cmd --permanent --add-service={samba,samba-client,samba-dc} --zone=home
</pre>
<p>The three services listed are:
</p>
<ul>
<li>
<code>samba</code>: for sharing files with others.</li>
<li>
<code>samba-client</code>: to browse shares on other machines on the network.</li>
<li>
<code>samba-dc</code>: for <a href="../en/Samba/Active_Directory_domain_controller.html" title="Samba/Active Directory domain controller">Samba/Active Directory domain controller</a>.</li>
</ul>
<p><code>--permanent</code> ensures the changes remain after <code>firewalld.service</code> is <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restarted</a>.
</p>
<h3><span class="mw-headline" id="Basic_configuration">Basic configuration</span></h3>
<h4><span class="mw-headline" id="User_management">User management</span></h4>
<p>The following section describes creating a local (tdbsam) database of Samba users. For user authentication and other purposes, Samba can also be bound to an Active Directory domain, can itself serve as an Active Directory domain controller, or can be used with an LDAP server.
</p>
<h5><span class="mw-headline" id="Adding_a_user">Adding a user</span></h5>
<p>Samba requires a Linux user account - you may use an existing user account or create a <a href="../en/Users_and_groups.html#User_management" title="Users and groups">new one</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <a href="../en/Users_and_groups.html" class="mw-redirect" title="User">user</a>/<a href="../en/Users_and_groups.html#Group_management" class="mw-redirect" title="User group">user group</a> <i>nobody</i> should already exist on the system, it is used as the default <code>guest account</code> and may be used for shares containing <code>guest ok = yes</code>, thus preventing the need of user login on that share.</div>
<p>Although the user name is shared with Linux system, Samba uses a password separate from that of the Linux user accounts. Replace <code>samba_user</code> with the chosen Samba user account:
</p>
<pre># smbpasswd -a <i>samba_user</i>
</pre>
<p>Depending on the <a rel="nofollow" class="external text" href="https://www.samba.org/samba/docs/man/manpages-3/smb.conf.5.html#SERVERROLE">server role</a>, existing <a href="../en/File_permissions_and_attributes.html" title="File permissions and attributes">File permissions and attributes</a> may need to be altered for the Samba user account.
</p>
<p>If you want the new user only to be allowed to remotely access the file server shares through Samba, you can restrict other login options：
</p>
<ul>
<li>disabling shell - <code>usermod --shell /usr/bin/nologin --lock <i>samba_user</i></code>
</li>
<li>disabling SSH logons - edit <code>/etc/ssh/sshd_config</code>, change option <code>AllowUsers</code>
</li>
</ul>
<p>Also see <a href="../en/Security.html" title="Security">Security</a> for hardening your system.
</p>
<h5><span class="mw-headline" id="Listing_users">Listing users</span></h5>
<p>Samba users can be listed using the <span class="plainlinks archwiki-template-man" title="$ man 8 pdbedit"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pdbedit.8">pdbedit(8)</a></span> command:
</p>
<pre># pdbedit -L -v
</pre>
<h5><span class="mw-headline" id="Changing_user_password">Changing user password</span></h5>
<p>To change a user password, use <code>smbpasswd</code>:
</p>
<pre># smbpasswd <i>samba_user</i>
</pre>
<h4><span class="mw-headline" id="Creating_an_anonymous_share">Creating an anonymous share</span></h4>
<p>1. Create a Linux user which anonymous Samba users will be mapped to.
</p>
<pre># useradd guest -s /bin/nologin
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The username can be any valid Linux username, not just "guest". This user does not need to be a Samba user.</div>
<p>2. Add the following to <code>/etc/samba/smb.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
[global]
security = user
map to guest = bad user
guest account = guest

[guest_share]
    comment = guest share
    path = /tmp/
    public = yes
    only guest = yes
    writable = yes
    printable = no</pre>
<p>Anonymous users will now be mapped to the Linux user <code>guest</code> and have the ability to access any directories defined in <code>guest_share.path</code>, which is configured to be <code>/tmp/</code> in the example above.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The share name does not have to have "guest" in it. It can be any valid Samba share name.</div>
<p>Make sure that the Linux user <code>guest</code> has the proper permissions to access files in <code>guest_share.path</code>.
</p>
<p>Also, make sure shares have been properly defined as per the <i>Share Definitions</i> section of <a rel="nofollow" class="external text" href="https://git.samba.org/samba.git/?p=samba.git;a=blob_plain;f=examples/smb.conf.default;hb=HEAD">smb.conf.default</a>.
</p>
<h3><span class="mw-headline" id="Advanced_configuration">Advanced configuration</span></h3>
<h4><span class="mw-headline" id="Enable_symlink_following">Enable symlink following</span></h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Enabling the <code>follow symlinks</code> option can be a security risk.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
[global]
   follow symlinks = yes
   wide links = yes
   unix extensions = no</pre>
<p>Then, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>smb.service</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> When using <a href="../en/AppArmor.html" title="AppArmor">AppArmor</a>, if the symlink points to a directory outside the user's home or the <a href="#Enable_Usershares">usershare</a> directory, then you need to <a href="#Permission_issues_on_AppArmor">modify the AppArmor profile permissions</a>.</div>
<h4><span class="mw-headline" id="Enable_server-side_copy_for_macOS_clients">Enable server-side copy for macOS clients</span></h4>
<p>Server-side copy eliminates the need to transfer data between the server and the client when copying files on the server. This is enabled by default, but it doesn't work with macOS clients. If you have macOS clients, you need to add the following configuration to <code>smb.conf</code> and then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>smb.service</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
[global]
   fruit:copyfile = yes</pre>
<h4><span class="mw-headline" id="Enable_Usershares">Enable Usershares</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This is an optional feature. Skip this section if you do not need it.</div>
<p>Usershares is a feature that gives non-root users the capability to add, modify, and delete their own share definitions. See <span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5#USERSHARES">smb.conf(5) § USERSHARES</a></span>.
</p>
<ol>
<li>Create a directory for usershares: <pre># mkdir /var/lib/samba/usershares</pre>
</li>
<li>Create a <a href="../en/Users_and_groups.html#Group_management" class="mw-redirect" title="User group">user group</a>: <pre># groupadd -r sambashare</pre>
</li>
<li>Change the owner of the directory to <code>root</code> and the group to <code>sambashare</code>: <pre># chown root:sambashare /var/lib/samba/usershares</pre>
</li>
<li>Change the permissions of the <code>usershares</code> directory so that users in the group <code>sambashare</code> can create files. This command also sets <a href="https://en.wikipedia.org/wiki/Sticky_bit" class="extiw" title="wikipedia:Sticky bit">sticky bit</a>, which is important to prevent users from deleting usershares of other users: <pre># chmod 1770 /var/lib/samba/usershares</pre>
</li>
</ol>
<p>Set the following parameters in the <code>smb.conf</code> configuration file: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  usershare path = /var/lib/samba/usershares
  usershare max shares = 100
  usershare allow guests = yes
  usershare owner only = yes</pre>
<p>Add the user to the <i>sambashare</i> group. Replace <code><i>your_username</i></code> with the name of your user:
</p>
<pre># gpasswd sambashare -a <i>your_username</i>
</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Restart</a> <code>smb.service</code> and <code>nmb.service</code> services.
</p>
<p>Log out and log back in.
</p>
<p>If you want to share paths inside your home directory you must make it accessible for the group <i>others</i>.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Is this requirement correct? Not clear about which path is said: is it about a 'usershare path' option in smb.conf or an actual shared folder path? (Discuss in <a href="../en/Talk:Samba.html#permissions" title="Talk:Samba">Talk:Samba#permissions</a>)</div>
</div>
<p>In the GUI, you can use <a href="../en/Thunar.html" title="Thunar">Thunar</a> or <a href="../en/Dolphin.html" title="Dolphin">Dolphin</a> - right click on any directory and share it on the network. 
</p>
<p>In the CLI, use one of the following commands, replacing italic <i>sharename</i>, <i>user</i>, ... :
</p>
<pre># net usershare add <i>sharename</i> <i>abspath</i> [<i>comment</i>] [<i>user</i>:{R|D|F}] [guest_ok={y|n}]
# net usershare delete <i>sharename</i>
# net usershare list <i>wildcard-sharename</i>
# net usershare info <i>wildcard-sharename</i>
</pre>
<h4><span class="mw-headline" id="Set_and_forcing_permissions">Set and forcing permissions</span></h4>
<p>Permissions may be applied to both the server and shares:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  ;inherit owner = unix only ; Inherit ownership of the parent directory for new files and directories
  ;inherit permissions = yes ; Inherit permissions of the parent directory for new files and directories
  create mask = 0664
  directory mask = 2755
  force create mode = 0644
  force directory mode = 2755
  ...

[media]
  comment = Media share accessible by <i>greg</i> and <i>pcusers</i>
  path = <i>/path/to/media</i>
  valid users = <i>greg @pcusers</i>
  force group = <i>+pcusers</i>
  public = no
  writable = yes
  create mask = 0664
  directory mask = 2775
  force create mode = 0664
  force directory mode = 2775

[public]
  comment = Public share where <i>archie</i> has write access
  path = <i>/path/to/public</i>
  public = yes
  read only = yes
  write list = <i>archie</i>
  printable = no

[guests]
  comment = Allow all users to read/write
  path = <i>/path/to/guests</i>
  public = yes
  only guest = yes
  writable = yes
  printable = no</pre>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5">smb.conf(5)</a></span> for a full overview of possible permission flags and settings.
</p>
<h4><span class="mw-headline" id="Restrict_protocols_for_better_security">Restrict protocols for better security</span></h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> By default, Samba versions prior to 4.11 allow connections using the outdated and insecure SMB1 protocol. When using one these Samba versions, it is highly recommended to set <code>server min protocol = SMB2_02</code> to protect yourself from ransomware attacks. In Samba 4.11 and newer, SMB2 is the default min protocol, so no changes are required there.</div>
<p><a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">Append</a> <code>server min protocol</code> and <code>server max protocol</code> in <code>/etc/samba/smb.conf</code> to force usage of a minimum and maximum protocol:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  server min protocol = SMB2_10
  ; server max protocol = SMB3</pre>
<p>See <code>server max protocol</code> in <span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5">smb.conf(5)</a></span> for an overview of supported protocols. For compatibility with older clients and/or servers, you might need to set <code>client min protocol</code> or <code>server min protocol</code> to an older protocol, but please note that this makes you vulnerable to exploits.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Use <code>server min protocol = SMB3</code> when clients should only connect using the latest SMB3 protocol, e.g. on clients running Windows 10 and later.</div>
<p><a href="#Manual_mounting">Clients</a> using <code>mount.cifs</code> may need to specify the correct <code>vers=*</code>, e.g.:
</p>
<pre># mount -t cifs //<i>SERVER</i>/<i>sharename</i> /mnt/<i>mountpoint</i> -o username=<i>username</i>,password=<i>password</i>,iocharset=<i>utf8</i>,vers=<i>3.1.1</i>
</pre>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 8 mount.cifs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mount.cifs.8">mount.cifs(8)</a></span> for more information.
</p>
<h4><span class="mw-headline" id="Use_native_SMB_transport_encryption">Use native SMB transport encryption</span></h4>
<p>Native SMB transport encryption is available in SMB version 3.0 or newer. Clients supporting this type of encryption include Windows 8 and newer, Windows server 2012 and newer, and smbclient of Samba 4.1 and newer.
</p>
<p>To use native SMB transport encryption by default, set the <code>server smb encrypt</code> parameter globally and/or by share. Possible values are <code>off</code>, <code>enabled</code> (default value), <code>desired</code>, or <code>required</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  server smb encrypt = desired</pre>
<p>To configure encryption for on the client side, use the option <code>client smb encrypt</code>.
</p>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5">smb.conf(5)</a></span> for more information, especially the paragraphs <i>Effects for SMB1</i> and <i>Effects for SMB2</i>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> When <a href="#Manual_mounting">mounting</a> a share, specify the <code>seal</code> mount option to force usage of encryption.</div>
<h4><span class="mw-headline" id="Disable_printer_sharing">Disable printer sharing</span></h4>
<p>By default Samba shares printers configured using <a href="../en/CUPS.html" title="CUPS">CUPS</a>.
</p>
<p>If you do not want printers to be shared, use the following settings:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  load printers = no
  printing = bsd
  printcap name = /dev/null
  disable spoolss = yes
  show add printer wizard = no</pre>
<h4><span class="mw-headline" id="Block_certain_file_extensions_on_Samba_share">Block certain file extensions on Samba share</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Setting this parameter will affect the performance of Samba, as it will be forced to check all files and directories for a match as they are scanned.</div>
<p>Samba offers an option to block files with certain patterns, like file extensions. This option can be used to prevent dissemination of viruses or to dissuade users from wasting space with certain files. More information about this option can be found in <span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5">smb.conf(5)</a></span>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
[myshare]
  comment = Private
  path = /mnt/data
  read only = no
  veto files = /*.exe/*.com/*.dll/*.bat/*.vbs/*.tmp/*.mp3/*.avi/*.mp4/*.wmv/*.wma/</pre>
<h4><span class="mw-headline" id="Improve_throughput">Improve throughput</span></h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Beware this may lead to corruption/connection issues and potentially cripple your TCP/IP stack.</div>
<p>The default settings should be sufficient for most users. However setting the 'socket options' correct can improve performance, but getting them wrong can degrade it by just as much. Test the effect before making any large changes.
</p>
<p>Read the <span class="plainlinks archwiki-template-man" title="$ man 5 smb.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smb.conf.5">smb.conf(5)</a></span> man page before applying any of the options listed below.
</p>
<p>The following settings should be <a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">appended</a> to the <code>[global]</code> section of <code>/etc/samba/smb.conf</code>.
</p>
<p>Setting a deadtime is useful to stop a server's resources from being exhausted by a large number of inactive connections:
</p>
<pre>deadtime = 30
</pre>
<p>The usage of sendfile may make more efficient use of the system CPU's and cause Samba to be faster:
</p>
<pre>use sendfile = yes
</pre>
<p>Setting min receivefile size allows zero-copy writes directly from network socket buffers into the filesystem buffer cache (if available). It may improve performance but user testing is recommended:
</p>
<pre>min receivefile size = 16384
</pre>
<p>Increasing the receive/send buffers size and socket optimize flags might be useful to improve throughput. It is recommended to test each flag separately as it may cause issues on some networks:
</p>
<pre>socket options = IPTOS_LOWDELAY TCP_NODELAY IPTOS_THROUGHPUT SO_RCVBUF=131072 SO_SNDBUF=131072
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Network-interface adjustments may be needed for some options to work, see <a href="../en/Sysctl.html#Networking" title="Sysctl">Sysctl#Networking</a>.</div>
<h4>
<span id="Enable_access_for_old_clients.2Fdevices"></span><span class="mw-headline" id="Enable_access_for_old_clients/devices">Enable access for old clients/devices</span>
</h4>
<p>Latest versions of Samba no longer offer older authentication methods and protocols which are still used by some older clients (IP cameras, etc). These devices usually require Samba server to allow NTMLv1 authentication and NT1 version of the protocol, known as CIFS. For these devices to work with latest Samba, you need to add these two configuration parameters into <code>[global]</code> section:
</p>
<pre>server min protocol = NT1
ntlm auth = yes
</pre>
<p>Anonymous/guest access to a share requires just the first parameter. If the old device will access with username and password, you also need the add the second line too.
</p>
<h4><span class="mw-headline" id="Enable_Spotlight_searching">Enable Spotlight searching</span></h4>
<p>Spotlight allows supporting clients (e.g. MacOS Finder) to quickly search shared files.
</p>
<p>Install and start/enable <a href="../en/OpenSearch.html" title="OpenSearch">OpenSearch</a>. Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/fs2es-indexer/">fs2es-indexer</a></span><sup><small>AUR</small></sup>, configure the directories you want to index in <code>/etc/fs2es-indexer/config.yml</code>, and start/enable <code>fs2es-indexer.service</code> for periodic indexing.
</p>
<p>Edit <code>smb.conf</code> as described in the <a rel="nofollow" class="external text" href="https://wiki.samba.org/index.php/Spotlight_with_Elasticsearch_Backend#Samba">Samba wiki</a> to enable Spotlight per share, and restart <code>smb.service</code> to apply the changes.
</p>
<h2><span class="mw-headline" id="Client">Client</span></h2>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=smbclient">smbclient</a></span> for an <code>ftp</code>-like command line interface. See <span class="plainlinks archwiki-template-man" title="$ man 1 smbclient"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smbclient.1">smbclient(1)</a></span> for commonly used commands.
</p>
<p>For a lightweight alternative (without support for listing public shares, etc.), <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cifs-utils">cifs-utils</a></span> that provides <code>/usr/bin/mount.cifs</code>.
</p>
<p>Depending on the <a href="../en/Desktop_environment.html" title="Desktop environment">desktop environment</a>, GUI methods may be available. See <a href="#File_manager_configuration">#File manager configuration</a> for use with a file manager.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=smbclient">smbclient</a></span> requires a <code>/etc/samba/smb.conf</code> file (see <a href="#Installation">#Installation</a>), which you can create as an empty file using the <code>touch</code> utility.</li>
<li>After installing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cifs-utils">cifs-utils</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=smbclient">smbclient</a></span>, load the <code>cifs</code> <a href="../en/Kernel_module.html" title="Kernel module">kernel module</a> or reboot to prevent mount fails.</li>
</ul>
</div>
<h3><span class="mw-headline" id="List_public_shares">List public shares</span></h3>
<p>The following command lists public shares on a server:
</p>
<pre>$ smbclient -L <i>hostname</i> -U%
</pre>
<p>Alternatively, running <code>$ smbtree -N</code> will show a tree diagram of all the shares. It uses broadcast queries and is therefore not advisable on a network with a lot of computers, but can be helpful for diagnosing if you have the correct sharename. The <code>-N</code> (<code>-no-pass</code>) option suppresses the password prompt.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <code>smbtree</code> uses SMB1 and NetBIOS, which means they must be enabled on the servers and you need to set <code>client min protocol = NT1</code> in <code>smb.conf</code> on the client. Otherwise, <code>smbtree</code> will show empty output.</div>
<h3>
<span id="NetBIOS.2FWINS_host_names"></span><span class="mw-headline" id="NetBIOS/WINS_host_names">NetBIOS/WINS host names</span>
</h3>
<p>Samba clients handle NetBIOS host names automatically by default (the behavior is controlled by the <code>name resolve order</code> option in <code>smb.conf</code>). Other programs (including <code>mount.cifs</code>) typically use <a href="../en/Domain_name_resolution.html#Name_Service_Switch" class="mw-redirect" title="Name Service Switch">Name Service Switch</a>, which does not handle NetBIOS by default.
</p>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=smbclient">smbclient</a></span> package provides a libnss driver to resolve NetBIOS host names. To use it, <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> it along with the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=samba">samba</a></span> package (which provides the <i>winbindd</i> daemon), <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">start/enable</a> <code>winbind.service</code> and add <code>wins</code> to the <code>hosts</code> line in <span class="plainlinks archwiki-template-man" title="$ man 5 nsswitch.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nsswitch.conf.5">nsswitch.conf(5)</a></span>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nsswitch.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
hosts: mymachines resolve [!UNAVAIL=return] files myhostname dns <b>wins</b>
...</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Due to a current mistake in <code>winbind.service</code>, you may have to modify the unit file as described in this <a rel="nofollow" class="external text" href="https://bugs.launchpad.net/ubuntu/+source/samba/+bug/1789097">bug-report</a>
</div>
<p>Now, during host resolving (e.g. when using <code>mount.cifs</code> or just <code>ping <i>netbios-name</i></code>), <i>winbindd</i> will resolve the host name by sending queries using NetBIOS Name Service (NBNS, also known as WINS) protocol.
</p>
<p>By default it sends a broadcast query to your local network. If you have a WINS server, you can add <code>wins server = <i>wins-server-ip</i></code> to <code>smb.conf</code> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>winbind.service</code>, then <i>winbindd</i> and other Samba clients will send unicast queries to the specified IP.
</p>
<p>If you want to resolve your local host name (specified in the <code>netbios name</code> option in <code>smb.conf</code>), <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">start/enable</a> <code>nmb.service</code>, which will handle incoming queries.
</p>
<p>You can test WINS resolution with <code>nmblookup</code>. By default it sends broadcast queries to your local network regardless of the <code>wins server</code> option.
</p>
<p>Note that WINS resolution requires incoming traffic originating from port 137.
</p>
<h4>
<span id="Disable_NetBIOS.2FWINS_support"></span><span class="mw-headline" id="Disable_NetBIOS/WINS_support">Disable NetBIOS/WINS support</span>
</h4>
<p>When not using NetBIOS/WINS host name resolution, it may be preferred to disable this protocol:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  disable netbios = yes
  dns proxy = no</pre>
<p>Finally <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Disable">disable</a>/<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Stop">stop</a> <code>winbind.service</code>.
</p>
<h3><span class="mw-headline" id="Manual_mounting">Manual mounting</span></h3>
<p>Mount the share using <code>mount.cifs</code> as <code>type</code>. Not all the options listed below are needed or desirable:
</p>
<pre># mount --mkdir -t cifs //<i>SERVER</i>/<i>sharename</i> /mnt/<i>mountpoint</i> -o username=<i>username</i>,password=<i>password</i>,workgroup=<i>workgroup</i>,iocharset=<i>utf8</i>,uid=<i>username</i>,gid=<i>group</i>
</pre>
<p>The options <code>uid</code> and <code>gid</code> corresponds to the local (e.g. client) <a href="../en/Users_and_groups.html" class="mw-redirect" title="User">user</a>/<a href="../en/Users_and_groups.html#Group_management" class="mw-redirect" title="User group">user group</a> to have read/write access on the given path.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>If the <code>uid</code> and <code>gid</code> being used does not match the user of the server, the <code>forceuid</code> and <code>forcegid</code> options may be helpful. However note permissions assigned to a file when <code>forceuid</code> or <code>forcegid</code> are in effect may not reflect the real (server) permissions. See the <i>File And Directory Ownership And Permissions</i> section in <span class="plainlinks archwiki-template-man" title="$ man 8 mount.cifs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mount.cifs.8#FILE_AND_DIRECTORY_OWNERSHIP_AND_PERMISSIONS">mount.cifs(8) § FILE AND DIRECTORY OWNERSHIP AND PERMISSIONS</a></span> for more information.</li>
<li>To mount a Windows share without authentication, use <code>"username=*"</code>.</li>
</ul>
</div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> 
Regardless of recommendation, there's no substantial evidence for the claimed I/O error risk. The warning was <a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php?title=Samba&amp;diff=prev&amp;oldid=254430">added without comment or reference in 2013</a> and challenged without defense in 2018. It's unclear whether it's true at all. (Discuss in <a href="../en/Talk:Samba.html#Unfounded_warning_regarding_I/O_errors_and_manual_mounting?" title="Talk:Samba">Talk:Samba#Unfounded warning regarding I/O errors and manual mounting?</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Using <code>uid</code> and/or <code>gid</code> as mount options may cause I/O errors, it is recommended to set/check correct <a href="../en/File_permissions_and_attributes.html" title="File permissions and attributes">File permissions and attributes</a> instead.</div>
<ul>
<li>
<code><i>SERVER</i></code> — The server name.</li>
<li>
<code><i>sharename</i></code> — The shared directory.</li>
<li>
<code><i>mountpoint</i></code> — The local directory where the share will be mounted.</li>
<li>
<code>[-o <i>options</i>]</code> — See <span class="plainlinks archwiki-template-man" title="$ man 8 mount.cifs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mount.cifs.8">mount.cifs(8)</a></span> for more information.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Abstain from using a trailing <code>/</code>. <code>//<i>SERVER</i>/<i>sharename</i><b>/</b></code> will not work.</li>
<li>If your mount does not work stable, stutters or freezes, try to enable different SMB protocol version with <code>vers=</code> option. For example, <code>vers=2.0</code> for Windows Vista mount.</li>
<li>If having timeouts on a mounted network share with cifs on a shutdown, see <a href="../en/Wpa_supplicant.html#Problem_with_mounted_network_shares_(cifs)_and_shutdown" title="Wpa supplicant">wpa_supplicant#Problem with mounted network shares (cifs) and shutdown</a>.</li>
</ul>
</div>
<h4><span class="mw-headline" id="Storing_share_passwords">Storing share passwords</span></h4>
<p>Storing passwords in a world readable file is not recommended. A safer method is to use a credentials file instead, e.g. inside <code>/etc/samba/credentials</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/credentials/share</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">username=<i>myuser</i>
password=<i>mypass</i></pre>
<p>For the mount command replace <code>username=myuser,password=mypass</code> with <code>credentials=/etc/samba/credentials/share</code>.
</p>
<p>The credential file should explicitly readable/writeable to root:
</p>
<pre># chown root:root /etc/samba/credentials
# chmod 700 /etc/samba/credentials
# chmod 600 /etc/samba/credentials/share
</pre>
<h3><span class="mw-headline" id="Automatic_mounting">Automatic mounting</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You may need to <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>systemd-networkd-wait-online.service</code> or <code> NetworkManager-wait-online.service</code> (depending on your setup) to proper enable booting on start-up.</div>
<h4>
<span id="Using_NetworkManager_and_GIO.2Fgvfs"></span><span class="mw-headline" id="Using_NetworkManager_and_GIO/gvfs">Using NetworkManager and GIO/gvfs</span>
</h4>
<p><a href="../en/NetworkManager.html#Network_services_with_NetworkManager_dispatcher" title="NetworkManager">NetworkManager</a> can be configured to run a script on network status change. This script uses the <i>gio</i> command so that it mounts the Samba shares automatically, the same way your file manager does, as explained <a href="#File_manager_configuration">below</a>. The script also safely unmounts the Samba shares before the relevant network connection is disabled by listening for the <code>pre-down</code> and <code>vpn-pre-down</code> events. Make the script is <a href="../en/Help:Reading.html#Make_executable" class="mw-redirect" title="Executable">executable</a> after creating it.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/dispatcher.d/30-samba.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh

# Find the connection UUID with "nmcli con show" in terminal.
# All NetworkManager connection types are supported: wireless, VPN, wired...
WANTED_CON_UUID="CHANGE-ME-NOW-9c7eff15-010a-4b1c-a786-9b4efa218ba9"

# The user the share will be mounted under
USER="yourusername"
# The path that appears in your file manager when you manually mount the share you want
SMB_URL="smb://servername/share"

# Get runtime user directory. If it does not exist, do nothing and just exit
XDG_RUNTIME_DIR=$(loginctl show-user --property=RuntimePath --value "$USER") || exit 0

if [ "$CONNECTION_UUID" = "$WANTED_CON_UUID" ]; then
    
    # Script parameter $1: network interface name, not used
    # Script parameter $2: dispatched event
    
    case "$2" in
        "up"|"vpn-up")
            su $USER -c "DBUS_SESSION_BUS_ADDRESS=unix:path=$XDG_RUNTIME_DIR/bus gio mount $SMB_URL"
            ;;
        "pre-down"|"vpn-pre-down")
            su $USER -c "DBUS_SESSION_BUS_ADDRESS=unix:path=$XDG_RUNTIME_DIR/bus gio mount -uf $SMB_URL"
            ;;
    esac
fi
</pre>
<p>Create a symlink inside <code>/etc/NetworkManager/dispatcher.d/pre-down</code> to catch the <code>pre-down</code> events:
</p>
<pre># ln -s /etc/NetworkManager/dispatcher.d/30-samba.sh /etc/NetworkManager/dispatcher.d/pre-down.d/30-samba.sh
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Since this script uses the user bus, it will only work if the user has active sessions. This means that the share will not mount automatically after boot if the connection is established before you are logged in.</div>
<h4><span class="mw-headline" id="As_mount_entry">As mount entry</span></h4>
<p>This is a simple example of a <code>cifs</code> <a href="../en/Fstab.html" title="Fstab">mount entry</a> that requires authentication:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">//<i>SERVER</i>/<i>sharename</i> /mnt/<i>mountpoint</i> cifs _netdev,nofail,username=<i>myuser</i>,password=<i>mypass</i> 0 0</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>See examples below on better security for authentication credentials</li>
<li>Spaces in sharename should be replaced by <code>\040</code> (ASCII code for space in octal). For example, <code>//<i>SERVER</i>/share name</code> on the command line should be <code>//<i>SERVER</i>/share\040name</code> in <code>/etc/fstab</code>.</li>
<li>To allow users to mount it as long as the mount point resides in a directory controllable by the user; i.e. the user's home, append the <code>users</code> mount option. The option is user<b>s</b> (plural). For other filesystem types handled by mount, this option is usually <i>user</i>; sans the "<b>s</b>".</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Use <code>x-systemd.automount</code> if you want them to be mounted only upon access. See <a href="../en/Fstab.html#Remote_file_system" title="Fstab">Fstab#Remote file system</a> for details.</div>
<h4><span class="mw-headline" id="As_systemd_unit">As systemd unit</span></h4>
<p>Create a new <code>.mount</code> file inside <code>/etc/systemd/system</code>, e.g. <code>mnt-myshare.mount</code>. See <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.mount"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.mount.5">systemd.mount(5)</a></span> for details.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Make sure the filename corresponds to the mountpoint you want to use.
E.g. the unit name <code>mnt-myshare.mount</code> can only be used if are going to mount the share under <code>/mnt/myshare</code>. Otherwise the following error might occur: <code>systemd[1]: mnt-myshare.mount: Where= setting does not match unit name. Refusing.</code>.</div>
<p><code>What=</code> path to share
</p>
<p><code>Where=</code> path to mount the share
</p>
<p><code>Options=</code> share mounting options
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Network mount units automatically acquire <code>After</code> dependencies on <code>remote-fs-pre.target</code>, <code>network.target</code> and <code>network-online.target</code>, and gain a <code>Before</code> dependency on <code>remote-fs.target</code> unless <code>nofail</code> mount option is set. Towards the latter a <code>Wants</code> unit is added as well.</li>
<li>
<a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">Append</a> <code>noauto</code> to <code>Options</code> preventing automatically mount during boot (unless it is pulled in by some other unit).</li>
<li>If you want to use a hostname for the server you want to share (instead of an IP address), add <code>nss-lookup.target</code> to <code>After</code>. This might avoid mount errors at boot time that do not arise when testing the unit.</li>
</ul>
</div> 
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/mnt-myshare.mount</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Mount Share at boot

[Mount]
What=//server/share
Where=/mnt/myshare
Options=_netdev,credentials=/etc/samba/credentials/myshare,iocharset=utf8,rw
Type=cifs
TimeoutSec=30

[Install]
WantedBy=multi-user.target</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>In case of an unreachable system, <a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">append</a> <code>ForceUnmount=true</code> to <code>[Mount]</code>, allowing the share to be (force-)unmounted.</li>
<li>If your share has groups with read-only access, <a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">append</a> <code>uid=<i>username</i></code> or <code>gid=<i>group</i></code> to <code>Options=</code>, to specify your user / group allowing writing to the share.</li>
</ul>
</div>
<p>To use <code>mnt-myshare.mount</code>, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> the unit and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> it to run on system boot.
</p>
<h5><span class="mw-headline" id="automount">automount</span></h5>
<p>To automatically mount a share (when accessed, like autofs), one may use the following automount unit:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/mnt-myshare.automount</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Automount myshare

[Automount]
Where=/mnt/myshare

[Install]
WantedBy=multi-user.target</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Disable">Disable</a>/<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Stop">stop</a> the <code>mnt-myshare.mount</code> unit, and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a>/<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> <code>mnt-myshare.automount</code> to automount the share when the mount path is being accessed.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> <a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">Append</a> <code>TimeoutIdleSec</code> to enable auto unmount. See <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.automount"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.automount.5">systemd.automount(5)</a></span> for details.</div>
<h4><span class="mw-headline" id="smbnetfs">smbnetfs</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> smbnetfs needs an intact Samba server setup.
See above on how to do that.</div>
<p>First, check if you can see all the shares you are interested in mounting:
</p>
<pre>$ smbtree -U <i>remote_user</i>
</pre>
<p>If that does not work, find and modify the following line
in <code>/etc/samba/smb.conf</code> accordingly:
</p>
<pre>domain master = auto
</pre>
<p>Now <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>smb.service</code> and <code>nmb.service</code>.
</p>
<p>If everything works as expected, <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=smbnetfs">smbnetfs</a></span>.
</p>
<p>Then, add the following line to <code>/etc/fuse.conf</code>:
</p>
<pre>user_allow_other
</pre>
<p>Now copy the directory <code>/etc/smbnetfs/.smb</code> to your home directory:
</p>
<pre>$ cp -a /etc/smbnetfs/.smb ~
</pre>
<p>Then create a link to <code>smb.conf</code>:
</p>
<pre>$ ln -sf /etc/samba/smb.conf ~/.smb/smb.conf
</pre>
<p>If a username and a password are required to access some of the shared folders, edit <code>~/.smb/smbnetfs.auth</code>
to include one or more entries like this:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.smb/smbnetfs.auth</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">auth			"hostname" "username" "password"
</pre>
<p>It is also possible to add entries for specific hosts to be mounted by smbnetfs, if necessary.
More details can be found in <code>~/.smb/smbnetfs.conf</code>.
</p>
<p>If you are using the <a href="../en/Dolphin.html" title="Dolphin">Dolphin</a> or <a href="../en/GNOME/Files.html" class="mw-redirect" title="GNOME Files">GNOME Files</a>, you may want to add the following to <code>~/.smb/smbnetfs.conf</code> to avoid "Disk full" errors as smbnetfs by default will report 0 bytes of free space:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.smb/smbnetfs.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">free_space_size 1073741824
</pre>
<p>When you are done with the configuration, you need to run
</p>
<pre>$ chmod 600 ~/.smb/smbnetfs.*
</pre>
<p>Otherwise, smbnetfs complains about 'insecure config file permissions'.
</p>
<p>Finally, to mount your Samba network neighbourhood to a directory of your choice, call
</p>
<pre>$ smbnetfs <i>mount_point</i>
</pre>
<h5><span class="mw-headline" id="Daemon">Daemon</span></h5>
<p>The Arch Linux package also maintains an additional system-wide operation mode for smbnetfs. To enable it, you need to make the
said modifications in the directory <code>/etc/smbnetfs/.smb</code>.
</p>
<p>Then, you can start and/or enable the <code>smbnetfs</code> <a href="../en/Systemd.html" class="mw-redirect" title="Daemon">daemon</a> as usual. The system-wide mount point is at <code>/mnt/smbnet/</code>.
</p>
<h4><span class="mw-headline" id="autofs">autofs</span></h4>
<p>See <a href="../en/Autofs.html" title="Autofs">Autofs</a> for information on the kernel-based automounter for Linux.
</p>
<h3><span class="mw-headline" id="File_manager_configuration">File manager configuration</span></h3>
<h4>
<span id="GNOME_Files.2C_Nemo.2C_Caja.2C_Thunar_and_PCManFM"></span><span class="mw-headline" id="GNOME_Files,_Nemo,_Caja,_Thunar_and_PCManFM">GNOME Files, Nemo, Caja, Thunar and PCManFM</span>
</h4>
<p>In order to access samba shares through GNOME Files, Nemo, Caja, Thunar or PCManFM, install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gvfs-smb">gvfs-smb</a></span> package.
</p>
<p>Press <code>Ctrl+l</code> and enter <code>smb://<i>servername</i>/<i>share</i></code> in the location bar to access your share.
</p>
<p>The mounted share is likely to be present at <code>/run/user/<i>your_UID</i>/gvfs</code> or <code>~/.gvfs</code> in the filesystem.
</p>
<h4><span class="mw-headline" id="KDE">KDE</span></h4>
<p>KDE applications (like Dolphin) has the ability to browse Samba shares built in. Use the path <code>smb://<i>servername</i>/<i>share</i></code> to browse the files. If you want to access files from on non-KDE application, you can install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=kio-fuse">kio-fuse</a></span>.
</p>
<p>To use a GUI in the KDE System Settings, you will need to install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=kdenetwork-filesharing">kdenetwork-filesharing</a></span> package.
</p>
<h4><span class="mw-headline" id="Other_graphical_environments">Other graphical environments</span></h4>
<p>There are a number of useful programs, but they may need to have packages created for them. This can be done with the Arch package build system. The good thing about these others is that they do not require a particular environment to be installed to support them, and so they bring along less baggage.
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pyneighborhood/">pyneighborhood</a></span><sup><small>AUR</small></sup>
</li>
<li>LinNeighborhood, RUmba, xffm-samba plugin for Xffm are not available in the official repositories or the AUR. As they are not officially (or even unofficially supported), they may be obsolete and may not work at all.</li>
</ul>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Discovering_network_shares">Discovering network shares</span></h3>
<p>If nothing is known about other systems on the local network, and automated tools such as <a href="#smbnetfs">smbnetfs</a> are not available, you can manually probe for Samba shares.
</p>
<p>First, <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nmap">nmap</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=smbclient">smbclient</a></span> packages.
</p>
<p>Use <a href="../en/Nmap.html" title="Nmap">nmap</a> to scan your local network to find systems with TCP port 445 open, which is the port used by the SMB protocol. Note that you may need to use <code>-Pn</code> or set a custom <a href="../en/Nmap.html#Ping_scan_types" title="Nmap">ping scan type</a> (e.g. <code>-PS445</code>) because Windows systems are usually firewalled.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nmap -p 445 "192.168.1.*"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-13 12:00 UTC
Nmap scan report for 192.168.1.1
Host is up (0.0011s latency).

PORT    STATE  SERVICE
445/tcp open  microsoft-ds

Nmap scan report for 192.168.1.2
Host is up (0.00011s latency).

PORT    STATE SERVICE
445/tcp open  microsoft-ds

Nmap done: 256 IP addresses (2 hosts up) scanned in 2.45 seconds
</pre>
<p>The first result is another system; the second happens to be the client from where this scan was performed.
</p>
<p>Now you can connect to their IP addresses directly, but if you want to use NetBIOS host names, you can use <span class="plainlinks archwiki-template-man" title="$ man 1 nmblookup"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nmblookup.1">nmblookup(1)</a></span> to check for NetBIOS names. Note that this will not work if NetBIOS is disabled on the server.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ nmblookup -A 192.168.1.1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Looking up status of 192.168.1.1
        PUTER           &lt;00&gt; -         B &lt;ACTIVE&gt;
        HOMENET         &lt;00&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;
        PUTER           &lt;03&gt; -         B &lt;ACTIVE&gt;
        <b>PUTER           &lt;20&gt; -         B &lt;ACTIVE&gt;</b>
        HOMENET         &lt;1e&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;
        USERNAME        &lt;03&gt; -         B &lt;ACTIVE&gt;
        HOMENET         &lt;1d&gt; -         B &lt;ACTIVE&gt;
        MSBROWSE        &lt;01&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;
</pre>
<p>Regardless of the output, look for <b>&lt;20&gt;</b>, which shows the host with open services.
</p>
<p>Use <span class="plainlinks archwiki-template-man" title="$ man 1 smbclient"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smbclient.1">smbclient(1)</a></span> to list which services are shared on these systems. You can use NetBIOS host name (<code>PUTER</code> in this example) instead of IP when available. If prompted for a password, pressing enter should still display the list:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ smbclient -L \\192.168.1.1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Sharename       Type      Comment
---------       ----      -------
MY_MUSIC        Disk
SHAREDDOCS      Disk
PRINTER$        Disk
PRINTER         Printer
IPC$            IPC       Remote Inter Process Communication

Server               Comment
---------            -------
PUTER

Workgroup            Master
---------            -------
HOMENET               PUTER
</pre>
<h3><span class="mw-headline" id="Remote_control_of_Windows_computer">Remote control of Windows computer</span></h3>
<p>Samba offers a set of tools for communication with Windows. These can be handy if access to a Windows computer through remote desktop is not an option, as shown by some examples.
</p>
<p>Send shutdown command with a comment:
</p>
<pre>$ net rpc shutdown -C "comment" -I IPADDRESS -U USERNAME%PASSWORD
</pre>
<p>A forced shutdown instead can be invoked by changing -C with comment to a single -f. For a restart, only add -r, followed by a -C or -f.
</p>
<p>Stop and start services:
</p>
<pre>$ net rpc service stop SERVICENAME -I IPADDRESS -U USERNAME%PASSWORD
</pre>
<p>To see all possible net rpc command:
</p>
<pre>$ net rpc
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3>
<span id="Failed_to_start_Samba_SMB.2FCIFS_server"></span><span class="mw-headline" id="Failed_to_start_Samba_SMB/CIFS_server">Failed to start Samba SMB/CIFS server</span>
</h3>
<p>Possible solutions:
</p>
<ul>
<li>Check <code>smb.conf</code> on syntactic errors with <span class="plainlinks archwiki-template-man" title="$ man 1 testparm"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/testparm.1">testparm(1)</a></span>.</li>
<li>Set correct permissions for <code>/var/cache/samba/</code> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>smb.service</code>:</li>
</ul>
<pre># chmod 0755 /var/cache/samba/msg
</pre>
<h3><span class="mw-headline" id="Permission_issues_on_SELinux">Permission issues on SELinux</span></h3>
<p><a href="../en/SELinux.html" title="SELinux">SELinux</a> not allow samba to access user home directories by default, to solve this, run:
</p>
<pre># setsebool -P samba_enable_home_dirs 1
</pre>
<p>Similarly, <code>samba_export_all_ro</code> and <code>samba_export_all_rw</code> make Samba has the ability to read or "read and write" all files.
</p>
<h3><span class="mw-headline" id="Permission_issues_on_AppArmor">Permission issues on AppArmor</span></h3>
<p>If using a <a href="#Creating_an_anonymous_share">share path</a> located outside of a home or usershares directory, whitelist it in <code>/etc/apparmor.d/local/usr.sbin.smbd</code>. E.g.:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/apparmor.d/local/usr.sbin.smbd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">"/data/" rk,
"/data/**" lrwk,
</pre>
<p>After editing, reload the AppArmor profile:
</p>
<pre># apparmor_parser -r /etc/apparmor.d/usr.sbin.smbd
</pre>
<h3><span class="mw-headline" id="No_dialect_specified_on_mount">No dialect specified on mount</span></h3>
<p>The client is using an unsupported SMB/CIFS version that is required by the server.
</p>
<p>See <a href="#Restrict_protocols_for_better_security">#Restrict protocols for better security</a> for more information.
</p>
<h3>
<span id="Unable_to_overwrite_files.2C_permissions_errors"></span><span class="mw-headline" id="Unable_to_overwrite_files,_permissions_errors">Unable to overwrite files, permissions errors</span>
</h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> An user should set/check for server/client permissions, instead of using incorrect/possible insecure flags. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Samba.html">Talk:Samba</a>)</div>
</div>
<p>Possible solutions:
</p>
<ul>
<li>Append the mount option <code>nodfs</code> to the <code>/etc/fstab</code> <a href="#As_mount_entry">entry</a>.</li>
<li>Add <code>msdfs root = no</code> to the <code>[global]</code> section of the server's <code>/etc/samba/smb.conf</code>.</li>
</ul>
<h3><span class="mw-headline" id="Windows_clients_keep_asking_for_password_even_if_Samba_shares_are_created_with_guest_permissions">Windows clients keep asking for password even if Samba shares are created with guest permissions</span></h3>
<p>Set <code>map to guest</code> inside the <code>global</code> section of <code>/etc/samba/smb.conf</code>:
</p>
<pre>map to guest = Bad Password
</pre>
<p>If you are still using Samba &lt; 4.10.10, use <code>Bad User</code> instead of <code>Bad Password</code>.
</p>
<h3>
<span id="Windows_10_1709_and_up_connectivity_problems_-_.22Windows_cannot_access.22_0x80004005"></span><span class="mw-headline" id='Windows_10_1709_and_up_connectivity_problems_-_"Windows_cannot_access"_0x80004005'>Windows 10 1709 and up connectivity problems - "Windows cannot access" 0x80004005</span>
</h3>
<p>This error affects some machines running Windows 10 version 1709 and later. It is not related to SMB1 being disabled in this version but to the fact that Microsoft disabled insecure logons for guests on this version for some, but not others.
</p>
<p>To fix, open Group Policy Editor (<code>gpedit.msc</code>). Navigate to <i>Computer configuration\administrative templates\network\Lanman Workstation &gt; Enable insecure guest logons</i> and enable it.
Alternatively,change the following value in the registry:
</p>
<pre>[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters]
"AllowInsecureGuestAuth"=dword:1
</pre>
<h3><span class="mw-headline" id="Error:_Failed_to_retrieve_printer_list:_NT_STATUS_UNSUCCESSFUL">Error: Failed to retrieve printer list: NT_STATUS_UNSUCCESSFUL</span></h3>
<p>If you are a home user and using samba purely for file sharing from a server or NAS, you are probably not interested in sharing printers through it. If so, you can prevent this error from occurring by adding the following lines to your <code>/etc/samba/smb.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  load printers = No
  printing = bsd
  printcap name = /dev/null
  disable spoolss = Yes</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Restart</a> the samba service, <code>smb.service</code>, and then check your logs:
</p>
<pre># cat /var/log/samba/smbd.log
</pre>
<p>and the error should now no longer be appearing.
</p>
<h3><span class="mw-headline" id="Sharing_a_folder_fails">Sharing a folder fails</span></h3>
<p>It means that while you are sharing a folder from <i>Dolphin</i> (file manager) and everything seems ok at first, after restarting <i>Dolphin</i> the share icon is gone from the shared folder, and also some output like this in terminal (<i>Konsole</i>) output:
</p>
<pre>‘net usershare’ returned error 255: net usershare: usershares are currently disabled
</pre>
<p>To fix it, enable usershare as described in <a href="#Enable_Usershares">#Enable Usershares</a>.
</p>
<h3>
<span id=".22Browsing.22_network_fails_with_.22Failed_to_retrieve_share_list_from_server.22"></span><span class="mw-headline" id='"Browsing"_network_fails_with_"Failed_to_retrieve_share_list_from_server"'>"Browsing" network fails with "Failed to retrieve share list from server"</span>
</h3>
<p>And you are using a firewall (iptables) because you do not trust your local (school, university, hotel) network.  This may be due to the following: When the smbclient is browsing the local network it sends out a broadcast request on udp port 137.  The servers on the network then reply to your client but as the source address of this reply is different from the destination address iptables saw when sending the request for the listing out, iptables will not recognize the reply as being "ESTABLISHED" or "RELATED", and hence the packet is dropped.  A possible solution is to add:
</p>
<pre>iptables -t raw -A OUTPUT -p udp -m udp --dport 137 -j CT --helper netbios-ns
</pre>
<p>to your iptables setup.
</p>
<p>For <a href="../en/Uncomplicated_Firewall.html" title="Uncomplicated Firewall">Uncomplicated Firewall</a>, you need to add <code>nf_conntrack_netbios_ns</code> to the end of the following line in <code>/etc/default/ufw</code>
</p>
<pre>IPT_MODULES="nf_conntrack_ftp nf_nat_ftp nf_conntrack_irc nf_nat_irc"
</pre>
<p>and then run the following commands as root:
</p>
<pre>echo 1 &gt; /proc/sys/net/netfilter/nf_conntrack_helper
ufw allow CIFS
ufw reload
</pre>
<p>To make this change persistent across reboots, add the following line at the end of <code>/etc/ufw/sysctl.conf</code>:
</p>
<pre>net.netfilter.nf_conntrack_helper=1
</pre>
<h3><span class="mw-headline" id="Protocol_negotiation_failed:_NT_STATUS_INVALID_NETWORK_RESPONSE">Protocol negotiation failed: NT_STATUS_INVALID_NETWORK_RESPONSE</span></h3>
<p>The client probably does not have access to shares.  Make sure clients' IP address is in <code>hosts allow =</code> line in <code>/etc/samba/smb.conf</code>.
</p>
<p>Another problem could be, that the client uses an invalid protocol version. To check this try to connect with the <code>smbclient</code> where you specify the maximum protocol version manually:
</p>
<pre>$ smbclient -U &lt;user name&gt; -L //&lt;server name&gt; -m &lt;protocol version: e. g. SMB2&gt; -W &lt;domain name&gt;
</pre>
<p>If the command was successful then create a configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.smb/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  workgroup = &lt;domain name&gt;
  client max protocol = SMB2</pre>
<h3>
<span id="Connection_to_SERVER_failed:_.28Error_NT_STATUS_UNSUCCESSFUL.29"></span><span class="mw-headline" id="Connection_to_SERVER_failed:_(Error_NT_STATUS_UNSUCCESSFUL)">Connection to SERVER failed: (Error NT_STATUS_UNSUCCESSFUL)</span>
</h3>
<p>You are probably passing a wrong server name to <code>smbclient</code>.  To find out the server name, run <code>hostnamectl</code> on the server and look at "Transient hostname" line
</p>
<h3>
<span id="Connection_to_SERVER_failed:_.28Error_NT_STATUS_CONNECTION_REFUSED.29"></span><span class="mw-headline" id="Connection_to_SERVER_failed:_(Error_NT_STATUS_CONNECTION_REFUSED)">Connection to SERVER failed: (Error NT_STATUS_CONNECTION_REFUSED)</span>
</h3>
<p>Make sure that the server has started. The shared directories should exist and be accessible.
</p>
<h3><span class="mw-headline" id="Protocol_negotiation_failed:_NT_STATUS_CONNECTION_RESET">Protocol negotiation failed: NT_STATUS_CONNECTION_RESET</span></h3>
<p>Probably the server is configured not to accept protocol SMB1. Add option <code>client max protocol = SMB2</code> in <code>/etc/samba/smb.conf</code>.
Or just pass argument <code>-m SMB2</code> to <code>smbclient</code>.
</p>
<h3>
<span id="Password_Error_when_correct_credentials_are_given_.28error_1326.29"></span><span class="mw-headline" id="Password_Error_when_correct_credentials_are_given_(error_1326)">Password Error when correct credentials are given (error 1326)</span>
</h3>
<p><a rel="nofollow" class="external text" href="https://www.samba.org/samba/history/samba-4.5.0.html">Samba 4.5</a> has NTLMv1 authentication disabled by default. It is recommend to install the latest available upgrades on clients and deny access for unsupported clients.
</p>
<p>If you still need support for very old clients without NTLMv2 support (e.g. Windows XP), it is possible force enable NTLMv1, although this is <b>not recommend</b> for security reasons:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  lanman auth = yes
  ntlm auth = yes</pre>
<p>If NTLMv2 clients are unable to authenticate when NTLMv1 has been enabled, create the following file on the client:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/home/user/.smb/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  sec = ntlmv2
  client ntlmv2 auth = yes</pre>
<p>This change also affects samba shares mounted with <b>mount.cifs</b>. If after upgrade to Samba 4.5 your mount fails, add the <b>sec=ntlmssp</b> option to your mount command, e.g.
</p>
<pre>mount.cifs //server/share /mnt/point -o sec=ntlmssp,...
</pre>
<p>See the <span class="plainlinks archwiki-template-man" title="$ man 8 mount.cifs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mount.cifs.8">mount.cifs(8)</a></span> man page: <b>ntlmssp</b> - Use NTLMv2 password hashing encapsulated in Raw NTLMSSP message. The default in mainline kernel versions prior to v3.8 was <b>sec=ntlm</b>. In v3.8, the default was changed to <b>sec=ntlmssp</b>.
</p>
<h3><span class="mw-headline" id="Mapping_reserved_Windows_characters">Mapping reserved Windows characters</span></h3>
<p>Starting with kernel 3.18, the cifs module uses the <a rel="nofollow" class="external text" href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=2baa2682531ff02928e2d3904800696d9e7193db">"mapposix" option by default</a>.
When mounting a share using unix extensions and a default Samba configuration, files and directories containing one of the seven reserved Windows characters <code>: \ * &lt; &gt; ? </code> are listed but cannot be accessed.
</p>
<p>Possible solutions are:
</p>
<ul><li>Use the undocumented <code>nomapposix</code> mount option for cifs</li></ul>
<pre># mount.cifs //server/share /mnt/point -o nomapposix
</pre>
<ul><li>Configure Samba to remap <code>mapposix</code> ("SFM", Services for Mac) style characters to the correct native ones using <a rel="nofollow" class="external text" href="https://www.mankier.com/8/vfs_fruit">fruit</a>
</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  vfs objects = catia fruit
  fruit:encoding = native</pre>
<ul><li>Manually remap forbidden characters using <a rel="nofollow" class="external text" href="https://www.mankier.com/8/vfs_catia">catia</a>
</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
  vfs objects = catia
  catia:mappings = 0x22:0xf022, 0x2a:0xf02a, 0x2f:0xf02f, 0x3a:0xf03a, 0x3c:0xf03c, 0x3e:0xf03e, 0x3f:0xf03f, 0x5c:0xf05c, 0x7c:0xf07c, 0x20:0xf020</pre>
<p>The latter approach (using catia or fruit) has the drawback of filtering files with unprintable characters.
</p>
<h3><span class="mw-headline" id="Folder_shared_inside_graphical_environment_is_not_available_to_guests">Folder shared inside graphical environment is not available to guests</span></h3>
<p>This section presupposes:
</p>
<ol>
<li>Usershares are configured following <a href="#Enable_Usershares">previous section</a>
</li>
<li>A shared folder has been created as a non-root user from GUI</li>
<li>Guests access has been set to shared folder during creation</li>
<li>Samba service has been restarted at least once since last <code>/etc/samba/smb.conf</code> file modification</li>
</ol>
<p>For clarification purpose only, in the following sub-sections is assumed:
</p>
<ul>
<li>Shared folder is located inside user home directory path (<code>/home/yourUser/Shared</code>)</li>
<li>Shared folder name is <i>MySharedFiles</i>
</li>
<li>Guest access is read-only.</li>
<li>Windows users will access shared folder content without login prompt</li>
</ul>
<h4><span class="mw-headline" id="Verify_correct_samba_configuration">Verify correct samba configuration</span></h4>
<p>Run the following command from a terminal to test configuration file correctness:
</p>
<pre>$ testparm
</pre>
<h4><span class="mw-headline" id="Verify_correct_shared_folder_creation">Verify correct shared folder creation</span></h4>
<p>Run the following commands from a terminal:
</p>
<pre>$ cd /var/lib/samba/usershares
$ ls
</pre>
<p>If everything is fine, you will notice a file named <code>mysharedfiles</code>
</p>
<p>Read the file contents using the following command:
</p>
<pre>$ cat mysharedfiles
</pre>
<p>The terminal output should display something like this:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/samba/usershares/mysharedfiles</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">path=/home/yourUser/Shared
comment=
usershare_acl=S-1-1-0:r
guest_ok=y
sharename=MySharedFiles</pre>
<h4><span class="mw-headline" id="Verify_folder_access_by_guest">Verify folder access by guest</span></h4>
<p>Run the following command from a terminal. If prompted for a password, just press Enter:
</p>
<pre>$ smbclient -L localhost
</pre>
<p>If everything is fine, MySharedFiles should be displayed under <code>Sharename</code> column
</p>
<p>Run the following command in order to access the shared folder as guest (anonymous login)
</p>
<pre>$ smbclient -N //localhost/MySharedFiles
</pre>
<p>If everything is fine samba client prompt will be displayed:
</p>
<pre>smb: \&gt;
</pre>
<p>From samba prompt verify guest can list directory contents:
</p>
<pre>smb: \&gt; ls
</pre>
<p>If the <code>NTFS_STATUS_ACCESS_DENIED</code> error is displayed, the issue is likely to be with Unix directory permissions. Ensure that your samba user has access to the folder and all parent folders. You can test this by sudoing to the user and attempting to list the mount directory, and all of its parents.
</p>
<h3><span class="mw-headline" id="Mount_error:_Host_is_down">Mount error: Host is down</span></h3>
<p>This error might be seen when mounting shares of Synology NAS servers. Use the mount option <code>vers=1.0</code> to solve it.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> SMB version 1 is known to have security vulnerabilities and was used in successful ransomware attacks.</div>
<h3><span class="mw-headline" id="Software_caused_connection_abort">Software caused connection abort</span></h3>
<p>File managers that utilizes <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gvfs-smb">gvfs-smb</a></span> can show the error <code>Software caused connection abort</code> when writing a file to a share/server. This may be due to the server running SMB/CIFS version 1, which many routers use for USB drive sharing (e.g. Belkin routers). To write to these shares specify the CIFS version with the option <code>vers=1.0</code>. E.g.:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">//SERVER/sharename /mnt/mountpoint cifs _netdev,guest,file_mode=0777,dir_mode=0777,vers=1.0 0 0</pre>
<p>This can also happen after updating Samba to version 4.11, which deactivates SMB1 as default, and accessing any Samba share. You can reenable it by adding
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
client min protocol = CORE</pre>
<h3>
<span id="Connection_problem_.28due_to_authentification_error.29"></span><span class="mw-headline" id="Connection_problem_(due_to_authentification_error)">Connection problem (due to authentification error)</span>
</h3>
<p>Be sure that you do not leave any space characters before your username in Samba client configuration file as follows:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.samba</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">username= user
password=pass</pre>
<p>The correct format is:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.samba</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">username=user
password=pass</pre>
<h3><span class="mw-headline" id="Windows_1709_or_up_does_not_discover_the_samba_server_in_Network_view">Windows 1709 or up does not discover the samba server in Network view</span></h3>
<p>With Windows 10 version 1511, support for SMBv1 and thus NetBIOS device discovery was disabled by default. Depending on the actual edition, later versions of Windows starting from version 1709 ("Fall Creators Update") do not allow the installation of the SMBv1 client anymore. This causes hosts running Samba not to be listed in the Explorer's "Network (Neighborhood)" views. While there is no connectivity problem and Samba will still run fine, users might want to have their Samba hosts to be listed by Windows automatically. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=wsdd">wsdd</a></span> implements a Web Service Discovery host daemon. This enables (Samba) hosts, like your local NAS device, to be found by Web Service Discovery Clients like Windows. The default settings should work for most installations, all you need to do is start enable <code>wsdd.service</code>.
</p>
<p>If the default configuration (advertise itself as the machine hostname in group "WORKGROUP") should be all you need in most cases. If you need, you can change configuration options by passing additional arguments to wsdd by adding them in <code>/etc/conf.d/wsdd</code> (see the manual page for wsdd for details).
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/wsdd2/">wsdd2</a></span><sup><small>AUR</small></sup> does the same thing, but is written in C instead of Python. By default, it will look for the <code>netbios name</code> and <code>workgroup</code> values in <code>smb.conf</code>.
</p>
<h3>
<span id="GNOME_Files_not_showing_Windows_machines_.28version_1709_or_up.29_with_shared_folders_in_Network_view"></span><span class="mw-headline" id="GNOME_Files_not_showing_Windows_machines_(version_1709_or_up)_with_shared_folders_in_Network_view">GNOME Files not showing Windows machines (version 1709 or up) with shared folders in Network view</span>
</h3>
<p>See <a href="../en/GNOME/Files.html#Windows_machines_(version_1709_or_up)_with_shared_folders_don't_show_up_in_Network_view" title="GNOME/Files">GNOME/Files#Windows machines (version 1709 or up) with shared folders don't show up in Network view</a>.
</p>
<h3>
<span id="iOS.2FiPadOS_Files_can_no_longer_copy-to_Samba_share_on_Arch_Linux_beginning_with_iOS.2FiPadOS_14.5"></span><span class="mw-headline" id="iOS/iPadOS_Files_can_no_longer_copy-to_Samba_share_on_Arch_Linux_beginning_with_iOS/iPadOS_14.5">iOS/iPadOS Files can no longer copy-to Samba share on Arch Linux beginning with iOS/iPadOS 14.5</span>
</h3>
<p>Beginning with iOS/iPadOS 14.5 attempting to transfer from a device running iOS/iPadOS using the "Files" app to a samba share on Arch Linux will result in the error:
</p>
<pre>The operation couldn't be completed
Operation canceled
</pre>
<p>To correct this problem, add add the following to the global section of your <code>smb.conf</code> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>smb.service</code>.
Comment optional:
</p>
<pre>## addition for iOS/iPadOS 14.5+ Files transfer-to server
vfs object = fruit streams_xattr
</pre>
<p>See <a rel="nofollow" class="external free" href="https://apple.stackexchange.com/q/424681">https://apple.stackexchange.com/q/424681</a> Apple.Stackexchange.com - "The operation couldn't be completed"/"Operation canceled" error message when saving to a Samba share via Files app.
</p>
<h3><span class="mw-headline" id="Slow_initial_connections_from_certain_clients_without_other_performance_problems">Slow initial connections from certain clients without other performance problems</span></h3>
<p>Some SMB clients, such as Solid Explorer for Android, take significantly longer to connect to Samba if they fail to resolve the NetBIOS name. Enabling <code>nmb.service</code> will greatly speed up initial connections if this is the case. Since this is a bug in the client software, please report such cases to the authors of conflicting software.
</p>
<h3><span class="mw-headline" id="CUPS_managed_printers_are_not_listed">CUPS managed printers are not listed</span></h3>
<p>When Samba is configured to use CUPS for printing
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
   printing = cups
   printcap name = cups</pre>
<p>And the following symptoms occur:
</p>
<ul>
<li>
<code>smbclient -N -L &lt;localhost&gt;</code> does list any printers</li>
<li>
<code>smbclient -N &lt;localhost&gt;/Your_Printer_Name</code> may return tree connect failed: NT_STATUS_BAD_NETWORK_NAME</li>
<li><code>/usr/libexec/samba/samba-bgqd is not running</code></li>
<li>
<code>/var/log/samba/smbd.&lt;hostname&gt;</code> may contain the following entries.  It's possible that the latest versions of samba do not use this file anymore</li>
</ul>
<pre>[2024/08/07 14:24:18.938740,  0] ../../source3/printing/printer_list.c:58(get_printer_list_db)
  get_printer_list_db: Failed to open printer_list.tdb
</pre>
<p>A workaround is to launch <code>/usr/libexec/samba/samba-bgqd</code> manually (without parameters).  Consider creating a systemd service to keep the binary running until the bug is fixed
</p>
<p>Reference: Redhat Bug <a rel="nofollow" class="external autonumber" href="https://bugzilla.redhat.com/show_bug.cgi?id=2263500">[1]</a>
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.samba.org/">Official website</a></li>
<li><a rel="nofollow" class="external text" href="https://www.samba.org/samba/docs/SambaIntro.html">Samba: An Introduction</a></li>
<li>
<a rel="nofollow" class="external text" href="https://www.samba.org/samba/docs/Samba-HOWTO-Collection.pdf">Samba 3.2.x HOWTO and Reference Guide</a> (outdated but still most extensive documentation)</li>
<li><a href="https://en.wikipedia.org/wiki/Samba_(software)" class="extiw" title="wikipedia:Samba (software)">Wikipedia</a></li>
<li><a href="https://wiki.gentoo.org/wiki/Samba/Guide" class="extiw" title="gentoo:Samba/Guide">Gentoo:Samba/Guide</a></li>
<li><a href="https://wiki.debian.org/Samba/ServerSimple" class="extiw" title="debian:Samba/ServerSimple">Debian:Samba/ServerSimple</a></li>
<li>
<a rel="nofollow" class="external text" href="https://docs.kernel.org/filesystems/smb/ksmbd.html">KSMBD</a> - A linux kernel server which implements SMB3 protocol in kernel space for sharing files over network.</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Network_sharing.html" title="Category:Network sharing">Network sharing</a></li>
<li><a href="../en/Category:Servers.html" title="Category:Servers">Servers</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Samba&amp;oldid=822038">https://wiki.archlinux.org/index.php?title=Samba&amp;oldid=822038</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 3 December 2024, at 01:03.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
