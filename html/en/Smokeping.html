<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Smokeping - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.43.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Smokeping rootpage-Smokeping skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Installation</span>
			</div>
		</a>
		
			<button aria-controls="toc-Installation-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Installation subsection</span>
			</button>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
			<li id="toc-Optional_Prerequisites" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Optional_Prerequisites">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.1</span>
					<span>Optional Prerequisites</span>
				</div>
			</a>
			
			<ul id="toc-Optional_Prerequisites-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Configuration</span>
			</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-Editing_the_configuration_file" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Editing_the_configuration_file">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>Editing the configuration file</span>
				</div>
			</a>
			
			<ul id="toc-Editing_the_configuration_file-sublist" class="vector-toc-list">
				<li id="toc-Notes_on_the_smokeping_configuration_file_syntax" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Notes_on_the_smokeping_configuration_file_syntax">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1.1</span>
					<span>Notes on the smokeping configuration file syntax</span>
				</div>
			</a>
			
			<ul id="toc-Notes_on_the_smokeping_configuration_file_syntax-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Setup_the_rest_of_the_system" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Setup_the_rest_of_the_system">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>Setup the rest of the system</span>
				</div>
			</a>
			
			<ul id="toc-Setup_the_rest_of_the_system-sublist" class="vector-toc-list">
				<li id="toc-Notes_on_Smokeping_in_Master_Slave_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Notes_on_Smokeping_in_Master_Slave_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2.1</span>
					<span>Notes on Smokeping in Master Slave configuration</span>
				</div>
			</a>
			
			<ul id="toc-Notes_on_Smokeping_in_Master_Slave_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Start_and_enable_daemon" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Start_and_enable_daemon">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3</span>
					<span>Start and enable daemon</span>
				</div>
			</a>
			
			<ul id="toc-Start_and_enable_daemon-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Setup_web_frontend" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Setup_web_frontend">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Setup web frontend</span>
			</div>
		</a>
		
			<button aria-controls="toc-Setup_web_frontend-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Setup web frontend subsection</span>
			</button>
		
		<ul id="toc-Setup_web_frontend-sublist" class="vector-toc-list">
			<li id="toc-Apache" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Apache">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>Apache</span>
				</div>
			</a>
			
			<ul id="toc-Apache-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Caddy" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Caddy">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>Caddy</span>
				</div>
			</a>
			
			<ul id="toc-Caddy-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Caddy_2" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Caddy_2">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3</span>
					<span>Caddy 2</span>
				</div>
			</a>
			
			<ul id="toc-Caddy_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Lighttpd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Lighttpd">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.4</span>
					<span>Lighttpd</span>
				</div>
			</a>
			
			<ul id="toc-Lighttpd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Nginx" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Nginx">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.5</span>
					<span>Nginx</span>
				</div>
			</a>
			
			<ul id="toc-Nginx-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Advanced_Configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Advanced_Configuration">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Advanced Configuration</span>
			</div>
		</a>
		
		<ul id="toc-Advanced_Configuration-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Notes" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Notes">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Notes</span>
			</div>
		</a>
		
			<button aria-controls="toc-Notes-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Notes subsection</span>
			</button>
		
		<ul id="toc-Notes-sublist" class="vector-toc-list">
			<li id="toc-Smoketrace_(Tr.cgi)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Smoketrace_(Tr.cgi)">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>Smoketrace (Tr.cgi)</span>
				</div>
			</a>
			
			<ul id="toc-Smoketrace_(Tr.cgi)-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Smokeping</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 2 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-2" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">2 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Smokeping" title="Smokeping – 日本語" lang="ja" hreflang="ja" data-title="Smokeping" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Smokeping" title="Smokeping – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" data-title="Smokeping" data-language-autonym="中文（简体）" data-language-local-name="中文（简体）" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><a rel="nofollow" class="external text" href="https://oss.oetiker.ch/smokeping/index.en.html">Smokeping</a>
allows you to probe a list of servers, store that data using
RRDtool, and generate statistical charts based on RRDtool's
output. Smokeping consists of two parts. A daemon runs in the
background pinging and collecting data at set intervals. A web
interface displays that data in the form of graphs.
</p>
<p>This wiki page covers a basic setup of the smokeping daemon and the CGI webinterface.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>This section covers the installation of <a rel="nofollow" class="external text" href="https://oss.oetiker.ch/smokeping/index.en.html">Smokeping</a> using the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=smokeping">smokeping</a></span> package. FastCGI on Apache will be setup as described in <a href="../en/Apache_HTTP_Server/mod_fcgid.html" class="mw-redirect" title="Apache and FastCGI">Apache and FastCGI</a>.
</p>
<p>The smokeping package consists of two parts:
</p>
<ul>
<li>The smokeping daemon and configs in <code>/etc/smokeping/</code>. This daemon performs the monitoring.</li>
<li>The smokeping "htdocs" in <code>/srv/http/smokeping</code>. These will be used by the web interface.</li>
</ul>
<p>In addition to the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=smokeping">smokeping</a></span> package, you will need:
</p>
<ul>
<li>A tool that smokeping can use for monitoring. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fping">fping</a></span> is the simplest and default method for simple ping probes.</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=apache">apache</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mod_fcgid/">mod_fcgid</a></span><sup><small>AUR</small></sup> for the web interface if you are using Apache.</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fcgiwrap">fcgiwrap</a></span> and start and enable fcgiwrap.socket if you are using Nginx</li>
<li>An image cache directory that the FastCGI script can write to, e.g. <code>/srv/smokeping/imgcache</code>
</li>
<li>A data directory that the smokeping daemon can write to, and the FastCGI script can read, e.g. <code>/srv/smokeping/data</code>
</li>
<li>To ensure that the main configuration file is readable by the smokeping daemon.</li>
</ul>
<h3><span class="mw-headline" id="Optional_Prerequisites">Optional Prerequisites</span></h3>
<p>If you want to use other probes such as the DNS or http probe you will
need other packages as shown below. The configuration of these will is not covered by this wiki page.
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Probe</th>
<th>Package Needed
</th>
</tr>
<tr>
<td>Curl</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=curl">curl</a></span>
</td>
</tr>
<tr>
<td>DNS</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bind">bind</a></span> (for the dig utility)
</td>
</tr>
<tr>
<td>EchoPing</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=echoping">echoping</a></span>
</td>
</tr>
<tr>
<td>SSH</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span>
</td>
</tr>
<tr>
<td>TelnetIOSPing</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=perl-net-telnet">perl-net-telnet</a></span>
</td>
</tr>
<tr>
<td>AnotherDNS</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=perl-net-dns">perl-net-dns</a></span>
</td>
</tr>
<tr>
<td>LDAP</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=perl-ldap">perl-ldap</a></span>
</td>
</tr>
<tr>
<td>LDAP (tls)</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=perl-io-socket-ssl">perl-io-socket-ssl</a></span>
</td>
</tr>
<tr>
<td>Authen</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=perl-authen-radius">perl-authen-radius</a></span>
</td>
</tr>
</tbody>
</table>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>Smokeping requires you to edit a few files. The unedited files end
with the <code>.dist</code> extension. Rename the <code>.dist</code>
files in <code>/etc/smokeping</code> to remove the suffix. The <i>find</i> command does this and
prints out each file that is being renamed and needs editing:
</p>
<pre># cd /etc/smokeping
# find . -name '*.dist' -print -execdir sh -c 'mv {} $(basename {} .dist)' \;
# mv /srv/http/smokeping/smokeping.fcgi.dist /srv/http/smokeping/smokeping.fcgi
</pre>
<h3><span class="mw-headline" id="Editing_the_configuration_file">Editing the configuration file</span></h3>
<p>Next, edit the <code>/etc/smokeping/config</code> file; this is smokeping's main configuration file. A brief description of the sections is followed by a complete example.
</p>
<p><b>Note:</b> most paths need changing, potentially from <code>/usr/etc/</code> to <code>/etc/smokeping</code>, but confirm each one.
Paths for the various <code>.dist</code> files can be found with <code>pacman -Ql smokeping</code>
</p>
<p>The <i>General</i> section of the <code>/etc/smokeping/config</code> file is the easiest to edit. Personalize the
top of the configuration file to match your information. The comments describe each field. Note that if you do not have the <code>sendmail</code> program installed (ie from postfix or sendmail) then use something else instead like <code>/bin/false</code>. The file you specify must exist or smokeping will error out.
</p>
<p>The <i>Alerts</i> section does not require any changes for this example.
</p>
<p>The <i>Database</i> section does not require any changes.
</p>
<p>In the <i>Presentation</i> section the path to the template filename needs to be updated, (ie <code>/etc/smokeping/basepage.html</code>)
</p>
<p>The <i>Probes</i> section specifies which probes are active. By default only the <i>FPing</i> probe is enabled. This section does not require any changes.
</p>
<p>The <i>Slaves</i> section is not needed in this minimal example, so it can be either commented out or removed. Note that if you use the <code>smokeping_secrets</code> setting in the <i>Slaves</i> section, you will have to make that file unreadable to the rest of the world, or else smokeping will error: <code>chmod 600 /etc/smokeping/smokeping_secrets</code>.
</p>
<p>The <i>Targets</i> section specifies which hosts will be probed (pinged in our example). Customize it so that it probes the host(s) you would like to collect statistics on, as shown in the example below.
</p>
<p>You can learn more about the Smokeping configuration file with the examples at
<a rel="nofollow" class="external free" href="https://oss.oetiker.ch/smokeping/doc/smokeping_examples.en.html">https://oss.oetiker.ch/smokeping/doc/smokeping_examples.en.html</a>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/smokeping/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">*** General ***

owner     = Your Name Here                            # your name
contact   = your.email@host.bla                       # your email
mailhost  = your.smtp.server.bla                      # your mail server
sendmail  = /bin/false                                # where the sendmail program is
imgcache  = /srv/smokeping/imgcache                   # filesystem directory where we store files
imgurl    = imgcache                                  # URL directory to find them
datadir   = /srv/smokeping/data                       # where we share data between the daemon &amp; webapp
piddir    = /var/run                                  # filesystem directory to store PID file
cgiurl    = http://localhost/smokeping/smokeping.fcgi  # exterior URL
smokemail = /etc/smokeping/smokemail   
tmail     = /etc/smokeping/tmail
syslogfacility = local0
# each probe is now run in its own process
# disable this to revert to the old behaviour
# concurrentprobes = no

*** Alerts ***
to = alertee@address.somewhere
from = smokealert@company.xy

+someloss
type = loss
# in percent
pattern = &gt;0%,*12*,&gt;0%,*12*,&gt;0%
comment = loss 3 times  in a row

*** Database ***

step     = 300
pings    = 20

# consfn mrhb steps total

AVERAGE  0.5   1  1008
AVERAGE  0.5  12  4320
    MIN  0.5  12  4320
    MAX  0.5  12  4320
AVERAGE  0.5 144   720
    MAX  0.5 144   720
    MIN  0.5 144   720

*** Presentation ***

template = /etc/smokeping/basepage.html

+ charts

menu = Charts
title = The most interesting destinations
++ stddev
sorter = StdDev(entries=&gt;4)
title = Top Standard Deviation
menu = Std Deviation
format = Standard Deviation %f

++ max
sorter = Max(entries=&gt;5)
title = Top Max Roundtrip Time
menu = by Max
format = Max Roundtrip Time %f seconds

++ loss
sorter = Loss(entries=&gt;5)
title = Top Packet Loss
menu = Loss
format = Packets Lost %f

++ median
sorter = Median(entries=&gt;5)
title = Top Median Roundtrip Time
menu = by Median
format = Median RTT %f seconds

+ overview 

width = 600
height = 50
range = 10h

+ detail

width = 600
height = 200
unison_tolerance = 2
nodata_color = ffb0b0
loss_background = yes

"Last 3 Hours"    3h
"Last 30 Hours"   30h
"Last 10 Days"    10d
"Last 400 Days"   400d

*** Probes ***

+ FPing

binary = /usr/bin/fping

*** Targets ***

probe = FPing

menu = Top
title = Network Latency Grapher
remark = Welcome to the SmokePing website of Arch User. \
         Here you will learn all about the latency of our network.

+ targets
menu = Targets
title = Targets

++ CloudflareDNS
 
menu = Cloudflare DNS
title = Cloudflare DNS server
host = 1.1.1.1

++ GoogleDNS

menu = Google DNS
title = Google DNS server
host = 8.8.8.8

++ MultiHost

menu = Multihost example
title = CloudflareDNS and Google DNS
host = /targets/CloudflareDNS /targets/GoogleDNS
</pre>
<h4><span class="mw-headline" id="Notes_on_the_smokeping_configuration_file_syntax">Notes on the smokeping configuration file syntax</span></h4>
<p>Each <b>+</b> character defines a section in the hierarchy. Spaces are not allowed in the section names. Period and forward slashes should probably also be avoided in section names. This is probably because the RRD files are stored under the data directory with the same exact names as the sections.
</p>
<p>In the <i>Targets</i> section, you can define <code>host</code> as either a real host name or the path to another section to generate a multiple host chart, as shown in the <code>MultiHost</code> example above.
</p>
<h3><span class="mw-headline" id="Setup_the_rest_of_the_system">Setup the rest of the system</span></h3>
<p>Setup the extra directories referenced by the configuration file:
</p>
<pre># mkdir -p /srv/smokeping/data
# mkdir -p /srv/smokeping/imgcache
# chown -R smokeping:smokeping /srv/smokeping
# chown -R http:http /srv/smokeping/imgcache
# chmod a+rx /srv/smokeping
# chmod -R a+rx /srv/smokeping/data
</pre>
<p>Since the smokeping configuration is read by both the smokeping daemon and the FastCGI scripts, so it needs to be readable:
</p>
<pre># chmod a+rx /etc/smokeping
# chmod a+r /etc/smokeping/config
</pre>
<h4><span class="mw-headline" id="Notes_on_Smokeping_in_Master_Slave_configuration">Notes on Smokeping in Master Slave configuration</span></h4>
<p>A master-slave has one additional wrinkle, though the principles are the same.
For slaves, smokeping IS NOT writing the data to the RRD files - they're getting pushed there by the web-server. So, in master-slave mode you need to be sure that the user your web-server is running as [<code>nginx</code> running as user <code>http</code>] also has WRITE permissions to the RRD files (under <code>/srv/smokeping/data</code>).
</p>
<p>When running Smokeping in <a rel="nofollow" class="external text" href="https://github.com/oetiker/SmokePing/blob/master/doc/smokeping_master_slave.pod">Master / Slave</a> mode, the master has effective permissions of the user the smokeping slave runs as. Do NOT run slaves as root. Read the <a rel="nofollow" class="external text" href="https://man.archlinux.org/man/smokeping_master_slave.7#SECURITY_CONSIDERATIONS">security considerations</a> first.
</p>
<p>The <a rel="nofollow" class="external text" href="https://github.com/oetiker/SmokePing/wiki/FAQ#master-slave-setups">Smokeping FAQ</a> on their wiki details the complex permission requirements. If your master slave config is still not working, use <code>setfacl</code> to provide the minimum required permissions:
</p>
<pre>On the master, give both `http` and `smokeping` full access (rwx) to `/srv/smokeping/*`
# setfacl -R -m u:http:rwx /srv/smokeping
# setfacl -R -m u:smokeping:rwx /srv/smokeping

Set specific read permissions for files inside `/etc/smokeping`
# setfacl -m u:http:r /etc/smokeping/smokeping_secrets
# setfacl -m u:smokeping:r /etc/smokeping/config /etc/smokeping/smokeping_secrets
</pre>
<p>Slaves require no config file, they pull their config from the master, and just need to read <code>/etc/smokeping/smokeping_secrets</code>: 
</p>
<pre># /usr/bin/smokeping --master-url=https://smokeping.site/smokeping.fcgi
# setfacl -m u:http:r /etc/smokeping/smokeping_secrets
</pre>
<p>A sample slave's systemd unit:
</p>
<pre>[Unit]
Description=Smokeping Slave: my.slave.net
Documentation=man:smokeping_master_slave(7)

[Service]
ExecStart=/usr/sbin/smokeping \
  --master-url=https://smokeping.site/smokeping.fcgi \
  --cache-dir=/var/lib/smokeping \
  --shared-secret=/etc/smokeping/smokeping_secrets \
  --pid-dir=/run/smokeping \
  --slave-name=my.slave.net 
# The --slave-name should be an exact match to both the master's config and smokeping_secrets
  
ExecReload=/bin/kill -HUP $MAINPID  

[Service]
Type=forking
RuntimeDirectory=smokeping
PIDFile=/run/smokeping/smokeping.pid
User=smokeping
Group=smokeping
Restart=on-failure
</pre>
<h3><span class="mw-headline" id="Start_and_enable_daemon">Start and enable daemon</span></h3>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> and enable <code>smokeping.service</code>. Then check that it is running.
</p>
<h2><span class="mw-headline" id="Setup_web_frontend">Setup web frontend</span></h2>
<h3><span class="mw-headline" id="Apache">Apache</span></h3>
<p>Edit <code>/etc/httpd/conf/httpd.conf</code> so that it includes:
</p>
<pre>LoadModule fcgid_module modules/mod_fcgid.so
&lt;IfModule fcgid_module&gt;
  AddHandler fcgid-script .fcgi
&lt;/IfModule&gt;

Alias /smokeping/imgcache /srv/smokeping/imgcache
Alias /smokeping /srv/http/smokeping

&lt;Directory "/srv/smokeping/imgcache"&gt;
  AllowOverride all
  Require all granted
&lt;/Directory&gt;

&lt;Directory "/srv/http/smokeping"&gt;
 Options FollowSymLinks ExecCGI
 AllowOverride all
 Require all granted
&lt;/Directory&gt;
</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> Apache via the <code>httpd.service</code>.
</p>
<p>Check that <a rel="nofollow" class="external free" href="http://localhost/smokeping/smokeping.fcgi">http://localhost/smokeping/smokeping.fcgi</a> loads. The first data should appear after a couple of minutes.
</p>
<p>If the fonts in the graphs are unreadable, you may need to install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ttf-dejavu">ttf-dejavu</a></span> package.
</p>
<h3><span class="mw-headline" id="Caddy">Caddy</span></h3>
<p>Thanks to the <a rel="nofollow" class="external text" href="https://caddy.community/t/smokeping-caddyfile/3560/8">Caddy community</a> and with this configuration file <a rel="nofollow" class="external text" href="https://s.natalian.org/2018-03-27/config">/etc/smokeping/config</a> and with <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>fcgiwrap.socket</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/caddy/caddy.conf.d/smokeping.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">smokeping.example.com {

        log stdout
        errors

        tls john@example.com
        root /srv/http/smokeping

        fastcgi / unix:/var/run/fcgiwrap.sock {
                env SCRIPT_FILENAME /srv/http/smokeping/smokeping.fcgi.dist
        }
}

smokeping.example.com/js {
        root /srv/http/smokeping/js
}

smokeping.example.com/css {
        root /srv/http/smokeping/css
}

smokeping.example.com/cache {
        root /var/cache/smokeping
}
</pre>
<p>An updated version of this Caddy configuration for smokeping - <a rel="nofollow" class="external free" href="https://gist.github.com/Strykar/4df1eb8aebc4d5f7039f6045301352c7">https://gist.github.com/Strykar/4df1eb8aebc4d5f7039f6045301352c7</a>
</p>
<h3><span class="mw-headline" id="Caddy_2">Caddy 2</span></h3>
<p>Thanks to the <a rel="nofollow" class="external text" href="https://caddy.community/t/having-trouble-migrating-smokeping-caddyfile-to-caddy-2/8640/3">francislavoie and Caddy community</a> and to the <a rel="nofollow" class="external text" href="https://caddyserver.com/docs/caddyfile">Caddy docs</a>.
Start and enable fcgiwrap.socket!
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/caddy/caddy.conf.d/smokeping.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">smokeping.example.com {

    handle /js/* {
        root * /srv/http/smokeping/
        file_server
    }
    handle /css/* {
        root * /srv/http/smokeping/
        file_server
    }
    handle /imgcache/* {
        root * /srv/http/smokeping/
        file_server
    }
    handle /images/* {
        root * /srv/http/smokeping/
        file_server
    }
    
    handle {
        root * /srv/http/smokeping/
        reverse_proxy unix//var/run/fcgiwrap.sock {
            transport fastcgi {
                env SCRIPT_FILENAME /srv/http/smokeping/smokeping.fcgi
                split ""
            }
        }
    }
}
</pre>
<h3><span class="mw-headline" id="Lighttpd">Lighttpd</span></h3>
<p>First install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lighttpd">lighttpd</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fcgi">fcgi</a></span>.
</p>
<p>Edit the <a href="../en/Lighttpd.html" title="Lighttpd">Lighttpd</a> configuration file and ensure you have at least all of the following configuration directives:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server.document-root    = "/srv/http"
server.follow-symlink   = "enable"

server.modules += ("mod_fastcgi")
fastcgi.server = (
        ".fcgi" =&gt;
        ((
                "bin-path" =&gt; "/srv/http/smokeping/smokeping.fcgi",
                "host" =&gt; "localhost",
                "port" =&gt; 8001,
        )),
)</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">Start/enable</a> the <code>lighttpd.service</code>
</p>
<p><a href="../en/Systemd.html" title="Systemd">Systemd</a> should show <code>smokeping_cgi</code> being managed by <code>lighttpd.service</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ systemctl status lighttpd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">● lighttpd.service - Lighttpd Web Server
   Loaded: loaded (/usr/lib/systemd/system/lighttpd.service; enabled; vendor preset: disabled)
   Active: active (running) since Wed 2018-12-26 14:34:42 PST; 1 day 7h ago
  Process: 17117 ExecReload=/bin/kill -HUP $MAINPID (code=exited, status=0/SUCCESS)
 Main PID: 28321 (lighttpd-angel)
    Tasks: 6 (limit: 4915)
   Memory: 128.9M
   CGroup: /system.slice/lighttpd.service
           ├─17119 /usr/bin/lighttpd -D -f /etc/lighttpd/lighttpd.conf
           ├─17126 /usr/bin/perl /usr/bin/smokeping_cgi /etc/smokeping/config
           ├─17127 /usr/bin/perl /usr/bin/smokeping_cgi /etc/smokeping/config
           ├─17128 /usr/bin/perl /usr/bin/smokeping_cgi /etc/smokeping/config
           ├─17129 /usr/bin/perl /usr/bin/smokeping_cgi /etc/smokeping/config
           └─28321 /usr/bin/lighttpd-angel -D -f /etc/lighttpd/lighttpd.conf</pre>
<p>Finally, add a symbolic link to allow images to load:
</p>
<pre># ln -s -t /srv/http/smokeping /srv/smokeping/imgcache
</pre>
<h3><span class="mw-headline" id="Nginx">Nginx</span></h3>
<p>Ensure that <code>fcgiwrap.socket</code> and <code>nginx.service</code> are both running via systemctl.
</p>
<p>Add a server block for smokeping to <code>/etc/nginx/nginx.conf</code>, following is an example for a TLS enabled block.
</p>
<pre>   server {
       server_name smokeping.example.com;
       listen 443 ssl http2;
       listen [::]:443 ssl http2;
       root /srv/http/smokeping/;
       index smokeping.fcgi;
       gzip off;
       access_log /var/log/nginx_smokeping.log combined;
       error_log /var/log/nginx_smokeping.log;
       location ~ \.fcgi$ {
           fastcgi_intercept_errors on;
           include /etc/nginx/fastcgi_params;
           fastcgi_param SCRIPT_FILENAME /srv/http/smokeping/smokeping.fcgi;
           fastcgi_pass unix:/var/run/fcgiwrap.sock;
       }
       location ^~ /imgcache {
           alias /srv/smokeping/imgcache;
           gzip off;
       }
   }
</pre>
<p>Verify that your configuration is fine via <code>nginx -t</code> as the root user and reload the configuration via <code>nginx -s reload</code> as the root user.
</p>
<h2><span class="mw-headline" id="Advanced_Configuration">Advanced Configuration</span></h2>
<p>Smokeping is a powerful tool that can be configured in many ways. You can setup many different types of probes. You can setup slave smokeping servers that can send their statistics and show you probes from other servers.
</p>
<p>You can also create your custom probes in perl, see some third-party probes <a rel="nofollow" class="external text" href="https://github.com/oetiker/SmokePing/wiki/Third-party-probes">on their wiki</a>. These options are currently not covered by this guide, please consult the documentation on the <a rel="nofollow" class="external text" href="https://oss.oetiker.ch/smokeping/doc/smokeping_extend.en.html">Smokeping website</a> instead.
</p>
<p>Also see - <a rel="nofollow" class="external free" href="https://github.com/oetiker/SmokePing/wiki/FAQ">https://github.com/oetiker/SmokePing/wiki/FAQ</a>
</p>
<h2><span class="mw-headline" id="Notes">Notes</span></h2>
<h3>
<span id="Smoketrace_.28Tr.cgi.29"></span><span class="mw-headline" id="Smoketrace_(Tr.cgi)">Smoketrace (Tr.cgi)</span>
</h3>
<p>The <a rel="nofollow" class="external text" href="https://oss.oetiker.ch/smokeping/doc/smoketrace.en.html">SmokeTraceroute</a> utility is gone since v2.5.0 according to the <a rel="nofollow" class="external text" href="https://oss.oetiker.ch/smokeping/pub/CHANGES">release notes</a>.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Network_monitoring.html" title="Category:Network monitoring">Network monitoring</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Smokeping&amp;oldid=828085">https://wiki.archlinux.org/index.php?title=Smokeping&amp;oldid=828085</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 2 March 2025, at 00:07.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki.svg" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul></ul>
</div>
</body>
</html>
