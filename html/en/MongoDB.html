<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>MongoDB - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.45.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-MongoDB rootpage-MongoDB skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Installation</span>
			</div>
		</a>
		
			<button aria-controls="toc-Installation-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Installation subsection</span>
			</button>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
			<li id="toc-Tools" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Tools">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.1</span>
					<span>Tools</span>
				</div>
			</a>
			
			<ul id="toc-Tools-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Usage" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Usage">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Usage</span>
			</div>
		</a>
		
		<ul id="toc-Usage-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Configuration</span>
			</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-File_Format" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#File_Format">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>File Format</span>
				</div>
			</a>
			
			<ul id="toc-File_Format-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Requiring_Authentication" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Requiring_Authentication">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>Requiring Authentication</span>
				</div>
			</a>
			
			<ul id="toc-Requiring_Authentication-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-NUMA" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#NUMA">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3</span>
					<span>NUMA</span>
				</div>
			</a>
			
			<ul id="toc-NUMA-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Clean_Start_and_Stop" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Clean_Start_and_Stop">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.4</span>
					<span>Clean Start and Stop</span>
				</div>
			</a>
			
			<ul id="toc-Clean_Start_and_Stop-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Troubleshooting</span>
			</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-MongoDB_will_not_start" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#MongoDB_will_not_start">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>MongoDB will not start</span>
				</div>
			</a>
			
			<ul id="toc-MongoDB_will_not_start-sublist" class="vector-toc-list">
				<li id="toc-Switching_to_a_different_version_/_Clean_install" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Switching_to_a_different_version_/_Clean_install">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1.1</span>
					<span>Switching to a different version / Clean install</span>
				</div>
			</a>
			
			<ul id="toc-Switching_to_a_different_version_/_Clean_install-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Some_computer_just_cannot_run_MongoDB" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Some_computer_just_cannot_run_MongoDB">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1.2</span>
					<span>Some computer just cannot run MongoDB</span>
				</div>
			</a>
			
			<ul id="toc-Some_computer_just_cannot_run_MongoDB-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Warning_about_Transparent_Huge_Pages_(THP)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Warning_about_Transparent_Huge_Pages_(THP)">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.2</span>
					<span>Warning about Transparent Huge Pages (THP)</span>
				</div>
			</a>
			
			<ul id="toc-Warning_about_Transparent_Huge_Pages_(THP)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Warning_about_Soft_rlimits_too_low" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Warning_about_Soft_rlimits_too_low">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.3</span>
					<span>Warning about Soft rlimits too low</span>
				</div>
			</a>
			
			<ul id="toc-Warning_about_Soft_rlimits_too_low-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar no-font-mode-scale">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">MongoDB</span></h1>
							
</header>
				<div class="vector-column-end no-font-mode-scale">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p>MongoDB (from hu<b>mongo</b>us) is a source-available document-oriented database system developed and supported by <a rel="nofollow" class="external text" href="https://www.mongodb.com/">MongoDB Inc. (formerly 10gen)</a>. It is part of the NoSQL family of database systems. Instead of storing data in tables as is done in a "classical" relational database, MongoDB stores structured data as JSON-like documents with dynamic schemas (MongoDB calls the format <a rel="nofollow" class="external text" href="https://bsonspec.org/">BSON</a>), making the integration of data in certain types of applications easier and faster.
</p>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Installation">Installation</h2></div>
<p>MongoDB has been removed from the <a href="../en/Official_repositories.html" title="Official repositories">official repositories</a> due to its re-licensing issues <a rel="nofollow" class="external autonumber" href="https://lists.archlinux.org/archives/list/arch-dev-public@lists.archlinux.org/thread/OY2DLNWTZOBPAHFE5FSV4Q6AIWGZO6KV/">[1]</a>.
</p>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> one of the following for the latest version available:
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb/">mongodb</a></span><sup><small>AUR</small></sup> - builds from source.</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb-bin/">mongodb-bin</a></span><sup><small>AUR</small></sup> - prebuilt MongoDB binary extracted from <a rel="nofollow" class="external text" href="https://repo.mongodb.org/apt/ubuntu/">official MongoDB Ubuntu repository</a> packages. Compilation options used are unknown.</li>
</ul>
<p>Alternatively, there are older versions of MongoDB available:
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb50/">mongodb50</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb50-bin/">mongodb50-bin</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb44/">mongodb44</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb44-bin/">mongodb44-bin</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb42-bin/">mongodb42-bin</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb40-bin/">mongodb40-bin</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb36-bin/">mongodb36-bin</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb34-bin/">mongodb34-bin</a></span><sup><small>AUR</small></sup>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb32-bin/">mongodb32-bin</a></span><sup><small>AUR</small></sup>
</li>
</ul>
<div class="mw-heading mw-heading3"><h3 id="Tools">Tools</h3></div>
<p>Other MongoDB tools can be found packaged as well:
</p>
<ul><li>
<b>MongoDB Shell</b> — The new <i>mongosh</i> tool, which replaces the legacy <i>mongo</i> shell<a rel="nofollow" class="external autonumber" href="https://www.mongodb.com/docs/v5.0/reference/program/mongo/">[2]</a>. It's compatible with MongoDB 4.0 or newer.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://www.mongodb.com/docs/mongodb-shell/">https://www.mongodb.com/docs/mongodb-shell/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongosh-bin/">mongosh-bin</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>MongoDB Compass</b> — the GUI interactive tool for querying, optimizing, and analyzing MongoDB data</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://www.mongodb.com/docs/compass/">https://www.mongodb.com/docs/compass/</a> ||  <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb-compass/">mongodb-compass</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb-compass-readonly/">mongodb-compass-readonly</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb-compass-isolated/">mongodb-compass-isolated</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>MongoDB Database Tools</b> — Provides import, export, and diagnostic capabilities</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://www.mongodb.com/docs/database-tools/">https://www.mongodb.com/docs/database-tools/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb-tools/">mongodb-tools</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>Mingo</b> — A proprietary, EULA licensed, MongoDB GUI built on <a href="../en/Electron.html" title="Electron">Electron</a>, designed to aid MongoDB developers with managing their databases.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://mingo.io/">https://mingo.io/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mingo/">mingo</a></span><sup><small>AUR</small></sup>
</dd></dl>
<div class="mw-heading mw-heading2"><h2 id="Usage">Usage</h2></div>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a>/<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">Enable</a> the <code>mongodb.service</code> daemon.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> During the first startup of the mongodb service, it will <a rel="nofollow" class="external text" href="https://docs.mongodb.com/manual/faq/storage/#preallocated-data-files">pre-allocate space</a>, by creating large files (for its journal and other data). This step may take a while, during which the MongoDB shell is unavailable.</div>
<p>To access the MongoDB shell <a rel="nofollow" class="external autonumber" href="https://docs.mongodb.com/mongodb-shell/">[3]</a>:
</p>
<pre>$ mongosh
</pre>
<p>Or, if authentication is configured:
</p>
<pre>$ mongosh -u <i>userName</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> The legacy <i>mongo</i> shell has been deprecated in MongoDB v5.0 and replaced with <i>mongosh</i><a rel="nofollow" class="external autonumber" href="https://www.mongodb.com/docs/v5.0/reference/program/mongo/#mongodb-binary-bin.mongo">[4]</a>. Although it is available in some MongoDB packages, it is highly recommended that you switch it starting in version 5.0.</div>
<div class="mw-heading mw-heading2"><h2 id="Configuration">Configuration</h2></div>
<div class="mw-heading mw-heading3"><h3 id="File_Format">File Format</h3></div>
<p>MongoDB uses a YAML-based configuration file format. See <a rel="nofollow" class="external free" href="https://docs.mongodb.com/manual/reference/configuration-options/">https://docs.mongodb.com/manual/reference/configuration-options/</a> for available configuration options.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mongodb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">systemLog:
   destination: file
   path: "/var/log/mongodb/mongod.log"
   logAppend: true
storage:
   journal:
      enabled: true
processManagement:
   fork: true
net:
   bindIp: 127.0.0.1
   port: 27017
setParameter:
   enableLocalhostAuthBypass: false
..</pre>
<div class="mw-heading mw-heading3"><h3 id="Requiring_Authentication">Requiring Authentication</h3></div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> By default, MongoDB does not require any authentication! Although, MongoDB only listens on the <code>localhost</code> interface by default to prevent outside access. This will still allow any local user to connect without authenticating and may exposes the database(s). It is recommended to enable access control to prevent any unwanted access. If you set MongoDB to listen on <code>0.0.0.0</code> you MUST enable access control or your data will be stolen and held ransom.</div>
<p>To create a MongoDB user account with administrator access <a rel="nofollow" class="external autonumber" href="https://docs.mongodb.com/manual/tutorial/enable-authentication/">[5]</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ mongosh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">use admin
db.createUser(
  {
    user: "myUserAdmin",
    pwd: "abc123",
    roles: [ { role: "userAdminAnyDatabase", db: "admin" }, "readWriteAnyDatabase" ]
  }
)</pre>
<p><a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">Append</a> the following to your <code>/etc/mongodb.conf</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mongodb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">security:
  authorization: "enabled"
</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Restart</a> <code>mongodb.service</code>.
</p>
<div class="mw-heading mw-heading3"><h3 id="NUMA">NUMA</h3></div>
<p>Running MongoDB with Non-Uniform Memory Access (NUMA) can significantly impact performance.  <a rel="nofollow" class="external autonumber" href="https://docs.mongodb.com/manual/administration/production-notes/#mongodb-and-numa-hardware">[6]</a>
</p>
<p>To see if your system uses NUMA:
</p>
<pre># dmesg | grep -i numa
</pre>
<p>Also, <code>/var/log/mongodb/mongod.log</code> will show warnings if NUMA is in use and MongoDB is not started through <code>numactl</code>.  (The <code>mongo</code> shell will also show this, but only if you do not have authentication enabled.)
</p>
<p>If your system uses NUMA, to improve performance, you should make MongoDB start through <code>numactl</code>. 
</p>
<p><a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">Edit</a> <code>mongodb.service</code> according to the package you installed. 
</p>
<p>If using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb/">mongodb</a></span><sup><small>AUR</small></sup>, change it from:
</p>
<pre>ExecStart=/usr/bin/mongod $OPTIONS
</pre>
<p>To:
</p>
<pre>ExecStart=<b>/usr/bin/numactl --interleave=all</b> /usr/bin/mongod $OPTIONS
</pre>
<p>If using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb-bin/">mongodb-bin</a></span><sup><small>AUR</small></sup>, change it from:
</p>
<pre>ExecStart=/usr/bin/mongod --quiet --config /etc/mongodb.conf
</pre>
<p>To:
</p>
<pre>ExecStart=<b>/usr/bin/numactl --interleave=all</b> /usr/bin/mongod --quiet --config /etc/mongodb.conf
</pre>
<p>Zone claim also needs to be disabled, but on arch, <code>/proc/sys/vm/zone_reclaim_mode</code> defaults to <code>0</code>.
</p>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Reenable">Reenable</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Restart</a> <code>mongodb.service</code> as needed.
</p>
<div class="mw-heading mw-heading3"><h3 id="Clean_Start_and_Stop">Clean Start and Stop</h3></div>
<p>By default, <a href="../en/Systemd.html" title="Systemd">systemd</a> immediately kills anything after asking it to start or stop, if it has not finished doing so within 90 seconds.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb/">mongodb</a></span><sup><small>AUR</small></sup> makes <a href="../en/Systemd.html" title="Systemd">systemd</a> wait as long as it takes for MongoDB to start, but <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb-bin/">mongodb-bin</a></span><sup><small>AUR</small></sup> does not.  Both packages allow <a href="../en/Systemd.html" title="Systemd">systemd</a> to kill MongoDB after it is asked to stop, if it has not finished within 90 seconds.
</p>
<p>Large MongoDB databases can take a considerable amount of time to cleanly shut down, especially if swap is being used.  (An active 450GB database on a top of the line NVMe with 64GB RAM and 16GB swap can take an hour to shut down.)
</p>
<p>By default, MongoDB uses journaling. <a rel="nofollow" class="external autonumber" href="https://docs.mongodb.com/manual/reference/configuration-options/#storage-options">[7]</a>  With journaling, an unclean shutdown should not pose a risk of data loss.  But, if not shutdown cleanly, large MongoDB databases can take a considerable amount of time to start back up.  In this case, choosing whether to require a clean shutdown is a choice of a slower shutdown versus a slower startup. <a rel="nofollow" class="external autonumber" href="https://groups.google.com/forum/?utm_medium=email&amp;utm_source=footer#!msg/mongodb-user/KjBU_GcNcmw/gR2UxRIFAgAJ">[8]</a>  
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> If you disable journaling, failing to require a clean shutdown severely risks data loss, so you really need to require a clean shutdown. <a rel="nofollow" class="external autonumber" href="https://docs.mongodb.com/manual/tutorial/recover-data-following-unexpected-shutdown/">[9]</a>
</div>
<p>To prevent <a href="../en/Systemd.html" title="Systemd">systemd</a> from killing MongoDB after 90 seconds, <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">edit</a> <code>mongodb.service</code>. 
</p>
<p>To allow MongoDB to cleanly shutdown, <a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">append</a> to the <code>[Service]</code> section: (On large databases, this may substantially slow down your system shutdown time, but speeds up your next MongoDB start time)
</p>
<pre>TimeoutStopSec=infinity
</pre>
<p>If MongoDB needs a long time to start back up, it can be very problematic for <a href="../en/Systemd.html" title="Systemd">systemd</a> to keep killing and restarting it every 90 seconds <a rel="nofollow" class="external autonumber" href="https://jira.mongodb.org/browse/SERVER-38086">[10]</a>, so <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb/">mongodb</a></span><sup><small>AUR</small></sup> prevents this.  If using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb-bin/">mongodb-bin</a></span><sup><small>AUR</small></sup>, to make <a href="../en/Systemd.html" title="Systemd">systemd</a> wait as long as it takes for MongoDB to start, <a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">append</a> to the <code>[Service]</code> section:
</p>
<pre>TimeoutStartSec=infinity
</pre>
<div class="mw-heading mw-heading2"><h2 id="Troubleshooting">Troubleshooting</h2></div>
<div class="mw-heading mw-heading3"><h3 id="MongoDB_will_not_start">MongoDB will not start</h3></div>
<p>If MongoDB will not start, and you just upgraded to <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mongodb/">mongodb</a></span><sup><small>AUR</small></sup> 4.0.6-2+, you probably have a custom <code>/etc/mongodb.conf</code>.  When MongoDB was in the <a href="../en/Official_repositories.html" title="Official repositories">Official repositories</a>, it used an Arch-specific configuration file that used the systemd service type of simple.  It now supplies upstream's systemd service and configuration files, which instead use a systemd service type of forking.  Pacman will automatically upgrade your systemd service file, but will only automatically upgrade your <code>/etc/mongodb.conf</code> <a href="../en/Pacman/Pacnew_and_Pacsave.html" title="Pacman/Pacnew and Pacsave">if you never modified it</a>.  In that case, systemd will be expecting <code>mongod</code> to fork, but its configuration file will tell it not to.  You need to: switch to the new configuration file installed at <code>/etc/mongodb.conf.pacnew</code>, and duplicate changes you made to the old one that you still need, considering the new one is now in the YAML format, and the old one is probably in the MongoDB 2.4 format; or modify your existing one to enable forking.  (To continue using the old 2.4 file format instead of YAML, adding <code>fork: true</code> should be what is needed.)
</p>
<p>Check that <code>mongodb.service</code> is configured to use the correct database location. 
</p>
<p>Add <code>--dbpath /var/lib/mongodb</code> to the <code>ExecStart</code> line:
</p>
<pre>ExecStart=/usr/bin/numactl --interleave=all mongod --quiet --config /etc/mongodb.conf --dbpath /var/lib/mongodb
</pre>
<p>Check that there is at least 3GB space available for its journal files, otherwise mongodb can fail to start (without issuing a message to the user):
</p>
<pre>$ df -h /var/lib/mongodb/
</pre>
<p>Check if the <code>mongod.lock</code> lock file is empty or not:
</p>
<pre># ls  -lisa /var/lib/mongodb
</pre>
<p>If it is, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Stop">stop</a> <code>mongodb.service</code>. Run a repair on the database, specifying the dbpath (<code>/var/lib/mongodb/</code> is the default <code>--dbpath</code> in Arch Linux):
</p>
<pre># mongod --dbpath /var/lib/mongodb/ --repair
</pre>
<p>Upon completion, the dbpath should contain the repaired data files and an empty <code>mongod.lock</code> file. 
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> In dire situations, you can remove the file, start the database using the possibly corrupt files, and attempt to recover data from the database. However, it is impossible to predict the state of the database in these situations. See <a rel="nofollow" class="external text" href="https://docs.mongodb.com/manual/tutorial/recover-data-following-unexpected-shutdown/">upstream document for detail</a>.</div>
<p>After running the repair as root, the files will be owned by the root user, whilst Arch Linux runs it under a different user. You will need to use chown to change the ownership of the files back to the correct user. See following link for further details: <a rel="nofollow" class="external text" href="http://earlz.net/view/2011/03/11/0015/mongodb-and-arch-linux">Further reference</a>
</p>
<pre># chown -R mongodb: /var/{log,lib}/mongodb/
</pre>
<div class="mw-heading mw-heading4"><h4 id="Switching_to_a_different_version_/_Clean_install">
<span id="Switching_to_a_different_version_.2F_Clean_install"></span>Switching to a different version / Clean install</h4></div>
<p>After removing a version of MongoDB and installing a different version, MongoDB might not start. In that case, try removing and recreating these folders (note that these will delete your database):
</p>
<pre>$ rm -r /var/{lib,log}/mongodb
$ mkdir /var/{lib,log}/mongodb
$ chown -R mongodb:mongodb /var/{log,lib}/mongodb/
</pre>
<div class="mw-heading mw-heading4"><h4 id="Some_computer_just_cannot_run_MongoDB">Some computer just cannot run MongoDB</h4></div>
<p>Some computers simply will not run MongoDB because their CPU architecture does not have the instruction set needed to run it. For instance, MongoDB was able to be installed on a <a href="../en/GPD_MicroPC.html" title="GPD MicroPC">GPD MicroPC</a> which has an Intel "Gemini Lake Refresh"/<a href="https://en.wikipedia.org/wiki/Goldmont_Plus" class="extiw" title="wikipedia:Goldmont Plus">Goldmount Plus</a> microarchitecture, but running the MongoDB Shell returned the following: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ mongosh 'mongodb://localhost:27017'</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Current Mongosh Log ID: 642b48661e2fc4dd5bda05d0
Connecting to:          mongodb://localhost:27017/?directConnection=true&amp;serverSelectionTimeoutMS=2000&amp;appName=mongosh+1.8.0
MongoNetworkError: connect ECONNREFUSED 127.0.0.1:27017</pre>
<p>Furthermore, <code>coredumpctl info</code> reported a signal <code>4 (ILL)</code> meaning that an illegal instruction execution was attempted. In other words, the computer did not have the instruction set to run this program, at least not locally.
</p>
<p>It was able to connect to MongoDB Atlas where the server is hosted remotely on a machine that can run MongoDB, no <code>mongodb.service</code> required.
</p>
<div class="mw-heading mw-heading3"><h3 id="Warning_about_Transparent_Huge_Pages_(THP)">
<span id="Warning_about_Transparent_Huge_Pages_.28THP.29"></span>Warning about Transparent Huge Pages (THP)</h3></div>
<p>One may want to permanently disable this feature by using a <a href="../en/Systemd.html#systemd-tmpfiles_-_temporary_files" class="mw-redirect" title="Tmpfile">tmpfile</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tmpfiles.d/mongodb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">w /sys/kernel/mm/transparent_hugepage/enabled - - - - never
w /sys/kernel/mm/transparent_hugepage/defrag - - - - never
</pre>
<p>Use <a href="../en/Sysctl.html" title="Sysctl">sysctl</a> to disable THP at runtime:
</p>
<pre># echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
# echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag
</pre>
<div class="mw-heading mw-heading3"><h3 id="Warning_about_Soft_rlimits_too_low">Warning about Soft rlimits too low</h3></div>
<p>If you are using systemd service, then <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">edit</a> the unit file:
</p>
<pre>[Service]
# Other directives omitted
# (file size)
LimitFSIZE=infinity
# (cpu time)
LimitCPU=infinity
# (virtual memory size)
LimitAS=infinity
# (locked-in-memory size)
LimitMEMLOCK=infinity
# (open files)
LimitNOFILE=64000
# (processes/threads)
LimitNPROC=64000
</pre>
<p>See following link for further details: <a rel="nofollow" class="external text" href="https://docs.mongodb.com/manual/reference/ulimit/#review-and-set-resource-limits">Further reference</a>
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Database_management_systems.html" title="Category:Database management systems">Database management systems</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=MongoDB&amp;oldid=813413">https://wiki.archlinux.org/index.php?title=MongoDB&amp;oldid=813413</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 30 July 2024, at 14:55.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container no-font-mode-scale">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue  vector-search-box-show-thumbnail vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search cdx-typeahead-search--show-thumbnail">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input mw-searchInput" autocomplete="off" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true"><span class="mw-page-title-main">MongoDB</span></div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only reading-lists-bookmark" id="ca-bookmark-sticky-header" tabindex="-1" data-event-name="watch-sticky-bookmark"><span class="vector-icon mw-ui-icon-wikimedia-bookmarkOutline mw-ui-icon-wikimedia-wikimedia-bookmarkOutline"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
