<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Universal 2nd Factor - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.45.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Universal_2nd_Factor rootpage-Universal_2nd_Factor skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Authentication_for_websites" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Authentication_for_websites">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Authentication for websites</span>
			</div>
		</a>
		
			<button aria-controls="toc-Authentication_for_websites-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Authentication for websites subsection</span>
			</button>
		
		<ul id="toc-Authentication_for_websites-sublist" class="vector-toc-list">
			<li id="toc-Firefox" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Firefox">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.1</span>
					<span>Firefox</span>
				</div>
			</a>
			
			<ul id="toc-Firefox-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Chromium/Chrome" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Chromium/Chrome">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.2</span>
					<span>Chromium/Chrome</span>
				</div>
			</a>
			
			<ul id="toc-Chromium/Chrome-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Authentication_for_user_sessions" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Authentication_for_user_sessions">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Authentication for user sessions</span>
			</div>
		</a>
		
			<button aria-controls="toc-Authentication_for_user_sessions-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Authentication for user sessions subsection</span>
			</button>
		
		<ul id="toc-Authentication_for_user_sessions-sublist" class="vector-toc-list">
			<li id="toc-Installing_the_PAM_module" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Installing_the_PAM_module">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>Installing the PAM module</span>
				</div>
			</a>
			
			<ul id="toc-Installing_the_PAM_module-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Adding_a_key" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Adding_a_key">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>Adding a key</span>
				</div>
			</a>
			
			<ul id="toc-Adding_a_key-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Passwordless_sudo" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Passwordless_sudo">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3</span>
					<span>Passwordless sudo</span>
				</div>
			</a>
			
			<ul id="toc-Passwordless_sudo-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-GDM_login" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#GDM_login">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4</span>
					<span>GDM login</span>
				</div>
			</a>
			
			<ul id="toc-GDM_login-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-SDDM/KDE" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#SDDM/KDE">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.5</span>
					<span>SDDM/KDE</span>
				</div>
			</a>
			
			<ul id="toc-SDDM/KDE-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Other_authentication_methods" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Other_authentication_methods">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.6</span>
					<span>Other authentication methods</span>
				</div>
			</a>
			
			<ul id="toc-Other_authentication_methods-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Troubleshooting">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.7</span>
					<span>Troubleshooting</span>
				</div>
			</a>
			
			<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-OpenSSH" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#OpenSSH">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>OpenSSH</span>
			</div>
		</a>
		
		<ul id="toc-OpenSSH-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Data-at-rest_encryption_with_LUKS" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Data-at-rest_encryption_with_LUKS">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Data-at-rest encryption with LUKS</span>
			</div>
		</a>
		
			<button aria-controls="toc-Data-at-rest_encryption_with_LUKS-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Data-at-rest encryption with LUKS subsection</span>
			</button>
		
		<ul id="toc-Data-at-rest_encryption_with_LUKS-sublist" class="vector-toc-list">
			<li id="toc-Non-root_partitions" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Non-root_partitions">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>Non-root partitions</span>
				</div>
			</a>
			
			<ul id="toc-Non-root_partitions-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar no-font-mode-scale">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Universal 2nd Factor</span></h1>
							
</header>
				<div class="vector-column-end no-font-mode-scale">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><a href="https://en.wikipedia.org/wiki/Universal_2nd_Factor" class="extiw" title="wikipedia:Universal 2nd Factor">Universal 2nd Factor (U2F)</a> is an open standard that strengthens and simplifies two-factor authentication (2FA) using specialized USB or NFC devices based on similar security technology found in smart cards.
</p>
<p>While initially developed by Google and Yubico, with contribution from NXP Semiconductors, the standard is now hosted by the FIDO Alliance.
</p>
<p>For all articles on U2F and U2F-devices see: <a href="../en/Category:Universal_2nd_Factor.html" title="Category:Universal 2nd Factor">Category:Universal 2nd Factor</a>.
</p>
<p><a href="../en/WebAuthn.html" title="WebAuthn">WebAuthn</a> is a more recent standard.
</p>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Authentication_for_websites">Authentication for websites</h2></div>
<p>U2F is supported by major sites like Google, Facebook, Twitter, or GitHub. Check out <a rel="nofollow" class="external text" href="https://2fa.directory/">2fa.directory</a> or <a rel="nofollow" class="external text" href="https://www.dongleauth.com/">dongleauth.com</a> to find other websites and links to setup documentation. For all browsers which support it, likely the only action required is to install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libfido2">libfido2</a></span>. Yubico offers a <a rel="nofollow" class="external text" href="https://demo.yubico.com/">demo page</a> for testing.
</p>
<div class="mw-heading mw-heading3"><h3 id="Firefox">Firefox</h3></div>
<p><a href="../en/Firefox/Tweaks.html#Fido_U2F_authentication" title="Firefox/Tweaks">Firefox/Tweaks#Fido U2F authentication</a>
</p>
<div class="mw-heading mw-heading3"><h3 id="Chromium/Chrome">
<span id="Chromium.2FChrome"></span>Chromium/Chrome</h3></div>
<p><a href="../en/Chromium/Tips_and_tricks.html#U2F_authentication" class="mw-redirect" title="Chromium/Tips and tricks">Chromium/Tips and tricks#U2F authentication</a>
</p>
<div class="mw-heading mw-heading2"><h2 id="Authentication_for_user_sessions">Authentication for user sessions</h2></div>
<p>Yubico, the company creating the YubiKey, develops an U2F <a href="../en/PAM.html" title="PAM">PAM</a> module. It can be used to act as a second factor during login or replace the need for a password entirely.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong>  Despite the mentions of Yubico/YubiKey in this document, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pam-u2f">pam-u2f</a></span> should also support any U2F and/or FIDO2 compliant keys. </div>
<div class="mw-heading mw-heading3"><h3 id="Installing_the_PAM_module">Installing the PAM module</h3></div>
<p>The module is part of the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pam-u2f">pam-u2f</a></span>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Adding_a_key">Adding a key</h3></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong>  The folder name below is the default location. It can be changed for <b>single user</b> implementations by moving the file to your preferred directory and appending <code>authfile=/path/to/u2f_keys</code> to the end of the line for pam_u2f.so. This is also useful if you wish to move <code>u2f_keys</code> to a protected part of the file-system. For multi-user implementations use a central mapping file as explained in the <a rel="nofollow" class="external text" href="https://developers.yubico.com/pam-u2f/">official documentation of pam-u2f</a>. </div>
<p>Keys need to be added with the tool <code>pamu2fcfg</code>:
</p>
<pre>$ mkdir ~/.config/Yubico
$ pamu2fcfg -i pam://<i>hostname</i> &gt; ~/.config/Yubico/u2f_keys
</pre>
<p>After entering your PIN, click the button of your U2F key to confirm the key.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> If the hostname of your system changes, e.g. because of DHCP in different networks, you would be unable to login. In order to prevent that, it is recommended to specify the above mentioned options and replace <code><i>hostname</i></code> with the actual hostname.</div>
<p>If you own more than one key, append the next ones with
</p>
<pre>$ pamu2fcfg -i pam://<i>hostname</i> -n &gt;&gt; ~/.config/Yubico/u2f_keys
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> The <code>-n</code> in the above command is required. It will omit the username portion of the generated entry as required in the spec for subsequent entries for the same user. Multiple entries with the same username will cause unpredictable behaviour in PAM. Also, do not add line breaks manually. The file <code>u2f_keys</code> must have only one line. <a rel="nofollow" class="external autonumber" href="https://developers.yubico.com/pam-u2f/">[1]</a>
</div>
<div class="mw-heading mw-heading3"><h3 id="Passwordless_sudo">Passwordless sudo</h3></div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> Before making any changes to your configuration, start a separate shell with root permissions (e.g. <code>sudo -s</code>). This way you can revert any changes if something goes wrong.</div>
<p>Add
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/sudo</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">auth            sufficient      pam_u2f.so cue origin=pam://<i>hostname</i> appid=pam://<i>hostname</i></pre>
<p>as the first line. Be sure to replace the <code><i>hostname</i></code> as mentioned above. Then create a new terminal and type <code>sudo ls</code>. Your key's LED should flash and after clicking it the command is executed. The option <code>cue</code> is set to provide indication of what to do, i.e. <code>Please touch the device</code>.
</p>
<p>In order to make the token the only method of sudo (ie. no password fallback) you will need to comment out the other auth methods present. This is usually just the default system-auth include.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/sudo</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#auth           include         system-auth
</pre>
<p>You should also change <code>sufficient</code> to <code>required</code> in the above <code>pam_u2f.so</code> line.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> This will mean that no user on the system will be able to sudo without a U2F token configured.</div>
<div class="mw-heading mw-heading3"><h3 id="GDM_login">GDM login</h3></div>
<p>Add:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/gdm-password</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">auth            required      pam_u2f.so nouserok origin=pam://<i>hostname</i> appid=pam://<i>hostname</i>
</pre>
<p>after the existing <code>auth</code> lines. Please note the use of the <code>nouserok</code> option which allows the rule to fail if the user did not configure a key. This way setups with multiple users where only some of them use a U2F key are supported.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> This method will not work with encrypted home partitions because the decryption is not done before the login process completed, so the <code>u2f_keys</code> file is unavailable. In this case use a central mapping file as explained in the <a rel="nofollow" class="external text" href="https://developers.yubico.com/pam-u2f/">official documentation of pam-u2f</a>.</div>
<p>Some multi-function security keys (ex. Trezor Model T) which can do U2F / PAM may not advertise the feature on system boot which is intentionally out of the CTAP 2.0 specification<a rel="nofollow" class="external autonumber" href="https://github.com/trezor/trezor-firmware/issues/3486">[2]</a>. With multiple U2F keys present, this can result in two-minute long delays when used with GDM as pam-u2f does sequential lookups and will wait for the (Trezor) device to timeout before offering presence / touch with the secondary U2F key <a rel="nofollow" class="external autonumber" href="https://github.com/Yubico/pam-u2f/issues/310">[3]</a>. You could try adding the <code>nodetect</code> option alongside <code>debug</code> and finish any device specific login (ex. screen PIN) before GDM loads.
</p>
<div class="mw-heading mw-heading3"><h3 id="SDDM/KDE">
<span id="SDDM.2FKDE"></span>SDDM/KDE</h3></div>
<p><a href="../en/SDDM.html" title="SDDM">SDDM</a> does not appear to support pam_u2f with initial user login. <a href="../en/SDDM.html#Autologin" title="SDDM">Autologin</a> can be used instead, and then edit <code>/etc/pam.d/kde</code> to just control screen locking.
</p>
<p>If you are using a U2F key with biometric authentication (e.g. Yubikey Bio) and want 1FA, use <code>/etc/pam.d/kde-fingerprint</code>, commenting out the pam_fprintd.so line and placing your changes in its place. This avoids an unnecessary "unlock" button that gets displayed after authentication, rather than simply unlocking immediately<a rel="nofollow" class="external autonumber" href="https://www.reddit.com/r/kdeneon/comments/1bgh78z/using_face_login_without_unlock_button_appearing/">[4]</a>.
</p>
<p>For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/kde-fingerprint</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#%PAM-1.0

auth       required                    pam_shells.so
auth       requisite                   pam_nologin.so
auth       requisite                   pam_faillock.so      preauth

# take over fprintd for u2f since yubikey bio is a fingerprint reader and bypasses kscreenlocker's "unlock" button
#-auth      required                    pam_fprintd.so
auth required pam_u2f.so cue pinverification=0 userverification=1

auth       optional                    pam_permit.so
auth       required                    pam_env.so

account    include                     system-local-login

password   required                    pam_deny.so

session    include                     system-local-login
</pre>
<p><br>
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> Do not use <code>auth sufficient</code> in <code>/etc/pam.d/kde-fingerprint</code> as you might in other PAM config files. This will cause failed authentication attempts to bypass the lock screen.</div>
<div class="mw-heading mw-heading3"><h3 id="Other_authentication_methods">Other authentication methods</h3></div>
<p>Enable the PAM module for other services like explained above. For example, to secure the screensaver of <a href="../en/Cinnamon.html" title="Cinnamon">Cinnamon</a>, edit <code>/etc/pam.d/cinnamon-screensaver</code>.
</p>
<p>For <a href="../en/Polkit.html" title="Polkit">Polkit</a>, copy the default configuration at <code>/usr/lib/pam.d/polkit-1</code> to <code>/etc/pam.d/polkit-1</code> and make your changes there.
</p>
<div class="mw-heading mw-heading3"><h3 id="Troubleshooting">Troubleshooting</h3></div>
<p>If you managed to lock yourself out of the system, boot into recovery mode or from a USB pen drive. Then revert the changes in the PAM configuration and reboot.
</p>
<p>In case the pam-u2f module silently fails, add <i>debug</i> keyword to the auth line in a file in <code>/etc/pam.d/</code>.
</p>
<div class="mw-heading mw-heading2"><h2 id="OpenSSH">OpenSSH</h2></div>
<p><a href="../en/OpenSSH.html" title="OpenSSH">OpenSSH</a> â‰¥8.2 supports FIDO/U2F hardware tokens natively, see <a href="../en/SSH_keys.html#FIDO/U2F" title="SSH keys">SSH keys#FIDO/U2F</a>.
</p>
<div class="mw-heading mw-heading2"><h2 id="Data-at-rest_encryption_with_LUKS">Data-at-rest encryption with LUKS</h2></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-go-next.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is a candidate for moving to <a href="../en/Systemd-cryptenroll.html" title="Systemd-cryptenroll">systemd-cryptenroll</a>.</b></p>
<div>
<b>Notes:</b> <i>systemd-cryptenroll</i> supports more than just FIDO. (Discuss in <a href="../en/Talk:Trusted_Platform_Module.html#move_systemd-cryptenroll_to_separate_article" title="Talk:Trusted Platform Module">Talk:Trusted Platform Module#move systemd-cryptenroll to separate article</a>)</div>
</div>
<p>Since version 248, <a href="../en/Systemd.html" title="Systemd">systemd</a> can be use to unlock a <a href="../en/Dm-crypt/Encrypting_an_entire_system.html" title="Dm-crypt/Encrypting an entire system">LUKS partition</a> using a FIDO2 key.
</p>
<p>First, you will need to setup your <code>/etc/crypttab</code> file (see below), or customize your <a href="../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">initramfs</a> if you wish to unlock your root partition. The full procedure is similar to the use of a TPM chip for unlocking. See <a href="../en/Systemd-cryptenroll.html#Trusted_Platform_Module" title="Systemd-cryptenroll">systemd-cryptenroll#Trusted Platform Module</a>.
</p>
<p>To register the key, you will need to use the <i>systemd-cryptenroll</i> utility. First, run the following command to list your detected keys:
</p>
<pre>$ systemd-cryptenroll --fido2-device=list
</pre>
<p>Then you can register the key in a LUKS slot, specifying <code>auto</code> value (or path to the FIDO2 device such as <code>/dev/hidrawX</code> if you have multiple):
</p>
<pre>$ systemd-cryptenroll --fido2-device=auto /dev/sd<i>X</i>
</pre>
<div class="mw-heading mw-heading3"><h3 id="Non-root_partitions">Non-root partitions</h3></div>
<p>For a non-root data partition the <a href="../en/Dm-crypt/System_configuration.html#crypttab" class="mw-redirect" title="Crypttab">crypttab</a> would look like this:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">data /dev/sd<i>X</i> none fido2-device=auto
</pre>
<p>This should also work if your encrypted partition is a logical volume managed under <a href="../en/LVM.html" title="LVM">LVM</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/crypttab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">data /dev/vg1/data none fido2-device=auto
</pre>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Universal_2nd_Factor.html" title="Category:Universal 2nd Factor">Universal 2nd Factor</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Move.html" title="Category:Pages or sections flagged with Template:Move">Pages or sections flagged with Template:Move</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Universal_2nd_Factor&amp;oldid=847180">https://wiki.archlinux.org/index.php?title=Universal_2nd_Factor&amp;oldid=847180</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 21 September 2025, at 21:46.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container no-font-mode-scale">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue  vector-search-box-show-thumbnail vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search cdx-typeahead-search--show-thumbnail">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input mw-searchInput" autocomplete="off" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true"><span class="mw-page-title-main">Universal 2nd Factor</span></div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only reading-lists-bookmark" id="ca-bookmark-sticky-header" tabindex="-1" data-event-name="watch-sticky-bookmark"><span class="vector-icon mw-ui-icon-wikimedia-bookmarkOutline mw-ui-icon-wikimedia-wikimedia-bookmarkOutline"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
