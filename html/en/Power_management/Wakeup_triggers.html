<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Power management/Wakeup triggers - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Power_management_Wakeup_triggers rootpage-Power_management skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Wakeup_trigger_interfaces" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Wakeup_trigger_interfaces">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Wakeup trigger interfaces</div>
		</a>
		
			<button aria-controls="toc-Wakeup_trigger_interfaces-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Wakeup trigger interfaces subsection</span>
			</button>
		
		<ul id="toc-Wakeup_trigger_interfaces-sublist" class="vector-toc-list">
			<li id="toc-/proc/acpi/wakeup" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#/proc/acpi/wakeup">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>/proc/acpi/wakeup</div>
			</a>
			
			<ul id="toc-/proc/acpi/wakeup-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-/sys/module/acpi/parameters/ec_no_wakeup" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#/sys/module/acpi/parameters/ec_no_wakeup">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>/sys/module/acpi/parameters/ec_no_wakeup</div>
			</a>
			
			<ul id="toc-/sys/module/acpi/parameters/ec_no_wakeup-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-/sys/devices/" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#/sys/devices/">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>/sys/devices/</div>
			</a>
			
			<ul id="toc-/sys/devices/-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-/sys/class/wakeup/*" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#/sys/class/wakeup/*">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.4</span>/sys/class/wakeup/*</div>
			</a>
			
			<ul id="toc-/sys/class/wakeup/*-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Persistent_settings" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Persistent_settings">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Persistent settings</div>
		</a>
		
			<button aria-controls="toc-Persistent_settings-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Persistent settings subsection</span>
			</button>
		
		<ul id="toc-Persistent_settings-sublist" class="vector-toc-list">
			<li id="toc-One-time_with_systemd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#One-time_with_systemd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>One-time with systemd</div>
			</a>
			
			<ul id="toc-One-time_with_systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Event-driven_with_udev" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Event-driven_with_udev">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Event-driven with udev</div>
			</a>
			
			<ul id="toc-Event-driven_with_udev-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-List_device_and/or_bus_trees" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#List_device_and/or_bus_trees">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>List device and/or bus trees</div>
			</a>
			
			<ul id="toc-List_device_and/or_bus_trees-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Last_wakeup_trigger_source" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Last_wakeup_trigger_source">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Last wakeup trigger source</div>
			</a>
			
			<ul id="toc-Last_wakeup_trigger_source-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Instantaneous_wakeups_from_suspend" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Instantaneous_wakeups_from_suspend">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Instantaneous wakeups from suspend</div>
			</a>
			
			<ul id="toc-Instantaneous_wakeups_from_suspend-sublist" class="vector-toc-list">
				<li id="toc-NVIDIA_drivers" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#NVIDIA_drivers">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.1</span>NVIDIA drivers</div>
			</a>
			
			<ul id="toc-NVIDIA_drivers-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-nouveau_driver" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#nouveau_driver">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.2</span>nouveau driver</div>
			</a>
			
			<ul id="toc-nouveau_driver-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Power management/Wakeup triggers</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 2 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-2" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">2 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/%E9%9B%BB%E6%BA%90%E7%AE%A1%E7%90%86/%E5%BE%A9%E5%B8%B0%E3%83%88%E3%83%AA%E3%82%AC%E3%83%BC" title="電源管理/復帰トリガー – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Power_management/Wakeup_triggers" title="Power management/Wakeup triggers – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <a href="../../en/Power_management.html" title="Power management">Power management</a>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../../en/Wake-on-LAN.html" title="Wake-on-LAN">Wake-on-LAN</a></li>
<li><a href="../../en/Laptop.html" title="Laptop">Laptop</a></li>
</ul>
</div>
<p>Wakeup triggers are event sources that can wake the system from any of the hardware <a href="../../en/Power_management.html" title="Power management">power-saving</a> <a href="https://en.wikipedia.org/wiki/Advanced_Configuration_and_Power_Interface#Power_states" class="extiw" title="w:Advanced Configuration and Power Interface">states</a>. The obvious example is the power or suspend button, the <a href="../../en/Wake-on-LAN.html" title="Wake-on-LAN">Wake-on-LAN</a> functionality or the lid switch in <a href="../../en/Laptop.html" title="Laptop">laptop</a> systems. Wakeup triggers can be controlled through various <a href="../../en/Kernel.html" title="Kernel">kernel</a> interfaces listed below. There is no unified interface covering all possible triggers.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Wakeup_trigger_interfaces">Wakeup trigger interfaces</span></h2>
<h3>
<span id=".2Fproc.2Facpi.2Fwakeup"></span><span class="mw-headline" id="/proc/acpi/wakeup">/proc/acpi/wakeup</span>
</h3>
<p>Reading the <code>/proc/acpi/wakeup</code> file yields list of ACPI-registered wakeup sources with corresponding <code>sysfs</code> IDs where available. Writing an entry from the <i>Device</i> column to the file toggles its state. For example, to disable waking on opening the laptop lid, run:
</p>
<pre># echo "LID" &gt; /proc/acpi/wakeup
</pre>
<h3>
<span id=".2Fsys.2Fmodule.2Facpi.2Fparameters.2Fec_no_wakeup"></span><span class="mw-headline" id="/sys/module/acpi/parameters/ec_no_wakeup">/sys/module/acpi/parameters/ec_no_wakeup</span>
</h3>
<p>This file represents the value of ACPI <a href="../../en/Kernel_module.html" title="Kernel module">kernel module</a> option <code>ec_no_wakeup</code>, which controls passing the wakeup triggers from embedded controller when the system is in the suspend-to-idle (<code>s2idle</code>) <a href="../../en/Power_management/Suspend_and_hibernate.html" title="Power management/Suspend and hibernate">power state</a> <a rel="nofollow" class="external autonumber" href="https://docs.kernel.org/admin-guide/pm/sleep-states.html">[1]</a>. On modern laptops embedded controller wakeups can cause excessive battery drain in <a href="../../en/Lenovo_ThinkPad_Helix_2nd_Gen.html#Disable_embedded-controller_wake-ups" title="Lenovo ThinkPad Helix 2nd Gen">some</a> cases.
</p>
<h3>
<span id=".2Fsys.2Fdevices.2F"></span><span class="mw-headline" id="/sys/devices/">/sys/devices/</span>
</h3>
<p>Each <code>sysfs</code> device that supports wakeup contains the file <code>wakeup</code> in a device's <code>power</code> subdirectory. The file contains wakeup trigger's status and can be written to as well. Bus controllers as well as endpoint devices can be capable of waking up the system. For example, to disable wakeups from the first USB controller (bus), run:
</p>
<pre># echo "disabled" &gt; /sys/bus/usb/devices/usb1/power/wakeup
</pre>
<p>An endpoint device should be able to wake the device if the trigger is enabled regardless of the controller's setting, however this might be hardware-dependent.
</p>
<p>Program <a href="../../en/Powertop.html" title="Powertop">PowerTOP</a> interfaces with <code>sysfs</code>, but it only lists wakeup triggers of networking and USB devices by reading <code>/sys/class/net/</code> and <code>/sys/bus/usb/devices/</code> (containing symlinks to <code>/sys/devices/</code>).
</p>
<h3>
<span id=".2Fsys.2Fclass.2Fwakeup.2F.2A"></span><span class="mw-headline" id="/sys/class/wakeup/*">/sys/class/wakeup/*</span>
</h3>
<p>Almost all wakeup triggers can be found in the <code>/sys/class/wakeup</code> directory, which contains symlinks to all relevant devices. This is useful for finding possible wakeup triggers by going through subdirectories. Some of the triggers can correspond to virtual devices while hardware-related wakeup triggers are the ones that contain at least one of these files:
</p>
<pre>/sys/class/wakeup/*/device/physical_node/power/wakeup
/sys/class/wakeup/*/device/power/wakeup
</pre>
<p>Some of wakeup triggers in <code>/sys/class/wakeup</code> also provide a link to the cryptic <code>/proc/acpi/wakeup</code> names where the following file is present:
</p>
<pre>/sys/class/wakeup/*/device/path
</pre>
<h2><span class="mw-headline" id="Persistent_settings">Persistent settings</span></h2>
<p>The <i>one-time</i> methods should suffice for setting the <code>/proc/acpi/wakeup</code> states and <code>acpi.ec_no_wakeups</code> <a href="../../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> while the <i>event-driven</i> approach with <a href="../../en/Udev.html" title="Udev">udev</a> is the reliable way to configure the <code>sysfs</code> devices.
</p>
<h3><span class="mw-headline" id="One-time_with_systemd">One-time with systemd</span></h3>
<p>The <code>ec_no_wakeups</code> ACPI <a href="../../en/Kernel_module.html" title="Kernel module">kernel module</a> option can be set at boot as described in the article. The standard solution to set the <code>sysfs</code> values at boot are <a href="../../en/Systemd.html#Writing_unit_files" title="Systemd">systemd services</a> such as in <a href="../../en/Power_management/Suspend_and_hibernate.html#PC_will_not_wake_from_sleep_on_A520I_and_B550I_motherboards" title="Power management/Suspend and hibernate">this troubleshooting case</a>. Another <a href="../../en/Systemd.html" title="Systemd">systemd</a>-based manager for <code>/proc/acpi/wakeup</code> is <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/wakeup-triggers/">wakeup-triggers</a></span><sup><small>AUR</small></sup>.
</p>
<p>Some systems can override some of the ACPI wakeup triggers upon power state transition(s) in what is more of a bug rather than a feature. If the hardware is overriding triggers at predictable times that can still be solved with appropriately crafted <a href="../../en/Systemd.html#Writing_unit_files" title="Systemd">systemd units</a>. The <code>sleep.target</code> is a generic target covering all different suspended states that might be helpful in this case, but there is no generic <code>wakeup.target</code> <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/6364">[2]</a>.
</p>
<p>This method only works reliably with <code>sysfs</code> devices that are connected all the time.
</p>
<h3><span class="mw-headline" id="Event-driven_with_udev">Event-driven with udev</span></h3>
<p>Setting the wakeup trigger status with <a href="../../en/Udev.html" title="Udev">udev</a> rules is an event-driven method that works reliably any time the devices with wakeup triggers are connected. The key is to detect an addition of a new device (<code>ACTION=="add"</code>) in a rule and set the wakeup trigger status with <code>ATTR{power/wakeup}="disabled"</code>. If the hardware is resetting this setting, udev can try to circumvent it by reapplying rules upon every device change (<code>ACTION=="add|change"</code>). A device tree with possible parameters for matching a particular device found in <code>sysfs</code> can be obtained with <code>udevadm info -q all -a /sys/devices/...</code>.
</p>
<p>A representative common example here would be a Logitech Unifying USB receiver. Its wakeup trigger should be enabled by default and if that is not desired, a solution could be an <a href="../../en/Udev.html" title="Udev">udev</a> rule, as follows:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/logitech-unifying.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ACTION=="add", SUBSYSTEM=="usb", DRIVERS=="usb", ATTRS{idVendor}=="046d", ATTRS{idProduct}=="c52b", ATTR{power/wakeup}="disabled"</pre>
<p>The reverse case to enable the necessary trigger(s) is described in the <a href="../../en/Udev.html#Waking_from_suspend_with_USB_device" title="Udev">udev</a> article.
</p>
<p>udev triggers so early in the device enumeration that disabling wakeup trigger with the method above causes (some?) disabled triggers to not be listed in <code>/sys/class/wakeup</code>. That might be dependent on whether the device was already present at boot and needs further clarification.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3>
<span id="List_device_and.2For_bus_trees"></span><span class="mw-headline" id="List_device_and/or_bus_trees">List device and/or bus trees</span>
</h3>
<p>These auxiliary commands can be helpful when trying to understand all wakeup triggers of a certain system, to aid with <a href="../../en/Udev.html" title="Udev">udev</a> rule writing or general wakeup source troubleshooting:
</p>
<pre># lshw -businfo -numeric
# lspci -DPPnn
# lsusb -tvv
</pre>
<h3><span class="mw-headline" id="Last_wakeup_trigger_source">Last wakeup trigger source</span></h3>
<p>The information on which wakeup source was the reason for the last device wakeup is unfortunately platform-specific. On x86 machines <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dmidecode">dmidecode</a></span> can be used:
</p>
<pre># dmidecode -t system | grep -P '\tWake-up Type\: '
</pre>
<h3><span class="mw-headline" id="Instantaneous_wakeups_from_suspend">Instantaneous wakeups from suspend</span></h3>
<p>For some Intel Haswell systems with the LynxPoint and LynxPoint-LP chipset, instantaneous wakeups after suspend are reported. They are linked to erroneous BIOS ACPI implementations and how the <code>xhci_hcd</code> module interprets it during boot. As a work-around reported affected systems are added to a denylist (named <code>XHCI_SPURIOUS_WAKEUP</code>) by the kernel case-by-case <a rel="nofollow" class="external autonumber" href="https://bugzilla.kernel.org/show_bug.cgi?id=66171#c6">[3]</a>.
</p>
<p>Instantaneous resume may happen, for example, if a USB device is plugged during suspend and ACPI wakeup triggers are enabled. A viable work-around for such a system, if it is not on the denylist yet, is to disable the wakeup triggers. An example to disable wakeup through USB is described as follows <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?pid=1575617">[4]</a>.
</p>
<p>To view the current configuration:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ cat /proc/acpi/wakeup</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Device  S-state   Status   Sysfs node
...
EHC1      S3    *enabled  pci:0000:00:1d.0
EHC2      S3    *enabled  pci:0000:00:1a.0
XHC       S3    *enabled  pci:0000:00:14.0
...
</pre>
<p>The relevant devices are <code>EHC1</code>, <code>EHC2</code> and <code>XHC</code> (for USB 3.0). To toggle their state you have to echo the device name to the file as root:
</p>
<pre># echo EHC1 &gt; /proc/acpi/wakeup
# echo EHC2 &gt; /proc/acpi/wakeup
# echo XHC &gt; /proc/acpi/wakeup
</pre>
<p>This should result in suspension working again. However, this settings are only temporary and need to be set at every boot. To automate this, see <a href="../../en/Systemd.html#systemd-tmpfiles_-_temporary_files" class="mw-redirect" title="Systemd-tmpfiles">systemd-tmpfiles</a> or <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1575617#p1575617">BBS thread</a> for possible solutions.
</p>
<p>On Gigabyte motherboards such as the B550i Aorus and the B550 AORUS ELITE V2, the GPP bridge to the NVMe drive drive may cause premature wakeups from suspend. Setting the status of <code>GPP0</code> to <i>disabled</i> may fix the issue:
</p>
<pre># echo GPP0 &gt; /proc/acpi/wakeup
</pre>
<h4><span class="mw-headline" id="NVIDIA_drivers">NVIDIA drivers</span></h4>
<p>Installing <a href="../../en/NVIDIA.html" title="NVIDIA">NVIDIA</a> proprietary drivers might render suspend and hibernation not possible. In that case the system log might include:
</p>
<pre>kernel: NVRM: GPU 0000:01:00.0: PreserveVideoMemoryAllocations module parameter is set. System Power Management attempted without driver procfs suspend interface. Please refer to the 'Configuring Power Management Support' section in the driver README.
kernel: PM: pci_pm_suspend(): nv_pmops_suspend+0x0/0x20 [nvidia] returns -5
kernel: PM: dpm_run_callback(): pci_pm_suspend+0x0/0x160 returns -5
kernel: nvidia 0000:01:00.0: PM: failed to suspend async: error -5
</pre>
<p>See <a href="../../en/NVIDIA/Tips_and_tricks.html#Preserve_video_memory_after_suspend" title="NVIDIA/Tips and tricks">NVIDIA/Tips and tricks#Preserve video memory after suspend</a>.
</p>
<h4><span class="mw-headline" id="nouveau_driver">nouveau driver</span></h4>
<p>If the <a href="../../en/Nouveau.html" title="Nouveau">nouveau</a> driver is used, the reason for instantaneous wakeups may be a bug in the driver, which sometimes prevents GPU from suspending. A possible workaround is unloading the <code>nouveau</code> kernel module right before going to sleep and loading it back after wakeup. To do this, create the following script:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/lib/systemd/system-sleep/10-nouveau.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash

case $1/$2 in
  pre/*)
    # echo "Going to $2..."
    /usr/bin/echo "0" &gt; /sys/class/vtconsole/vtcon1/bind
    /usr/bin/rmmod nouveau
    ;;
  post/*)
    # echo "Waking up from $2..."
    /usr/bin/modprobe nouveau
    /usr/bin/echo "1" &gt; /sys/class/vtconsole/vtcon1/bind
    ;;
esac</pre>
<p>The first echo line unbinds <code>nouveaufb</code> from the framebuffer console driver (<code>fbcon</code>). Usually it is <code>vtcon1</code> as in this example, but it may also be another <code>vtcon*</code>. See <code>/sys/class/vtconsole/vtcon*/name</code> which one of them is a <i>frame buffer device</i> <a rel="nofollow" class="external autonumber" href="https://nouveau.freedesktop.org/wiki/KernelModeSetting/">[5]</a>.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../../en/Category:Power_management.html" title="Category:Power management">Power management</a></li>
<li><a href="../../en/Category:Laptops.html" title="Category:Laptops">Laptops</a></li>
</ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Power_management/Wakeup_triggers&amp;oldid=808831">https://wiki.archlinux.org/index.php?title=Power_management/Wakeup_triggers&amp;oldid=808831</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 20 May 2024, at 11:28.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
