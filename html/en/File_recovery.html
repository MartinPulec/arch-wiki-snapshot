<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>File recovery - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-File_recovery rootpage-File_recovery skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Special_notes" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Special_notes">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Special notes</div>
		</a>
		
			<button aria-controls="toc-Special_notes-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Special notes subsection</span>
			</button>
		
		<ul id="toc-Special_notes-sublist" class="vector-toc-list">
			<li id="toc-Before_you_start" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Before_you_start">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Before you start</div>
			</a>
			
			<ul id="toc-Before_you_start-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Failing_drives" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Failing_drives">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Failing drives</div>
			</a>
			
			<ul id="toc-Failing_drives-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Backup_flash_media/small_partitions" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Backup_flash_media/small_partitions">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Backup flash media/small partitions</div>
			</a>
			
			<ul id="toc-Backup_flash_media/small_partitions-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Working_with_digital_cameras" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Working_with_digital_cameras">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.4</span>Working with digital cameras</div>
			</a>
			
			<ul id="toc-Working_with_digital_cameras-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-List_of_utilities" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#List_of_utilities">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>List of utilities</div>
		</a>
		
		<ul id="toc-List_of_utilities-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Ext4Magic" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Ext4Magic">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Ext4Magic</div>
		</a>
		
		<ul id="toc-Ext4Magic-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-TestDisk_and_PhotoRec" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#TestDisk_and_PhotoRec">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>TestDisk and PhotoRec</div>
		</a>
		
			<button aria-controls="toc-TestDisk_and_PhotoRec-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle TestDisk and PhotoRec subsection</span>
			</button>
		
		<ul id="toc-TestDisk_and_PhotoRec-sublist" class="vector-toc-list">
			<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Installation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Installation</div>
			</a>
			
			<ul id="toc-Installation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Usage" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Usage">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Usage</div>
			</a>
			
			<ul id="toc-Usage-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Files_recovered_by_photorec" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Files_recovered_by_photorec">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Files recovered by photorec</div>
			</a>
			
			<ul id="toc-Files_recovered_by_photorec-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#See_also">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>See also</div>
			</a>
			
			<ul id="toc-See_also-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-e2fsck" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#e2fsck">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>e2fsck</div>
		</a>
		
			<button aria-controls="toc-e2fsck-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle e2fsck subsection</span>
			</button>
		
		<ul id="toc-e2fsck-sublist" class="vector-toc-list">
			<li id="toc-Installation_2" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Installation_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Installation</div>
			</a>
			
			<ul id="toc-Installation_2-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Working_with_raw_disk_images" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Working_with_raw_disk_images">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Working with raw disk images</div>
		</a>
		
			<button aria-controls="toc-Working_with_raw_disk_images-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Working with raw disk images subsection</span>
			</button>
		
		<ul id="toc-Working_with_raw_disk_images-sublist" class="vector-toc-list">
			<li id="toc-Mount_the_entire_disk" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Mount_the_entire_disk">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>Mount the entire disk</div>
			</a>
			
			<ul id="toc-Mount_the_entire_disk-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Mounting_partitions" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Mounting_partitions">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2</span>Mounting partitions</div>
			</a>
			
			<ul id="toc-Mounting_partitions-sublist" class="vector-toc-list">
				<li id="toc-Getting_disk_geometry" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Getting_disk_geometry">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2.1</span>Getting disk geometry</div>
			</a>
			
			<ul id="toc-Getting_disk_geometry-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Using_QEMU_to_repair_NTFS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_QEMU_to_repair_NTFS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.3</span>Using QEMU to repair NTFS</div>
			</a>
			
			<ul id="toc-Using_QEMU_to_repair_NTFS-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Text_file_recovery" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Text_file_recovery">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Text file recovery</div>
		</a>
		
		<ul id="toc-Text_file_recovery-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-See_also_2" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also_2">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>See also</div>
		</a>
		
		<ul id="toc-See_also_2-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">File recovery</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 2 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-2" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">2 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%AA%E3%82%AB%E3%83%90%E3%83%AA" title="ファイルリカバリ – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/File_recovery" title="File recovery – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/File_recovery/Post_recovery_tasks.html#Photorec" title="File recovery/Post recovery tasks">/Post recovery tasks#Photorec</a></li>
</ul>
</div>
<p>This article lists data recovery and undeletion options for Linux.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Special_notes">Special notes</span></h2>
<h3><span class="mw-headline" id="Before_you_start">Before you start</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> The following advice is not true for devices which are failing, and mostly applies to accidental file deletion on a healthy drive. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:File_recovery.html">Talk:File recovery</a>)</div>
</div>
<p>This page is mostly intended to be used for educational purposes. If you have accidentally deleted or otherwise damaged your <b>valuable and irreplaceable</b> data and have no previous experience with data recovery, turn off your computer immediately (Just press and hold the off button or pull the plug; do not use the system shutdown function) and seek professional help.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> It is quite possible and even probable that, if you follow any of the steps described below without fully understanding them, you will worsen your situation.</div>
<h3><span class="mw-headline" id="Failing_drives">Failing drives</span></h3>
<p>In the area of data recovery, it is best to work on images of disks rather than physical disks themselves. Generally, a failing drive's condition worsens over time. The goal ought to be to first rescue as much data as possible as early as possible in the failure of the disk and to then abandon the disk. The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ddrescue">ddrescue</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dd_rescue">dd_rescue</a></span> utilities, unlike <code>dd</code>, will repeatedly try to recover from errors and will read the drive front to back, then back to front, attempting to salvage data. They keep log files so that recovery can be paused and resumed without losing progress.
</p>
<p>See <a href="../en/Disk_cloning.html" title="Disk cloning">Disk cloning</a>.
</p>
<p>The image files created from a utility like ddrescue can then be mounted like a physical device and can be worked on safely. Always make a copy of the original image so that you can revert if things go sour!
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Although written on the blog of a data recovery company, it seems there are <a rel="nofollow" class="external text" href="https://drivesaversdatarecovery.com/why-the-freezer-trick-for-hard-drives-doesnt-work/">voices against</a> the "freezer trick" on drives from the last 10 years. This paragraph is mostly untouched since 2009 and might not be applicable to modern drives. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:File_recovery.html">Talk:File recovery</a>)</div>
</div>
<p>A tried and true method of improving failing drive reads is to keep the drive cold. A bit of time in the freezer is appropriate, but be careful to avoid bringing the drive from cold to warm too quickly, as condensation will form. Keeping the drive in the freezer with cables connected to the recovering PC works great.
</p>
<p>Do not attempt a filesystem check on a failing drive, as this will likely make the problem <b>worse</b>. Mount it read-only.
</p>
<h3>
<span id="Backup_flash_media.2Fsmall_partitions"></span><span class="mw-headline" id="Backup_flash_media/small_partitions">Backup flash media/small partitions</span>
</h3>
<p>As an alternative to working with a 'live' partition (mounted or not), it is often preferable to work with an image, provided that the filesystem in question is not too large and that you have sufficient free HDD space to accommodate the image file. For example, flash memory devices like thumb drives, digital cameras, portable music players, cellular phones, etc. are likely to be small enough to image in many cases.
</p>
<p>Be sure to read the man pages for the utilities listed below to verify that they are capable of working with image files.
</p>
<p>To make an image, one can use <code>dd</code> as follows:
</p>
<pre># dd if=/dev/<i>target_partition</i> of=/home/<i>user/partition</i>.image
</pre>
<h3><span class="mw-headline" id="Working_with_digital_cameras">Working with digital cameras</span></h3>
<p>In order for some of the utilities listed in the next section to work with flash media, the device in question needs to be mounted as a block device (i.e., listed under /dev). Digital cameras operating in PTP (Picture Transfer Protocol) mode will not work in this regard. PTP cameras are transparently handled by libgphoto and/or libptp. In this case, "transparently" means that PTP devices do not get block devices. The alternative to PTP mode, USB Mass Storage (UMS) mode, is not supported by all cameras. Some cameras have a menu item that allows switching between the two modes; refer to your camera's user manual. If your camera does not support UMS mode and therefore cannot be accessed as a block device, your only alternative is to use a flash media reader and physically remove the storage media from your camera.
</p>
<h2><span class="mw-headline" id="List_of_utilities">List of utilities</span></h2>
<p>See also <a href="https://en.wikipedia.org/wiki/List_of_data_recovery_software#File_Recovery" class="extiw" title="wikipedia:List of data recovery software">Wikipedia:List of data recovery software#File Recovery</a>
</p>
<ul><li>
<b>ddrutility</b> — Compliment to GNU <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ddrescue">ddrescue</a></span>. Find what files are related to the bad sectors and some special tools for NTFS. No longer actively supported.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://sourceforge.net/projects/ddrutility/">https://sourceforge.net/projects/ddrutility/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ddrutility/">ddrutility</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b><a href="https://en.wikipedia.org/wiki/dvdisaster" class="extiw" title="wikipedia:dvdisaster">dvdisaster</a></b> — Additional error protection for CD/DVD media.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://sourceforge.net/projects/dvdisaster/">https://sourceforge.net/projects/dvdisaster/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dvdisaster/">dvdisaster</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>ext4magic</b> — recover deleted or overwritten files on ext3 and ext4 filesystems.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://sourceforge.net/projects/ext4magic/">https://sourceforge.net/projects/ext4magic/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ext4magic">ext4magic</a></span>
</dd></dl>
<ul><li>
<b><a href="../en/Foremost.html" title="Foremost">Foremost</a></b> — Console program to recover files based on their headers, footers, and internal data structures. This process is commonly referred to as data carving. The headers and footers can be specified by a configuration file or command line switches can be used to specify built-in file types.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://foremost.sourceforge.net/">https://foremost.sourceforge.net/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=foremost">foremost</a></span>
</dd></dl>
<ul><li>
<b><a href="https://en.wikipedia.org/wiki/PhotoRec" class="extiw" title="wikipedia:PhotoRec">PhotoRec</a></b> — File data recovery software designed to recover lost files including video, documents and archives from hard disks, CD-ROMs, and lost pictures (thus the Photo Recovery name) from digital camera memory.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://www.cgsecurity.org/">https://www.cgsecurity.org/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=testdisk">testdisk</a></span>
</dd></dl>
<ul><li>
<b>Scalpel</b> — File carving and indexing application originally based on <a href="../en/Foremost.html" title="Foremost">Foremost</a>, although significantly more efficient. It allows an examiner to specify a number of headers and footers to recover filetypes from a piece of media.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/sleuthkit/scalpel">https://github.com/sleuthkit/scalpel</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/scalpel-git/">scalpel-git</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b><a href="https://en.wikipedia.org/wiki/TestDisk" class="extiw" title="wikipedia:TestDisk">TestDisk</a></b> — Data recovery software primarily designed to help recover lost partitions and/or make non-booting disks bootable again when these symptoms are caused by faulty software: certain types of viruses or human error (such as accidentally deleting a Partition Table).</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://www.cgsecurity.org/">https://www.cgsecurity.org/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=testdisk">testdisk</a></span>
</dd></dl>
<ul><li>
<b><a href="../en/XFS.html#Undelete" title="XFS">xfs_undelete</a></b> — Traverses the inode B+trees of each allocation group and tries to recover all files on an XFS filesystem marked as deleted.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/ianka/xfs_undelete">https://github.com/ianka/xfs_undelete</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xfs_undelete-git/">xfs_undelete-git</a></span><sup><small>AUR</small></sup>
</dd></dl>
<h2><span class="mw-headline" id="Ext4Magic">Ext4Magic</span></h2>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ext4magic">ext4magic</a></span> is a recovery tool for the ext3 and ext4 file system.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Leaving the system on may let other processes running on the system overwrite the data blocks occupied by the deleted files. This is why <a href="#Before_you_start">#Before you start</a> suggests to shut down the system ASAP. If anything, the advice should be to <a rel="nofollow" class="external text" href="https://man.archlinux.org/man/fsync.2">sync data to disk</a> before the shutdown. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:File_recovery.html">Talk:File recovery</a>)</div>
</div>
<p>If you erroneously deleted some files/folders, <b>do not</b> turn off your computer. For best results (actually, for decent results) you must save the ext4 journal somewhere.
</p>
<p>Immediately open a terminal and dump a copy of the filesystem journal:
</p>
<pre># debugfs -R "dump &lt;8&gt; /some/safe/path/sd<i>XY</i>.journal" /dev/sd<i>XY</i>
</pre>
<p>Depending on whether the deleted files are on your root partition, you will want to save the journal to different locations: for root partitions, mount an external drive and dump the journal there; for non-root partitions, any other partition will do. Avoid saving to <code>/tmp</code>, because your data may be cleaned up.
</p>
<p>If the deleted files are on your root partition, you should turn off the computer after saving the journal. Do so by holding the power button until it turns off, because this prevents additional writes to the disk. Proceed with the process from the Arch bootable media. Otherwise, you may proceed with your booted system, after unmounting the affected partition (<code>sudo umount /dev/sdXY</code> or <code>sudo umount /home</code>, for example).
</p>
<p>To list the recoverable files:
</p>
<pre># ext4magic /dev/sd<i>XY</i> -a "$(date -d "-2hours" +%s)" -f deleted/folders/root -j <i>/some/safe/path/sdXY</i>.journal -l
</pre>
<ul>
<li>
<code>-a</code> applies a filter so that only files deleted after a certain Unix epoch are shown; in this example, it's set at the last 2 hours. If you are running from Arch bootable media, you may want to change the timezone (<code>export TZ="Europe/Berlin"</code>) before using absolute times. If not specified, the default is the last 24h.</li>
<li>
<code>-f</code> indicates that <code>ext4magic</code> should only list files in a certain subfolder. This path is relative to the partition root.</li>
<li>
<code>-j</code> indicates that <code>ext4magic</code> should use specific backup of the journal; otherwise it uses the regular system journal, which does not contain record of deletion if you have restarted your computer.</li>
<li>
<code>-l</code> lists the deleted files</li>
</ul>
<p>Files are listed with their recoverability percentage in the first column.
</p>
<p>To actually recover all files with 100% recoverability, run this command:
</p>
<pre># ext4magic /dev/sd<i>XY</i> -a "$(date -d "-2hours" +%s)" -f deleted/folders/root -j /some/safe/path/sd<i>XY</i>.journal -d /recovery/path -r
</pre>
<ul>
<li>
<code>-d</code> indicates the target where the recovered files will be stored</li>
<li>
<code>-r</code> indicates that only files with 100% recoverability should be recovered; <code>-m</code> will try to recover more files, but will take longer.</li>
</ul>
<p>If you are missing the journal backup you may still try to recover your files, but expect poor results.
</p>
<p>To recover all files, deleted in the last 24 hours:
</p>
<pre># ext4magic /dev/sd<i>XY</i> -r
</pre>
<p>To recover a directory or file:
</p>
<pre># ext4magic /dev/sd<i>XY</i> -f <i>path/to/lost/file</i> -r
</pre>
<p>The <i>lowercase r</i> flag <code>-r</code> will only recover complete files, that were not overwritten. 
To also recover broken files, that were partially overwritten, use the <i>uppercase R</i> flag <code>-R</code>. 
This will also restore not-deleted files and empty directories.
</p>
<p>The default destination is <code>./RECOVERDIR</code> 
which can be changed by adding the option <code>-d path/to/dest/dir</code>.
</p>
<p>If a file exists in the destination directory, 
the new file is renamed with a trailing hash sign <code>#</code>.
</p>
<p>To recover files deleted after 'five days ago':
</p>
<pre># ext4magic /dev/sd<i>XY</i> -f <i>path/to/lost/file</i> -a $(date -d -5days +%s) -r
</pre>
<p>To use a file list:
</p>
<pre># ext4magic /dev/sd<i>XY</i> -f <i>path/to/lost/file</i> -Lx | grep -a ^--- &gt;recovery-files-big.txt
# ext4magic /dev/sd<i>XY</i> -i recovery-files-big.txt -R

# ext4magic /dev/sd<i>XY</i> -f <i>path/to/lost/file</i> -lx | grep -a '^  100%' &gt;recovery-files-small.txt
# ext4magic /dev/sd<i>XY</i> -i recovery-files-small.txt -r
</pre>
<p>The difference between the <i>uppercase L</i> flag <code>-L</code> and the <i>lowercase L</i> flag <code>-l</code> 
is the same as between the two <i>r</i> flags <code>-R</code> and <code>-r</code> (see above).
</p>
<p>Use <code>grep -a</code> to preserve binary file names.
</p>
<p>Using a file list allows to filter the files, for example by file extension:
</p>
<pre># cat recovery-files-big.txt | grep -a '\.jpg"$' &gt;recovery-files-big-jpg.txt
</pre>
<p>... or to split the file list:
</p>
<pre># cat recovery-files-big.txt | split -l 100 - recovery-files-big-100-each-
</pre>
<h2><span class="mw-headline" id="TestDisk_and_PhotoRec">TestDisk and PhotoRec</span></h2>
<p>TestDisk and Photorec are both open-source data recovery utilities licensed under the terms of the <a rel="nofollow" class="external text" href="https://www.gnu.org/licenses/gpl.html">GNU Public License</a> (GPL).
</p>
<p><b>TestDisk</b> is primarily designed to help recover lost partitions and/or make non-booting disks bootable again when these symptoms are caused by faulty software, certain types of viruses, or human error, such as the accidental deletion of partition tables. TestDisk detects numerous filesystem including NTFS, FAT12, FAT16, FAT32, exFAT, ext2, ext3, ext4, btrfs, BeFS, CramFS, HFS, JFS, Linux Raid, Linux Swap, LVM, LVM2, NSS, ReiserFS, UFS, XFS. It can also undelete files from FAT, NTFS, exFAT and ext2 filesystem. 
</p>
<p>TestDisk allows to fix partition tables, recover deleted partitions, recover FAT32 boot sector from its backup, rebuild FAT12/FAT16/FAT32 boot sectors, fix FAT tables, rebuild NTFS boot sector and more.
</p>
<p><b>PhotoRec</b> is file recovery software designed to recover lost files including photographs (Hint: <b>Photo</b>graph<b>Rec</b>overy), videos, documents, archives from hard disks and CD-ROMs. PhotoRec ignores the filesystem and goes after the underlying data, so it will still work even with a re-formatted or severely damaged filesystems and/or partition tables.
</p>
<h3><span class="mw-headline" id="Installation">Installation</span></h3>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=testdisk">testdisk</a></span> package, which provides both TestDisk and PhotoRec.
</p>
<h3><span class="mw-headline" id="Usage">Usage</span></h3>
<p>After running e.g. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ddrescue">ddrescue</a></span> to create image.img, 
<code>photorec image.img</code> will open a terminal UI where you can select what file types to search for and where to put the recovered files. There is very good documentation on their <a rel="nofollow" class="external text" href="https://www.cgsecurity.org/wiki/TestDisk">wiki</a>.
</p>
<h3><span class="mw-headline" id="Files_recovered_by_photorec">Files recovered by photorec</span></h3>
<p>The photorec utility stores recovered files with a random names(for most of the files) under a numbered directories, e.g. <code>./recup_dir.1/f872690288.jpg</code>, <code>./recup_dir.1/f864563104_wmclockmon-0.1.0.tar.gz</code>.
</p>
<h3><span class="mw-headline" id="See_also">See also</span></h3>
<ul>
<li>How to get the original filenames: <a rel="nofollow" class="external text" href="https://www.cgsecurity.org/wiki/PhotoRec_FAQ#How_to_get_the_original_filenames_.3F">PhotoRec FAQ</a>
</li>
<li>How to add your own custom file signature: <a rel="nofollow" class="external text" href="https://www.cgsecurity.org/wiki/Add_your_own_extension_to_PhotoRec">CGSecurity Wiki</a>
</li>
<li>Wiki (TestDisk): <a rel="nofollow" class="external free" href="https://www.cgsecurity.org/wiki/TestDisk">https://www.cgsecurity.org/wiki/TestDisk</a>
</li>
<li>Wiki (Photorec): <a rel="nofollow" class="external free" href="https://www.cgsecurity.org/wiki/PhotoRec">https://www.cgsecurity.org/wiki/PhotoRec</a>
</li>
<li>Homepage: <a rel="nofollow" class="external free" href="https://www.cgsecurity.org/">https://www.cgsecurity.org/</a>
</li>
</ul>
<h2><span class="mw-headline" id="e2fsck">e2fsck</span></h2>
<p><b>e2fsck</b> is the ext2/ext3 filesystem checker included in the base install of Arch. e2fsck relies on a valid superblock. A superblock is a description of the entire filesystem's parameters. Because this data is so important, several copies of the superblock are distributed throughout the partition. With the <code>-b</code> option, e2fsck can take an alternate superblock argument; this is useful if the main, first superblock is damaged.
</p>
<p>To determine where the superblocks are, run <code>dumpe2fs -h</code> on the target, unmounted partition. Superblocks are spaced differently depending on the filesystem's blocksize, which is set when the filesystem is created.
</p>
<p>An alternate method to determine the locations of superblocks is to use the -n option with mke2fs. Be <b>sure</b> to use the <code>-n</code> flag, which, according to <span class="plainlinks archwiki-template-man" title="$ man 8 mke2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mke2fs.8">mke2fs(8)</a></span>, "Causes mke2fs to not actually create a filesystem, but display what it would do if it were to create a filesystem. This can be used to determine the location of the backup superblocks for a particular filesystem, so long as the mke2fs parameters that were passed when the filesystem was originally created are used again. (With the -n option added, of course!)".
</p>
<h3><span class="mw-headline" id="Installation_2">Installation</span></h3>
<p>Both <code>e2fsck</code> and <code>dumpe2fs</code> are included in the base Arch install as part of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=e2fsprogs">e2fsprogs</a></span>.
</p>
<p>See also <span class="plainlinks archwiki-template-man" title="$ man 8 e2fsck"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/e2fsck.8">e2fsck(8)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 8 dumpe2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dumpe2fs.8">dumpe2fs(8)</a></span>.
</p>
<h2><span class="mw-headline" id="Working_with_raw_disk_images">Working with raw disk images</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Merge-arrows-2.svg" decoding="async" width="36" height="40" class="mw-file-element"></span></span><b>This article or section is a candidate for merging with <a href="../en/QEMU.html" title="QEMU">QEMU</a>.</b></p>
<div>
<b>Notes:</b> <span style="color:red;">please use the second argument of the template to provide more detailed indications.</span> (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:File_recovery.html">Talk:File recovery</a>)</div>
</div>
<p>If you have backed up a drive using ddrescue or dd and you need to mount this image as a physical drive, see this section.
</p>
<h3><span class="mw-headline" id="Mount_the_entire_disk">Mount the entire disk</span></h3>
<p>To mount a complete disk image to the next free loop device, use the <code>losetup</code> command:
</p>
<pre># losetup -f -P /path/to/image
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>The <code>-f</code> flag mounts the image to the next available loop device.</li>
<li>The <code>-P</code> flag creates additional devices for every partition.</li>
</ul>
</div>
<p>See also <a href="../en/QEMU.html#With_loop_module_autodetecting_partitions" title="QEMU">QEMU#With loop module autodetecting partitions</a>.
</p>
<h3><span class="mw-headline" id="Mounting_partitions">Mounting partitions</span></h3>
<p>In order to be able to mount a partition of a whole disk image, follow <a href="#Mount_the_entire_disk">the steps above</a>.
</p>
<p>Once the whole disk image is mounted, a normal <code>mount</code> command can be used on the loop device:
</p>
<pre># mount /dev/loop0p1 /mnt/example
</pre>
<p>This command mounts the first partition of the image in loop0 to the folder to the mountpoint <code>/mnt/example</code>. Remember that the mountpoint directory must exist!
</p>
<h4><span class="mw-headline" id="Getting_disk_geometry">Getting disk geometry</span></h4>
<p>Once the entire disk image has been mounted as a loopback device, its drive layout can be inspected.
</p>
<h3><span class="mw-headline" id="Using_QEMU_to_repair_NTFS">Using QEMU to repair NTFS</span></h3>
<p>With a disk image that contains one or more NTFS partitions that need to be <code>chkdsk</code>ed by Windows since no good NTFS filesystem checker for Linux exists, QEMU can use a raw disk image as a real hard disk inside a virtual machine:
</p>
<pre># qemu -hda <i>/path/to/primary</i>.img -hdb <i>/path/to/DamagedDisk</i>.img
</pre>
<p>Then, assuming Windows is installed on <code><i>primary</i>.img</code>, it can be used to check partitions on <code><i>/path/to/DamagedDisk</i>.img</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Do not use lower version of Windows to check NTFS partitions create by higher version of it, e.g. Windows XP can do damage to NTFS partitions created by Windows 8 by "fixing" <a href="https://en.wikipedia.org/wiki/NTFS#Metafiles" class="extiw" title="wikipedia:NTFS">metadata</a> configuration that it does not support, resulting in damage/removal of these unsupported entries.</div>
<h2><span class="mw-headline" id="Text_file_recovery">Text file recovery</span></h2>
<p>It is possible to find deleted plain text files on a hard drive by directly searching on the block device. A preferably unique string from the file you are trying to recover is needed.
</p>
<p>Use <code>grep</code> to search for fixed strings (<code>-F</code>) directly on the partition:
</p>
<pre>$ grep -a -C 200 -F 'Unique string in text file' /dev/sd<i>XN</i> &gt; <i>OutputFile</i>
</pre>
<p>Hopefully, the content of the deleted file is now in <i>OutputFile</i>, which can be extracted from the surrounding context manually.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <code>-C 200</code> option tells grep to print 200 lines of context from before and after each match of the string. Alternatives are the <code>-A</code> and <code>-B</code> flags, which print context only from after and before each match, respectively. You may need to adjust the number of lines if the file you are looking for is very long.</div>
<h2><span class="mw-headline" id="See_also_2">See also</span></h2>
<ul><li>
<a rel="nofollow" class="external text" href="https://help.ubuntu.com/community/DataRecovery">Data Recovery</a> on the Ubuntu wiki</li></ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:File_systems.html" title="Category:File systems">File systems</a></li>
<li><a href="../en/Category:System_recovery.html" title="Category:System recovery">System recovery</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=File_recovery&amp;oldid=812303">https://wiki.archlinux.org/index.php?title=File_recovery&amp;oldid=812303</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 12 July 2024, at 12:40.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
