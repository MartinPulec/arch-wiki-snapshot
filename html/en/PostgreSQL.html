<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>PostgreSQL - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-PostgreSQL rootpage-PostgreSQL skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Initial_configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Initial_configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Initial configuration</div>
		</a>
		
		<ul id="toc-Initial_configuration-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Create_your_first_database/user" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Create_your_first_database/user">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Create your first database/user</div>
		</a>
		
		<ul id="toc-Create_your_first_database/user-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Familiarize_with_PostgreSQL" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Familiarize_with_PostgreSQL">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Familiarize with PostgreSQL</div>
		</a>
		
			<button aria-controls="toc-Familiarize_with_PostgreSQL-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Familiarize with PostgreSQL subsection</span>
			</button>
		
		<ul id="toc-Familiarize_with_PostgreSQL-sublist" class="vector-toc-list">
			<li id="toc-Access_the_database_shell" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Access_the_database_shell">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Access the database shell</div>
			</a>
			
			<ul id="toc-Access_the_database_shell-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Optional_configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Optional_configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Optional configuration</div>
		</a>
		
			<button aria-controls="toc-Optional_configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Optional configuration subsection</span>
			</button>
		
		<ul id="toc-Optional_configuration-sublist" class="vector-toc-list">
			<li id="toc-Restricts_access_rights_to_the_database_superuser_by_default" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Restricts_access_rights_to_the_database_superuser_by_default">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Restricts access rights to the database superuser by default</div>
			</a>
			
			<ul id="toc-Restricts_access_rights_to_the_database_superuser_by_default-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Require_password_for_login" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Require_password_for_login">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Require password for login</div>
			</a>
			
			<ul id="toc-Require_password_for_login-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Configure_PostgreSQL_to_be_accessible_exclusively_through_UNIX_Sockets" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Configure_PostgreSQL_to_be_accessible_exclusively_through_UNIX_Sockets">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Configure PostgreSQL to be accessible exclusively through UNIX Sockets</div>
			</a>
			
			<ul id="toc-Configure_PostgreSQL_to_be_accessible_exclusively_through_UNIX_Sockets-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Configure_PostgreSQL_to_be_accessible_from_remote_hosts" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Configure_PostgreSQL_to_be_accessible_from_remote_hosts">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>Configure PostgreSQL to be accessible from remote hosts</div>
			</a>
			
			<ul id="toc-Configure_PostgreSQL_to_be_accessible_from_remote_hosts-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Configure_PostgreSQL_authenticate_against_PAM" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Configure_PostgreSQL_authenticate_against_PAM">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5</span>Configure PostgreSQL authenticate against PAM</div>
			</a>
			
			<ul id="toc-Configure_PostgreSQL_authenticate_against_PAM-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Change_default_data_directory" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Change_default_data_directory">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.6</span>Change default data directory</div>
			</a>
			
			<ul id="toc-Change_default_data_directory-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Change_default_encoding_of_new_databases_to_UTF-8" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Change_default_encoding_of_new_databases_to_UTF-8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.7</span>Change default encoding of new databases to UTF-8</div>
			</a>
			
			<ul id="toc-Change_default_encoding_of_new_databases_to_UTF-8-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enable_data_checksumming" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enable_data_checksumming">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.8</span>Enable data checksumming</div>
			</a>
			
			<ul id="toc-Enable_data_checksumming-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Graphical_tools" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Graphical_tools">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Graphical tools</div>
		</a>
		
		<ul id="toc-Graphical_tools-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Set_up_backups" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Set_up_backups">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Set up backups</div>
		</a>
		
		<ul id="toc-Set_up_backups-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Upgrading_PostgreSQL" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Upgrading_PostgreSQL">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>Upgrading PostgreSQL</div>
		</a>
		
			<button aria-controls="toc-Upgrading_PostgreSQL-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Upgrading PostgreSQL subsection</span>
			</button>
		
		<ul id="toc-Upgrading_PostgreSQL-sublist" class="vector-toc-list">
			<li id="toc-pg_upgrade" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#pg_upgrade">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.1</span>pg_upgrade</div>
			</a>
			
			<ul id="toc-pg_upgrade-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Manual_dump_and_reload" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Manual_dump_and_reload">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.2</span>Manual dump and reload</div>
			</a>
			
			<ul id="toc-Manual_dump_and_reload-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">9</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Improve_performance_of_small_transactions" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Improve_performance_of_small_transactions">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.1</span>Improve performance of small transactions</div>
			</a>
			
			<ul id="toc-Improve_performance_of_small_transactions-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-PostgreSQL_database_unable_to_start_after_package_update_when_using_extensions" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#PostgreSQL_database_unable_to_start_after_package_update_when_using_extensions">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.2</span>PostgreSQL database unable to start after package update when using extensions</div>
			</a>
			
			<ul id="toc-PostgreSQL_database_unable_to_start_after_package_update_when_using_extensions-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Failing_to_start_a_PostgreSQL_server_with_the_older_version_of_the_database_while_upgrading_to_the_newer_version_with_extensions" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Failing_to_start_a_PostgreSQL_server_with_the_older_version_of_the_database_while_upgrading_to_the_newer_version_with_extensions">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.3</span>Failing to start a PostgreSQL server with the older version of the database while upgrading to the newer version with extensions</div>
			</a>
			
			<ul id="toc-Failing_to_start_a_PostgreSQL_server_with_the_older_version_of_the_database_while_upgrading_to_the_newer_version_with_extensions-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-WARNING:_database_"postgres"_has_a_collation_version_mismatch' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#WARNING:_database_"postgres"_has_a_collation_version_mismatch'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.4</span>WARNING:  database "postgres" has a collation version mismatch</div>
			</a>
			
			<ul id='toc-WARNING:_database_"postgres"_has_a_collation_version_mismatch-sublist' class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">PostgreSQL</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/PostgreSQL" title="PostgreSQL – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/PostgreSQL.html" title="PostgreSQL – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/PostgreSQL" title="PostgreSQL – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/PhpPgAdmin.html" title="PhpPgAdmin">PhpPgAdmin</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://www.postgresql.org/">PostgreSQL</a> is an open source, community driven, standard compliant object-relational database system.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> See <a href="#Upgrading_PostgreSQL">#Upgrading PostgreSQL</a> for necessary steps before upgrading to new versions of the PostgreSQL packages.</div>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql">postgresql</a></span> package. It will also create a system user called <i>postgres</i>.
</p>
<p>You can now switch to the <i>postgres</i> user using a <a href="../en/List_of_applications/Security.html#Privilege_elevation" title="List of applications/Security">privilege elevation program</a>.
</p>
<h2><span class="mw-headline" id="Initial_configuration">Initial configuration</span></h2>
<p>Before PostgreSQL can function correctly, the database cluster must be initialized:
</p>
<pre>[postgres]$ initdb -D /var/lib/postgres/data
</pre>
<p>Where <code>-D</code> is the default location where the database cluster must be stored (see <a href="#Change_default_data_directory">#Change default data directory</a> if you want to use a different one). <code>initdb</code> accepts a number of extra arguments:
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> PostgreSQL also supports ICU locales.<a rel="nofollow" class="external autonumber" href="https://www.postgresql.org/docs/current/locale.html#id-1.6.11.3.7">[1]</a> (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:PostgreSQL.html">Talk:PostgreSQL</a>)</div>
</div>
<ul>
<li>By default, the <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/locale.html">locale and the encoding for the database cluster</a> are derived from your current environment (using <a href="../en/Locale.html#LANG:_default_locale" title="Locale">$LANG</a> value). If this is not what you want, you can override the defaults using <code>--locale=<i>locale</i></code> (where <i>locale</i> is to be chosen amongst the system's <a href="../en/Locale.html#Generating_locales" title="Locale">available locales</a>) and <code>--encoding=<i>encoding</i></code> (which must match the chosen locale). (Once the database is up, you can check which values were used with <code>[postgres]$ psql -l</code>.) <div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Using a locale other than <code>C.UTF-8</code>, <code>C</code>, <code>POSIX</code> or <code>ucs_basic</code> can result in a collation version mismatch that will require reindexing if the library providing the locale (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=glibc">glibc</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=icu">icu</a></span>) gets updated. See <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/77445">FS#77445</a>.</div>
</li>
<li>If your data directory resides on a file system without data checksumming, you may wish to enable PostgreSQL's built-in <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/checksums.html">checksumming</a> for increased integrity guarantees - add the <code>--data-checksums</code> argument to do so. Read <a href="#Enable_data_checksumming">#Enable data checksumming</a> for more information. (Once the database is up, you can check if it is enabled with <code>[postgres]$ psql --tuples-only -c "SHOW data_checksums"</code>.)</li>
<li>The <i>trust</i> authentication method is used by default, meaning that anyone on the host can connect as any database user. You can use <code>--auth-local=peer --auth-host=scram-sha-256</code> for safer authentication methods.</li>
<li>The <code>-c</code>/<code>--set</code> option can be used to set any <code>postgresql.conf</code> parameter avoiding the need to manually edit <code>postgresql.conf</code>.</li>
<li>For more options, see <code>initdb --help</code> and <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/creating-cluster.html">official documentation</a>.</li>
</ul>
<p>Example:
</p>
<pre>[postgres]$ initdb --locale=C.UTF-8 --encoding=UTF8 -D /var/lib/postgres/data --data-checksums
</pre>
<p>Many lines should now appear on the screen with several ending by <code>... ok</code>:
</p>
<pre>The files belonging to this database system will be owned by user "postgres".
This user must also own the server process.

The database cluster will be initialized with locale "C.UTF-8".
The default text search configuration will be set to "english".

Data page checksums are enabled.

creating directory /var/lib/postgres/data ... ok
creating subdirectories ... ok
selecting dynamic shared memory implementation ... posix
selecting default max_connections ... 100
selecting default shared_buffers ... 128MB
selecting default time zone ... UTC
creating configuration files ... ok
running bootstrap script ... ok
performing post-bootstrap initialization ... ok
syncing data to disk ... ok

initdb: warning: enabling "trust" authentication for local connections
initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb.

Success. You can now start the database server using:

    pg_ctl -D /var/lib/postgres/data -l logfile start
</pre>
<p>If these are the kind of lines you see, then the process succeeded. Return to the regular user using <code>exit</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> 
<ul>
<li>To read more about this <i>initdb</i> warning, see <a href="#Restricts_access_rights_to_the_database_superuser_by_default">#Restricts access rights to the database superuser by default</a>.</li>
<li>If the database resides on a <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a> file system, you should consider disabling <a href="../en/Btrfs.html#Copy-on-Write_(CoW)" title="Btrfs">Copy-on-Write</a> for the directory before creating any database.</li>
<li>If the database resides on a <a href="../en/ZFS.html" title="ZFS">ZFS</a> file system, you should consult <a href="../en/ZFS.html#Databases" title="ZFS">ZFS#Databases</a> before creating any database.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you change the root to something other than <code>/var/lib/postgres</code>, you will have to <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">edit</a> the service file. If the root is under <code>home</code>, make sure to set <code>ProtectHome</code> to false.</div>
<p>Finally, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> the <code>postgresql.service</code>.
</p>
<h2>
<span id="Create_your_first_database.2Fuser"></span><span class="mw-headline" id="Create_your_first_database/user">Create your first database/user</span>
</h2>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you create a PostgreSQL role/user with the same name as your Linux username, it allows you to access the PostgreSQL database shell without having to specify a user to login (which makes it quite convenient).</div>
<p>Become the postgres user. Add a new database role/user using the <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/app-createuser.html">createuser</a> command:
</p>
<pre>[postgres]$ createuser --interactive
</pre>
<p>Create a new database over which the above user has read/write privileges using the <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/app-createdb.html">createdb</a> command (execute this command from your login shell if the database user has the same name as your Linux user, otherwise add <code>-O <i>database-username</i></code> to the following command):
</p>
<pre>$ createdb myDatabaseName
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you did not grant your new user database creation privileges, add <code>-U postgres</code> to the previous command.</div>
<h2><span class="mw-headline" id="Familiarize_with_PostgreSQL">Familiarize with PostgreSQL</span></h2>
<h3><span class="mw-headline" id="Access_the_database_shell">Access the database shell</span></h3>
<p>Become the postgres user. Start the primary database shell, <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/app-psql.html">psql</a>, where you can do all your creation of databases/tables, deletion, set permissions, and run raw SQL commands. Use the <code>-d</code> option to connect to the database you created (without specifying a database, <code>psql</code> will try to access a database that matches your username).
</p>
<pre>[postgres]$ psql -d <i>myDatabaseName</i>
</pre>
<p>Some helpful commands:
</p>
<p>Get help:
</p>
<pre>=&gt; \help
</pre>
<p>List all databases:
</p>
<pre>=&gt; \l
</pre>
<p>Connect to a particular database:
</p>
<pre>=&gt; \c <i>database</i>
</pre>
<p>List all users and their permission levels:
</p>
<pre>=&gt; \du
</pre>
<p>Show summary information about all tables in the current database:
</p>
<pre>=&gt; \dt
</pre>
<p>Exit/quit the <code>psql</code> shell:
</p>
<pre>=&gt; \q
</pre>
<p>or press <code>Ctrl+d</code>.
</p>
<p>There are of course many more meta-commands, but these should help you get started. To see all meta-commands run: 
</p>
<pre>=&gt; \?
</pre>
<h2><span class="mw-headline" id="Optional_configuration">Optional configuration</span></h2>
<p>The PostgreSQL database server configuration file is <code>postgresql.conf</code>. This file is located in the data directory of the server, typically <code>/var/lib/postgres/data</code>. This folder also houses the other main configuration files, including the <code>pg_hba.conf</code> which defines authentication settings, for both <a href="#Restricts_access_rights_to_the_database_superuser_by_default">local users</a> and <a href="#Configure_PostgreSQL_to_be_accessible_from_remote_hosts">other hosts ones</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> By default, this folder will not be browsable or searchable by a regular user. This is why <code>find</code> and <code>locate</code> are not finding the configuration files.</div>
<h3><span class="mw-headline" id="Restricts_access_rights_to_the_database_superuser_by_default">Restricts access rights to the database superuser by default</span></h3>
<p>The defaults <code>pg_hba.conf</code> <b>allow any local user to connect as any database user</b>, including the database superuser.
This is likely not what you want, so in order to restrict global access to the <i>postgres</i> user, change the following line:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/pg_hba.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only
local   all             all                                     trust</pre>
<p>To:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/pg_hba.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only
local   all             postgres                                peer</pre>
<p>You might later add additional lines depending on your needs or software ones.
</p>
<h3><span class="mw-headline" id="Require_password_for_login">Require password for login</span></h3>
<p>Edit <code>/var/lib/postgres/data/pg_hba.conf</code> and set the authentication method for each user (or <code>all</code> to affect all users) to <code>scram-sha-256</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/pg_hba.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only
local   all             <i>user</i>                                    scram-sha-256</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Changing the authentication method in <code>pg_hba.conf</code> does not update the hashed passwords stored in the database <a rel="nofollow" class="external autonumber" href="https://stackoverflow.com/a/64317399">[2]</a>. To migrate from <code>md5</code> to <code>scram-sha-256</code>, you need to set a new password for each database user.</div>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Restart</a> <code>postgresql.service</code>, and then re-add each user's password using <code>ALTER USER <i>user</i> WITH ENCRYPTED PASSWORD '<i>password</i>';</code>.
</p>
<h3><span class="mw-headline" id="Configure_PostgreSQL_to_be_accessible_exclusively_through_UNIX_Sockets">Configure PostgreSQL to be accessible exclusively through UNIX Sockets</span></h3>
<p>When <a href="#Initial_configuration">initially creating the cluster</a>, append <code>-c listen_addresses=''</code> to the <i>initdb</i> command.
</p>
<p>For an existing cluster, edit <code>postgresql.conf</code> and in the connections and authentication section set:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/postgresql.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">listen_addresses = ''</pre>
<p>This will disable network listening completely.
After this you should <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>postgresql.service</code> for the changes to take effect.
</p>
<h3><span class="mw-headline" id="Configure_PostgreSQL_to_be_accessible_from_remote_hosts">Configure PostgreSQL to be accessible from remote hosts</span></h3>
<p>In the connections and authentications section, set the <code>listen_addresses</code> line to your needs:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/postgresql.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">listen_addresses = 'localhost,<i>my_local_ip_address'</i></pre>
<p>You can use <code>'*'</code> to listen on all available addresses.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> PostgreSQL uses TCP port <code>5432</code> by default for remote connections. Make sure this port is open in your <a href="../en/Category:Firewalls.html" class="mw-redirect" title="Firewall">firewall</a> and able to receive incoming connections. You can also change it in the configuration file, right below <code>listen_addresses</code>
</div>
<p>Then add a line like the following to the authentication config:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/pg_hba.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># TYPE  DATABASE        USER            ADDRESS                 METHOD
# IPv4 local connections:
host    all             all             <i>ip_address</i>/32   md5</pre>
<p>where <code><i>ip_address</i></code> is the IP address of the remote client.
</p>
<p>See the documentation for <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/auth-pg-hba-conf.html">pg_hba.conf</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Neither sending your plain password nor the md5 hash (used in the example above) over the Internet is secure if it is not done over an SSL-secured connection. See <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/ssl-tcp.html">Secure TCP/IP Connections with SSL</a> for how to configure PostgreSQL with SSL.</div>
<p>After this you should <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>postgresql.service</code> for the changes to take effect.
</p>
<p>For troubleshooting take a look in the server log file:
</p>
<pre># journalctl -u postgresql.service
</pre>
<h3><span class="mw-headline" id="Configure_PostgreSQL_authenticate_against_PAM">Configure PostgreSQL authenticate against PAM</span></h3>
<p>PostgreSQL offers a number of authentication methods. If you would like to allow users to authenticate with their system password, additional steps are necessary. First you need to enable <a href="../en/PAM.html" title="PAM">PAM</a> for the connection.
</p>
<p>For example, the same configuration as above, but with PAM enabled:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/pg_hba.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># IPv4 local connections:
host   all   all   <i>my_remote_client_ip_address</i>/32   pam</pre>
<p>The PostgreSQL server is however running without root privileges and will not be able to access <code>/etc/shadow</code>. We can work around that by allowing the postgres group to access this file:
</p>
<pre># setfacl -m g:postgres:r /etc/shadow
</pre>
<h3><span class="mw-headline" id="Change_default_data_directory">Change default data directory</span></h3>
<p>The default directory where all your newly created databases will be stored is <code>/var/lib/postgres/data</code>. To change this, follow these steps:
</p>
<p>Create the new directory and make the postgres user its owner:
</p>
<pre># mkdir -p /pathto/pgroot/data
# chown -R postgres:postgres /pathto/pgroot
</pre>
<p>Become the postgres user, and initialize the new cluster:
</p>
<pre>[postgres]$ initdb -D /pathto/pgroot/data
</pre>
<p><a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">Edit</a> <code>postgresql.service</code> to create a <a href="../en/Systemd.html#Drop-in_files" class="mw-redirect" title="Drop-in file">drop-in file</a> and override the <code>Environment</code> and <code>PIDFile</code> settings. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/postgresql.service.d/PGROOT.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
Environment=PGROOT=<i>/pathto/pgroot</i>
PIDFile=<i>/pathto/pgroot/</i>data/postmaster.pid</pre>
<p>If you want to use <code>/home</code> directory for default directory or for tablespaces, add one more line in this file:
</p>
<pre>ProtectHome=false
</pre>
<h3><span class="mw-headline" id="Change_default_encoding_of_new_databases_to_UTF-8">Change default encoding of new databases to UTF-8</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you ran <code>initdb</code> with <code>-E UTF8</code> or while using an UTF-8 locale, these steps are not required.</div>
<p>When creating a new database (e.g. with <code>createdb blog</code>) PostgreSQL actually copies a template database. There are two predefined templates: <code>template0</code> is vanilla, while <code>template1</code> is meant as an on-site template changeable by the administrator and is used by default. In order to change the encoding of a new database, one of the options is to change on-site <code>template1</code>. To do this, log into PostgreSQL shell (<code>psql</code>) and execute the following:
</p>
<p>First, we need to drop <code>template1</code>. Templates cannot be dropped, so we first modify it so it is an ordinary database:
</p>
<pre>UPDATE pg_database SET datistemplate = FALSE WHERE datname = 'template1';
</pre>
<p>Now we can drop it:
</p>
<pre>DROP DATABASE template1;
</pre>
<p>The next step is to create a new database from <code>template0</code>, with a new default encoding:
</p>
<pre>CREATE DATABASE template1 WITH TEMPLATE = template0 ENCODING = 'UNICODE';
</pre>
<p>Now modify <code>template1</code> so it is actually a template:
</p>
<pre>UPDATE pg_database SET datistemplate = TRUE WHERE datname = 'template1';
</pre>
<p>Optionally, if you do not want anyone connecting to this template, set <code>datallowconn</code> to <code>FALSE</code>:
</p>
<pre>UPDATE pg_database SET datallowconn = FALSE WHERE datname = 'template1';
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This last step can create problems when upgrading via <code>pg_upgrade</code>.</div>
<p>Now you can create a new database:
</p>
<pre>[postgres]$ createdb blog
</pre>
<p>If you log back in to <code>psql</code> and check the databases, you should see the proper encoding of your new database:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">\l</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">                              List of databases
  Name    |  Owner   | Encoding  | Collation | Ctype |   Access privileges
-----------+----------+-----------+-----------+-------+----------------------
blog      | postgres | UTF8      | C         | C     |
postgres  | postgres | SQL_ASCII | C         | C     |
template0 | postgres | SQL_ASCII | C         | C     | =c/postgres
                                                     : postgres=CTc/postgres
template1 | postgres | UTF8      | C         | C     |
</pre>
<h3><span class="mw-headline" id="Enable_data_checksumming">Enable data checksumming</span></h3>
<p>If your database files reside on a file system without checksumming, its data is suspectible to silent data corruption due to bit rot and broken hardware. While those events are rare, you might want to enable <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/checksums.html">PostgreSQL's built-in data checksumming</a> if you care about data integrity. This feature must be enabled on the cluster level, not per-database or per-table.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This feature has a number of caveats:
<ul>
<li>There is a <a rel="nofollow" class="external text" href="https://web.archive.org/web/20170218093959/https://blog.endpoint.com/2015/12/postgres-checksum-performance-impact.html">minimal performance impact</a>, especially while reading large datasets from disk. In-memory operations are not affected.</li>
<li>PostgreSQL is unable to repair corrupt data - it will only abort transactions reading from corrupt pages to prevent further damage or invalid execution results.</li>
<li>Checksums cover on-disk data (row) pages only, not metadata or control structures. In-memory pages are not checksummed. Error-corrected storage and ECC memory is still beneficial.</li>
</ul>
</div>
<ul>
<li>To enable checksumming during cluster creation, add the <code>--data-checksums</code> argument to <code>initdb</code>.</li>
<li>To verify whenever checksumming is enabled, run <code>[postgres]$ psql --tuples-only -c "SHOW data_checksums"</code> (which should print <code>off</code> or <code>on</code>).</li>
<li>To toggle checksumming on an existing cluster:</li>
</ul>
<ol>
<li>
<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Stop">Stop</a> <code>postgresql.service</code>.</li>
<li>Run <code>[postgres]$ pg_checksums --pgdata /var/lib/postgres/data --enable</code> (or <code>--disable</code> if you no longer want checksumming). Enabling checksums will rewrite all database pages, which will take a while for large database instances.</li>
<li>
<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> <code>postgresql.service</code>.</li>
</ol>
<h2><span class="mw-headline" id="Graphical_tools">Graphical tools</span></h2>
<ul><li>
<b><a href="../en/PhpPgAdmin.html" title="PhpPgAdmin">phpPgAdmin</a></b> — Web-based administration tool for PostgreSQL.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/phppgadmin/phppgadmin">https://github.com/phppgadmin/phppgadmin</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/phppgadmin/">phppgadmin</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>pgAdmin</b> — Comprehensive design and management GUI for PostgreSQL.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://www.pgadmin.org/">https://www.pgadmin.org/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pgadmin3/">pgadmin3</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">broken link</a>: package not found]</sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pgadmin4">pgadmin4</a></span><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">broken link</a>: package not found]</sup>
</dd></dl>
<ul><li>
<b>pgModeler</b> — Graphical schema designer for PostgreSQL.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://pgmodeler.io/">https://pgmodeler.io/</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pgmodeler/">pgmodeler</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>Postbird</b> — Cross-platform PostgreSQL GUI client, written in JavaScript, runs with Electron.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/paxa/postbird">https://github.com/paxa/postbird</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/postbird-bin/">postbird-bin</a></span><sup><small>AUR</small></sup>
</dd></dl>
<p>For tools supporting multiple DBMSs, see <a href="../en/List_of_applications/Documents.html#Database_tools" title="List of applications/Documents">List of applications/Documents#Database tools</a>.
</p>
<h2><span class="mw-headline" id="Set_up_backups">Set up backups</span></h2>
<p>It is recommended to set up backups for databases containing valuable data. See the <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/backup.html">Backup and Restore</a> chapter in the PostgreSQL documentation. There is also a <a rel="nofollow" class="external text" href="https://wiki.postgresql.org/wiki/Ecosystem:Backup">list of backup tools</a> in the PostgreSQL wiki, though it may not be up-to-date or complete. Remember that a backup system cannot be trusted unless you perform a test restore from time to time!
</p>
<h2><span class="mw-headline" id="Upgrading_PostgreSQL">Upgrading PostgreSQL</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> How to upgrade when using third party extensions? (Discuss in <a href="../en/Talk:PostgreSQL.html#pg_upgrade_problem_if_extensions_(like_postgis)_are_used" title="Talk:PostgreSQL">Talk:PostgreSQL#pg_upgrade problem if extensions (like postgis) are used</a>)</div>
</div>
<p>Upgrading major PostgreSQL versions (e.g. version 14.x to version 15.y) requires some extra maintenance.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Official PostgreSQL <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/upgrading.html">upgrade documentation</a> should be followed.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The following instructions could cause data loss. Do not run the commands below blindly, without understanding what they do. <a href="#Set_up_backups">Make a backup</a> first.</div>
<p>Get the currently used database version via
</p>
<pre># cat /var/lib/postgres/data/PG_VERSION
</pre>
<p>To ensure you do not accidentally upgrade the database to an incompatible version, it is recommended to <a href="../en/Pacman.html#Skip_package_from_being_upgraded" title="Pacman">skip updates</a> to the PostgreSQL packages.
</p>
<p>Minor version upgrades are safe to perform. However, if you do an accidental upgrade to a different major version, you might not be able to access any of your data. Always check the <a rel="nofollow" class="external text" href="https://www.postgresql.org/">PostgreSQL home page</a> to be sure of what steps are required for each upgrade. For a bit about why this is the case, see the <a rel="nofollow" class="external text" href="https://www.postgresql.org/support/versioning">versioning policy</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you use extensions check <a href="#PostgreSQL_database_unable_to_start_after_package_update_when_using_extensions">#PostgreSQL database unable to start after package update when using extensions</a> and <a href="#Failing_to_start_a_PostgreSQL_server_with_the_older_version_of_the_database_while_upgrading_to_the_newer_version_with_extensions">#Failing to start a PostgreSQL server with the older version of the database while upgrading to the newer version with extensions</a>.</div>
<p>There are two main ways to upgrade your PostgreSQL database. Read the official documentation for details.
</p>
<h3><span class="mw-headline" id="pg_upgrade">pg_upgrade</span></h3>
<p>The <code>pg_upgrade</code> utility attempts to copy over as much compatible data as possible between clusters and upgrading everything else. It is generally the fastest method to upgrade most instances, although it requires access to binaries for both source and target PostgreSQL versions. Read the <span class="plainlinks archwiki-template-man" title="$ man 1 pg_upgrade"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pg_upgrade.1">pg_upgrade(1)</a></span> man page to understand what actions it performs. For non-trivial instances (e.g. with streaming replication or log-shipping), <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/pgupgrade.html">read the upstream documentation first</a>.
</p>
<p>For those wishing to use <code>pg_upgrade</code>, a <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql-old-upgrade">postgresql-old-upgrade</a></span> package is available that will always run one major version behind the real PostgreSQL package. This can be installed side-by-side with the new version of PostgreSQL. To upgrade from older versions of PostgreSQL there are AUR packages available, e.g. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/postgresql-12-upgrade/">postgresql-12-upgrade</a></span><sup><small>AUR</small></sup>. (You must use the <code>pg_upgrade</code> version packaged with the PostgreSQL version you are upgrading to.)
</p>
<p>Note that the database cluster directory does not change from version to version, so before running <code>pg_upgrade</code>, it is necessary to rename your existing data directory and migrate into a new directory. The new database cluster must be initialized using the same parameters as the old one.
</p>
<p>When you are ready to begin the upgrade: 
</p>
<ol>
<li>While the old database cluster is still online, collect the <code>initdb</code> arguments used to create it. Refer to <a href="#Initial_configuration">#Initial configuration</a> for more information.</li>
<li>
<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Stop">Stop</a> <code>postgresql.service</code>. Check the <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Unit status">unit status</a> to <b>be sure that PostgresSQL was stopped correctly</b>. If it failed, <code>pg_upgrade</code> will fail too.</li>
<li>
<a href="../en/System_maintenance.html#Upgrading_the_system" class="mw-redirect" title="Upgrade">Upgrade</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql">postgresql</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql-libs">postgresql-libs</a></span>, and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql-old-upgrade">postgresql-old-upgrade</a></span>.</li>
<li>Make sure that <code>/var/lib/postgres/olddata</code> does not exist. If you did not delete it after a previous upgrade, do it now.</li>
<li>Rename the old cluster directory, then create a new cluster and temporary working directory: <pre># mv /var/lib/postgres/data /var/lib/postgres/olddata
# mkdir /var/lib/postgres/data /var/lib/postgres/tmp
# chown postgres:postgres /var/lib/postgres/data /var/lib/postgres/tmp
[postgres]$ cd /var/lib/postgres/tmp
</pre>
</li>
<li>Initialize the new cluster using the same <code>initdb</code> arguments as were used for the old cluster: <pre>[postgres]$ initdb -D /var/lib/postgres/data --locale=C.UTF-8 --encoding=UTF8 --data-checksums</pre>
</li>
<li>Upgrade the cluster, replacing <code><i>PG_VERSION</i></code> below, with the old PostgreSQL version number (e.g. <code>15</code>): <pre>[postgres]$ pg_upgrade -b /opt/pgsql-<i>PG_VERSION</i>/bin -B /usr/bin -d /var/lib/postgres/olddata -D /var/lib/postgres/data</pre> If necessary, adjust the configuration files of new cluster (e.g. <code>pg_hba.conf</code> and <code>postgresql.conf</code>) to match the old cluster.</li>
<li>
<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> <code>postgresql.service</code> again.</li>
<li>
<b>Optional:</b> Run <code>[postgres]$ vacuumdb --all --analyze-in-stages</code> to recalculate query analyzer statistics, which <a rel="nofollow" class="external text" href="https://www.cybertec-postgresql.com/en/postgresql-analyze-and-optimizer-statistics/">should improve query performance</a> shortly after the upgrade. (Adding <code>--jobs=<i>NUMBER_OF_CPU_CORES</i></code> argument may improve this command's performance.)</li>
<li>
<b>Optional:</b> Back up the <code>/var/lib/postgres/olddata</code> directory in case you need to restore a previous PostgreSQL version.</li>
<li>Delete the <code>/var/lib/postgres/olddata</code> directory with old cluster data.</li>
<li>Delete the <code>/var/lib/postgres/tmp</code> directory.</li>
<li>If you use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pgbackrest/">pgbackrest</a></span><sup><small>AUR</small></sup>, run the <a rel="nofollow" class="external text" href="https://pgbackrest.org/command.html#command-stanza-upgrade">stanza-upgrade</a> command.</li>
</ol>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-cut.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is being considered for removal.</b></p>
<div>
<b>Reason:</b> This is a useless hand-holding note, the necessary procedure is clearly covered by step 2 above. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:PostgreSQL.html">Talk:PostgreSQL</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If <code>pg_upgrade</code> in step 6 fails with <code>The source cluster was not shut down cleanly</code>, PostgreSQL was not stopped before attempting the upgrade. Stop it, then restart the cluster with old database binaries to recover old cluster files:
<pre>[postgres]$ /opt/pgsql-<i>PG_VERSION</i>/bin/pg_ctl start -D /var/lib/postgres/olddata &amp;&amp; /opt/pgsql-<i>PG_VERSION</i>/bin/pg_ctl stop -D /var/lib/postgres/olddata
</pre>
You can now safely retry the <code>pg_upgrade</code> command. If the upgrade process still fails, shut down any database processes, <a href="../en/Downgrading_packages.html" class="mw-redirect" title="Downgrade">downgrade</a> PostgreSQL packages to their previous versions, recover your previous cluster data from backups and restart the upgrade process.</div>
<h3><span class="mw-headline" id="Manual_dump_and_reload">Manual dump and reload</span></h3>
<p>You could also do something like this (after the upgrade and install of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql-old-upgrade">postgresql-old-upgrade</a></span>).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Below are the commands for upgrading from PostgreSQL 14. You can find similar commands in <code>/opt/</code> for your version of PostgreSQL cluster, provided you have matching version of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql-old-upgrade">postgresql-old-upgrade</a></span> package installed.</li>
<li>If you had customized your <code>pg_hba.conf</code> file, you may have to temporarily modify it to allow full access to old database cluster from local system. After upgrade is complete set your customization to new database cluster as well and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>postgresql.service</code>.</li>
</ul>
</div>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Stop">Stop</a> <code>postgresql.service</code>
</p>
<pre># mv /var/lib/postgres/data /var/lib/postgres/olddata
# mkdir /var/lib/postgres/data
# chown postgres:postgres /var/lib/postgres/data
[postgres]$ initdb -D /var/lib/postgres/data --locale=C.UTF-8 --encoding=UTF8 --data-checksums
[postgres]$ /opt/pgsql-14/bin/pg_ctl -D /var/lib/postgres/olddata/ start
# cp /usr/lib/postgresql/postgis-3.so /opt/pgsql-14/lib/ # Only if postgis installed
[postgres]$ pg_dumpall -h /tmp -f /tmp/old_backup.sql
[postgres]$ /opt/pgsql-14/bin/pg_ctl -D /var/lib/postgres/olddata/ stop
</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> <code>postgresql.service</code>
</p>
<pre>[postgres]$ psql -f /tmp/old_backup.sql postgres
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Improve_performance_of_small_transactions">Improve performance of small transactions</span></h3>
<p>If you are using PostgresSQL on a local machine for development and it seems slow, you could try turning <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/runtime-config-wal.html#GUC-SYNCHRONOUS-COMMIT">synchronous_commit off</a> in the configuration. Beware of the <a rel="nofollow" class="external text" href="https://www.postgresql.org/docs/current/static/runtime-config-wal.html#GUC-SYNCHRONOUS-COMMIT">caveats</a>, however.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/postgresql.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">synchronous_commit = off</pre>
<h3><span class="mw-headline" id="PostgreSQL_database_unable_to_start_after_package_update_when_using_extensions">PostgreSQL database unable to start after package update when using extensions</span></h3>
<p>The cause in this case is mostly the existing package is not compiled for the newer version (and it may be up-to-date), the solution is <a href="../en/Arch_build_system.html" title="Arch build system">rebuilding</a> the package either manually or waiting for an update to the extension package.
</p>
<h3><span class="mw-headline" id="Failing_to_start_a_PostgreSQL_server_with_the_older_version_of_the_database_while_upgrading_to_the_newer_version_with_extensions">Failing to start a PostgreSQL server with the older version of the database while upgrading to the newer version with extensions</span></h3>
<p>This is caused because the old version of postgres from the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql-old-upgrade">postgresql-old-upgrade</a></span> does not have the required extensions (<i>.so</i> files) in its lib directory, the current solution is dirty, and might cause a lot of problems so keep a backup of the database just in case, basically copy the required extension <i>.so</i> files from <code>/usr/lib/postgresql/</code> to <code>/opt/pgsql-<i>XX</i>/lib/</code> (remember to replace XX with the major version of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql-old-upgrade">postgresql-old-upgrade</a></span>).
</p>
<p>For example, for timescaledb
</p>
<pre># cp /usr/lib/postgresql/timescaledb*.so /opt/pgsql-13/lib/
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> while copying the <i>.so</i> files was enough for me, it might be required to copy more files to the correct directories under <code>/opt/pgsql-<i>XX</i>/</code>.</div>
<p>to know the exact files to copy, check the contant of the package of the extension using :
</p>
<pre>$ pacman -Ql <i>package_name</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> This is a very dirty solution that may break or cause data loss in the database, so keep a backup.</div>
<h3>
<span id="WARNING:_database_.22postgres.22_has_a_collation_version_mismatch"></span><span class="mw-headline" id='WARNING:_database_"postgres"_has_a_collation_version_mismatch'>WARNING:  database "postgres" has a collation version mismatch</span>
</h3>
<p>You might see something like this:
</p>
<pre>WARNING:  database "postgres" has a collation version mismatch
DETAIL:  The database was created using collation version X.YY, but the operating system provides version X.ZZ.
HINT:  Rebuild all objects in this database that use the default collation and run ALTER DATABASE postgres REFRESH COLLATION VERSION, or build PostgreSQL with the right library version.
</pre>
<p>That means collation provider library was updated (eg. <i>glibc</i>) which might have made some indexes invalid. So that means need to reindex those databases.
</p>
<p>You can do that with:
</p>
<pre># psql -c 'REINDEX DATABASE' postgres
# psql -c 'ALTER DATABASE postgres REFRESH COLLATION VERSION'
</pre>
<p>Repeat this above for all other databases by replacing <i>postgres</i> with respective DB name.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Relational_DBMSs.html" title="Category:Relational DBMSs">Relational DBMSs</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
<li><a href="../en/Category:Sections_flagged_with_Template:Remove.html" title="Category:Sections flagged with Template:Remove">Sections flagged with Template:Remove</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=PostgreSQL&amp;oldid=802128">https://wiki.archlinux.org/index.php?title=PostgreSQL&amp;oldid=802128</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 3 March 2024, at 12:12.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
