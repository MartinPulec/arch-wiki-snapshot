<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>makepkg - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Makepkg rootpage-Makepkg skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Configuration</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-Packager_information" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Packager_information">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Packager information</div>
			</a>
			
			<ul id="toc-Packager_information-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Package_output" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Package_output">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Package output</div>
			</a>
			
			<ul id="toc-Package_output-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Signature_checking" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Signature_checking">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Signature checking</div>
			</a>
			
			<ul id="toc-Signature_checking-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Usage" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Usage">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Usage</div>
		</a>
		
		<ul id="toc-Usage-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Optimization" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Optimization">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Optimization</div>
		</a>
		
			<button aria-controls="toc-Optimization-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Optimization subsection</span>
			</button>
		
		<ul id="toc-Optimization-sublist" class="vector-toc-list">
			<li id="toc-Building_optimized_binaries" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Building_optimized_binaries">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Building optimized binaries</div>
			</a>
			
			<ul id="toc-Building_optimized_binaries-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Improving_build_times" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Improving_build_times">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Improving build times</div>
			</a>
			
			<ul id="toc-Improving_build_times-sublist" class="vector-toc-list">
				<li id="toc-Parallel_compilation" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Parallel_compilation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.1</span>Parallel compilation</div>
			</a>
			
			<ul id="toc-Parallel_compilation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Building_from_files_in_memory" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Building_from_files_in_memory">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.2</span>Building from files in memory</div>
			</a>
			
			<ul id="toc-Building_from_files_in_memory-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_a_compilation_cache" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Using_a_compilation_cache">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.3</span>Using a compilation cache</div>
			</a>
			
			<ul id="toc-Using_a_compilation_cache-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_mold_linker" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Using_mold_linker">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.4</span>Using mold linker</div>
			</a>
			
			<ul id="toc-Using_mold_linker-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Disable_debug_packages_and_LTO" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Disable_debug_packages_and_LTO">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.5</span>Disable debug packages and LTO</div>
			</a>
			
			<ul id="toc-Disable_debug_packages_and_LTO-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Compression" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Compression">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Compression</div>
			</a>
			
			<ul id="toc-Compression-sublist" class="vector-toc-list">
				<li id="toc-Use_other_compression_algorithms" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Use_other_compression_algorithms">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.1</span>Use other compression algorithms</div>
			</a>
			
			<ul id="toc-Use_other_compression_algorithms-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Utilizing_multiple_cores_on_compression" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Utilizing_multiple_cores_on_compression">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.2</span>Utilizing multiple cores on compression</div>
			</a>
			
			<ul id="toc-Utilizing_multiple_cores_on_compression-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Changing_compression_level" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Changing_compression_level">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.3</span>Changing compression level</div>
			</a>
			
			<ul id="toc-Changing_compression_level-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Tips and tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Reduce_source_download_and_extraction_times" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Reduce_source_download_and_extraction_times">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Reduce source download and extraction times</div>
			</a>
			
			<ul id="toc-Reduce_source_download_and_extraction_times-sublist" class="vector-toc-list">
				<li id="toc-Defining_the_sources_location" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Defining_the_sources_location">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.1</span>Defining the sources location</div>
			</a>
			
			<ul id="toc-Defining_the_sources_location-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Generate_new_checksums" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Generate_new_checksums">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Generate new checksums</div>
			</a>
			
			<ul id="toc-Generate_new_checksums-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Build_from_local_source_files" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Build_from_local_source_files">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Build from local source files</div>
			</a>
			
			<ul id="toc-Build_from_local_source_files-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Show_packages_with_specific_packager" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Show_packages_with_specific_packager">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>Show packages with specific packager</div>
			</a>
			
			<ul id="toc-Show_packages_with_specific_packager-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Build_32-bit_packages_on_a_64-bit_system" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Build_32-bit_packages_on_a_64-bit_system">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.5</span>Build 32-bit packages on a 64-bit system</div>
			</a>
			
			<ul id="toc-Build_32-bit_packages_on_a_64-bit_system-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Unattended_package_signing" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Unattended_package_signing">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.6</span>Unattended package signing</div>
			</a>
			
			<ul id="toc-Unattended_package_signing-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Magnet_URIs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Magnet_URIs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.7</span>Magnet URIs</div>
			</a>
			
			<ul id="toc-Magnet_URIs-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Running_makepkg_in_a_systemd_control_group" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Running_makepkg_in_a_systemd_control_group">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.8</span>Running makepkg in a systemd control group</div>
			</a>
			
			<ul id="toc-Running_makepkg_in_a_systemd_control_group-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Running_with_idle_scheduling_policy" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Running_with_idle_scheduling_policy">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.9</span>Running with idle scheduling policy</div>
			</a>
			
			<ul id="toc-Running_with_idle_scheduling_policy-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Relative_paths_inside_each_package_directory" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Relative_paths_inside_each_package_directory">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.10</span>Relative paths inside each package directory</div>
			</a>
			
			<ul id="toc-Relative_paths_inside_each_package_directory-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Specifying_install_directory_for_QMAKE_based_packages" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Specifying_install_directory_for_QMAKE_based_packages">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Specifying install directory for QMAKE based packages</div>
			</a>
			
			<ul id="toc-Specifying_install_directory_for_QMAKE_based_packages-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-WARNING:_Package_contains_reference_to_$srcdir" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#WARNING:_Package_contains_reference_to_$srcdir">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>WARNING: Package contains reference to $srcdir</div>
			</a>
			
			<ul id="toc-WARNING:_Package_contains_reference_to_$srcdir-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Makepkg_fails_to_download_dependencies_when_behind_proxy" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Makepkg_fails_to_download_dependencies_when_behind_proxy">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Makepkg fails to download dependencies when behind proxy</div>
			</a>
			
			<ul id="toc-Makepkg_fails_to_download_dependencies_when_behind_proxy-sublist" class="vector-toc-list">
				<li id="toc-Enable_proxy_by_setting_its_URL_in_XferCommand" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Enable_proxy_by_setting_its_URL_in_XferCommand">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.1</span>Enable proxy by setting its URL in XferCommand</div>
			</a>
			
			<ul id="toc-Enable_proxy_by_setting_its_URL_in_XferCommand-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enable_proxy_via_sudoer's_env_keep" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Enable_proxy_via_sudoer's_env_keep">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.2</span>Enable proxy via sudoer's env_keep</div>
			</a>
			
			<ul id="toc-Enable_proxy_via_sudoer's_env_keep-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Makepkg_fails,_but_make_succeeds" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Makepkg_fails,_but_make_succeeds">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>Makepkg fails, but make succeeds</div>
			</a>
			
			<ul id="toc-Makepkg_fails,_but_make_succeeds-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">makepkg</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 6 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-6" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">6 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/Makepkg.html" title="Makepkg – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-fr mw-list-item"><a href="../fr/Makepkg.html" title="Makepkg – français" lang="fr" hreflang="fr" class="interlanguage-link-target"><span>Français</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Makepkg" title="Makepkg – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/Makepkg.html" title="Makepkg – português" lang="pt" hreflang="pt" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Makepkg.html" title="Makepkg – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Makepkg" title="Makepkg – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Arch_build_system.html" title="Arch build system">Arch build system</a></li>
<li><a href="../en/Arch_User_Repository.html" title="Arch User Repository">Arch User Repository</a></li>
<li><a href="../en/Creating_packages.html" title="Creating packages">Creating packages</a></li>
<li><a href="../en/GnuPG.html" title="GnuPG">GnuPG</a></li>
<li><a href="../en/Official_repositories.html" title="Official repositories">Official repositories</a></li>
<li><a href="../en/OpenPGP.html" title="OpenPGP">OpenPGP</a></li>
<li><a href="../en/Pacman.html" title="Pacman">pacman</a></li>
<li><a href="../en/.SRCINFO.html" title=".SRCINFO">.SRCINFO</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/pacman/pacman/blob/master/scripts/makepkg.sh.in">makepkg</a> is a script to automate the building of packages. The requirements for using the script are a build-capable <a href="https://en.wikipedia.org/wiki/Unix" class="extiw" title="wikipedia:Unix">Unix</a> platform and a <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILD</a>.
</p>
<p><i>makepkg</i> is provided by the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman">pacman</a></span> package.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>The system configuration is available in <code>/etc/makepkg.conf</code>, but user-specific changes can be made in <code>$XDG_CONFIG_HOME/pacman/makepkg.conf</code> or <code>~/.makepkg.conf</code>. Also, system wide changes can be made with a drop-in file <code>/etc/makepkg.conf.d/makepkg.conf</code>. It is recommended to review the configuration prior to building packages.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=devtools">devtools</a></span> helper scripts for <a href="../DeveloperWiki:Building_in_a_clean_chroot.html" title="DeveloperWiki:Building in a clean chroot">building packages in a clean chroot</a> use the <code>/usr/share/devtools/makepkg.conf.d/<i>arch</i>.conf</code> configuration file instead.</div>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 5 makepkg.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.conf.5">makepkg.conf(5)</a></span> for more information.
</p>
<h3><span class="mw-headline" id="Packager_information">Packager information</span></h3>
<p>Each package is tagged with metadata identifying amongst others also the <i>packager</i>. By default, user-compiled packages are marked with <code>Unknown Packager</code>. If multiple users will be compiling packages on a system, or if one is otherwise distributing packages to other users, it is convenient to provide real contact. This can be done by setting the <code>PACKAGER</code> variable in <code>makepkg.conf</code>.
</p>
<p>To check this on an installed package:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ pacman -Qi <i>package</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Packager       : John Doe &lt;john@doe.com&gt;
...
</pre>
<p>To automatically produce signed packages, also set the <code>GPGKEY</code> variable in <code>makepkg.conf</code>.
</p>
<h3><span class="mw-headline" id="Package_output">Package output</span></h3>
<p>By default, <i>makepkg</i> creates the package tarballs in the working directory and downloads source data directly to the <code>src/</code> directory. Custom paths can be configured, for example to keep all built packages in <code>~/build/packages/</code> and all sources in <code>~/build/sources/</code>.
</p>
<p>Configure the following <code>makepkg.conf</code> variables if needed:
</p>
<ul>
<li>
<code>PKGDEST</code> — directory for storing resulting packages</li>
<li>
<code>SRCDEST</code> — directory for storing <a href="../en/PKGBUILD.html#source" title="PKGBUILD">source</a> data (symbolic links will be placed to <code>src/</code> if it points elsewhere)</li>
<li>
<code>SRCPKGDEST</code> — directory for storing resulting source packages (built with <code>makepkg -S</code>)</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The <code>PKGDEST</code> directory can be cleaned up with e.g. <code>paccache -c ~/build/packages/</code> as described in <a href="../en/Pacman.html#Cleaning_the_package_cache" title="Pacman">pacman#Cleaning the package cache</a>.</div>
<p>You can also use <a href="#Relative_paths_inside_each_package_directory">relative paths inside each package directory</a>.
</p>
<h3><span class="mw-headline" id="Signature_checking">Signature checking</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The signature checking implemented in <i>makepkg</i> does not use pacman's keyring, instead relying on the user's keyring.<a rel="nofollow" class="external autonumber" href="http://allanmcrae.com/2015/01/two-pgp-keyrings-for-package-management-in-arch-linux/">[1]</a>
</div>
<p>If a signature file in the form of <i>.sig</i> or <i>.asc</i> is part of the <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILD</a> source array, <i>makepkg</i> automatically attempts to <a href="../en/GnuPG.html#Verify_a_signature" title="GnuPG">verify</a> it. In case the user's keyring does not contain the needed public key for signature verification, <i>makepkg</i> will abort the installation with a message that the PGP key could not be verified. 
</p>
<p>If a needed public key for a package is missing, the <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILD</a> will most likely contain a <a href="../en/PKGBUILD.html#validpgpkeys" title="PKGBUILD">validpgpkeys</a> entry with the required key IDs. <a href="../en/GnuPG.html#Import_a_public_key" title="GnuPG">Import</a> it manually, or find it <a href="../en/GnuPG.html#Use_a_keyserver" title="GnuPG">on a keyserver</a> and import it from there. To temporarily disable signature checking, run <i>makepkg</i>  with the <code>--skippgpcheck</code> option.
</p>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>Before continuing, <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=base-devel">base-devel</a></span> <a href="../en/Meta_package_and_package_group.html#Difference_between_meta_package_and_package_group" class="mw-redirect" title="Meta package">meta package</a>. Dependencies of this package are <b>not</b> required to be listed as build-time dependencies (<i>makedepends</i>) in <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILD</a> files.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Make sure <a href="../en/Sudo.html" title="Sudo">sudo</a> is configured properly for commands passed to <a href="../en/Pacman.html" title="Pacman">pacman</a>. Alternatively a different authorization command can be specified with <code>PACMAN_AUTH</code> in the <span class="plainlinks archwiki-template-man" title="$ man 5 makepkg.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.conf.5">makepkg.conf(5)</a></span> configuration file.</li>
<li>Running <code>makepkg</code> itself as root is <a rel="nofollow" class="external text" href="https://lists.archlinux.org/archives/list/pacman-dev@lists.archlinux.org/message/ZLRXMUGXULDHLTGSRYVGVWG3BVATV3OY/">disallowed</a>.<a rel="nofollow" class="external autonumber" href="https://gitlab.archlinux.org/pacman/pacman/blob/master/NEWS">[2]</a> Besides how a <code>PKGBUILD</code> may contain arbitrary commands, building as root is generally considered unsafe.<a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=67561">[3]</a> Users who have no access to a regular user account should run <code>makepkg</code> as the <a rel="nofollow" class="external text" href="http://allanmcrae.com/2015/01/replacing-makepkg-asroot/">nobody user</a>, e.g. using the command <code>runuser -u nobody makepkg</code>.</li>
</ul>
</div>
<p>To build a package, one must first create a <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILD</a>, or build script, as described in <a href="../en/Creating_packages.html" title="Creating packages">Creating packages</a>. Existing scripts are available from the <a href="../en/Arch_build_system.html" title="Arch build system">Arch build system</a> <i>(ABS)</i> tree or the <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>. Once in possession of a <code>PKGBUILD</code>, change to the directory where it is saved and run the following command to build the package:
</p>
<pre>$ makepkg
</pre>
<p>If required dependencies are missing, <i>makepkg</i> will issue a warning before failing. To build the package and install needed dependencies, add the flag <code>-s</code>/<code>--syncdeps</code>:
</p>
<pre>$ makepkg --syncdeps
</pre>
<p>Adding the <code>-r</code>/<code>--rmdeps</code> flag causes <i>makepkg</i> to remove the make dependencies later, which are no longer needed. If constantly building packages, consider using <a href="../en/Pacman/Tips_and_tricks.html#Removing_unused_packages_(orphans)" title="Pacman/Tips and tricks">Pacman/Tips and tricks#Removing unused packages (orphans)</a> once in a while instead.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>These dependencies must be available in the configured repositories; see <a href="../en/Pacman.html#Repositories_and_mirrors" title="Pacman">pacman#Repositories and mirrors</a> for details. Alternatively, one can manually install dependencies prior to building (<code>pacman -S --asdeps <i>dep1</i> <i>dep2</i></code>).</li>
<li>Only global values are used when installing dependencies, i.e any override done in a split package's packaging function will not be used.</li>
</ul>
</div>
<p>Once all dependencies are satisfied and the package builds successfully, a package file (<code><i>pkgname</i>-<i>pkgver</i>.pkg.tar.zst</code>) will be created in the working directory. To install, use <code>-i</code>/<code>--install</code> (same as <code>pacman -U <i>pkgname</i>-<i>pkgver</i>.pkg.tar.zst</code>):
</p>
<pre>$ makepkg --install
</pre>
<p>To clean up leftover files and directories, such as files extracted to the <code>$srcdir</code>, add the option <code>-c</code>/<code>--clean</code>. This is useful for multiple builds of the same package or updating the package version, while using the same build directory. It prevents obsolete and remnant files from carrying over to the new builds:
</p>
<pre>$ makepkg --clean
</pre>
<p>For more, see <span class="plainlinks archwiki-template-man" title="$ man 8 makepkg"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.8">makepkg(8)</a></span>.
</p>
<h2><span class="mw-headline" id="Optimization">Optimization</span></h2>
<p>The default options match the options <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=devtools">devtools</a></span> uses to build packages for the <a href="../en/Official_repositories.html" title="Official repositories">official repositories</a>.<a rel="nofollow" class="external autonumber" href="https://gitlab.archlinux.org/archlinux/packaging/packages/pacman/-/issues/23#note_173678">[4]</a> As such, end users may realize more or less significant gains by tweaking the following options to match their local environment.
</p>
<h3><span class="mw-headline" id="Building_optimized_binaries">Building optimized binaries</span></h3>
<p>A performance improvement of the packaged software can be achieved by enabling compiler optimizations for the host machine. The downside is that binaries compiled for a specific processor architecture will not run correctly on other machines. On x86_64 machines, there are rarely significant enough real world performance gains that would warrant investing the time to rebuild official packages.
</p>
<p>However, it is very easy to reduce performance by using "nonstandard" compiler flags. Many compiler optimizations are only useful in certain situations and should not be indiscriminately applied to every package. Unless benchmark data are available to prove that something is faster, there is a very good chance it is not! The Gentoo <a href="https://wiki.gentoo.org/wiki/GCC_optimization" class="extiw" title="gentoo:GCC optimization">GCC optimization</a> and <a href="https://wiki.gentoo.org/wiki/Safe_CFLAGS" class="extiw" title="gentoo:Safe CFLAGS">Safe CFLAGS</a> wiki articles provide more in-depth information about compiler optimization.
</p>
<p>The options passed to a C/C++ compiler (e.g. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gcc">gcc</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=clang">clang</a></span>) are controlled by the <code>CFLAGS</code>, <code>CXXFLAGS</code>, and <code>CPPFLAGS</code> <a href="../en/Environment_variables.html" title="Environment variables">environment variables</a>. For use in the Arch build system, <i>makepkg</i> exposes these environment variables as configuration options in <code>makepkg.conf</code>. The default values are configured to produce generic binaries that can be installed on a wide range of machines.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Keep in mind that not all build systems use the variables configured in <code>makepkg.conf</code>. For example, <i>cmake</i> disregards the preprocessor options environment variable, <code>CPPFLAGS</code>. Consequently, many <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILDs</a> contain workarounds with options specific to the build system used by the packaged software.</li>
<li>The configuration provided with the source code in the <code>Makefile</code> or a specific argument in the compilation command line takes precedence and can potentially override the one in <code>makepkg.conf</code>.</li>
</ul>
</div>
<p>GCC can automatically detect and enable safe architecture-specific optimizations. To use this feature, first remove any <code>-march</code> and <code>-mtune</code> flags, then add <code>-march=native</code>. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CFLAGS="<b>-march=native</b> -O2 -pipe ..."
CXXFLAGS="${CFLAGS} ..."</pre>
<p>To see what flags this enables, run:
</p>
<pre>$ gcc -march=native -v -Q --help=target
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Specifying different values instead of <code>-march=native</code>, then <code>-Q --help=target</code> <b>will not</b> work as expected.<a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?pid=1616694#p1616694">[5]</a> To find out which options are really enabled, go through a compilation. See <a href="https://wiki.gentoo.org/wiki/Safe_CFLAGS#Manual" class="extiw" title="gentoo:Safe CFLAGS">Gentoo:Safe CFLAGS#Manual</a> for instructions.</div>
<p>Starting in <code>pacman</code> version 5.2.2, <code>makepkg.conf</code> also includes overrides for the <code>RUSTFLAGS</code> environment variable, for flags given to the Rust compiler. The Rust compiler can also detect and enable architecture-specific optimizations by adding <code>-C target-cpu=native</code> to the given <code>RUSTFLAGS</code> value:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf.d/rust.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">RUSTFLAGS="-C opt-level=2 <b>-C target-cpu=native</b>"</pre>
<p>To see which CPU features this will enable, run:
</p>
<pre>$ rustc -C target-cpu=native --print cfg
</pre>
<p>Running <code>--print cfg</code> without <code>-C target-cpu=native</code> will print the default configuration. The <code>opt-level</code> parameter can be changed to <code>3</code>, <code>s</code>, or <code>z</code> as desired. See <a rel="nofollow" class="external text" href="https://doc.rust-lang.org/rustc/codegen-options/index.html#opt-level">The Rust compiler's documentation</a> for details.
</p>
<h3><span class="mw-headline" id="Improving_build_times">Improving build times</span></h3>
<h4><span class="mw-headline" id="Parallel_compilation">Parallel compilation</span></h4>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=make">make</a></span> build system uses the <code>MAKEFLAGS</code> environment variable to specify additional options for <i>make</i>. The variable can also be set in the <code>makepkg.conf</code> file.
</p>
<p>Users with multi-core/multi-processor systems can specify the number of jobs to run simultaneously. This can be accomplished with the use of <span class="plainlinks archwiki-template-man" title="$ man 1 nproc"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nproc.1">nproc(1)</a></span> to determine the number of available processors, e.g. <code>MAKEFLAGS="--jobs=$(nproc)"</code>.
</p>
<p>Some <code>PKGBUILD</code>s specifically override this with <code>-j1</code>, because of race conditions in certain versions or simply because it is not supported in the first place. Packages that fail to build because of this should be <a href="../en/Bug_reporting_guidelines.html" class="mw-redirect" title="Reporting bug guidelines">reported</a> on the bug tracker (or in the case of <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a> packages, to the package maintainer) after making sure that the error is indeed being caused by <code>MAKEFLAGS</code>.
</p>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 1 make"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/make.1">make(1)</a></span> for a complete list of available options.
</p>
<h4><span class="mw-headline" id="Building_from_files_in_memory">Building from files in memory</span></h4>
<p>As compiling requires many I/O operations and handling of small files, moving the working directory to a <a href="../en/Tmpfs.html" title="Tmpfs">tmpfs</a> may bring improvements in build times. 
</p>
<p>The <code>BUILDDIR</code> variable can be temporarily exported to <i>makepkg</i> to set the build directory to an existing tmpfs. For example:
</p>
<pre>$ BUILDDIR=/tmp/makepkg makepkg
</pre>
<p>Persistent configuration can be done in <code>makepkg.conf</code> by uncommenting the <code>BUILDDIR</code> option, which is found at the end of the <code>BUILD ENVIRONMENT</code> section in the default <code>/etc/makepkg.conf</code> file. Setting its value to e.g. <code>BUILDDIR=/tmp/makepkg</code> will make use of the Arch's default <code>/tmp</code> temporary file system.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Avoid compiling larger packages in tmpfs to prevent running out of memory.</li>
<li>The tmpfs directory must be mounted without the <code>noexec</code> option, otherwise it will prevent built binaries from being executed.</li>
<li>Keep in mind that packages compiled in tmpfs will not persist across reboot. Consider setting the <a href="#Package_output">PKGDEST</a> option appropriately to move the built package automatically to a persistent directory.</li>
</ul>
</div>
<h4><span class="mw-headline" id="Using_a_compilation_cache">Using a compilation cache</span></h4>
<p>The use of <a href="../en/Ccache.html" title="Ccache">ccache</a> can improve build times by caching the results of compilations for successive use.
</p>
<h4><span class="mw-headline" id="Using_mold_linker">Using mold linker</span></h4>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mold">mold</a></span> is a drop-in replacement for <a href="../en/GNU_Compiler_Collection.html" class="mw-redirect" title="GCC">ld</a>/<a href="../en/LLVM.html" title="LLVM">lld</a> linkers, which claims to be significantly faster.
</p>
<p>To use <i>mold</i>, append <code>-fuse-ld=mold</code> to <code>LDFLAGS</code>. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">LDFLAGS="... -fuse-ld=mold"</pre>
<p>To pass extra options to <i>mold</i>, additionally add those to <code>LDFLAGS</code>. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">LDFLAGS="... -fuse-ld=mold -Wl,--separate-debug-file"</pre>
<p>To use <i>mold</i> for Rust packages, append <code>-C link-arg=-fuse-ld=mold</code> to <code>RUSTFLAGS</code>. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf.d/rust.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">RUSTFLAGS="... -C link-arg=-fuse-ld=mold"</pre>
<h4><span class="mw-headline" id="Disable_debug_packages_and_LTO">Disable debug packages and LTO</span></h4>
<p><a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/packaging/packages/pacman/-/commit/90bf367e61b4f77f8351d0412be3d0c4ddadb85a">Commit 90bf367e</a> included in <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/packaging/packages/pacman/-/blob/6.0.2-9/makepkg.conf?ref_type=tags">pacman 6.0.2-9 from Feburary 2024</a> enabled the <code>debug</code> and <code>lto</code> options by default. 
</p>
<p>Building debug packages enables the official repositories to provide more tools to troubleshoot issues for users (<a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/packaging/packages/pacman/-/issues/23#note_173528">archlinux/packaging/packages/pacman#23#note_173528</a>), but it is not required when building packages on your own and slows down the build process. See <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/packaging/packages/pacman/-/issues/23#note_173782">archlinux/packaging/packages/pacman#23#note_173782</a>.
</p>
<p><a href="https://en.wikipedia.org/wiki/Link-time_optimization" class="extiw" title="wikipedia:Link-time optimization">Link-time optimization</a> produces more optimized binaries but greatly lengthens the build process (<a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/packaging/packages/pacman/-/issues/23#note_173678">archlinux/packaging/packages/pacman#23#note_173678</a>), which might not be a desired tradeoff.
</p>
<p>To disable those options, add a <code>!</code> character directly in front of them in the <code>OPTIONS=()</code> array, <i>e.g.</i> <code>OPTIONS=(...!debug !lto...)</code>.
</p>
<h3><span class="mw-headline" id="Compression">Compression</span></h3>
<h4><span class="mw-headline" id="Use_other_compression_algorithms">Use other compression algorithms</span></h4>
<p>To speed up both packaging and installation, with the tradeoff of having larger package archives, change <code>PKGEXT</code>.
</p>
<p>For example, the following skips compression of the package file, which will in turn have no need to be decompressed on <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a>:
</p>
<pre>$ PKGEXT='.pkg.tar' makepkg
</pre>
<p>As another example, the following uses the LZ4 algorithm, which is focused on speed:
</p>
<pre>$ PKGEXT='.pkg.tar.lz4' makepkg
</pre>
<p>To make one of these settings permanent, set <code>PKGEXT</code> in <code>/etc/makepkg.conf</code>.
</p>
<h4><span class="mw-headline" id="Utilizing_multiple_cores_on_compression">Utilizing multiple cores on compression</span></h4>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=zstd">zstd</a></span> supports <a href="https://en.wikipedia.org/wiki/Symmetric_multiprocessing" class="extiw" title="wikipedia:Symmetric multiprocessing">symmetric multiprocessing (SMP)</a> via the <code>-T</code>/<code>--threads</code> flag to speed up compression. The <code>-T0</code> flag is included by default in the <code>COMPRESSZST</code> array in <code>/etc/makepkg.conf</code>, which lets <i>zstd</i> use as many threads as there are physical CPU cores to compress packages. The number of used threads can be further increased by instructing <i>zstd</i> to base it on the logical CPU count using the <code>--auto-threads=logical</code> flag:
</p>
<pre>COMPRESSZST=(zstd -c -T0 <b>--auto-threads=logical</b> -)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lz4">lz4</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xz">xz</a></span> are multithreaded by default, so nothing needs to be changed in <code>/etc/makepkg.conf</code>.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pigz">pigz</a></span> is a drop-in, parallel implementation for <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gzip">gzip</a></span> which by default uses all available CPU cores (the <code>-p</code>/<code>--processes</code> flag can be used to employ less cores):
</p>
<pre>COMPRESSGZ=(<b>pigz</b> -c -f -n)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pbzip2">pbzip2</a></span> is a drop-in, parallel implementation for <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bzip2">bzip2</a></span> which also uses all available CPU cores by default. The <code>-p#</code> flag can be used to employ less cores (note: no space between the <code>-p</code> and number of cores).
</p>
<pre>COMPRESSBZ2=(<b>pbzip2</b> -c -f)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lbzip2">lbzip2</a></span> is another drop-in, parallel implementation for <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bzip2">bzip2</a></span> which also uses all available CPU cores by default. The <code>-n</code> flag can be used to employ less cores.
</p>
<pre>COMPRESSBZ2=(<b>lbzip2</b> -c -f)
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/plzip/">plzip</a></span><sup><small>AUR</small></sup> is a multithreaded implementation for <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lzip">lzip</a></span> which also uses all available CPU cores by default. The <code>-n</code>/<code>--threads</code> flag can be used to employ less cores.
</p>
<pre>COMPRESSLZ=(<b>plzip</b> -c -f)
</pre>
<h4><span class="mw-headline" id="Changing_compression_level">Changing compression level</span></h4>
<p>Several compression algorithms (including zstd and xz) support setting a compression level which defines a tradeoff between speed, memory and compression efficiency.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Reduce_source_download_and_extraction_times">Reduce source download and extraction times</span></h3>
<h4><span class="mw-headline" id="Defining_the_sources_location">Defining the sources location</span></h4>
<p>Make use of <code>SRCDEST</code>, especially when building <a href="../en/VCS_package_guidelines.html" title="VCS package guidelines">VCS packages</a>, to save time acquiring and unpacking sources in subsequent rebuilds.
</p>
<h3><span class="mw-headline" id="Generate_new_checksums">Generate new checksums</span></h3>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman-contrib">pacman-contrib</a></span> and run the following command in the same directory as the PKGBUILD file to generate new checksums:
</p>
<pre>$ updpkgsums
</pre>
<p><code>updpkgsums</code> uses <code>makepkg --geninteg</code> to generate the checksums. See <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1933763#p1933763">this forum discussion</a> for more details.
</p>
<p>The checksums can also be obtained with e.g <code>sha256sum</code> and added to the <code>sha256sums</code> array by hand.
</p>
<h3><span class="mw-headline" id="Build_from_local_source_files">Build from local source files</span></h3>
<p>If you want to make changes to the source code you can download the source code without building the package by using the <i>-o, --nobuild    Download and extract files only</i> option.
</p>
<pre>$ makepkg -o
</pre>
<p>You can now make changes to the sources and then build the package by using the <i>-e, --noextract  Do not extract source files (use existing $srcdir/ dir)</i> option. Use the <i>-f</i> option to overwrite already built and existing packages.
</p>
<pre>$ makepkg -ef
</pre>
<h3><span class="mw-headline" id="Show_packages_with_specific_packager">Show packages with specific packager</span></h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=expac">expac</a></span> is a pacman database extraction utility. This command shows all packages installed on the system with the packager named <i>packagername</i>:
</p>
<pre>$ expac "%n %p" | grep "<i>packagername</i>" | column -t
</pre>
<p>This shows all packages installed on the system with the packager set in the <code>/etc/makepkg</code> variable <code>PACKAGER</code>. This shows only packages that are in a repository defined in <code>/etc/pacman.conf</code>.
</p>
<pre>$ . /etc/makepkg.conf; grep -xvFf &lt;(pacman -Qqm) &lt;(expac "%n\t%p" | grep "$PACKAGER$" | cut -f1)
</pre>
<h3><span class="mw-headline" id="Build_32-bit_packages_on_a_64-bit_system">Build 32-bit packages on a 64-bit system</span></h3>
<p>See <a href="../en/32-bit_package_guidelines.html" title="32-bit package guidelines">32-bit package guidelines</a>.
</p>
<h3><span class="mw-headline" id="Unattended_package_signing">Unattended package signing</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Merge-arrows-2.svg" decoding="async" width="36" height="40" class="mw-file-element"></span></span><b>This article or section is a candidate for merging with <a href="../en/GnuPG.html#Unattended_passphrase" title="GnuPG">GnuPG#Unattended_passphrase</a>.</b></p>
<div>
<b>Notes:</b> This is not specific to <i>makepkg</i>. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Makepkg.html">Talk:Makepkg</a>)</div>
</div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Another option is <span class="plainlinks archwiki-template-man" title="$ man 1 gnupg-set-passphrase"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/gnupg-set-passphrase.1">gnupg-set-passphrase(1)</a></span><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2022-06-25]</sup> (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Makepkg.html">Talk:Makepkg</a>)</div>
</div>
<p>A person may not be available to provide the passphrase for the gpg private key used to sign with in automated build environments such as <a href="../en/Jenkins.html" title="Jenkins">Jenkins</a>. It is ill-advised to store a private gpg key on a system without a passphrase.
</p>
<p>A resulting zst package made with <i>makepkg</i> can still be signed after creation: 
</p>
<pre>$ gpg --detach-sign --pinentry-mode loopback --passphrase --passphrase-fd 0 --output <i>NewlyBuilt.pkg.tar.zst.sig</i> --sign <i>NewlyBuilt.pkg.tar.zst</i> 
</pre>
<p>where the GPG passphrase is securely provided and obscured by your automation suite of choice.
</p>
<p>The resulting <code>zst</code> and <code>sig</code> file can be referenced by <a href="../en/Pacman.html" title="Pacman">pacman</a> clients expecting a valid signature and repositories created with <code>repo-add --sign</code> when hosting your own repo.
</p>
<h3><span class="mw-headline" id="Magnet_URIs">Magnet URIs</span></h3>
<p>Support for magnet URIs resources (with <code>magnet://</code> prefix) in the <code>source</code> field can be added using the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/transmission-dlagent/">transmission-dlagent</a></span><sup><small>AUR</small></sup> download agent.
</p>
<h3><span class="mw-headline" id="Running_makepkg_in_a_systemd_control_group">Running makepkg in a systemd control group</span></h3>
<p>If the package you are building takes too many resources to build with your default <i>make</i> flags, which are otherwise set properly for most packages, you can try running it in its own <a href="../en/Cgroups.html" class="mw-redirect" title="Control group">control group</a>. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/makepkg-cg/">makepkg-cg</a></span><sup><small>AUR</small></sup> is a wrapper for <i>makepkg</i> that achieved this via systemd control groups (see <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.resource-control"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.resource-control.5">systemd.resource-control(5)</a></span>).
</p>
<h3><span class="mw-headline" id="Running_with_idle_scheduling_policy">Running with idle scheduling policy</span></h3>
<p>Package build process can lead to high CPU utilization, especially in case of <a href="#Parallel_compilation">#Parallel compilation</a>. Under heavy CPU load, the system can issue a significant slowdown up to becoming unusable, even with the highest <span class="plainlinks archwiki-template-man" title="$ man 1 nice"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nice.1">nice(1)</a></span> value. User interface and foreground applications may stutter or even became unresponsive.
</p>
<p>This can be worked around by changing the scheduling policy to <code>SCHED_IDLE</code> before running <i>makepkg</i>. It ensures that package building process does not interfere with regular tasks and only utilizes remaining unused CPU time.
</p>
<p>From <span class="plainlinks archwiki-template-man" title="$ man 7 sched"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sched.7#SCHED_IDLE:_Scheduling_very_low_priority_jobs">sched(7) § SCHED_IDLE: Scheduling very low priority jobs</a></span>:
</p>
<dl><dd>This policy is intended for running jobs at extremely low priority (lower even than a +19 nice value with the <code>SCHED_OTHER</code> or <code>SCHED_BATCH</code> policies).</dd></dl>
<p>The <code>SCHED_IDLE</code> policy can be set by running <span class="plainlinks archwiki-template-man" title="$ man 1 chrt"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/chrt.1">chrt(1)</a></span> command with the <code>-i</code> flag, specifying priority 0 (the only valid option for <code>SCHED_IDLE</code>) and specifying the PID of the current shell. 
</p>
<p>For most shells:
</p>
<pre>$ chrt -iap 0 $$
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> You can apply this command for every build by placing it into <code>makepkg.conf</code>.</div>
<p>For the <a href="../en/Fish.html" title="Fish">fish</a> shell, where <code>$$</code> is not set:
</p>
<pre>$ chrt -iap 0 %self
</pre>
<h3><span class="mw-headline" id="Relative_paths_inside_each_package_directory">Relative paths inside each package directory</span></h3>
<p>Instead of using absolute paths for the <a href="#Package_output">package output options</a>, you can also configure relative paths inside each package directory.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The following options might cause problems with some <a href="../en/AUR_helpers.html" title="AUR helpers">AUR helpers</a>, as they might use <code>makepkg.conf</code> in a context where <code>$startdir</code> is not defined. So be careful.</div>
<p>For example, you can define target paths in your <code>makepkg.conf</code> file as follows. The <code>$startdir</code> variable refers to the directory where a <code>PKGBUILD</code> is located when you build a package.
</p>
<pre>PKGDEST="$startdir/build/packages/"
SRCDEST="$startdir/build/sources/"
SRCPKGDEST="$startdir/build/srcpackages/"
LOGDEST="$startdir/logs/"
</pre>
<p>This will result in:
</p>
<ul>
<li>Built packages will be stored in: <code>"package directory"/build/packages/</code>
</li>
<li>All downloaded source files will be stored in: <code>"package directory"/build/sources/</code>
</li>
<li>Built source packages will be stored in: <code>"package directory"/build/srcpackages/</code>
</li>
<li>All logs will be stored in: <code>"package directory"/logs/</code>
</li>
</ul>
<p><i>makepkg</i> will still create a <code>src/</code> and <code>pkg/</code> directories a usual, so this is expected behaviour.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Specifying_install_directory_for_QMAKE_based_packages">Specifying install directory for QMAKE based packages</span></h3>
<p>The makefile generated by <i>qmake</i> uses the environment variable <code>INSTALL_ROOT</code> to specify where the program should be installed. Thus this package function should work:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">PKGBUILD</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
package() {
	cd "$srcdir/${pkgname%-git}"
	make INSTALL_ROOT="$pkgdir" install
}
...</pre>
<p>Note, that qmake also has to be configured appropriately. For example put this in the corresponding <i>.pro</i> file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">YourProject.pro</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
target.path = /usr/local/bin
INSTALLS += target
...</pre>
<h3>
<span id="WARNING:_Package_contains_reference_to_.24srcdir"></span><span class="mw-headline" id="WARNING:_Package_contains_reference_to_$srcdir">WARNING: Package contains reference to $srcdir</span>
</h3>
<p>Somehow, the literal strings contained in the variables <code>$srcdir</code> or <code>$pkgdir</code> ended up in one of the installed files in the package. <a rel="nofollow" class="external autonumber" href="https://www.mail-archive.com/arch-general@archlinux.org/msg15561.html">[6]</a>
</p>
<p>To identify which files, run the following from the <i>makepkg</i> build directory:
</p>
<pre>$ grep -R "$PWD/src" pkg/
</pre>
<p>One possible cause would be from the usage of <code>__FILE__</code> macro in C/C++ code with full path passed to compiler.
</p>
<h3><span class="mw-headline" id="Makepkg_fails_to_download_dependencies_when_behind_proxy">Makepkg fails to download dependencies when behind proxy</span></h3>
<p>When <i>makepkg</i> calls dependencies, it calls pacman to install the packages, which requires administrative privileges via <i>sudo</i>. However, <i>sudo</i> does not pass any <a href="../en/Environment_variables.html" title="Environment variables">environment variables</a> to the privileged environment, and includes the proxy-related variables <code>ftp_proxy</code>, <code>http_proxy</code>, <code>https_proxy</code>, and <code>no_proxy</code>.
</p>
<p>In order to have <i>makepkg</i> working behind a proxy, invoke one of the following methods.
</p>
<h4><span class="mw-headline" id="Enable_proxy_by_setting_its_URL_in_XferCommand">Enable proxy by setting its URL in XferCommand</span></h4>
<p>The XferCommand can be set to use the desired proxy URL in <code>/etc/pacman.conf</code>.  Add or uncomment the following line in <code>pacman.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
XferCommand = /usr/bin/curl --proxy http://username:password@proxy.proxyhost.com:80 --location --continue-at - --fail --output %o %u
...</pre>
<h4>
<span id="Enable_proxy_via_sudoer.27s_env_keep"></span><span class="mw-headline" id="Enable_proxy_via_sudoer's_env_keep">Enable proxy via sudoer's env_keep</span>
</h4>
<p>Alternatively, one may want to use sudoer's <code>env_keep</code> option, which enables preserving given variables the privileged environment. See <a href="../en/Pacman.html#Pacman_does_not_honor_proxy_settings" title="Pacman">Pacman#Pacman does not honor proxy settings</a> for more details.
</p>
<h3>
<span id="Makepkg_fails.2C_but_make_succeeds"></span><span class="mw-headline" id="Makepkg_fails,_but_make_succeeds">Makepkg fails, but make succeeds</span>
</h3>
<p>If something successfully compiles using <i>make</i>, but fails through <i>makepkg</i>, it is almost certainly because <code>/etc/makepkg.conf</code> sets an incompatible compilation variable.  Try adding these flags to the PKGBUILD <code>options</code> array:
</p>
<p><code>!buildflags</code>, to prevent its default <code>CPPFLAGS</code>, <code>CFLAGS</code>, <code>CXXFLAGS</code>, and <code>LDFLAGS</code>.
</p>
<p><code>!makeflags</code>, to prevent its default <code>MAKEFLAGS</code>.
</p>
<p><code>!debug</code>, to prevent its default <code>DEBUG_CFLAGS</code>, and <code>DEBUG_CXXFLAGS</code>, in case the PKGBUILD is a debug build.
</p>
<p>If any of these fix the problem, this could warrant an upstream bug report assuming the offending flag has been identified.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><span class="plainlinks archwiki-template-man" title="$ man 8 makepkg"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.8">makepkg(8)</a></span></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 5 makepkg.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/makepkg.conf.5">makepkg.conf(5)</a></span></li>
<li><a rel="nofollow" class="external text" href="https://gist.github.com/Earnestly/bebad057f40a662b5cc3">A Brief Tour of the Makepkg Process</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/pacman/pacman/blob/master/scripts/makepkg.sh.in">makepkg source code</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Package_development.html" title="Category:Package development">Package development</a></li>
<li><a href="../en/Category:About_Arch.html" title="Category:About Arch">About Arch</a></li>
<li><a href="../en/Category:Commands.html" title="Category:Commands">Commands</a></li>
<li><a href="../en/Category:OpenPGP.html" title="Category:OpenPGP">OpenPGP</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Makepkg&amp;oldid=822768">https://wiki.archlinux.org/index.php?title=Makepkg&amp;oldid=822768</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 11 December 2024, at 18:57.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
