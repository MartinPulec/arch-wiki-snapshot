<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Intel GVT-g - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Intel_GVT-g rootpage-Intel_GVT-g skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Prerequisite" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Prerequisite">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Prerequisite</div>
		</a>
		
			<button aria-controls="toc-Prerequisite-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Prerequisite subsection</span>
			</button>
		
		<ul id="toc-Prerequisite-sublist" class="vector-toc-list">
			<li id="toc-libvirt_QEMU_hook" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#libvirt_QEMU_hook">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>libvirt QEMU hook</div>
			</a>
			
			<ul id="toc-libvirt_QEMU_hook-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-systemd_service_at_boot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#systemd_service_at_boot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>systemd service at boot</div>
			</a>
			
			<ul id="toc-systemd_service_at_boot-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Assign_a_virtual_GPU_to_the_virtual_machine" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Assign_a_virtual_GPU_to_the_virtual_machine">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Assign a virtual GPU to the virtual machine</div>
		</a>
		
			<button aria-controls="toc-Assign_a_virtual_GPU_to_the_virtual_machine-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Assign a virtual GPU to the virtual machine subsection</span>
			</button>
		
		<ul id="toc-Assign_a_virtual_GPU_to_the_virtual_machine-sublist" class="vector-toc-list">
			<li id="toc-QEMU_CLI" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#QEMU_CLI">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>QEMU CLI</div>
			</a>
			
			<ul id="toc-QEMU_CLI-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-libvirt" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#libvirt">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>libvirt</div>
			</a>
			
			<ul id="toc-libvirt-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Getting_virtual_GPU_display_contents" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Getting_virtual_GPU_display_contents">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Getting virtual GPU display contents</div>
		</a>
		
			<button aria-controls="toc-Getting_virtual_GPU_display_contents-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Getting virtual GPU display contents subsection</span>
			</button>
		
		<ul id="toc-Getting_virtual_GPU_display_contents-sublist" class="vector-toc-list">
			<li id="toc-Using_DMA-BUF_display" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_DMA-BUF_display">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Using DMA-BUF display</div>
			</a>
			
			<ul id="toc-Using_DMA-BUF_display-sublist" class="vector-toc-list">
				<li id="toc-QEMU_CLI_2" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#QEMU_CLI_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.1</span>QEMU CLI</div>
			</a>
			
			<ul id="toc-QEMU_CLI_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-libvirt_2" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#libvirt_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.2</span>libvirt</div>
			</a>
			
			<ul id="toc-libvirt_2-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Using_DMA-BUF_with_UEFI/OVMF" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_DMA-BUF_with_UEFI/OVMF">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Using DMA-BUF with UEFI/OVMF</div>
			</a>
			
			<ul id="toc-Using_DMA-BUF_with_UEFI/OVMF-sublist" class="vector-toc-list">
				<li id="toc-QEMU_CLI_3" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#QEMU_CLI_3">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.1</span>QEMU CLI</div>
			</a>
			
			<ul id="toc-QEMU_CLI_3-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-libvirt_3" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#libvirt_3">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.2</span>libvirt</div>
			</a>
			
			<ul id="toc-libvirt_3-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Enable_RAMFB_display_(optional)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enable_RAMFB_display_(optional)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Enable RAMFB display (optional)</div>
			</a>
			
			<ul id="toc-Enable_RAMFB_display_(optional)-sublist" class="vector-toc-list">
				<li id="toc-QEMU_CLI_4" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#QEMU_CLI_4">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.1</span>QEMU CLI</div>
			</a>
			
			<ul id="toc-QEMU_CLI_4-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-libvirt_4" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#libvirt_4">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.2</span>libvirt</div>
			</a>
			
			<ul id="toc-libvirt_4-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Display_virtual_GPU_output" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Display_virtual_GPU_output">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Display virtual GPU output</div>
		</a>
		
			<button aria-controls="toc-Display_virtual_GPU_output-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Display virtual GPU output subsection</span>
			</button>
		
		<ul id="toc-Display_virtual_GPU_output-sublist" class="vector-toc-list">
			<li id="toc-Output_using_QEMU_GTK_display" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Output_using_QEMU_GTK_display">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Output using QEMU GTK display</div>
			</a>
			
			<ul id="toc-Output_using_QEMU_GTK_display-sublist" class="vector-toc-list">
				<li id="toc-QEMU_CLI_5" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#QEMU_CLI_5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.1</span>QEMU CLI</div>
			</a>
			
			<ul id="toc-QEMU_CLI_5-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-libvirt_5" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#libvirt_5">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.2</span>libvirt</div>
			</a>
			
			<ul id="toc-libvirt_5-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-scaling" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#scaling">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.3</span>scaling</div>
			</a>
			
			<ul id="toc-scaling-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-GTK_display_CPU_load" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#GTK_display_CPU_load">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.4</span>GTK display CPU load</div>
			</a>
			
			<ul id="toc-GTK_display_CPU_load-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Output_using_SPICE_with_MESA_EGL" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Output_using_SPICE_with_MESA_EGL">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Output using SPICE with MESA EGL</div>
			</a>
			
			<ul id="toc-Output_using_SPICE_with_MESA_EGL-sublist" class="vector-toc-list">
				<li id="toc-QEMU_CLI_6" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#QEMU_CLI_6">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.1</span>QEMU CLI</div>
			</a>
			
			<ul id="toc-QEMU_CLI_6-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-libvirt_6" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#libvirt_6">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.2</span>libvirt</div>
			</a>
			
			<ul id="toc-libvirt_6-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Output_using_SPICE_with_NVIDIA_EGL_or_VNC" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Output_using_SPICE_with_NVIDIA_EGL_or_VNC">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Output using SPICE with NVIDIA EGL or VNC</div>
			</a>
			
			<ul id="toc-Output_using_SPICE_with_NVIDIA_EGL_or_VNC-sublist" class="vector-toc-list">
				<li id="toc-libvirt_7" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#libvirt_7">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3.1</span>libvirt</div>
			</a>
			
			<ul id="toc-libvirt_7-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Disable_all_outputs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Disable_all_outputs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>Disable all outputs</div>
			</a>
			
			<ul id="toc-Disable_all_outputs-sublist" class="vector-toc-list">
				<li id="toc-QEMU_CLI_7" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#QEMU_CLI_7">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4.1</span>QEMU CLI</div>
			</a>
			
			<ul id="toc-QEMU_CLI_7-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-libvirt_8" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#libvirt_8">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4.2</span>libvirt</div>
			</a>
			
			<ul id="toc-libvirt_8-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Missing_mdev_supported_types_directory" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Missing_mdev_supported_types_directory">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Missing mdev_supported_types directory</div>
			</a>
			
			<ul id="toc-Missing_mdev_supported_types_directory-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Windows_hanging_with_bad_memory_error" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Windows_hanging_with_bad_memory_error">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Windows hanging with bad memory error</div>
			</a>
			
			<ul id="toc-Windows_hanging_with_bad_memory_error-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_Intel_GVT-G_in_combination_with_PRIME_render_offload" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_Intel_GVT-G_in_combination_with_PRIME_render_offload">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Using Intel GVT-G in combination with PRIME render offload</div>
			</a>
			
			<ul id="toc-Using_Intel_GVT-G_in_combination_with_PRIME_render_offload-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-No_display" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#No_display">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>No display</div>
			</a>
			
			<ul id="toc-No_display-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Garbled_graphics" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Garbled_graphics">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5</span>Garbled graphics</div>
			</a>
			
			<ul id="toc-Garbled_graphics-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Host_hanging_when_trying_to_suspend" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Host_hanging_when_trying_to_suspend">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.6</span>Host hanging when trying to suspend</div>
			</a>
			
			<ul id="toc-Host_hanging_when_trying_to_suspend-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Changing_the_display_resolution_of_virtual_GPU" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Changing_the_display_resolution_of_virtual_GPU">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.7</span>Changing the display resolution of virtual GPU</div>
			</a>
			
			<ul id="toc-Changing_the_display_resolution_of_virtual_GPU-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Intel GVT-g</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 2 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-2" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">2 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Intel_GVT-g" title="Intel GVT-g – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Intel_GVT-g" title="Intel GVT-g – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/PCI_passthrough_via_OVMF.html" title="PCI passthrough via OVMF">PCI passthrough via OVMF</a></li>
<li><a href="../en/QEMU.html" title="QEMU">QEMU</a></li>
<li><a href="../en/Intel_graphics.html" title="Intel graphics">Intel graphics</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://github.com/intel/gvt-linux/wiki/GVTg_Setup_Guide">Intel GVT-g</a> is a technology that provides mediated device passthrough for Intel GPUs (Broadwell and newer). It can be used to virtualize the GPU for multiple guest virtual machines, effectively providing near-native graphics performance in the virtual machine and still letting your host use the virtualized GPU normally. This is useful if you want accelerated graphics in Windows virtual machines running on ultrabooks without dedicated GPUs for <a href="../en/PCI_passthrough_via_OVMF.html" title="PCI passthrough via OVMF">full device passthrough</a>. (Similar technologies exist for NVIDIA and AMD GPUs, but they are available only in the "professional" GPU lines like Quadro, Radeon Pro and so on.)
</p>
<p>There is also a variant of this technology called GVT-d - it is essentially Intel's name for full device passthrough with the vfio-pci driver. With GVT-d, the host cannot use the virtualized GPU.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Prerequisite">Prerequisite</span></h2>
<p>Intel GVT-g currently only works with Intel Broadwell (5th gen) to Comet Lake (10th gen), this is due to a lack of support in the i915 driver for Ice Lake (10th gen mobile processors), Rocket Lake (11th gen desktop) and newer. See this <a rel="nofollow" class="external text" href="https://www.intel.com/content/www/us/en/support/articles/000058558/graphics.html">Intel Support Post</a> and this <a rel="nofollow" class="external text" href="https://github.com/intel/gvt-linux/issues/126">Github Issue</a> for details. 
</p>
<p>Currently Ice Lake supports GVT-d only. For <a href="https://en.wikipedia.org/wiki/Intel_Graphics_Technology#Xe_LP_Architecture_.28Gen12.29" class="extiw" title="wikipedia:Intel Graphics Technology">Xe Architecture (Gen12)</a> based GPUs, SR-IOV feature is needed instead. Refer to <a href="../en/QEMU/Guest_graphics_acceleration.html#SR-IOV" title="QEMU/Guest graphics acceleration">QEMU/Guest graphics acceleration#SR-IOV</a> for more details.
</p>
<p>You will have to create a virtual GPU first, then assign it to your virtual machine. The guest with a virtual GPU sees it as a "regular" GPU - just install the latest native drivers. (The virtual GPU actually does need specialized drivers to work correctly, but all the required changes are present in the latest upstream Linux/Windows drivers.)
</p>
<p>You will need to:
</p>
<ul>
<li>Use at least Linux 4.16 and <a href="../en/QEMU.html" title="QEMU">QEMU</a> 2.12.</li>
<li>Enable IOMMU by adding <code>intel_iommu=on</code> to your <a href="../en/Kernel_parameters.html" title="Kernel parameters">kernel parameters</a>.</li>
<li>
<a href="../en/Kernel_module.html#Automatic_module_loading" title="Kernel module">Enable</a> kernel modules: <code>kvmgt</code>, <code>vfio-iommu-type1</code> and <code>mdev</code>.</li>
<li>Set the i915 <a href="../en/Kernel_module.html#Setting_module_options" class="mw-redirect" title="Kernel module parameter">kernel module parameter</a> <code>enable_gvt=1</code> to enable GPU virtualization.</li>
<li>Add <code>i915.enable_guc=0</code> to <a href="../en/Kernel_parameters.html" title="Kernel parameters">kernel parameters</a>, see warning at <a href="../en/Intel_graphics.html#Enable_GuC_/_HuC_firmware_loading" title="Intel graphics">Intel graphics#Enable GuC / HuC firmware loading</a>.</li>
<li>Find the PCI address of your GPU <code>$GVT_PCI</code> (e.g. <code>0000:00:02.0</code>) by running <code>lspci -D -nn</code>.</li>
<li>Generate a virtual GPU GUID (<code>$GVT_GUID</code> in commands below) which you will use to create and assign the virtual GPU. A single virtual GPU can be assigned only to a single virtual machine - create as many GUIDs as you want virtual GPUs. (You can do so by running <code>uuidgen</code>.)</li>
</ul>
<p>After rebooting with the <code>i915.enable_gvt=1</code> flag, you should be able to create virtual GPUs.
</p>
<p>You can list the types of virtual GPUs which can be created on your system like this:
</p>
<pre>$ ls /sys/devices/pci0000\:00/$GVT_PCI/mdev_supported_types
</pre>
<p>The <a rel="nofollow" class="external text" href="https://github.com/intel/gvt-linux/wiki/GVTg_Setup_Guide#53-create-vgpu-kvmgt-only">lower-numbered types</a> are capable of higher resolutions, larger video memory allocations and will be able to use more GPU time slices.
</p>
<p>A description of each types capabilities can be accessed like this
</p>
<pre>$ cat /sys/devices/pci0000\:00/$GVT_PCI/mdev_supported_types/$GVT_TYPE/description
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If the directory is presented but contains nothing, you may try to increase the AGP aperture size in your computer firmware.</div>
<p>Pick a type you want to use - we will refer to it as <code>$GVT_TYPE</code> below.
</p>
<p>Use the GUID you have created to create a virtual GPU with a chosen type:
</p>
<pre># echo "$GVT_GUID" &gt; "/sys/devices/pci0000\:00/$GVT_PCI/mdev_supported_types/$GVT_TYPE/create"
</pre>
<p>You can repeat this as many times as you want with different GUIDs. All created virtual GPUs will land in <code>/sys/bus/pci/devices/$GVT_PCI/</code> - if you would like to remove a virtual GPU, you can do:
</p>
<pre># echo 1 &gt; /sys/devices/pci0000\:00/$GVT_PCI/$GVT_GUID/remove
</pre>
<h3><span class="mw-headline" id="libvirt_QEMU_hook">libvirt QEMU hook</span></h3>
<p>With libvirt, a <a rel="nofollow" class="external text" href="https://www.libvirt.org/hooks.html">libvirt QEMU hook</a> can be used to automatically create the virtual GPU when the machine is started, and to remove it when the machine is stopped. Replace the variables with the values you found above and the DOMAIN with the name of the machine.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/libvirt/hooks/qemu</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
GVT_PCI=&lt;GVT_PCI&gt;
GVT_GUID=&lt;GVT_GUID&gt;
MDEV_TYPE=&lt;GVT_TYPE&gt;
DOMAIN=&lt;DOMAIN name&gt;
if [ $# -ge 3 ]; then
    if [[ " $DOMAIN " =~ .*\ $1\ .* ]] &amp;&amp; [ "$2" = "prepare" ] &amp;&amp; [ "$3" = "begin" ]; then
        echo "$GVT_GUID" &gt; "/sys/devices/pci0000:00/$GVT_PCI/mdev_supported_types/$MDEV_TYPE/create"
    elif [[ " $DOMAIN " =~ .*\ $1\ .* ]] &amp;&amp; [ "$2" = "release" ] &amp;&amp; [ "$3" = "end" ]; then
        echo 1 &gt; "/sys/devices/pci0000:00/$GVT_PCI/$GVT_GUID/remove"
    fi
fi
</pre>
<p>Do not forget to make the file <a href="../en/Help:Reading.html#Make_executable" class="mw-redirect" title="Executable">executable</a> and to quote each variable value e.g. <code>GVT_PCI="0000:00:02.0"</code>. You will also need to restart the libvirtd daemon so that it is aware of the new hook. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>If you use libvirt user session, you need to tweak the script to use <a href="../en/General_recommendations.html#Security" title="General recommendations">privilege elevation</a> commands, such as <span class="plainlinks archwiki-template-man" title="$ man 1 pkexec"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pkexec.1">pkexec(1)</a></span> or a no-password <a href="../en/Sudo.html" title="Sudo">sudo</a>.</li>
<li>The XML of the domain is feed to the hook script through stdin. You can use <code>xmllint</code> and XPath expression to extract <code>GVT_GUID</code> from stdin, e.g.: <pre>GVT_GUID="$(xmllint --xpath 'string(/domain/devices/hostdev[@type="mdev"][@display="on"]/source/address/@uuid)' -)"</pre>
</li>
</ul>
</div>
<h3><span class="mw-headline" id="systemd_service_at_boot">systemd service at boot</span></h3>
<p>Alternatively to a QEMU hook, you can let systemd create the virtual GPU at boot. This does not rely on libvirt and appears to have no GPU performance drawbacks on the host machine as long as the virtual GPU is not used by a virtual machine.
</p>
<p>Create a <a href="../en/Bash.html" title="Bash">bash</a> script and place the <i>echo</i> command to create the virtual GPU determined in <a href="#Prerequisite">Prerequisite</a> inside. Make it <a href="../en/Help:Reading.html#Make_executable" class="mw-redirect" title="Executable">executable</a>. Ensure that the script cannot be modified by unprivileged users as it will be run as root at boot.
</p>
<p>Now <a href="../en/Systemd.html#Writing_unit_files" title="Systemd">create a systemd service</a> to run the script and give it these properties:
</p>
<pre>After=graphical.target
Type=oneshot
User=root
</pre>
<h2><span class="mw-headline" id="Assign_a_virtual_GPU_to_the_virtual_machine">Assign a virtual GPU to the virtual machine</span></h2>
<p>If you run <code>qemu</code> or <code>libvirtd</code> as a regular user, it may complain that some path <code>/dev/vfio/<i>number</i></code> is not writeable. You need to enable write access to that path for the account, with <code>chmod</code> or <code>setfacl</code>.
</p>
<h3><span class="mw-headline" id="QEMU_CLI">QEMU CLI</span></h3>
<p>To create a virtual machine with the virtualized GPU, add this parameter to the QEMU command line:
</p>
<pre>-device vfio-pci,sysfsdev=/sys/bus/mdev/devices/$GVT_GUID
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> KVM must be enabled by <code>-enable-kvm</code>.</div>
<h3><span class="mw-headline" id="libvirt">libvirt</span></h3>
<p>Add the following device to the <code><i>devices</i></code> element of the virtual machine definition:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ virsh edit <i>vmname</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
    &lt;hostdev mode='subsystem' type='mdev' managed='no' model='vfio-pci' display='off'&gt;
      &lt;source&gt;
        &lt;address uuid=<i>GVT_GUID</i>/&gt;
      &lt;/source&gt;
    &lt;/hostdev&gt;
...</pre>
<p>Replace <code><i>GVT_GUID</i></code> with the UUID of your virtual GPU.
</p>
<h2><span class="mw-headline" id="Getting_virtual_GPU_display_contents">Getting virtual GPU display contents</span></h2>
<p>There are several possible ways to retrieve the display contents from the virtual GPU.
</p>
<h3><span class="mw-headline" id="Using_DMA-BUF_display">Using DMA-BUF display</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> According to this <a rel="nofollow" class="external text" href="https://github.com/intel/gvt-linux/issues/20">issue</a>, this method will not work with UEFI guests using (unmodified) OVMF. Use a BIOS-based guest (e.g. using SeaBIOS) or see below for patches/workarounds.</div>
<h4><span class="mw-headline" id="QEMU_CLI_2">QEMU CLI</span></h4>
<p>Add <code>display=on,x-igd-opregion=on</code> to the end of <code>-device vfio-pci</code> parameter, e.g.:
</p>
<pre>-device vfio-pci,sysfsdev=/sys/bus/mdev/devices/$GVT_GUID,display=on,x-igd-opregion=on
</pre>
<h4><span class="mw-headline" id="libvirt_2">libvirt</span></h4>
<p>First, modify the XML schema of the virtual machine definition so that we can use QEMU-specific elements later. Change
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ virsh edit <i>vmname</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;domain type='kvm'&gt;
</pre>
<p>to
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ virsh edit <i>vmname</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;domain xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0' type='kvm'&gt;
</pre>
<p>Then add this configuration to the end of the <code>&lt;domain&gt;</code> element, i. e. insert this text right above the closing <code>&lt;/domain&gt;</code> tag:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ virsh edit <i>vmname</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
  &lt;qemu:override&gt;
    &lt;qemu:device alias="hostdev0"&gt;
      &lt;qemu:frontend&gt;
        ...
        &lt;qemu:property name="x-igd-opregion" type="bool" value="true"/&gt;
      &lt;/qemu:frontend&gt;
    &lt;/qemu:device&gt;
  &lt;/qemu:override&gt;
...
</pre>
<h3>
<span id="Using_DMA-BUF_with_UEFI.2FOVMF"></span><span class="mw-headline" id="Using_DMA-BUF_with_UEFI/OVMF">Using DMA-BUF with UEFI/OVMF</span>
</h3>
<p>As stated above, DMA-BUF display will not work with UEFI-based guests using (unmodified) OVMF because it will not create the necessary ACPI OpRegion exposed via QEMU's nonstandard fw_cfg interface. See <a rel="nofollow" class="external text" href="https://bugzilla.tianocore.org/show_bug.cgi?id=935">this OVMF bug</a> for details of this issue.
</p>
<p>According to <a rel="nofollow" class="external text" href="https://github.com/intel/gvt-linux/issues/23#issuecomment-468125999">this GitHub comment</a>, the OVMF bug report suggests several solutions to the problem. It is possible to:
</p>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://bugzilla.tianocore.org/attachment.cgi?id=165">patch</a> OVMF (<a rel="nofollow" class="external text" href="https://bugzilla.tianocore.org/show_bug.cgi?id=935#c4">details</a>) to add an Intel-specific quirk (most straightforward but non-upstreamable solution);</li>
<li>
<a rel="nofollow" class="external text" href="https://bugzilla.tianocore.org/attachment.cgi?id=168">patch</a> the host kernel (<a rel="nofollow" class="external text" href="https://bugzilla.tianocore.org/show_bug.cgi?id=935#c12">details</a>) to automatically provide an option ROM for the virtual GPU containing basically the same code but in option ROM format;</li>
<li>
<a rel="nofollow" class="external text" href="http://120.25.59.132:3000/vbios_gvt_uefi.rom">extract the OpROM</a> from the kernel patch (<a rel="nofollow" class="external text" href="https://www.reddit.com/r/VFIO/comments/av736o/creating_a_clover_bios_nonuefi_install_for_qemu/ehdz6mf/">source</a>) and feed it to QEMU as an override.</li>
</ul>
<p>We will go with the last option because it does not involve patching anything. (Note: if the link <i>and</i> <a rel="nofollow" class="external text" href="https://web.archive.org/web/20201020144354/http://120.25.59.132:3000/vbios_gvt_uefi.rom">the archive</a> go down, the OpROM can be extracted from the kernel patch by hand.)
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/i915ovmf/">i915ovmf</a></span><sup><small>AUR</small></sup> is available, which is an <a rel="nofollow" class="external text" href="https://github.com/x78x79x82x79/i915ovmfPkg">up-to-date fork</a> of the archived <a rel="nofollow" class="external text" href="https://github.com/patmagauran/i915ovmfPkg">i915ovmfPkg</a>, it is a currently the most advanced GVT-g ROM for use with OVMF, see <a rel="nofollow" class="external text" href="https://github.com/intel/gvt-linux/issues/23">this discussion</a>. The AUR package installs the UEFI rom file as <code> /var/lib/libvirt/qemu/drivers/i915ovmf.rom </code>. First boot can take a while, especially if the guest OS needs to install drivers, as is the case with Windows 10.
</p>
<p>Download <code>vbios_gvt_uefi.rom</code> and place it somewhere world-accessible (we will use <code>/</code> to make an example).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>If using <a href="../en/SELinux.html" title="SELinux">SELinux</a>, it will deny access to the <i>.rom</i> file resulting in a message that QEMU is unable to locate it.</li>
<li>To securely grant access to the <i>.rom</i> file without disabling SELinux or switching to passive mode, put the <code>vbios_gvt_uefi.rom</code> file in <code>/var/lib/libvirt</code> then run <code>restorecon -Rv /var/lib/libvirt</code> as root. SELinux will then apply the proper labels, granting access to QEMU's svirt_t policy.</li>
</ul>
</div>
<h4><span class="mw-headline" id="QEMU_CLI_3">QEMU CLI</span></h4>
<p>To specify the vBIOS ROM file, append <code>,romfile=/path/to/vbios_gvt_uefi.rom</code> to <code>-device vfio-pci,...</code>.
</p>
<h4><span class="mw-headline" id="libvirt_3">libvirt</span></h4>
<p>Then edit the virtual machine definition, appending this configuration to the <code>&lt;qemu:override&gt;</code> element we added earlier:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ virsh edit <i>vmname</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
  &lt;qemu:override&gt;
    &lt;qemu:device alias="hostdev0"&gt;
      &lt;qemu:frontend&gt;
      ...
        &lt;qemu:property name="romfile" type="string" value="<b>/path/to/vbios_gvt_uefi.rom</b>"/&gt;
      ...
      &lt;/qemu:frontend&gt;
    &lt;/qemu:device&gt;
  &lt;/qemu:override&gt;
...
</pre>
<h3>
<span id="Enable_RAMFB_display_.28optional.29"></span><span class="mw-headline" id="Enable_RAMFB_display_(optional)">Enable RAMFB display (optional)</span>
</h3>
<p>This should be combined with the above DMA-BUF configuration in order to also display everything that happens before the guest Intel driver is loaded (i.e. POST, the firmware interface, and the guest initialization).
</p>
<h4><span class="mw-headline" id="QEMU_CLI_4">QEMU CLI</span></h4>
<p>Add <code>ramfb=on,driver=vfio-pci-nohotplug</code> to the end of <code>-device vfio-pci</code> parameter, e.g.:
</p>
<pre>-device vfio-pci,sysfsdev=/sys/bus/mdev/devices/$GVT_GUID,display=on,x-igd-opregion=on,ramfb=on,driver=vfio-pci-nohotplug
</pre>
<h4><span class="mw-headline" id="libvirt_4">libvirt</span></h4>
<p>First, follow the first step of <a href="#libvirt_2">this section</a> to modify the XML schema.
</p>
<p>Then add this configuration to the end of the <code>&lt;domain&gt;</code> element, i.e. insert this text right above the closing <code>&lt;/domain&gt;</code> tag:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ virsh edit <i>vmname</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
  &lt;qemu:override&gt;
    &lt;qemu:device alias="hostdev0"&gt;
      &lt;qemu:frontend&gt;
        ...
        &lt;qemu:property name="driver" type="string" value="vfio-pci-nohotplug"/&gt;
        &lt;qemu:property name="ramfb" type="bool" value="true"/&gt;
      &lt;/qemu:frontend&gt;
    &lt;/qemu:device&gt;
  &lt;/qemu:override&gt;
...
</pre>
<h2><span class="mw-headline" id="Display_virtual_GPU_output">Display virtual GPU output</span></h2>
<p>Due to an <a rel="nofollow" class="external text" href="https://gitlab.freedesktop.org/spice/spice-gtk/issues/100">issue</a> with spice-gtk, the configuration is different depending on the SPICE client EGL implementation.
</p>
<h3><span class="mw-headline" id="Output_using_QEMU_GTK_display">Output using QEMU GTK display</span></h3>
<p>This method will get you higher refresh rate and less lag / input delay than SPICE display on weak CPUs, at least with Windows guests. Also it is less CPU-intensive than Looking Glass. But you lose useful SPICE display features, such as:
</p>
<ul>
<li>shared clipboard (can be re-gained, see <a href="../en/QEMU.html#qemu-vdagent" title="QEMU">QEMU#qemu-vdagent</a>)</li>
<li>live USB redirection (you will need to assign the USB device before booting the guest)</li>
<li>mouse cursor being free to come in and out of the virtual machine (will be grabbed, except if you use the <a href="../en/QEMU.html#Mouse_integration" title="QEMU">USB tablet input device</a>)</li>
<li>integration of the display output into virt-manager (will spawn separate window for the GTK display)</li>
</ul>
<p>The display output will only begin to work when the guest has started its proper Intel GPU driver (usually at the login screen). This means that:
</p>
<ul>
<li>It is best if you install the Intel GPU driver beforehand or use a different virtual display adapter (like <a href="../en/QEMU.html#std" title="QEMU">-vga std</a> or <a rel="nofollow" class="external text" href="https://wiki.libvirt.org/page/QEMUSwitchToLibvirt#-std-vga">for libvirt</a>) together with the Intel vGPU to install the Intel GPU driver, then remove the std video adapter.</li>
<li>You will never see the operating system booting and if it crashes before login you need to switch to a different virtual display adapter.</li>
<li>If you need access to the BIOS, you need to <a href="#Enable_RAMFB_display_(optional)">enable the RAMFB display</a>.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> In QEMU GTK, <code>Ctrl+Alt+G</code> grabs or releases the mouse cursor, <code>Ctrl+Alt+F</code> switches between windowed and fullscreen modes.</div>
<h4><span class="mw-headline" id="QEMU_CLI_5">QEMU CLI</span></h4>
<p>Add <code>-display gtk,gl=on</code> to the command line. The QEMU VGA adapter can be disabled by adding <code>-vga none</code>, or you have two virtual screens, and the one connected to the QEMU VGA adapter is blank.
</p>
<h4><span class="mw-headline" id="libvirt_5">libvirt</span></h4>
<ul>
<li>Ensure the above added <code>&lt;hostdev&gt;</code> device have the <code>display</code> attribute set to <code>'off'</code>.</li>
<li>Ensure you have added the dummy line <code>xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'</code> to your <code>domain</code> (from step <a href="#libvirt_2">Using DMA-BUF display</a>).</li>
<li>Remove all <code>&lt;graphics&gt;</code> and <code>&lt;video&gt;</code> devices.</li>
</ul>
<p>The QEMU GTK display window needs to be told what display output it should use to run OpenGL on.
On a laptop first disconnect any external displays so you only have the laptop screen as a display.
Get the number of the display that your GPU outputs to by pasting into a terminal: <code>echo $DISPLAY</code>
An example would be <code>:0</code> .
You may now reconnect any displays you were using before.
Insert the number you just determined in the <code>env name='DISPLAY'</code> line below.
</p>
<ul><li>Add the following QEMU command line arguments:</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ virsh edit <i>vmname</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
  &lt;qemu:commandline&gt;
    &lt;qemu:arg value="-display"/&gt;
    &lt;qemu:arg value="gtk,gl=on,zoom-to-fit=off"/&gt;
    &lt;qemu:env name="DISPLAY" value=":0"/&gt;
  &lt;/qemu:commandline&gt;
  &lt;qemu:override&gt;
    &lt;qemu:device alias="hostdev0"&gt;
      &lt;qemu:frontend&gt;
        &lt;qemu:property name="display" type="string" value="on"/&gt;
        ...
      &lt;/qemu:frontend&gt;
    &lt;/qemu:device&gt;
  &lt;/qemu:override&gt;
...</pre>
<h4><span class="mw-headline" id="scaling">scaling</span></h4>
<p>In windowed mode, <code>-display gtk,gl=on,zoom-to-fit=off</code> makes the GTK display window size be as large as the resolution of the guest display is, this gives you 1:1 pixel aspect ratio. Turning this on or leaving it out makes the guest display stretch/shrink to how big the GTK window happens to be (ugly scaling).
</p>
<p>In fullscreen, you will get scaling anyways and when you change the guest resolution, the scaling only updates when lowering the resolution. When you increase the resolution the image grows larger than your display, so you need to exit fullscreen and enter it again.
</p>
<h4><span class="mw-headline" id="GTK_display_CPU_load">GTK display CPU load</span></h4>
<p>This is a tradeoff between methods of copying the guest framebuffer to the GTK display window.
</p>
<p><code>gl=es</code> in place of <code>gl=on</code> delegates the task of copying the guest framebuffer to the GPU (via DMA).
</p>
<p>This reduces the CPU load of the GTK display and can yield a much more responsive guest, especially on weak CPUs.
</p>
<p>When this frame buffer copy operation shares GPU resources with an application loading the GPU, the displayed FPS are likely to drop and stuttering (irregular intervals between displayed frames) is likely to occur.
</p>
<h3><span class="mw-headline" id="Output_using_SPICE_with_MESA_EGL">Output using SPICE with MESA EGL</span></h3>
<h4><span class="mw-headline" id="QEMU_CLI_6">QEMU CLI</span></h4>
<p>Add <code>-display spice-app,gl=on</code> to the command line. <code>virt-viewer</code> must be installed.
</p>
<h4><span class="mw-headline" id="libvirt_6">libvirt</span></h4>
<ol>
<li>Ensure the above added <code>&lt;hostdev&gt;</code> device have the <code>display</code> attribute set to <code>'on'</code>.</li>
<li>Remove all <code>&lt;graphics&gt;</code> and <code>&lt;video&gt;</code> devices.</li>
<li>Add the following devices:</li>
</ol>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ virsh edit <i>vmname</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
    &lt;graphics type='spice'&gt;
      &lt;listen type='none'/&gt;
      &lt;gl enable='yes'/&gt;
    &lt;/graphics&gt;
    &lt;video&gt;
      &lt;model type='none'/&gt;
    &lt;/video&gt;
...
</pre>
<p>There is an optional attribute <code>rendernode</code> in the <code>gl</code> tag to allow specify the renderer, e.g.:
</p>
<pre>&lt;gl enable='yes' rendernode='/dev/dri/by-path/pci-0000:00:02.0-render'/&gt;
</pre>
<h3><span class="mw-headline" id="Output_using_SPICE_with_NVIDIA_EGL_or_VNC">Output using SPICE with NVIDIA EGL or VNC</span></h3>
<h4><span class="mw-headline" id="libvirt_7">libvirt</span></h4>
<ol>
<li>Ensure the above added &lt;hostdev&gt; device have the display attribute set to 'on'.</li>
<li>Remove all &lt;graphics&gt; and &lt;video&gt; devices.</li>
<li>Add the following devices:</li>
</ol>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ virsh edit <i>vmname</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
    &lt;graphics type='spice' autoport='yes'&gt;
      &lt;listen type='address'/&gt;
    &lt;/graphics&gt;
    &lt;graphics type='egl-headless'/&gt;
    &lt;video&gt;
      &lt;model type='none'/&gt;
    &lt;/video&gt;
...
</pre>
<p>The <code>&lt;graphics type='spice'&gt;</code> type can be changed to 'vnc' to use VNC instead.
</p>
<p>Also there is an <i>optional</i> tag &lt;gl&gt; inside &lt;graphics type='egl-headless'&gt; tag to force a specific renderer, do not put inside the 'spice' graphics due the mentioned bug, example:
</p>
<pre>&lt;graphics type='egl-headless'&gt;
  &lt;gl rendernode='/dev/dri/by-path/pci-0000:00:02.0-render'/&gt;
&lt;/graphics&gt;
</pre>
<h3><span class="mw-headline" id="Disable_all_outputs">Disable all outputs</span></h3>
<p>If all outputs are disabled, the only way to see the display output would then be using a software server like RDP, VNC or Looking Glass. See <a href="../en/PCI_passthrough_via_OVMF.html#Using_Looking_Glass_to_stream_guest_screen_to_the_host" title="PCI passthrough via OVMF">PCI passthrough via OVMF#Using Looking Glass to stream guest screen to the host</a> for details.
</p>
<h4><span class="mw-headline" id="QEMU_CLI_7">QEMU CLI</span></h4>
<p>In the <code>-device vfio-pci</code> parameter, remove <code>ramfb=on</code> and change to <code>display=off</code>. Add <code>-vga none</code> to disable the QEMU VGA adapter.
</p>
<h4><span class="mw-headline" id="libvirt_8">libvirt</span></h4>
<p>To ensure no emulated GPU is added, one can edit the virtual machine configuration and do the following changes:
</p>
<ol>
<li>Remove all &lt;graphics&gt; devices.</li>
<li>Change the &lt;video&gt; device to be type 'none'.</li>
<li>Ensure the above added &lt;hostdev&gt; device have the <code>display</code> attribute set to 'off'.</li>
</ol>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Missing_mdev_supported_types_directory">Missing mdev_supported_types directory</span></h3>
<p>If you have followed instructions and added <code>i915.enable_gvt=1</code> kernel parameter, but there is still no <code>/sys/bus/pci/devices/0000:02:00.0/mdev_supported_types</code> directory, first double-check that the <code>kvmgt</code> module is loaded.
</p>
<p>You should also check whether your hardware is supported. Check the output of <a href="../en/Core_utilities.html#Essentials" class="mw-redirect" title="Dmesg">dmesg</a> for this message:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># dmesg | grep -i gvt </pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[    4.227468] [drm] Unsupported device. GVT-g is disabled</pre>
<p>If that is the case, you may want to check upstream for support plans.
For example, for the "Coffee Lake" (CFL) platform support, see <a rel="nofollow" class="external free" href="https://github.com/intel/gvt-linux/issues/53">https://github.com/intel/gvt-linux/issues/53</a>
</p>
<h3><span class="mw-headline" id="Windows_hanging_with_bad_memory_error">Windows hanging with bad memory error</span></h3>
<p>If Windows is hanging due to a Bad Memory error look for more details via <i>dmesg</i>. If the host kernel logs show something like rlimit memory exceeded, you may need to increase the max memory Linux allows QEMU to allocate. Assuming you are in the group <code>kvm</code>, add the following to <code>/etc/security/limits.d/42-intel-gvtg.conf</code> and restarting the system.
</p>
<pre># qemu kvm, need high memlock to allocate memory for vga-passthrough
@kvm - memlock 8388608
</pre>
<h3><span class="mw-headline" id="Using_Intel_GVT-G_in_combination_with_PRIME_render_offload">Using Intel GVT-G in combination with PRIME render offload</span></h3>
<p>Using Intel GVT-G while also using NVIDIA's <a href="../en/PRIME.html#PRIME_render_offload" title="PRIME">PRIME render offload</a> on the host causes several <a rel="nofollow" class="external text" href="https://github.com/intel/gvt-linux/issues/162">issues</a> on the guest. It is suggested to use <a href="../en/Bumblebee.html#Power_management" class="mw-redirect" title="Bbswitch">bbswitch</a> to keep the card powered off or use it in conjunction with <a href="../en/Bumblebee.html" title="Bumblebee">Bumblebee</a>, <a href="../en/Nvidia-xrun.html" title="Nvidia-xrun">nvidia-xrun</a> or <a href="../en/NVIDIA_Optimus.html#Using_optimus-manager" title="NVIDIA Optimus">optimus-manager</a>.
</p>
<h3><span class="mw-headline" id="No_display">No display</span></h3>
<p>If your virtual machine is not displaying anything when using RAMFB display, try setting the following additional options to the existing &lt;qemu:commandline&gt; tag:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ virsh edit <i>vmname</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
  &lt;qemu:commandline&gt;
    &lt;qemu:arg value="-set"/&gt;
    &lt;qemu:arg value="device.hostdev0.display=on"/&gt;
  &lt;/qemu:commandline&gt;
...</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> As of QEMU 8.1.0, qemu-ui-gtk with OpenGL <a rel="nofollow" class="external text" href="https://gitlab.com/qemu-project/qemu/-/issues/1891">is reported to be broken</a> for GVT-g, resulting in a black guest display after guest driver initialization and the message <code>qemu: eglCreateImageKHR failed</code> being printed to the terminal if running <i>qemu</i> directly (without libvirt). <a href="../en/Downgrading_packages.html" class="mw-redirect" title="Downgrade">Downgrade</a> to 8.0.4 for a temporary fix.</div>
<h3><span class="mw-headline" id="Garbled_graphics">Garbled graphics</span></h3>
<p>If your virtual machine is displaying artifacts when the mouse enters the virtual machine screen, the following <a rel="nofollow" class="external text" href="https://github.com/intel/gvt-linux/issues/152#issuecomment-637790127">workaround</a> might work.
</p>
<p>First modify the XML schema as shown on <a href="#libvirt_2">#libvirt 2</a>.
</p>
<p>Then, insert this right above the closing &lt;/domain&gt; tag, taking care to add to the existing &lt;qemu:commandline&gt; tag, if existing:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ virsh edit <i>vmname</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
  &lt;qemu:commandline&gt;
    &lt;qemu:env name="MESA_LOADER_DRIVER_OVERRIDE" value="i965"/&gt;
  &lt;/qemu:commandline&gt;
...</pre>
<h3><span class="mw-headline" id="Host_hanging_when_trying_to_suspend">Host hanging when trying to suspend</span></h3>
<p>After creating a GVT-g virtual GPU, host may hang when trying to suspend. See <a rel="nofollow" class="external text" href="https://github.com/intel/gvt-linux/issues/156">github</a> to trace this bug.
</p>
<p>A workaround is to remove the created GVT-g virtual GPUs before suspend and recreate the GVT-g virtual GPUs after waking from suspend. You can install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/gvtg_vgpu-git/">gvtg_vgpu-git</a></span><sup><small>AUR</small></sup> package to automatically do this for you.
</p>
<h3><span class="mw-headline" id="Changing_the_display_resolution_of_virtual_GPU">Changing the display resolution of virtual GPU</span></h3>
<p>The display resolution of vGPU, by default, is the maximum resolution the vGPU is capable of. The display content will be scaled to this resolution by vGPU regardless of what resolution is set by guest OS. This would produce bad quality pictures in the viewer.
</p>
<p>To change the display resolution, append <code>xres</code> and <code>yres</code> configuration into the <code>&lt;qemu:override&gt;</code> element:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ virsh edit <i>vmname</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
  &lt;qemu:override&gt;
    &lt;qemu:device alias="hostdev0"&gt;
      &lt;qemu:frontend&gt;
        ...
        &lt;qemu:property name="xres" type="unsigned" value="800"/&gt;
        &lt;qemu:property name="yres" type="unsigned" value="600"/&gt;
        ...
      &lt;/qemu:frontend&gt;
    &lt;/qemu:device&gt;
  &lt;/qemu:override&gt;
...</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://github.com/intel/gvt-linux/wiki/GVTg_Setup_Guide">Official GVT-g Setup Guide</a></li>
<li>
<a rel="nofollow" class="external text" href="https://github.com/intel/gvt-linux/wiki/Dma_Buf_User_Guide">Official GVT-g DMA-BUF  User Guide</a>.</li>
<li><a rel="nofollow" class="external text" href="https://www.reddit.com/r/VFIO/comments/8h352p/guide_running_windows_via_qemukvm_and_intel_gvtg/">Running Windows via QEMU/KVM and Intel GVT-g</a></li>
<li><a rel="nofollow" class="external text" href="https://blog.bepbep.co/gvt/">Blog post about using GVT</a></li>
<li><a rel="nofollow" class="external text" href="https://libvirt.org/drvqemu.html">libvirt's QEMU driver specific configuration documents</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Virtualization.html" title="Category:Virtualization">Virtualization</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Intel_GVT-g&amp;oldid=812644">https://wiki.archlinux.org/index.php?title=Intel_GVT-g&amp;oldid=812644</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 20 July 2024, at 00:57.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
