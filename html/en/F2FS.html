<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>F2FS - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-F2FS rootpage-F2FS skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Known_issues" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Known_issues">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Known issues</div>
		</a>
		
			<button aria-controls="toc-Known_issues-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Known issues subsection</span>
			</button>
		
		<ul id="toc-Known_issues-sublist" class="vector-toc-list">
			<li id="toc-fsck_failures" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#fsck_failures">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>fsck failures</div>
			</a>
			
			<ul id="toc-fsck_failures-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Long_running_fsck_delays_boot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Long_running_fsck_delays_boot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Long running fsck delays boot</div>
			</a>
			
			<ul id="toc-Long_running_fsck_delays_boot-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-GRUB_support" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#GRUB_support">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>GRUB support</div>
			</a>
			
			<ul id="toc-GRUB_support-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Cannot_set_file_attributes_for_'/var/log/journal'" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Cannot_set_file_attributes_for_'/var/log/journal'">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.4</span>Cannot set file attributes for '/var/log/journal'</div>
			</a>
			
			<ul id="toc-Cannot_set_file_attributes_for_'/var/log/journal'-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Creating_a_F2FS_file_system" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Creating_a_F2FS_file_system">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Creating a F2FS file system</div>
		</a>
		
			<button aria-controls="toc-Creating_a_F2FS_file_system-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Creating a F2FS file system subsection</span>
			</button>
		
		<ul id="toc-Creating_a_F2FS_file_system-sublist" class="vector-toc-list">
			<li id="toc-Compression" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Compression">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Compression</div>
			</a>
			
			<ul id="toc-Compression-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-File-based_encryption_support" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#File-based_encryption_support">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>File-based encryption support</div>
			</a>
			
			<ul id="toc-File-based_encryption_support-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Mounting_a_F2FS_file_system" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Mounting_a_F2FS_file_system">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Mounting a F2FS file system</div>
		</a>
		
			<button aria-controls="toc-Mounting_a_F2FS_file_system-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Mounting a F2FS file system subsection</span>
			</button>
		
		<ul id="toc-Mounting_a_F2FS_file_system-sublist" class="vector-toc-list">
			<li id="toc-Recommended_mount_options" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Recommended_mount_options">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Recommended mount options</div>
			</a>
			
			<ul id="toc-Recommended_mount_options-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Implementation_of_discard" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Implementation_of_discard">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Implementation of discard</div>
			</a>
			
			<ul id="toc-Implementation_of_discard-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Checking_and_repair" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Checking_and_repair">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Checking and repair</div>
		</a>
		
		<ul id="toc-Checking_and_repair-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Grow_an_F2FS_file_system" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Grow_an_F2FS_file_system">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Grow an F2FS file system</div>
		</a>
		
		<ul id="toc-Grow_an_F2FS_file_system-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Remounting_impossible_with_some_options" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Remounting_impossible_with_some_options">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>Remounting impossible with some options</div>
			</a>
			
			<ul id="toc-Remounting_impossible_with_some_options-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">F2FS</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/F2FS" title="F2FS – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ko mw-list-item"><a href="../ko/F2FS.html" title="F2FS – 한국어" lang="ko" hreflang="ko" class="interlanguage-link-target"><span>한국어</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/F2FS" title="F2FS – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/File_systems.html" title="File systems">File systems</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/F2FS" class="extiw" title="wikipedia:F2FS">F2FS</a> (Flash-Friendly File System) is a file system intended for NAND-based flash memory equipped with Flash Translation Layer. Unlike JFFS or UBIFS it relies on FTL to handle write distribution. It is supported from kernel 3.8 onwards.
</p>
<p>An FTL is found in all flash memory with a SCSI/SATA/PCIe/NVMe interface <a rel="nofollow" class="external autonumber" href="https://accelazh.github.io/ssd/A-Summary-On-SSD-And-FTL">[1]</a>, opposed to bare NAND Flash and SmartMediaCards <a rel="nofollow" class="external autonumber" href="http://www.linux-mtd.infradead.org/archive/tech/nand.html">[2]</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The data contained on F2FS partitions can become unusable if the kernel version on the running machine is <i>older</i> than the kernel version used to create the partition.  For example, this limitation can manifest if the F2FS partition was created on a mainline kernel provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> yet the system has a need to downgrade to an older series of kernels provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-lts">linux-lts</a></span>.  See <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/69363">FS#69363</a>.</div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> What advantages f2fs has over other fs, such as ext4? Is it recommended for being used inside lvm? (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:F2FS.html">Talk:F2FS</a>)</div>
</div>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Known_issues">Known issues</span></h2>
<h3><span class="mw-headline" id="fsck_failures">fsck failures</span></h3>
<p>F2FS has a weak fsck that can lead to data loss in case of a sudden power loss <a rel="nofollow" class="external autonumber" href="https://www.usenix.org/system/files/atc19-jaffer.pdf">[3]</a><a rel="nofollow" class="external autonumber" href="https://web.archive.org/web/20200925120546/https://archived.forum.manjaro.org/t/record-fsync-data-failed-on-f2fs-file-system-how-to-fix-foregt-the-help-i-reinstalled-its-just-easier/121051">[4]</a>.
</p>
<p>If power losses are frequent, consider an alternative <a href="../en/File_systems.html" class="mw-redirect" title="File system">file system</a>.
</p>
<h3><span class="mw-headline" id="Long_running_fsck_delays_boot">Long running fsck delays boot</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> The <a rel="nofollow" class="external text" href="https://git.kernel.org/pub/scm/linux/kernel/git/jaegeuk/f2fs-tools.git/commit/?id=0d0158cf23c50d130c3ce3b7b024868a029ab60e">commit</a> is in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=f2fs-tools">f2fs-tools</a></span> 1.14.0. What is the status of the issue now? (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:F2FS.html">Talk:F2FS</a>)</div>
</div>
<p>If the kernel version has changed between boots, the <i>fsck.f2fs</i> utility will perform a full file system check which will take longer to finish<a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=245702">[5]</a>.
</p>
<p>This may be mitigated in the future thanks to a recent commit <a rel="nofollow" class="external autonumber" href="https://lore.kernel.org/linux-f2fs-devel/20200619184346.56536-1-jaegeuk@kernel.org/">[6]</a>.
</p>
<h3><span class="mw-headline" id="GRUB_support">GRUB support</span></h3>
<p>While GRUB supports F2FS since version 2.0.4, it cannot correctly read its boot files from an F2FS partition that was created with the <code>extra_attr</code> flag enabled (for more details, see <a href="../en/GRUB.html#Unsupported_file_systems" title="GRUB">GRUB#Unsupported file systems</a>).
</p>
<h3>
<span id="Cannot_set_file_attributes_for_.27.2Fvar.2Flog.2Fjournal.27"></span><span class="mw-headline" id="Cannot_set_file_attributes_for_'/var/log/journal'">Cannot set file attributes for '/var/log/journal'</span>
</h3>
<p>If the error: 
</p>
<pre>Cannot set file attributes for '/var/log/journal', maybe due to incompatibility in specified attributes, previous=0x10001000, current=0x10001000, expected=0x10801000, ignoring.
</pre>
<p>is present in your <a href="../en/Systemd/Journal.html" class="mw-redirect" title="Journal">journal</a>, it can be <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/26318">safely ignored</a>: it is due to <a href="../en/Systemd.html#systemd-tmpfiles_-_temporary_files" class="mw-redirect" title="Systemd-tmpfiles">systemd-tmpfiles</a> trying to use a file system feature that is not supported by F2FS.
</p>
<h2><span class="mw-headline" id="Creating_a_F2FS_file_system">Creating a F2FS file system</span></h2>
<p>This article assumes the device has <a href="../en/Partitioning.html" class="mw-redirect" title="Partitions">partitions</a> already setup.  <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=f2fs-tools">f2fs-tools</a></span>.  Use <code>mkfs.f2fs</code> to format the target partition referred to as <code><i>/dev/sdxY</i></code>:
</p>
<pre># mkfs.f2fs -l mylabel -i -O extra_attr,inode_checksum,sb_checksum <i>/dev/sdxY</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>The <code>-i</code> option is included to allow <a rel="nofollow" class="external text" href="https://lore.kernel.org/all/CAF_dkJB%3d2PAqes+41xAi74Z3X0dSjQzCd9eMwDjpKmLD9PBq6A@mail.gmail.com/T/">more space for inodes</a>.</li>
<li>
<code>extra_attr</code>, <code>inode_checksum</code>, and <code>sb_checksum</code> are options which help <i>fsck.f2fs</i> to detect and to fix some types of filesystem corruption. See <span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.f2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.f2fs.8">mkfs.f2fs(8)</a></span> for all available options.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Compression">Compression</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Unlike other filesystems with inline compression, f2fs compression does not expose additional freespace by default and instead reserves the same number of blocks regardless of whether compression is enabled or not. The primary goal is reducing writes to extend flash lifetime, and potentially, <a rel="nofollow" class="external text" href="https://lz4.github.io/lz4/">a small increase in performance</a>. See <a rel="nofollow" class="external text" href="https://docs.kernel.org/filesystems/f2fs.html#compression-implementation">Compression Implementation</a> in the kernel docs. <code>F2FS_IOC_RELEASE_COMPRESS_BLOCKS</code> can be used to expose unused space on a per-file basis, but it makes the file immutable in the process.</div>
<p>To use compression, include the <code>compression</code> option. Example:
</p>
<pre># mkfs.f2fs -l mylabel -O extra_attr,inode_checksum,sb_checksum,<b>compression</b> <i>/dev/sdxY</i>
</pre>
<p>When mounting the filesystem, specify <code>compress_algorithm=(lzo|lz4|zstd|lzo-rle)</code>. Using <code>compress_extension=txt</code> will cause all txt files to be compressed by default.
</p>
<p>In order to tell F2FS to compress a file or a directory, use :
</p>
<pre>$ chattr -R +c [FOLDER]
</pre>
<h3><span class="mw-headline" id="File-based_encryption_support">File-based encryption support</span></h3>
<p>Since Linux 4.2, F2FS natively supports file encryption.  Encryption is applied at the directory level, and different directories can use different encryption keys.  This is different from both <a href="../en/Dm-crypt.html" title="Dm-crypt">dm-crypt</a>, which is block-device level encryption, and from <a href="../en/ECryptfs.html" title="ECryptfs">eCryptfs</a>, which is a stacked cryptographic filesystem.  To use F2FS's native encryption support, see the <a href="../en/Fscrypt.html" title="Fscrypt">fscrypt</a> article.  Create the file system with
</p>
<pre> # mkfs.f2fs -l mylabel -O extra_attr,inode_checksum,sb_checksum,<b>encrypt</b> <i>/dev/sdxY</i>
</pre>
<p>or add encryption capability at a later time with <code>fsck.f2fs -O encrypt /dev/sdxY</code>.
</p>
<h2><span class="mw-headline" id="Mounting_a_F2FS_file_system">Mounting a F2FS file system</span></h2>
<p>The file system can then be mounted manually or via other mechanisms:
</p>
<pre># mount /dev/sdxY /mnt/foo
</pre>
<h3><span class="mw-headline" id="Recommended_mount_options">Recommended mount options</span></h3>
<p>Since F2FS is designed to be used on flash devices, compression is a good idea. You have to enable it at <code>mkfs.f2fs</code> time.
A few mount options can be used to improve things slightly.
</p>
<pre># mount -o compress_algorithm=zstd:6,compress_chksum,atgc,gc_merge,lazytime /dev/sd<i>xY</i> /mnt/<i>mountpoint</i>
</pre>
<ul>
<li>
<code>compress_algorithm=zstd:6</code> tells F2FS to use <a href="https://en.wikipedia.org/wiki/Zstandard" class="extiw" title="w:Zstandard">zstd</a> for compression at level 6, which should give pretty good compression ratio.</li>
<li>
<code>compress_chksum</code> tells the filesystem to verify compressed blocks with a checksum (to avoid corruption)</li>
<li>
<code>atgc,gc_merge</code> Enable better garbage collector, and enable some foreground garbage collections to be asynchronous.</li>
</ul>
<dl><dd><div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> See <a href="#Remounting_impossible_with_some_options">#Remounting impossible with some options</a>.</div></dd></dl>
<ul><li>
<code>lazytime</code> Do not synchronously update access or modification times. Improves IO performance and flash durability.</li></ul>
<h3><span class="mw-headline" id="Implementation_of_discard">Implementation of discard</span></h3>
<p>By default, F2FS is mounted using a hybrid TRIM mode which behaves as <a href="../en/Solid_state_drive.html#Continuous_TRIM" title="Solid state drive">continuous TRIM</a>.  This implementation creates asynchronous discard threads to alleviate long discarding latency among RW IOs.  It keeps candidates in memory, and the thread issues them in idle time <a rel="nofollow" class="external autonumber" href="https://sourceforge.net/p/linux-f2fs/mailman/message/36957687">[7]</a>.  As a result of this, users wanting <a href="../en/Solid_state_drive.html#Periodic_TRIM" title="Solid state drive">periodic TRIM</a> will need to implicitly set the <code>nodiscard</code> mount option in <code>/etc/fstab</code> or pass it to <a href="../en/File_systems.html#Mount_a_file_system" class="mw-redirect" title="Mount">mount</a> if mounting manually.
</p>
<h2><span class="mw-headline" id="Checking_and_repair">Checking and repair</span></h2>
<p>Checking and repairs to F2FS file systems are accomplished with <code>fsck.f2fs</code> provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=f2fs-tools">f2fs-tools</a></span>. To check a file system, execute
</p>
<pre># fsck.f2fs <i>/dev/sdxY</i>
</pre>
<p>Depending on the result, see <span class="plainlinks archwiki-template-man" title="$ man 8 fsck.f2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/fsck.f2fs.8">fsck.f2fs(8)</a></span> for available switches to repair inconsistencies. For example:
</p>
<pre># fsck.f2fs -f <i>/dev/sdxY</i>
</pre>
<h2><span class="mw-headline" id="Grow_an_F2FS_file_system">Grow an F2FS file system</span></h2>
<p>When the filesystem is unmounted, it can be grown if the partition is expanded. <a rel="nofollow" class="external text" href="https://lore.kernel.org/linux-f2fs-devel/1461630518-16944-1-git-send-email-jaegeuk@kernel.org/">Shrinking is not currently supported</a>.
</p>
<p>First use a <a href="../en/Partitioning.html#Partitioning_tools" title="Partitioning">partition tool</a> to resize the partition: for example, suppose the output of the <code>print</code> command in the <code>parted</code> console is the following:
</p>
<pre>Number  Start   End     Size        File system     Name                  Flag
 1      1049kB  106MB   105MB       fat32           EFI system partition  boot, esp
 2      106MB   11,0GB  10,9GB      ext4
 3      11,0GB  12,3GB  1322MB      f2fs
 4      31,0GB  31,3GB  261MB       ext4
</pre>
<p>To resize the <code>f2fs</code> partition to occupy all the space up to the fourth one, just give <code>resizepart 3 31GB</code> and <code>exit</code>. Now expand the filesystem to fill the new partition using:
</p>
<pre># resize.f2fs <i>/dev/sdxY</i>
</pre>
<p>where <code><i>/dev/sdxY</i></code> is the target F2FS volume to grow. See <span class="plainlinks archwiki-template-man" title="$ man 8 resize.f2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/resize.f2fs.8">resize.f2fs(8)</a></span> for supported options.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If using GPT, the partition's GUID (seen in <code>/dev/disk/by-partuuid/</code>) might change, but the filesystem UUID (seen in <code>/dev/disk/by-uuid/</code>) should stay the same.</div>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Remounting_impossible_with_some_options">Remounting impossible with some options</span></h3>
<p>As alluded to in <a href="../en/Fsck.html#Boot_time_checking" title="Fsck">Fsck#Boot time checking</a>, the kernel keeps file systems in a read-only state by default, and it is either explicitly needed to pass the <code>rw</code> <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> or have systemd remounting the filesystems as read-write with the <code>systemd-remount-fs.service</code>. 
</p>
<p>When remounting the file system from a read-only state to a read-write state, the <code>mount -o remount,... /</code> steps can fail for multiple reasons, which will either leave the root file system read-only or make the system unable to boot with the error message: 
</p>
<pre>Failed to start Remount Root and Kernel File Systems.
</pre>
<p>If the <code>atgc</code> option is specified in the fstab file but has not been passed as a kernel parameter, the F2FS kernel module will not permit re-mounting with an added or cleared <code>atgc</code> option<a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/22982">[8]</a><a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/26763">[9]</a>, either:
</p>
<ul>
<li>add the <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> <code>rootflags=atgc</code> to your boot loader configuration,</li>
<li>add the <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> <code>rw</code> to your boot loader configuration,</li>
<li>remove the <code>atgc</code> mount option from the fstab.</li>
</ul>
<p>Since <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> 6.2, a <a rel="nofollow" class="external text" href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=967eaad1fed5f6335ea97a47d45214744dc57925">check</a> is made in the kernel to disable <code>flush_merge</code> when the file system is read-only, but it is the state of the file system before remounting that is checked. As explained in <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/77596">FS#77596</a>, either: 
</p>
<ul>
<li>add the <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> <code>rw</code> to your boot loader configuration,</li>
<li>remove the <code>flush_merge</code> mount option from the fstab.</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:File_systems.html" title="Category:File systems">File systems</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=F2FS&amp;oldid=812756">https://wiki.archlinux.org/index.php?title=F2FS&amp;oldid=812756</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 22 July 2024, at 08:13.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
