<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Migrating between architectures - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Migrating_between_architectures rootpage-Migrating_between_architectures skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-General_preparation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#General_preparation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>General preparation</div>
		</a>
		
			<button aria-controls="toc-General_preparation-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle General preparation subsection</span>
			</button>
		
		<ul id="toc-General_preparation-sublist" class="vector-toc-list">
			<li id="toc-Confirm_64-bit_architecture" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Confirm_64-bit_architecture">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Confirm 64-bit architecture</div>
			</a>
			
			<ul id="toc-Confirm_64-bit_architecture-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Disk_space" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Disk_space">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Disk space</div>
			</a>
			
			<ul id="toc-Disk_space-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Power_supply" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Power_supply">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Power supply</div>
			</a>
			
			<ul id="toc-Power_supply-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Fallback_packages" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Fallback_packages">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.4</span>Fallback packages</div>
			</a>
			
			<ul id="toc-Fallback_packages-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Method_1:_using_the_Arch_LiveCD" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Method_1:_using_the_Arch_LiveCD">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Method 1: using the Arch LiveCD</div>
		</a>
		
		<ul id="toc-Method_1:_using_the_Arch_LiveCD-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Method_2:_from_a_running_system" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Method_2:_from_a_running_system">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Method 2: from a running system</div>
		</a>
		
			<button aria-controls="toc-Method_2:_from_a_running_system-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Method 2: from a running system subsection</span>
			</button>
		
		<ul id="toc-Method_2:_from_a_running_system-sublist" class="vector-toc-list">
			<li id="toc-Package_preparation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Package_preparation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Package preparation</div>
			</a>
			
			<ul id="toc-Package_preparation-sublist" class="vector-toc-list">
				<li id="toc-Cache_old_packages" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Cache_old_packages">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.1</span>Cache old packages</div>
			</a>
			
			<ul id="toc-Cache_old_packages-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Install_busybox" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Install_busybox">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.2</span>Install busybox</div>
			</a>
			
			<ul id="toc-Install_busybox-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Change_Pacman_architecture" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Change_Pacman_architecture">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.3</span>Change Pacman architecture</div>
			</a>
			
			<ul id="toc-Change_Pacman_architecture-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Download_new_packages" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Download_new_packages">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4</span>Download new packages</div>
			</a>
			
			<ul id="toc-Download_new_packages-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Package_installation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Package_installation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Package installation</div>
			</a>
			
			<ul id="toc-Package_installation-sublist" class="vector-toc-list">
				<li id="toc-Install_kernel_(64-bit)" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Install_kernel_(64-bit)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.1</span>Install kernel (64-bit)</div>
			</a>
			
			<ul id="toc-Install_kernel_(64-bit)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Install_lib32-glibc" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Install_lib32-glibc">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.2</span>Install lib32-glibc</div>
			</a>
			
			<ul id="toc-Install_lib32-glibc-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Reboot" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Reboot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.3</span>Reboot</div>
			</a>
			
			<ul id="toc-Reboot-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Switch_to_Console_Terminal" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Switch_to_Console_Terminal">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.4</span>Switch to Console Terminal</div>
			</a>
			
			<ul id="toc-Switch_to_Console_Terminal-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Install_Pacman" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Install_Pacman">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.5</span>Install Pacman</div>
			</a>
			
			<ul id="toc-Install_Pacman-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Install_remaining_packages" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Install_remaining_packages">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.6</span>Install remaining packages</div>
			</a>
			
			<ul id="toc-Install_remaining_packages-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Cleanup" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Cleanup">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Cleanup</div>
		</a>
		
			<button aria-controls="toc-Cleanup-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Cleanup subsection</span>
			</button>
		
		<ul id="toc-Cleanup-sublist" class="vector-toc-list">
			<li id="toc-Makepkg_compiler_flags" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Makepkg_compiler_flags">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Makepkg compiler flags</div>
			</a>
			
			<ul id="toc-Makepkg_compiler_flags-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Busybox" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Busybox">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Busybox</div>
			</a>
			
			<ul id="toc-Busybox-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Lib32-glibc" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Lib32-glibc">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Lib32-glibc</div>
			</a>
			
			<ul id="toc-Lib32-glibc-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Migrating_from_old_system_2017_and_before" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Migrating_from_old_system_2017_and_before">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Migrating from old system 2017 and before</div>
			</a>
			
			<ul id="toc-Migrating_from_old_system_2017_and_before-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-KDE_does_not_start_after_switching_from_32-bit_to_64-bit" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#KDE_does_not_start_after_switching_from_32-bit_to_64-bit">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>KDE does not start after switching from 32-bit to 64-bit</div>
			</a>
			
			<ul id="toc-KDE_does_not_start_after_switching_from_32-bit_to_64-bit-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Mutt_issues_with_cache_enabled" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Mutt_issues_with_cache_enabled">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5</span>Mutt issues with cache enabled</div>
			</a>
			
			<ul id="toc-Mutt_issues_with_cache_enabled-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Migrating between architectures</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/%E5%86%8D%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%9B%E3%81%9A%E3%81%AB%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3%E3%82%92%E7%A7%BB%E8%A1%8C" title="再インストールせずにアーキテクチャを移行 – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Migrating_between_architectures.html" title="Migrating between architectures – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Migrating_between_architectures" title="Migrating between architectures – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p>This page documents two potential methods of migrating installed systems from i686 (32-bit) to x86_64 (64-bit) architectures. The methods avoid a <i>complete</i> reinstall (i.e. wiping the hard drive). One method uses a liveCD, the other modifies the system from within.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Technically this process still involves "reinstalling" since every package on the system must be replaced. These methods simply attempt to preserve as much as they can from your existing system.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Unless explicitly stated, all these methods are <b>untested</b> and may irreparably damage your system. Continue at your own risk.</div>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="General_preparation">General preparation</span></h2>
<h3><span class="mw-headline" id="Confirm_64-bit_architecture">Confirm 64-bit architecture</span></h3>
<p>In order to run 64-bit software, you must have a 64-bit capable CPU.  Most modern CPUs are capable of running 64-bit software. You may check your CPU with the following command:
</p>
<pre>grep --color -w lm /proc/cpuinfo
</pre>
<p>For CPUs that support x86_64, this will return the <code>lm</code> flag (“long mode”) highlighted. Beware that <i>lahf_lm</i> is a different flag and does not indicate 64-bit capability itself.
</p>
<h3><span class="mw-headline" id="Disk_space">Disk space</span></h3>
<p>You should be prepared for <code>/var/cache/pacman/pkg</code> to grow approximately twice its current size during the migration. This is assumes only packages that are currently installed are in the cache, as if “pacman -Sc” (clean) was recently run. The disk space increase is due to duplication between the i686 and x86_64 versions of each package.
</p>
<p>If you have not enough disk, please use <a href="../en/Parted.html" class="mw-redirect" title="GParted">GParted</a> to resize the relevant partition, or mount another partition to <code>/var/cache/pacman</code>.
</p>
<p>Please do not remove packages of the old architecture from the cache until the system is fully operating in the new architecture. Removing the packages too early may leave you unable to fall back and revert changes.
</p>
<h3><span class="mw-headline" id="Power_supply">Power supply</span></h3>
<p>The migration may take a substantial amount of time, and it would be inconvenient to interrupt the process. You should plan on at least an hour, depending on the number and size of your installed packages and internet connection speed (although you can download everything before starting the critical part). Please make sure you are connected to a stable power source, preferably with some sort of failover or battery backup.
</p>
<h3><span class="mw-headline" id="Fallback_packages">Fallback packages</span></h3>
<p>If the migration fails halfway through, there are packages that can help sort out the situation, but they should be installed before the main packages are migrated. More details about using them under <a href="#Troubleshooting">#Troubleshooting</a> below.
</p>
<p>One package is <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=busybox">busybox</a></span>, which can be used to revert changes. It is statically linked and does not depend on any libraries. The 32-bit (i686) version should be installed.
</p>
<p>Another package is <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lib32-glibc">lib32-glibc</a></span>, from the <a href="../en/Official_repositories.html#multilib" class="mw-redirect" title="Multilib">multilib</a> x86_64 repository.  It is probably only useful when migrating <i>away</i> from 32 bits; in any case you may safely skip this package.  You can use the package to run 32 bit programs by explicitly calling <code>/lib/ld-linux.so.2</code>.
</p>
<h2><span class="mw-headline" id="Method_1:_using_the_Arch_LiveCD">Method 1: using the Arch LiveCD</span></h2>
<ol>
<li>
<a rel="nofollow" class="external text" href="https://archlinux.org/download/">Download</a> and burn the latest Arch Linux ISO.</li>
<li>Boot the Arch LiveCD in x86_64 mode.</li>
<li>Configure your network on the LiveCD.</li>
<li>Mount your existing installation. For example: <code>mount /dev/sda1 /mnt</code>.</li>
<li>Edit the LiveCD <code>/etc/pacman.conf</code> repositories to match the existing <code>/mnt/etc/pacman.conf</code> repositories.</li>
<li>Use the following commands to update the local pacman database and clear the cache directory.</li>
</ol>
<pre> # pacman --root /mnt -Syy
 # pacman --root /mnt -Scc
</pre>
<dl><dd>6. You might first re-install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=base">base</a></span> group alone, then install any package that triggered an install error, identified using <code>pacman --root /mnt -Qo &lt;error file&gt;</code>.  Then repeat the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=base">base</a></span> group install, until it installs cleanly without errors.</dd></dl>
<pre> # pacman --root /mnt -S base
</pre>
<dl><dd>7. Use the following command to get a list of all your installed packages and then reinstall them.</dd></dl>
<pre> # pacman --root /mnt -Qnq | pacman --root /mnt -S -
</pre>
<dl><dd>8. You could run the command twice, because many packages fail to run their post-install scripts first time. This is due to sed, grep, perl, etc. being of the wrong architecture.  Or you can make note of any individual package-re-install that throws an error and then go back after the upgrade completes to re-install just those packages.</dd></dl>
<dl><dd>Also, if you see an error about not enough disk space, you can filter the package list alphabetically and upgrade in stages, with for instance <code>...| grep '^[a-k]' |...</code>, then perhaps <code>'^l'</code> and <code>'^[m-z]'</code>.  In this case you would also have to run <code>pacman --root /mnt -Scc</code> after each install stage to free disk space. Or since all packages are downloaded in the Live CD ramfs, you can also mount a partition or make a symlink pointing to <code>/var/cache/pacman/pkg</code> (e.g. <code>ln -s /mnt/var/cache/pacman/pkg /var/cache/pacman/pkg</code>).</dd></dl>
<dl><dd>9. Finally, run</dd></dl>
<pre> # arch-chroot /mnt 
 # mkinitcpio -p linux
</pre>
<dl><dd>10. Also, see if your boot loader needs to be migrated.  For instance:</dd></dl>
<pre> # grub-install --recheck /dev/sda
</pre>
<dl><dd>11. After rebooting to your new 64-bit system, edit and then move <code>/etc/makepkg.conf.pacnew</code> to <code>/etc/makepkg.conf</code>, to migrate the CPU architecture. Then rebuild the "foreign" packages, which will include packages from the <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>.</dd></dl>
<dl><dd>You might first want to remove certain orphaned foreign packages before trying to rebuild them.  Run this command to find out what 32-bit binaries you still have and reinstall them:</dd></dl>
<pre> $ LC_ALL=C pacman -Qo `find /usr/bin -type f -exec bash -c 'file "{}" | grep 32-bit' \; | cut -d':' -f1` | cut -d' ' -f5 | sort | uniq | tee list
</pre>
<h2><span class="mw-headline" id="Method_2:_from_a_running_system">Method 2: from a running system</span></h2>
<p>Ensure that your system is fully updated and functioning before proceeding.
</p>
<pre># pacman -Syu
</pre>
<h3><span class="mw-headline" id="Package_preparation">Package preparation</span></h3>
<h4><span class="mw-headline" id="Cache_old_packages">Cache old packages</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you have any packages installed from the <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a> or third-party repositories without new architecture availability, pacman will let you know it cannot find a suitable replacement.  Make a list of these packages so you may re-install them after the update process and then remove them using <code>pacman -Rsn package_name</code>.</div>
<p>If you do not have all your installed packages in your cache, download them (for the old architecture) for fallback purposes.
</p>
<pre># pacman -Qqn | pacman -Sw -
</pre>
<p>or use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/fakepkg/">fakepkg</a></span><sup><small>AUR</small></sup> package to generate them.
</p>
<h4><span class="mw-headline" id="Install_busybox">Install busybox</span></h4>
<p>If you are migrating from 32 bits to 64 bits, now is the time to install 32-bit <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=busybox">busybox</a></span>. Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=busybox">busybox</a></span> package.
</p>
<h4><span class="mw-headline" id="Change_Pacman_architecture">Change Pacman architecture</span></h4>
<p>Edit the <code>/etc/pacman.conf</code> file and change <i>Architecture</i> from <code>auto</code> to <code>x86_64</code>.
</p>
<p>Make sure the server lists in <code>/etc/pacman.conf</code> and <code>/etc/pacman.d/mirrorlist</code> use <code>$arch</code> instead of explicitly specifying <code>i686</code> or <code>x86_64</code>. Now force Pacman to synchronize with the new repositories:
</p>
<pre># pacman -Syy                     # force sync new architecture repositories
</pre>
<h4><span class="mw-headline" id="Download_new_packages">Download new packages</span></h4>
<p>Download the new architecture versions of all our currently installed packages:
</p>
<pre># pacman -Sw $(pacman -Qqn|sed '/^lib32-/ d')  # download new package versions
</pre>
<p>If migrating to 32 bits, install the 32-bit <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=busybox">busybox</a></span> fallback now that Pacman has been configured with the 32-bit architecture.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Do not install the <i>lib32-glibc</i> package now. After a <i>ldconfig</i>, when you install <i>linux</i>, the generated image will have libraries like <i>librt.so</i> in '<code>/usr/lib32</code>, where binaries during boot will not search, resulting in a boot failure.</div>
<h3><span class="mw-headline" id="Package_installation">Package installation</span></h3>
<h4>
<span id="Install_kernel_.2864-bit.29"></span><span class="mw-headline" id="Install_kernel_(64-bit)">Install kernel (64-bit)</span>
</h4>
<p>Upgrading the kernel to 64 bits (x86_64) is safe and straightforward: 32 bit and 64 bit applications run equally well under a 64-bit kernel.
</p>
<p>Install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> package.
</p>
<h4><span class="mw-headline" id="Install_lib32-glibc">Install lib32-glibc</span></h4>
<p>Install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lib32-glibc">lib32-glibc</a></span> fallback together with the 64-bit version of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=glibc">glibc</a></span>. You will need to add the <a href="../en/Official_repositories.html#multilib" class="mw-redirect" title="Multilib">multilib</a> repository in <code>/etc/pacman.conf</code> if you have not done so already.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If you do not install the 64-bit version of glibc at the same time as lib32-glibc, the lib32-glibc install will not be able to function. However, pacman will not warn you about this, as the 32-bit glibc package also satisfies the dependency.</div>
<h4><span class="mw-headline" id="Reboot">Reboot</span></h4>
<p>Verify that you are running the x86_64 architecture:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ uname -m</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">x86_64
</pre>
<h4><span class="mw-headline" id="Switch_to_Console_Terminal">Switch to Console Terminal</span></h4>
<p>Switch to a text-mode virtual console (e.g. Ctrl+Alt+F1) for the rest of the process, if possible.  If you receive an error trying to use the 1st console, use the 2nd one (Ctrl-Alt+F2) instead. Pseudo-terminals like SSH should work, but direct access is recommended as a precaution.  There will be several packages removed and replaced during the update process that may cause X11 desktops to become unstable and leave your system in an unbootable state.
</p>
<h4><span class="mw-headline" id="Install_Pacman">Install Pacman</span></h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> 
<ul>
<li>Once you start updating pacman and its dependencies it must not be interrupted! Pacman and all of its dependencies must be installed at the same time in a single command line.</li>
<li>Immediately following this command only Busybox, Bash and pacman will be executable until the other packages are migrated below. If you are using sudo, you should obtain root previlige prior to next command</li>
</ul>
</div>
<p>Install the pactree command from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman-contrib">pacman-contrib</a></span>, then use pactree to install Pacman and all its dependencies:
</p>
<pre># pactree -l pacman | pacman -S -
</pre>
<p>Errors may be printed but they will not cause a problem as long as pacman works.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> You must not reboot your system until the following commands have been completed. If you failed to do so, you should continue installing by <a href="../en/Chroot.html" title="Chroot">chrooting</a> from another linux environment (e.g. from live install medium)</div>
<h4><span class="mw-headline" id="Install_remaining_packages">Install remaining packages</span></h4>
<p>Install all of the previously downloaded replacements for the new architecture. (Go get a drink and make a sandwich; this could take a while.)
</p>
<pre># pacman -Qqn | pacman -S -
</pre>
<p>If some packages did not install correctly, you should now be able to reinstall them successfully; if you are lazy, you can just re-run the last command to reinstall everything.
</p>
<p>After this step the migration in either direction should be complete and it should be safe to reboot the computer.
</p>
<p>However, if you have any AUR packages on your system, you must reinstall all of them.  A list of those can be obtained by executing:
</p>
<pre>$ pacman -Qqm
</pre>
<h2><span class="mw-headline" id="Cleanup">Cleanup</span></h2>
<p>You are now free to remove <b>busybox</b> and <i>lib32-glibc</i>.
</p>
<h3><span class="mw-headline" id="Makepkg_compiler_flags">Makepkg compiler flags</span></h3>
<p>During the upgrade the new version of <code>/etc/makepkg.conf</code> may be stored as <code>/etc/makepkg.conf.pacnew</code>. If so, you will have to replace the old version or modify it in order to compile anything with <a href="../en/Makepkg.html" title="Makepkg">makepkg</a> in the future.
</p>
<pre># mv /etc/makepkg.conf /etc/makepkg.conf.backup &amp;&amp; mv /etc/makepkg.conf.pacnew /etc/makepkg.conf
</pre>
<p>It might also be a good idea to just get a list of "new" additions to <code>/etc</code>.  You can get a list with the following command:
</p>
<pre># find /etc/ -type f -name \*.pac\*
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<p>During the upgrade, when glibc is replaced by the new architecture version, old architecture versions of many programs will not run. If problems occur, you can solve them with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=busybox">busybox</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lib32-glibc">lib32-glibc</a></span>.
</p>
<h3><span class="mw-headline" id="Busybox">Busybox</span></h3>
<p>In Arch, Busybox is statically linked; it can run without any libraries. There are many commands available to you. For example, to extract an i686 version of Pacman from a cached package:
</p>
<pre># busybox tar xf /var/cache/pacman/pkg/pacman-3.3.2-1-i686.pkg.tar.gz -C &lt;some folder&gt;
</pre>
<h3><span class="mw-headline" id="Lib32-glibc">Lib32-glibc</span></h3>
<p>Example run 32 bit <code>/bin/ls</code>:
</p>
<pre># /lib/ld-linux.so.2 /bin/ls
</pre>
<h3><span class="mw-headline" id="Migrating_from_old_system_2017_and_before">Migrating from old system 2017 and before</span></h3>
<p>You might face issue with updating old 32-bit system since in 2017 Arch Linux dropped support for i686. To make that update safe you may want use <a href="../en/Arch_Linux_Archive.html" title="Arch Linux Archive">Arch Linux Archive</a>. I.e. fix repository snapshot, then update current system and then switch to 64-bit flavor of packages corresponding to <b>same version</b>.
</p>
<p>Note that you may need to downgrade required trust level in <code>pacman.conf</code> (like <code>PackageTrustAll</code> to include marginal trust) since not all GPG keys which were used to sign package are still valid. Though you may want to ensure that you use HTTPS to at least ensure that packages comes from <code>archlinux.org</code> domain.
</p>
<h3><span class="mw-headline" id="KDE_does_not_start_after_switching_from_32-bit_to_64-bit">KDE does not start after switching from 32-bit to 64-bit</span></h3>
<p>KDE will crash when starting after switching from 32-bit to 64-bit. The cause are some leftover cached files from the 32 bit KDE packages in /var/tmp To fix this remove all kdecache folders in with
</p>
<pre># rm -rf /var/tmp/kdecache-*
</pre>
<h3><span class="mw-headline" id="Mutt_issues_with_cache_enabled">Mutt issues with cache enabled</span></h3>
<p>If, after completion, you find that mutt hangs on opening mail folders, try renaming the cache directory. If this works, the renamed one can be deleted as mutt will have recreated a new one.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul><li><a href="../en/Migrate_installation_to_new_hardware.html" title="Migrate installation to new hardware">Migrate installation to new hardware</a></li></ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:System_administration.html" title="Category:System administration">System administration</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Migrating_between_architectures&amp;oldid=765326">https://wiki.archlinux.org/index.php?title=Migrating_between_architectures&amp;oldid=765326</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 27 January 2023, at 19:57.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
