<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-zebra-design-disabled vector-feature-custom-font-size-clientpref-disabled vector-feature-client-preferences-disabled vector-feature-typography-survey-disabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>S-nail - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.41.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-S-nail rootpage-S-nail skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-main-menu-container">
		</div>
	<input type="checkbox" id="vector-toc-collapsed-checkbox" class="vector-menu-checkbox">
			<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark vector-sticky-pinned-container">
				<div id="vector-toc-pinned-container" class="vector-pinned-container">
				<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Example_usage" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Example_usage">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Example usage</div>
		</a>
		
		<ul id="toc-Example_usage-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Configuration</div>
		</a>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Sending_mail_with_an_external_SMTP_server" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Sending_mail_with_an_external_SMTP_server">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Sending mail with an external SMTP server</div>
		</a>
		
		<ul id="toc-Sending_mail_with_an_external_SMTP_server-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Interactive_usage" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Interactive_usage">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Interactive usage</div>
		</a>
		
			<button aria-controls="toc-Interactive_usage-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Interactive usage subsection</span>
			</button>
		
		<ul id="toc-Interactive_usage-sublist" class="vector-toc-list">
			<li id="toc-Usage" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Usage">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Usage</div>
			</a>
			
			<ul id="toc-Usage-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Message_composition" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Message_composition">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Message composition</div>
			</a>
			
			<ul id="toc-Message_composition-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Using_S/MIME" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Using_S/MIME">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Using S/MIME</div>
		</a>
		
		<ul id="toc-Using_S/MIME-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Workaround_missing_OpenPGP_support" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Workaround_missing_OpenPGP_support">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Workaround missing OpenPGP support</div>
		</a>
		
		<ul id="toc-Workaround_missing_OpenPGP_support-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Using_an_IMAP_mailbox" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Using_an_IMAP_mailbox">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>Using an IMAP mailbox</div>
		</a>
		
		<ul id="toc-Using_an_IMAP_mailbox-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">9</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

				</div>
	</nav>
		
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<label id="vector-toc-collapsed-button" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet vector-button-flush-left cdx-button--icon-only" for="vector-toc-collapsed-checkbox" role="button" aria-controls="vector-toc" tabindex="0" title="Table of Contents">
						<span class="vector-icon mw-ui-icon-wikimedia-listBullet"></span>
						<span>Toggle the table of contents</span>
					</label>
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">S-nail</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/S-nail" title="S-nail – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<nav class="vector-page-tools-landmark vector-sticky-pinned-container" aria-label="Page tools">
						<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
			
						</div>
	</nav>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> Very verbose, lots of code, does not follow style guidelines. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:S-nail.html">Talk:S-nail</a>)</div>
</div>
<p>Arch Linux uses S-nail as its POSIX <code>mailx</code> incarnation. S-nail is <a href="../en/Default_applications.html" class="mw-redirect" title="MIME">MIME</a> capable and has extensions for line editing, S/MIME, SMTP, <a href="../en/UW_IMAP.html" title="UW IMAP">IMAP</a>, POP3, and more. Mailx is the <i>user side</i> of the Unix mail system, whereas the <i>system side</i> was traditionally taken by <a href="../en/Sendmail.html" title="Sendmail">sendmail</a>. S-nail can also send directly to external SMTP servers, so no local MTA is required.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=s-nail">s-nail</a></span> package.
</p>
<h2><span class="mw-headline" id="Example_usage">Example usage</span></h2>
<p>Because the systemwide configuration file (<code>/etc/mail.rc</code>) brings in some useful standards, sending mail over an installed local mail-transfer-agent (MTA), such as <a href="../en/Sendmail.html" title="Sendmail">sendmail</a> or <a href="../en/Postfix.html" title="Postfix">postfix</a>, can be as easy as follows:
</p>
<pre># echo 'Message body' | mailx --debug --subject='A subject' --attach=an_attachment.txt foo1@bar.example 'Foo2 &lt;foo2@bar.example&gt;'
</pre>
<p>Using the <code>-d</code>/<code>--debug</code> flag results in a sandbox dry-run. You can adjust the program which is used as a MTA by setting the variable <code>mta</code> (fine-tuning via <code>mta-arguments</code>, <code>mta-no-default-arguments</code>, <code>mta-argv0</code>).
</p>
<p>See the manual <span class="plainlinks archwiki-template-man" title="$ man 1 mailx"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mailx.1">mailx(1)</a></span>. In particular, see <span class="plainlinks archwiki-template-man" title="$ man 1 mailx"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mailx.1#On_sending_mail,_and_non_interactive_mode">mailx(1) § On sending mail, and non-interactive mode</a></span>:
</p>
<pre># &lt; /etc/passwd LC_ALL=C.UTF-8 mailx --debug -:/ --set=sendwait --set=ttycharset=utf8 --set=mta=/usr/bin/sendmail --subject='My password file!' -. 'Back &lt;side@book&gt;'
# echo Message was passed successfully: $?
</pre>
<p>By default message delivery is asynchronous, and mailx will exit as soon as the prepared message has been passed over to the delivery mechanism, stating only whether message preparation was successful (or not). If the <code>sendwait</code> option is set, however, the exit status of the started (builtin or not) MTA will be used as the message delivery "success" or "failure" status.
</p>
<p>The <code>-.</code>/<code>--end-options</code> command line option will forcefully terminate option processing and turn on message send mode.
</p>
<p>As shown in the previous example, commands can (and should) detach from environmental settings and configuration files via <code>LC_ALL=C.UTF-8</code>, <code>-:/</code>/<code>−−resource-files=/</code>, and use explicit <code>-S</code>/<code>--set</code> and <code>-X</code>/<code>--startup-cmd</code> command line flags to create their own reproducible setup.
</p>
<p>Sending messages to files and pipes, without an MTA intervention, is possible with the <code>expandaddr</code> option:
</p>
<pre># echo bla | mailx --set=expandaddr --subject=test ./mbox.mbox
# echo bla | mailx --set=expandaddr --subject=test '|cat &gt;&gt; ./mbox.mbox'
# echo bla | mailx --set=expandaddr --subject=test -
</pre>
<p><code>expandaddr</code> can be given a value and be used for address verification. The following example assumes <i>somefile.pdf</i> exists. As mentioned above, one should remove <code>-d</code>/<code>--debug</code> to avoid a dry run. It sets the <code>record</code> option to the file used to record all outgoing mail, so that we then can look into the generated message:
</p>
<pre># echo Body | \
&gt;   LC_ALL=C.UTF-8 mailx --debug -:/ --set=v15-compat --set=sendwait --set=ttycharset=utf8 \
&gt;     --set=from='Me &lt;me@home&gt;' \
&gt;     --set=expandaddr=fail,-all,+addr \
&gt;     --set=nosave --set=record=/tmp/out.mbox \
&gt;     --set=mimetypes-load-control \
&gt;     --startup-cmd='mimetype application/pdf pdf' \
&gt;     --attach=somefile.pdf --subject=Subject \
&gt;      -. '(foo2bar) &lt;foo2@bar.example&gt;' bob@hey.example
# mailx --read-only --file /tmp/out.mbox
</pre>
<p>The manual sections <span class="plainlinks archwiki-template-man" title="$ man 1 mailx"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mailx.1#A_starter">mailx(1) § A starter</a></span>, and <span class="plainlinks archwiki-template-man" title="$ man 1 mailx"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mailx.1#On_reading_mail,_and_interactive_mode">mailx(1) § On reading mail, and interactive mode</a></span> worth a glance when looking for more "quick shots".
</p>
<p>In cases when in the following <i>USER</i> and <i>PASS</i> are specified as part of an URL (and only then), they must become URL-percent-encoded: mailx offers the <code>urlcodec</code> command which does this for you:
</p>
<pre># printf 'urlcodec encode <i>USER</i> <i>PASS</i>\nx\n' | mailx -#
</pre>
<p><code>-#</code> is for <code>-#</code>/<code>--batch-mode</code>. printf as well as mailx are subject to your locale settings:
</p>
<pre># # In UTF-8:
# printf 'urlcodec encode SPAß\nx\n' | mailx -#
  SPA%C3%9F
# # In ISO-8859-1:
# printf 'urlc enc SPAß\nx\n' | mailx -#
  SPA%DF
</pre>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>Configuration files are the user-specific <code>$HOME/.mailrc</code> and the systemwide <code>/etc/mail.rc</code>, the latter of which is in the PKGBUILD's <a href="../en/Pacman/Pacnew_and_Pacsave.html#Package_backup_files" title="Pacman/Pacnew and Pacsave">backup array</a>, and hence will survive upgrades to s-nail. All the remaining examples in this article are based upon this configuration template, which simply sets some security and send mode basics:
</p>
<pre># All the examples require v15-compat!
set v15-compat

# Arch Linux-specific locations of certificates.
# Since these are subject to the Arch Linux update mechanism,
# use only those, do not try to load OpenSSL builtin ones.
# And use the TLS specific set: see "man 8 update-ca-trust"
#set ssl-ca-dir=/etc/ssl/certs
set ssl-ca-file=/etc/ssl/certs/ca-certificates.crt
set ssl-ca-no-defaults

# Do not use protocols older than TLS v1.2.
# Change this only when the remote server does not support it:
# maybe use ssl-protocol-HOST (or -USER@HOST) syntax to define
# such explicit exceptions, then, e.g.
#     ssl-protocol-USER@archlinux.org="-ALL,+TLSv1.2"
set ssl-protocol=-ALL,+TLSv1.2

# Explicitly define the list of ciphers, which may improve security,
# especially with protocols older than TLS v1.2.  See ciphers(1).
# This is an example: in reality it is possibly best to only use
# ssl-cipher-list-HOST (or -USER@HOST), as necessary, again..
set ssl-cipher-list=TLSv1.2:!aNULL:!eNULL:@STRENGTH
#set ssl-cipher-list="ALL:!aNULL:!eNULL:!MEDIUM:!LOW:!MD5:!RC4:!EXPORT"

# Request strict transport security checks
set ssl-verify=strict

# Essential setting: select allowed character sets
# (Have a look at the "Character sets" manual section)
set sendcharsets=utf-8,iso-8859-1

# A very kind option: when replying to a message, first try to
# use the same encoding that the original poster used herself!
set reply-in-same-charset
# When replying to or forwarding a message the comment and name
# parts of email addresses are removed unless this variable is set
set fullnames

# When sending messages, wait until the Mail-Transfer-Agent finishs.
set sendwait

# Only use builtin MIME types, no mime.types(5) files.
# That set is often sufficient, but look at the output of the
# `mimetype' command to ensure this is true for you, too
set mimetypes-load-control

# Default directory where we act in (relative to $HOME if not absolute)
set folder=mail
# A leading "+" (often) means: under folder
# record is used to save copies of sent messages, $DEAD is error storage
# inbox: system mailbox, by default /var/mail/$USER: <b>file %</b>
# $MBOX: secondary mailbox: <b>file &amp;</b>
set MBOX=+mbox.mbox record=+sent.mbox DEAD=+dead.mbox
set inbox=+system.mbox

# Define some shortcuts; now one may say, e.g., file mymbo
shortcut mymbo %:+mbox.mbox \
         myrec +sent.mbox

# This is optional, but you should get the big picture
# by reading the manual before you leave that off
set from="<i>Your Name &lt;youremail@domain&gt;</i>"

# Mailing-list specifics (manual: "Mailing lists"):
set followup-to followup-to-honour=ask-yes reply-to-honour=ask-yes
# And teach some non-subscribed / some subscribed lists, too
mlist @xyz-editor.xyz$ @xyzf.xyz$
mlsubscribe ^xfans@xfans.xyz$
</pre>
<h2><span class="mw-headline" id="Sending_mail_with_an_external_SMTP_server">Sending mail with an external SMTP server</span></h2>
<p>To send messages via the built-in SMTP (Simple Mail Transfer Protocol) client to an external SMTP server, several options have to be set or adjusted. Add the following as appropriate to the configuration as above, changing bold strings. Reading the manual section <span class="plainlinks archwiki-template-man" title="$ man 1 mailx"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mailx.1#On_URL_syntax_and_credential_lookup">mailx(1) § On URL syntax and credential lookup</a></span> is worthwhile.
</p>
<pre># It can be as easy as
# (Remember <b>USER</b> and <b>PASS</b> must be URL percent encoded)
set mta=smtp://<b>USER</b>:<b>PASS</b>@<b>HOST</b> \
    smtp-use-starttls

# It may be necessary to set <i>hostname</i> and/or <i>smtp-hostname</i>
# if the "SERVER" of <i>smtp</i> and "domain" of <i>from</i> do not match.
# Reading the "ON URL SYNTAX.." and <i>smtp</i> manual entries may be worthwhile
set mta=<b>(smtp[s]/submission)://[USER[:PASS]@]SERVER[:PORT]</b> \
    smtp-auth=<b>login[/plain]...</b> \
    smtp-use-starttls

# E.g. here is a real life example of a very huge free mail provider
# (Activate this account via <i>mailx -AXooglX</i> from the command line,
# or use the <i>? acc[ount] XooglX</i> command in interactive mode)
account XooglX {
   # Localize options, forget them when changing the account
   localopts yes
   # (The plain smtp:// proto is optional)
   set mta=smtp://<b>USER:PASS</b>@smtp.gmXil.com smtp-use-starttls
   set from="<b>Your Name &lt;youremail@domain&gt;</b>"
}

# And here is a pretty large one which does not allow sending mails
# if there is a domain name mismatch <i>on the SMTP protocol level</i>,
# which would bite us if the value of <i>from</i> does not match, e.g.,
# for people who have a sXXXXeforge project and want to speak
# with the mailing list under their project account (in <i>from</i>),
# still sending the message through their normal mail provider
account XandeX {
   localopts yes
   set mta=smtps://<b>USER:PASS</b>@smtp.yaXXex.ru:465 \
       hostname=yaXXex.com smtp-hostname=
   set from="<b>Your Name &lt;youremail@domain&gt;</b>"
}
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Enable two-step authentication in Gmail, and add an application specific password for S-nail, you will want to use that password rather than your regular Gmail password.</div>
<p>Note that, when storing passwords in <code>$HOME/.mailrc</code>, you should set appropriate <a href="../en/File_permissions_and_attributes.html" class="mw-redirect" title="Permissions">permissions</a> with <code>chmod 0600</code>. You can also set the <i>netrc-lookup</i> option and store user credentials in <code>$HOME/.netrc</code> (or <i>$NETRC</i>) instead; e.g., here is a real life example that sets up SMTP, POP3 as well as IMAP, storing all user credentials in there:
</p>
<pre>account XandeX {
   localopts yes
   set from="Your Name &lt;youremail@domain&gt;"
   wysh set netrc-lookup # netrc-pipe='gpg -qd ~/.netrc.gpg'
   set mta=smtps://smtp.yXXXXx.ru:465 \
       smtp-hostname= hostname=yXXXXx.com
   set pop3-keepalive=240
   shortcut pop pop3s://pop.yXXXXx.ru
   # Type <b>xp</b> to login to the POP3 account
   commandalias xp 'fi pop'
   set imap-keepalive=240
   shortcut imap imaps://imap.yXXXXx.ru
   # Type <b>xi</b> to login to the IMAP account
   commandalias xi 'fi imap'
 }
</pre>
<p>and, in <code>$HOME/.netrc</code>:
</p>
<pre>machine *.yXXXXx.ru login <b>USER</b> password <b>PASS</b>
</pre>
<p>In this case <b>USER</b> and <b>PASS</b> are clear text, not URL encoded. You can further diversify things and use encrypted password storage. To adjust the example accordingly, simply encrypt your <code>~/.netrc</code> file with OpenPGP and uncomment the <code>netrc-pipe</code> statement above.
The encrypted storage <code>~/.netrc.gpg</code> can be created like this:
</p>
<pre># gpg -e .netrc
# eval `gpg-agent --daemon --pinentry-program=/usr/bin/pinentry-curses --max-cache-ttl 99999 --default-cache-ttl 99999`
</pre>
<p>Test the configuration (use the <code>-d</code>/<code>--debug</code> command line option for a dry-run):
</p>
<pre># echo test-body | mailx --verbose --verbose --account=XandeX --subject=test-subject <b>some@where</b>
</pre>
<h2><span class="mw-headline" id="Interactive_usage">Interactive usage</span></h2>
<p>Interactive usage is referred to throughout the manual as "compose mode". <span class="plainlinks archwiki-template-man" title="$ man 1 mailx"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mailx.1#Compose_mode">mailx(1) § Compose mode</a></span>.
</p>
<p>Mailx has a wide-glyph aware command line editor with history capabilities and coloured message display support. Because it strives for POSIX standard compliance some settings have to be adjusted before using it interactively does not baffle all descriptions, however. Reading <span class="plainlinks archwiki-template-man" title="$ man 1 mailx"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mailx.1">mailx(1)</a></span> is unavoidable, but add, at a minimum, the following on top of the example configuration:
</p>
<pre># (The global configuration /etc/mail.rc provides some commented basics;
# in particular it shows all options that POSIX mandates as defaults.)

# Start into interactive mode even if the system mailbox is empty or
# does not exist.  mailx will exit immediately without that one
set emptystart

# When composing a message, start directly into <i>$EDITOR</i>
set editalong

# Start <i>$PAGER</i> when a message is longer than VALUE lines;
# without VALUE: screen <i>$LINES</i>
set crt=

# A nicer prompt for a modern terminal
wysh set prompt='?\${?}!\${!}[\${account}#\${mailbox-display}]? '

# Add more entries to the history, and make that persistent
set history-gabby history-file=+.s-nailhist
# When <b>p</b>rinting messages, show only these headers
# (Easier to <b>retain</b> what you want than to <b>ignore</b>
# what you do not; use <b>P</b>rint to see all headers and <b>S</b>how
# to see the raw message content)
retain date from to cc subject

# Try to get around weird MIME attachment specifications
# (This option can take a value, see the manual for more)
set mime-counter-evidence=0xE

# Display HTML parts inline, nicer than what the builtin viewer can achieve
#set pipe-text/html='@* lynx -stdin -dump -force_html'
# Learn another mimetype
mimetype model/vrml wrl vrml

# Create some new commands so that, e.g., `ls /tmp' will..
commandalias ls !ls -latro
commandalias ps !ps axu
</pre>
<p>Once you are in it use <b>list</b> to print all available builtin commands. Typing `?X' tries to expand "X" and print a help string; since mailx allows abbreviations of all commands this is sometimes handy, try, e.g., <b>?h</b>, <b>?he</b> and <b>?hel</b> ... The command <b>help</b> will print a short summary of the most frequent used commands, more so if the variable <code>verbose</code> is set.
</p>
<h3><span class="mw-headline" id="Usage">Usage</span></h3>
<p>When starting into interactive mode a summary of the content of the initially opened mailbox is printed, as via the <code>headers</code> command.
In the header display messages are given numbers (starting at 1) which uniquely identify messages. Messages can be printed with the <code>print</code> command, or short: <code>p</code>. Whereas <code>p</code> honours <code>retain</code>ed (or <code>ignore</code>d) list of headers to be displayed, the <code>P</code>rint command will not and display all headers; the <code>Sh</code>ow command will print raw message content.
</p>
<p>By default the current message (dot) is printed, but just like with many other commands it is possible to specify lists of messages, as is documented in the manual section <span class="plainlinks archwiki-template-man" title="$ man 1 mailx"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mailx.1#Specifying_messages">mailx(1) § Specifying messages</a></span>; e.g., <code>p:u</code> will display all unread messages, <code>p.</code> will print the current message (dot), <code>p 1 5</code> will print the messages 1 and 5 and <code>p-</code> and <code>p+</code> will print the previous and the next message, respectively. Note that simply typing RETURN in an empty line acts like <code>next</code> (<code>n</code>) and thus prints the next message.
</p>
<p>The command <code>from</code> is nice for an overview, e.g., <code>f '@&lt;@arch linux</code> will print the header summary of all messages that contain the string "arch linux" in some message header, whereas <code>f '@arch linux</code> will only match those with "arch linux" in their subject; finally, the regular expression <code>f @^A[^[:space:]]+</code> finds all the messages whose subject start with an A character, and without white space characters immediately following that A. Be aware that quoting may be necessary when there is whitespace in search expressions etc.
</p>
<ul>
<li>
<code>file</code> and <code>File</code> open a new mailbox, the latter in readonly mode</li>
<li>
<code>newmail</code> (dependent on the mailbox, checks for new mail and) prints a listing of new messages</li>
<li>
<code>he</code> (headers) reprints the message list</li>
<li>
<code>z-</code> <code>z+</code> <code>z0</code> <code>z$</code> scroll through the header display (dependent on the terminal you are using the Home/End/PageUp/PageDown keys will be working aliases)</li>
<li>
<code>folders</code> shows a listing of mailboxes under the currently set <code>folder</code>
</li>
<li>
<code>r</code> replies to all addressees of the given message(s)</li>
<li>
<code>R</code> replies to the sender of the given message(s)</li>
<li>
<code>Lreply</code> "mailing-list" reply to the given message(s)</li>
<li>
<code>move</code> or <code>mv</code> moves (a) message(s)</li>
<li>
<code>(un)flag</code> marks (a) message(s) as (un)flagged</li>
<li>
<code>new</code> marks (a) message(s) unread</li>
<li>
<code>seen</code> marks (a) message(s) read</li>
<li>
<code>P</code> prints (a) message(s) with all headers</li>
<li>
<code>p</code> prints (a) message(s) and all non-ignored headers</li>
<li>
<code>show</code> prints the raw message of content of (a) message(s)</li>
<li>
<code>write</code> or <code>w</code> download messages and attachments in native format to local storage</li>
</ul>
<h3><span class="mw-headline" id="Message_composition">Message composition</span></h3>
<p>Composition is started by typing <code>mail user@host</code> or by replying to a message. When you enter <code>$EDITOR</code> (assuming <code>editalong</code> is set) you will find yourself in the native editor, where many operations can be performed using tilde escapes (short help available via <code>~?</code>). Of particular interest is <code>~@</code>, which either allows interactive editing of the attachment list, or, when given arguments, to add a(n) (comma-separated list of) additional attachment(s), as well as <code>~^</code>, which is a multiplexer command which offers some control about the message, e.g., to create custom headers.
</p>
<p>To send the mail, signal EOT with <code>Ctrl+d</code> or type <code>~.</code> on its own line.
</p>
<h2>
<span id="Using_S.2FMIME"></span><span class="mw-headline" id="Using_S/MIME">Using S/MIME</span>
</h2>
<p>The manual contains a step-by-step example of how to create your certificates etc. (<span class="plainlinks archwiki-template-man" title="$ man 1 mailx"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mailx.1#Signed_and_encrypted_messages_with_S/MIME">mailx(1) § Signed and encrypted messages with S/MIME</a></span> as well as <span class="plainlinks archwiki-template-man" title="$ man 1 mailx"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mailx.1#S/MIME_step_by_step">mailx(1) § S/MIME step by step</a></span>). Assuming you have your private key and signed certificate already, just create the paired file we need
</p>
<pre># cat private-key.pem signed-certificate.pem &gt; ~/pair.pem
</pre>
<p>and setup S-nail via
</p>
<pre>set smime-sign-cert=~/pair.pem \
    smime-sign-message-digest=SHA256 \
    smime-sign
</pre>
<p>From now any message that is sent will be signed. The default message digest would be SHA1, as mandated by <a href="https://tools.ietf.org/html/rfc5751" class="extiw" title="rfc:5751">RFC:5751</a>. Note that S/MIME always works relative to the setting of the variable <i>from</i>, so it seems best to instead place the above settings in an <code>account</code>. The <code>verify</code> command verifies S/MIME messages, but note that S/MIME decryption and verification is solely based upon OpenSSL for now, which only supports messages with a simplistic MIME structure.
</p>
<h2><span class="mw-headline" id="Workaround_missing_OpenPGP_support">Workaround missing OpenPGP support</span></h2>
<p>S-nail does not yet support OpenPGP. However, using a macro it is possible to at least automatically verify inline <code>--clearsign</code>ed messages, and using command ghosts their usage becomes handy: e.g., use the following in resource file and you will be able to verify a clearsigned message by just typing <code>V</code>:
</p>
<pre>define V {
   \localopts yes; \wysh set pipe-text/plain=$'@*#++=@\
      &lt; "${MAILX_FILENAME_TEMPORARY}" awk \
            -v TMPFILE="${MAILX_FILENAME_TEMPORARY}" \'\
         BEGIN{done=0}\
         /^-----BEGIN PGP SIGNED MESSAGE-----/,/^$/ {\
            if(done++ != 0)\
               next;\
            print "--- GPG --verify ---";\
            system("gpg --verify " TMPFILE " 2&gt;&amp;1");\
            print "--- GPG --verify ---";\
            print "";\
            next;\
         }\
         /^-----BEGIN PGP SIGNATURE-----/,/^-----END PGP SIGNATURE-----/ {\
            next;\
         }\
         {print}\
         \<i>;\</i>
      print
}
define RK {
  !printf 'Key IDs to gpg --recv-keys: ';\
    read keyids;\
    gpg --recv-keys ${keyids};
}
commandalias V '\'call V
commandalias RK '\call RK'
</pre>
<h2><span class="mw-headline" id="Using_an_IMAP_mailbox">Using an IMAP mailbox</span></h2>
<p>The following are only quick hints. It is also possible to define <i>folder</i> and <i>inbox</i> to point to IMAP server folders, for example. Internationalized names are supported.
</p>
<pre>set v15-compat
# or many servers will expire the session
set imap-keepalive=240
set imap-cache=~/.imap_cache
</pre>
<pre># You may want to define shortcuts to folders, for example:
shortcut myimap "<b>imaps://USER:PASS@server:port"</b>
set inbox=myimap
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul><li><a rel="nofollow" class="external text" href="https://www.sdaoden.eu/code.html">S-nail website</a></li></ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Email_clients.html" title="Category:Email clients">Email clients</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=S-nail&amp;oldid=801887">https://wiki.archlinux.org/index.php?title=S-nail&amp;oldid=801887</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 2 March 2024, at 15:27.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
