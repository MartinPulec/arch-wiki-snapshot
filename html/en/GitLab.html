<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>GitLab - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.43.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-GitLab rootpage-GitLab skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Installation</span>
			</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Configuration</span>
			</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-Preliminary_notes" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Preliminary_notes">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>Preliminary notes</span>
				</div>
			</a>
			
			<ul id="toc-Preliminary_notes-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-GitLab" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#GitLab">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>GitLab</span>
				</div>
			</a>
			
			<ul id="toc-GitLab-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Custom_port_for_Puma" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Custom_port_for_Puma">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3</span>
					<span>Custom port for Puma</span>
				</div>
			</a>
			
			<ul id="toc-Custom_port_for_Puma-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Secret_strings" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Secret_strings">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4</span>
					<span>Secret strings</span>
				</div>
			</a>
			
			<ul id="toc-Secret_strings-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Valkey" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Valkey">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.5</span>
					<span>Valkey</span>
				</div>
			</a>
			
			<ul id="toc-Valkey-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-PostgreSQL_database" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#PostgreSQL_database">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.6</span>
					<span>PostgreSQL database</span>
				</div>
			</a>
			
			<ul id="toc-PostgreSQL_database-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Initialize_Gitlab_database" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Initialize_Gitlab_database">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.7</span>
					<span>Initialize Gitlab database</span>
				</div>
			</a>
			
			<ul id="toc-Initialize_Gitlab_database-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Adjust_modifier_bits" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Adjust_modifier_bits">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.8</span>
					<span>Adjust modifier bits</span>
				</div>
			</a>
			
			<ul id="toc-Adjust_modifier_bits-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Web_server_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Web_server_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.9</span>
					<span>Web server configuration</span>
				</div>
			</a>
			
			<ul id="toc-Web_server_configuration-sublist" class="vector-toc-list">
				<li id="toc-Nginx" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Nginx">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.9.1</span>
					<span>Nginx</span>
				</div>
			</a>
			
			<ul id="toc-Nginx-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Apache" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Apache">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.9.2</span>
					<span>Apache</span>
				</div>
			</a>
			
			<ul id="toc-Apache-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Node.js" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Node.js">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.9.3</span>
					<span>Node.js</span>
				</div>
			</a>
			
			<ul id="toc-Node.js-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-HTTPS/SSL" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#HTTPS/SSL">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.10</span>
					<span>HTTPS/SSL</span>
				</div>
			</a>
			
			<ul id="toc-HTTPS/SSL-sublist" class="vector-toc-list">
				<li id="toc-Change_GitLab_configs" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Change_GitLab_configs">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.10.1</span>
					<span>Change GitLab configs</span>
				</div>
			</a>
			
			<ul id="toc-Change_GitLab_configs-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Let's_Encrypt" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Let's_Encrypt">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.10.2</span>
					<span>Let's Encrypt</span>
				</div>
			</a>
			
			<ul id="toc-Let's_Encrypt-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Firewall" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Firewall">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.11</span>
					<span>Firewall</span>
				</div>
			</a>
			
			<ul id="toc-Firewall-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Start_and_test_GitLab" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Start_and_test_GitLab">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Start and test GitLab</span>
			</div>
		</a>
		
		<ul id="toc-Start_and_test_GitLab-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Upgrade_database_on_updates" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Upgrade_database_on_updates">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Upgrade database on updates</span>
			</div>
		</a>
		
			<button aria-controls="toc-Upgrade_database_on_updates-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Upgrade database on updates subsection</span>
			</button>
		
		<ul id="toc-Upgrade_database_on_updates-sublist" class="vector-toc-list">
			<li id="toc-Manual_method" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Manual_method">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>Manual method</span>
				</div>
			</a>
			
			<ul id="toc-Manual_method-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Automatic_method" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Automatic_method">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.2</span>
					<span>Automatic method</span>
				</div>
			</a>
			
			<ul id="toc-Automatic_method-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Advanced_configuration" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Advanced_configuration">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Advanced configuration</span>
			</div>
		</a>
		
			<button aria-controls="toc-Advanced_configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Advanced configuration subsection</span>
			</button>
		
		<ul id="toc-Advanced_configuration-sublist" class="vector-toc-list">
			<li id="toc-Basic_SSH" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Basic_SSH">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>Basic SSH</span>
				</div>
			</a>
			
			<ul id="toc-Basic_SSH-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Custom_SSH_connection" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Custom_SSH_connection">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2</span>
					<span>Custom SSH connection</span>
				</div>
			</a>
			
			<ul id="toc-Custom_SSH_connection-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Sending_emails_from_GitLab" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Sending_emails_from_GitLab">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.3</span>
					<span>Sending emails from GitLab</span>
				</div>
			</a>
			
			<ul id="toc-Sending_emails_from_GitLab-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Useful_tips" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Useful_tips">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Useful tips</span>
			</div>
		</a>
		
			<button aria-controls="toc-Useful_tips-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Useful tips subsection</span>
			</button>
		
		<ul id="toc-Useful_tips-sublist" class="vector-toc-list">
			<li id="toc-Rake_tasks" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Rake_tasks">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.1</span>
					<span>Rake tasks</span>
				</div>
			</a>
			
			<ul id="toc-Rake_tasks-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Backup_and_restore" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Backup_and_restore">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.2</span>
					<span>Backup and restore</span>
				</div>
			</a>
			
			<ul id="toc-Backup_and_restore-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enable_fast_SSH_key_lookup" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enable_fast_SSH_key_lookup">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.3</span>
					<span>Enable fast SSH key lookup</span>
				</div>
			</a>
			
			<ul id="toc-Enable_fast_SSH_key_lookup-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Rails_console" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Rails_console">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.4</span>
					<span>Rails console</span>
				</div>
			</a>
			
			<ul id="toc-Rails_console-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">7</span>
				<span>Troubleshooting</span>
			</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-HTTPS_is_not_green_(gravatar_not_using_https)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#HTTPS_is_not_green_(gravatar_not_using_https)">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.1</span>
					<span>HTTPS is not green (gravatar not using https)</span>
				</div>
			</a>
			
			<ul id="toc-HTTPS_is_not_green_(gravatar_not_using_https)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Errors_after_updating" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Errors_after_updating">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.2</span>
					<span>Errors after updating</span>
				</div>
			</a>
			
			<ul id="toc-Errors_after_updating-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-GitLab_Puma_cannot_access_non-default_repositories_directory" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#GitLab_Puma_cannot_access_non-default_repositories_directory">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.3</span>
					<span>GitLab Puma cannot access non-default repositories directory</span>
				</div>
			</a>
			
			<ul id="toc-GitLab_Puma_cannot_access_non-default_repositories_directory-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Failed_to_connect_to_Gitaly" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Failed_to_connect_to_Gitaly">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.4</span>
					<span>Failed to connect to Gitaly</span>
				</div>
			</a>
			
			<ul id="toc-Failed_to_connect_to_Gitaly-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Failed_to_connect_via_SSH" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Failed_to_connect_via_SSH">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.5</span>
					<span>Failed to connect via SSH</span>
				</div>
			</a>
			
			<ul id="toc-Failed_to_connect_via_SSH-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-CSS_or_styles_issue" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#CSS_or_styles_issue">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.6</span>
					<span>CSS or styles issue</span>
				</div>
			</a>
			
			<ul id="toc-CSS_or_styles_issue-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-The_server_does_not_support_push_options" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#The_server_does_not_support_push_options">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.7</span>
					<span>The server does not support push options</span>
				</div>
			</a>
			
			<ul id="toc-The_server_does_not_support_push_options-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">8</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">GitLab</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 2 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-2" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">2 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Gitlab" title="Gitlab – 日本語" lang="ja" hreflang="ja" data-title="Gitlab" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/GitLab" title="GitLab – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" data-title="GitLab" data-language-autonym="中文（简体）" data-language-local-name="中文（简体）" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Gitolite.html" title="Gitolite">Gitolite</a></li>
<li><a href="../en/Ruby_on_Rails.html" title="Ruby on Rails">Ruby on Rails</a></li>
</ul>
</div>
<p>From <a rel="nofollow" class="external text" href="https://about.gitlab.com/">GitLab's homepage</a>:
</p>
<dl><dd>GitLab offers git repository management, code reviews, issue tracking, activity feeds and wikis. Enterprises install GitLab on-premise and connect it with LDAP and Active Directory servers for secure authentication and authorization. A single GitLab server can handle more than 25,000 users but it is also possible to create a high availability setup with multiple active servers.</dd></dl>
<p>An example live version can be found at <a rel="nofollow" class="external text" href="https://gitlab.com/">GitLab.com</a>.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>GitLab requires <a href="../en/Valkey.html" title="Valkey">Valkey</a> and a database backend. If you plan to run it on the same machine, first install <a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a>.
</p>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gitlab">gitlab</a></span> package.
</p>
<p>Finally, a <a href="../en/List_of_applications/Internet.html#Web_servers" class="mw-redirect" title="Web server">web server</a> has to be installed and configured. The configuration for GitLab will be discussed in the <a href="#Web_server_configuration">#Web server configuration</a> section.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<h3><span class="mw-headline" id="Preliminary_notes">Preliminary notes</span></h3>
<p>GitLab is composed of multiple components, see the <a rel="nofollow" class="external text" href="https://docs.gitlab.com/ce/development/architecture.html">architecture overview page</a>.
</p>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gitlab">gitlab</a></span> package installs GitLab's files in a manner that more closely follow standard Linux conventions:
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Description
</th>
<th>
<a rel="nofollow" class="external text" href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/install/installation.md">GitLab's Official</a>
</th>
<th>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gitlab">gitlab</a></span>
</th>
</tr>
<tr>
<td>Application Code
</td>
<td>
<code>/home/git</code>
</td>
<td>
<code>/usr/share/webapps/gitlab</code>
</td>
</tr>
<tr>
<td>Application Data
</td>
<td>
<code>/home/git</code>
</td>
<td>
<code>/var/lib/gitlab</code>
</td>
</tr>
<tr>
<td>User (Home Directory)
</td>
<td>
<code>git</code> (<code>/home/git</code>)
</td>
<td>
<code>gitlab</code> (<code>/var/lib/gitlab</code>)
</td>
</tr>
<tr>
<td>Configuration File GitShell
</td>
<td>
<code>/home/git/gitlab-shell/config.yml</code>
</td>
<td>
<code>/etc/webapps/gitlab-shell/config.yml</code>
</td>
</tr>
<tr>
<td>Configuration File GitLab
</td>
<td>
<code>/home/git/gitlab/config/gitlab.yml</code>
</td>
<td>
<code>/etc/webapps/gitlab/gitlab.yml</code>
</td>
</tr>
<tr>
<td>Logs
</td>
<td>
<code>/home/git/log</code>
</td>
<td>
<code>/var/log/gitlab</code>
</td>
</tr>
<tr>
<td>Unix socket files / PID files
</td>
<td>
<code>/home/git/sockets</code>
</td>
<td>
<code>/run/gitlab</code>
</td>
</tr>
</tbody>
</table>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you are familiar with the <a href="../en/Arch_build_system.html" title="Arch build system">Arch build system</a> you can edit the PKGBUILD and relevant files to change gitlab's home directory to a place of your liking.</div>
<h3><span class="mw-headline" id="GitLab">GitLab</span></h3>
<p>Edit <code>/etc/webapps/gitlab/gitlab.yml</code> and setup at least the following parameters:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <code>hostname</code> and <code>port</code> are used for the <code>git clone http://<i>hostname:port</i></code> as example.</div>
<p><b>Hostname:</b> In the <code>gitlab:</code> section set <code>host:</code> - replacing <code>localhost</code> to <code><i>yourdomain.com</i></code> (no <code>http://</code> or trailing slash) - into your fully qualified domain name.
</p>
<p><b>Port:</b> <code>port:</code> can be confusing. This is not the port that the GitLab server (Puma) runs on; it is the port that users will initially access through in their browser. Basically, if you intend for users to visit <code><i>yourdomain.com</i></code> in their browser, without appending a port number to the domain name, leave <code>port:</code> as <code>80</code>. If you intend your users to type something like <code><i>yourdomain.com:3425</i></code> into their browsers, then you would set <code>port:</code> to <code>3425</code>. You will also have to <b>configure your webserver</b> to listen on that port.
</p>
<p><b>Timezone (optional):</b> The <code>time_zone:</code> parameter is optional, but may be useful to force the zone of GitLab applications.
</p>
<p>Based on the table in <a href="#Preliminary_notes">#Preliminary notes</a> above, the following paths have to be configured in <code>gitlab.yml</code>:
</p>
<ul>
<li><code>repository_downloads_path: "/var/lib/gitlab/shared/cache/archive/"</code></li>
<li>
<code>gitlab_ci</code> section: <code>builds_path: "/var/lib/gitlab/builds/"</code>
</li>
<li>
<code>incoming_email</code> section (if enabled): <code>log_path: "/var/log/gitlab/mail_room_json.log"</code>
</li>
<li>
<code>artifacts</code> section (if enabled): <code>path: "/var/lib/gitlab/shared/artifacts"</code>
</li>
<li>
<code>external_diffs</code> section (if enabled): <code>storage_path: "/var/lib/gitlab/shared/external-diffs"</code>
</li>
<li>
<code>lfs</code> section (if enabled): <code>storage_path: "/var/lib/gitlab/shared/lfs-objects"</code>
</li>
<li>
<code>packages</code> section (if enabled): <code>storage_path: "/var/lib/gitlab/shared/packages"</code>
</li>
<li>
<code>dependency_proxy</code> section (if enabled): <code>storage_path: "/var/lib/gitlab/shared/dependency_proxy"</code>
</li>
<li>
<code>terraform_state</code> section (if enabled): <code>storage_path: "/var/lib/gitlab/shared/terraform_state"</code>
</li>
<li>
<code>pages</code> section (if enabled): <code>path: "/var/lib/gitlab/shared/pages"</code>
</li>
<li>
<code>registry</code> section (if enabled): <code>path: "/var/lib/gitlab/shared/registry"</code>
</li>
</ul>
<h3><span class="mw-headline" id="Custom_port_for_Puma">Custom port for Puma</span></h3>
<p>GitLab Puma is the main component which processes most of the user requests. By default, it listens on the <code>/run/gitlab/gitlab.socket</code> UNIX socket which can be changed in the <code>/etc/webapps/gitlab/puma.rb</code> file.
</p>
<p>To configure Puma to listen on a TCP port as well as UNIX socket:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab/puma.rb</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">bind 'unix:///run/gitlab/gitlab.socket'
bind 'tcp://127.0.0.1:8080'</pre>
<p>If the Puma address is changed, the configuration of other components which communicate with Puma have to be updated as well:
</p>
<ul><li>For GitLab Shell, update the <code>gitlab_url</code> variable in <code>/etc/webapps/gitlab-shell/config.yml</code> and <code>url</code> in the <code>[gitlab]</code> section in <code>/etc/gitlab-gitaly/config.toml</code>.</li></ul>
<dl><dd><div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> UNIX socket path can be specified with URL-escaped slashes (i.e. <code>http+unix://%2Frun%2Fgitlab%2Fgitlab.socket</code> for the default <code>/run/gitlab/gitlab.socket</code>).</div></dd></dl>
<ul><li>For GitLab Workhorse, <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">edit</a> the <code>gitlab-workhorse.service</code> and update the <code>-authBackend</code> option. See <a rel="nofollow" class="external autonumber" href="https://gitlab.com/gitlab-org/gitlab-workhorse#relative-url-support">[1]</a> for details.</li></ul>
<h3><span class="mw-headline" id="Secret_strings">Secret strings</span></h3>
<p>Make sure that the files <code>/etc/webapps/gitlab/secret</code> and <code>/etc/webapps/gitlab-shell/secret</code> files contain something. Their content should be kept secret because they are used for the generation of authentication tokens etc.
</p>
<p>For example, random strings can be generated with the following commands:
</p>
<pre># hexdump -v -n 64 -e '1/1 "%02x"' /dev/urandom &gt; /etc/webapps/gitlab/secret
# chmod 640 /etc/webapps/gitlab/secret
</pre>
<pre># hexdump -v -n 64 -e '1/1 "%02x"' /dev/urandom &gt; /etc/webapps/gitlab-shell/secret
# chmod 640 /etc/webapps/gitlab-shell/secret
</pre>
<p>Also fill in (new) secret strings for <code>secrets.yml</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab/secrets.yml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">production:
  secret_key_base: <i>secret</i>
  db_key_base: <i>secret</i>
  otp_key_base: <i>secret</i>
  openid_connect_signing_key: <i>secret</i>
  active_record_encryption_primary_key: ["<i>32-alphanumeric-chars</i>"]
  active_record_encryption_deterministic_key: ["<i>32-alphanumeric-chars</i>"]
  active_record_encryption_key_derivation_salt: "<i>32-alphanumeric-chars</i>"
</pre>
<h3><span class="mw-headline" id="Valkey">Valkey</span></h3>
<p>In order to provide sufficient performance you will need a cache database. <a href="../en/Valkey.html#Installation" title="Valkey">Install</a> and <a href="../en/Valkey.html#Configuration" title="Valkey">configure</a> a Valkey instance, being careful to the section dedicated to listening via a socket.
</p>
<p>Add the <code>gitlab</code> user to the <code>valkey</code> <a href="../en/Users_and_groups.html#Group_management" class="mw-redirect" title="User group">user group</a> and update these configuration files:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab/cable.yml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">development:
  adapter: redis
  url: unix:/run/valkey/valkey.sock
  channel_prefix: gitlab_development
test:
  adapter: redis
  url: unix:/run/valkey/valkey.sock
  channel_prefix: gitlab_test
production:
  adapter: redis
  url: unix:/run/valkey/valkey.sock
  channel_prefix: gitlab_production</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab/resque.yml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">development:
  url: unix:/run/valkey/valkey.sock
test:
  url: unix:/run/valkey/valkey.sock
production:
  url: unix:/run/valkey/valkey.sock</pre>
<h3><span class="mw-headline" id="PostgreSQL_database">PostgreSQL database</span></h3>
<p>A <a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a> database will be required before Gitlab can be run.
</p>
<p>Login to PostgreSQL and create the <code>gitlabhq_production</code> database along with its user. Remember to change <code><i>your_username_here</i></code> and <code><i>your_password_here</i></code> to the real values:
</p>
<pre># psql -d template1
</pre>
<pre>template1=# CREATE USER <i>your_username_here</i> WITH PASSWORD '<i>your_password_here</i>';
template1=# ALTER USER <i>your_username_here</i> SUPERUSER;
template1=# CREATE DATABASE gitlabhq_production OWNER <i>your_username_here</i>;
template1=# \q</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The reason for creating the user as a superuser is that GitLab is trying to be "smart" and install extensions (not just create them in its own userspace). And this is only allowed by superusers in Postgresql.</div>
<p>Try connecting to the new database with the new user to verify it works:
</p>
<pre>$ psql -d gitlabhq_production -U <i>your_username_here</i> -W
</pre>
<p>Open the new <code>/etc/webapps/gitlab/database.yml</code> and set the values for <code>username:</code> and <code>password:</code>. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab/database.yml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#
# PRODUCTION
#
production:
  main:
    adapter: postgresql
    encoding: unicode
    database: gitlabhq_production
    username: <i>your_username_here</i>
    password: "<i>your_password_here</i>"
    # host: localhost
    # port: 5432
    socket: /run/postgresql/.s.PGSQL.5432
  ci:
    adapter: postgresql
    encoding: unicode
    database: gitlabhq_production
    database_tasks: false
    username: <i>your_username_here</i>
    password: "<i>your_password_here</i>"
    # host: localhost
    # port: 5432
    socket: /run/postgresql/.s.PGSQL.5432
...
</pre>
<p>For our purposes (unless you know what you are doing), you do not need to worry about configuring the other databases listed in <code>/etc/webapps/gitlab/database.yml</code>. We only need to set up the production database to get GitLab working.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Since <a rel="nofollow" class="external text" href="https://docs.gitlab.com/ee/install/installation.html#configure-gitlab-db-settings">GitLab 15.9</a>, <code>database.yml</code> with only a <code>main:</code> section is deprecated. In GitLab 17.0 and later, you must have two sections in your <code>database.yml</code>: <code>main:</code> and <code>ci:</code>. The <code>ci:</code> connection <b>must be to the same database</b> as <code>main:</code>.</div>
<h3><span class="mw-headline" id="Initialize_Gitlab_database">Initialize Gitlab database</span></h3>
<p>Start the <a href="../en/Valkey.html" title="Valkey">Valkey</a> server and the <code>gitlab-gitaly.service</code> before initializing the database.
</p>
<p>Initialize the database and activate advanced features:
</p>
<pre>$ cd /usr/share/webapps/gitlab
$ sudo -u gitlab $(cat environment | xargs) bundle exec rake gitlab:setup 
</pre>
<p>You can set the Administrator/root password and email by supplying them in the <code>GITLAB_ROOT_PASSWORD</code> and <code>GITLAB_ROOT_EMAIL</code> environment variables, respectively, as seen below. If you do not set the password (and it is set to the default one), do not expose GitLab to the public internet until the installation is done and you have logged into the server the first time. During the first login, you are forced to change the default password. An Enterprise Edition license may also be installed at this time by supplying a full path in the <code>GITLAB_LICENSE_FILE</code> environment variable.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> This will log the <code><i>yourpassword</i></code> in the shell history. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:GitLab.html">Talk:GitLab</a>)</div>
</div>
<pre>$ cd /usr/share/webapps/gitlab
$ sudo -u gitlab $(cat environment | xargs) bundle exec rake gitlab:setup GITLAB_ROOT_PASSWORD=<i>yourpassword</i> GITLAB_ROOT_EMAIL=<i>youremail</i> GITLAB_LICENSE_FILE=<i>/path/to/license</i>
</pre>
<p>Finally run the following commands to check your installation:
</p>
<pre>$ sudo -u gitlab $(cat environment | xargs) bundle exec rake gitlab:env:info
$ sudo -u gitlab $(cat environment | xargs) bundle exec rake gitlab:check
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>The <i>gitlab:env:info</i> and <i>gitlab:check</i> commands might show a fatal error related to git. This is OK.</li>
<li>The <i>gitlab:check</i> will complain about missing initscripts. This is nothing to worry about, as <a href="../en/Systemd.html" title="Systemd">systemd</a> service files are used instead (which GitLab does not recognize).</li>
</ul>
</div>
<h3><span class="mw-headline" id="Adjust_modifier_bits">Adjust modifier bits</span></h3>
<p>(The gitlab check will not pass if the user and group ownership is not configured properly)
</p>
<pre># chmod -R ug+rwX,o-rwx /var/lib/gitlab/repositories/
# chmod -R ug-s /var/lib/gitlab/repositories
# find /var/lib/gitlab/repositories/ -type d -print0 | xargs -0 chmod g+s
</pre>
<h3><span class="mw-headline" id="Web_server_configuration">Web server configuration</span></h3>
<p>To access GitLab from an outside network, the upstream documentation recommends to use an established web server as a proxy. All queries from the web server to GitLab are processed by GitLab Workhorse, which decides how they should be processed. See <a rel="nofollow" class="external autonumber" href="https://gitlab.com/gitlab-org/gitlab-workhorse#quick-facts-how-does-workhorse-work">[2]</a> for details.
</p>
<h4><span class="mw-headline" id="Nginx">Nginx</span></h4>
<p>See <a href="../en/Nginx.html#Configuration" title="Nginx">Nginx#Configuration</a> for basic <i>nginx</i> configuration and <a href="../en/Nginx.html#TLS" title="Nginx">Nginx#TLS</a> for enabling HTTPS. The sample in this section also assumes that server blocks are managed with <a href="../en/Nginx.html#Managing_server_entries" title="Nginx">Nginx#Managing server entries</a>.
</p>
<p>Create and edit the configuration based on the following snippet. See the <a rel="nofollow" class="external text" href="https://gitlab.com/gitlab-org/gitlab-ce/tree/master/lib/support/nginx">upstream GitLab repository</a> for more examples.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nginx/sites-available/gitlab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">upstream gitlab-workhorse {
  server unix:/run/gitlab/gitlab-workhorse.socket fail_timeout=0;
}

server {
  listen 80;                  # IPv4 HTTP
  #listen 443 ssl http2;      # uncomment to enable IPv4 HTTPS + HTTP/2
  #listen [::]:80;            # uncomment to enable IPv6 HTTP
  #listen [::]:443 ssl http2; # uncomment to enable IPv6 HTTPS + HTTP/2
  server_name example.com;

  access_log  /var/log/gitlab/nginx_access.log;
  error_log   /var/log/gitlab/nginx_error.log;

  #ssl_certificate ssl/example.com.crt;
  #ssl_certificate_key ssl/example.com.key;

  location ~ ^/(assets)/ {
    root /usr/share/webapps/gitlab/public;
    gzip_static on; # to serve pre-gzipped version
    expires max;
    add_header Cache-Control public;
  }

  location / {
      # unlimited upload size in nginx (so the setting in GitLab applies)
      client_max_body_size 0;

      # proxy timeout should match the timeout value set in /etc/webapps/gitlab/puma.rb
      proxy_read_timeout 60;
      proxy_connect_timeout 60;
      proxy_redirect off;

      proxy_set_header Host $http_host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;

      #proxy_set_header X-Forwarded-Ssl on;

      proxy_pass http://gitlab-workhorse;
  }

  error_page 404 /404.html;
  error_page 422 /422.html;
  error_page 500 /500.html;
  error_page 502 /502.html;
  error_page 503 /503.html;
  location ~ ^/(404|422|500|502|503)\.html$ {
    root /usr/share/webapps/gitlab/public;
    internal;
  }
}
</pre>
<h4><span class="mw-headline" id="Apache">Apache</span></h4>
<p>Install and configure the <a href="../en/Apache_HTTP_Server.html" title="Apache HTTP Server">Apache HTTP Server</a> and <a href="../en/Apache_HTTP_Server.html#TLS" title="Apache HTTP Server">Apache HTTP Server#TLS</a> for enabling HTTPS. You can use these <a rel="nofollow" class="external text" href="https://gitlab.com/gitlab-org/gitlab-recipes/tree/master/web-server/apache">upstream recipes</a> to get started with the configuration file for GitLab's virtual host.
</p>
<p>Notice that the SSL virtual host needs a specific IP instead of generic. Also if you set a custom port for Puma, do not forget to set it at the <code>BalanceMember</code> line.
</p>
<p>The following Apache modules must also be loaded in the configuration file <code>/etc/httpd/conf/httpd.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/httpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so
</pre>
<p>If an Apache configuration via <b>unix socket</b> for the <code>gitlab-workhorse.service</code> is desired, the following configuration is functional:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/extra/gitlab.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;VirtualHost *:443&gt;
    ServerName SERVERNAME
    ServerAlias SERVERNAME
    DocumentRoot /usr/share/webapps/gitlab/public
    &lt;Directory /usr/share/webapps/gitlab/public&gt;
        Options FollowSymlinks
        AllowOverride all
        Require all granted
    &lt;/Directory&gt;
    &lt;IfModule mod_alias.c&gt;
        Alias / /usr/share/webapps/gitlab/public/
    &lt;/IfModule&gt;

    &lt;IfModule mod_headers.c&gt;
        Header always set Strict-Transport-Security "max-age=15552000; includeSubDomains; preload"
    &lt;/IfModule&gt;

    ProxyPreserveHost On
    SSLProxyEngine on
    AllowEncodedSlashes NoDecode
    
    &lt;Location /&gt;
        ProxyPass unix:/run/gitlab/gitlab-workhorse.socket|http://127.0.0.1/
        ProxyPassReverse unix:/run/gitlab/gitlab-workhorse.socket|http://127.0.0.1/
    &lt;/Location&gt;
 
    &lt;Location /-/cable&gt;
        ProxyPass unix:/run/gitlab/gitlab-workhorse.socket|ws://127.0.0.1/-/cable
        ProxyPassReverse unix:/run/gitlab/gitlab-workhorse.socket|ws://127.0.0.1/-/cable
    &lt;/Location&gt; 
    #
    RewriteEngine on
    RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f [OR]
    RewriteCond %{REQUEST_URI} ^/uploads/.*
    RewriteRule .* unix:/run/gitlab/gitlab-workhorse.socket|http://127.0.0.1%{REQUEST_URI} [P,QSA,NE]
    RequestHeader set X_FORWARDED_PROTO 'https'
    RequestHeader set X-Forwarded-Ssl on
    #
    ErrorDocument 404 /404.html
    ErrorDocument 422 /422.html
    ErrorDocument 500 /500.html
    ErrorDocument 503 /deploy.html
    ErrorLog /var/log/httpd/gitlab.lan.info-error_log
    CustomLog /var/log/httpd/gitlab.lan.info-access_log common
Include /etc/letsencrypt/options-ssl-apache.conf
SSLCertificateFile /etc/letsencrypt/live/SERVERNAME/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/SERVERNAME/privkey.pem
&lt;/VirtualHost&gt;

&lt;VirtualHost *:80&gt;
    ServerName SERVERNAME
    Redirect / https://SERVERNAME
RewriteEngine on
RewriteCond %{SERVER_NAME} =SERVERNAME
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
&lt;/VirtualHost&gt;
</pre>
<p>A working example with <b>tcp network connection</b> (certbot flavor) assuming that <code>gitlab-workhorse.service</code> contains <code>-listenNetwork tcp -listenAddr 127.0.0.1:8181</code> on the <code>ExecStart</code> line:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/extra/gitlab.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&lt;VirtualHost *:443&gt;
    ServerName SERVERNAME
    ServerAlias SERVERNAME
    DocumentRoot /usr/share/webapps/gitlab/public
    &lt;Directory /usr/share/webapps/gitlab/public&gt;
        Options FollowSymlinks
        AllowOverride all
        Require all granted
    &lt;/Directory&gt;
    &lt;IfModule mod_alias.c&gt;
        Alias / /usr/share/webapps/gitlab/public/
    &lt;/IfModule&gt;

    &lt;IfModule mod_headers.c&gt;
        Header always set Strict-Transport-Security "max-age=15552000; includeSubDomains; preload"
    &lt;/IfModule&gt;

    ProxyPreserveHost On
    SSLProxyEngine on
    AllowEncodedSlashes NoDecode
    &lt;Location /&gt;
        ProxyPassReverse http://127.0.0.1:8181
        ProxyPassReverse http://SERVERNAME
    &lt;/Location&gt;
    &lt;Location /-/cable&gt;
        ProxyPassReverse http://127.0.0.1:8181
        ProxyPassReverse http://SERVERNAME
    &lt;/Location&gt;
    #
    RewriteEngine on
    RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f [OR]
    RewriteCond %{REQUEST_URI} ^/uploads/.*
    RewriteRule .* http://127.0.0.1:8181%{REQUEST_URI} [P,QSA,NE]
    RequestHeader set X_FORWARDED_PROTO 'https'
    RequestHeader set X-Forwarded-Ssl on
    #
    ErrorDocument 404 /404.html
    ErrorDocument 422 /422.html
    ErrorDocument 500 /500.html
    ErrorDocument 503 /deploy.html
    ErrorLog /var/log/httpd/gitlab.lan.info-error_log
    CustomLog /var/log/httpd/gitlab.lan.info-access_log common
Include /etc/letsencrypt/options-ssl-apache.conf
SSLCertificateFile /etc/letsencrypt/live/SERVERNAME/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/SERVERNAME/privkey.pem
&lt;/VirtualHost&gt;

&lt;VirtualHost *:80&gt;
    ServerName SERVERNAME
    Redirect / https://SERVERNAME
RewriteEngine on
RewriteCond %{SERVER_NAME} =SERVERNAME
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
&lt;/VirtualHost&gt;
</pre>
<h4><span class="mw-headline" id="Node.js">Node.js</span></h4>
<p>You can easily set up an HTTPS proxy on port 443 to proxy traffic to the GitLab Workhorse using <a rel="nofollow" class="external text" href="https://github.com/CodeCharmLtd/http-master">http-master</a> for Node.js. http-master is built on top of <a rel="nofollow" class="external text" href="https://github.com/nodejitsu/node-http-proxy">node-http-proxy</a>.
</p>
<h3>
<span id="HTTPS.2FSSL"></span><span class="mw-headline" id="HTTPS/SSL">HTTPS/SSL</span>
</h3>
<h4><span class="mw-headline" id="Change_GitLab_configs">Change GitLab configs</span></h4>
<p>Modify <code>/etc/webapps/gitlab/shell.yml</code> so the URL to your GitLab site starts with <code>https://</code>. Modify <code>/etc/webapps/gitlab/gitlab.yml</code> so that <code>https:</code> setting is set to <code>true</code>.
</p>
<h4>
<span id="Let.27s_Encrypt"></span><span class="mw-headline" id="Let's_Encrypt">Let's Encrypt</span>
</h4>
<p>To validate your URL, the Let's Encrypt process will try to access your GitLab server via a URL such as <code><i>your.domain.name</i>/.well-known/acme-challenge/<i>a_long_id</i></code>. Hence, you need to make sure that requests to the <code>.well-known</code> subdirectory are not proxied to GitLab Workhorse. This can be done easily with the Certbot's "webroot" method, see <a href="../en/Certbot.html#Webroot" title="Certbot">Certbot#Webroot</a> for details.
</p>
<h3><span class="mw-headline" id="Firewall">Firewall</span></h3>
<p>If you want to give direct access to your Gitlab installation through an <a href="../en/Iptables.html" title="Iptables">iptables</a> firewall, you may need to adjust the port and the network address:
</p>
<pre># iptables -A tcp_inbound -p TCP -s <b>192.168.1.0/24</b> --destination-port <b>80</b> -j ACCEPT
</pre>
<p>If you are behind a router, do not forget to forward this port to the running GitLab server host, if you want to allow WAN access.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Allowing access to GitLab from hosts other than localhost is not recommended before completing the installation and setting the root password. See <a href="#Start_and_test_GitLab">#Start and test GitLab</a>.</div>
<h2><span class="mw-headline" id="Start_and_test_GitLab">Start and test GitLab</span></h2>
<p>Make sure <a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a> and <a href="../en/Valkey.html" title="Valkey">Valkey</a> are running and setup correctly.
</p>
<p>Then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a>/<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>gitlab.target</code>.
</p>
<p>Now test your GitLab instance by visiting <a rel="nofollow" class="external free" href="http://localhost">http://localhost</a> or <code><a rel="nofollow" class="external free" href="http://localhost">http://localhost</a>:<i>port</i></code>, where <code><i>port</i></code> is the port number on which your web server listens. You should be prompted to create a password:
</p>
<pre>username: root
password: You will be prompted to create one on your first visit.
</pre>
<p>See <a href="#Troubleshooting">#Troubleshooting</a> and log files inside the <code>/var/log/gitlab/</code> directory for troubleshooting.
</p>
<h2><span class="mw-headline" id="Upgrade_database_on_updates">Upgrade database on updates</span></h2>
<h3><span class="mw-headline" id="Manual_method">Manual method</span></h3>
<p>After updating the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gitlab">gitlab</a></span> package, it is required to upgrade the database:
</p>
<pre>$ cd /usr/share/webapps/gitlab
$ sudo -u gitlab $(cat environment | xargs) bundle exec rake db:migrate
</pre>
<p>Afterwards, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Reload">reload</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>gitlab-sidekiq.service</code>, <code>gitlab-puma.service</code>, <code>gitlab-workhorse.service</code> and <code>gitlab-gitaly.service</code>.
</p>
<h3><span class="mw-headline" id="Automatic_method">Automatic method</span></h3>
<p>You can create pacman hooks to automate database upgrades on GitLab package updates. Create the three following files, do not forget to make the shell script <a href="../en/Help:Reading.html#Make_executable" class="mw-redirect" title="Executable">executable</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/05-gitlab-pre.hook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Trigger]
Operation = Upgrade
Type = Package
Target = gitlab

[Action]
Description = Stopping gitlab services
When = PreTransaction
Exec = /usr/bin/systemctl stop gitlab-gitaly.service gitlab-mailroom.service gitlab-puma.service gitlab-sidekiq.service gitlab-workhorse.service</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/99-gitlab-post.hook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Trigger]
Operation = Upgrade
Type = Package
Target = gitlab

[Action]
Description = Migrating GitLab database and starting services
When = PostTransaction
Exec = /etc/pacman.d/scripts/gitlab-migrate-database.sh</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/scripts/gitlab-migrate-database.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh

cd "/usr/share/webapps/gitlab"
sudo -u gitlab $(cat environment | xargs) bundle exec rake db:migrate

# The hook runs after 30-systemd-daemon-reload.hook so another systemctl daemon-reload is not necessary.
systemctl start gitlab.target</pre>
<h2><span class="mw-headline" id="Advanced_configuration">Advanced configuration</span></h2>
<h3><span class="mw-headline" id="Basic_SSH">Basic SSH</span></h3>
<p>After completing the basic installation, set up SSH access for users. Configuration for <a href="../en/OpenSSH.html" title="OpenSSH">OpenSSH</a> is described below. <a href="../en/Secure_Shell.html#Software" title="Secure Shell">Other SSH clients and servers</a> will require different modifications.
</p>
<p>For tips on adding user SSH keys, the process is well-documented on the <a rel="nofollow" class="external text" href="https://docs.gitlab.com/ee/user/ssh.html">GitLab</a> website. You can check the administrator logs at <code>/var/lib/gitlab/log/gitlab-shell.log</code> to confirm user SSH keys are being submitted properly. Behind the scenes, GitLab adds these keys to its <i>authorized_keys</i> file in <code>/var/lib/gitlab/.ssh/authorized_keys</code>.
</p>
<p>The common method of testing keys (e.g. <code>ssh -T git@<i>your_server</i></code>) requires a bit of extra configuration to work correctly. The user configured in <code>/etc/webapps/gitlab/gitlab.yml</code> (by default <code>gitlab</code>) must be added to the server's sshd configuration file, in addition to a handful of other changes:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PubkeyAuthentication   yes
AuthorizedKeysFile     %h/.ssh/authorized_keys
</pre>
<p>If your <code>/etc/ssh/sshd_config</code> contains the <code>AllowUsers</code> option, then the <code>gitlab</code> user should be added to the list:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">AllowUsers gitlab <i>other users...</i>
</pre>
<p>After updating the configuration file, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> the <code>sshd.service</code>.
</p>
<p>Test user SSH keys (optionally add -v to see extra information):
</p>
<pre>$ ssh -T <i>gitlab</i>@<i>your_server</i>
</pre>
<h3><span class="mw-headline" id="Custom_SSH_connection">Custom SSH connection</span></h3>
<p>If you are running SSH on a non-standard port, you must change the GitLab user's SSH config:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/gitlab/.ssh/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">host localhost      # Give your setup a name (here: override localhost)
user gitlab         # Your remote git user
port 2222           # Your port number
hostname 127.0.0.1; # Your server name or IP</pre>
<p>You also need to change the corresponding options (e.g. ssh_user, ssh_host, admin_uri) in the <code>/etc/webapps/gitlab/gitlab.yml</code> file.
</p>
<h3><span class="mw-headline" id="Sending_emails_from_GitLab">Sending emails from GitLab</span></h3>
<p>GitLab can send emails either using a local <a href="../en/Mail_server.html" class="mw-redirect" title="Mail transfer agent">mail transfer agent</a> (via <i>sendmail</i>) or using <a href="https://en.wikipedia.org/wiki/SMTP" class="extiw" title="wikipedia:SMTP">SMTP</a>.
</p>
<p>To use <i>sendmail</i>, edit <code>/etc/webapps/gitlab/smtp_settings.rb</code> and comment out all lines. Then mail delivery should work without any further configuration in GitLab, assuming that the local mail transfer agent is configured properly.
</p>
<p>To use SMTP, configure the options in <code>smtp_settings.rb</code> according to your mail server. For example, to send via Gmail:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab/smtp_settings.rb</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">if Rails.env.production?
  Gitlab::Application.config.action_mailer.delivery_method = :smtp

  ActionMailer::Base.delivery_method = :smtp
  ActionMailer::Base.smtp_settings = {
    address:              'smtp.gmail.com',
    port:                 587,
    domain:               'gmail.com',
    user_name:            'username@gmail.com',
    password:             'application password',
    authentication:       'plain',
    enable_starttls_auto: true
  }
end
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Gmail will reject mails received this way (and send you a mail that it did). You will need to disable secure authentication (follow the link in the rejection mail) to work around this. The more secure approach is to enable two-factor authentication for <code>username@gmail.com</code> and to set up an <a rel="nofollow" class="external text" href="https://support.google.com/accounts/answer/185833">application specific password</a> for this configuration file.</div>
<h2><span class="mw-headline" id="Useful_tips">Useful tips</span></h2>
<h3><span class="mw-headline" id="Rake_tasks">Rake tasks</span></h3>
<p>A number of setup/maintenance/etc tasks are available through rake. To list them, go to Gitlab's home directory:
</p>
<pre>$ cd /usr/share/webapps/gitlab
</pre>
<p>and run:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ sudo -u gitlab $(cat environment | xargs) bundle exec rake -T | grep gitlab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">rake gitlab:app:check                         # GITLAB | Check the configuration of the GitLab Rails app
rake gitlab:backup:create                     # GITLAB | Create a backup of the GitLab system
rake gitlab:backup:restore                    # GITLAB | Restore a previously created backup
rake gitlab:check                             # GITLAB | Check the configuration of GitLab and its environment
rake gitlab:cleanup:block_removed_ldap_users  # GITLAB | Cleanup | Block users that have been removed in LDAP
rake gitlab:cleanup:dirs                      # GITLAB | Cleanup | Clean namespaces
rake gitlab:cleanup:repos                     # GITLAB | Cleanup | Clean repositories
rake gitlab:env:check                         # GITLAB | Check the configuration of the environment
rake gitlab:env:info                          # GITLAB | Show information about GitLab and its environment
rake gitlab:generate_docs                     # GITLAB | Generate sdocs for project
rake gitlab:gitlab_shell:check                # GITLAB | Check the configuration of GitLab Shell
rake gitlab:import:all_users_to_all_groups    # GITLAB | Add all users to all groups (admin users are added as owners)
rake gitlab:import:all_users_to_all_projects  # GITLAB | Add all users to all projects (admin users are added as masters)
rake gitlab:import:repos                      # GITLAB | Import bare repositories from gitlab_shell -&gt; repos_path into GitLab project instance
rake gitlab:import:user_to_groups[email]      # GITLAB | Add a specific user to all groups (as a developer)
rake gitlab:import:user_to_projects[email]    # GITLAB | Add a specific user to all projects (as a developer)
rake gitlab:satellites:create                 # GITLAB | Create satellite repos
rake gitlab:setup                             # GITLAB | Setup production application
rake gitlab:shell:build_missing_projects      # GITLAB | Build missing projects
rake gitlab:shell:install[tag,repo]           # GITLAB | Install or upgrade gitlab-shell
rake gitlab:shell:setup                       # GITLAB | Setup gitlab-shell
rake gitlab:sidekiq:check                     # GITLAB | Check the configuration of Sidekiq
rake gitlab:test                              # GITLAB | Run all tests
rake gitlab:web_hook:add                      # GITLAB | Adds a web hook to the projects
rake gitlab:web_hook:list                     # GITLAB | List web hooks
rake gitlab:web_hook:rm                       # GITLAB | Remove a web hook from the projects
rake setup                                    # GITLAB | Setup gitlab db
</pre>
<h3><span class="mw-headline" id="Backup_and_restore">Backup and restore</span></h3>
<p>Create a backup of the gitlab system:
</p>
<pre>$ cd /usr/share/webapps/gitlab
$ sudo -u gitlab $(cat environment | xargs) bundle exec rake gitlab:backup:create
</pre>
<p>Restore the previously created backup file <code>/var/lib/gitlab/backups/1556571328_2019_04_29_11.10.2_gitlab_backup.tar</code>:
</p>
<pre>$ cd /usr/share/webapps/gitlab
$ sudo -u gitlab $(cat environment | xargs) bundle exec rake gitlab:backup:restore BACKUP=1556571328_2019_04_29_11.10.2
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  Backup folder is set in <code>config/gitlab.yml</code>. GitLab backup and restore are documented here: <a rel="nofollow" class="external text" href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/administration/backup_restore/backup_gitlab.md">Backup</a> and <a rel="nofollow" class="external text" href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/administration/backup_restore/restore_gitlab.md">Restore</a>
</div>
<h3><span class="mw-headline" id="Enable_fast_SSH_key_lookup">Enable fast SSH key lookup</span></h3>
<p>Enable Fast SSH Key Lookup as explained in this page: <a rel="nofollow" class="external free" href="https://docs.gitlab.com/ee/administration/operations/fast_ssh_key_lookup.html">https://docs.gitlab.com/ee/administration/operations/fast_ssh_key_lookup.html</a>
</p>
<p>In short, edit <code>/etc/ssh/sshd_config</code>.
</p>
<p>Revert all changes done following this wiki (or revert <code>sshd_config</code> from the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span> package) and only add:
</p>
<pre>AuthorizedKeysCommand /var/lib/gitlab/gitlab-shell/bin/gitlab-shell-authorized-keys-check gitlab %u %k
AuthorizedKeysCommandUser gitlab
</pre>
<p>Finally <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> the <code>sshd.service</code>.
</p>
<h3><span class="mw-headline" id="Rails_console">Rails console</span></h3>
<p>Rails console can be used to interface directly with GitLab. See <a rel="nofollow" class="external autonumber" href="https://docs.gitlab.com/ee/administration/operations/rails_console.html">[3]</a> for details.
</p>
<p>To access Rails console: 
</p>
<pre>$ cd /usr/share/webapps/gitlab
$ sudo -u gitlab $(cat environment | xargs) bundle exec rails console
</pre>
<p>From here you can troubleshoot problems or do administration tasks like <a rel="nofollow" class="external text" href="https://docs.gitlab.com/ee/security/reset_user_password.html#use-a-rails-console">resetting user passwords</a>.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3>
<span id="HTTPS_is_not_green_.28gravatar_not_using_https.29"></span><span class="mw-headline" id="HTTPS_is_not_green_(gravatar_not_using_https)">HTTPS is not green (gravatar not using https)</span>
</h3>
<p>Valkey caches gravatar images, so if you have visited your GitLab with http, then enabled https, gravatar will load up the non-secure images. You can clear the cache by doing
</p>
<pre>$ cd /usr/share/webapps/gitlab
$ sudo -u gitlab $(cat environment | xargs) bundle exec rake cache:clear
</pre>
<p>as the gitlab user.
</p>
<h3><span class="mw-headline" id="Errors_after_updating">Errors after updating</span></h3>
<p>After updating the package from the AUR, the database migrations and asset updates will sometimes fail. These steps may resolve the issue, if a simple reboot does not.
</p>
<p>First, move to the gitlab installation directory.
</p>
<pre>$ cd /usr/share/webapps/gitlab
</pre>
<p>If every gitlab page gives a 500 error, then the database migrations and the assets are probably stale. If not, skip this step.
</p>
<pre>$ sudo -u gitlab $(cat environment | xargs) bundle exec rake db:migrate
</pre>
<p>If gitlab is constantly waiting for the deployment to finish, then the assets have probably not been recompiled.
</p>
<pre>$ sudo -u gitlab $(cat environment | xargs) bundle exec rake gitlab:assets:clean gitlab:assets:compile cache:clear
</pre>
<p>Finally, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>gitlab-puma.service</code>, <code>gitlab-sidekiq.service</code> and <code>gitlab-workhorse.service</code>.
</p>
<h3><span class="mw-headline" id="GitLab_Puma_cannot_access_non-default_repositories_directory">GitLab Puma cannot access non-default repositories directory</span></h3>
<p>If a custom repository storage directory is set in <code>/home</code>, disable the <code>ProtectHome=true</code> parameter in the <code>gitlab-puma.service</code> (see <a href="../en/Systemd.html#Drop-in_files" title="Systemd">systemd#Drop-in files</a> and the <a rel="nofollow" class="external text" href="https://forum.gitlab.com/t/cannot-change-repositores-location/9634/2">relevant forum thread on gitlab.com</a>).
</p>
<h3><span class="mw-headline" id="Failed_to_connect_to_Gitaly">Failed to connect to Gitaly</span></h3>
<p>Sometimes, the Gitaly service will not get started, leaving GitLab unable to connect to Gitaly. The solution is simple: <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> <code>gitlab-gitaly.service</code>.
</p>
<h3><span class="mw-headline" id="Failed_to_connect_via_SSH">Failed to connect via SSH</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-cut.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is being considered for removal.</b></p>
<div>
<b>Reason:</b> <code>/usr/share/webapps/gitlab-shell/bin/gitlab-shell</code> is the default shell. This section is relevant only for people who changed the shell to <code>/usr/share/webapps/gitlab-shell/bin/gitlab-shell-ruby</code> before. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:GitLab.html">Talk:GitLab</a>)</div>
</div>
<p>If git operations (-T, pull, clone, etc.) fails using ssh try changing the shell:
</p>
<pre># usermod -s /usr/share/webapps/gitlab-shell/bin/gitlab-shell gitlab
</pre>
<h3><span class="mw-headline" id="CSS_or_styles_issue">CSS or styles issue</span></h3>
<p>If you have any issues with styles and CSS not working, you may try to edit <code>/usr/share/webapps/gitlab/config/environments/production.rb</code> and change:
</p>
<pre> # Disable Rails's static asset server (Apache or nginx will already do this)
 config.public_file_server.enabled = false
</pre>
<p>to:
</p>
<pre> # Disable Rails's static asset server (Apache or nginx will already do this)
 config.public_file_server.enabled = true
</pre>
<h3><span class="mw-headline" id="The_server_does_not_support_push_options">The server does not support push options</span></h3>
<p>If you get an error like <code>fatal: the receiving end does not support push options</code> you might need to enable it for the GitLab Git user (<code>gitlab</code>) on the server. This can be done in the gitconfig:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/gitlab-shell/.gitconfig</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[receive]
         advertisePushOptions = true</pre>
<p>Alternatively one can set this with: 
</p>
<pre>$ sudo -u gitlab -H git config --global receive.advertisePushOptions true
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://docs.gitlab.com/ce/install/installation.html">Official installation documentation</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.com/gitlab-org/gitlab-recipes">GitLab recipes with further documentation on running it with several web servers</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.com/gitlab-org/gitlab-ce">GitLab source code</a></li>
<li><a rel="nofollow" class="external text" href="https://dokuwiki.tachtler.net/doku.php?id=tachtler:gitlab_archlinux">Tachtler's DokuWiki - GitLab ArchLinux (German installation guide)</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Git_web_interfaces.html" title="Category:Git web interfaces">Git web interfaces</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Sections_flagged_with_Template:Remove.html" title="Category:Sections flagged with Template:Remove">Sections flagged with Template:Remove</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=GitLab&amp;oldid=834380">https://wiki.archlinux.org/index.php?title=GitLab&amp;oldid=834380</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 23 May 2025, at 16:15.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki.svg" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul></ul>
</div>
</body>
</html>
