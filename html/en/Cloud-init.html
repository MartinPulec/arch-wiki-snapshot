<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Cloud-init - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Cloud-init rootpage-Cloud-init skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Configuration</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-Default_user_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Default_user_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Default user configuration</div>
			</a>
			
			<ul id="toc-Default_user_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Configuring_data_sources" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Configuring_data_sources">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Configuring data sources</div>
			</a>
			
			<ul id="toc-Configuring_data_sources-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Modules" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Modules">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Modules</div>
			</a>
			
			<ul id="toc-Modules-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Systemd_integration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Systemd_integration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Systemd integration</div>
		</a>
		
		<ul id="toc-Systemd_integration-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Using" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Using">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Using</div>
		</a>
		
			<button aria-controls="toc-Using-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Using subsection</span>
			</button>
		
		<ul id="toc-Using-sublist" class="vector-toc-list">
			<li id="toc-Archiso" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Archiso">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Archiso</div>
			</a>
			
			<ul id="toc-Archiso-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-FAQ" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#FAQ">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>FAQ</div>
			</a>
			
			<ul id="toc-FAQ-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Unmounted_image" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Unmounted_image">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Unmounted image</div>
			</a>
			
			<ul id="toc-Unmounted_image-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-"device_/dev/sr0_with_label_cidata_not_a_valid_seed"' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#"device_/dev/sr0_with_label_cidata_not_a_valid_seed"'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>"device /dev/sr0 with label cidata not a valid seed"</div>
			</a>
			
			<ul id='toc-"device_/dev/sr0_with_label_cidata_not_a_valid_seed"-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-"unhandled_non-multipart_[...]_ssh_authorized_keys"' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#"unhandled_non-multipart_[...]_ssh_authorized_keys"'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>"unhandled non-multipart [...] ssh_authorized_keys"</div>
			</a>
			
			<ul id='toc-"unhandled_non-multipart_[...]_ssh_authorized_keys"-sublist' class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Cloud-init</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 2 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-2" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">2 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Cloud-init" title="Cloud-init – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Cloud-init" title="Cloud-init – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><a rel="nofollow" class="external text" href="https://cloud-init.io/">Cloud-init</a> is a package that contains utilities for early initialization of cloud instances. It is needed in Arch Linux images that are built with the intention of being launched in cloud environments like OpenStack, <a href="../en/Arch_Linux_AMIs_for_Amazon_Web_Services.html" class="mw-redirect" title="AWS">AWS</a> etc.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cloud-init">cloud-init</a></span> package.
</p>
<p>If you intend to use the <a rel="nofollow" class="external text" href="https://cloudinit.readthedocs.io/en/latest/reference/modules.html#growpart">growpart module</a> you will also need the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cloud-guest-utils">cloud-guest-utils</a></span> package.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>This section only discusses the most basic settings. For a full list of available configuration options, please see the <a rel="nofollow" class="external text" href="https://cloudinit.readthedocs.io">cloud-init documentation</a>.
</p>
<p>The main configuration file is <code>/etc/cloud/cloud.cfg</code>. Optionally, additional <code>*.cfg</code> files to be loaded can be placed in <code>/etc/cloud/cloud.cfg.d</code>. All of their contents will be <a rel="nofollow" class="external text" href="https://cloudinit.readthedocs.io/en/latest/reference/merging.html">merged</a>.
</p>
<p>The default configuration shipped with cloud-init 19.3 and later should work out of the box with most major cloud environments. In rough terms, it does the following:
</p>
<ul>
<li>Disable the root user, create a user <code>arch</code> for logging in</li>
<li>Rely on cloud-init's built-in detection for data sources</li>
<li>Run all modules known to work on Arch Linux</li>
</ul>
<p>Depending on the use case, the default configuration might need to be adapted.
</p>
<h3><span class="mw-headline" id="Default_user_configuration">Default user configuration</span></h3>
<p>The default configuration includes the following contents (comments omitted for brevity):
</p>
<pre>users:
   - default
</pre>
<p>The users to be added to the system. The special name <code>default</code> is just a reference to the <code>default_user</code> in the <code>system_info</code> section (see below), but <a rel="nofollow" class="external text" href="https://cloudinit.readthedocs.io/en/latest/reference/examples.html#including-users-and-groups">the syntax</a> supports configuring arbitrary users with many options. The first user in this list will be considered the "default" user by other modules, for example the one that sets up SSH keys passed in from the cloud environment.
</p>
<pre>disable_root: true
</pre>
<p>Disable root SSH access. You may also delete the root user password on the cloud image:
</p>
<pre># passwd -d root
</pre>
<pre>system_info:
   default_user:
     name: arch
     lock_passwd: true
     gecos: arch Cloud User
     groups: [wheel, adm]
     sudo: ["ALL=(ALL) NOPASSWD:ALL"]
     shell: /bin/bash
</pre>
<p>This is the specification of the distribution's default user:
</p>
<ul>
<li>the default user's name will be <code>arch</code>
</li>
<li>the default user is password locked, which means you can only log into the instance with the SSH keys configured during boot</li>
<li>the default user will be added to the groups <code>adm</code> and <code>wheel</code>
</li>
<li>the default user is allowed passwordless <code>sudo</code> usage</li>
<li>the default user's shell is <code>/bin/bash</code>
</li>
</ul>
<p>Note that the user specified here will only be created if the special user "default" is included in the <code>users:</code> section above (or the section is omitted entirely).
</p>
<h3><span class="mw-headline" id="Configuring_data_sources">Configuring data sources</span></h3>
<p>Data Sources define how the instance metadata is pulled during boot. This depends on the cloud environment (OpenStack, AWS, OpenNebula etc.) you are running your instance in. Under the hood, this translates to a corresponding module which implements a few methods defined in a common interface.
</p>
<p>The default configuration specifies no data sources, which means that cloud-init will attempt to auto-detect the cloud environment. However, some environments cannot be detected or may require special configuration to work. In this case, the data sources to be used can be explictly specified and configured. Refer to the <a rel="nofollow" class="external text" href="https://cloudinit.readthedocs.io/en/latest/reference/datasources.html#known-sources">list of known data sources</a> in the documentation.
</p>
<p>To specify a list of data sources to be used in your <code>/etc/cloud/cloud.cfg</code> add something like this:
</p>
<pre>datasource_list: [ NoCloud, ConfigDrive, OpenNebula, Azure, AltCloud, OVF, MAAS, GCE, OpenStack, CloudSigma, Ec2, CloudStack, None ]
</pre>
<p>This instructs cloud-init what modules to load while trying to download instance metadata. Optionally further configuration parameters may be passed specific to each datasource as follows:
</p>
<pre>datasource:
  OpenStack:
    metadata_urls: [ 'http://169.254.169.254:80' ]
    dsmode: net
</pre>
<p>The above configuration tells OpenStack datasource to use the url <code>http://169.254.169.254:80</code> to download metadata and to run after network initialization, both of which are the default behaviour and may be omitted.
</p>
<h3><span class="mw-headline" id="Modules">Modules</span></h3>
<p>Cloud-init comes with a <a rel="nofollow" class="external text" href="https://cloudinit.readthedocs.io/en/latest/reference/modules.html">set of modules</a> that can be enabled or disabled in the configuration. The default configuration enables all modules that are known to work on Arch Linux. Omitted modules include e.g. those specific to other distributions or operating systems.
</p>
<p>The fact that a module is enabled usually does not mean that it will actually do anything. It will however check if any configuration relevant to it was passed in, e.g. from the cloud environment via the data source. Only then it will attempt to act. As such, enabling all modules usually helps to maximize compatibility with cloud environments. Nevertheless, modules known to be not needed can be removed from configuration, e.g. to improve start-up times. You can use <code>cloud-init analyze</code> on a booted instance to see how much time was spent on individual modules.
</p>
<p>Some modules declare to cloud-init which distributions they have been verified for. Even if you specify that you want to run them, they will refuse to run unless the distribution specified in <code>cloud.cfg</code> is one of the verified distributions for that module. If you need to override this behavior to run a module on Arch anyway, add the module to the <code>unverified_modules</code> section in the cloud config, e.g.:
</p>
<pre>unverified_modules: ['ssh-import-id']
</pre>
<h2><span class="mw-headline" id="Systemd_integration">Systemd integration</span></h2>
<p>Package cloud-init provides four <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.service"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.service.5">systemd.service(5)</a></span>, two <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.target"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.target.5">systemd.target(5)</a></span>, and a <span class="plainlinks archwiki-template-man" title="$ man 7 systemd.generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.generator.7">systemd.generator(7)</a></span>, whose dependencies are constructed in a way that they are activated in the sequence listed:
</p>
<ul>
<li>
<code>cloud-init-generator</code>. Determines availability of any data source and enables or disables <code>cloud-init.target</code>
</li>
<li>
<code>cloud-init-local.service</code>. Only requires the filesystems to be up. Executes <code>cloud-init init --local</code>
</li>
<li>
<code>cloud-init.service</code>. Requires the network to be up. Executes <code>cloud-init init</code>
</li>
<li>
<code>cloud-config.target</code>. Corresponds to the cloud-config upstart event "to inform third parties that cloud-config is available"</li>
<li>
<code>cloud-config.service</code>. Executes <code>cloud-init modules --mode=config</code>
</li>
<li>
<code>cloud-final.service</code>. Executes <code>cloud-init modules --mode=final</code>
</li>
<li>
<code>cloud-init.target</code>. Reached when all services have been started</li>
</ul>
<p>The <a href="../en/Arch_Linux_AMIs_for_Amazon_Web_Services.html" title="Arch Linux AMIs for Amazon Web Services">Uplink Labs EC2 images</a> have all of them enabled, although that appears to be overkill due to the dependencies. When preparing an image, enabling <code>cloud-init.service</code> and <code>cloud-final.service</code> should be sufficient. Note that this does not mean that the cloud-init services will actually be run - that still depends on the generator enabling the <code>cloud-init.target</code> on early boot.
</p>
<p>See also the <a rel="nofollow" class="external text" href="https://cloudinit.readthedocs.io/en/latest/explanation/boot.html">cloud-init boot stages documentation</a> for more information.
</p>
<h2><span class="mw-headline" id="Using">Using</span></h2>
<h3><span class="mw-headline" id="Archiso">Archiso</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Merge-arrows-2.svg" decoding="async" width="36" height="40" class="mw-file-element"></span></span><b>This article or section is a candidate for merging with <a href="../en/Install_Arch_Linux_via_SSH.html#Installation_on_a_headless_server" title="Install Arch Linux via SSH">Install Arch Linux via SSH#Installation on a headless server</a>.</b></p>
<div>
<b>Notes:</b> It gives more details and illustrates Archiso's cloud-init usage on bare metal. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Cloud-init.html">Talk:Cloud-init</a>)</div>
</div>
<p>Here is how to test an <a href="../en/Archiso.html" title="Archiso">Archiso</a> with cloud-init (see <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archiso/-/issues/27">archlinux/archiso#27</a>) using <a href="../en/QEMU.html" title="QEMU">QEMU</a>:
</p>
<p>Create a <code>user-data</code> file in YAML format for cloud-init containing username(s) and public SSH key(s).  You can either use the convenient <code>create_cloud-init.sh</code> script proposed in <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archiso/-/merge_requests/117/diffs">archiso Merge Request #117</a>, or just hand write as below, as-is or adding any <a rel="nofollow" class="external text" href="https://cloudinit.readthedocs.io/en/latest/reference/examples.html">additional options shown on the cloud-init documentation</a>. Beware that the <code>#cloud-config</code> is NOT a YAML comment, but is required to be present by cloud-init.
</p>
<pre>#cloud-config
users:
  - name: vorburger
    ssh_authorized_keys:
      - ssh-rsa (...)
</pre>
<p>We can use <code>meta-data</code> as well, but do not have to, so we can just make that an empty file (but it has to exist):
</p>
<pre>$ touch meta-data
</pre>
<p>Then build a <code>cloud-init.iso</code> containing (only) the <code>user-data</code> and <code>meta-data</code> using <i>xorriso</i> from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libisoburn">libisoburn</a></span>:
</p>
<pre>$ xorriso -as genisoimage -output cloud-init.iso -volid CIDATA -joliet -rock user-data meta-data
</pre>
<p>Now add this <code>cloud-init.iso</code> as an additional second drive to the VM, using e.g. <code>qemu-system-x86_64 ... -cdrom cloud-init.iso</code>, or if using <a href="../en/Archiso.html" title="Archiso">archiso</a> then with the <code>run_archiso -c</code>.
</p>
<p>You should then be able to SSH into the machine using as the chosen user and public key supplied in <code>user-data</code>. Note that it may take a moment to be available, due to a delay at the boot menu; e.g. the standard releng <code>archlinux*.iso</code> will wait there for 30s at start-up. For frequent re-testing of new instances with changing hostkeys, <code>ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null</code> may be handy.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> <a rel="nofollow" class="external text" href="https://cloudinit.readthedocs.io/en/latest/reference/datasources/nocloud.html">Cloud-init's nocloud documenation</a> explains an alternative approach, based on using <code>-smbios type=1,serial=ds=nocloud</code>. This can be accomplished locally on a host running QEMU and an ad hoc Python webserver as described in the <a rel="nofollow" class="external text" href="https://cloudinit.readthedocs.io/en/latest/tutorial/qemu.html">cloud-init tutorial</a>.  To boot on bare metal you could just "burn" two separate USB sticks, for <code>archlinux*.iso</code> and <code>cloud-init.iso</code>, and boot from <code>archlinux*.iso</code>. When doing this, cloud-init will run using the configuration on <code>cloud-init.iso</code>.</div>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="FAQ">FAQ</span></h3>
<p><a rel="nofollow" class="external text" href="https://cloudinit.readthedocs.io/en/latest/reference/faq.html">The cloud-init FAQ</a> has useful information about how to debug cloud-init, including where its log files are, and how to re-run datasource detection and cloud-init during development.
</p>
<h3><span class="mw-headline" id="Unmounted_image">Unmounted image</span></h3>
<p>The first thing to check is often if the cloud-init image (ISO) is seen, with <code>lsblk</code> and <code>mount</code>.
</p>
<h3>
<span id=".22device_.2Fdev.2Fsr0_with_label_cidata_not_a_valid_seed.22"></span><span class="mw-headline" id='"device_/dev/sr0_with_label_cidata_not_a_valid_seed"'>"device /dev/sr0 with label cidata not a valid seed"</span>
</h3>
<p><code>datasourcenocloud.py warning device /dev/sr0 with label cidata not a valid seed</code> appears when the nocloud datasource sees an ISO that e.g. only contains <code>user-data</code> but no <code>meta-data</code> - both are required, even if one is empty.
</p>
<h3>
<span id=".22unhandled_non-multipart_.5B....5D_ssh_authorized_keys.22"></span><span class="mw-headline" id='"unhandled_non-multipart_[...]_ssh_authorized_keys"'>"unhandled non-multipart [...] ssh_authorized_keys"</span>
</h3>
<p><code>unhandled non-multipart (text-x-not-multipart) userdata 'b'ssh_authorized_keys</code> appears when <code>user-data</code> YAML does not start with <code>#cloud-config</code> (no space, apparently; even though <code>yamllint</code> will tell you that it is <code>missing starting space in comment</code>).
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul><li><a rel="nofollow" class="external text" href="https://cloudinit.readthedocs.io/en/latest/">cloud-init documentation</a></li></ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Virtualization.html" title="Category:Virtualization">Virtualization</a></li>
<li><a href="../en/Category:Networking.html" title="Category:Networking">Networking</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Cloud-init&amp;oldid=812783">https://wiki.archlinux.org/index.php?title=Cloud-init&amp;oldid=812783</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 23 July 2024, at 07:29.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
