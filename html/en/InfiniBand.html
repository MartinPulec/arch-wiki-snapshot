<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>InfiniBand - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-InfiniBand rootpage-InfiniBand skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Introduction" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Introduction">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Introduction</div>
		</a>
		
			<button aria-controls="toc-Introduction-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Introduction subsection</span>
			</button>
		
		<ul id="toc-Introduction-sublist" class="vector-toc-list">
			<li id="toc-Overview" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Overview">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Overview</div>
			</a>
			
			<ul id="toc-Overview-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Affordable_used_equipment" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Affordable_used_equipment">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Affordable used equipment</div>
			</a>
			
			<ul id="toc-Affordable_used_equipment-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Bandwidth" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Bandwidth">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Bandwidth</div>
			</a>
			
			<ul id="toc-Bandwidth-sublist" class="vector-toc-list">
				<li id="toc-Signal_transfer_rates" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Signal_transfer_rates">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.1</span>Signal transfer rates</div>
			</a>
			
			<ul id="toc-Signal_transfer_rates-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Effective_throughput" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Effective_throughput">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.2</span>Effective throughput</div>
			</a>
			
			<ul id="toc-Effective_throughput-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Latency" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Latency">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.4</span>Latency</div>
			</a>
			
			<ul id="toc-Latency-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Backwards_compatibility" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Backwards_compatibility">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.5</span>Backwards compatibility</div>
			</a>
			
			<ul id="toc-Backwards_compatibility-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Cables" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Cables">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.6</span>Cables</div>
			</a>
			
			<ul id="toc-Cables-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Terminology" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Terminology">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Terminology</div>
		</a>
		
			<button aria-controls="toc-Terminology-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Terminology subsection</span>
			</button>
		
		<ul id="toc-Terminology-sublist" class="vector-toc-list">
			<li id="toc-Hardware" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Hardware">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Hardware</div>
			</a>
			
			<ul id="toc-Hardware-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-GUID" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#GUID">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>GUID</div>
			</a>
			
			<ul id="toc-GUID-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Network_Management" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Network_Management">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Network Management</div>
			</a>
			
			<ul id="toc-Network_Management-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Installation</div>
		</a>
		
			<button aria-controls="toc-Installation-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Installation subsection</span>
			</button>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
			<li id="toc-Upgrade_firmware" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Upgrade_firmware">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Upgrade firmware</div>
			</a>
			
			<ul id="toc-Upgrade_firmware-sublist" class="vector-toc-list">
				<li id="toc-For_Mellanox" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#For_Mellanox">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.1</span>For Mellanox</div>
			</a>
			
			<ul id="toc-For_Mellanox-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-For_Intel/QLogic" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#For_Intel/QLogic">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.2</span>For Intel/QLogic</div>
			</a>
			
			<ul id="toc-For_Intel/QLogic-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Kernel_modules" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Kernel_modules">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Kernel modules</div>
			</a>
			
			<ul id="toc-Kernel_modules-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Subnet_manager" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Subnet_manager">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Subnet manager</div>
			</a>
			
			<ul id="toc-Subnet_manager-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enable_port" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enable_port">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4</span>Enable port</div>
			</a>
			
			<ul id="toc-Enable_port-sublist" class="vector-toc-list">
				<li id="toc-Software_subnet_manager" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Software_subnet_manager">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4.1</span>Software subnet manager</div>
			</a>
			
			<ul id="toc-Software_subnet_manager-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-TCP/IP_(IPoIB)" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#TCP/IP_(IPoIB)">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>TCP/IP (IPoIB)</div>
		</a>
		
			<button aria-controls="toc-TCP/IP_(IPoIB)-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle TCP/IP (IPoIB) subsection</span>
			</button>
		
		<ul id="toc-TCP/IP_(IPoIB)-sublist" class="vector-toc-list">
			<li id="toc-Connection_mode" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connection_mode">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Connection mode</div>
			</a>
			
			<ul id="toc-Connection_mode-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-MTU" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#MTU">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>MTU</div>
			</a>
			
			<ul id="toc-MTU-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Finetuning_connection_mode_and_MTU" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Finetuning_connection_mode_and_MTU">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Finetuning connection mode and MTU</div>
			</a>
			
			<ul id="toc-Finetuning_connection_mode_and_MTU-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Soft_RoCE_(RXE)" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Soft_RoCE_(RXE)">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Soft RoCE (RXE)</div>
		</a>
		
		<ul id="toc-Soft_RoCE_(RXE)-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Remote_data_storage" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Remote_data_storage">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Remote data storage</div>
		</a>
		
			<button aria-controls="toc-Remote_data_storage-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Remote data storage subsection</span>
			</button>
		
		<ul id="toc-Remote_data_storage-sublist" class="vector-toc-list">
			<li id="toc-targetcli" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#targetcli">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>targetcli</div>
			</a>
			
			<ul id="toc-targetcli-sublist" class="vector-toc-list">
				<li id="toc-Installing_and_using" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Installing_and_using">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1.1</span>Installing and using</div>
			</a>
			
			<ul id="toc-Installing_and_using-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Create_backstores" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Create_backstores">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1.2</span>Create backstores</div>
			</a>
			
			<ul id="toc-Create_backstores-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-iSCSI" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#iSCSI">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2</span>iSCSI</div>
			</a>
			
			<ul id="toc-iSCSI-sublist" class="vector-toc-list">
				<li id="toc-Over_IPoIB" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Over_IPoIB">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2.1</span>Over IPoIB</div>
			</a>
			
			<ul id="toc-Over_IPoIB-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Over_iSER" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Over_iSER">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2.2</span>Over iSER</div>
			</a>
			
			<ul id="toc-Over_iSER-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Adding_to_/etc/fstab" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Adding_to_/etc/fstab">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2.3</span>Adding to /etc/fstab</div>
			</a>
			
			<ul id="toc-Adding_to_/etc/fstab-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Network_segmentation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Network_segmentation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Network segmentation</div>
		</a>
		
		<ul id="toc-Network_segmentation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-SDP_(Sockets_Direct_Protocol)" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#SDP_(Sockets_Direct_Protocol)">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>SDP (Sockets Direct Protocol)</div>
		</a>
		
		<ul id="toc-SDP_(Sockets_Direct_Protocol)-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Diagnosing_and_benchmarking" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Diagnosing_and_benchmarking">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">9</span>Diagnosing and benchmarking</div>
		</a>
		
			<button aria-controls="toc-Diagnosing_and_benchmarking-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Diagnosing and benchmarking subsection</span>
			</button>
		
		<ul id="toc-Diagnosing_and_benchmarking-sublist" class="vector-toc-list">
			<li id="toc-ibstat_-_View_a_computer's_IB_GUIDs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ibstat_-_View_a_computer's_IB_GUIDs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.1</span>ibstat - View a computer's IB GUIDs</div>
			</a>
			
			<ul id="toc-ibstat_-_View_a_computer's_IB_GUIDs-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-ibhosts_-_View_all_hosts_on_IB_network" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ibhosts_-_View_all_hosts_on_IB_network">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.2</span>ibhosts - View all hosts on IB network</div>
			</a>
			
			<ul id="toc-ibhosts_-_View_all_hosts_on_IB_network-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-ibswitches_-_View_all_switches_on_IB_network" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ibswitches_-_View_all_switches_on_IB_network">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.3</span>ibswitches - View all switches on IB network</div>
			</a>
			
			<ul id="toc-ibswitches_-_View_all_switches_on_IB_network-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-iblinkinfo_-_View_link_information_on_IB_network" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#iblinkinfo_-_View_link_information_on_IB_network">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.4</span>iblinkinfo - View link information on IB network</div>
			</a>
			
			<ul id="toc-iblinkinfo_-_View_link_information_on_IB_network-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-ibping_-_Ping_another_IB_device" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ibping_-_Ping_another_IB_device">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.5</span>ibping - Ping another IB device</div>
			</a>
			
			<ul id="toc-ibping_-_Ping_another_IB_device-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-ibdiagnet_-_Show_diagnostic_information_for_entire_subnet" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ibdiagnet_-_Show_diagnostic_information_for_entire_subnet">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.6</span>ibdiagnet - Show diagnostic information for entire subnet</div>
			</a>
			
			<ul id="toc-ibdiagnet_-_Show_diagnostic_information_for_entire_subnet-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-qperf_-_Measure_performance_over_RDMA_or_TCP/IP" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#qperf_-_Measure_performance_over_RDMA_or_TCP/IP">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.7</span>qperf - Measure performance over RDMA or TCP/IP</div>
			</a>
			
			<ul id="toc-qperf_-_Measure_performance_over_RDMA_or_TCP/IP-sublist" class="vector-toc-list">
				<li id="toc-TCP/IP_over_IPoIB" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#TCP/IP_over_IPoIB">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.7.1</span>TCP/IP over IPoIB</div>
			</a>
			
			<ul id="toc-TCP/IP_over_IPoIB-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-iperf_-_Measure_performance_over_TCP/IP" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#iperf_-_Measure_performance_over_TCP/IP">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.8</span>iperf - Measure performance over TCP/IP</div>
			</a>
			
			<ul id="toc-iperf_-_Measure_performance_over_TCP/IP-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Common_problems_/_FAQ" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Common_problems_/_FAQ">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">10</span>Common problems / FAQ</div>
		</a>
		
			<button aria-controls="toc-Common_problems_/_FAQ-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Common problems / FAQ subsection</span>
			</button>
		
		<ul id="toc-Common_problems_/_FAQ-sublist" class="vector-toc-list">
			<li id="toc-Connection_problems" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connection_problems">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">10.1</span>Connection problems</div>
			</a>
			
			<ul id="toc-Connection_problems-sublist" class="vector-toc-list">
				<li id="toc-Link,_physical_state_and_port_state" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Link,_physical_state_and_port_state">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">10.1.1</span>Link, physical state and port state</div>
			</a>
			
			<ul id="toc-Link,_physical_state_and_port_state-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-getaddrinfo_failed:_Name_or_service_not_known" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#getaddrinfo_failed:_Name_or_service_not_known">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">10.1.2</span>getaddrinfo failed: Name or service not known</div>
			</a>
			
			<ul id="toc-getaddrinfo_failed:_Name_or_service_not_known-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Speed_problems" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Speed_problems">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">10.2</span>Speed problems</div>
			</a>
			
			<ul id="toc-Speed_problems-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">InfiniBand</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/InfiniBand" title="InfiniBand – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p>This page explains how to set up, diagnose, and benchmark <a href="https://en.wikipedia.org/wiki/InfiniBand" class="extiw" title="wikipedia:InfiniBand">InfiniBand</a> networks.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Introduction">Introduction</span></h2>
<h3><span class="mw-headline" id="Overview">Overview</span></h3>
<p>InfiniBand (abbreviated IB) is an alternative to Ethernet and Fibre Channel. IB provides high bandwidth and low latency. IB can transfer data directly to and from a storage device on one machine to userspace on another machine, bypassing and avoiding the overhead of a system call. IB adapters can handle the networking protocols, unlike Ethernet networking protocols which are ran on the CPU. This allows the OS's and CPU's to remain free while the high bandwidth transfers take place, which can be a real problem with 10Gb+ Ethernet.
</p>
<p>IB hardware is made by Mellanox (which merged with Voltaire, and is heavily backed by Oracle) and Intel (which acquired QLogic's IB division in 2012). Mellanox was acquired by Nvidia in 2019. IB is most often used by supercomputers, clusters, and data centers. IBM, HP, and Cray are also members of the InfiniBand Steering Committee. Facebook, Twitter, eBay, YouTube, and PayPal are examples of IB users.
</p>
<p>IB software is developed under the <a rel="nofollow" class="external text" href="https://www.openfabrics.org/">OpenFabrics Open Source Alliance</a>
</p>
<h3><span class="mw-headline" id="Affordable_used_equipment">Affordable used equipment</span></h3>
<p>With large businesses benefiting so much from jumping to newer versions, the maximum length limitations of passive IB cabling, the high cost of active IB cabling, and the more technically complex setup than Ethernet, the used IB market is heavily saturated, allowing used IB devices to affordably be used at home or smaller businesses for their internal networks.
</p>
<h3><span class="mw-headline" id="Bandwidth">Bandwidth</span></h3>
<h4><span class="mw-headline" id="Signal_transfer_rates">Signal transfer rates</span></h4>
<p>IB transfer rates corresponded in the beginning to the maximum supported by PCI Express (abbreviated PCIe), later on, as PCIe made less progress, the transfer rates corresponded to other I/O technologies and the number of PCIe lanes per port was increased instead. It launched using SDR (Single Data Rate) with a signaling rate of 2.5Gb/s per lane (corresponding with PCI Express v1.0), and has added: DDR (Double Data Rate) at 5Gb/s (PCI Express v2.0); QDR (Quad Data Rate) at 10Gb/s (matching the throughput of PCI Express 3.0 with improved coding of PCIe 3.0 instead of the signaling rate); and FDR (Fourteen Data Rate) at 14.0625Gbps (matching 16GFC Fibre Channel). IB is now delivering EDR (Enhanced Data Rate) at 25Gb/s (matching 25Gb Ethernet). Planned around 2017 will be HDR (High Data Rate) at 50Gb/s.
</p>
<h4><span class="mw-headline" id="Effective_throughput">Effective throughput</span></h4>
<p>Because SDR, DDR, and QDR versions use 8/10 encoding (8 bits of data takes 10 bits of signaling), effective throughput for these is lowered to 80%: SDR at 2Gb/s/link; DDR at 4Gb/s/link; and QDR at 8Gb/s/link. Starting with FDR, IB uses 64/66 encoding, allowing a higher effective throughput to signaling rate ratio of 96.97%: FDR at 13.64Gb/s/link; EDR at 24.24Gb/s/lane; and HDR at 48.48Gb/s/link.
</p>
<p>IB devices are capable of sending data over multiple links, though commercial products standardized around 4 links per cable. 
</p>
<p>When using the common 4X link devices, this effectively allows total effective throughputs of: SDR of 8Gb/s; DDR of 16Gb/s; QDR of 32Gb/s; FDR of 54.54Gb/s; EDR of 96.97Gb/s; and HDR of 193.94Gb/s.
</p>
<h3><span class="mw-headline" id="Latency">Latency</span></h3>
<p>IB's latency is incredibly small: SDR (5us); DDR (2.5us); QDR (1.3us); FDR (0.7us); EDR (0.5us); and HDR (&lt; 0.5us). For comparison 10Gb Ethernet is more like 7.22us, ten times more than FDR's latency.
</p>
<h3><span class="mw-headline" id="Backwards_compatibility">Backwards compatibility</span></h3>
<p>IB devices are almost always backwards compatible. Connections should be established at the lowest common denominator. A DDR adapter meant for a PCI Express 8x slot should work in a PCI Express 4x slot (with half the bandwidth).
</p>
<h3><span class="mw-headline" id="Cables">Cables</span></h3>
<p>IB passive copper cables can be up to 7 meters using up to QDR, and 3 meters using FDR.
</p>
<p>IB active fiber (optical) cables can be up to 300 meters using up to FDR (only 100 meters on FDR10).
</p>
<p>Mellanox MetroX devices exist which allow up to 80 kilometer connections. Latency increases by about 5us per kilometer.
</p>
<p>An IB cable can be used to directly link two computers without a switch; IB cross-over cables do not exist.
</p>
<h2><span class="mw-headline" id="Terminology">Terminology</span></h2>
<h3><span class="mw-headline" id="Hardware">Hardware</span></h3>
<p>Adapters, switches, routers, and bridges/gateways must be specifically made for IB.
</p>
<dl>
<dt>HCA (Host Channel Adapter)</dt>
<dd>Like an Ethernet NIC (Network Interface Card). Connects the IB cable to the PCI Express bus, at the full speed of the bus if the proper generation of HCA is used. An end node on an IB network, executes transport-level functions, and supports the IB verbs interface.</dd>
<dt>Switch</dt>
<dd>Like an Ethernet NIC. Moves packets from one link to another on the same IB subnet.</dd>
<dt>Router</dt>
<dd>Like an Ethernet router. Moves packets between different IB subnets.</dd>
<dt>Bridge/Gateway</dt>
<dd>A standalone piece of hardware, or a computer performing this function. Bridges IB and Ethernet networks.</dd>
</dl>
<h3><span class="mw-headline" id="GUID">GUID</span></h3>
<p>Like Ethernet MAC addresses, but a device has multiple GUID's. Assigned by the hardware manufacturer, and remains the same through reboots. 64-bit addresses (24-bit manufacturer prefix and 40-bit device identifier). Given to adapters, switches, routers, and bridges/gateways.
</p>
<dl>
<dt>Node GUID</dt>
<dd>Identifies the HCA, Switch, or Router</dd>
<dt>Port GUID</dt>
<dd>Identifies a port on a HCA, Switch, or Router (even a HCA often has multiple ports)</dd>
<dt>System GUID</dt>
<dd>Allows treating multiple GUIDs as one entity</dd>
<dt>LID (Local IDentifier)</dt>
<dd>16-bit addresses, assigned by the Subnet Manager when picked up by the Subnet Manager. Used for routing packets. Not persistent through reboots.</dd>
</dl>
<h3><span class="mw-headline" id="Network_Management">Network Management</span></h3>
<dl>
<dt>SM (Subnet Manager)</dt>
<dd>Actively manages an IB subnet. Can be implemented as a software program on a computer connected to the IB network, built in to an IB switch, or as a specialized IB device. Initializes and configures everything else on the subnet, including assigning LIDs (Local IDentifiers). Establishes traffic paths through the subnet. Isolates faults. Prevents unauthorized Subnet Managers. You can have multiple switches all on one subnet, under one Subnet Manager. You can have redundant Subnet Managers on one subnet, but only one can be active at a time.</dd>
<dt>MAD (MAnagement Datagram)</dt>
<dd>Standard message format for subnet manager to and from IB device communication, carried by a UD (Unreliable Datagram).</dd>
<dt>UD (Unreliable Datagram)</dt>
<dd></dd>
</dl>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>First install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=rdma-core">rdma-core</a></span> which contains all core libraries and daemons.
</p>
<h3><span class="mw-headline" id="Upgrade_firmware">Upgrade firmware</span></h3>
<p>Running the most recent firmware can give significant performance increases, and fix connectivity issues.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Be careful or the device may be bricked!</div>
<h4><span class="mw-headline" id="For_Mellanox">For Mellanox</span></h4>
<ul>
<li>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mstflint/">mstflint</a></span><sup><small>AUR</small></sup>
</li>
<li>Determine your adapter's PCI device ID (in this example, "05:00.0" is the adapter's PCI device ID)</li>
</ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ lspci | grep Mellanox</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"><b>05:00.0</b> InfiniBand: Mellanox Technologies MT25418 [ConnectX VPI PCIe 2.0 2.5GT/s - IB DDR / 10GigE] (rev a0)</pre>
<ul><li>Determine what firmware version your adapter has, and your adapter's PSID (more specific than just a model number - specific to a compatible set of revisions)</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># mstflint -d &lt;adapter PCI device ID&gt; query</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
FW Version:      <b>2.7.1000</b>
...
PSID:            <b>MT_04A0110002</b></pre>
<ul>
<li>Check latest firmware version
<ul>
<li>Visit <a rel="nofollow" class="external text" href="https://www.mellanox.com/page/firmware_download">Mellanox's firmware download page</a> (this guide incorporates this link's "firmware burning instructions", using its mstflint option)</li>
<li>Choose the category of device you have</li>
<li>Locate your device's PSID on their list, that mstflint gave you</li>
<li>Examine the Firmware Image filename to see if it is more recent than your adapter's FW Version, i.e. <code>fw-25408-2_9_1000-MHGH28-XTC_A1.bin.zip</code>, is version <code>2.9.1000</code>
</li>
</ul>
</li>
<li>If there is a more recent version, download new firmware and burn it to your adapter</li>
</ul>
<pre>$ unzip &lt;<i>firmware .bin.zip file name</i>&gt;
# mstflint -d &lt;<i>adapter PCI device ID</i>&gt; -i &lt;<i>firmware .bin file name</i>&gt; burn
</pre>
<h4>
<span id="For_Intel.2FQLogic"></span><span class="mw-headline" id="For_Intel/QLogic">For Intel/QLogic</span>
</h4>
<p>Search for the model number (or a substring) over at <a rel="nofollow" class="external text" href="https://downloadcenter.intel.com/">Intel Download Center</a> and follow the instructions. The downloaded software will probably need to be run from RHEL/CentOS or SUSE/OpenSUSE.
</p>
<h3><span class="mw-headline" id="Kernel_modules">Kernel modules</span></h3>
<p>Edit <code>/etc/rdma/modules/rdma.conf</code> and <code>/etc/rdma/modules/infiniband.conf</code> to your liking. Then load the kernel modules written in these files such as <code>ib_ipoib</code>, or just reboot the system. (Although there should be no need to do this, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> both <code>rdma-load-modules@rdma.service</code> and <code>rdma-load-modules@infiniband.service</code> if kernel modules are not loaded correctly. Rebooting the system will be fine).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <a rel="nofollow" class="external text" href="https://bugzilla.redhat.com/show_bug.cgi?id=965829">Due to how the kernel stacks are handled</a>, changes to <code>/etc/rdma/modules/rdma.conf</code> only take effect max once every boot, when <code>rdma-load-modules@*.service</code> is started for first time. Restarting <code>rdma-load-modules@*.service</code> has no effect.</div>
<h3><span class="mw-headline" id="Subnet_manager">Subnet manager</span></h3>
<p>Each IB network requires at least one subnet manager. Without one, devices may show having a link, but will never change state from <code>Initializing</code> to <code>Active</code>. A subnet manager often (typically every 5 or 30 seconds) checks the network for new adapters and adds them to the routing tables. If you have an IB switch with an embedded subnet manager, you can use that, or you can keep it disabled and use a software subnet manager instead. Dedicated IB subnet manager devices also exist.
</p>
<h3><span class="mw-headline" id="Enable_port">Enable port</span></h3>
<p>If the port is in the physical state <code>Sleep</code> (can be verified with <code>ibstat</code>) then it first needs to be enabled by running <code>ibportstate --Direct 0 1 enable</code> for it to wake up. This may need to be automated at boot if the ports at both ends of the link are sleeping.
</p>
<h4><span class="mw-headline" id="Software_subnet_manager">Software subnet manager</span></h4>
<p>On one system:
</p>
<ul>
<li>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/opensm/">opensm</a></span><sup><small>AUR</small></sup>
</li>
<li>Correct the systemd file <code>/usr/lib/systemd/system/opensm.service</code> as the following instruction.</li>
<li>
<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>opensm.service</code>
</li>
</ul>
<p>The current opensm's configuration for opensm is not compatible with RDMA's systemd configuration. That is, edit the 2 lines in <code>/usr/lib/systemd/system/opensm.service</code> as following (Commented ones are original contents.).
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># /usr/lib/systemd/system/opensm.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Requires=rdma-load-modules@rdma.service # Requires=rdma.service
After=rdma-load-modules@rdma.service # After=rdma.service</pre>
<p>All of your connected IB ports should now be in a (port) state of <code>Active</code>, and a physical state of <code>LinkUp</code>. You can check this by running <a href="#ibstat_-_View_a_computer's_IB_GUIDs">ibstat</a>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ibstat</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">... (look at the ports shown you expect to be connected)
State: Active
Physical state: LinkUp
...</pre>
<p>Or by examining the <code>/sys</code> filesystem:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ cat /sys/class/infiniband/<i>kernel_module</i>/ports/<i>port_number</i>/phys_state</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">5: LinkUp</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ cat /sys/class/infiniband/<i>kernel_module</i>/ports/<i>port_number</i>/state</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">4: ACTIVE</pre>
<h2>
<span id="TCP.2FIP_.28IPoIB.29"></span><span class="mw-headline" id="TCP/IP_(IPoIB)">TCP/IP (IPoIB)</span>
</h2>
<p>You can create a virtual Ethernet Adapter that runs on the HCA. This is intended so programs designed to work with TCP/IP but not IB, can (indirectly) use IB networks. Performance is negatively affected due to sending all traffic through the normal TCP stack; requiring system calls, memory copies, and network protocols to run on the CPU rather than on the HCA.
</p>
<p>IB interface will appear when the module <code>ib_ipoib</code> is loaded. The simple configuration to make it appear is adding the line <code>ib_ipoib</code> in <code>/etc/rdma/modules/infiniband.conf</code> then rebooting the system. After booting the system with the module <code>ib_ipoib</code>, links with the name like <code>ibp16s0</code> should be confirmed with the command <code>ip link</code>.
</p>
<p>Detailed configuration is possible for the IB interface (e.g. naming it <code>ib0</code> and assigning IP addresses <a href="../en/Network_configuration.html" title="Network configuration">like a traditional Ethernet adapter</a>).
</p>
<h3><span class="mw-headline" id="Connection_mode">Connection mode</span></h3>
<p>IPoIB can run in datagram (default) or connected mode. Connected mode <a href="#Finetuning_connection_mode_and_MTU">allows you to set a higher MTU</a>, but does increase TCP latency for short messages by about 5% more than datagram mode.
</p>
<p>To see the current mode used:
</p>
<pre>$ cat /sys/class/net/<i>interface</i>/mode

</pre>
 <div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  Connected mode is no longer supported in ConnectX-6 (or newer) Mellanox cards.</div>
<h3><span class="mw-headline" id="MTU">MTU</span></h3>
<p>In datagram mode, UD (Unreliable Datagram) transport is used, which typically forces the MTU to be 2044 bytes. Technically to the IB L2 MTU - 4 bytes for the IPoIB encapsulation header, which is usually 2044 bytes.
</p>
<p>In connected mode, RC (Reliable Connected) transport is used, which allows a MTU up to the maximum IP packet size, 65520 bytes.
</p>
<p>To see your MTU:
</p>
<pre>$ ip link show <i>interface</i>
</pre>
<h3><span class="mw-headline" id="Finetuning_connection_mode_and_MTU">Finetuning connection mode and MTU</span></h3>
<p>You only need <code>ipoibmodemtu</code> if you want to change the default connection mode and/or MTU.
</p>
<ul>
<li><a href="#TCP/IP_(IPoIB)">Install and set up TCP/IP over IB (IPoIB)</a></li>
<li>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ipoibmodemtu/">ipoibmodemtu</a></span><sup><small>AUR</small></sup>
</li>
<li>Configure <code>ipoibmodemtu</code> through <code>/etc/ipoibmodemtu.conf</code>, which contains instructions on how to do so
<ul><li>It defaults to setting a single IB port <code>ib0</code> to <code>connected</code> mode and MTU <code>65520</code>
</li></ul>
</li>
<li>
<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>ipoibmodemtu.service</code>
</li>
</ul>
<p>Different setups will see different results. Some people see a gigantic (double+) speed increase by using <code>connected</code> mode and MTU <code>65520</code>, and a few see about the same or even worse speeds. Use <a href="#qperf_-_Measure_performance_over_RDMA_or_TCP/IP">qperf</a> and <a href="#iperf_-_Measure_performance_over_TCP/IP">iperf</a> to finetune your system.
</p>
<p>Using the <a href="#qperf_-_Measure_performance_over_RDMA_or_TCP/IP">qperf</a> examples given in this article, here are example results from an SDR network (8 theoretical Gb/s) with various finetuning:
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Mode</th>
<th>MTU</th>
<th>MB/s</th>
<th>us latency
</th>
</tr>
<tr>
<td>datagram</td>
<td>2044</td>
<td>707</td>
<td>19.4
</td>
</tr>
<tr>
<td>connected</td>
<td>2044</td>
<td>353</td>
<td>18.9
</td>
</tr>
<tr>
<td>connected</td>
<td>65520</td>
<td>726</td>
<td>19.6
</td>
</tr>
</tbody>
</table>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Use the same connection and MTU settings for the entire subnet. Mixing and matching does not work optimally.</div>
<h2>
<span id="Soft_RoCE_.28RXE.29"></span><span class="mw-headline" id="Soft_RoCE_(RXE)">Soft RoCE (RXE)</span>
</h2>
<p>Soft ROCE is a software implementation of RoCE that allows using Infiniband over any ethernet adapter.
</p>
<ul>
<li>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iproute2">iproute2</a></span>
</li>
<li>Run <code>rdma link add rxe_eth0 type rxe netdev ethN</code> to configure an RXE instance on ethernet device ethN.</li>
</ul>
<p>You should now have an rxe0 device:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># rdma link</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">link rxe_eth0/1 state ACTIVE physical_state LINK_UP netdev enp1s0</pre>
<h2><span class="mw-headline" id="Remote_data_storage">Remote data storage</span></h2>
<p>You can share physical or virtual devices from a target (host/server) to an initiator (guest/client) system over an IB network, using iSCSI, iSCSI with iSER, or SRP. These methods differ from traditional file sharing (i.e. <a href="../en/Samba.html" title="Samba">Samba</a> or <a href="../en/NFS.html" title="NFS">NFS</a>) because the initiator system views the shared device as its own block level device, rather than a traditionally mounted network shared folder. i.e. <code>fdisk /dev/<i>block_device_id</i></code>, <code>mkfs.btrfs /dev/<i>block_device_id_with_partition_number</i></code>
</p>
<p>The disadvantage is only one system can use each shared device at a time; trying to mount a shared device on the target or another initiator system will fail (an initiator system can certainly run traditional file sharing on top).
</p>
<p>The advantages are faster bandwidth, more control, and even having an initiator's root filesystem being physically located remotely (remote booting).
</p>
<h3><span class="mw-headline" id="targetcli">targetcli</span></h3>
<p><code>targetcli</code> acts like a shell that presents its complex (and not worth creating by hand) <code>/etc/target/saveconfig.json</code> as a pseudo-filesystem.
</p>
<h4><span class="mw-headline" id="Installing_and_using">Installing and using</span></h4>
<p>On the target system:
</p>
<ul>
<li>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/targetcli-fb/">targetcli-fb</a></span><sup><small>AUR</small></sup>
</li>
<li>
<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>target.service</code>
</li>
</ul>
<p>In <code>targetcli</code>:
</p>
<ul>
<li>In any pseudo-directory, you can run <code>help</code> to see the commands available <i>in that pseudo-directory</i> or <code>help <i>command</i></code> (like <code>help create</code>) for more detailed help</li>
<li>Tab-completion is also available for many commands</li>
<li>Run <code>ls</code> to see the entire pseudo-filesystem at and below the current pseudo-directory</li>
</ul>
<h4><span class="mw-headline" id="Create_backstores">Create backstores</span></h4>
<p>Enter the configuration shell:
</p>
<pre># targetcli
</pre>
<p>Within <code>targetcli</code>, setup a backstore for each device or virtual device to share:
</p>
<ul>
<li>To share an actual block device, run: <code>cd /backstores/block</code>; and <code>create <i>name</i> <i>dev</i></code>
</li>
<li>To share a file as a virtual block device, run: <code>cd /backstores/fileio</code>; and <code>create <i>name</i> <i>file</i></code>
</li>
<li>To share a physical SCSI device as a pass-through, run: <code>cd /backstores/pscsi</code>; and <code>create <i>name</i> <i>dev</i></code>
</li>
<li>To share a RAM disk, run: <code>cd /backstores/ramdisk</code>; and <code>create <i>name</i> <i>size</i></code>
</li>
<li>Where <i>name</i> is for the backstore's name</li>
<li>Where <i>dev</i> is the block device to share (i.e. <code>/dev/sda</code>, <code>/dev/sda4</code>, <code>/dev/disk/by-id/<i>XXX</i></code>, or a LVM logical volume <code>/dev/vg0/lv1</code>)</li>
<li>Where <i>file</i> is the file to share (i.e. <code>/path/to/file</code>)</li>
<li>Where <i>size</i> is the size of the RAM disk to create (i.e. 512MB, 20GB)</li>
</ul>
<h3><span class="mw-headline" id="iSCSI">iSCSI</span></h3>
<p>iSCSI allows storage devices and virtual storage devices to be used over a network. For IB networks, the storage can either work over IPoIB or iSER.
</p>
<p>There is a lot of overlap with the <a href="../en/ISCSI/LIO.html" class="mw-redirect" title="ISCSI Target">iSCSI Target</a>, <a href="../en/Open-iSCSI.html" class="mw-redirect" title="ISCSI Initiator">iSCSI Initiator</a>, and <a href="../en/ISCSI/Boot.html" class="mw-redirect" title="ISCSI Boot">iSCSI Boot</a> articles, but the necessities will be discussed since much needs to be customized for usage over IB.
</p>
<h4><span class="mw-headline" id="Over_IPoIB">Over IPoIB</span></h4>
<p>Perform the target system instructions first, which will direct you when to temporarily switch over to the initiator system instructions.
</p>
<ul><li>On the target and initiator systems, <a href="#TCP/IP_(IPoIB)">install TCP/IP over IB</a>
</li></ul>
<ul><li>On the target system, for each device or virtual device you want to share, in <code>targetcli</code>:
<ul>
<li><a href="#Create_backstores">Create a backstore</a></li>
<li>For each backstore, create an IQN (iSCSI Qualified Name) (the name other systems' configurations will see the storage as)
<ul>
<li>Run: <code>cd /iscsi</code>; and <code>create</code>. It will give you a <i>randomly_generated_target_name</i>, i.e. <code>iqn.2003-01.org.linux-iscsi.hostname.x8664:sn.3d74b8d4020a</code>
</li>
<li>Set up the TPG (Target Portal Group), automatically created in the last step as tpg1
<ul>
<li>Create a lun (Logical Unit Number)
<ul><li>Run: <code>cd <i>randomly_generated_target_name</i>/tpg1/luns</code>; and <code>create <i>storage_object</i></code>. Where <code><i>storage_object</i></code> is a full path to an existing storage object, i.e. <code>/backstores/block/<i>name</i></code>
</li></ul>
</li>
<li>Create an acl (Access Control List)
<ul><li>Run: <code>cd ../acls</code>; and <code>create <i>wwn</i></code>, where <code><i>wwn</i></code> is the initiator system's IQN (iSCSI Qualified Name), aka its (World Wide Name)
<ul><li>Get the <code><i>wwn</i></code> by running on the initiator system, <b>not</b> this target system: (after installing on it <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=open-iscsi">open-iscsi</a></span>) <code>cat /etc/iscsi/initiatorname.iscsi</code>
</li></ul>
</li></ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Save and exit by running: <code>cd /</code>; <code>saveconfig</code>; and <code>exit</code>
</li>
</ul>
</li></ul>
<ul><li>On the initiator system:
<ul>
<li>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=open-iscsi">open-iscsi</a></span>
</li>
<li>At this point, you can obtain this initiator system's IQN (iSCSI Qualified Name), aka its wwn (World Wide Name), for setting up the target system's <code>luns</code>:
<ul>
<li>
<code>pacman</code> should have displayed <code>&gt;&gt;&gt; Setting Initiatorname <i>wwn</i></code>
</li>
<li>Otherwise, run: <code>cat /etc/iscsi/initiatorname.iscsi</code> to see <code>InitiatorName=<i>wwn</i></code>
</li>
</ul>
</li>
<li>
<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>iscsid.service</code>
</li>
<li>To automatically login to discovered targets at boot, before discovering targets, edit <code>/etc/iscsi/iscsid.conf</code> to set <code>node.startup = automatic</code>
</li>
<li>Discover online targets. Run <code>iscsiadm -m discovery -t sendtargets -p <i>portal</i></code> as root, where <i>portal</i> is an IP (v4 or v6) address or hostname
<ul><li>If using a hostname, make sure it routes to the IB IP address rather than Ethernet - it may be beneficial to just use the IB IP address</li></ul>
</li>
<li>To automatically login to discovered targets at boot, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>iscsi.service</code>
</li>
<li>To manually login to discovered targets, run <code>iscsiadm -m node -L all</code> as root.</li>
<li>View which block device ID was given to each target logged into. Run <code>iscsiadm -m session -P 3 | grep Attached</code> as root. The block device ID will be the last line in the tree for each target (<code>-P</code> is the print command, its option is the verbosity level, and only level 3 lists the block device IDs)</li>
</ul>
</li></ul>
<h4><span class="mw-headline" id="Over_iSER">Over iSER</span></h4>
<p>iSER (iSCSI Extensions for RDMA) takes advantage of IB's RDMA protocols, rather than using TCP/IP. It eliminates TCP/IP overhead, and provides higher bandwidth, zero copy time, lower latency, and lower CPU utilization.
</p>
<p>Follow the <a href="#Over_IPoIB">iSCSI Over IPoIB</a> instructions, with the following changes:
</p>
<ul>
<li>If you wish, instead of <a href="#TCP/IP_(IPoIB)">installing IPoIB</a>, you can just <a href="#Kernel_modules">install RDMA for loading kernel modules</a>
</li>
<li>On the target system, after everything else is setup, while still in <code>targetcli</code>, enable iSER on the target:
<ul>
<li>Run <code>cd /iscsi/<i>iqn</i>/tpg1/portals/0.0.0.0:3260</code> for each <i>iqn</i> you want to have use iSER rather than IPoIB
<ul><li>Where <i>iqn</i> is the randomly generated target name, i.e. <code>iqn.2003-01.org.linux-iscsi.hostname.x8664:sn.3d74b8d4020a</code>
</li></ul>
</li>
<li>Run <code>enable_iser true</code>
</li>
<li>Save and exit by running: <code>cd /</code>; <code>saveconfig</code>; and <code>exit</code>
</li>
</ul>
</li>
<li>On the initiator system, when running <code>iscsiadm</code> to discover online targets, use the additional argument <code>-I iser</code>, and when you login to them, you should see: <code>Logging in to [iface: iser...</code>
</li>
</ul>
<h4>
<span id="Adding_to_.2Fetc.2Ffstab"></span><span class="mw-headline" id="Adding_to_/etc/fstab">Adding to /etc/fstab</span>
</h4>
<p>The last time you discovered targets, automatic login must have been turned on.
</p>
<p>Add your mount entry to <code>/etc/fstab</code> as if it were a local block device, except add a <code>_netdev</code> option to avoid attempting to mount it before network initialization.
</p>
<h2><span class="mw-headline" id="Network_segmentation">Network segmentation</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Explain in more detail with examples (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:InfiniBand.html">Talk:InfiniBand</a>)</div>
</div>
<p>An IB subnet can be partitioned for different customers or applications, giving security and quality of service guarantees. Each partition is identified by a PKEY (Partition Key).
</p>
<h2>
<span id="SDP_.28Sockets_Direct_Protocol.29"></span><span class="mw-headline" id="SDP_(Sockets_Direct_Protocol)">SDP (Sockets Direct Protocol)</span>
</h2>
<p>Use <code>librdmacm</code> (successor to rsockets and libspd) and <code>LD_PRELOAD</code> to intercept non-IB programs' socket calls, and transparently (to the program) send them over IB via RDMA. Dramatically speeding up programs built for TCP/IP, much more than can be achieved by using IPoIB. It avoids the need to change the program's source code to work with IB and can even be used for closed source programs. It does not work for programs that statically link in socket libraries.
</p>
<h2><span class="mw-headline" id="Diagnosing_and_benchmarking">Diagnosing and benchmarking</span></h2>
<p>All IB specific tools are included in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=rdma-core">rdma-core</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ibutils/">ibutils</a></span><sup><small>AUR</small></sup>.
</p>
<h3>
<span id="ibstat_-_View_a_computer.27s_IB_GUIDs"></span><span class="mw-headline" id="ibstat_-_View_a_computer's_IB_GUIDs">ibstat - View a computer's IB GUIDs</span>
</h3>
<p>ibstat will show you detailed information about each IB adapter in the computer it is ran on, including: model number; number of ports; firmware and hardware version; node, system image, and port GUIDs; and port state, physical state, rate, base lid, lmc, SM lid, capability mask, and link layer.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ibstat</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CA 'mlx4_0'
        CA type: MT25418
        Number of ports: 2
        Firmware version: 2.9.1000
        Hardware version: a0
        Node GUID: 0x0002c90300002f78
        System image GUID: 0x0002c90300002f7b
        Port 1:
                State: Active
                Physical state: LinkUp
                Rate: 20
                Base lid: 3
                LMC: 0
                SM lid: 3
                Capability mask: 0x0251086a
                Port GUID: 0x0002c90300002f79
                Link layer: InfiniBand
        Port 2:
                State: Down
                Physical state: Polling
                Rate: 10
                Base lid: 0
                LMC: 0
                SM lid: 0
                Capability mask: 0x02510868
                Port GUID: 0x0002c90300002f7a
                Link layer: InfiniBand</pre>
<p>This example shows a Mellanox Technologies (MT) adapter. Its PCI Device ID is reported (25418), rather than the model number of part number. It shows a state of "Active", which means is it properly connected to a subnet manager. It shows a physical state of "LinkUp", which means it has an electrical connection via cable, but is not necessarily properly connected to a subnet manager. It shows a total rate of 20 Gb/s (which for this card is from a 5.0 Gb/s signaling rate and 4 virtual lanes). It shows the subnet manager assigned the port a lid of 3.
</p>
<h3><span class="mw-headline" id="ibhosts_-_View_all_hosts_on_IB_network">ibhosts - View all hosts on IB network</span></h3>
<p>ibhosts will show you the Node GUIDs, number of ports, and device names, for each host on the IB network.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># ibhosts</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Ca      : 0x0002c90300002778 ports 2 "MT25408 ConnectX Mellanox Technologies"
Ca      : 0x0002c90300002f78 ports 2 "hostname mlx4_0"
</pre>
<h3><span class="mw-headline" id="ibswitches_-_View_all_switches_on_IB_network">ibswitches - View all switches on IB network</span></h3>
<p>ibswitches will show you the Node GUIDs, number of ports, and device names, for each switch on the IB network. If you are running with direct connections only, it will show nothing.
</p>
<pre># ibswitches
</pre>
<h3><span class="mw-headline" id="iblinkinfo_-_View_link_information_on_IB_network">iblinkinfo - View link information on IB network</span></h3>
<p>iblinkinfo will show you the device names, Port GUIDs, number of virtual lanes, <a href="#Signal_transfer_rates">signal transfer rates</a>, state, physical state, and what it is connected to.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># iblinkinfo</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CA: MT25408 ConnectX Mellanox Technologies:
      0x0002c90300002779      4    1[  ] ==( 4X           5.0 Gbps Active/  LinkUp)==&gt;       3    1[  ] "kvm mlx4_0" ( )
CA: hostname mlx4_0:
      0x0002c90300002f79      3    1[  ] ==( 4X           5.0 Gbps Active/  LinkUp)==&gt;       4    1[  ] "MT25408 ConnectX Mellanox Technologies" ( )</pre>
<p>This example shows two adapters directly connected with out a switch, using a 5.0 Gb/s <a href="#Signal_transfer_rates">signal transfer rate</a>, and 4 virtual lanes (4X).
</p>
<h3><span class="mw-headline" id="ibping_-_Ping_another_IB_device">ibping - Ping another IB device</span></h3>
<p>ibping will attempt pinging another IB GUID. ibping must be ran in server mode on one computer, and in client mode on another.
</p>
<p>ibping must be ran in server mode on one computer.
</p>
<pre># ibping -S
</pre>
<p>And in client mode on another. It is pinging a specific port, so it cannot take a CA name, or a Node or System GUID. It requires <code>-G</code> with a Port GUID, or <code>-L</code> with a Lid.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># ibping -G 0x0002c90300002779
-or-
# ibping -L 1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Pong from hostname.(none) (Lid 1): time 0.053 ms
Pong from hostname.(none) (Lid 1): time 0.074 ms
^C
--- hostname.(none) (Lid 4) ibping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1630 ms
rtt min/avg/max = 0.053/0.063/0.074 ms</pre>
<p>If you are running IPoIB, you can use regular <code>ping</code> which pings through the TCP/IP stack. ibping uses IB interfaces, and does not use the TCP/IP stack.
</p>
<h3><span class="mw-headline" id="ibdiagnet_-_Show_diagnostic_information_for_entire_subnet">ibdiagnet - Show diagnostic information for entire subnet</span></h3>
<p>ibdiagnet will show you potential problems on your subnet. You can run it without options. <code>-lw &lt;1x|4x|12x&gt;</code> specifies the expected link width (number of virtual lanes) for your computer's adapter, so it can check if it is running as intended. <code>-ls &lt;2.5|5|10&gt;</code> specifies the expected link speed (signaling rate) for your computer's adapter, so it can check if it is running as intended, but it does not yet support options faster than 10 for FDR+ devices. <code>-c &lt;count&gt;</code> overrides the default number of packets to be sent of 10.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># ibdiagnet -lw 4x -ls 5 -c 1000</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Loading IBDIAGNET from: /usr/lib/ibdiagnet1.5.7
-W- Topology file is not specified.
    Reports regarding cluster links will use direct routes.
Loading IBDM from: /usr/lib/ibdm1.5.7
-I- Using port 1 as the local port.
-I- Discovering ... 2 nodes (0 Switches &amp; 2 CA-s) discovered.

-I---------------------------------------------------
-I- Bad Guids/LIDs Info
-I---------------------------------------------------
-I- No bad Guids were found

-I---------------------------------------------------
-I- Links With Logical State = INIT
-I---------------------------------------------------
-I- No bad Links (with logical state = INIT) were found

-I---------------------------------------------------
-I- General Device Info
-I---------------------------------------------------

-I---------------------------------------------------
-I- PM Counters Info
-I---------------------------------------------------
-I- No illegal PM counters values were found

-I---------------------------------------------------
-I- Links With links width != 4x (as set by -lw option)
-I---------------------------------------------------
-I- No unmatched Links (with width != 4x) were found

-I---------------------------------------------------
-I- Links With links speed != 5 (as set by -ls option)
-I---------------------------------------------------
-I- No unmatched Links (with speed != 5) were found

-I---------------------------------------------------
-I- Fabric Partitions Report (see ibdiagnet.pkey for a full hosts list)
-I---------------------------------------------------
-I-    PKey:0x7fff Hosts:2 full:2 limited:0

-I---------------------------------------------------
-I- IPoIB Subnets Check
-I---------------------------------------------------
-I- Subnet: IPv4 PKey:0x7fff QKey:0x00000b1b MTU:2048Byte rate:10Gbps SL:0x00
-W- Suboptimal rate for group. Lowest member rate:20Gbps &gt; group-rate:10Gbps

-I---------------------------------------------------
-I- Bad Links Info
-I- No bad link were found
-I---------------------------------------------------
----------------------------------------------------------------
-I- Stages Status Report:
    STAGE                                    Errors Warnings
    Bad GUIDs/LIDs Check                     0      0     
    Link State Active Check                  0      0     
    General Devices Info Report              0      0     
    Performance Counters Report              0      0     
    Specific Link Width Check                0      0     
    Specific Link Speed Check                0      0     
    Partitions Check                         0      0     
    IPoIB Subnets Check                      0      1     

Please see /tmp/ibdiagnet.log for complete log
----------------------------------------------------------------
 
-I- Done. Run time was 0 seconds.
</pre>
<h3>
<span id="qperf_-_Measure_performance_over_RDMA_or_TCP.2FIP"></span><span class="mw-headline" id="qperf_-_Measure_performance_over_RDMA_or_TCP/IP">qperf - Measure performance over RDMA or TCP/IP</span>
</h3>
<p>qperf can measure bandwidth and latency over RDMA (SDP, UDP, UD, and UC) or TCP/IP (including IPoIB)
</p>
<p>qperf must be ran in server mode on one computer.
</p>
<pre>$ qperf
</pre>
<p>And in client mode on another. SERVERNODE can be a hostname, or for IPoIB a TCP/IP address. There are many tests. Some of the most useful are below.
</p>
<pre>$ qperf SERVERNODE [OPTIONS] TESTS
</pre>
<h4>
<span id="TCP.2FIP_over_IPoIB"></span><span class="mw-headline" id="TCP/IP_over_IPoIB">TCP/IP over IPoIB</span>
</h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ qperf 192.168.2.2 tcp_bw tcp_lat</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">tcp_bw:
    bw  =  701 MB/sec
tcp_lat:
    latency  =  19.8 us</pre>
<h3>
<span id="iperf_-_Measure_performance_over_TCP.2FIP"></span><span class="mw-headline" id="iperf_-_Measure_performance_over_TCP/IP">iperf - Measure performance over TCP/IP</span>
</h3>
<p>iperf is not an IB aware program, and is meant to test over TCP/IP or UDP. Even though <a href="#qperf_-_Measure_performance_over_RDMA_or_TCP/IP">qperf</a> can test your IB TCP/IP performace using IPoIB, iperf is still another program you can use.
</p>
<p>iperf must be ran in server mode on one computer.
</p>
<pre>$ iperf3 -s
</pre>
<p>And in client mode on another.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ iperf3 -c 192.168.2.2</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[  4] local 192.168.2.1 port 20139 connected to 192.168.2.2 port 5201
[ ID] Interval           Transfer     Bandwidth
[  4]   0.00-1.00   sec   639 MBytes  5.36 Gbits/sec                  
...
[  4]   9.00-10.00  sec   638 MBytes  5.35 Gbits/sec                  
- - - - - - - - - - - - - - - - - - - - - - - - -
[ ID] Interval           Transfer     Bandwidth
[  4]   0.00-10.00  sec  6.23 GBytes  5.35 Gbits/sec                  sender
[  4]   0.00-10.00  sec  6.23 GBytes  5.35 Gbits/sec                  receiver

iperf Done.</pre>
<p>iperf shows Transfer in base 10 GB's, and Bandwidth in base 2 GB's. So, this example shows 6.23GB (base 10) in 10 seconds. That is 6.69GB (base 2) in 10 seconds. (6.23 * 2^30 / 10^9) That's 5.35 Gb/s (base 2), as shown by iperf. (6.23 * 2^30 / 10^9 * 8 / 10) That is 685 MB/s (base 2), which is roughly the speed that qperf reported. (6.23 * 2^30 / 10^9 * 8 / 10 * 1024 / 8)
</p>
<h2>
<span id="Common_problems_.2F_FAQ"></span><span class="mw-headline" id="Common_problems_/_FAQ">Common problems / FAQ</span>
</h2>
<h3><span class="mw-headline" id="Connection_problems">Connection problems</span></h3>
<h4>
<span id="Link.2C_physical_state_and_port_state"></span><span class="mw-headline" id="Link,_physical_state_and_port_state">Link, physical state and port state</span>
</h4>
<ul><li>See if the IB hardware modules are recognized by the system. If you have an Intel adapter, you will have to use Intel here and look through a few lines if you have other Intel hardware:</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># dmesg | grep -Ei "Mellanox|InfiniBand|QLogic|Voltaire"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[    6.287556] mlx4_core: Mellanox ConnectX core driver v2.2-1 (Feb, 2014)
[    8.686257] &lt;mlx4_ib&gt; mlx4_ib_add: mlx4_ib: Mellanox ConnectX InfiniBand driver v2.2-1 (Feb 2014)
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ls -l /sys/class/infiniband</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">mlx4_0 -&gt; ../../devices/pci0000:00/0000:00:03.0/0000:05:00.0/infiniband/mlx4_0</pre>
<p>If nothing is shown, your kernel is not recognizing your adapter. This example shows approximately what you will see if you have a Mellanox ConnectX adapter, which uses the mlx4_0 kernel module.
</p>
<ul><li>Check the port and physical states. Either run <a href="#ibstat_-_View_a_computer's_IB_GUIDs">ibstat</a> or examine <code>/sys</code>.</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ibstat</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">(look at the port shown that you expect to be connected)</pre>
<p>or
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ cat /sys/class/infiniband/&lt;kernel module&gt;/ports/&lt;port number&gt;/phys_state</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> 5: LinkUp</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ cat /sys/class/infiniband/&lt;kernel module&gt;/ports/&lt;port number&gt;/state</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> 4: ACTIVE</pre>
<p>The physical state should be "LinkUp". If it is not, your cable likely is not plugged in, is not connected to anything on the other end, or is defective. The (port) state should be "Active". If it is "Initializing" or "INIT", your <a href="#Subnet_manager">subnet manager</a> does not exist, is not running, or has not added the port to the network's routing tables.
</p>
<ul><li>Can you successfully <a href="#ibping_-_Ping_another_IB_device">ibping</a> which uses IB directly, rather than IPoIB? Can you successfully <code>ping</code>, if you are running IPoIB?</li></ul>
<ul><li>Consider <a href="#Upgrade_firmware">upgrading firmware</a>.</li></ul>
<h4><span class="mw-headline" id="getaddrinfo_failed:_Name_or_service_not_known">getaddrinfo failed: Name or service not known</span></h4>
<ul><li>Run <a href="#ibhosts_-_View_all_hosts_on_IB_network">ibhosts</a> to see the CA names at the end of each line in quotes.</li></ul>
<h3><span class="mw-headline" id="Speed_problems">Speed problems</span></h3>
<ul><li>Start by double-checking your expectations.</li></ul>
<p>How have you determined you have a speed problem? Are you using <a href="#qperf_-_Measure_performance_over_RDMA_or_TCP/IP">qperf</a> or <a href="#iperf_-_Measure_performance_over_TCP/IP">iperf</a>, which both transmit data to and from memory rather than hard drives. Or, are you benchmarking actual file transfers, which relies on your hard drives? Unless you are running RAID to boost speed, even with the fastest SSD's available in mid 2015, a single hard drive (or sometimes even multiple ones) will be bottlenecking your IB transfer speeds. Are you using RDMA or TCP/IP via IPoIB? If so, <a href="#TCP/IP_(IPoIB)">there is a performance hit</a> for using IPoIB instead of RDMA.
</p>
<ul><li>Check your link speeds. Run <a href="#ibstat_-_View_a_computer's_IB_GUIDs">ibstat</a>, <a href="#iblinkinfo_-_View_link_information_on_IB_network">iblinkinfo</a>, or examine <code>/sys</code>.</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ibstat</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">(look at the Rate shown on the port you are using)</pre>
<p>or
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># iblinkinfo</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">(look at the middle part formatted like "4X     5.0 Gbps")</pre>
<p>or
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ cat /sys/class/infiniband/&lt;kernel module&gt;/ports/&lt;port number&gt;/rate</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">20 Gb/sec (4X DDR)</pre>
<p>Does this match your expected <a href="#Bandwidth">bandwidth and number of virtual lanes</a>?
</p>
<ul><li>Check diagnostic information for entire subnet. Run <a href="#ibdiagnet_-_Show_diagnostic_information_for_entire_subnet">#ibdiagnet - Show diagnostic information for entire subnet</a>. Make sure to use <code>-ls </code> with <a href="#Bandwidth">the proper signaling rate, which is likely the advertised speed of your card divided by 4</a>.</li></ul>
<pre># ibdiagnet -lw &lt;expected number of virtual lanes -ls &lt;expected signaling rate&gt; -c 1000
</pre>
<ul><li>Consider <a href="#Upgrade_firmware">upgrading firmware</a>.</li></ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Networking.html" title="Category:Networking">Networking</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=InfiniBand&amp;oldid=805129">https://wiki.archlinux.org/index.php?title=InfiniBand&amp;oldid=805129</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 1 April 2024, at 20:57.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
