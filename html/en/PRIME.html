<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>PRIME - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.45.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-PRIME rootpage-PRIME skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-PRIME_GPU_offloading" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#PRIME_GPU_offloading">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>PRIME GPU offloading</span>
			</div>
		</a>
		
			<button aria-controls="toc-PRIME_GPU_offloading-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle PRIME GPU offloading subsection</span>
			</button>
		
		<ul id="toc-PRIME_GPU_offloading-sublist" class="vector-toc-list">
			<li id="toc-For_open_source_drivers_-_PRIME" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#For_open_source_drivers_-_PRIME">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.1</span>
					<span>For open source drivers - PRIME</span>
				</div>
			</a>
			
			<ul id="toc-For_open_source_drivers_-_PRIME-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Note_about_Windows_games" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Note_about_Windows_games">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.2</span>
					<span>Note about Windows games</span>
				</div>
			</a>
			
			<ul id="toc-Note_about_Windows_games-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-PRIME_render_offload" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#PRIME_render_offload">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.3</span>
					<span>PRIME render offload</span>
				</div>
			</a>
			
			<ul id="toc-PRIME_render_offload-sublist" class="vector-toc-list">
				<li id="toc-PCI-Express_Runtime_D3_(RTD3)_Power_Management" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#PCI-Express_Runtime_D3_(RTD3)_Power_Management">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.3.1</span>
					<span>PCI-Express Runtime D3 (RTD3) Power Management</span>
				</div>
			</a>
			
			<ul id="toc-PCI-Express_Runtime_D3_(RTD3)_Power_Management-sublist" class="vector-toc-list">
				<li id="toc-Open-source_drivers" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Open-source_drivers">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.3.1.1</span>
					<span>Open-source drivers</span>
				</div>
			</a>
			
			<ul id="toc-Open-source_drivers-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-NVIDIA" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#NVIDIA">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.3.1.2</span>
					<span>NVIDIA</span>
				</div>
			</a>
			
			<ul id="toc-NVIDIA-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Configure_applications_to_render_using_GPU" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Configure_applications_to_render_using_GPU">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.3.2</span>
					<span>Configure applications to render using GPU</span>
				</div>
			</a>
			
			<ul id="toc-Configure_applications_to_render_using_GPU-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Desktop_environment_integration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Desktop_environment_integration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.3.3</span>
					<span>Desktop environment integration</span>
				</div>
			</a>
			
			<ul id="toc-Desktop_environment_integration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Troubleshooting">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.3.4</span>
					<span>Troubleshooting</span>
				</div>
			</a>
			
			<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-PRIME_synchronization" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#PRIME_synchronization">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.4</span>
					<span>PRIME synchronization</span>
				</div>
			</a>
			
			<ul id="toc-PRIME_synchronization-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Reverse_PRIME" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Reverse_PRIME">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Reverse PRIME</span>
			</div>
		</a>
		
			<button aria-controls="toc-Reverse_PRIME-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Reverse PRIME subsection</span>
			</button>
		
		<ul id="toc-Reverse_PRIME-sublist" class="vector-toc-list">
			<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>Configuration</span>
				</div>
			</a>
			
			<ul id="toc-Configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Known_issues" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Known_issues">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>Known issues</span>
				</div>
			</a>
			
			<ul id="toc-Known_issues-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting_2" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting_2">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Troubleshooting</span>
			</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting_2-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting_2-sublist" class="vector-toc-list">
			<li id="toc-XRandR_specifies_only_1_output_provider" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#XRandR_specifies_only_1_output_provider">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>XRandR specifies only 1 output provider</span>
				</div>
			</a>
			
			<ul id="toc-XRandR_specifies_only_1_output_provider-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-When_an_application_is_rendered_with_the_discrete_card,_it_only_renders_a_black_screen" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#When_an_application_is_rendered_with_the_discrete_card,_it_only_renders_a_black_screen">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>When an application is rendered with the discrete card, it only renders a black screen</span>
				</div>
			</a>
			
			<ul id="toc-When_an_application_is_rendered_with_the_discrete_card,_it_only_renders_a_black_screen-sublist" class="vector-toc-list">
				<li id="toc-Black_screen_with_GL-based_compositors" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Black_screen_with_GL-based_compositors">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2.1</span>
					<span>Black screen with GL-based compositors</span>
				</div>
			</a>
			
			<ul id="toc-Black_screen_with_GL-based_compositors-sublist" class="vector-toc-list">
				<li id="toc-GNOME" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#GNOME">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2.1.1</span>
					<span>GNOME</span>
				</div>
			</a>
			
			<ul id="toc-GNOME-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Kernel_crash/oops_when_using_PRIME_and_switching_windows/workspaces" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Kernel_crash/oops_when_using_PRIME_and_switching_windows/workspaces">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3</span>
					<span>Kernel crash/oops when using PRIME and switching windows/workspaces</span>
				</div>
			</a>
			
			<ul id="toc-Kernel_crash/oops_when_using_PRIME_and_switching_windows/workspaces-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Glitches/Ghosting_synchronization_problem_on_second_monitor_when_using_reverse_PRIME" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Glitches/Ghosting_synchronization_problem_on_second_monitor_when_using_reverse_PRIME">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.4</span>
					<span>Glitches/Ghosting synchronization problem on second monitor when using reverse PRIME</span>
				</div>
			</a>
			
			<ul id="toc-Glitches/Ghosting_synchronization_problem_on_second_monitor_when_using_reverse_PRIME-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Error_&quot;radeon:_Failed_to_allocate_virtual_address_for_buffer:&quot;_when_launching_GL_application" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Error_&quot;radeon:_Failed_to_allocate_virtual_address_for_buffer:&quot;_when_launching_GL_application">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.5</span>
					<span>Error "radeon: Failed to allocate virtual address for buffer:" when launching GL application</span>
				</div>
			</a>
			
			<ul id="toc-Error_&quot;radeon:_Failed_to_allocate_virtual_address_for_buffer:&quot;_when_launching_GL_application-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Constant_hangs/freezes_with_Vulkan_applications/games_using_VSync_with_closed-source_drivers_and_reverse_PRIME" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Constant_hangs/freezes_with_Vulkan_applications/games_using_VSync_with_closed-source_drivers_and_reverse_PRIME">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.6</span>
					<span>Constant hangs/freezes with Vulkan applications/games using VSync with closed-source drivers and reverse PRIME</span>
				</div>
			</a>
			
			<ul id="toc-Constant_hangs/freezes_with_Vulkan_applications/games_using_VSync_with_closed-source_drivers_and_reverse_PRIME-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Some_programs_have_a_delay_when_opening_under_Wayland" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Some_programs_have_a_delay_when_opening_under_Wayland">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.7</span>
					<span>Some programs have a delay when opening under Wayland</span>
				</div>
			</a>
			
			<ul id="toc-Some_programs_have_a_delay_when_opening_under_Wayland-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Error_when_running_Wine_games_with_DXVK" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Error_when_running_Wine_games_with_DXVK">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.8</span>
					<span>Error when running Wine games with DXVK</span>
				</div>
			</a>
			
			<ul id="toc-Error_when_running_Wine_games_with_DXVK-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Vulkan/OpenGL_applications_segfault_on_Wayland" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Vulkan/OpenGL_applications_segfault_on_Wayland">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.9</span>
					<span>Vulkan/OpenGL applications segfault on Wayland</span>
				</div>
			</a>
			
			<ul id="toc-Vulkan/OpenGL_applications_segfault_on_Wayland-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar no-font-mode-scale">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">PRIME</span></h1>
							
</header>
				<div class="vector-column-end no-font-mode-scale">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/NVIDIA_Optimus.html" title="NVIDIA Optimus">NVIDIA Optimus</a></li>
<li><a href="../en/External_GPU.html" title="External GPU">External GPU</a></li>
</ul>
</div>
<p>PRIME is a technology used to manage <a href="../en/Hybrid_graphics.html" title="Hybrid graphics">hybrid graphics</a> found on recent desktops and laptops (<a href="../en/NVIDIA_Optimus.html" title="NVIDIA Optimus">Optimus for NVIDIA</a>, AMD Dynamic Switchable Graphics for Radeon). <b>PRIME GPU offloading</b> and <b>Reverse PRIME</b> are an attempt to support muxless hybrid graphics in the Linux kernel.
</p>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="PRIME_GPU_offloading">PRIME GPU offloading</h2></div>
<p>We want to render applications on the more powerful card and send the result to the card which has display connected.
</p>
<p>The command <code>xrandr --setprovideroffloadsink provider sink</code> can be used to make a render offload provider send its output to the sink provider (the provider which has a display connected). The provider and sink identifiers can be numeric (0x7d, 0x56) or a case-sensitive name (Intel, radeon). 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> This setting is no longer necessary when using most default Xorg DDX (the <code>xf86-video-*</code> or built-in modesetting) drivers from the official repositories, as they have DRI3 enabled by default and will therefore automatically make these assignments. Explicitly setting them again does no harm, though.</div>
<p>Example:
</p>
<pre>$ xrandr --setprovideroffloadsink radeon Intel
</pre>
<p>You may also use provider index instead of provider name:
</p>
<pre>$ xrandr --setprovideroffloadsink 1 0
</pre>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> The following subsections are a messy, we name a subsection PRIME render offload without stating it's NVIDIA-centric, we shove generic PCI-E power management for the open source drivers inside, the merge flag from <a href="../en/External_GPU.html#Xorg_rendered_on_iGPU,_PRIME_render_offload_to_eGPU" title="External GPU">External GPU#Xorg rendered on iGPU, PRIME render offload to eGPU</a> should probably be addressed on the other page, once this has cleaned up and we can link to here for the environment variables to use. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:PRIME.html">Talk:PRIME</a>)</div>
</div>
<div class="mw-heading mw-heading3"><h3 id="For_open_source_drivers_-_PRIME">For open source drivers - PRIME</h3></div>
<p>To use your discrete card for the applications who need it the most (for example games, 3D modellers...), prepend the <code>DRI_PRIME=1</code> environment variable:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ DRI_PRIME=1 glxinfo | grep "OpenGL renderer"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">OpenGL renderer string: Gallium 0.4 on AMD TURKS</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Instead of numerical value, you can also specify a PCI device name. Format used is similar to <code>/sys/bus/pci/devices/</code>, but prefix with <code>pci-</code> and replace semicolons and dots by underscores, e.g. <code>DRI_PRIME=pci-0000_01_00_0</code>.</div>
<p>Other applications will still use the less power-hungry integrated card. These settings are lost once the X server restarts, you may want to make a script and auto-run it at the startup of your desktop environment (alternatively, put it in <code>/etc/X11/xinit/xinitrc.d/</code>). This may reduce your battery life and increase heat though.
</p>
<p>See <a href="https://wiki.gentoo.org/wiki/AMDGPU#Identifying_which_graphics_card_is_in_use" class="extiw" title="gentoo:AMDGPU">Gentoo:AMDGPU#Identifying_which_graphics_card_is_in_use</a> for more information.
</p>
<p>For <code>DRI_PRIME</code> to work on Vulkan applications <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=vulkan-mesa-layers">vulkan-mesa-layers</a></span> needs to be installed, as well as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lib32-vulkan-mesa-layers">lib32-vulkan-mesa-layers</a></span> for 32 bit applications.
</p>
<div class="mw-heading mw-heading3"><h3 id="Note_about_Windows_games">Note about Windows games</h3></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Merge-arrows-2.svg" decoding="async" width="36" height="40" class="mw-file-element"></span></span><b>This article or section is a candidate for merging with <a href="../en/Wine.html#DXVK" class="mw-redirect" title="DXVK">DXVK</a>.</b></p>
<div>
<b>Notes:</b> Gaming is not the primary topic of this page. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:PRIME.html">Talk:PRIME</a>)</div>
</div>
<p>When running Windows DirectX games under Wine or Proton, you need to instruct <a href="../en/Wine.html#DXVK" class="mw-redirect" title="DXVK">DXVK</a> directly using the environment variable:
</p>
<pre>DXVK_FILTER_DEVICE_NAME="[your preferred card name]"
</pre>
<p>Get the card name from <code>vulkaninfo</code>; DXVK uses substring match.
</p>
<div class="mw-heading mw-heading3"><h3 id="PRIME_render_offload">PRIME render offload</h3></div>
<p>NVIDIA driver since <a rel="nofollow" class="external text" href="https://download.nvidia.com/XFree86/Linux-x86_64/435.17/README/primerenderoffload.html">version 435.17</a> supports this method. The modesetting, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-amdgpu">xf86-video-amdgpu</a></span> (450.57), and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-intel">xf86-video-intel</a></span> (455.38) are officially supported as iGPU drivers.
</p>
<p>To run a program on the NVIDIA card you can use the <code>prime-run</code> script provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvidia-prime">nvidia-prime</a></span>:
</p>
<pre>$ prime-run glxinfo | grep "OpenGL renderer"
$ prime-run vulkaninfo
</pre>
<div class="mw-heading mw-heading4"><h4 id="PCI-Express_Runtime_D3_(RTD3)_Power_Management">
<span id="PCI-Express_Runtime_D3_.28RTD3.29_Power_Management"></span>PCI-Express Runtime D3 (RTD3) Power Management</h4></div>
<div class="mw-heading mw-heading5"><h5 id="Open-source_drivers">Open-source drivers</h5></div>
<p>Kernel PCI power management turns off the GPU when not used with PRIME offloading or reverse PRIME.
This feature is supported by modesetting, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-amdgpu">xf86-video-amdgpu</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-intel">xf86-video-intel</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-nouveau">xf86-video-nouveau</a></span> drivers.
</p>
<p>The following command can be used to check current <a rel="nofollow" class="external autonumber" href="https://docs.kernel.org/power/pci.html#native-pci-power-management">[1]</a> power state of each GPU:
</p>
<pre>$ cat /sys/class/drm/card*/device/power_state
</pre>
<div class="mw-heading mw-heading5"><h5 id="NVIDIA">NVIDIA</h5></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> 
<ul>
<li>No configuration is generally needed for Ampere as this is enabled by default. For some Ampere users, udev rules may be necessary.</li>
<li>Some users with hybrid graphics are reporting that their discrete NVIDIA Ampere GPUs are failing to remain in the D3Cold power state after upgrading to newer NVIDIA drivers (seemingly &gt;525) <a rel="nofollow" class="external autonumber" href="https://forums.developer.nvidia.com/t/nvidia-gpu-fails-to-power-off-prime-razer-blade-14-2022/250023">[2]</a>.</li>
<li>Some users with pre-Ampere card and broken D3 support on newer drivers reported a workaround to disable the GSP firmware with <code>NVreg_EnableGpuFirmware=0</code><a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?pid=2182638">[3]</a>.</li>
</ul>
</div>
<p>For Turing generation cards with Intel Coffee Lake or above CPUs as well as some Ryzen CPUs like the 5800H, it is possible to fully <a rel="nofollow" class="external text" href="https://us.download.nvidia.com/XFree86/Linux-x86_64/575.64.05/README/dynamicpowermanagement.html">power down the GPU when not in use</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> If you plan to use suspend or hibernate, see <a href="../en/NVIDIA/Tips_and_tricks.html#Preserve_video_memory_after_suspend" title="NVIDIA/Tips and tricks">NVIDIA/Tips and tricks#Preserve video memory after suspend</a>.</div>
<p>The following <a href="../en/Udev.html" title="Udev">udev</a> rules are needed, as recommended by NVIDIA: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/80-nvidia-pm.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Enable runtime PM for NVIDIA VGA/3D controller devices on driver bind
ACTION=="bind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030000", TEST=="power/control", ATTR{power/control}="auto"
ACTION=="bind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030200", TEST=="power/control", ATTR{power/control}="auto"

# Disable runtime PM for NVIDIA VGA/3D controller devices on driver unbind
ACTION=="unbind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030000", TEST=="power/control", ATTR{power/control}="on"
ACTION=="unbind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030200", TEST=="power/control", ATTR{power/control}="on"</pre>
<p>Some users also <a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nvidia-prime-rtd3pm#comment-920182">reported</a> that the following additional lines are necessary too:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/80-nvidia-pm.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Enable runtime PM for NVIDIA VGA/3D controller devices on adding device
ACTION=="add", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030000", TEST=="power/control", ATTR{power/control}="auto"
ACTION=="add", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030200", TEST=="power/control", ATTR{power/control}="auto"</pre>
<p>Also, add the following <a href="../en/Module_parameter.html" class="mw-redirect" title="Module parameter">module parameters</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/nvidia-pm.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options nvidia "NVreg_DynamicPowerManagement=0x02"</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> For Ampere or later notebooks with supported configurations, you need to use <code>NVreg_DynamicPowerManagement=0x03</code> instead.</div>
<p>Alternatively, you can install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nvidia-prime-rtd3pm/">nvidia-prime-rtd3pm</a></span><sup><small>AUR</small></sup> which provides these two configuration files.
</p>
<p>After you setup the <a href="../en/Udev.html" title="Udev">udev</a> rules and the <a href="../en/Module_parameter.html" class="mw-redirect" title="Module parameter">module parameter</a> either manually or using the AUR package, you will need to restart your Laptop.
</p>
<p>To check if the NVIDIA GPU is turned off you can use this command:
</p>
<pre>$ cat /sys/bus/pci/devices/0000:01:00.0/power/runtime_status
</pre>
<p>You will see either <code>suspended</code> or <code>running</code>, if <code>suspended</code> is displayed, the GPU is turned off. Now the power draw will be 0 Watts, making the battery last longer.
</p>
<p>In some cases, such as the NVIDIA RTX A1000, none of the options above might be listed and instead the result will be <code>active</code>. This alone does not mean that the GPU is in the <code>running</code> state. In this case you can check the state using this command:
</p>
<pre>$ cat /sys/bus/pci/devices/0000:01:00.0/power/runtime_suspended_time
</pre>
<p>While the GPU is in <code>suspended</code> state, the counter will be incrementing every time you run the command. When the GPU's state becomes <code>running</code> it will stop incrementing.
</p>
<p>If you notice that the <code>runtime_suspended_time</code> is not incrementing, you can check your D3 Status with this command. 
</p>
<pre>$ cat /proc/driver/nvidia/gpus/0000:01:00.0/power
</pre>
<p>If it says <code>Runtime D3 status: Not supported</code>, you may need to follow the steps <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=2181317#p2181317">in this forum post</a> to disable. <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=2187680#p2187680">One user noted</a> disabling the <code>GpuFirmware</code> only works on the closed source driver, not on <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvidia-open">nvidia-open</a></span>.
</p>
<p>To check what uses the GPU, you can use the following command:
</p>
<pre># lsof +c0 /dev/nvidia*
</pre>
<p>Unlike nvidia-smi, it reports every process using the device, and it doesn't wake up the GPU.
</p>
<p>We also need to <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>nvidia-persistenced.service</code> to avoid the kernel tearing down the device state whenever the NVIDIA device resources are no longer in use. <a rel="nofollow" class="external autonumber" href="https://us.download.nvidia.com/XFree86/Linux-x86_64/550.54.14/README/nvidia-persistenced.html">[4]</a>
</p>
<div class="mw-heading mw-heading4"><h4 id="Configure_applications_to_render_using_GPU">Configure applications to render using GPU</h4></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Merge-arrows-2.svg" decoding="async" width="36" height="40" class="mw-file-element"></span></span><b>This article or section is a candidate for merging with <a href="../en/External_GPU.html#Xorg_rendered_on_iGPU,_PRIME_render_offload_to_eGPU" title="External GPU">External GPU#Xorg rendered on iGPU, PRIME render offload to eGPU</a>.</b></p>
<div>
<b>Notes:</b> Target section mentions these variables. Perhaps this can be merged with the target section to avoid duplication? (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:PRIME.html">Talk:PRIME</a>)</div>
</div>
<p>Even without enabling Dynamic Power Management, offload rendering of applications is required <a rel="nofollow" class="external autonumber" href="https://web.archive.org/web/20211203072304/https://jeansenvaars.wordpress.com/2021/12/02/endeavouros-hybrid-gpu-benchmarks/">[5]</a>.
</p>
<p>To run an application offloaded to the NVIDIA GPU with Dynamic Power Management enabled, add the following <a href="../en/Environment_variables.html" title="Environment variables">environment variables</a>: <a rel="nofollow" class="external autonumber" href="https://download.nvidia.com/XFree86/Linux-x86_64/550.54.14/README/primerenderoffload.html">[6]</a>
</p>
<pre>__NV_PRIME_RENDER_OFFLOAD=1 __GLX_VENDOR_LIBRARY_NAME=nvidia <i>command</i>
</pre>
<p>When using on a <a href="../en/Steam.html" title="Steam">Steam</a> game, the launcher command line can be set to:
</p>
<pre>__NV_PRIME_RENDER_OFFLOAD=1 __GLX_VENDOR_LIBRARY_NAME=nvidia %command%
</pre>
<div class="mw-heading mw-heading4"><h4 id="Desktop_environment_integration">Desktop environment integration</h4></div>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=switcheroo-control">switcheroo-control</a></span> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>switcheroo-control.service</code>.
</p>
<p>The GNOME, KDE Plasma, Cinnamon, COSMIC and Budgie desktop environments will respect the <code>PrefersNonDefaultGPU</code> property in the <a href="../en/Desktop_entry.html" class="mw-redirect" title="Desktop entry">desktop entry</a>, and automatically launch apps on the specified GPU.
</p>
<p>Alternatively, on GNOME and Cinnamon, you can launch applications with GPU by right-clicking on the icon and choosing <i>Launch using Discrete Graphics Card</i> or <i>Run with dedicated GPU</i>, respectively.
</p>
<div class="mw-heading mw-heading4"><h4 id="Troubleshooting">Troubleshooting</h4></div>
<p>If you have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bumblebee">bumblebee</a></span> installed, you should remove it because it blacklists the <code>nvidia_drm</code> driver which is required to load the NVIDIA driver by X server for offloading.
</p>
<div class="mw-heading mw-heading3"><h3 id="PRIME_synchronization">PRIME synchronization</h3></div>
<p>When using PRIME, the primary GPU renders the screen content / applications, and passes it to the secondary GPU for display. Quoting <a rel="nofollow" class="external text" href="https://forums.developer.nvidia.com/t/prime-and-prime-synchronization/44423">an NVIDIA thread</a>, "Traditional vsync can synchronize the rendering of the application with the copy into system memory, but there needs to be an additional mechanism to synchronize the copy into system memory with the iGPU’s display engine. Such a mechanism would have to involve communication between the dGPU’s and the iGPU’s drivers, unlike traditional vsync."
</p>
<p>This synchronization is achieved using PRIME sync. To check if PRIME synchronization is enabled for your display, check the output of <code>xrandr --prop</code>.
</p>
<p>To enable it run:
</p>
<pre>$ xrandr --output &lt;output-name&gt; --set "PRIME Synchronization" 1
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> 
<ul>
<li>A pre-requisite for PRIME synchronization with the NVIDIA driver is to <a href="../en/NVIDIA.html#DRM_kernel_mode_setting" title="NVIDIA">enable modesetting</a>.</li>
<li>PRIME synchronization is not available with the <a href="../en/AMDGPU.html" title="AMDGPU">AMDGPU</a> DDX driver (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-amdgpu">xf86-video-amdgpu</a></span>).</li>
</ul>
</div>
<div class="mw-heading mw-heading2"><h2 id="Reverse_PRIME">Reverse PRIME</h2></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Missing info about configuring Intel + AMD reverse prime for both open and closed amdgpu drivers (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:PRIME.html">Talk:PRIME</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> 
<ul>
<li>Reverse PRIME is not supported for AMDGPU + NVIDIA on NVIDIA driver prior to 470 beta. See <a rel="nofollow" class="external autonumber" href="https://forums.developer.nvidia.com/t/hp-omen-15-ryzen-4600h-nvidia-1660ti-no-display-over-hdmi/165265/2">[7]</a> for more details.</li>
<li>Currently when only the external display is enabled, you will only get 1 FPS. See <a rel="nofollow" class="external autonumber" href="https://gitlab.freedesktop.org/xorg/xserver/-/issues/1028">[8]</a> for more details.</li>
</ul>
</div>
<p>If the second GPU has outputs that are not accessible by the primary GPU, you can use <b>Reverse PRIME</b> to make use of them. This will involve using the primary GPU to render the images, and then pass them off to the second GPU.
</p>
<p>It may work out of the box, however if not, please go through the following steps.
</p>
<div class="mw-heading mw-heading3"><h3 id="Configuration">Configuration</h3></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> First half of the section has Intel + NVIDIA, the second half has Intel + Radeon. Identifying the GPU bus IDs should be delegated to a general section. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:PRIME.html">Talk:PRIME</a>)</div>
</div>
<p>First, identify integrated GPU BusID
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">lspci -d ::03xx</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">00:02.0 VGA compatible controller: Intel Corporation UHD Graphics 630 (Mobile)
01:00.0 VGA compatible controller: NVIDIA Corporation TU117M [GeForce GTX 1650 Mobile / Max-Q] (rev a1)
</pre>
<p>In the above example Intel card has <code>00:02.0</code> which translates to <code>PCI:0:2:0</code>.
</p>
<p>Set up your <code>xorg.conf</code> as follows and adjust BusID.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/X11/xorg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Section "ServerLayout"
        Identifier "layout"
        Screen 0 "intel"
        Inactive "nvidia"
        Option "AllowNVIDIAGPUScreens"
EndSection

Section "Device"
        Identifier "nvidia"
        Driver "nvidia"
EndSection

Section "Screen"
        Identifier "nvidia"
        Device "nvidia"
EndSection

Section "Device"
        Identifier "intel"
        Driver "modesetting"
        BusID "PCI:0:2:0"
EndSection

Section "Screen"
        Identifier "intel"
        Device "intel"
EndSection
</pre>
<p>Secondary GPUs will be automatically set up as output-sinks and offload-sources thanks to <code>AutoBindGPU</code><a rel="nofollow" class="external autonumber" href="https://man.archlinux.org/man/xorg.conf.5">[9]</a>. If that doesn't happen, or you'd like to configure it yourself, run <code>xrandr --setprovideroutputsource provider source</code> to set the provider as output for the source. For example:
</p>
<pre>$ xrandr --listproviders
Providers: number : 2
Provider 0: id: 0x48 cap: 0xf, Source Output, Sink Output, Source Offload, Sink Offload crtcs: 4 outputs: 6 associated providers: 1 name:modesetting
Provider 1: id: 0x257 cap: 0x2, Sink Output crtcs: 4 outputs: 5 associated providers: 1 name:NVIDIA-G0
$ xrandr --setprovideroutputsource NVIDIA-G0 modesetting
</pre>
<p>When this is done, the discrete card's outputs should be available in xrandr, and you could do something like:
</p>
<pre>$ xrandr --output HDMI-1 --auto --above LVDS1
</pre>
<p>to configure both internal as well as external displays.
</p>
<div class="mw-heading mw-heading3"><h3 id="Known_issues">Known issues</h3></div>
<p>If after reboot you only have one provider, it might be because when Xorg starts, the <code>nvidia</code> module is not loaded yet. You need to enable early module loading. See <a href="../en/NVIDIA.html#Early_loading" title="NVIDIA">NVIDIA#Early loading</a> for details.
</p>
<div class="mw-heading mw-heading2"><h2 id="Troubleshooting_2">Troubleshooting</h2></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> No sources to motivate the workarounds in this section (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:PRIME.html">Talk:PRIME</a>)</div>
</div>
<div class="mw-heading mw-heading3"><h3 id="XRandR_specifies_only_1_output_provider">XRandR specifies only 1 output provider</h3></div>
<p>Delete/move /etc/X11/xorg.conf file and any other files relating to GPUs in /etc/X11/xorg.conf.d/. Restart the X server after this change.
</p>
<p>If the video driver is blacklisted in <code>/etc/modprobe.d/</code> or <code>/usr/lib/modprobe.d/</code>, load the module and restart X. This may be the case if you use the bbswitch module for NVIDIA GPUs.
</p>
<p>Another possible problem is that Xorg might try to automatically assign monitors to your second GPU. Check the logs:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ grep "No modes" ~/.local/share/xorg/Xorg.0.log</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">AMDGPU(0): No modes.
</pre>
<p>To solve this add the ServerLayout section with inactive device to your xorg.conf:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/X11/xorg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Section "ServerLayout"
  Identifier     "X.org Configured"
  Screen      0  "Screen0" 0 0 # Screen for your primary GPU
  Inactive       "Card1"       # Device for your second GPU
EndSection
</pre>
<div class="mw-heading mw-heading3"><h3 id="When_an_application_is_rendered_with_the_discrete_card,_it_only_renders_a_black_screen">
<span id="When_an_application_is_rendered_with_the_discrete_card.2C_it_only_renders_a_black_screen"></span>When an application is rendered with the discrete card, it only renders a black screen</h3></div>
<p>In some cases PRIME needs a composite manager to properly work. If your window manager does not handle compositing, you can use a <a href="../en/Xorg.html#List_of_composite_managers" title="Xorg">compositor</a> on top of it.
</p>
<p>If you use Xfce, you can go to <i>Menu &gt; Settings &gt; Window Manager Tweaks &gt; Compositor</i> and enable compositing, then try again your application.
</p>
<div class="mw-heading mw-heading4"><h4 id="Black_screen_with_GL-based_compositors">Black screen with GL-based compositors</h4></div>
<p>Currently there are issues with GL-based compositors and PRIME offloading. While Xrender-based compositors (xcompmgr, xfwm, compton's default backend, cairo-compmgr, and a few others) will work without issue, GL-based compositors (Mutter/muffin, Compiz, compton with GLX backend, Kwin's OpenGL backend, etc) will initially show a black screen, as if there was no compositor running. While you can force an image to appear by resizing the offloaded window, this is not a practical solution as it will not work for things such as full screen Wine applications. This means that desktop environments such as GNOME3 and Cinnamon have issues with using PRIME offloading.
</p>
<p>Additionally if you are using an Intel IGP you might be able to fix the GL Compositing issue by running the IGP as UXA instead of SNA, however this may cause issues with the offloading process (ie, <code>xrandr --listproviders</code> may not list the discrete GPU).
</p>
<p>For details see <a rel="nofollow" class="external text" href="https://bugs.freedesktop.org/show_bug.cgi?id=69101">FDO Bug #69101</a>.
</p>
<p>One other way to approach this issue is by enabling DRI3 in the Intel driver. See the below issue for a sample configuration.
</p>
<div class="mw-heading mw-heading5"><h5 id="GNOME">GNOME</h5></div>
<p>You may find that <a href="../en/GNOME/Troubleshooting.html#Tear-free_video_with_Intel_HD_Graphics" title="GNOME/Troubleshooting">disabling fullscreen undirect</a> allows PRIME offloading to work correctly for full-screen applications.
</p>
<div class="mw-heading mw-heading3"><h3 id="Kernel_crash/oops_when_using_PRIME_and_switching_windows/workspaces">
<span id="Kernel_crash.2Foops_when_using_PRIME_and_switching_windows.2Fworkspaces"></span>Kernel crash/oops when using PRIME and switching windows/workspaces</h3></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> This has been tested on a system with Intel+AMD</div>
<p>Using DRI3 WITH a configuration file for the integrated card seems to fix this issue.
</p>
<p>To enable DRI3, you need to create a configuration for the integrated card adding the DRI3 option:
</p>
<pre>Section "Device"
    Identifier "Intel Graphics"
    Driver "intel"
    Option "DRI" "3"
EndSection
</pre>
<p>After this you can use <code>DRI_PRIME=1</code> WITHOUT having to run <code>xrandr --setprovideroffloadsink radeon Intel</code> as DRI3 will take care of the offloading.
</p>
<div class="mw-heading mw-heading3"><h3 id="Glitches/Ghosting_synchronization_problem_on_second_monitor_when_using_reverse_PRIME">
<span id="Glitches.2FGhosting_synchronization_problem_on_second_monitor_when_using_reverse_PRIME"></span>Glitches/Ghosting synchronization problem on second monitor when using reverse PRIME</h3></div>
<p>This problem can affect users when not using a <a href="../en/Composite_manager.html" class="mw-redirect" title="Composite manager">composite manager</a>, such as with <a href="../en/I3.html" title="I3">i3</a>. <a rel="nofollow" class="external autonumber" href="https://bugs.freedesktop.org/show_bug.cgi?id=75579">[10]</a>
</p>
<p>If you experience this problem under Gnome, then a possible fix is to set some environment variables in <code>/etc/environment</code> <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=177925">[11]</a>
</p>
<pre>CLUTTER_PAINT=disable-clipped-redraws:disable-culling
CLUTTER_VBLANK=True
</pre>
<div class="mw-heading mw-heading3"><h3 id="Error_&quot;radeon:_Failed_to_allocate_virtual_address_for_buffer:&quot;_when_launching_GL_application">
<span id="Error_.22radeon:_Failed_to_allocate_virtual_address_for_buffer:.22_when_launching_GL_application"></span>Error "radeon: Failed to allocate virtual address for buffer:" when launching GL application</h3></div>
<p>This error is given when the power management in the kernel driver is running.
You can overcome this error by appending <code>radeon.runpm=0</code> to the kernel parameters in the <a href="../en/Boot_loader.html" class="mw-redirect" title="Boot loader">boot loader</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Constant_hangs/freezes_with_Vulkan_applications/games_using_VSync_with_closed-source_drivers_and_reverse_PRIME">
<span id="Constant_hangs.2Ffreezes_with_Vulkan_applications.2Fgames_using_VSync_with_closed-source_drivers_and_reverse_PRIME"></span>Constant hangs/freezes with Vulkan applications/games using VSync with closed-source drivers and reverse PRIME</h3></div>
<p>Some Vulkan applications (particularly ones using VK_PRESENT_MODE_FIFO_KHR and/or VK_PRESENT_MODE_FIFO_RELAXED_KHR, including Windows games ran with DXVK) will cause the GPU to lockup constantly (~5-10 seconds freezed, ~1 second working fine)<a rel="nofollow" class="external autonumber" href="https://devtalk.nvidia.com/default/topic/1044496/linux/hangs-freezes-when-vulkan-v-sync-vk_present_mode_fifo_khr-is-enabled/">[12]</a> when ran on a system using <b>reverse PRIME</b>.
</p>
<p>A GPU lockup will render any input unusable (this includes switching TTYs and using SysRq functions).
</p>
<p>There is no known fix for this NVIDIA bug, but a few workarounds exist:
</p>
<ul>
<li>Turning Vsync off (not possible for some applications)</li>
<li>Turning PRIME Synchronization<a rel="nofollow" class="external autonumber" href="https://devtalk.nvidia.com/default/topic/957814/linux/prime-and-prime-synchronization/">[13]</a> off (will introduce screen tearing):</li>
</ul>
<pre>xrandr --output HDMI-0 --set "PRIME Synchronization" 0 #replace HDMI-0 with your xrandr output ID
</pre>
<p>You can verify if your configuration is affected by the issue simply by running <code>vkcube</code> from the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=vulkan-tools">vulkan-tools</a></span> package.
</p>
<div class="mw-heading mw-heading3"><h3 id="Some_programs_have_a_delay_when_opening_under_Wayland">Some programs have a delay when opening under Wayland</h3></div>
<p>If you have RTD3 working (from <a href="#NVIDIA">#NVIDIA</a>), when using Wayland you will experience some delay when some programs open.
Depending on the application, this can be caused by two sources: Vulkan, or OpenGL, but the mechanism causing the delay is the same.
Both will have to determine which device to defer to. This decision is made based on configuration files.
For OpenGL, the configurations are located in <code>/usr/share/glvnd/egl_vendor.d/</code>, while for Vulkan they are located in <code>/usr/share/vulkan/icd.d/</code>.
The actual delay itself is caused by the determination of a candidate requiring iteration over all potential rendering configurations.
Even if the preferred configuration appears before the other (i.e. has a lower number, igpu before external), it will still iterate through all available options.
While trying the configuration for the sleeping (external) GPU, it is woken up (which it takes ~1 second or more) before deferring to open the program, wasting time and battery life.
This is an NVIDIA driver problem. <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=2094847#p2094847">More details here.</a>
</p>
<p>One solution is to make sure the dedicated GPU is not started is to make sure it is not iterated.
This can be done by explicitly setting the configurations as environment variables. These can be passed either directly when running a program, or set globally (for example in your <code>/etc/environment</code> file). Do note that setting it globally requires you to un-set this variable (or set it to the nvidia files respectively) when deliberately trying to run a program with the external GPU.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/environment</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">__EGL_VENDOR_LIBRARY_FILENAMES=/usr/share/glvnd/egl_vendor.d/50_mesa.json
VK_ICD_FILENAMES=/usr/share/vulkan/icd.d/intel_icd.x86_64.json
__GLX_VENDOR_LIBRARY_NAME=mesa</pre>
<div class="mw-heading mw-heading3"><h3 id="Error_when_running_Wine_games_with_DXVK">Error when running Wine games with DXVK</h3></div>
<p>When using PRIME offload, encountering the <code>Major opcode of failed request: 156 (NV-GLX)</code> is a known problem. The only known workaround is to start X session <a href="../en/NVIDIA_Optimus.html#Use_NVIDIA_graphics_only" title="NVIDIA Optimus">entirely on NVIDIA GPU</a>. A user friendly way to switching between NVIDIA only and PRIME offload method is the <a href="../en/NVIDIA_Optimus.html#Using_optimus-manager" title="NVIDIA Optimus">optimus-manager</a> utility or write some automation scripts yourself.
</p>
<div class="mw-heading mw-heading3"><h3 id="Vulkan/OpenGL_applications_segfault_on_Wayland">
<span id="Vulkan.2FOpenGL_applications_segfault_on_Wayland"></span>Vulkan/OpenGL applications segfault on Wayland</h3></div>
<p><code>VK_KHR_wayland_surface</code> requires Kernel modesetting. If you are using a Wayland compositor and unable to start applications on the dGPU without having to force them to run under Xwayland, make sure modesetting is enabled.
</p>
<p>This means removing <code>nvidia_drm.modeset=0</code> from Kernel parameters if present.
</p>
<div class="mw-heading mw-heading2"><h2 id="See_also">See also</h2></div>
<ul><li><a rel="nofollow" class="external text" href="https://wiki.freedesktop.org/nouveau/Optimus/">Nouveau Optimus</a></li></ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Graphics.html" title="Category:Graphics">Graphics</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=PRIME&amp;oldid=862952">https://wiki.archlinux.org/index.php?title=PRIME&amp;oldid=862952</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 27 January 2026, at 22:21.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container no-font-mode-scale">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue  vector-search-box-show-thumbnail vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search cdx-typeahead-search--show-thumbnail">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input mw-searchInput" autocomplete="off" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true"><span class="mw-page-title-main">PRIME</span></div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only reading-lists-bookmark" id="ca-bookmark-sticky-header" tabindex="-1" data-event-name="watch-sticky-bookmark"><span class="vector-icon mw-ui-icon-wikimedia-bookmarkOutline mw-ui-icon-wikimedia-wikimedia-bookmarkOutline"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
