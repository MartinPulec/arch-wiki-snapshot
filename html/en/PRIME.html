<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>PRIME - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-PRIME rootpage-PRIME skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
			<button aria-controls="toc-Installation-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Installation subsection</span>
			</button>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
			<li id="toc-Open-source_drivers" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Open-source_drivers">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Open-source drivers</div>
			</a>
			
			<ul id="toc-Open-source_drivers-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Closed-source_drivers" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Closed-source_drivers">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Closed-source drivers</div>
			</a>
			
			<ul id="toc-Closed-source_drivers-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-PRIME_GPU_offloading" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#PRIME_GPU_offloading">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>PRIME GPU offloading</div>
		</a>
		
			<button aria-controls="toc-PRIME_GPU_offloading-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle PRIME GPU offloading subsection</span>
			</button>
		
		<ul id="toc-PRIME_GPU_offloading-sublist" class="vector-toc-list">
			<li id="toc-For_open_source_drivers_-_PRIME" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#For_open_source_drivers_-_PRIME">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>For open source drivers - PRIME</div>
			</a>
			
			<ul id="toc-For_open_source_drivers_-_PRIME-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-PRIME_render_offload" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#PRIME_render_offload">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>PRIME render offload</div>
			</a>
			
			<ul id="toc-PRIME_render_offload-sublist" class="vector-toc-list">
				<li id="toc-PCI-Express_Runtime_D3_(RTD3)_Power_Management" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#PCI-Express_Runtime_D3_(RTD3)_Power_Management">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.1</span>PCI-Express Runtime D3 (RTD3) Power Management</div>
			</a>
			
			<ul id="toc-PCI-Express_Runtime_D3_(RTD3)_Power_Management-sublist" class="vector-toc-list">
				<li id="toc-Open-source_drivers_2" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Open-source_drivers_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.1.1</span>Open-source drivers</div>
			</a>
			
			<ul id="toc-Open-source_drivers_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-NVIDIA" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#NVIDIA">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.1.2</span>NVIDIA</div>
			</a>
			
			<ul id="toc-NVIDIA-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Configure_applications_to_render_using_GPU" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Configure_applications_to_render_using_GPU">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.2</span>Configure applications to render using GPU</div>
			</a>
			
			<ul id="toc-Configure_applications_to_render_using_GPU-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Gnome_integration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Gnome_integration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.3</span>Gnome integration</div>
			</a>
			
			<ul id="toc-Gnome_integration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Troubleshooting">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.4</span>Troubleshooting</div>
			</a>
			
			<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-PRIME_synchronization" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#PRIME_synchronization">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>PRIME synchronization</div>
			</a>
			
			<ul id="toc-PRIME_synchronization-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Wayland-specific_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Wayland-specific_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4</span>Wayland-specific configuration</div>
			</a>
			
			<ul id="toc-Wayland-specific_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Reverse_PRIME" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Reverse_PRIME">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Reverse PRIME</div>
		</a>
		
			<button aria-controls="toc-Reverse_PRIME-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Reverse PRIME subsection</span>
			</button>
		
		<ul id="toc-Reverse_PRIME-sublist" class="vector-toc-list">
			<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Configuration</div>
			</a>
			
			<ul id="toc-Configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Problems" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Problems">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Problems</div>
			</a>
			
			<ul id="toc-Problems-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-User_scenarios" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#User_scenarios">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>User scenarios</div>
		</a>
		
			<button aria-controls="toc-User_scenarios-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle User scenarios subsection</span>
			</button>
		
		<ul id="toc-User_scenarios-sublist" class="vector-toc-list">
			<li id="toc-Discrete_card_as_primary_GPU" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Discrete_card_as_primary_GPU">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Discrete card as primary GPU</div>
			</a>
			
			<ul id="toc-Discrete_card_as_primary_GPU-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting_2" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting_2">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting_2-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting_2-sublist" class="vector-toc-list">
			<li id="toc-XRandR_specifies_only_1_output_provider" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#XRandR_specifies_only_1_output_provider">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>XRandR specifies only 1 output provider</div>
			</a>
			
			<ul id="toc-XRandR_specifies_only_1_output_provider-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-When_an_application_is_rendered_with_the_discrete_card,_it_only_renders_a_black_screen" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#When_an_application_is_rendered_with_the_discrete_card,_it_only_renders_a_black_screen">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>When an application is rendered with the discrete card, it only renders a black screen</div>
			</a>
			
			<ul id="toc-When_an_application_is_rendered_with_the_discrete_card,_it_only_renders_a_black_screen-sublist" class="vector-toc-list">
				<li id="toc-Black_screen_with_GL-based_compositors" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Black_screen_with_GL-based_compositors">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.1</span>Black screen with GL-based compositors</div>
			</a>
			
			<ul id="toc-Black_screen_with_GL-based_compositors-sublist" class="vector-toc-list">
				<li id="toc-GNOME" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#GNOME">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.1.1</span>GNOME</div>
			</a>
			
			<ul id="toc-GNOME-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Kernel_crash/oops_when_using_PRIME_and_switching_windows/workspaces" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Kernel_crash/oops_when_using_PRIME_and_switching_windows/workspaces">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Kernel crash/oops when using PRIME and switching windows/workspaces</div>
			</a>
			
			<ul id="toc-Kernel_crash/oops_when_using_PRIME_and_switching_windows/workspaces-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Glitches/Ghosting_synchronization_problem_on_second_monitor_when_using_reverse_PRIME" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Glitches/Ghosting_synchronization_problem_on_second_monitor_when_using_reverse_PRIME">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>Glitches/Ghosting synchronization problem on second monitor when using reverse PRIME</div>
			</a>
			
			<ul id="toc-Glitches/Ghosting_synchronization_problem_on_second_monitor_when_using_reverse_PRIME-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-Error_"radeon:_Failed_to_allocate_virtual_address_for_buffer:"_when_launching_GL_application' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#Error_"radeon:_Failed_to_allocate_virtual_address_for_buffer:"_when_launching_GL_application'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5</span>Error "radeon: Failed to allocate virtual address for buffer:" when launching GL application</div>
			</a>
			
			<ul id='toc-Error_"radeon:_Failed_to_allocate_virtual_address_for_buffer:"_when_launching_GL_application-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Constant_hangs/freezes_with_Vulkan_applications/games_using_VSync_with_closed-source_drivers_and_reverse_PRIME" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Constant_hangs/freezes_with_Vulkan_applications/games_using_VSync_with_closed-source_drivers_and_reverse_PRIME">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.6</span>Constant hangs/freezes with Vulkan applications/games using VSync with closed-source drivers and reverse PRIME</div>
			</a>
			
			<ul id="toc-Constant_hangs/freezes_with_Vulkan_applications/games_using_VSync_with_closed-source_drivers_and_reverse_PRIME-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Some_programs_have_a_delay_when_opening_under_Wayland" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Some_programs_have_a_delay_when_opening_under_Wayland">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.7</span>Some programs have a delay when opening under Wayland</div>
			</a>
			
			<ul id="toc-Some_programs_have_a_delay_when_opening_under_Wayland-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Error_when_running_Wine_games_with_DXVK" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Error_when_running_Wine_games_with_DXVK">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.8</span>Error when running Wine games with DXVK</div>
			</a>
			
			<ul id="toc-Error_when_running_Wine_games_with_DXVK-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">PRIME</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/PRIME.html" title="PRIME – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/PRIME" title="PRIME – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/PRIME" title="PRIME – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/NVIDIA_Optimus.html" title="NVIDIA Optimus">NVIDIA Optimus</a></li>
<li><a href="../en/External_GPU.html" title="External GPU">External GPU</a></li>
</ul>
</div>
<p>PRIME is a technology used to manage <a href="../en/Hybrid_graphics.html" title="Hybrid graphics">hybrid graphics</a> found on recent desktops and laptops (<a href="../en/NVIDIA_Optimus.html" title="NVIDIA Optimus">Optimus for NVIDIA</a>, AMD Dynamic Switchable Graphics for Radeon). <b>PRIME GPU offloading</b> and <b>Reverse PRIME</b> are an attempt to support muxless hybrid graphics in the Linux kernel.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<h3><span class="mw-headline" id="Open-source_drivers">Open-source drivers</span></h3>
<p>Remove any closed-source graphic drivers and replace them with the open source equivalent:
</p>
<ul>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-nouveau">xf86-video-nouveau</a></span></li>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-ati">xf86-video-ati</a></span></li>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-amdgpu">xf86-video-amdgpu</a></span></li>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-intel">xf86-video-intel</a></span></li>
</ul>
<p>Reboot and check the list of attached graphic drivers:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ xrandr --listproviders</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Providers: number : 2
Provider 0: id: 0x7d cap: 0xb, Source Output, Sink Output, Sink Offload crtcs: 3 outputs: 4 associated providers: 1 name:Intel
Provider 1: id: 0x56 cap: 0xf, Source Output, Sink Output, Source Offload, Sink Offload crtcs: 6 outputs: 1 associated providers: 1 name:radeon
</pre>
<p>We can see that there are two graphic cards: Intel, the integrated card (id 0x7d), and Radeon, the discrete card (id 0x56), which should be used for GPU-intensive applications.
</p>
<p>By default the Intel card is always used:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ glxinfo | grep "OpenGL renderer"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">OpenGL renderer string: Mesa DRI Intel(R) Ivybridge Mobile
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Sometimes, the displayed provider is <code>"HAINAN @ pci:0000:03:00.0"</code>, not <code>radeon</code>. In this case you should use <code>"HAINAN @ pci:0000:03:00.0"</code> as the provider in the next command.</div>
<h3><span class="mw-headline" id="Closed-source_drivers">Closed-source drivers</span></h3>
<p>To get PRIME functioning on the proprietary drivers, it is pretty much the same process. Follow the following articles to install the drivers:
</p>
<ul>
<li>
<a href="../en/AMDGPU_PRO.html" title="AMDGPU PRO">AMDGPU PRO</a> to install drivers for AMD GPUs.</li>
<li>
<a href="../en/NVIDIA.html" title="NVIDIA">NVIDIA</a> to install drivers for NVIDIA GPUs.</li>
</ul>
<p>After you have the driver installed, do <i>not</i> reboot or relaunch Xorg. Depending on your system configuration, this may render your Xorg system unusable until reconfigured.
</p>
<p>Follow the instructions for the section on your designated use-case. You do not need to uninstall the open-source drivers for it to function, but you probably should, for the sake of preventing clutter and potential future issues.
</p>
<h2><span class="mw-headline" id="PRIME_GPU_offloading">PRIME GPU offloading</span></h2>
<p>We want to render applications on the more powerful card and send the result to the card which has display connected.
</p>
<p>The command <code>xrandr --setprovideroffloadsink provider sink</code> can be used to make a render offload provider send its output to the sink provider (the provider which has a display connected). The provider and sink identifiers can be numeric (0x7d, 0x56) or a case-sensitive name (Intel, radeon). 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>This setting is no longer necessary when using most default Xorg DDX (the <code>xf86-video-*</code> or built-in modesetting) drivers from the official repositories, as they have DRI3 enabled by default and will therefore automatically make these assignments. Explicitly setting them again does no harm, though.</li>
<li>GPU offloading is not supported by the closed-source drivers (for the NVIDIA driver this is no longer the case, for more info see <a href="#PRIME_render_offload">#PRIME render offload</a> below).</li>
</ul>
</div>
<p>Example:
</p>
<pre>$ xrandr --setprovideroffloadsink radeon Intel
</pre>
<p>You may also use provider index instead of provider name:
</p>
<pre>$ xrandr --setprovideroffloadsink 1 0
</pre>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> The following subsections are a messy, we name a subsection PRIME render offload without stating it's NVIDIA-centric, we shove generic PCI-E power management for the open source drivers inside, the merge flag from <a href="../en/External_GPU.html#Xorg_rendered_on_iGPU,_PRIME_render_offload_to_eGPU" title="External GPU">External GPU#Xorg rendered on iGPU, PRIME render offload to eGPU</a> should probably be addressed on the other page, once this has cleaned up and we can link to here for the environment variables to use. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:PRIME.html">Talk:PRIME</a>)</div>
</div>
<h3><span class="mw-headline" id="For_open_source_drivers_-_PRIME">For open source drivers - PRIME</span></h3>
<p>To use your discrete card for the applications who need it the most (for example games, 3D modellers...), prepend the <code>DRI_PRIME=1</code> environment variable:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ DRI_PRIME=1 glxinfo | grep "OpenGL renderer"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">OpenGL renderer string: Gallium 0.4 on AMD TURKS</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Instead of numerical value, you can also specify a PCI device name. Format used is similar to <code>/sys/bus/pci/devices/</code>, but prefix with <code>pci-</code> and replace semicolons and dots by underscores, e.g. <code>DRI_PRIME=pci-0000_01_00_0</code>.</div>
<p>Other applications will still use the less power-hungry integrated card. These settings are lost once the X server restarts, you may want to make a script and auto-run it at the startup of your desktop environment (alternatively, put it in <code>/etc/X11/xinit/xinitrc.d/</code>). This may reduce your battery life and increase heat though.
</p>
<p>See <a href="https://wiki.gentoo.org/wiki/AMDGPU#Test.2C_if_a_discrete_graphics_card_is_in_use" class="extiw" title="gentoo:AMDGPU">Gentoo:AMDGPU#Test, if a discrete graphics card is in use</a> for more information.
</p>
<p>For <code>DRI_PRIME</code> to work on Vulkan applications <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=vulkan-mesa-layers">vulkan-mesa-layers</a></span> needs to be installed, as well as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lib32-vulkan-mesa-layers">lib32-vulkan-mesa-layers</a></span> for 32 bit applications.
</p>
<h3><span class="mw-headline" id="PRIME_render_offload">PRIME render offload</span></h3>
<p>NVIDIA driver since <a rel="nofollow" class="external text" href="https://download.nvidia.com/XFree86/Linux-x86_64/435.17/README/primerenderoffload.html">version 435.17</a> supports this method. The modesetting, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-amdgpu">xf86-video-amdgpu</a></span> (450.57), and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-intel">xf86-video-intel</a></span> (455.38) are officially supported as iGPU drivers.
</p>
<p>To run a program on the NVIDIA card you can use the <code>prime-run</code> script provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvidia-prime">nvidia-prime</a></span>:
</p>
<pre>$ prime-run glxinfo | grep "OpenGL renderer"
$ prime-run vulkaninfo
</pre>
<h4>
<span id="PCI-Express_Runtime_D3_.28RTD3.29_Power_Management"></span><span class="mw-headline" id="PCI-Express_Runtime_D3_(RTD3)_Power_Management">PCI-Express Runtime D3 (RTD3) Power Management</span>
</h4>
<h5><span class="mw-headline" id="Open-source_drivers_2">Open-source drivers</span></h5>
<p>Kernel PCI power management turns off the GPU when not used with PRIME offloading or reverse PRIME.
This feature is supported by modesetting, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-amdgpu">xf86-video-amdgpu</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-intel">xf86-video-intel</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-nouveau">xf86-video-nouveau</a></span> drivers.
</p>
<p>The following command can be used to check current <a rel="nofollow" class="external autonumber" href="https://docs.kernel.org/power/pci.html#native-pci-power-management">[1]</a> power state of each GPU:
</p>
<pre>$ cat /sys/class/drm/card*/device/power_state
</pre>
<h5><span class="mw-headline" id="NVIDIA">NVIDIA</span></h5>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>No configuration is generally needed for Ampere as this is enabled by default. For some Ampere users, udev rules may be necessary.</li>
<li>Some users with hybrid graphics are reporting that their discrete NVIDIA Ampere GPUs are failing to remain in the D3Cold power state after upgrading to newer NVIDIA drivers (seemingly &gt;525) <a rel="nofollow" class="external autonumber" href="https://forums.developer.nvidia.com/t/nvidia-gpu-fails-to-power-off-prime-razer-blade-14-2022/250023">[2]</a>.</li>
<li>Some users with pre-Ampere card and broken D3 support on newer drivers reported a workaround to disable the GSP firmware with <code>NVreg_EnableGpuFirmware=0</code><a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?pid=2182638">[3]</a>.</li>
</ul>
</div>
<p>For Turing generation cards with Intel Coffee Lake or above CPUs as well as some Ryzen CPUs like the 5800H, it is possible to fully <a rel="nofollow" class="external text" href="https://us.download.nvidia.com/XFree86/Linux-x86_64/550.54.14/README/dynamicpowermanagement.html">power down the GPU when not in use</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you plan to use suspend or hibernate, see <a href="../en/NVIDIA/Tips_and_tricks.html#Preserve_video_memory_after_suspend" title="NVIDIA/Tips and tricks">NVIDIA/Tips and tricks#Preserve video memory after suspend</a>.</div>
<p>The following <a href="../en/Udev.html" title="Udev">udev</a> rules are needed, as recommended by NVIDIA: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/80-nvidia-pm.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Enable runtime PM for NVIDIA VGA/3D controller devices on driver bind
ACTION=="bind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030000", TEST=="power/control", ATTR{power/control}="auto"
ACTION=="bind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030200", TEST=="power/control", ATTR{power/control}="auto"

# Disable runtime PM for NVIDIA VGA/3D controller devices on driver unbind
ACTION=="unbind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030000", TEST=="power/control", ATTR{power/control}="on"
ACTION=="unbind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030200", TEST=="power/control", ATTR{power/control}="on"</pre>
<p>Some users also <a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nvidia-prime-rtd3pm#comment-920182">reported</a> that the following additional lines are necessary too:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/80-nvidia-pm.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Enable runtime PM for NVIDIA VGA/3D controller devices on adding device
ACTION=="add", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030000", TEST=="power/control", ATTR{power/control}="auto"
ACTION=="add", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030200", TEST=="power/control", ATTR{power/control}="auto"</pre>
<p>Also, add the following <a href="../en/Kernel_module.html#Setting_module_options" class="mw-redirect" title="Module parameter">module parameters</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/nvidia-pm.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options nvidia "NVreg_DynamicPowerManagement=0x02"</pre>
<p>Alternatively, you can install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nvidia-prime-rtd3pm/">nvidia-prime-rtd3pm</a></span><sup><small>AUR</small></sup> which provides these two configuration files.
</p>
<p>After you setup the <a href="../en/Udev.html" title="Udev">udev</a> rules and the <a href="../en/Kernel_module.html#Setting_module_options" class="mw-redirect" title="Module parameter">module parameter</a> either manually or using the AUR package, you will need to restart your Laptop.
</p>
<p>To check if the NVIDIA GPU is turned off you can use this command:
</p>
<pre>$ cat /sys/bus/pci/devices/0000:01:00.0/power/runtime_status
</pre>
<p>You will see either <code>suspended</code> or <code>running</code>, if <code>suspended</code> is displayed, the GPU is turned off. Now the power draw will 0 Watts making the battery last longer.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> What are "some cases"? At least disclose the GPU. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:PRIME.html">Talk:PRIME</a>)</div>
</div>
<p>In some cases, none of the options above might be listed and instead the result will be <code>active</code>. This alone does not mean that the GPU is in the <code>running</code> state. In this case you can check the state using this command:
</p>
<pre>$ cat /sys/bus/pci/devices/0000:01:00.0/power/runtime_suspended_time
</pre>
<p>While the GPU is in <code>suspended</code> state, the counter will be incrementing every time you run the command. When the GPU's state becomes <code>running</code> it will stop incrementing.
</p>
<p>We also need to <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>nvidia-persistenced.service</code> to avoid the kernel tearing down the device state whenever the NVIDIA device resources are no longer in use. <a rel="nofollow" class="external autonumber" href="https://us.download.nvidia.com/XFree86/Linux-x86_64/550.54.14/README/nvidia-persistenced.html">[4]</a>
</p>
<h4><span class="mw-headline" id="Configure_applications_to_render_using_GPU">Configure applications to render using GPU</span></h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Merge-arrows-2.svg" decoding="async" width="36" height="40" class="mw-file-element"></span></span><b>This article or section is a candidate for merging with <a href="../en/External_GPU.html#Xorg_rendered_on_iGPU,_PRIME_render_offload_to_eGPU" title="External GPU">External GPU#Xorg rendered on iGPU, PRIME render offload to eGPU</a>.</b></p>
<div>
<b>Notes:</b> Target section mentions these variables. Perhaps this can be merged with the target section to avoid duplication? (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:PRIME.html">Talk:PRIME</a>)</div>
</div>
<p>Even without enabling Dynamic Power Management, offload rendering of applications is required <a rel="nofollow" class="external autonumber" href="https://web.archive.org/web/20211203072304/https://jeansenvaars.wordpress.com/2021/12/02/endeavouros-hybrid-gpu-benchmarks/">[5]</a>.
</p>
<p>To run an application offloaded to the NVIDIA GPU with Dynamic Power Management enabled, add the following <a href="../en/Environment_variables.html" title="Environment variables">environment variables</a>: <a rel="nofollow" class="external autonumber" href="https://download.nvidia.com/XFree86/Linux-x86_64/550.54.14/README/primerenderoffload.html">[6]</a>
</p>
<pre>__NV_PRIME_RENDER_OFFLOAD=1 __GLX_VENDOR_LIBRARY_NAME=nvidia <i>command</i>
</pre>
<p>When using on a <a href="../en/Steam.html" title="Steam">Steam</a> game, the launcher command line can be set to:
</p>
<pre>__NV_PRIME_RENDER_OFFLOAD=1 __GLX_VENDOR_LIBRARY_NAME=nvidia %command%
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The value of __NV_PRIME_RENDER_OFFLOAD may need to be set to 0 depending on the system. It is recommended to check which GPU is 0 and which is 1 since this variable specifies which GPU will be used.</div>
<h4><span class="mw-headline" id="Gnome_integration">Gnome integration</span></h4>
<p>For GNOME integration, <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=switcheroo-control">switcheroo-control</a></span> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>switcheroo-control.service</code>.
</p>
<p>GNOME will respect the <code>PrefersNonDefaultGPU</code> property in the <a href="../en/Desktop_entries.html" class="mw-redirect" title="Desktop entry">desktop entry</a>. Alternatively, you can launch applications with GPU by right clicking on the icon and choosing <code>Launch using Discrete Graphics Card</code>.
</p>
<h4><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h4>
<p>If you have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bumblebee">bumblebee</a></span> installed, you should remove it because it blacklists the <code>nvidia_drm</code> driver which is required to load the NVIDIA driver by X server for offloading.
</p>
<h3><span class="mw-headline" id="PRIME_synchronization">PRIME synchronization</span></h3>
<p>When using PRIME, the primary GPU renders the screen content / applications, and passes it to the secondary GPU for display. Quoting <a rel="nofollow" class="external text" href="https://forums.developer.nvidia.com/t/prime-and-prime-synchronization/44423">an NVIDIA thread</a>, "Traditional vsync can synchronize the rendering of the application with the copy into system memory, but there needs to be an additional mechanism to synchronize the copy into system memory with the iGPU’s display engine. Such a mechanism would have to involve communication between the dGPU’s and the iGPU’s drivers, unlike traditional vsync."
</p>
<p>This synchronization is achieved using PRIME sync. To check if PRIME synchronization is enabled for your display, check the output of <code>xrandr --prop</code>.
</p>
<p>To enable it run:
</p>
<pre>$ xrandr --output &lt;output-name&gt; --set "PRIME Synchronization" 1
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>A pre-requisite for PRIME synchronization with the NVIDIA driver is to <a href="../en/NVIDIA.html#DRM_kernel_mode_setting" title="NVIDIA">enable modesetting</a>.</li>
<li>PRIME synchronization is not available with the <a href="../en/AMDGPU.html" title="AMDGPU">AMDGPU</a> DDX driver (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xf86-video-amdgpu">xf86-video-amdgpu</a></span>).</li>
</ul>
</div>
<h3><span class="mw-headline" id="Wayland-specific_configuration">Wayland-specific configuration</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> It looks like this section duplicates all the previous ones, without explaining in details what is Wayland-specific about the environment variable used. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:PRIME.html">Talk:PRIME</a>)</div>
</div>
<p>Wayland needs less configuration than Xorg. There seems to be also preliminary support for GPU hotplugging in <a rel="nofollow" class="external text" href="https://invent.kde.org/plasma/kwin/-/merge_requests/811">KDE's KWin</a> and GNOME's Mutter (<a rel="nofollow" class="external text" href="https://gitlab.gnome.org/GNOME/mutter/-/issues/17">Issue 17</a> and <a rel="nofollow" class="external text" href="https://gitlab.gnome.org/GNOME/mutter/-/merge_requests/1562">Merge request 1562</a>).
</p>
<p>To use your discrete card prepend the <code>DRI_PRIME=</code> <a href="../en/Environment_variables.html" class="mw-redirect" title="Environment variable">environment variable</a>. The following examples assume a system with an Intel integrated card, an NVIDIA internal GPU and an AMD external GPU.
</p>
<p>To use the integrated Intel chip, no modifications are required, since it is already the default: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">glxinfo | grep 'OpenGL renderer'</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">OpenGL renderer string: Mesa Intel(R) Xe Graphics (TGL GT2)
</pre>
<p>For the AMD card with opensource drivers: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">DRI_PRIME=pci-0000_06_00_0 glxinfo | grep 'OpenGL renderer'</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">OpenGL renderer string: AMD Radeon RX 5700 XT (navi10, LLVM 14.0.6, DRM 3.46, 5.18.17-hardened1-1-hardened)</pre>
<p>For the NVIDIA card with proprietary drivers: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">DRI_PRIME=pci-0000_01_00_0 __VK_LAYER_NV_optimus=NVIDIA_only __GLX_VENDOR_LIBRARY_NAME=nvidia glxinfo | grep 'OpenGL renderer string'</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">OpenGL renderer string: NVIDIA GeForce RTX 3050 Ti Laptop GPU/PCIe/SSE2</pre>
<p>Multiple GPUs can be used at the same time on the same machine with Wayland. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Hotplugging an external GPU is enabled with a limitation: re-logging is necessary to load the correct kernel modules.</div>
<p>See the mesa3d documentation for PRIME: <a rel="nofollow" class="external free" href="https://docs.mesa3d.org/envvars.html">https://docs.mesa3d.org/envvars.html</a>
</p>
<p>All Xwayland applications should work out of the box just like they do on Xorg. However, as of driver version 525.85, for native Wayland applications, only OpenGL works, provided you have <a href="../en/NVIDIA.html#DRM_kernel_mode_setting" title="NVIDIA">modesetting</a> enabled.
</p>
<p>Vulkan Wayland applications will render an invisible window or might even crash since the NVIDIA driver uses hardware specific pixel layout which the Intel or AMD GPUs do not understand. More info on NVIDIA's <a rel="nofollow" class="external text" href="https://github.com/NVIDIA/egl-wayland/issues/72">GitHub issue 72</a>.
</p>
<h2><span class="mw-headline" id="Reverse_PRIME">Reverse PRIME</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Missing info about configuring Intel + AMD reverse prime for both open and closed amdgpu drivers (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:PRIME.html">Talk:PRIME</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Reverse PRIME is not supported for AMDGPU + NVIDIA on NVIDIA driver prior to 470 beta. See <a rel="nofollow" class="external autonumber" href="https://forums.developer.nvidia.com/t/hp-omen-15-ryzen-4600h-nvidia-1660ti-no-display-over-hdmi/165265/2">[7]</a> for more details. An alternative for older versions is to use NVIDIA as the primary card as described in <a href="#Discrete_card_as_primary_GPU">#Discrete card as primary GPU</a>.</li>
<li>Currently when only external display is enabled, you will only get 1 FPS. See <a rel="nofollow" class="external autonumber" href="https://gitlab.freedesktop.org/xorg/xserver/-/issues/1028">[8]</a> for more details.</li>
</ul>
</div>
<p>If the second GPU has outputs that are not accessible by the primary GPU, you can use <b>Reverse PRIME</b> to make use of them. This will involve using the primary GPU to render the images, and then pass them off to the second GPU.
</p>
<p>It may work out of the box, however if not, please go through the following steps.
</p>
<h3><span class="mw-headline" id="Configuration">Configuration</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> First half of the section has Intel + NVIDIA, the second half has Intel + Radeon. Identifying the GPU bus IDs should be delegated to a general section. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:PRIME.html">Talk:PRIME</a>)</div>
</div>
<p>First, identify integrated GPU BusID
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">lspci | grep VGA</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">00:02.0 VGA compatible controller: Intel Corporation UHD Graphics 630 (Mobile)
01:00.0 VGA compatible controller: NVIDIA Corporation TU117M [GeForce GTX 1650 Mobile / Max-Q] (rev a1)
</pre>
<p>In the above example Intel card has 00:02.0 which translates to PCI:0:2:0.
</p>
<p>Set up your xorg.conf as follows and adjust BusID.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/X11/xorg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Section "ServerLayout"
        Identifier "layout"
        Screen 0 "intel"
        Inactive "nvidia"
        Option "AllowNVIDIAGPUScreens"
EndSection

Section "Device"
        Identifier "nvidia"
        Driver "nvidia"
EndSection

Section "Screen"
        Identifier "nvidia"
        Device "nvidia"
EndSection

Section "Device"
        Identifier "intel"
        Driver "modesetting"
        BusID "PCI:0:2:0"
EndSection

Section "Screen"
        Identifier "intel"
        Device "intel"
EndSection
</pre>
<p>The command <code>xrandr --setprovideroutputsource provider source</code> sets the provider as output for the source. For example:
</p>
<pre>$ xrandr --setprovideroutputsource radeon Intel
</pre>
<p>When this is done, the discrete card's outputs should be available in xrandr, and you could do something like:
</p>
<pre>$ xrandr --output HDMI-1 --auto --above LVDS1
</pre>
<p>to configure both internal as well as external displays.
</p>
<h3><span class="mw-headline" id="Problems">Problems</span></h3>
<p>If after reboot you only have one provider, it might be because when Xorg starts, the <code>nvidia</code> module is not loaded yet. You need to enable early module loading. See <a href="../en/NVIDIA.html#Early_loading" title="NVIDIA">NVIDIA#Early loading</a> for details.
</p>
<h2><span class="mw-headline" id="User_scenarios">User scenarios</span></h2>
<h3><span class="mw-headline" id="Discrete_card_as_primary_GPU">Discrete card as primary GPU</span></h3>
<p>Imagine following scenario: The LVDS1 (internal laptop screen) and VGA outputs are both only accessible through the integrated Intel GPU. The HDMI and Display Port outputs are attached to the discrete NVIDIA card. It is possible to use all four outputs by making use of the <a href="#Reverse_PRIME">#Reverse PRIME</a> technology as described above. However the performance might be slow, because all the rendering for all outputs is done by the integrated Intel card. To improve this situation it is possible to do the rendering by the discrete NVIDIA card, which then copies the framebuffers for the LVDS1 and VGA outputs to the Intel card.
</p>
<p>Create the following Xorg configuration:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/X11/xorg.conf.d/10-gpu.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Section "ServerLayout"
    Identifier "layout"
    Screen 0 "nouveau"
    Inactive "intel"
EndSection

Section "Device"
    Identifier  "nouveau"
    Driver      "nouveau"
    BusID       "PCI:x:x:x" # Sample: "PCI:1:0:0"
EndSection

Section "Screen"
    Identifier "nouveau"
    Device "nouveau"
EndSection

Section "Device"
    Identifier  "intel"
    Driver      "intel"
    BusID       "PCI:x:x:x"  # Sample: "PCI:0:2:0"
EndSection

Section "Screen"
    Identifier "intel"
    Device "intel"
EndSection
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> For the proprietary NVIDIA driver see <a rel="nofollow" class="external autonumber" href="https://us.download.nvidia.com/XFree86/Linux-x86_64/550.54.14/README/randr14.html">[9]</a> instead.</div>
<p>Restart Xorg. The discrete NVIDIA card should be used now. The HDMI and Display Port outputs are the main outputs. The LVDS1 and VGA outputs are off. To enable them run:
</p>
<pre>$ xrandr --setprovideroutputsource Intel nouveau
</pre>
<p>The internal card's outputs should be available now in xrandr.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> With NVIDIA being used to render the screen, you may face sluggish scrolling or screen tearing. Check <a href="../en/NVIDIA/Troubleshooting.html#Avoid_screen_tearing" title="NVIDIA/Troubleshooting">NVIDIA/Troubleshooting#Avoid screen tearing</a> on how to mitigate it.</div>
<h2><span class="mw-headline" id="Troubleshooting_2">Troubleshooting</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> No sources to motivate the workarounds in this section (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:PRIME.html">Talk:PRIME</a>)</div>
</div>
<h3><span class="mw-headline" id="XRandR_specifies_only_1_output_provider">XRandR specifies only 1 output provider</span></h3>
<p>Delete/move /etc/X11/xorg.conf file and any other files relating to GPUs in /etc/X11/xorg.conf.d/. Restart the X server after this change.
</p>
<p>If the video driver is blacklisted in <code>/etc/modprobe.d/</code> or <code>/usr/lib/modprobe.d/</code>, load the module and restart X. This may be the case if you use the bbswitch module for NVIDIA GPUs.
</p>
<p>Another possible problem is that Xorg might try to automatically assign monitors to your second GPU. Check the logs:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ grep "No modes" ~/.local/share/xorg/Xorg.0.log</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">AMDGPU(0): No modes.
</pre>
<p>To solve this add the ServerLayout section with inactive device to your xorg.conf:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/X11/xorg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Section "ServerLayout"
  Identifier     "X.org Configured"
  Screen      0  "Screen0" 0 0 # Screen for your primary GPU
  Inactive       "Card1"       # Device for your second GPU
EndSection
</pre>
<h3>
<span id="When_an_application_is_rendered_with_the_discrete_card.2C_it_only_renders_a_black_screen"></span><span class="mw-headline" id="When_an_application_is_rendered_with_the_discrete_card,_it_only_renders_a_black_screen">When an application is rendered with the discrete card, it only renders a black screen</span>
</h3>
<p>In some cases PRIME needs a composition manager to properly work. If your window manager doesn’t do compositing, you can use <a href="../en/Xcompmgr.html" title="Xcompmgr">xcompmgr</a> on top of it.
</p>
<p>If you use Xfce, you can go to <i>Menu &gt; Settings &gt; Window Manager Tweaks &gt; Compositor</i> and enable compositing, then try again your application.
</p>
<h4><span class="mw-headline" id="Black_screen_with_GL-based_compositors">Black screen with GL-based compositors</span></h4>
<p>Currently there are issues with GL-based compositors and PRIME offloading. While Xrender-based compositors (xcompmgr, xfwm, compton's default backend, cairo-compmgr, and a few others) will work without issue, GL-based compositors (Mutter/muffin, Compiz, compton with GLX backend, Kwin's OpenGL backend, etc) will initially show a black screen, as if there was no compositor running. While you can force an image to appear by resizing the offloaded window, this is not a practical solution as it will not work for things such as full screen Wine applications. This means that desktop environments such as GNOME3 and Cinnamon have issues with using PRIME offloading.
</p>
<p>Additionally if you are using an Intel IGP you might be able to fix the GL Compositing issue by running the IGP as UXA instead of SNA, however this may cause issues with the offloading process (ie, <code>xrandr --listproviders</code> may not list the discrete GPU).
</p>
<p>For details see <a rel="nofollow" class="external text" href="https://bugs.freedesktop.org/show_bug.cgi?id=69101">FDO Bug #69101</a>.
</p>
<p>One other way to approach this issue is by enabling DRI3 in the Intel driver. See the below issue for a sample configuration.
</p>
<h5><span class="mw-headline" id="GNOME">GNOME</span></h5>
<p>You may find that <a href="../en/GNOME/Troubleshooting.html#Tear-free_video_with_Intel_HD_Graphics" title="GNOME/Troubleshooting">disabling fullscreen undirect</a> allows PRIME offloading to work correctly for full-screen applications.
</p>
<h3>
<span id="Kernel_crash.2Foops_when_using_PRIME_and_switching_windows.2Fworkspaces"></span><span class="mw-headline" id="Kernel_crash/oops_when_using_PRIME_and_switching_windows/workspaces">Kernel crash/oops when using PRIME and switching windows/workspaces</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This has been tested on a system with Intel+AMD</div>
<p>Using DRI3 WITH a configuration file for the integrated card seems to fix this issue.
</p>
<p>To enable DRI3, you need to create a configuration for the integrated card adding the DRI3 option:
</p>
<pre>Section "Device"
    Identifier "Intel Graphics"
    Driver "intel"
    Option "DRI" "3"
EndSection
</pre>
<p>After this you can use DRI_PRIME=1 WITHOUT having to run <code>xrandr --setprovideroffloadsink radeon Intel</code> as DRI3 will take care of the offloading.
</p>
<h3>
<span id="Glitches.2FGhosting_synchronization_problem_on_second_monitor_when_using_reverse_PRIME"></span><span class="mw-headline" id="Glitches/Ghosting_synchronization_problem_on_second_monitor_when_using_reverse_PRIME">Glitches/Ghosting synchronization problem on second monitor when using reverse PRIME</span>
</h3>
<p>This problem can affect users when not using a <a href="../en/Xorg.html#Composite" class="mw-redirect" title="Composite manager">composite manager</a>, such as with <a href="../en/I3.html" title="I3">i3</a>. <a rel="nofollow" class="external autonumber" href="https://bugs.freedesktop.org/show_bug.cgi?id=75579">[10]</a>
</p>
<p>If you experience this problem under Gnome, then a possible fix is to set some environment variables in <code>/etc/environment</code> <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=177925">[11]</a>
</p>
<pre>CLUTTER_PAINT=disable-clipped-redraws:disable-culling
CLUTTER_VBLANK=True
</pre>
<h3>
<span id="Error_.22radeon:_Failed_to_allocate_virtual_address_for_buffer:.22_when_launching_GL_application"></span><span class="mw-headline" id='Error_"radeon:_Failed_to_allocate_virtual_address_for_buffer:"_when_launching_GL_application'>Error "radeon: Failed to allocate virtual address for buffer:" when launching GL application</span>
</h3>
<p>This error is given when the power management in the kernel driver is running.
You can overcome this error by appending <code>radeon.runpm=0</code> to the kernel parameters in the bootloader.
</p>
<h3>
<span id="Constant_hangs.2Ffreezes_with_Vulkan_applications.2Fgames_using_VSync_with_closed-source_drivers_and_reverse_PRIME"></span><span class="mw-headline" id="Constant_hangs/freezes_with_Vulkan_applications/games_using_VSync_with_closed-source_drivers_and_reverse_PRIME">Constant hangs/freezes with Vulkan applications/games using VSync with closed-source drivers and reverse PRIME</span>
</h3>
<p>Some Vulkan applications (particularly ones using VK_PRESENT_MODE_FIFO_KHR and/or VK_PRESENT_MODE_FIFO_RELAXED_KHR, including Windows games ran with DXVK) will cause the GPU to lockup constantly (~5-10 seconds freezed, ~1 second working fine)<a rel="nofollow" class="external autonumber" href="https://devtalk.nvidia.com/default/topic/1044496/linux/hangs-freezes-when-vulkan-v-sync-vk_present_mode_fifo_khr-is-enabled/">[12]</a> when ran on a system using <b>reverse PRIME</b>.
</p>
<p>A GPU lockup will render any input unusable (this includes switching TTYs and using SysRq functions).
</p>
<p>There is no known fix for this NVIDIA bug, but a few workarounds exist:
</p>
<ul>
<li>Turning Vsync off (not possible for some applications)</li>
<li>Turning PRIME Synchronization<a rel="nofollow" class="external autonumber" href="https://devtalk.nvidia.com/default/topic/957814/linux/prime-and-prime-synchronization/">[13]</a> off (will introduce screen tearing):</li>
</ul>
<pre>xrandr --output HDMI-0 --set "PRIME Synchronization" 0 #replace HDMI-0 with your xrandr output ID
</pre>
<p>You can verify if your configuration is affected by the issue simply by running <code>vkcube</code> from the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=vulkan-tools">vulkan-tools</a></span> package.
</p>
<h3><span class="mw-headline" id="Some_programs_have_a_delay_when_opening_under_Wayland">Some programs have a delay when opening under Wayland</span></h3>
<p>If you have RTD3 working (from <a href="#NVIDIA">#NVIDIA</a>), when using Wayland you will experience some delay when a program opens, this is because it tries to power on the GPU first (which it takes ~1 second or more) and then it tries to open the program, wasting time and battery life. This is an NVIDIA driver problem. <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=2094847#p2094847">More details here</a>
</p>
<p>To solve this, add these 2 lines in your <code>/etc/environment</code> file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/environment</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">__EGL_VENDOR_LIBRARY_FILENAMES=/usr/share/glvnd/egl_vendor.d/50_mesa.json
__GLX_VENDOR_LIBRARY_NAME=mesa</pre>
<h3><span class="mw-headline" id="Error_when_running_Wine_games_with_DXVK">Error when running Wine games with DXVK</span></h3>
<p>When using PRIME offload, encountering the <code>Major opcode of failed request: 156 (NV-GLX)</code> is a know problem. The only known workaround is to start X session <a href="../en/NVIDIA_Optimus.html#Use_NVIDIA_graphics_only" title="NVIDIA Optimus">entirely on NVIDIA GPU</a>. A user friendly way to switching between NVIDIA only and PRIME offload method is the <a href="../en/NVIDIA_Optimus.html#Using_optimus-manager" title="NVIDIA Optimus">optimus-manager</a> utility or write some automation scripts yourself.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul><li><a rel="nofollow" class="external text" href="https://wiki.freedesktop.org/nouveau/Optimus/">Nouveau Optimus</a></li></ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Graphics.html" title="Category:Graphics">Graphics</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=PRIME&amp;oldid=812130">https://wiki.archlinux.org/index.php?title=PRIME&amp;oldid=812130</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 8 July 2024, at 20:36.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
