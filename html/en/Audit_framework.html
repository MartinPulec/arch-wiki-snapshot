<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Audit framework - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.43.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Audit_framework rootpage-Audit_framework skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Installation</span>
			</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Adding_rules" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Adding_rules">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Adding rules</span>
			</div>
		</a>
		
			<button aria-controls="toc-Adding_rules-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Adding rules subsection</span>
			</button>
		
		<ul id="toc-Adding_rules-sublist" class="vector-toc-list">
			<li id="toc-Audit_files_and_directories_access" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Audit_files_and_directories_access">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>Audit files and directories access</span>
				</div>
			</a>
			
			<ul id="toc-Audit_files_and_directories_access-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Audit_syscalls" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Audit_syscalls">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>Audit syscalls</span>
				</div>
			</a>
			
			<ul id="toc-Audit_syscalls-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Filter_unwanted_messages" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Filter_unwanted_messages">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3</span>
					<span>Filter unwanted messages</span>
				</div>
			</a>
			
			<ul id="toc-Filter_unwanted_messages-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Search_the_logs" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Search_the_logs">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Search the logs</span>
			</div>
		</a>
		
			<button aria-controls="toc-Search_the_logs-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Search the logs subsection</span>
			</button>
		
		<ul id="toc-Search_the_logs-sublist" class="vector-toc-list">
			<li id="toc-Using_pid" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_pid">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>Using pid</span>
				</div>
			</a>
			
			<ul id="toc-Using_pid-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_keys" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_keys">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>Using keys</span>
				</div>
			</a>
			
			<ul id="toc-Using_keys-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Look_for_abnormalities" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Look_for_abnormalities">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3</span>
					<span>Look for abnormalities</span>
				</div>
			</a>
			
			<ul id="toc-Look_for_abnormalities-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Which_files_or_syscalls_are_worth-auditing?" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Which_files_or_syscalls_are_worth-auditing?">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Which files or syscalls are worth-auditing?</span>
			</div>
		</a>
		
		<ul id="toc-Which_files_or_syscalls_are_worth-auditing?-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Gather_logs_from_different_hosts" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Gather_logs_from_different_hosts">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Gather logs from different hosts</span>
			</div>
		</a>
		
			<button aria-controls="toc-Gather_logs_from_different_hosts-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Gather logs from different hosts subsection</span>
			</button>
		
		<ul id="toc-Gather_logs_from_different_hosts-sublist" class="vector-toc-list">
			<li id="toc-Send_logfiles" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Send_logfiles">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>Send logfiles</span>
				</div>
			</a>
			
			<ul id="toc-Send_logfiles-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Receive_logfiles" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Receive_logfiles">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2</span>
					<span>Receive logfiles</span>
				</div>
			</a>
			
			<ul id="toc-Receive_logfiles-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Rotate_the_logs" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Rotate_the_logs">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Rotate the logs</span>
			</div>
		</a>
		
		<ul id="toc-Rotate_the_logs-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">7</span>
				<span>Troubleshooting</span>
			</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Audit_logs_flooding_into_virtual_console" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Audit_logs_flooding_into_virtual_console">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.1</span>
					<span>Audit logs flooding into virtual console</span>
				</div>
			</a>
			
			<ul id="toc-Audit_logs_flooding_into_virtual_console-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">8</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Audit framework</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Audit_%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%83%AF%E3%83%BC%E3%82%AF" title="Audit フレームワーク – 日本語" lang="ja" hreflang="ja" data-title="Audit フレームワーク" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p>The Linux audit framework provides a CAPP-compliant (<a href="https://en.wikipedia.org/wiki/Controlled_Access_Protection_Profile" class="extiw" title="wikipedia:Controlled Access Protection Profile">Controlled Access Protection Profile</a>) auditing system that reliably collects information about any security-relevant (or non-security-relevant) event on a system. It can help you track actions  performed on a system.
</p>
<p>Linux audit helps make your system more secure by providing you with means to analyze what is happening on your system in great detail. It does not, however, provide additional security itself—it does not protect your system from code malfunctions or any kind of exploits. Instead, Audit is useful for tracking these issues and helps you take additional security measures to prevent them.
</p>
<p>The audit framework works by listening to the event reported by the kernel and logging them to a log file.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Audit framework compatibility with containers was fixed in Linux 3.15, see <a rel="nofollow" class="external autonumber" href="https://bugzilla.redhat.com/show_bug.cgi?id=893751">[1]</a>, however interpreting audit records may be difficult as support for namespace ID is still work in progress, see <a rel="nofollow" class="external autonumber" href="https://github.com/linux-audit/audit-kernel/issues/32">[2]</a>.</div>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>In-kernel audit support is available in all <a href="../en/Kernel.html#Officially_supported_kernels" title="Kernel">officially supported kernels</a>. For custom kernels <code>CONFIG_AUDIT</code> should be enabled. Userspace support is provided by the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=audit">audit</a></span> package that is already installed as a dependency of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=base">base</a></span> packages.
</p>
<p>Audit can be enabled at boot-time by setting <code>audit=1</code> as <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a>. This will ensure that all processes that run before the audit daemon starts are marked as auditable by the kernel. Not doing that will make a few processes impossible to properly audit. See <span class="plainlinks archwiki-template-man" title="$ man 8 auditd"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/auditd.8">auditd(8)</a></span>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> In order to disable audit completely and suppress audit messages from appearing in journal you may set <code>audit=0</code> as <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> and/or <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Mask">mask</a> <code>systemd-journald-audit.socket</code>.</div>
<p>Audit framework is composed of the auditd daemon, responsible for writing the audit messages that were generated through the audit kernel interface and triggered by application and system activity. <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">Start/enable</a> <code>auditd.service</code> to activate the daemon.
</p>
<p>This daemon can be controlled by several commands and files:
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-man" title="$ man 8 auditctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/auditctl.8">auditctl(8)</a></span>: to control the behavior of the daemon on the fly, adding rules etc.</li>
<li>
<code>/etc/audit/audit.rules</code>: contains the rules and various parameters of the auditd daemon. See <span class="plainlinks archwiki-template-man" title="$ man 7 audit.rules"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/audit.rules.7">audit.rules(7)</a></span> for details.</li>
<li>
<span class="plainlinks archwiki-template-man" title="$ man 8 aureport"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/aureport.8">aureport(8)</a></span>: generate report of the activity on a system</li>
<li>
<span class="plainlinks archwiki-template-man" title="$ man 8 ausearch"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ausearch.8">ausearch(8)</a></span>: search for various events</li>
<li>
<i>auditspd</i>: the daemon which can be used to relay event notifications to other applications instead of writing them to disk in the audit log</li>
<li>
<i>autrace</i>: this command can be used to trace a process, in a similar way as strace.</li>
<li>
<code>/etc/audit/auditd.conf</code>: configuration file related to the logging. See <span class="plainlinks archwiki-template-man" title="$ man 5 auditd.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/auditd.conf.5">auditd.conf(5)</a></span> for details.</li>
</ul>
<h2><span class="mw-headline" id="Adding_rules">Adding rules</span></h2>
<p>Before adding rules, you must know that the audit framework can be very verbose and that each rule must be carefully tested before being effectively deployed. Indeed, just one rule can flood all your logs within a few minutes.
</p>
<h3><span class="mw-headline" id="Audit_files_and_directories_access">Audit files and directories access</span></h3>
<p>The most basic use of the audit framework is to log the access to the files you want.
To do this, you must place a watch on a file or a directory using the option <code>-w</code> followed by a path.
The most basic rule to set up is to track accesses to the passwd file:
</p>
<pre># auditctl -w /etc/passwd -p rwxa
</pre>
<p>You can track access to a folder with:
</p>
<pre># auditctl -w /etc/security/
</pre>
<p>The first rule keeps track of every read <code>r</code> , write <code>w</code> , execution <code>x</code> , attribute change <code>a</code>  to the file <code>/etc/passwd</code>.
The second one keeps track of any access to the <code>/etc/security/</code> folder.
</p>
<p>You can list all active rules with:
</p>
<pre># auditctl -l
</pre>
<p>You can delete all rules with:
</p>
<pre># auditctl -D
</pre>
<p>Once you validate the rules, you can append them to the <code>/etc/audit/audit.rules</code> file: 
</p>
<pre>-w /etc/passwd -p rwxa
-w /etc/security/
</pre>
<h3><span class="mw-headline" id="Audit_syscalls">Audit syscalls</span></h3>
<p>The audit framework allows you to audit the syscalls performed with the <code>-a</code> option.
</p>
<p>A security related rule is to track the <span class="plainlinks archwiki-template-man" title="$ man 2 chmod"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/chmod.2">chmod(2)</a></span> syscall, to detect file ownership changes:
</p>
<pre># auditctl -a exit,always -S chmod
</pre>
<p>For a list of all syscalls: <span class="plainlinks archwiki-template-man" title="$ man 2 syscalls"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/syscalls.2">syscalls(2)</a></span>
</p>
<p>A lot of rules and possibilities are available, see <span class="plainlinks archwiki-template-man" title="$ man 8 auditctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/auditctl.8">auditctl(8)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 7 audit.rules"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/audit.rules.7">audit.rules(7)</a></span>.
</p>
<h3><span class="mw-headline" id="Filter_unwanted_messages">Filter unwanted messages</span></h3>
<p>In order to prevent noisy audit messages from flooding system logs you may add rules to exclude some of them:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/audit/rules.d/quiet.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">-A exclude,always -F msgtype=SERVICE_START
-A exclude,always -F msgtype=SERVICE_STOP
-A exclude,always -F msgtype=BPF
-A exclude,always -F exe=/usr/bin/sudo</pre>
<p>Remember to verify changes (fix as necessary) and regenerate <code>/etc/audit/audit.rules</code> as follows:
</p>
<pre># augenrules --check
# augenrules --load
</pre>
<h2><span class="mw-headline" id="Search_the_logs">Search the logs</span></h2>
<p>The audit framework provides some tools to ease the use and the research of events happening on a system.
</p>
<h3><span class="mw-headline" id="Using_pid">Using pid</span></h3>
<p>You can search events related to a particular pid using <code>ausearch</code>:
</p>
<pre># ausearch -p 1
</pre>
<p>This command will show you all the events logged according to your rules related to PID 1 (i.e. systemd).
</p>
<h3><span class="mw-headline" id="Using_keys">Using keys</span></h3>
<p>One of the great features of the audit framework is its ability to use <code>keys</code> to manage events, such a usage is recommended.
</p>
<p>You can use the <code>-k</code> option in your rules to be able to find related events easily:
</p>
<pre># auditctl -w /etc/passwd -p rwxa -k KEY_pwd
</pre>
<p>Then, if you search for events with the key <code>KEY_pwd</code>, ausearch will display only event related to the file <code>/etc/passwd</code>.
</p>
<pre># ausearch -k KEY_pwd
</pre>
<h3><span class="mw-headline" id="Look_for_abnormalities">Look for abnormalities</span></h3>
<p>The <code>aureport</code> tool can be used to quickly report any abnormal event performed on the system, it includes network interfaces used in promiscous mode, process or thread crashing or exiting with ENOMEM error etc.
</p>
<p>The easiest way to use <code>aureport</code> is:
</p>
<pre># aureport -n
</pre>
<p>aureport can be used to generate custom reports, see <span class="plainlinks archwiki-template-man" title="$ man 8 aureport"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/aureport.8">aureport(8)</a></span>.
</p>
<h2>
<span id="Which_files_or_syscalls_are_worth-auditing.3F"></span><span class="mw-headline" id="Which_files_or_syscalls_are_worth-auditing?">Which files or syscalls are worth-auditing?</span>
</h2>
<p>Keep in mind that each audit rule added will generate logs, so you must be ready to treat this amount of information.
Basically, each security-related event/file must be monitored, like ids, ips, anti-rootkits etc.
On the other side, it is totally useless to track every write syscall, the smallest compilation will fill your logs with this event.
</p>
<p>More complex set of rules can be set up, performing auditing on a very fine-grained base. If you want to do so, see <span class="plainlinks archwiki-template-man" title="$ man 8 auditctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/auditctl.8">auditctl(8)</a></span>.
</p>
<h2><span class="mw-headline" id="Gather_logs_from_different_hosts">Gather logs from different hosts</span></h2>
<p>The audit framework has a plugin system which provides the possibility to send local logfiles to a remote auditd.
</p>
<h3><span class="mw-headline" id="Send_logfiles">Send logfiles</span></h3>
<p>To send your logfiles to a remote host you need the <code>audisp-remote</code> plugin which comes automatically with the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=audit">audit</a></span> package.
Activate the plugin:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/audisp/plugins.d/au-remote.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">active = yes
direction = out
path = /usr/bin/audisp-remote
type = always
format = string</pre>
<p>and set the remote host where the logs should be send to:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/audisp/audisp-remote.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">remote_server = domain.name.or.ip
port = 60
##local_port = optional
transport = tcp</pre>
<h3><span class="mw-headline" id="Receive_logfiles">Receive logfiles</span></h3>
<p>To make audit listen for remote audispds you just need to set the tcp options:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/audit/auditd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">tcp_listen_port = 60
tcp_listen_queue = 5
tcp_max_per_addr = 1
##tcp_client_ports = 1024-65535 #optional
tcp_client_max_idle = 0</pre>
<p>Now you can view the logs of <b>all</b> configured hosts in the logfiles of the receiving auditd.
</p>
<h2><span class="mw-headline" id="Rotate_the_logs">Rotate the logs</span></h2>
<p>Send <code>SIGUSR1</code> to the audit daemon:
</p>
<pre># pkill -USR1 -x auditd
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Audit_logs_flooding_into_virtual_console">Audit logs flooding into virtual console</span></h3>
<p>For users not having enabled auditd, using kernel debug messages higher than <code>loglevel=4</code> can result in audit flooding security notices on top of virtual terminal.
</p>
<p>These messages can be silenced by <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enabling">enabling</a> <code>auditd.service</code>. 
</p>
<p>Alternative solutions are: 
</p>
<ul>
<li>lowering your loglevel,</li>
<li>disabling audit logs with the <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> <code>audit=0</code>.</li>
</ul>
<p>See the <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/15324">systemd issue 15324 on GitHub</a> for the details.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://linux-audit.com/configuring-and-auditing-linux-systems-with-audit-daemon/#more">Configuring and auditing Linux systems with Audit daemon</a></li>
<li><a rel="nofollow" class="external text" href="https://linux-audit.com/linux-audit-framework-101-basic-rules-for-configuration/">Linux Audit Framework 101 – Basic Rules for Configuration</a></li>
<li><a rel="nofollow" class="external text" href="https://linux-audit.com/tuning-auditd-high-performance-linux-auditing/">Tuning auditd: high-performance Linux Auditing</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Security.html" title="Category:Security">Security</a></li>
<li><a href="../en/Category:Logging.html" title="Category:Logging">Logging</a></li>
</ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Audit_framework&amp;oldid=818951">https://wiki.archlinux.org/index.php?title=Audit_framework&amp;oldid=818951</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 13 October 2024, at 23:04.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki.svg" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul></ul>
</div>
</body>
</html>
