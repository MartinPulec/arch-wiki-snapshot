<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>mkinitcpio - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.44.2">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Mkinitcpio rootpage-Mkinitcpio skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Installation</span>
			</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Image_creation_and_activation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Image_creation_and_activation">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Image creation and activation</span>
			</div>
		</a>
		
			<button aria-controls="toc-Image_creation_and_activation-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Image creation and activation subsection</span>
			</button>
		
		<ul id="toc-Image_creation_and_activation-sublist" class="vector-toc-list">
			<li id="toc-Automated_generation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Automated_generation">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>Automated generation</span>
				</div>
			</a>
			
			<ul id="toc-Automated_generation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Manual_generation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Manual_generation">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>Manual generation</span>
				</div>
			</a>
			
			<ul id="toc-Manual_generation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Customized_generation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Customized_generation">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3</span>
					<span>Customized generation</span>
				</div>
			</a>
			
			<ul id="toc-Customized_generation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Unified_kernel_images" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Unified_kernel_images">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4</span>
					<span>Unified kernel images</span>
				</div>
			</a>
			
			<ul id="toc-Unified_kernel_images-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Configuration</span>
			</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-MODULES" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#MODULES">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>MODULES</span>
				</div>
			</a>
			
			<ul id="toc-MODULES-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-BINARIES_and_FILES" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#BINARIES_and_FILES">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>BINARIES and FILES</span>
				</div>
			</a>
			
			<ul id="toc-BINARIES_and_FILES-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-HOOKS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#HOOKS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3</span>
					<span>HOOKS</span>
				</div>
			</a>
			
			<ul id="toc-HOOKS-sublist" class="vector-toc-list">
				<li id="toc-Build_hooks" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Build_hooks">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3.1</span>
					<span>Build hooks</span>
				</div>
			</a>
			
			<ul id="toc-Build_hooks-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Runtime_hooks" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Runtime_hooks">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3.2</span>
					<span>Runtime hooks</span>
				</div>
			</a>
			
			<ul id="toc-Runtime_hooks-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Post_hooks" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Post_hooks">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3.3</span>
					<span>Post hooks</span>
				</div>
			</a>
			
			<ul id="toc-Post_hooks-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Common_hooks" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Common_hooks">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3.4</span>
					<span>Common hooks</span>
				</div>
			</a>
			
			<ul id="toc-Common_hooks-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-COMPRESSION" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#COMPRESSION">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.4</span>
					<span>COMPRESSION</span>
				</div>
			</a>
			
			<ul id="toc-COMPRESSION-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-COMPRESSION_OPTIONS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#COMPRESSION_OPTIONS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.5</span>
					<span>COMPRESSION_OPTIONS</span>
				</div>
			</a>
			
			<ul id="toc-COMPRESSION_OPTIONS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-MODULES_DECOMPRESS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#MODULES_DECOMPRESS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.6</span>
					<span>MODULES_DECOMPRESS</span>
				</div>
			</a>
			
			<ul id="toc-MODULES_DECOMPRESS-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Runtime_customization" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Runtime_customization">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Runtime customization</span>
			</div>
		</a>
		
			<button aria-controls="toc-Runtime_customization-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Runtime customization subsection</span>
			</button>
		
		<ul id="toc-Runtime_customization-sublist" class="vector-toc-list">
			<li id="toc-init_from_base_hook" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#init_from_base_hook">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>init from base hook</span>
				</div>
			</a>
			
			<ul id="toc-init_from_base_hook-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_RAID" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_RAID">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.2</span>
					<span>Using RAID</span>
				</div>
			</a>
			
			<ul id="toc-Using_RAID-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_net" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_net">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.3</span>
					<span>Using net</span>
				</div>
			</a>
			
			<ul id="toc-Using_net-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_LVM" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_LVM">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.4</span>
					<span>Using LVM</span>
				</div>
			</a>
			
			<ul id="toc-Using_LVM-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_encrypted_root" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_encrypted_root">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.5</span>
					<span>Using encrypted root</span>
				</div>
			</a>
			
			<ul id="toc-Using_encrypted_root-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-/usr_as_a_separate_partition" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#/usr_as_a_separate_partition">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.6</span>
					<span>/usr as a separate partition</span>
				</div>
			</a>
			
			<ul id="toc-/usr_as_a_separate_partition-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Tips and tricks</span>
			</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Fallback_initramfs_generation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Fallback_initramfs_generation">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>Fallback initramfs generation</span>
				</div>
			</a>
			
			<ul id="toc-Fallback_initramfs_generation-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Troubleshooting</span>
			</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Extracting_the_image" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Extracting_the_image">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.1</span>
					<span>Extracting the image</span>
				</div>
			</a>
			
			<ul id="toc-Extracting_the_image-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Recompressing_a_modified_extracted_image" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Recompressing_a_modified_extracted_image">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.2</span>
					<span>Recompressing a modified extracted image</span>
				</div>
			</a>
			
			<ul id="toc-Recompressing_a_modified_extracted_image-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-&quot;/dev_must_be_mounted&quot;_when_it_already_is" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#&quot;/dev_must_be_mounted&quot;_when_it_already_is">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.3</span>
					<span>"/dev must be mounted" when it already is</span>
				</div>
			</a>
			
			<ul id="toc-&quot;/dev_must_be_mounted&quot;_when_it_already_is-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Possibly_missing_firmware_for_module_XXXX" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Possibly_missing_firmware_for_module_XXXX">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.4</span>
					<span>Possibly missing firmware for module XXXX</span>
				</div>
			</a>
			
			<ul id="toc-Possibly_missing_firmware_for_module_XXXX-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-No_PS/2_controller_found" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#No_PS/2_controller_found">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.5</span>
					<span>No PS/2 controller found</span>
				</div>
			</a>
			
			<ul id="toc-No_PS/2_controller_found-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Standard_rescue_procedures" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Standard_rescue_procedures">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.6</span>
					<span>Standard rescue procedures</span>
				</div>
			</a>
			
			<ul id="toc-Standard_rescue_procedures-sublist" class="vector-toc-list">
				<li id="toc-Boot_succeeds_on_one_machine_and_fails_on_another" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Boot_succeeds_on_one_machine_and_fails_on_another">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.6.1</span>
					<span>Boot succeeds on one machine and fails on another</span>
				</div>
			</a>
			
			<ul id="toc-Boot_succeeds_on_one_machine_and_fails_on_another-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Cannot_open_access_to_console,_the_root_account_is_locked" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Cannot_open_access_to_console,_the_root_account_is_locked">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.7</span>
					<span>Cannot open access to console, the root account is locked</span>
				</div>
			</a>
			
			<ul id="toc-Cannot_open_access_to_console,_the_root_account_is_locked-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">7</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar vector-feature-custom-font-size-clientpref--excluded">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">mkinitcpio</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 7 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-7" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">7 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-de mw-list-item"><a href="https://wiki.archlinux.de/title/Mkinitcpio" title="Mkinitcpio – Deutsch" lang="de" hreflang="de" data-title="Mkinitcpio" data-language-autonym="Deutsch" data-language-local-name="Deutsch" class="interlanguage-link-target"><span>Deutsch</span></a></li>
<li class="interlanguage-link interwiki-fr mw-list-item"><a href="../fr/Mkinitcpio.html" title="Mkinitcpio – français" lang="fr" hreflang="fr" data-title="Mkinitcpio" data-language-autonym="Français" data-language-local-name="français" class="interlanguage-link-target"><span>Français</span></a></li>
<li class="interlanguage-link interwiki-hu mw-list-item"><a href="../hu/Mkinitcpio.html" title="Mkinitcpio – magyar" lang="hu" hreflang="hu" data-title="Mkinitcpio" data-language-autonym="Magyar" data-language-local-name="magyar" class="interlanguage-link-target"><span>Magyar</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Mkinitcpio" title="Mkinitcpio – 日本語" lang="ja" hreflang="ja" data-title="Mkinitcpio" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/Mkinitcpio.html" title="Mkinitcpio – português" lang="pt" hreflang="pt" data-title="Mkinitcpio" data-language-autonym="Português" data-language-local-name="português" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Mkinitcpio.html" title="Mkinitcpio – русский" lang="ru" hreflang="ru" data-title="Mkinitcpio" data-language-autonym="Русский" data-language-local-name="русский" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Mkinitcpio" title="Mkinitcpio – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" data-title="Mkinitcpio" data-language-autonym="中文（简体）" data-language-local-name="中文（简体）" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end vector-feature-custom-font-size-clientpref--excluded">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Booster.html" title="Booster">Booster</a></li>
<li><a href="../en/General_troubleshooting.html#Boot_problems" class="mw-redirect" title="Boot debugging">Boot debugging</a></li>
<li><a href="../en/Dracut.html" title="Dracut">dracut</a></li>
<li><a href="../en/Kernel_module.html" class="mw-redirect" title="Kernel modules">Kernel modules</a></li>
<li><a href="../en/Mkinitcpio/Minimal_initramfs.html" title="Mkinitcpio/Minimal initramfs">mkinitcpio/Minimal initramfs</a></li>
<li><a href="../en/Systemd.html" title="Systemd">systemd</a></li>
<li><a href="../en/Unified_kernel_image.html" title="Unified kernel image">Unified kernel image</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/mkinitcpio/mkinitcpio">mkinitcpio</a> is a Bash script used to create initramfs images. See <a href="../en/Arch_boot_process.html#initramfs" title="Arch boot process">Arch boot process#initramfs</a> for a general introduction.
</p>
<p>It is important to note that there are two distinct approaches how the various tasks during initial ramdisk phase are performed:
</p>
<dl>
<dt>systemd based initial ramdisk (new default since version 40)</dt>
<dd>systemd is already started at the beginning of the initial ramdisk phase. The tasks to be executed are determined by regular systemd unit files. See <a rel="nofollow" class="external text" href="https://www.freedesktop.org/software/systemd/man/latest/bootup.html">systemd bootup process</a>.<br><b>Pros</b>: Tightly integrated with the rest of the systemd ecosystem, leading to a more consistent and streamlined boot process. Parallelize certain boot tasks more effectively, potentially leading to faster overall boot times in some scenarios. More comprehensive set of features like <a href="../en/Dm-crypt/System_configuration.html#Using_systemd-cryptsetup-generator" title="Dm-crypt/System configuration">systemd-cryptsetup-generator</a> with <code>/etc/crypttab.initramfs</code> or <a href="../en/Systemd.html#GPT_partition_automounting" title="Systemd">GPT partition automounting</a>.<br><b>Cons</b>: More dependencies and larger size: Generally results in a larger initramfs due to the inclusion of systemd binaries and its dependencies. this can slightly increase boot time.</dd>
<dt>Busybox based initial ramdisk</dt>
<dd>An init script is started that in turn scans the filesystem of the initial ramdisk for scripts to be executed (here in this context called runtime hooks).<br><b>Pros</b>: lightweight and smaller in size, fewer dependencies.</dd>
</dl>
<p>The concrete variant is determined by the presence or absence of the <code>systemd</code> hook in the <code>HOOKS</code> array of <code>/etc/mkinitcpio.conf</code>. See <a href="#Common_hooks">#Common hooks</a> for more details.
</p>
<p><i>mkinitcpio</i> has been developed by the Arch Linux developers and from community contributions. See the <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/mkinitcpio/mkinitcpio">public Git repository</a>.
</p>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Installation">Installation</h2></div>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio">mkinitcpio</a></span> package, which is a dependency of the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> package, so most users will already have it installed.
</p>
<p>Advanced users may wish to install the latest development version of <i>mkinitcpio</i> from Git with the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-git/">mkinitcpio-git</a></span><sup><small>AUR</small></sup> package.
</p>
<div class="mw-heading mw-heading2"><h2 id="Image_creation_and_activation">Image creation and activation</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Automated_generation">Automated generation</h3></div>
<p>Every time a kernel is installed or upgraded, a <a href="../en/Pacman.html#Hooks" class="mw-redirect" title="Pacman hook">pacman hook</a> automatically generates a <i>.preset</i> file saved in <code>/etc/mkinitcpio.d/</code>. For example <code>linux.preset</code> for the official stable <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> kernel package. A preset is simply a list of information required to create initial ramdisk images, instead of manually specifying the various parameters and the location of the output files.
By default, it contains the instructions to create only the first image, the second must be explicitly enabled:
</p>
<ol>
<li>The <i>default</i> ramdisk image created following the directives specified in the <a href="#Configuration">configuration</a>.</li>
<li>The <i>fallback</i> ramdisk image, same as above except that the <i>autodetect</i> hook is skipped during creation, thus including a full range of modules which supports most systems.</li>
</ol>
<p>After creating the preset, the pacman hook calls the <i>mkinitcpio</i> script which generates the image(s), using the information provided in the preset.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> <i>.preset</i> files are used to automatically regenerate the initramfs after a kernel update; be careful when editing them.</div>
<div class="mw-heading mw-heading3"><h3 id="Manual_generation">Manual generation</h3></div>
<p>To run the script manually, refer to the <span class="plainlinks archwiki-template-man" title="$ man 8 mkinitcpio"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkinitcpio.8">mkinitcpio(8)</a></span> manual page for instructions. In particular, to (re-)generate an initramfs image based on the preset provided by a kernel package, use the <code>-p</code>/<code>--preset</code> option followed by the preset to utilize. For example, for the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> package, use the command:
</p>
<pre># mkinitcpio -p linux
</pre>
<p>To (re-)generate initramfs images based on all existing presets, use the <code>-P</code>/<code>--allpresets</code> switch. This is typically used to regenerate all the initramfs images after a change of the global <a href="#Configuration">configuration</a>:
</p>
<pre># mkinitcpio -P
</pre>
<p>Users may create any number of initramfs images with a variety of different configurations. The desired image must be specified in the respective <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> configuration file.
</p>
<div class="mw-heading mw-heading3"><h3 id="Customized_generation">Customized generation</h3></div>
<p>Users can generate an image using an alternative configuration file. For example, the following will generate an initial ramdisk image according to the directions in <code>/etc/mkinitcpio-custom.conf</code> and save it as <code>/boot/initramfs-custom.img</code>.
</p>
<pre># mkinitcpio --config /etc/mkinitcpio-custom.conf --generate /boot/initramfs-custom.img
</pre>
<p>If generating an image for a kernel other than the one currently running, add the kernel release version to the command line. The installed kernel releases can be found in <code>/usr/lib/modules/</code>, the syntax is consistent with the output of the command <code>uname -r</code> for each kernel.
</p>
<pre># mkinitcpio --generate /boot/initramfs-custom2.img --kernel 5.7.12-arch1-1
</pre>
<div class="mw-heading mw-heading3"><h3 id="Unified_kernel_images">Unified kernel images</h3></div>
<p><i>mkinitcpio</i> can create <a href="../en/Unified_kernel_image.html" title="Unified kernel image">unified kernel images</a> (UKIs) either by itself or via <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd-ukify">systemd-ukify</a></span>. If <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd-ukify">systemd-ukify</a></span> is absent or explicitly disabled using <code>--no-ukify</code>, the UKI will be assembled by mkinitcpio itself. Advanced features of <i>ukify</i> will not be available then.
</p>
<p>See <a href="../en/Unified_kernel_image.html" title="Unified kernel image">unified kernel image</a> for details about UKI generation.
</p>
<div class="mw-heading mw-heading2"><h2 id="Configuration">Configuration</h2></div>
<p>The primary configuration file for <i>mkinitcpio</i> is <code>/etc/mkinitcpio.conf</code>. Drop-in configuration files are also supported, e.g. <code>/etc/mkinitcpio.conf.d/myhooks.conf</code> (they aren't taken into account if mkinitcpio is called with <code>-c</code> option and/or use a preset containing <code>ALL_config</code>). Additionally, preset definitions are provided by kernel packages in the <code>/etc/mkinitcpio.d</code> directory (e.g. <code>/etc/mkinitcpio.d/linux.preset</code>).
</p>
<p>Users can modify seven variables within the configuration file, see <span class="plainlinks archwiki-template-man" title="$ man 5 mkinitcpio.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkinitcpio.conf.5#VARIABLES">mkinitcpio.conf(5) § VARIABLES</a></span> for more details:
</p>
<dl>
<dt><code>MODULES</code></dt>
<dd>Kernel modules to be loaded before any boot hooks are run.</dd>
<dt><code>BINARIES</code></dt>
<dd>Additional binaries to be included in the initramfs image.</dd>
<dt><code>FILES</code></dt>
<dd>Additional files to be included in the initramfs image.</dd>
<dt><code>HOOKS</code></dt>
<dd>Hooks are scripts that execute in the initial ramdisk.</dd>
<dt><code>COMPRESSION</code></dt>
<dd>Used to compress the initramfs image.</dd>
<dt><code>COMPRESSION_OPTIONS</code></dt>
<dd>Extra arguments to pass to the <code>COMPRESSION</code> program. Usage of this setting is strongly discouraged. <i>mkinitcpio</i> will handle special requirements for compressors (e.g. passing <code>--check=crc32</code> to xz), and misusage can easily lead to an unbootable system.</dd>
<dt><code>MODULES_DECOMPRESS</code></dt>
<dd>Whether to decompress loadable kernel modules and firmware files or to keep them in their original compressed form.</dd>
</dl>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> 
<ul>
<li>Some hooks that may be required for your system like <b>lvm2</b>, <b>mdadm_udev</b>, and <b>encrypt</b> are <b>NOT</b> enabled by default. Read the <a href="#HOOKS">#HOOKS</a> section carefully for instructions.</li>
<li>Preset files created by <i>mkinitcpio</i> before Version 36 set the variable <code>ALL_config</code>, which prevents drop-in configuration files from being loaded. To enable drop-in files, comment out the line <code>ALL_config="/etc/mkinitcpio.conf"</code> in older preset files.</li>
</ul>
</div>
<div class="mw-heading mw-heading3"><h3 id="MODULES">MODULES</h3></div>
<p>The <code>MODULES</code> array is used to specify modules to load before anything else is done.
</p>
<p>Modules suffixed with a <code>?</code> will not throw errors if they are not found. This might be useful for custom kernels that compile in modules which are listed explicitly in a hook or configuration file.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> 
<ul>
<li>If using out-of-tree file systems that will be mounted in early userspace (e.g. when using such a file system as the root file system), their modules (e.g. <code>reiser4</code>) <b>must</b> be added to the <code>MODULES</code> array.</li>
<li>When using the <b>encrypt</b> or <b>sd-encrypt</b> hook, the keyboard modules and/or filesystems needed to unlock the LUKS device during system boot need to be added to the <code>MODULES</code> array when the target system differs from the one used to run <i>mkinitcpio</i>.  For example, if you use a keyfile on an ext2 file system but no ext2 file system is mounted at the time <i>mkinitcpio</i> runs, add <code>ext2</code>. See <a href="../en/Dm-crypt/System_configuration.html#cryptkey" title="Dm-crypt/System configuration">dm-crypt/System configuration#cryptkey</a> for more details.</li>
<li>If using a keyboard through a USB 3 hub and wish to use it to unlock a LUKS device, add <code>usbhid xhci_hcd</code>.</li>
<li>If using displays connected to a docking station, you might need to add a module for your graphics card to make initrd output visible (e.g. <code>i915</code> for most Intel cards).</li>
</ul>
</div>
<div class="mw-heading mw-heading3"><h3 id="BINARIES_and_FILES">BINARIES and FILES</h3></div>
<p>These options allow users to add files to the image. Both <code>BINARIES</code> and <code>FILES</code> are added before hooks are run, and may be used to override files used or provided by a hook. <code>BINARIES</code> are auto-located within a standard <code>PATH</code> and are dependency-parsed, meaning any required libraries will also be added. <code>FILES</code> are added <i>as-is</i>. For example:
</p>
<pre>FILES=(/etc/modprobe.d/modprobe.conf)
</pre>
<pre>BINARIES=(kexec)
</pre>
<p>Note that as both <code>BINARIES</code> and <code>FILES</code> are <a href="../en/Bash.html" title="Bash">Bash</a> arrays, multiple entries can be added delimited with spaces.
</p>
<div class="mw-heading mw-heading3"><h3 id="HOOKS">HOOKS</h3></div>
<p>The <code>HOOKS</code> array is the most important setting in the file. Hooks are small scripts which describe what will be added to the image. For some hooks, they will also contain a runtime component which provides additional behavior, such as starting a daemon, or assembling a stacked block device. Hooks are referred to by their name, and executed in the order they exist in the <code>HOOKS</code> array of the configuration file.
</p>
<p>The default <code>HOOKS</code> setting should be sufficient for most simple, single disk setups. For root devices which are stacked or multi-block devices such as <a href="../en/LVM.html" title="LVM">LVM</a>, <a href="../en/RAID.html" title="RAID">RAID</a>, or <a href="../en/Dm-crypt.html" title="Dm-crypt">dm-crypt</a>, see the respective wiki pages for further necessary configuration.
</p>
<div class="mw-heading mw-heading4"><h4 id="Build_hooks">Build hooks</h4></div>
<p>Build hooks are found in <code>/usr/lib/initcpio/install/</code>, custom build hooks can be placed in <code>/etc/initcpio/install/</code>. These files are sourced by the bash shell during runtime of <i>mkinitcpio</i> and should contain two functions: <code>build</code> and <code>help</code>. The <code>build</code> function describes the modules, files, and binaries which will be added to the image. An API, documented by <span class="plainlinks archwiki-template-man" title="$ man 8 mkinitcpio"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkinitcpio.8">mkinitcpio(8)</a></span>, serves to facilitate the addition of these items. The <code>help</code> function outputs a description of what the hook accomplishes.
</p>
<p>For a list of all available hooks:
</p>
<pre>$ mkinitcpio -L
</pre>
<p>Use <i>mkinitcpio'</i>s <code>-H</code>/<code>--hookhelp</code> option to output help for a specific hook, for example:
</p>
<pre>$ mkinitcpio -H udev
</pre>
<div class="mw-heading mw-heading4"><h4 id="Runtime_hooks">Runtime hooks</h4></div>
<p>Runtime hooks are found in <code>/usr/lib/initcpio/hooks/</code>, custom runtime hooks can be placed in <code>/etc/initcpio/hooks/</code>. For any runtime hook, there should always be a build hook of the same name, which calls <code>add_runscript</code> to add the runtime hook to the image. These files are sourced by the busybox ash shell during early userspace. With the exception of cleanup hooks, they will always be run in the order listed in the <code>HOOKS</code> setting. Runtime hooks may contain several functions:
</p>
<p><code>run_earlyhook</code>: Functions of this name will be run once the API file systems have been mounted and the kernel command line has been parsed. This is generally where additional daemons, such as udev, which are needed for the early boot process are started from.
</p>
<p><code>run_hook</code>: Functions of this name are run shortly after the early hooks. This is the most common hook point, and operations such as assembly of stacked block devices should take place here.
</p>
<p><code>run_latehook</code>: Functions of this name are run after the root device has been mounted. This should be used, sparingly, for further setup of the root device, or for mounting other file systems, such as <code>/usr</code>.
</p>
<p><code>run_cleanuphook</code>: Functions of this name are run as late as possible, and in the reverse order of how they are listed in the <code>HOOKS</code> array in the configuration file. These hooks should be used for any last minute cleanup, such as shutting down any daemons started by an early hook.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Runtime hooks are only used by busybox init. <b>systemd</b> hook triggers a systemd based init, which does not run any runtime hooks but uses systemd units instead.</div>
<div class="mw-heading mw-heading4"><h4 id="Post_hooks">Post hooks</h4></div>
<p>Post hooks are executables or shell scripts located in <code>/usr/lib/initcpio/post/</code> (hooks provided by packages) and <code>/etc/initcpio/post/</code> (custom hooks). These files are executed after an image is (re)generated in order to perform additional tasks like signing.
</p>
<p>To each executable the following arguments are passed in this order:
</p>
<ol>
<li>the <b>kernel</b> used (may be empty in some circumstances);</li>
<li>the generated <b>initramfs image</b>;</li>
<li>(optional) the generated <b>unified kernel image</b>.</li>
</ol>
<p>Additionally, the following environment variables are set—<code>KERNELVERSION</code> the full kernel version, <code>KERNELDESTINATION</code> the default location where the kernel should be located on order to be booted.
</p>
<div class="mw-heading mw-heading4"><h4 id="Common_hooks">Common hooks</h4></div>
<p>A table of common hooks and how they affect image creation and runtime follows. Note that this table is not complete, as packages can provide custom hooks.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Add info about <code>hostdata</code>, <code>memdisk</code>, <code>sleep</code> and <code>strip</code>, find out if <code>dmraid</code>, etc. work/are needed for systemd based initramfs. (Discuss in <a href="../en/Talk:Mkinitcpio.html#Improvements_for_the_Common_hooks_table_and_section_about_systemd_hook" title="Talk:Mkinitcpio">Talk:Mkinitcpio#Improvements for the Common hooks table and section about systemd hook</a>)</div>
</div>
<table class="wikitable">
<tbody>
<tr>
<th>busybox init</th>
<th>systemd init</th>
<th><a href="#Build_hooks">Build hook</a></th>
<th>
<a href="#Runtime_hooks">Runtime hook</a> (busybox init only)
</th>
</tr>
<tr>
<td class="archwiki-table-cell"><b>base</b></td>
<td class="archwiki-table-cell archwiki-template-grey"><i>optional</i></td>
<td>Sets up all initial directories and installs base utilities and libraries. Always keep this hook as the first hook unless you know what you are doing, as it provides critical busybox init when not using <b>systemd</b> hook.
<p>Optional when using the <b>systemd</b> hook as it only provides a busybox recovery shell. In addition to enabling <b>base</b>, you'll need to temporarily add <code>SYSTEMD_SULOGIN_FORCE=1</code> to your <a href="../en/Kernel_parameters.html" title="Kernel parameters">kernel parameters</a> to use the shell.
</p>
</td>
<td class="archwiki-table-cell" data-sort-value="5">–
</td>
</tr>
<tr>
<td class="archwiki-table-cell"><b>udev</b></td>
<td rowspan="3" class="archwiki-table-cell"><b>systemd</b></td>
<td>Adds udevd, udevadm, and a small subset of udev rules to your image.</td>
<td>Starts the udev daemon and processes uevents from the kernel; creating device nodes. As it simplifies the boot process by not requiring the user to explicitly specify necessary modules, using it is recommended.
</td>
</tr>
<tr>
<td class="archwiki-table-cell"><b>usr</b></td>
<td>Adds support for <code>/usr</code> on a separate partition. See <a href="#/usr_as_a_separate_partition">#/usr as a separate partition</a> for details.</td>
<td>Mounts the <code>/usr</code> partition after the real root has been mounted.
</td>
</tr>

<tr>
<td class="archwiki-table-cell"><b>resume</b></td>
<td>Adds <code>lzo</code> and <code>lz4</code> kernel modules to allow resuming when using a hibernation image compression algorithm other than the compile-time default. Adds the <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-hibernate-resume"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-hibernate-resume.8">systemd-hibernate-resume(8)</a></span> binary to support resuming from a hibernation image specified via the <code>HibernateLocation</code> UEFI variable.</td>
<td>Tries to resume from the "suspend to disk" state. See <a href="../en/Power_management/Suspend_and_hibernate.html#Hibernation" class="mw-redirect" title="Hibernation">Hibernation</a> for further configuration.
</td>
</tr>
<tr>
<td class="archwiki-table-cell"><b>btrfs</b></td>
<td class="archwiki-table-cell archwiki-template-grey">–</td>
<td>Sets the required modules to enable <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a> for using multiple devices with Btrfs. You need to have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=btrfs-progs">btrfs-progs</a></span> installed to use this. This hook is not required for using Btrfs on a single device where the <code>filesystems</code> hook suffices.</td>
<td>Runs <code>btrfs device scan</code> to assemble a multi-device Btrfs root file system when <b>udev</b> hook or <b>systemd</b> hook is not present. The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=btrfs-progs">btrfs-progs</a></span> package is required for this hook.
</td>
</tr>
<tr>
<td colspan="2" class="archwiki-table-cell"><b>autodetect</b></td>
<td>Shrinks your initramfs to a smaller size by creating a whitelist of modules from a scan of sysfs. Be sure to verify included modules are correct and none are missing. This hook must be run before other subsystem hooks in order to take advantage of auto-detection. Any hooks placed before 'autodetect' will be installed in full.</td>
<td class="archwiki-table-cell" data-sort-value="5">–
</td>
</tr>
<tr>
<td colspan="2" class="archwiki-table-cell"><b>microcode</b></td>
<td>Prepends an uncompressed initramfs image with early <a href="../en/Microcode.html" title="Microcode">microcode</a> update files for Intel and AMD processors. Uses microcode files from <code>/usr/lib/firmware/amd-ucode/</code> and <code>/usr/lib/firmware/intel-ucode/</code> if they are available or extracts <code>/boot/amd-ucode.img</code> and <code>/boot/intel-ucode.img</code> otherwise.
<p>If the <b>autodetect</b> hook runs before this hook, it will only add early microcode update files for the processor of the system the image is built on.
</p>
<p>The use of this hook replaces the now deprecated <code>--microcode</code> flag, and the <code>microcode</code> option in the preset files. This also allows you to drop the microcode <code>initrd</code> lines from your boot configuration as they are now packed together with the main initramfs image.
</p>
</td>
<td class="archwiki-table-cell" data-sort-value="5">–
</td>
</tr>
<tr>
<td colspan="2" class="archwiki-table-cell"><b>modconf</b></td>
<td>Includes modprobe configuration files from <code>/etc/modprobe.d/</code> and <code>/usr/lib/modprobe.d/</code>.</td>
<td class="archwiki-table-cell" data-sort-value="5">–
</td>
</tr>
<tr>
<td colspan="2" class="archwiki-table-cell"><b>kms</b></td>
<td>Adds GPU modules to provide <a href="../en/Kernel_mode_setting.html#Configuration" title="Kernel mode setting">early KMS start</a>. Additionally adds modules that are required by privacy screens built into the LCD panel of some laptops.</td>
<td class="archwiki-table-cell" data-sort-value="5">–
</td>
</tr>
<tr>
<td colspan="2" class="archwiki-table-cell"><b>keyboard</b></td>
<td>Adds the necessary modules for keyboard devices. Use this if you have a USB or serial keyboard and need it in early userspace (either for entering encryption passphrases or for use in an interactive shell). As a side effect, modules for some non-keyboard input devices might be added too, but this should not be relied on.
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> For systems that are booted with different hardware configurations (e.g. laptops with external keyboard vs. internal keyboard or <a href="https://en.wikipedia.org/wiki/Headless_computer" class="extiw" title="wikipedia:Headless computer">headless systems</a>), this hook needs to be placed before <b>autodetect</b> in order to be able to use the keyboard at boot time, for example to unlock an encrypted device when using the <code>encrypt</code> hook.</div>
</td>
<td class="archwiki-table-cell" data-sort-value="5">–
</td>
</tr>
<tr>
<td class="archwiki-table-cell"><b>keymap</b></td>
<td rowspan="2" class="archwiki-table-cell"><b>sd-vconsole</b></td>
<td>Adds the specified <a href="../en/Linux_console/Keyboard_configuration.html#Persistent_configuration" title="Linux console/Keyboard configuration">console keymap(s)</a> from <code>/etc/vconsole.conf</code> to the initramfs. If you use <a href="../en/Dm-crypt/Encrypting_an_entire_system.html" title="Dm-crypt/Encrypting an entire system">system encryption</a>, especially full-disk encryption, make sure you add it before the <code>encrypt</code> hook.</td>
<td>Loads the specified console keymap(s) from <code>/etc/vconsole.conf</code> during early userspace.
</td>
</tr>
<tr>
<td class="archwiki-table-cell"><b>consolefont</b></td>
<td>Adds the specified <a href="../en/Linux_console.html#Persistent_configuration" title="Linux console">console font</a> from <code>/etc/vconsole.conf</code> to the initramfs.</td>
<td>Loads the specified console font from <code>/etc/vconsole.conf</code> during early userspace.
</td>
</tr>
<tr>
<td colspan="2" class="archwiki-table-cell"><b>block</b></td>
<td>Adds block device modules. If the <b>autodetect</b> hook runs before this hook, it will only add modules for block devices used on the system. Exceptions are the <code>ahci</code>, <code>sd_mod</code>, <code>usb_storage</code>, <code>uas</code>, <code>mmc_block</code>, <code>nvme</code>, <code>virtio_scsi</code> and <code>virtio_blk</code> modules which will always be added unconditionally.</td>
<td class="archwiki-table-cell" data-sort-value="5">–
</td>
</tr>
<tr>
<td class="archwiki-table-cell"><b>net</b></td>
<td class="archwiki-table-cell archwiki-template-grey"><i>not implemented</i></td>
<td>Adds the necessary modules for a network device. You must have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-nfs-utils">mkinitcpio-nfs-utils</a></span> installed to use this, see <a href="#Using_net">#Using net</a> for details.</td>
<td>Provides handling for an NFS-based root file system.
</td>
</tr>
<tr>
<td class="archwiki-table-cell"><b>dmraid</b></td>
<td class="archwiki-table-cell archwiki-template-grey"><i>?</i></td>
<td>Provides support for fakeRAID root devices. You must have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dmraid">dmraid</a></span> installed to use this. Note that it is preferred to use <a href="../en/RAID.html" class="mw-redirect" title="Mdadm">mdadm</a> with the <b>mdadm_udev</b> hook with fakeRAID if your controller supports it. See <a href="#Using_RAID">#Using RAID</a> for details.</td>
<td>Locates and assembles fakeRAID block devices using <code>dmraid</code>.
</td>
</tr>
<tr>
<td colspan="2" class="archwiki-table-cell"><b>mdadm_udev</b></td>
<td>Provides support for assembling RAID arrays via udev. You must have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mdadm">mdadm</a></span> installed to use this. See <a href="../en/RAID.html#Configure_mkinitcpio" title="RAID">RAID#Configure mkinitcpio</a> for details.</td>
<td class="archwiki-table-cell" data-sort-value="5">–
</td>
</tr>
<tr>
<td class="archwiki-table-cell"><b>encrypt</b></td>
<td class="archwiki-table-cell"><b>sd-encrypt</b></td>
<td>Adds the <code>dm_crypt</code> kernel module and the <code>cryptsetup</code> tool to the image. You must have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span> installed to use this. <div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Take notice of the remarks for the <i>keyboard</i> hook above to unlock an encrypted device during boot, and/or the filesystem remarks in <a href="#MODULES">#MODULES</a> when you use a file to unlock.</div>
</td>
<td>Detects and unlocks an encrypted root partition. See <a href="#Runtime_customization">#Runtime customization</a> for further configuration.
<p>For <b>sd-encrypt</b> see <a href="../en/Dm-crypt/System_configuration.html#Using_systemd-cryptsetup-generator" title="Dm-crypt/System configuration">dm-crypt/System configuration#Using systemd-cryptsetup-generator</a>.
</p>
</td>
</tr>
<tr>
<td colspan="2" class="archwiki-table-cell"><b>lvm2</b></td>
<td>Adds the device mapper kernel module and the <code>lvm</code> tool to the image. You must have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lvm2">lvm2</a></span> installed to use this. This is necessary if you have your root file system on <a href="../en/LVM.html" title="LVM">LVM</a>.</td>
<td class="archwiki-table-cell" data-sort-value="5">–
</td>
</tr>
<tr>
<td colspan="2" class="archwiki-table-cell"><b>filesystems</b></td>
<td>This includes necessary file system modules into your image. This hook is <b>required</b> unless you specify your file system modules in <code>MODULES</code>.</td>
<td class="archwiki-table-cell" data-sort-value="5">–
</td>
</tr>
<tr>
<td colspan="2" class="archwiki-table-cell"><b>fsck</b></td>
<td>Adds the fsck binary and file system-specific helpers to allow running fsck against your root device (and <code>/usr</code> if separate) prior to mounting. If added after the <b>autodetect</b> hook, only the helper specific to your root file system will be added. Usage of this hook is <b>strongly</b> recommended, and it is required with a separate <code>/usr</code> partition. It is highly recommended that if you include this hook that you also include any necessary modules to ensure your keyboard will work in early userspace.
<p>The use of this hook requires the <code>rw</code> parameter to be set on the <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel command line">kernel command line</a> (<a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1307895#p1307895">discussion</a>). See <a href="../en/Fsck.html#Boot_time_checking" title="Fsck">fsck#Boot time checking</a> for more details.
</p>
</td>
<td class="archwiki-table-cell" data-sort-value="5">–
</td>
</tr>
<tr>
<td colspan="2" class="archwiki-table-cell"><b>acpi_override</b></td>
<td>Adds ACPI Machine Language (<i>.aml</i>) files found in <code>/usr/initcpio/acpi_override/</code> and <code>/etc/initcpio/acpi_override/</code> to the early uncompressed initramfs image so that the kernel can override ACPI tables (e.g. <a href="../en/DSDT.html" title="DSDT">DSDT</a>) very early during boot.<a rel="nofollow" class="external autonumber" href="https://docs.kernel.org/admin-guide/acpi/initrd_table_override.html">[1]</a>
</td>
<td class="archwiki-table-cell" data-sort-value="5">–
</td>
</tr>
</tbody>
</table>
<div class="mw-heading mw-heading3"><h3 id="COMPRESSION">COMPRESSION</h3></div>
<p>The kernel supports several formats for compression of the initramfs: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gzip">gzip</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bzip2">bzip2</a></span>, lzma (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xz">xz</a></span>), <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xz">xz</a></span>, lzo (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lzop">lzop</a></span>), <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lz4">lz4</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=zstd">zstd</a></span>. By default mkinitcpio uses zstd compression for kernel version 5.9 and newer and gzip for kernel versions older than 5.9.
</p>
<p>The provided <code>mkinitcpio.conf</code> has the various <code>COMPRESSION</code> options commented out. Uncomment one if you wish to switch to another compression method and make sure you have the corresponding compression utility installed. If none is specified, the default method is used. If you wish to create an uncompressed image, specify <code>COMPRESSION=<b>cat</b></code> in the configuration file or use <code>-z cat</code> on the command line.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> 
<ul>
<li>lz4 and xz compression utilities are multithreaded by default and zstd is run in multithreaded mode (with the <code>-T0</code> option which tries to spawn as many threads as detected cores).</li>
<li>With a compression ratio typically around 2.5 on the image in its high compression mode (<code>-9</code>), lz4 achieves the fastest decompression speed. For a slightly better compression, lzo is still fast to decompress. zstd offers a versatile solution, with multi-threaded compression and a wide range of compression levels through its options — see <span class="plainlinks archwiki-template-man" title="$ man 1 zstd"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/zstd.1#Operation_Modifiers">zstd(1) § Operation Modifiers</a></span>. xz achieves the smallest size with a reduction factor around 5 in its high compression preset (<code>-9</code>), at the cost of a much slower decompression speed.</li>
</ul>
</div>
<div class="mw-heading mw-heading3"><h3 id="COMPRESSION_OPTIONS">COMPRESSION_OPTIONS</h3></div>
<p>These are additional flags passed to the program specified by <code>COMPRESSION</code>, such as:
</p>
<pre>COMPRESSION_OPTIONS=(-9)
</pre>
<p>This option can be left empty; <i>mkinitcpio</i> will ensure that any supported compression method has the necessary flags to produce a working image.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> Misuse of this option may lead to an <b>unbootable system</b> if the kernel is unable to unpack the resultant archive.</div>
<p>With the default zstd compression, to save space for custom kernels (especially with a <a href="../en/Dual_boot_with_Windows.html" class="mw-redirect" title="Dual boot">dual boot</a> setup when using the EFI system partition as <code>/boot</code>), the <code>--long</code> option is very effective. However, systems with limited RAM may not be able to decompress initramfs using this option. The <code>-v</code> option may also be desired to see details during the initramfs generation. For example:
</p>
<pre>COMPRESSION="zstd"
COMPRESSION_OPTIONS=(-v -5 --long)
</pre>
<p>Highest, but slowest, compression can be achieved by using xz with the <code>-9e</code> compression level and also decompressing the loadable kernel modules and firmware:
</p>
<pre>COMPRESSION="xz"
COMPRESSION_OPTIONS=(-9e)
MODULES_DECOMPRESS="yes"
</pre>
<div class="mw-heading mw-heading3"><h3 id="MODULES_DECOMPRESS">MODULES_DECOMPRESS</h3></div>
<p><code>MODULES_DECOMPRESS</code> controls whether the kernel module and firmware files are decompressed during initramfs creation. The default value is <code>no</code>.
</p>
<p>Arch compresses its <a href="../en/Kernel.html" title="Kernel">kernel</a> modules and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-firmware">linux-firmware</a></span> with zstd at level 19. When using a higher compression than that for the initramfs, setting <code>MODULES_DECOMPRESS="yes"</code> will allow to reduce the initramfs size even further. This comes at the expense of increased RAM and CPU usage at early boot which negatively affects systems with limited RAM or weak CPUs since the kernel will spend more time to decompress the whole initramfs image than it would take to decompress the individual modules and firmware upon loading them.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> Near the end of the initramfs generation process, all remaining <i>.bz2</i>, <i>.gz</i>, <i>.lz4</i>, <i>.lzma</i>, <i>.lzo</i>, <i>.xz</i> and <i>.zst</i> files are moved to the early uncompressed initramfs image to avoid double compression.</div>
<div class="mw-heading mw-heading2"><h2 id="Runtime_customization">Runtime customization</h2></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Which options work with the <code>systemd</code> hook and which are <code>base</code>-only? (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Mkinitcpio.html">Talk:Mkinitcpio</a>)</div>
</div>
<p>Runtime configuration options can be passed to <code>init</code> and certain hooks via the kernel command line. Kernel command-line parameters are often supplied by the boot loader. The options discussed below can be appended to the kernel command line to alter default behavior. See <a href="../en/Kernel_parameters.html" title="Kernel parameters">Kernel parameters</a> and <a href="../en/Arch_boot_process.html" title="Arch boot process">Arch boot process</a> for more information.
</p>
<div class="mw-heading mw-heading3"><h3 id="init_from_base_hook">init from base hook</h3></div>
<dl>
<dt><code>root=</code></dt>
<dd>This is the most important parameter specified on the kernel command line, as it determines what device will be mounted as your proper root device. <i>mkinitcpio</i> is flexible enough to allow a wide variety of formats; see <a href="../en/Persistent_block_device_naming.html#Kernel_parameters" title="Persistent block device naming">Persistent block device naming#Kernel parameters</a> for examples.</dd>
</dl>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> The following boot parameters alter the default behavior of <code>init</code> in the initramfs environment. See <code>/usr/lib/initcpio/init</code> for details. They will not work when <code>systemd</code> hook is being used since the <code>init</code> from <code>base</code> hook is replaced.</div>
<dl>
<dt><code>break</code></dt>
<dd>If <code>break</code> or <code>break=premount</code> is specified, <code>init</code> pauses the boot process (after loading hooks, but before mounting the root file system) and launches an interactive shell which can be used for troubleshooting purposes. This shell can be launched after the root has been mounted by specifying <code>break=postmount</code>. Normal boot continues after exiting from the shell.</dd>
</dl>
<dl>
<dt><code>disablehooks=</code></dt>
<dd>Disable hooks at runtime by adding <code>disablehooks=hook1[,hook2,...]</code>. For example: <pre>disablehooks=resume</pre>
</dd>
</dl>
<dl>
<dt><code>earlymodules=</code></dt>
<dd>Alter the order in which modules are loaded by specifying modules to load early via <code>earlymodules=mod1[,mod2,...]</code>. (This may be used, for example, to ensure the correct ordering of multiple network interfaces.)</dd>
</dl>
<p>See <a href="../en/General_troubleshooting.html#Boot_problems" class="mw-redirect" title="Boot debugging">Boot debugging</a> and <span class="plainlinks archwiki-template-man" title="$ man 8 mkinitcpio"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkinitcpio.8">mkinitcpio(8)</a></span> for other parameters.
</p>
<div class="mw-heading mw-heading3"><h3 id="Using_RAID">Using RAID</h3></div>
<p>See <a href="../en/RAID.html#Configure_mkinitcpio" title="RAID">RAID#Configure mkinitcpio</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Using_net">Using net</h3></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> NFSv4 is not yet supported <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/28287">FS#28287</a>.</div>
<p><b>Required packages</b>
</p>
<p><code>net</code> requires the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-nfs-utils">mkinitcpio-nfs-utils</a></span> package.
</p>
<p><b>Kernel parameters</b>
</p>
<p>Comprehensive and up-to-date information can be found in the official <a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/nfs/nfsroot.html">kernel documentation</a>.
</p>
<p><b>ip=</b>
</p>
<p>This parameter tells the kernel how to configure IP addresses of devices and also how to set up the IP routing table. It can take up to nine arguments separated by colons: <code>ip=&lt;client-ip&gt;:&lt;server-ip&gt;:&lt;gw-ip&gt;:&lt;netmask&gt;:&lt;hostname&gt;:&lt;device&gt;:&lt;autoconf&gt;:&lt;dns0-ip&gt;:&lt;dns1-ip&gt;:&lt;ntp0-ip&gt;</code>.
</p>
<p>If this parameter is missing from the kernel command line, all fields are assumed to be empty, and the defaults mentioned in the <a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/nfs/nfsroot.html">kernel documentation</a> apply. In general this means that the kernel tries to configure everything using autoconfiguration.
</p>
<p>The <code>&lt;autoconf&gt;</code> parameter can appear alone as the value to the <code>ip</code> parameter (without all the <code>:</code> characters before). If the value is <code>ip=off</code> or <code>ip=none</code>, no autoconfiguration will take place, otherwise autoconfiguration will take place. The most common way to use this is <code>ip=dhcp</code>.
</p>
<p>For parameters explanation, see the <a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/nfs/nfsroot.html">kernel documentation</a>.
</p>
<p>Examples:
</p>
<pre>ip=127.0.0.1:::::lo:none  --&gt; Enable the loopback interface.
ip=192.168.1.1:::::eth2:none --&gt; Enable static eth2 interface.
ip=:::::eth0:dhcp --&gt; Enable dhcp protocol for eth0 configuration.
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Make sure to use kernel device names (e.g. <code>eth0</code>) for the <code>&lt;device&gt;</code> parameter, the persistent names (e.g. <code>enp2s0</code>) will not work. See <a href="../en/Network_configuration.html#Network_interfaces" title="Network configuration">Network configuration#Network interfaces</a> for details.</div>
<p><b>BOOTIF=</b>
</p>
<p>If you have multiple network cards, this parameter can include the MAC address of the interface you are booting from. This is often useful as interface numbering may change, or in conjunction with pxelinux IPAPPEND 2 or IPAPPEND 3 option. If not given, <code>eth0</code> will be used.
</p>
<p>Example:
</p>
<pre>BOOTIF=01-A1-B2-C3-D4-E5-F6  # Note the prepended "01-" and capital letters.
</pre>
<p><b>nfsroot=</b>
</p>
<p>If the <code>nfsroot</code> parameter is NOT given on the command line, the default <code>/tftpboot/%s</code> will be used.
</p>
<pre>nfsroot=[&lt;server-ip&gt;:]&lt;root-dir&gt;[,&lt;nfs-options&gt;]
</pre>
<p>Run <code>mkinitcpio -H net</code> for parameter explanation.
</p>
<div class="mw-heading mw-heading3"><h3 id="Using_LVM">Using LVM</h3></div>
<p>If your root device is on <a href="../en/LVM.html" title="LVM">LVM</a>, see <a href="../en/Install_Arch_Linux_on_LVM.html#Adding_mkinitcpio_hooks" title="Install Arch Linux on LVM">Install Arch Linux on LVM#Adding mkinitcpio hooks</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Using_encrypted_root">Using encrypted root</h3></div>
<p>If using an <a href="../en/Dm-crypt/Encrypting_an_entire_system.html" title="Dm-crypt/Encrypting an entire system">encrypted root</a> see <a href="../en/Dm-crypt/System_configuration.html#mkinitcpio" title="Dm-crypt/System configuration">dm-crypt/System configuration#mkinitcpio</a> for detailed information on which hooks to include.
</p>
<div class="mw-heading mw-heading3"><h3 id="/usr_as_a_separate_partition">
<span id=".2Fusr_as_a_separate_partition"></span>/usr as a separate partition</h3></div>
<p>If you keep <code>/usr</code> as a separate partition, you must adhere to the following requirements:
</p>
<ul>
<li>Add the <code>fsck</code> hook, mark <code>/usr</code> with a <code>passno</code> of <code>2</code> in <code>/etc/fstab</code> to run the check on the partition at startup. While recommended for everyone, it is mandatory if you want your <code>/usr</code> partition to be fsck'ed at boot-up. Without this hook, <code>/usr</code> will never be fsck'd.</li>
<li>If not using the systemd hook, add the <code>usr</code> hook. This will mount the <code>/usr</code> partition after root is mounted.</li>
</ul>
<div class="mw-heading mw-heading2"><h2 id="Tips_and_tricks">Tips and tricks</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Fallback_initramfs_generation">Fallback initramfs generation</h3></div>
<p>As of version 40 of mkinitcpio, fallback initramfs generation is disabled by default. To enable it:
</p>
<ul>
<li>Adjust the respective <b>.preset</b> files in <code>/etc/mkinitcpio.d/</code>
<ul>
<li>Disable <code>PRESETS=('default')</code> and enable <code>PRESETS=('default' 'fallback')</code> instead</li>
<li>Enable <code>fallback_image="/boot/initramfs-linux-fallback.img"</code>
</li>
<li>Enable <code>fallback_options="-S autodetect"</code>
</li>
</ul>
</li>
<li>Regenerate initramfs</li>
<li>Update your <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> configuration.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> The lack of a fallback initramfs can deprive you of another option to boot into the system in case a default initramfs fails. Make sure you have a bootable <a href="../en/USB_flash_installation_medium.html" title="USB flash installation medium">installation medium</a> for rescue purposes on hand.</div>
<div class="mw-heading mw-heading2"><h2 id="Troubleshooting">Troubleshooting</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Extracting_the_image">Extracting the image</h3></div>
<p>If you are curious about what is inside the initramfs image, you can extract it and poke at the files inside of it.
</p>
<p>The initramfs image is an SVR4 CPIO archive, generated via the <code>find</code> and <code>bsdcpio</code> commands, optionally compressed with a compression scheme understood by the kernel. For more information on the compression schemes, see <a href="#COMPRESSION">#COMPRESSION</a>.
</p>
<p><i>mkinitcpio</i> includes a utility called <span class="plainlinks archwiki-template-man" title="$ man 1 lsinitcpio"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/lsinitcpio.1">lsinitcpio(1)</a></span> which will list and/or extract the contents of initramfs images.
</p>
<p>You can list the files in the image with:
</p>
<pre># lsinitcpio /boot/initramfs-linux.img
</pre>
<p>And to extract them all in the current directory:
</p>
<pre># lsinitcpio -x /boot/initramfs-linux.img
</pre>
<p>You can also get a more human-friendly listing of the important parts in the image:
</p>
<pre># lsinitcpio -a /boot/initramfs-linux.img
</pre>
<div class="mw-heading mw-heading3"><h3 id="Recompressing_a_modified_extracted_image">Recompressing a modified extracted image</h3></div>
<p>Invoke the <code>build_image</code> function of the <code>/usr/bin/mkinitcpio</code> script with parameters
</p>
<pre>build_image <i>outfile</i> <i>compression</i>
</pre>
<p>It can be done by creating a new script with the contents of the <code>build_image</code> function and running it with the above parameters.
This will compress the contents present in the current directory in a file named <code><i>outfile</i></code>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> It is a good idea to rename the automatically generated <code>/boot/initramfs-linux.img</code> before you overwrite it, so you can easily undo your changes.  Be prepared for making a mistake that prevents your system from booting.  If this happens, you will need to boot through the fallback, or a boot CD, to restore your original, run <i>mkinitcpio</i> to overwrite your changes, or fix them yourself and recompress the image.</div>
<div class="mw-heading mw-heading3"><h3 id="&quot;/dev_must_be_mounted&quot;_when_it_already_is">
<span id=".22.2Fdev_must_be_mounted.22_when_it_already_is"></span>"/dev must be mounted" when it already is</h3></div>
<p>The test used by <i>mkinitcpio</i> to determine if <code>/dev</code> is mounted is to see if <code>/dev/fd/</code> is there. If everything else looks fine, it can be "created" manually by:
</p>
<pre># ln -s /proc/self/fd /dev/
</pre>
<p>(Obviously, <code>/proc</code> must be mounted as well. <i>mkinitcpio</i> requires that anyway, and that is the next thing it will check.)
</p>
<div class="mw-heading mw-heading3"><h3 id="Possibly_missing_firmware_for_module_XXXX">Possibly missing firmware for module XXXX</h3></div>
<p>When initramfs are being rebuilt after a kernel update, you might get warnings:
</p>
<pre>==&gt; WARNING: Possibly missing firmware for module: '<i>module_name</i>'
</pre>
<p>If these messages appear when generating a <i>default</i> initramfs image, then, as the warning says, installing additional firmware may be required. Most common firmware files can be acquired by <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">installing</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-firmware">linux-firmware</a></span> package. For other packages providing firmware see the table below or try searching for the module name in the <a href="../en/Official_repositories.html" title="Official repositories">official repositories</a> or <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>.
</p>
<p>Otherwise, if the messages only appear when generating the <i>fallback</i> initramfs image you have the following options:
</p>
<ul>
<li>You can safely ignore the warnings, if you know that you do not use the affected hardware.</li>
<li>If you want to suppress the warnings, you can install the missing firmware. The meta-package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-firmware/">mkinitcpio-firmware</a></span><sup><small>AUR</small></sup> contains most optional firmwares. Alternatively, manually install the needed packages:</li>
</ul>
<dl><dd><table class="wikitable">

<tbody>
<tr>
<th>Module</th>
<th>Package
</th>
</tr>
<tr>
<td>aic94xx</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/aic94xx-firmware/">aic94xx-firmware</a></span><sup><small>AUR</small></sup>
</td>
</tr>
<tr>
<td>ast</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ast-firmware/">ast-firmware</a></span><sup><small>AUR</small></sup>
</td>
</tr>
<tr>
<td>bfa</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-firmware-qlogic">linux-firmware-qlogic</a></span>
</td>
</tr>
<tr>
<td>bnx2x</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-firmware-broadcom">linux-firmware-broadcom</a></span>
</td>
</tr>
<tr>
<td>liquidio</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-firmware-liquidio">linux-firmware-liquidio</a></span>
</td>
</tr>
<tr>
<td>mlxsw_spectrum</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-firmware-mellanox">linux-firmware-mellanox</a></span>
</td>
</tr>
<tr>
<td>nfp</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-firmware-nfp">linux-firmware-nfp</a></span>
</td>
</tr>
<tr>
<td>qat_420xx</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-firmware-intel">linux-firmware-intel</a></span>
</td>
</tr>
<tr>
<td>qed</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-firmware-qlogic">linux-firmware-qlogic</a></span>
</td>
</tr>
<tr>
<td>qla1280</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-firmware-qlogic">linux-firmware-qlogic</a></span>
</td>
</tr>
<tr>
<td>qla2xxx</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-firmware-qlogic">linux-firmware-qlogic</a></span>
</td>
</tr>
<tr>
<td>wd719x</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/wd719x-firmware/">wd719x-firmware</a></span><sup><small>AUR</small></sup>
</td>
</tr>
<tr>
<td>xhci_pci<br>xhci_pci_renesas</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/upd72020x-fw/">upd72020x-fw</a></span><sup><small>AUR</small></sup>
</td>
</tr>
</tbody>
</table></dd></dl>
<ul><li>If you want to get rid of the warnings, but do not want to waste your system space on unneeded firmware packages, you can disable <a href="#Fallback_initramfs_generation">fallback initramfs generation</a> altogether.</li></ul>
<p>For unavailable firmware, you can suppress the warnings by creating dummy files, e.g.:
</p>
<pre># echo "Device not available" &gt; /usr/lib/firmware/qat_420xx.bin
# echo "Device not available" &gt; /usr/lib/firmware/qat_420xx_mmp.bin
</pre>
<div class="mw-heading mw-heading3"><h3 id="No_PS/2_controller_found">
<span id="No_PS.2F2_controller_found"></span>No PS/2 controller found</h3></div>
<p>On some motherboards (mostly ancient ones, but also a few new ones), the i8042 controller cannot be automatically detected. It is rare, but some people will surely be without keyboard. You can detect this situation in advance. If you have a PS/2 port and get <code>i8042: PNP: No PS/2 controller found. Probing ports directly</code> message, add <code>atkbd</code> to the <code>MODULES</code> array.<a rel="nofollow" class="external autonumber" href="https://archlinux.org/news/linux-313-warning-ps2-keyboard-support-is-now-modular/">[2]</a>
</p>
<div class="mw-heading mw-heading3"><h3 id="Standard_rescue_procedures">Standard rescue procedures</h3></div>
<p>With an improper initial ram-disk a system often is unbootable. So follow a system rescue procedure like below:
</p>
<div class="mw-heading mw-heading4"><h4 id="Boot_succeeds_on_one_machine_and_fails_on_another">Boot succeeds on one machine and fails on another</h4></div>
<p><i>mkinitcpio'</i>s <code>autodetect</code> hook filters unneeded <a href="../en/Kernel_module.html" class="mw-redirect" title="Kernel modules">kernel modules</a> in the primary initramfs scanning <code>/sys</code> and the modules loaded at the time it is run. If you transfer your <code>/boot</code> directory to another machine and the boot sequence fails during early userspace, it may be because the new hardware is not detected due to missing kernel modules. Note that USB 2.0 and 3.0 need different kernel modules.
</p>
<p>To fix, first try choosing the <a href="#Image_creation_and_activation">fallback</a> image from your <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a>, as it is not filtered by <code>autodetect</code>. Once booted, run <i>mkinitcpio</i> on the new machine to rebuild the primary image with the correct modules. If the fallback image fails, try booting into an Arch Linux live CD/USB, chroot into the installation, and run <i>mkinitcpio</i> on the new machine. As a last resort, try <a href="#MODULES">manually</a> adding modules to the initramfs.
</p>
<div class="mw-heading mw-heading3"><h3 id="Cannot_open_access_to_console,_the_root_account_is_locked">
<span id="Cannot_open_access_to_console.2C_the_root_account_is_locked"></span>Cannot open access to console, the root account is locked</h3></div>
<p>The <code>systemd</code> hook <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/packaging/packages/systemd/-/commit/292cdf8a2f7dd7c6c7d91d2b59617391935c837c">disables the root account</a>. To enable the emergency shell, temporarily add <code>SYSTEMD_SULOGIN_FORCE=1</code> to the <a href="../en/Kernel_parameters.html" title="Kernel parameters">kernel parameters</a>.
</p>
<p>Alternatively, you can use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/initcpio-hook-shadowcopy/">initcpio-hook-shadowcopy</a></span><sup><small>AUR</small></sup>, by installing it and adding the <code>shadowcopy</code> hook after <code>systemd</code> in <code>/etc/mkinitcpio.conf</code>, and regenerating initramfs with <code>mkinitcpio -P</code>. More documentation is available in <a rel="nofollow" class="external text" href="https://github.com/iTrooz/initcpio-hook-shadowcopy">its GitHub repo</a>.
</p>
<div class="mw-heading mw-heading2"><h2 id="See_also">See also</h2></div>
<ul>
<li>Linux Kernel documentation on <a rel="nofollow" class="external text" href="https://docs.kernel.org/filesystems/ramfs-rootfs-initramfs.html#what-is-rootfs">initramfs, "What is rootfs?"</a>
</li>
<li>Linux Kernel documentation on <a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/initrd.html">initrd</a>
</li>
<li>Wikipedia article on <a href="https://en.wikipedia.org/wiki/initrd" class="extiw" title="wikipedia:initrd">initrd</a>
</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Initramfs.html" title="Category:Initramfs">Initramfs</a></li>
<li><a href="../en/Category:Kernel.html" title="Category:Kernel">Kernel</a></li>
<li><a href="../en/Category:Arch_projects.html" title="Category:Arch projects">Arch projects</a></li>
<li><a href="../en/Category:Commands.html" title="Category:Commands">Commands</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Mkinitcpio&amp;oldid=854552">https://wiki.archlinux.org/index.php?title=Mkinitcpio&amp;oldid=854552</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 29 November 2025, at 15:21.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true">mkinitcpio</div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
