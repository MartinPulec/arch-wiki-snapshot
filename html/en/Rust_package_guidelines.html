<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Rust package guidelines - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.43.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Rust_package_guidelines rootpage-Rust_package_guidelines skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Package_naming" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Package_naming">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Package naming</span>
			</div>
		</a>
		
		<ul id="toc-Package_naming-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Source" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Source">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Source</span>
			</div>
		</a>
		
		<ul id="toc-Source-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Depends" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Depends">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Depends</span>
			</div>
		</a>
		
		<ul id="toc-Depends-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Prepare" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Prepare">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Prepare</span>
			</div>
		</a>
		
		<ul id="toc-Prepare-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Build" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Build">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Build</span>
			</div>
		</a>
		
		<ul id="toc-Build-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Check" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Check">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Check</span>
			</div>
		</a>
		
		<ul id="toc-Check-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Package" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Package">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">7</span>
				<span>Package</span>
			</div>
		</a>
		
			<button aria-controls="toc-Package-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Package subsection</span>
			</button>
		
		<ul id="toc-Package-sublist" class="vector-toc-list">
			<li id="toc-Notes_about_using_cargo_install" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Notes_about_using_cargo_install">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.1</span>
					<span>Notes about using cargo install</span>
				</div>
			</a>
			
			<ul id="toc-Notes_about_using_cargo_install-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">8</span>
				<span>Tips and tricks</span>
			</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id='toc-Preventing_the_"Package_contains_reference_to_$srcdir"_warning' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#Preventing_the_"Package_contains_reference_to_$srcdir"_warning'>
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.1</span>
					<span>Preventing the "Package contains reference to $srcdir" warning</span>
				</div>
			</a>
			
			<ul id='toc-Preventing_the_"Package_contains_reference_to_$srcdir"_warning-sublist' class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Complete_PKGBUILD_template" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Complete_PKGBUILD_template">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">9</span>
				<span>Complete PKGBUILD template</span>
			</div>
		</a>
		
		<ul id="toc-Complete_PKGBUILD_template-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Example_packages" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Example_packages">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">10</span>
				<span>Example packages</span>
			</div>
		</a>
		
		<ul id="toc-Example_packages-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Rust package guidelines</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Rust_%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%AC%E3%82%A4%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3" title="Rust パッケージガイドライン – 日本語" lang="ja" hreflang="ja" data-title="Rust パッケージガイドライン" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/Rust_package_guidelines.html" title="Rust package guidelines – português" lang="pt" hreflang="pt" data-title="Rust package guidelines" data-language-autonym="Português" data-language-local-name="português" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Rust_%E8%BD%AF%E4%BB%B6%E6%89%93%E5%8C%85%E5%87%86%E5%88%99" title="Rust 软件打包准则 – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" data-title="Rust 软件打包准则" data-language-autonym="中文（简体）" data-language-local-name="中文（简体）" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="toc" style="display:block; text-align: center; margin-bottom: 1em;">
<b><a href="../en/Arch_package_guidelines.html" title="Arch package guidelines">Arch package guidelines</a></b>
<hr>
<p><a href="../en/32-bit_package_guidelines.html" title="32-bit package guidelines">32-bit</a> – <a href="../en/CLR_package_guidelines.html" title="CLR package guidelines">CLR</a> – <a href="../en/CMake_package_guidelines.html" title="CMake package guidelines">CMake</a> – <a href="../en/Cross-compiling_tools_package_guidelines.html" title="Cross-compiling tools package guidelines">Cross</a> – <a href="../en/DKMS_package_guidelines.html" title="DKMS package guidelines">DKMS</a> – <a href="../en/Eclipse_plugin_package_guidelines.html" title="Eclipse plugin package guidelines">Eclipse</a> – <a href="../en/Electron_package_guidelines.html" title="Electron package guidelines">Electron</a> – <a href="../en/Font_package_guidelines.html" title="Font package guidelines">Font</a> – <a href="../en/Free_Pascal_package_guidelines.html" title="Free Pascal package guidelines">Free Pascal</a> – <a href="../en/GNOME_package_guidelines.html" title="GNOME package guidelines">GNOME</a> – <a href="../en/Go_package_guidelines.html" title="Go package guidelines">Go</a> – <a href="../en/Haskell_package_guidelines.html" title="Haskell package guidelines">Haskell</a> – <a href="../en/Java_package_guidelines.html" title="Java package guidelines">Java</a> – <a href="../en/KDE_package_guidelines.html" title="KDE package guidelines">KDE</a> – <a href="../en/Kernel_module_package_guidelines.html" title="Kernel module package guidelines">Kernel modules</a> – <a href="../en/Lisp_package_guidelines.html" title="Lisp package guidelines">Lisp</a> – <a href="../en/Meson_package_guidelines.html" title="Meson package guidelines">Meson</a> – <a href="../en/MinGW_package_guidelines.html" title="MinGW package guidelines">MinGW</a> – <a href="../en/Node.js_package_guidelines.html" title="Node.js package guidelines">Node.js</a> – <a href="../en/Nonfree_applications_package_guidelines.html" title="Nonfree applications package guidelines">Nonfree</a> – <a href="../en/OCaml_package_guidelines.html" title="OCaml package guidelines">OCaml</a> – <a href="../en/Perl_package_guidelines.html" title="Perl package guidelines">Perl</a> – <a href="../en/PHP_package_guidelines.html" title="PHP package guidelines">PHP</a> – <a href="../en/Python_package_guidelines.html" title="Python package guidelines">Python</a> – <a href="../en/R_package_guidelines.html" title="R package guidelines">R</a> – <a href="../en/Ruby_package_guidelines.html" title="Ruby package guidelines">Ruby</a> – <a class="mw-selflink selflink">Rust</a> - <a href="../en/Arch_package_guidelines/Security.html" title="Arch package guidelines/Security">Security</a> – <a href="../en/Shell_package_guidelines.html" title="Shell package guidelines">Shell</a> – <a href="../en/VCS_package_guidelines.html" title="VCS package guidelines">VCS</a> – <a href="../en/Web_application_package_guidelines.html" title="Web application package guidelines">Web</a> – <a href="../en/Wine_package_guidelines.html" title="Wine package guidelines">Wine</a>
</p>
</div>
<p>This document covers standards and guidelines on writing <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILDs</a> for software written in <a href="../en/Rust.html" title="Rust">Rust</a>.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Package_naming">Package naming</span></h2>
<p>When packaging <a href="../en/Rust.html" title="Rust">Rust</a> projects, the package name should almost always be the same as the name of the generated binary. Note that it does not make any sense to package library crates, so only crates with bins will be packaged. For ones that generate more than one binary, the upstream crate name is usually appropriate. In any event the package name should be entirely lowercase.
</p>
<h2><span class="mw-headline" id="Source">Source</span></h2>
<p>Most Rust projects may be built from tarballs, source archives (e.g. source links on GitHub releases), or any other published source.
</p>
<p>When other sources are not available, most Rust projects are published on <a rel="nofollow" class="external text" href="https://crates.io">crates.io</a> which provides a stable download URL scheme for use with <a href="../en/Rust.html#Cargo" class="mw-redirect" title="Cargo">cargo</a>. The downside of this source is that it usually does not include all the test files, license files, or other assets normally in the other sources. If needed, the <a href="../en/PKGBUILD.html#source" title="PKGBUILD">PKGBUILD#source</a> can use the following template:
</p>
<pre>source=("$pkgname-$pkgver.tar.gz::https://static.crates.io/crates/$pkgname/$pkgname-$pkgver.crate")
</pre>
<h2><span class="mw-headline" id="Depends">Depends</span></h2>
<p>While some Rust projects have external dependencies, most just use Rust ecosystem libraries that are statically embedded in the final binary. As such most projects will not need to specify many <code>depends</code>. The usual exceptions that most Rust binaries do link against glibc libraries, so <code>gcc-libs</code> and <code>glibc</code> are typically dependencies of most Rust packages. There may be more if the build process looks for and links against any system libraries.
</p>
<p>For <code>makedepends</code>, the vast majority of Rust projects are designed to be built using the <a href="../en/Rust.html#Cargo" class="mw-redirect" title="Cargo">cargo</a> dependency manager, which both orchestrates the download of libraries to satisfy build time dependencies as well as makes all the necessary calls to <code>rustc</code>, the actual Rust compiler. Currently both <i>cargo</i> and <i>rustc</i> are provided by the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=rust">rust</a></span> package, but there are also alternative ways of getting both of these together or separately including the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=rustup">rustup</a></span> package. As such, the tool most PKGBUILDs are going to call is <i>cargo</i> and you should depend directly on it.
</p>
<pre>makedepends=(cargo)
</pre>
<p>If a project requires the use of a nightly version of the Rust tool chain, use:
</p>
<pre>makedepends=(cargo-nightly)
</pre>
<h2><span class="mw-headline" id="Prepare">Prepare</span></h2>
<p>The rust dependency manager <a href="../en/Rust.html#Cargo" class="mw-redirect" title="Cargo">cargo</a> is able to download all the libraries required to build a project ahead of time. Running this fetch in the <code>prepare()</code> stage  enables the later <code>build()</code> and other stages to be run entirely offline.
</p>
<pre>prepare() {
    export RUSTUP_TOOLCHAIN=stable
    cargo fetch --locked --target "$(rustc -vV | sed -n 's/host: //p')"
}
</pre>
<p>where:
</p>
<ul>
<li>
<code>RUSTUP_TOOLCHAIN=stable</code> makes sure the default tool chain is set to <i>stable</i> in the event users have changed their default. Of course this should be set to <i>nightly</i> in the event that's what the upstream project requires. This avoids a common side effect of user preferences when not building in a chroot. Also note this is <i>not required</i> if the upstream project has a <code>rust-toolchain</code> file or <code>rust-toolchain.toml</code> file in their sources that serves this purpose.</li>
<li>
<code>--locked</code> tells <i>cargo</i> to strictly adhere to the versions specified in the <code>Cargo.lock</code> file and prevent it from updating dependencies. This is important for <a rel="nofollow" class="external text" href="https://reproducible-builds.org/">reproducible builds</a>.</li>
<li>
<code>--target "$(rustc -vV | sed -n 's/host: //p')"</code> tells <i>cargo</i> to only fetch dependencies needed for the specific target platform being built, thus reducing downloads (see <a href="../en/PKGBUILD.html#arch" title="PKGBUILD">PKGBUILD#arch</a> and <a rel="nofollow" class="external text" href="https://doc.rust-lang.org/nightly/rustc/platform-support.html">Rust platform support</a>).</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If building a VCS package for an upstream source project that does not keep its <code>Cargo.lock</code> file in sync with <code>Cargo.toml</code> between release cycles, add <code>cargo update</code> before running <code>cargo fetch</code>. All other aspects of the build should work as documented here, although the result will not be a fully reproducible build because the dependencies will be resolved at build time.</div>
<h2><span class="mw-headline" id="Build">Build</span></h2>
<p>Building a Rust package.
</p>
<pre>build() {
    export RUSTUP_TOOLCHAIN=stable
    export CARGO_TARGET_DIR=target
    cargo build --frozen --release --all-features
}
</pre>
<p>where:
</p>
<ul>
<li>
<code>--release</code> tells <i>cargo</i> to compile a release build (the default is a debug build)</li>
<li>
<code>--frozen</code> tells <i>cargo</i> to stay offline and only use the versions specified in the <code>Cargo.lock</code> file and as cached by the fetch run in the <code>prepare()</code> stage. This is functionally equivalent to <code>--locked --offline</code>, which may also be used. This is important for <a rel="nofollow" class="external text" href="https://reproducible-builds.org/">reproducible builds</a>.</li>
<li>
<code>--all-features</code> tells <i>cargo</i> to compile with all features of the package enabled. Alternatively, use <code>--features <i>FEATURE1</i>,<i>FEATURE2</i></code> if you want enable only selected features.</li>
<li>
<code>CARGO_TARGET_DIR=target</code> tells <i>cargo</i> to place the output in <i>target</i> relative to the current directory. This avoids a common side effect of user preferences when not building in a chroot.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The two environment variables are not needed for Arch repository packages because they are <i>always</i> built in chroot environments with default settings. They are included here for the convenience of AUR users that may not realize the consequences of changing their user default settings and not using chroots when building packages.</div>
<h2><span class="mw-headline" id="Check">Check</span></h2>
<p>Most Rust projects provide a simple way to run the test suite.
</p>
<pre>check() {
    export RUSTUP_TOOLCHAIN=stable
    cargo test --frozen --all-features
}
</pre>
<p>You should also check if the repository is a <a rel="nofollow" class="external text" href="https://doc.rust-lang.org/cargo/reference/workspaces.html">cargo workspace</a>. Just open up <code>/Cargo.toml</code> and see if it contains a <code>[workspace]</code> section. If so, you should add the <code>--workspace</code> flag to <code>cargo test</code> to ensure that all tests of the workspace members are run too.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Avoid using the <code>--release</code> flag when running tests, because it enables compiler optimizations and disables some features like integer overflow checks and <code>debug_assert!()</code> macro, so in theory you <i>could</i> end up catching less problems. Although the difference in optimization flags does mean that tests have to rebuild more crates, it still does have to rebuild anything that effects the unit tests to build in the tests and the optimization flags will slow down the build more than not having to rebuild so many crates would by matching optimization flags. Since the final binary artifacts being tested are not the same as the one we package anyway and we aren't testing the build toolchain, for most Rust projects there is nothing to gain by testing in release mode.</div>
<h2><span class="mw-headline" id="Package">Package</span></h2>
<p>Rust builds binaries in <code>target/release</code> and can simply be installed to <code>/usr/bin</code>.
</p>
<pre>package() {
    install -Dm0755 -t "$pkgdir/usr/bin/" "target/release/$pkgname"
}
</pre>
<p>If a package has more than one executable in <code>/usr/bin</code> you can use find command:
</p>
<pre>package() {
    find target/release \
        -maxdepth 1 \
        -executable \
        -type f \
        -exec install -Dm0755 -t "$pkgdir/usr/bin/" {} +
}
</pre>
<h3><span class="mw-headline" id="Notes_about_using_cargo_install">Notes about using cargo install</span></h3>
<p>Some packages should install more files such as a man page or other assets. In the event that such a package does not have any other way to install these, one can use <code>cargo install</code>. In this case <code>build()</code> is unnecessary because <code>cargo install</code> forces rebuilding even if the package already has been built by using <code>cargo build</code>. The <code>prepare()</code> stage can still be used to fetch sources ahead of time:
</p>
<pre>package() {
    export RUSTUP_TOOLCHAIN=stable 
    cargo install --no-track --frozen --all-features --root "$pkgdir/usr/" --path .
}
</pre>
<p>The <code>--no-track</code> argument should always be used, otherwise <code>cargo install</code> will create unwanted files such as <code>/usr/.crates.toml</code> or <code>/usr/.crates2.json</code>.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3>
<span id="Preventing_the_.22Package_contains_reference_to_.24srcdir.22_warning"></span><span class="mw-headline" id='Preventing_the_"Package_contains_reference_to_$srcdir"_warning'>Preventing the "Package contains reference to $srcdir" warning</span>
</h3>
<p><a href="../en/Makepkg.html#WARNING:_Package_contains_reference_to_$srcdir" title="Makepkg">This warning</a> occurs because <code>$srcdir</code> appears in at least one file in <code>pkg</code>, which is <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1812105#p1812105">undesirable for reproducible builds</a>. Paths can be redacted as follows:
</p>
<pre>export RUSTFLAGS="${RUSTFLAGS} --remap-path-prefix $srcdir=src"
</pre>
<h2><span class="mw-headline" id="Complete_PKGBUILD_template">Complete PKGBUILD template</span></h2>
<pre># Maintainer: Firstname Lastname &lt;email@example.org&gt;

pkgname=
pkgver=
pkgrel=1
pkgdesc=''
url=''
license=()
makedepends=('cargo')
depends=()
arch=('i686' 'x86_64' 'armv6h' 'armv7h')
source=()
b2sums=()

prepare() {
    export RUSTUP_TOOLCHAIN=stable
    cargo fetch --locked --target "$(rustc -vV | sed -n 's/host: //p')"
}

build() {
    export RUSTUP_TOOLCHAIN=stable
    export CARGO_TARGET_DIR=target
    cargo build --frozen --release --all-features
}

check() {
    export RUSTUP_TOOLCHAIN=stable
    cargo test --frozen --all-features
}

package() {
    install -Dm0755 -t "$pkgdir/usr/bin/" "target/release/$pkgname"
    # for custom license, e.g. MIT
    # install -Dm644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
</pre>
<h2><span class="mw-headline" id="Example_packages">Example packages</span></h2>
<p>Click <i>Package Actions &gt; Source Files</i> in the package page to see its example PKGBUILD.
</p>
<ul>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cbindgen">cbindgen</a></span></li>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ripgrep">ripgrep</a></span></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Arch_package_guidelines.html" title="Category:Arch package guidelines">Arch package guidelines</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Rust_package_guidelines&amp;oldid=828966">https://wiki.archlinux.org/index.php?title=Rust_package_guidelines&amp;oldid=828966</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 15 March 2025, at 13:42.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki.svg" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul></ul>
</div>
</body>
</html>
