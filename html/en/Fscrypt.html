<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>fscrypt - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.45.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Fscrypt rootpage-Fscrypt skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Alternatives_to_consider" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Alternatives_to_consider">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Alternatives to consider</span>
			</div>
		</a>
		
		<ul id="toc-Alternatives_to_consider-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Preparations" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Preparations">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Preparations</span>
			</div>
		</a>
		
			<button aria-controls="toc-Preparations-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Preparations subsection</span>
			</button>
		
		<ul id="toc-Preparations-sublist" class="vector-toc-list">
			<li id="toc-Kernel" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Kernel">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>Kernel</span>
				</div>
			</a>
			
			<ul id="toc-Kernel-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-File_system" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#File_system">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>File system</span>
				</div>
			</a>
			
			<ul id="toc-File_system-sublist" class="vector-toc-list">
				<li id="toc-ext4" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#ext4">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2.1</span>
					<span>ext4</span>
				</div>
			</a>
			
			<ul id="toc-ext4-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-F2FS" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#F2FS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2.2</span>
					<span>F2FS</span>
				</div>
			</a>
			
			<ul id="toc-F2FS-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Userspace_tool" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Userspace_tool">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3</span>
					<span>Userspace tool</span>
				</div>
			</a>
			
			<ul id="toc-Userspace_tool-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-PAM_module" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#PAM_module">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4</span>
					<span>PAM module</span>
				</div>
			</a>
			
			<ul id="toc-PAM_module-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Encrypt_a_directory" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Encrypt_a_directory">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Encrypt a directory</span>
			</div>
		</a>
		
		<ul id="toc-Encrypt_a_directory-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Lock/unlock_a_directory" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Lock/unlock_a_directory">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Lock/unlock a directory</span>
			</div>
		</a>
		
		<ul id="toc-Lock/unlock_a_directory-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Encrypt_a_home_directory" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Encrypt_a_home_directory">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Encrypt a home directory</span>
			</div>
		</a>
		
		<ul id="toc-Encrypt_a_home_directory-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Encryption_within_Linux_Containers_(lxc)" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Encryption_within_Linux_Containers_(lxc)">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Encryption within Linux Containers (lxc)</span>
			</div>
		</a>
		
			<button aria-controls="toc-Encryption_within_Linux_Containers_(lxc)-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Encryption within Linux Containers (lxc) subsection</span>
			</button>
		
		<ul id="toc-Encryption_within_Linux_Containers_(lxc)-sublist" class="vector-toc-list">
			<li id="toc-Lock_directory_when_container_is_stopped" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Lock_directory_when_container_is_stopped">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.1</span>
					<span>Lock directory when container is stopped</span>
				</div>
			</a>
			
			<ul id="toc-Lock_directory_when_container_is_stopped-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">7</span>
				<span>Troubleshooting</span>
			</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-ext4:_Encrypted_files_outside_fscrypt_encrypted_directory" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ext4:_Encrypted_files_outside_fscrypt_encrypted_directory">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.1</span>
					<span>ext4: Encrypted files outside fscrypt encrypted directory</span>
				</div>
			</a>
			
			<ul id="toc-ext4:_Encrypted_files_outside_fscrypt_encrypted_directory-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">8</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar no-font-mode-scale">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">fscrypt</h1>
							
</header>
				<div class="vector-column-end no-font-mode-scale">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Data-at-rest_encryption.html" title="Data-at-rest encryption">Data-at-rest encryption</a></li>
<li><a href="../en/Ext4.html" title="Ext4">Ext4</a></li>
<li><a href="../en/F2FS.html" title="F2FS">F2FS</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://github.com/google/fscrypt">fscrypt</a> is a tool for managing the native file encryption support of the <a href="../en/Ext4.html" title="Ext4">ext4</a>, <a href="../en/F2FS.html" title="F2FS">F2FS</a>, <a href="https://en.wikipedia.org/wiki/UBIFS" class="extiw" title="wikipedia:UBIFS">UBIFS</a>, <a href="https://en.wikipedia.org/wiki/CephFS" class="extiw" title="wikipedia:CephFS">CephFS</a> and <a href="https://en.wikipedia.org/wiki/Lustre_(file_system)" class="extiw" title="wikipedia:Lustre (file system)">Lustre</a> <a href="../en/File_systems.html" title="File systems">file systems</a>.
</p>
<p>The <a rel="nofollow" class="external text" href="https://docs.kernel.org/filesystems/fscrypt.html">underlying encryption mechanism in the kernel</a>, which is integrated into the above file systems, is also sometimes called "fscrypt". To avoid ambiguity, this article calls the kernel feature "Linux native file encryption". With Linux native file encryption, different directories can use different encryption keys. In an encrypted directory, all file contents, filenames, and symlinks are encrypted. All subdirectories are encrypted too. Non-filename metadata, such as timestamps, the sizes and number of files, and extended attributes, is not encrypted.
</p>
<p>As this article assumes the use of the <i>fscrypt</i> tool (and optionally <i>pam_fscrypt</i>, which goes along with <i>fscrypt</i>), most of it is not applicable to other userspace tools that can set up Linux native file encryption, for example <a href="../en/Systemd-homed.html" title="Systemd-homed">systemd-homed</a>.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> A reference should be added for <a rel="nofollow" class="external text" href="https://docs.kernel.org/filesystems/fscrypt.html#access-semantics">access semantics</a> (multi-user system ACLs, limitation of encrypted directory backup and ext4 fallback to data-ordered-mode). (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Fscrypt.html">Talk:Fscrypt</a>)</div>
</div>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Alternatives_to_consider">Alternatives to consider</h2></div>
<p>To protect an entire file system with one password, block device encryption with <a href="../en/Dm-crypt.html" title="Dm-crypt">dm-crypt</a> (LUKS) is generally a better option, as it ensures that <b>all</b> files on the file system are encrypted, and also that all file system metadata is encrypted. <i>fscrypt</i> is most useful to encrypt specific directories, or to enable different encrypted directories to be unlockable independentlyâ€”for example, per-user encrypted home directories.
</p>
<p>Compared to <a href="../en/ECryptfs.html" title="ECryptfs">eCryptfs</a>, the Linux native file encryption controlled by <i>fscrypt</i> does not use file system stacking, which makes it more memory-efficient. It also uses more up-to-date cryptography and does not require root privileges to set up, which avoids the need for setuid binaries. eCryptfs is also no longer being actively developed, and its largest users (Ubuntu and Chrome OS) have migrated to other solutions.
</p>
<p>See <a href="../en/Data-at-rest_encryption.html" title="Data-at-rest encryption">data-at-rest encryption</a> for more information about other encryption solutions, and about what encryption does and does not do.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> 
<ul>
<li>It is possible to use <i>fscrypt</i> in combination with <a href="../en/Dm-crypt.html" title="Dm-crypt">dm-crypt</a>, with each encryption layer serving a different purpose. For example, the file system itself could be protected by dm-crypt using a less secure method, like a TPM tied into "secure boot" or a password known to all the system's users, while each user's home directory could also be protected by <i>fscrypt</i> using a password known only to that user.</li>
<li>The <i>e4crypt</i> tool from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=e2fsprogs">e2fsprogs</a></span> can be used as an alternative to the <i>fscrypt</i> tool.  However, this is not recommended since <i>e4crypt</i> is missing many basic features and is no longer being actively developed.</li>
<li>
<i>f2fscrypt</i> from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=f2fs-tools">f2fs-tools</a></span> is just a copy of <i>e4crypt</i> and likewise is not recommended.</li>
</ul>
</div>
<div class="mw-heading mw-heading2"><h2 id="Preparations">Preparations</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Kernel">Kernel</h3></div>
<p>All <a href="../en/Kernel.html#Officially_supported_kernels" title="Kernel">officially supported kernels</a> support native file encryption on ext4, F2FS, UBIFS and CephFS.
</p>
<p>Users of custom kernels, make sure <code>CONFIG_FS_ENCRYPTION=y</code> is set.
</p>
<div class="mw-heading mw-heading3"><h3 id="File_system">File system</h3></div>
<div class="mw-heading mw-heading4"><h4 id="ext4">ext4</h4></div>
<p>For <a href="../en/Ext4.html" title="Ext4">ext4</a>, the file system on which encryption is to be used must have the <code>encrypt</code> feature flag enabled. To enable it, run:
</p>
<pre># tune2fs -O encrypt <i>/dev/device</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> When creating a new file system, one can enable the <code>encrypt</code> feature immediately with <code>mkfs.ext4 -O encrypt</code>.</div>
<div class="mw-heading mw-heading4"><h4 id="F2FS">F2FS</h4></div>
<p>For <a href="../en/F2FS.html" title="F2FS">F2FS</a>, use <code>mkfs.f2fs -O encrypt</code> when creating the file system or <code>fsck.f2fs -O encrypt</code> at a later time.
</p>
<div class="mw-heading mw-heading3"><h3 id="Userspace_tool">Userspace tool</h3></div>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fscrypt">fscrypt</a></span> package. Then run:
</p>
<pre># fscrypt setup
</pre>
<p>This creates the file <code>/etc/fscrypt.conf</code> and the directory <code>/.fscrypt</code>.
</p>
<p>Then, if the file system on which encryption is to be used is not the root file system, also run:
</p>
<pre># fscrypt setup <i>mountpoint</i>
</pre>
<p>where <code><i>mountpoint</i></code> is where the file system is mounted, e.g. <code>/home</code>.
</p>
<p>This creates the directory <code><i>mountpoint</i>/.fscrypt</code> to store <i>fscrypt</i> policies and protectors.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> Never delete the <code>.fscrypt</code> directory; otherwise ALL access to encrypted files will be lost!</div>
<div class="mw-heading mw-heading3"><h3 id="PAM_module">PAM module</h3></div>
<p>To unlock login passphrase-protected directories automatically at login, and to keep login passphrase-protected directories in sync with changes to the login passphrase, adjust the system <a href="../en/PAM.html" title="PAM">PAM</a> configuration to enable <i>pam_fscrypt</i>.
</p>
<p><a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">Append</a> the following line to the <i>auth</i> section in <code>/etc/pam.d/system-login</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/system-login</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">auth       optional   pam_fscrypt.so
</pre>
<p>Insert the following lines <b>before</b> <code>session include system-auth</code> in the <i>session</i> section:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/system-login</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">session    [success=1 default=ignore]  pam_succeed_if.so  service = systemd-user quiet 
session    optional                    pam_fscrypt.so</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> The first line, taken from <a rel="nofollow" class="external text" href="https://github.com/google/fscrypt/issues/95#issuecomment-377389231">https://github.com/google/fscrypt/issues/95</a>, is a bypass for the <code>systemd --user</code> session which <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/8598">does not properly close its PAM session</a> and would otherwise block the locking on logout.</div>
<p>Finally, <a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">append</a> the following line to <code>/etc/pam.d/passwd</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/passwd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">password    optional    pam_fscrypt.so
</pre>
<div class="mw-heading mw-heading2"><h2 id="Encrypt_a_directory">Encrypt a directory</h2></div>
<p>To encrypt an empty directory, run:
</p>
<pre>$ fscrypt encrypt <i>dir</i>
</pre>
<p>Follow the prompts to create or choose a "protector". A protector is the secret or information that protects the directory's encryption key. The types of protectors include:
</p>
<ul>
<li>"custom_passphrase". This is exactly what it sounds like, a user defined passphrase.</li>
<li>"pam_passphrase". This is the login passphrase for a particular user. Directories using this type of protector will be automatically unlocked by <i>pam_fscrypt</i> (if enabled) when that user logs in. Be sure to follow the <a rel="nofollow" class="external text" href="https://github.com/google/fscrypt#securing-your-login-passphrase">security recommendations</a> before using this type of protector.</li>
</ul>
<p>In both cases, the passphrase can be changed later, or the directory can be re-protected with another method.
</p>
<p>Example for custom passphrase:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ fscrypt encrypt private/</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Should we create a new protector? [y/N] y
Your data can be protected with one of the following sources:
1 - Your login passphrase (pam_passphrase)
2 - A custom passphrase (custom_passphrase)
3 - A raw 256-bit key (raw_key)
Enter the source number for the new protector [2 - custom_passphrase]: 2
Enter a name for the new protector: Super Secret
Enter custom passphrase for protector "Super Secret":
Confirm passphrase:
"private/" is now encrypted, unlocked, and ready for use.
</pre>
<p>Example for PAM passphrase:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ fscrypt encrypt private/</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Should we create a new protector? [y/N] y
Your data can be protected with one of the following sources:
1 - Your login passphrase (pam_passphrase)
2 - A custom passphrase (custom_passphrase)
3 - A raw 256-bit key (raw_key)
Enter the source number for the new protector [2 - custom_passphrase]: 1
Enter login passphrase for testuser:
"private/" is now encrypted, unlocked, and ready for use.
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Encryption can only be enabled on an empty directory. To encrypt an existing directory, first copy the contents elsewhere and then delete the original files, e.g.:
<pre>$ mkdir <i>new_dir</i>
$ fscrypt encrypt <i>new_dir</i>
$ cp -a -T <i>old_dir</i> <i>new_dir</i>
$ find <i>old_dir</i> -type f -print0 | xargs -0 shred -n1 --remove=unlink
$ rm -rf <i>old_dir</i>
</pre>
Beware of moving files (command <i>mv</i>), instead of copying, because the unencrypted files will be easily recoverable. In some cases they may even be forensically recoverable from disk after being shredded and deleted, especially if using an SSD. It is better to encrypt data from the start.</div>
<div class="mw-heading mw-heading2"><h2 id="Lock/unlock_a_directory">
<span id="Lock.2Funlock_a_directory"></span>Lock/unlock a directory</h2></div>
<p>To unlock an encrypted directory, run:
</p>
<pre>$ fscrypt unlock <i>dir</i>
</pre>
<p><i>fscrypt</i> will prompt for the passphrase.
</p>
<p>To lock an encrypted directory, run:
</p>
<pre>$ fscrypt lock <i>dir</i>
</pre>
<div class="mw-heading mw-heading2"><h2 id="Encrypt_a_home_directory">Encrypt a home directory</h2></div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> 
<ul>
<li>Login protectors are only as secure as the system's passphrase hashing in <code>/etc/shadow</code>. Before using a login protector, be sure to follow the <a rel="nofollow" class="external text" href="https://github.com/google/fscrypt#securing-your-login-passphrase">security recommendations</a>.</li>
<li>If a user's home directory is encrypted, <a href="../en/Secure_Shell.html" class="mw-redirect" title="SSH">SSH</a> for that user may not work until their home directory has been unlocked.</li>
</ul>
</div>
<p>To encrypt a user's home directory, first ensure that all <a href="#Preparations">preparations</a> have been completed, including enabling <i>pam_fscrypt</i>.
</p>
<p>Then, create a new encrypted directory for the user:
</p>
<pre># mkdir /home/newhome
# chown <i>user</i>:<i>user</i> /home/newhome 
# fscrypt encrypt /home/newhome --user=<i>user</i>
</pre>
<p>Select the option to protect the directory with the user's login passphrase.
</p>
<p>Then copy the contents of the user's old home directory into the encrypted directory:
</p>
<pre># cp -a -T /home/<i>user</i> /home/newhome
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> If there is not enough disk space for a second copy of the home directory, consider using <code>mv -T /home/<i>user</i> /home/newhome</code> instead.  However, this is unsafe.  Making a <a href="../en/System_maintenance.html#Backup" class="mw-redirect" title="Backup">backup</a> first is strongly recommended.</div>
<p>If the <i>cp</i> method was used, check whether the directory is being automatically unlocked on login before actually switching to using it. The simplest way to do this is to reboot and log in as that user. Afterwards, run:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ fscrypt status /home/newhome</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">"/home/newhome" is encrypted with fscrypt.

Policy:   d80f252996aae181204403043b0ada25
Options:  padding:32 contents:AES_256_XTS filenames:AES_256_CTS policy_version:2
Unlocked: Yes

Protected with 1 protector:
PROTECTOR         LINKED  DESCRIPTION
5952c84ebaf0f98d  No      login protector for testuser</pre>
<p>If it says <code>Unlocked: No</code> instead, then something is wrong with the PAM configuration, or the incorrect type of protector was selected.
</p>
<p>Otherwise, replace the home directory:
</p>
<pre># mv /home/<i>user</i> /home/oldhome
# mv /home/newhome /home/<i>user</i>
# reboot
</pre>
<p>If everything is working as expected, delete the old home directory:
</p>
<pre># find /home/oldhome -type f -print0 | xargs -0 shred -n1 --remove=unlink
# rm -rf /home/oldhome
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> Running <a href="../en/Securely_wipe_disk.html#shred" class="mw-redirect" title="Shred">shred</a> is optional, but strongly recommended.</div>
<div class="mw-heading mw-heading2"><h2 id="Encryption_within_Linux_Containers_(lxc)">
<span id="Encryption_within_Linux_Containers_.28lxc.29"></span>Encryption within Linux Containers (lxc)</h2></div>
<p>Support to use <i>fscrypt</i> inside <a href="../en/Linux_Containers.html" title="Linux Containers">Linux Containers</a> (lxc), or more generally in <span class="plainlinks archwiki-template-man" title="$ man 7 mount_namespaces"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mount_namespaces.7">mount_namespaces(7)</a></span> where the file system's root directory is not visible has been added in v0.2.8.
</p>
<div class="mw-heading mw-heading3"><h3 id="Lock_directory_when_container_is_stopped">Lock directory when container is stopped</h3></div>
<p>A <a href="../en/Systemd/User.html" title="Systemd/User">systemd/User</a> unit within the container can lock an encrypted directory when the container is stopped:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/lock-directory.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=lock encrypted directory on shutdown
DefaultDependencies=no
Before=shutdown.target

[Service]
Type=oneshot
ExecStart=/bin/sh -c "/usr/bin/fscrypt lock /home/facade/target"
TimeoutStartSec=0

[Install]
WantedBy=shutdown.target</pre>
<div class="mw-heading mw-heading2"><h2 id="Troubleshooting">Troubleshooting</h2></div>
<p>See <a rel="nofollow" class="external free" href="https://github.com/google/fscrypt/blob/master/README.md#troubleshooting">https://github.com/google/fscrypt/blob/master/README.md#troubleshooting</a> for solutions to some common problems and also the <a rel="nofollow" class="external text" href="https://github.com/google/fscrypt/issues">open issues on Github</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="ext4:_Encrypted_files_outside_fscrypt_encrypted_directory">ext4: Encrypted files outside fscrypt encrypted directory</h3></div>
<p>Encrypted regular files from an unlocked fscrypt can be moved into an unencrypted directory. While possible, it is not well supported, normally not desired and could led to later issues: It may not be noticed by the user, unless the according protector is locked or worse: deleted. <a rel="nofollow" class="external free" href="https://github.com/google/fscrypt/issues/393">https://github.com/google/fscrypt/issues/393</a>
</p>
<p>If you want to decrypt files permanently, copy them from the unlocked fscrypt directory into a regular unencrypted directory.<a rel="nofollow" class="external autonumber" href="https://github.com/google/fscrypt/issues/393#issuecomment-1843936402">[1]</a>
</p>
<div class="mw-heading mw-heading2"><h2 id="See_also">See also</h2></div>
<ul>
<li><a rel="nofollow" class="external text" href="https://github.com/google/fscrypt/blob/master/README.md">Documentation for the fscrypt tool</a></li>
<li><a rel="nofollow" class="external text" href="https://docs.kernel.org/filesystems/fscrypt.html">Documentation for Linux native file encryption</a></li>
<li><a rel="nofollow" class="external text" href="https://docs.google.com/document/d/1GBbuCMe-wLuXosVI87cv8CuRkqwncpnNdXAJDECP-6w">The design document for the fscrypt tool</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Data-at-rest_encryption.html" title="Category:Data-at-rest encryption">Data-at-rest encryption</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Fscrypt&amp;oldid=819903">https://wiki.archlinux.org/index.php?title=Fscrypt&amp;oldid=819903</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 30 October 2024, at 18:07.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container no-font-mode-scale">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue  vector-search-box-show-thumbnail vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search cdx-typeahead-search--show-thumbnail">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input mw-searchInput" autocomplete="off" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true">fscrypt</div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only reading-lists-bookmark" id="ca-bookmark-sticky-header" tabindex="-1" data-event-name="watch-sticky-bookmark"><span class="vector-icon mw-ui-icon-wikimedia-bookmarkOutline mw-ui-icon-wikimedia-wikimedia-bookmarkOutline"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
