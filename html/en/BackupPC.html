<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>BackupPC - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-BackupPC rootpage-BackupPC skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
			<button aria-controls="toc-Installation-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Installation subsection</span>
			</button>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
			<li id="toc-Placing_data_directories_on_a_separate_partition" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Placing_data_directories_on_a_separate_partition">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Placing data directories on a separate partition</div>
			</a>
			
			<ul id="toc-Placing_data_directories_on_a_separate_partition-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Apache_configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Apache_configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Apache configuration</div>
		</a>
		
			<button aria-controls="toc-Apache_configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Apache configuration subsection</span>
			</button>
		
		<ul id="toc-Apache_configuration-sublist" class="vector-toc-list">
			<li id="toc-Edit_Apache_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Edit_Apache_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Edit Apache configuration</div>
			</a>
			
			<ul id="toc-Edit_Apache_configuration-sublist" class="vector-toc-list">
				<li id="toc-General_settings" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#General_settings">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.1</span>General settings</div>
			</a>
			
			<ul id="toc-General_settings-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Single-purpose_Apache_settings" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Single-purpose_Apache_settings">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.2</span>Single-purpose Apache settings</div>
			</a>
			
			<ul id="toc-Single-purpose_Apache_settings-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Multi-purpose_Apache_settings" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Multi-purpose_Apache_settings">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.3</span>Multi-purpose Apache settings</div>
			</a>
			
			<ul id="toc-Multi-purpose_Apache_settings-sublist" class="vector-toc-list">
				<li id="toc-The_webserver_user_and_the_suid_problem" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#The_webserver_user_and_the_suid_problem">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.3.1</span>The webserver user and the suid problem</div>
			</a>
			
			<ul id="toc-The_webserver_user_and_the_suid_problem-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Alternative_nginx_configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Alternative_nginx_configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Alternative nginx configuration</div>
		</a>
		
		<ul id="toc-Alternative_nginx_configuration-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Alternative_lighttpd_configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Alternative_lighttpd_configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Alternative lighttpd configuration</div>
		</a>
		
		<ul id="toc-Alternative_lighttpd_configuration-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Accessing_the_admin_page" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Accessing_the_admin_page">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Accessing the admin page</div>
		</a>
		
		<ul id="toc-Accessing_the_admin_page-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Website_view_problem" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Website_view_problem">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Website view problem</div>
		</a>
		
		<ul id="toc-Website_view_problem-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">BackupPC</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/BackupPC" title="BackupPC – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><a rel="nofollow" class="external text" href="https://backuppc.github.io/backuppc/">BackupPC</a> is a high-performance, enterprise-grade system for backing up Unix, Linux, WinXX, and MacOSX PCs, desktops and laptops to a server's disk. BackupPC is highly configurable and easy to install and maintain.
</p>
<p>Given the ever decreasing cost of disks and raid systems, it is now practical and cost effective to backup a large number of machines onto a server's local disk or network storage. For some sites this might be the complete backup solution. For other sites additional permanent archives could be created by periodically backing up the server to tape.
</p>
<p>Note that BackupPC only provides file-based backups and restores. In particular, it is not suitable out-of-the-box for "hot" database backups (although pre-backup hooks can be used to dump databases and do "cold" backups); you will need tools like <a href="../en/Xtrabackup.html" title="Xtrabackup">xtrabackup</a> for that purpose. Also, BackupPC only offers limited handling of opened files.  Make sure to read about the <a rel="nofollow" class="external text" href="https://backuppc.sourceforge.net/faq/limitations.html">limitations of BackupPC</a> and test a backup-and-restore cycle before you actually need to resort to it for real.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=backuppc">backuppc</a></span>.
Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=rsync">rsync</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=perl-file-rsyncp">perl-file-rsyncp</a></span> if you want to use <a href="../en/Rsync.html" title="Rsync">rsync</a> as a transport, and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=rrdtool">rrdtool</a></span> to display usage data in the CGI interface.
</p>
<p>Then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">start/enable</a> <code>backuppc.service</code>.
</p>
<h3><span class="mw-headline" id="Placing_data_directories_on_a_separate_partition">Placing data directories on a separate partition</span></h3>
<p>The BackupPC pool is stored by default under <code>/var/lib/backuppc</code>, which also serves as the home directory for the backuppc user.
This path can be changed via the <code>$Conf{TopDir}</code> entry in <code>/etc/backuppc/config.pl</code>.
Typical reasons are that you keep your system on a fast, but expensive and small, <a href="../en/Solid_state_drive.html" class="mw-redirect" title="SSD">SSD</a> and need to store the backups on a traditional hard disk, or that you want to keep the backup pool on a partition managed by an <a href="../en/LVM.html" title="LVM">LVM</a> to be able to resize to partition according to changing demands.
</p>
<p>The documentation suggests to not change the <code>$Conf{TopDir}</code> entry, but instead use symlinks.  However, be careful when doing so because package upgrades for backuppc will replace symlinks for both <code>/var/lib/backuppc</code> or any of the default subdirectories <code>cpool</code>, <code>pc</code> or <code>pool</code> by empty directories <b>without any warning</b>.
</p>
<p>Thus, it is recommended to either use bind mounts in <a href="../en/Fstab.html" title="Fstab">fstab</a> instead of symlinks, or to deliberately ignore the recommendation in <code>/etc/backuppc/config.pl</code> and change <code>$Conf{TopDir}</code> nevertheless. Alternatively, use <a href="../en/Pacman.html" title="Pacman">pacman</a>'s pre- and post-<a href="../en/Pacman.html#Hooks" title="Pacman">transaction hooks</a> such as the following (remember to make the shell scripts <a href="../en/Help:Reading.html#Make_executable" class="mw-redirect" title="Executable">executable</a>):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/backuppc-restore-symlinks-post.hook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Trigger]
Operation = Upgrade
Type = Package
Target = backuppc

[Action]
Description = Restore symlinks for BackupPC pool directories
When = PostTransaction
Exec = /etc/pacman.d/hooks/backuppc-restore-symlinks-post.sh</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/backuppc-restore-symlinks-post.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/bash

if [ ! -d /tmp/backuppc-symlinks-cache ]; then
    exit 0
fi

if [ -L /tmp/backuppc-symlinks-cache/backuppc ]; then
    rmdir /var/lib/backuppc/{cpool,pc,pool,}
    mv /tmp/backuppc-symlinks-cache/backuppc /var/lib/
    echo "==&gt; Restored /var/lib/backuppc =&gt; $(readlink /var/lib/backuppc)"
fi

for dir in cpool pc pool; do
    if [ -L /tmp/backuppc-symlinks-cache/$dir ]; then
        rmdir /var/lib/backuppc/$dir
        mv /tmp/backuppc-symlinks-cache/$dir /var/lib/backuppc/
        echo "==&gt; Restored /var/lib/backuppc/${dir} =&gt; $(readlink /var/lib/backuppc/$dir)"
    fi
done

if [ -f /tmp/backuppc-symlinks-cache/was-running ]; then
    echo '==&gt; BackupPC service was stopped for upgrade.'
    echo '==&gt; Check the configuration and run `systemctl start backuppc.service` to restart the service.'
    rm -f /tmp/backuppc-symlinks-cache/was-running
fi

rmdir --ignore-fail-on-non-empty /tmp/backuppc-symlinks-cache &amp;&gt;/dev/null</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/backuppc-restore-symlinks-pre.hook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Trigger]
Operation = Upgrade
Type = Package
Target = backuppc

[Action]
Description = Stash symlinks for BackupPC pool directories
When = PreTransaction
Exec = /etc/pacman.d/hooks/backuppc-restore-symlinks-pre.sh</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/backuppc-restore-symlinks-pre.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/bash

if systemctl is-active backuppc.service &amp;&gt;/dev/null; then
    systemctl stop backuppc.service
    mkdir -p /tmp/backuppc-symlinks-cache
    touch /tmp/backuppc-symlinks-cache/was-running
fi

for dir in /var/lib/backuppc/{cpool,pc,pool,}; do
    if [ -L $dir ]; then
        mkdir -p /tmp/backuppc-symlinks-cache
        mv $dir /tmp/backuppc-symlinks-cache
    fi
done</pre>
<h2><span class="mw-headline" id="Apache_configuration">Apache configuration</span></h2>
<p>BackupPC has a web interface that allows you to easily control it. You can access it using Apache and mod_perl or a C wrapper but other webservers like <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lighttpd">lighttpd</a></span> works too. <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=apache">apache</a></span>.
</p>
<h3><span class="mw-headline" id="Edit_Apache_configuration">Edit Apache configuration</span></h3>
<p>BackupPC's web UI needs to run as the user backuppc, but Apache normally runs under the user http. There are several ways to fix this. The two demonstrated here are common for single-purpose servers (Apache is only used to serve the BackupPC UI) or for multi-purpose servers (Apache may also server other websites under the regular http user).
</p>
<p>Setting up Apache for single-purpose use is a bit easier but not as flexible.
</p>
<h4><span class="mw-headline" id="General_settings">General settings</span></h4>
<p>Edit <code>/etc/backuppc/config.pl</code>. Set administrator name:
</p>
<pre>$Conf{CgiAdminUsers} = 'admin'; 
</pre>
<p>Next, we need to add a users file and set the admin password:
</p>
<pre># htpasswd -c /etc/backuppc/backuppc.users admin
</pre>
<p>The BackupPC-Webfrontend is initially configured so that you can only access it from the localhost. If you want to access it from all machines in your network, you have to edit <code>/etc/httpd/conf/extra/backuppc.conf</code>. Edit the line:
</p>
<pre>Require ip 127.0.0.1
</pre>
<p>to:
</p>
<pre>Require ip 127.0.0.1 192.168.0
</pre>
<p>where you have to replace 192.168.0 to your corresponding IP-Adresses you want to gain access from.
After one of the configuration steps below has also been performed, [re]start the Apache service.
</p>
<h4><span class="mw-headline" id="Single-purpose_Apache_settings">Single-purpose Apache settings</span></h4>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mod_perl/">mod_perl</a></span><sup><small>AUR</small></sup>.
</p>
<p>Edit the Apache configuration file to load mod_perl, tell Apache to run as user backuppc and to include <code>/etc/httpd/conf/extra/backuppc.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/httpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">LoadModule perl_module modules/mod_perl.so
User backuppc
Group backuppc
Include conf/extra/backuppc.conf
</pre>
<h4><span class="mw-headline" id="Multi-purpose_Apache_settings">Multi-purpose Apache settings</span></h4>
<p>Instead of globally changing the Apache user and group like in the example above, we will instead make Apache run just the BackupPC CGI script as the backuppc user and leave the default user alone. This method uses mod_cgi to call a wrapper written in C instead of using the extra mod_perl dependency. You still need to have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=perl">perl</a></span> itself installed so the wrapper can run the BackupPC scripts.
</p>
<p>Make sure Apache can run CGI programs (the line loading mod_cgi is not commented) and that it reads the BackupPC configuration by including it in <code>/etc/httpd/conf/extra/backuppc.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/httpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">LoadModule cgi_module modules/mod_cgi.so
Include conf/extra/backuppc.conf
</pre>
<h5><span class="mw-headline" id="The_webserver_user_and_the_suid_problem">The webserver user and the suid problem</span></h5>
<p>The current setup of BackupPC, the webserver needs to run as backuppc user and this can be a problem on many setups where the webserver is used for other sites. In the past one could suid a Perl script, but it was blocked globally due security problems several years ago. To workaround that, perl-suid was used, but again blocked due the same problem  more recently, scripts cannot be run securely with suid bit. Still there is another way, this time using a simple binary program that is suid as a launcher, that will run the backuppc Perl scripts already with the correct user. This isolates the Perl script from the environment and it is considered safe.
</p>
<p>You need to replace the original backuppc CGI  with the below C code compiled program and move the backuppc CGI to another place.
</p>
<p>Move the real CGI <code>/usr/share/backuppc/cgi-bin/BackupPC_Admin</code> to the lib directory <code>/usr/share/backuppc/lib/real-BackupPC_Admin.cgi</code>.
</p>
<p>Save the C code below to a file named <i>wrapper.c</i> (please update the CGI path if needed) and compile it with:
</p>
<pre>$ gcc -o BackupPC_Admin wrapper.c
</pre>
<p>The wrapper C code:
</p>
<pre>#include &lt;unistd.h&gt;
#define REAL_PATH "/usr/share/backuppc/lib/real-BackupPC_Admin.cgi"
int main(ac, av)
char **av;
{
   execv(REAL_PATH, av);
   return 0;
}
</pre>
<p>Place the new binary <code>BackupPC_Admin</code> in the cgi-bin directory and chown the binary CGI to <code>backuppc:http</code> and set the suid bit:
</p>
<pre># chown backuppc:http /usr/share/backuppc/cgi-bin/BackupPC_Admin
# chmod 4750 /usr/share/backuppc/cgi-bin/BackupPC_Admin
</pre>
<p>Do not forget to clear the suid bit on the original Perl script if it was set (or the CGI page will not load):
</p>
<pre># chmod 0755 /usr/share/backuppc/lib/real-BackupPC_Admin.cgi
</pre>
<p>Keep your web server with its usual user and backup should now be able to run correctly.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Keep in mind that the fix described in this section will be overwritten at every package upgrade, resulting in the BackupPC_Admin page displaying a message similar to <i>Error: Wrong user: my userid is 33, instead of 126(backuppc)</i>. You will have to reapply the whole modification  manually again to fix it.</div>
<h2><span class="mw-headline" id="Alternative_nginx_configuration">Alternative nginx configuration</span></h2>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nginx-mainline">nginx-mainline</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fcgiwrap">fcgiwrap</a></span>.
</p>
<p>Create those two directories :
</p>
<pre># mkdir /etc/nginx/sites-available
# mkdir /etc/nginx/sites-enabled
</pre>
<p>Edit nginx configuration file to include the configuration files from <code>sites-enabled</code>, by adding this at the end of the http block :
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nginx/nginx.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">http {
    ...
    include sites-enabled/*;
}
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nginx/sites-available/backuppc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server {
    listen &lt;your_server_port&gt;;
    server_name &lt;your_server_name&gt;;

    root  /usr/share/backuppc/html;
    index /index.cgi;

    access_log  /var/log/nginx/backuppc.access.log;
    error_log   /var/log/nginx/backuppc.error.log;

    location / {
        allow 127.0.0.1/32;
        # allow 192.168.0.0/24;
        deny all;

        # auth_basic "Backup";
        # auth_basic_user_file conf/backuppc.users;

        location /backuppc {
            alias /usr/share/backuppc/html;
        }

        location ~ \.cgi$ {
            include fastcgi_params;
            fastcgi_pass unix:/run/fcgiwrap.sock;

            fastcgi_param REMOTE_ADDR     $remote_addr;
            fastcgi_param REMOTE_USER     $remote_user;
            fastcgi_param SCRIPT_FILENAME /usr/share/backuppc/cgi-bin/BackupPC_Admin;
        }
    }
}
</pre>
<p>And symlink to sites-enabled:
</p>
<pre># ln -s /etc/nginx/sites-available/backuppc /etc/nginx/sites-enabled
</pre>
<p><a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">Edit</a> the executing user in <code>fcgiwrap.service</code> file to <code>backuppc</code>.
</p>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable/start">Enable/start</a> <code>nginx.service</code> and <code>fcgiwrap.socket</code>.
</p>
<p>If you want to use basic authentication, uncomment the corresponding lines above and create the file <code>/etc/nginx/conf/backuppc.users</code> containing all allowed users :
</p>
<pre># echo -n 'myuser:' &gt;&gt; /etc/nginx/conf/backuppc.users
# openssl passwd -apr1 &gt;&gt; /etc/nginx/conf/backuppc.users
</pre>
<p>Follow <a href="../en/Certbot.html#Nginx" title="Certbot">Certbot#Nginx</a> to create a Let's Encrypt certificate and configure a TLS certificate.
</p>
<h2><span class="mw-headline" id="Alternative_lighttpd_configuration">Alternative lighttpd configuration</span></h2>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/lighttpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> server.port             = 81
 server.username         = "backuppc"
 server.groupname        = "backuppc"
 server.document-root    = "/srv/http"
 server.errorlog         = "/var/log/lighttpd/error.log"
 dir-listing.activate    = "enable"
 index-file.names        = ( "index.html", "index.php", "index.cgi" )
 mimetype.assign         = ( ".html" =&gt; "text/html", ".txt" =&gt; "text/plain", ".jpg" =&gt; "image/jpeg", ".png" =&gt; "image/png", "" =&gt; "application/octet-stream" )
 
 server.modules = ("mod_alias", "mod_cgi", "mod_auth", "mod_access" )
 
 alias.url               = ( "/BackupPC_Admin" =&gt; "/usr/share/backuppc/cgi-bin/BackupPC_Admin" )
 alias.url               += ( "/backuppc" =&gt; "/usr/share/backuppc/html" )
 
 cgi.assign              += ( ".cgi" =&gt; "/usr/bin/perl" )
 cgi.assign              += ( "BackupPC_Admin" =&gt; "/usr/bin/perl" )
 
 auth.backend = "plain"
 auth.backend.plain.userfile = "/etc/lighttpd/passwd"
 auth.require = ( "/BackupPC_Admin" =&gt; ( "method" =&gt; "basic", "realm" =&gt; "BackupPC", "require" =&gt; "user=admin" ) )
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/lighttpd/passwd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> admin:<i>yourpassword</i>
</pre>
<p>And create log file:
</p>
<pre># touch /var/log/lighttpd/error.log
# chown backuppc:backuppc /var/log/lighttpd/error.log
</pre>
<h2><span class="mw-headline" id="Accessing_the_admin_page">Accessing the admin page</span></h2>
<p>Before accessing the admin page you have to specify which users/groups will be able to edit BackupPC's configuration.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/backuppc/config.pl</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">$Conf{CgiAdminUserGroup} = '&lt;authorized groups&gt;';
$Conf{CgiAdminUsers}     = '&lt;authorized users&gt;';  # &lt;-- set to '*' if the webserver is not autenticating users
</pre>
<p>Browse to <a rel="nofollow" class="external free" href="http://localhost/BackupPC_Admin">http://localhost/BackupPC_Admin</a> respectively http://<i>your_backuppc_server_ip</i>/BackupPC_Admin.
</p>
<h2><span class="mw-headline" id="Website_view_problem">Website view problem</span></h2>
<p>Due an Apache directive, the web interface may not shown properly. If that is your case, just modify the line in your <code>/etc/httpd/conf/httpd.conf</code> that avoids .htaccess and .htpasswd from viewed for clients or change directory name /usr/share/backuppc/html for /usr/share/backuppc/files and update <code>/etc/httpd/conf/extra/backuppc.conf</code> with the new path, as it follows:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/extra/backuppc.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Alias           /BackupPC/images        /usr/share/BackupPC/files/
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://backuppc.sourceforge.net/index.html">BackupPC Home page</a></li>
<li><a rel="nofollow" class="external text" href="https://backuppc.sourceforge.net/faq/BackupPC.html">BackupPC documentation</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Backup.html" title="Category:Backup">Backup</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=BackupPC&amp;oldid=756619">https://wiki.archlinux.org/index.php?title=BackupPC&amp;oldid=756619</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 11 November 2022, at 18:52.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
