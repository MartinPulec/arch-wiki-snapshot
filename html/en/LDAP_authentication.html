<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-zebra-design-disabled vector-feature-custom-font-size-clientpref-disabled vector-feature-client-preferences-disabled vector-feature-typography-survey-disabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>LDAP authentication - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.41.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-LDAP_authentication rootpage-LDAP_authentication skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-main-menu-container">
		</div>
	<input type="checkbox" id="vector-toc-collapsed-checkbox" class="vector-menu-checkbox">
			<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark vector-sticky-pinned-container">
				<div id="vector-toc-pinned-container" class="vector-pinned-container">
				<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-LDAP_server_setup" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#LDAP_server_setup">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>LDAP server setup</div>
		</a>
		
			<button aria-controls="toc-LDAP_server_setup-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle LDAP server setup subsection</span>
			</button>
		
		<ul id="toc-LDAP_server_setup-sublist" class="vector-toc-list">
			<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Installation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Installation</div>
			</a>
			
			<ul id="toc-Installation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Set_up_access_controls" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Set_up_access_controls">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Set up access controls</div>
			</a>
			
			<ul id="toc-Set_up_access_controls-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Populate_LDAP_tree_with_base_data" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Populate_LDAP_tree_with_base_data">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Populate LDAP tree with base data</div>
			</a>
			
			<ul id="toc-Populate_LDAP_tree_with_base_data-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Adding_users" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Adding_users">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.4</span>Adding users</div>
			</a>
			
			<ul id="toc-Adding_users-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Client_setup" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Client_setup">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Client setup</div>
		</a>
		
			<button aria-controls="toc-Client_setup-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Client setup subsection</span>
			</button>
		
		<ul id="toc-Client_setup-sublist" class="vector-toc-list">
			<li id="toc-Online_authentication" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Online_authentication">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Online authentication</div>
			</a>
			
			<ul id="toc-Online_authentication-sublist" class="vector-toc-list">
				<li id="toc-NSS_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#NSS_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.1</span>NSS configuration</div>
			</a>
			
			<ul id="toc-NSS_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-PAM_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#PAM_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.2</span>PAM configuration</div>
			</a>
			
			<ul id="toc-PAM_configuration-sublist" class="vector-toc-list">
				<li id="toc-Create_home_folders_at_login" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Create_home_folders_at_login">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.2.1</span>Create home folders at login</div>
			</a>
			
			<ul id="toc-Create_home_folders_at_login-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enable_sudo" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Enable_sudo">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.2.2</span>Enable sudo</div>
			</a>
			
			<ul id="toc-Enable_sudo-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Online_and_offline_authentication_with_SSSD" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Online_and_offline_authentication_with_SSSD">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Online and offline authentication with SSSD</div>
			</a>
			
			<ul id="toc-Online_and_offline_authentication_with_SSSD-sublist" class="vector-toc-list">
				<li id="toc-SSSD_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#SSSD_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.1</span>SSSD configuration</div>
			</a>
			
			<ul id="toc-SSSD_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-NSCD_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#NSCD_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.2</span>NSCD configuration</div>
			</a>
			
			<ul id="toc-NSCD_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-NSS_configuration_2" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#NSS_configuration_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.3</span>NSS configuration</div>
			</a>
			
			<ul id="toc-NSS_configuration_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-PAM_configuration_2" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#PAM_configuration_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.4</span>PAM configuration</div>
			</a>
			
			<ul id="toc-PAM_configuration_2-sublist" class="vector-toc-list">
				<li id="toc-Enable_sudo_2" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Enable_sudo_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.4.1</span>Enable sudo</div>
			</a>
			
			<ul id="toc-Enable_sudo_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Password_management" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Password_management">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.4.2</span>Password management</div>
			</a>
			
			<ul id="toc-Password_management-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

				</div>
	</nav>
		
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<label id="vector-toc-collapsed-button" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet vector-button-flush-left cdx-button--icon-only" for="vector-toc-collapsed-checkbox" role="button" aria-controls="vector-toc" tabindex="0" title="Table of Contents">
						<span class="vector-icon mw-ui-icon-wikimedia-listBullet"></span>
						<span>Toggle the table of contents</span>
					</label>
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">LDAP authentication</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/LDAP_%E8%AA%8D%E8%A8%BC" title="LDAP 認証 – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<nav class="vector-page-tools-landmark vector-sticky-pinned-container" aria-label="Page tools">
						<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
			
						</div>
	</nav>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/OpenLDAP.html" title="OpenLDAP">OpenLDAP</a></li>
<li><a href="../en/LDAP_Hosts.html" title="LDAP Hosts">LDAP Hosts</a></li>
<li><a href="../en/Identity_management.html" title="Identity management">Identity management</a></li>
</ul>
</div>
<p>This is a guide on how to configure an Arch Linux installation to authenticate against an LDAP directory. This LDAP directory can be either local (installed on the same computer) or network (e.g. in a lab environment where central authentication is desired).
</p>
<p>The guide is divided into two parts. The first part deals with how to setup an <a href="../en/OpenLDAP.html" title="OpenLDAP">OpenLDAP</a> server that hosts the authentication directory. The second part deals with how to setup the NSS and PAM modules that are required for the authentication scheme to work on the client computers. If you just want to configure Arch to authenticate against an already existing LDAP server, you can skip to the <a href="#Client_setup">second part</a>.
</p>
<dl><dt>Terminology</dt></dl>
<p>NSS (which stands for Name Service Switch) is a system mechanism to configure different sources for common configuration databases. For example, <code>/etc/passwd</code> is a <code>file</code> type source for the <code>passwd</code> database.
</p>
<p><a href="../en/PAM.html" title="PAM">PAM</a> (which stands for Pluggable Authentication Modules) is a mechanism used by Linux (and most *nixes) to extend its authentication schemes based on different plugins.
</p>
<p>So to summarize, we need to configure NSS to use the OpenLDAP server as a source for the <code>passwd</code>, <code>shadow</code> and other configuration databases and then configure PAM to use these sources to authenticate its users.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="LDAP_server_setup">LDAP server setup</span></h2>
<h3><span class="mw-headline" id="Installation">Installation</span></h3>
<p><a href="../en/OpenLDAP.html#Installation" title="OpenLDAP">Install the OpenLDAP server</a> and configure the <a href="../en/OpenLDAP.html#The_server" title="OpenLDAP">server</a> and <a href="../en/OpenLDAP.html#The_client" title="OpenLDAP">client</a>. After you have completed that, return here.
</p>
<h3><span class="mw-headline" id="Set_up_access_controls">Set up access controls</span></h3>
<p>To make sure that no-one can read the (encrypted) passwords from the LDAP server, but still allowing users to edit some of their own select attributes (such as own password and photo), create the temporary LDIF <code>allowpwchange.ldif</code>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Alter the domain components "example" and "org" to your needs</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">allowpwchange.ldif</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dn: olcDatabase={1}mdb,cn=config
changetype: modify
replace: olcAccess
olcAccess: {0}to attrs=cn,givenName,sn,userPassword,shadowLastChange,mail,loginShell,photo by self write by anonymous auth by dn.base="cn=Manager,dc=example,dc=org" write by * none
olcAccess: {1}to * by self read by dn.base="cn=Manager,dc=example,dc=org" write by * read</pre>
<p>Import it on database number 0 (cn=config):
</p>
<pre>$ slapmodify -n 0 -l allowpwchange.ldif
</pre>
<p>Then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>slapd.service</code> afterwards.
</p>
<h3><span class="mw-headline" id="Populate_LDAP_tree_with_base_data">Populate LDAP tree with base data</span></h3>
<p>Create a temporary file called <code>base.ldif</code> with the following text.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">base.ldif</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># example.org
dn: dc=example,dc=org
dc: example
o: Example Organization
objectClass: dcObject
objectClass: organization

# Manager, example.org
dn: cn=Manager,dc=example,dc=org
cn: Manager
description: LDAP administrator
objectClass: organizationalRole
objectClass: top
roleOccupant: dc=example,dc=org

# People, example.org
dn: ou=People,dc=example,dc=org
ou: People
objectClass: top
objectClass: organizationalUnit

# Groups, example.org
dn: ou=Group,dc=example,dc=org
ou: Group
objectClass: top
objectClass: organizationalUnit</pre>
<p>Add it to your OpenLDAP tree:
</p>
<pre>$ ldapadd -D "cn=Manager,dc=example,dc=org" -W -f base.ldif
</pre>
<p>Test to make sure the data was imported:
</p>
<pre>$ ldapsearch -x -b 'dc=example,dc=org' '(objectclass=*)'
</pre>
<h3><span class="mw-headline" id="Adding_users">Adding users</span></h3>
<p>To manually add a user, create an <code>.ldif</code> file like this:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">user_joe.ldif</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dn: uid=johndoe,ou=People,dc=example,dc=org
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: shadowAccount
uid: johndoe
cn: John Doe
sn: Doe
givenName: John
title: Guinea Pig
telephoneNumber: +0 000 000 0000
mobile: +0 000 000 0000
postalAddress: AddressLine1$AddressLine2$AddressLine3
userPassword: {CRYPT}xxxxxxxxxx
labeledURI: https://archlinux.org/
loginShell: /bin/bash
uidNumber: 9999
gidNumber: 9999
homeDirectory: /home/johndoe/
description: This is an example user
</pre>
<p>The <code>xxxxxxxxxx</code> in the <code>userPassword</code> entry should be replaced with the value in <code>/etc/shadow</code> or use the <code>slappasswd</code> command. Now add the user:
</p>
<pre>$ ldapadd -D "cn=Manager,dc=example,dc=org" -W -f user_joe.ldif
</pre>
<p>You can add a group similarly with
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">group_joe.ldif</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dn: cn=joe,ou=Group,dc=example,dc=org
objectClass: top
objectClass: posixGroup
cn: joe
gidNumber: 9999</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You can automatically migrate all of your local accounts (and groups, etc.) to the LDAP directory using PADL Software's <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/openldap-migrationtools/">openldap-migrationtools</a></span><sup><small>AUR</small></sup>.</div>
<h2><span class="mw-headline" id="Client_setup">Client setup</span></h2>
<p>Install the OpenLDAP client as described in <a href="../en/OpenLDAP.html" title="OpenLDAP">OpenLDAP</a>. Make sure you can query the server with <code>ldapsearch</code>.
</p>
<p>Depending on your target, choose either <a href="#Online_authentication">online-only</a> or <a href="#Online_and_offline_authentication_with_SSSD">online and offline</a> authentication.
</p>
<h3><span class="mw-headline" id="Online_authentication">Online authentication</span></h3>
<h4><span class="mw-headline" id="NSS_configuration">NSS configuration</span></h4>
<p>NSS is a system facility which manages different sources as configuration databases. For example, <code>/etc/passwd</code> is a <code>file</code> type source for the <code>passwd</code> database, which stores the user accounts.
</p>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nss-pam-ldapd">nss-pam-ldapd</a></span> package.
</p>
<p>Edit <code>/etc/nsswitch.conf</code> which is the central configuration file for NSS. It tells NSS which sources to use for which system databases. We need to add the <code>ldap</code> directive to the <code>passwd</code>, <code>group</code> and <code>shadow</code> databases, so be sure your file looks like this:
</p>
<pre>passwd: files ldap
group: files ldap
shadow: files ldap
</pre>
<p>Edit <code>/etc/nslcd.conf</code> and change the <code>base</code> and <code>uri</code> lines to fit your ldap server setup.
</p>
<p>Edit the <code>binddn</code> and the <code>bindpw</code> if your LDAP server requires a password. Make sure you change the permission of your <code>/etc/nslcd.conf</code> to <code>0600</code> for <code>nslcd</code> to start properly.
</p>
<p>Start <code>nslcd.service</code> using systemd.
</p>
<p>You now should see your LDAP users when running <code>getent passwd</code> on the client.
</p>
<h4><span class="mw-headline" id="PAM_configuration">PAM configuration</span></h4>
<p>The basic rule of thumb for PAM configuration is to include <code>pam_ldap.so</code> wherever <code>pam_unix.so</code> is included. Arch moving to <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pambase">pambase</a></span> has helped decrease the amount of edits required. For more details about configuring pam, the <a rel="nofollow" class="external text" href="https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Managing_Smart_Cards/PAM_Configuration_Files.html">Red Hat Documentation</a> is quite good. You might also want the upstream documentation for <a rel="nofollow" class="external text" href="https://arthurdejong.org/nss-pam-ldapd/">nss-pam-ldapd</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you want to prevent UID clashes with local users on your system, you might want to include <code>minimum_uid=10000</code> or similar on the end of the <code>pam_ldap.so</code> lines. You will have to make sure the LDAP server returns uidNumber fields that match the restriction.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Each facility (auth, session, password, account) forms a separate chain and the order matters. Sufficient lines will sometimes "short circuit" and skip the rest of the section, so the rule of thumb for <i>auth</i>, <i>password</i>, and <i>account</i> is <i>sufficient</i> lines before <i>required</i>, but after required lines for the <i>session</i> section; <i>optional</i> can almost always go at the end. When adding your <code>pam_ldap.so</code> lines, do not change the relative order of the other lines without good reason! Simply insert LDAP within the chain.</div>
<p>First edit <code>/etc/pam.d/system-auth</code>. This file is included in most of the other files in <code>pam.d</code>, so changes here propagate nicely. Updates to <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pambase">pambase</a></span> may change this file.
</p>
<p>Make <code>pam_ldap.so</code> sufficient at the top of each section, except in the <i>session</i> section, where we make it optional.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/system-auth</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"><b>auth      sufficient pam_ldap.so</b>
auth      required  pam_unix.so     try_first_pass nullok
auth      optional  pam_permit.so
auth      required  pam_env.so

<b>account   sufficient pam_ldap.so</b>
account   required  pam_unix.so
account   optional  pam_permit.so
account   required  pam_time.so

<b>password  sufficient pam_ldap.so</b>
password  required  pam_unix.so     try_first_pass nullok sha512 shadow
password  optional  pam_permit.so

session   required  pam_limits.so
session   required  pam_unix.so
<b>session   optional  pam_ldap.so</b>
session   optional  pam_permit.so
</pre>
<p>Then edit both <code>/etc/pam.d/su</code> and <code>/etc/pam.d/su-l</code> identically. The <code>su-l</code> file is used when the user runs <code>su --login</code>.
</p>
<p>Make <code>pam_ldap.so</code> sufficient at the top of each section but below <code>pam_rootok</code>, and add <code>use_first_pass</code> to <code>pam_unix</code> in the <i>auth</i> section.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/su</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#%PAM-1.0
auth      sufficient    pam_rootok.so
<b>auth      sufficient    pam_ldap.so</b>
# Uncomment the following line to implicitly trust users in the "wheel" group.
#auth     sufficient    pam_wheel.so trust use_uid
# Uncomment the following line to require a user to be in the "wheel" group.
#auth     required      pam_wheel.so use_uid
auth      required	pam_unix.so <b>use_first_pass</b>
<b>account   sufficient    pam_ldap.so</b>
account   required	pam_unix.so
<b>session   sufficient    pam_ldap.so</b>
session   required	pam_unix.so
</pre>
<p>To enable users to edit their password, edit <code>/etc/pam.d/passwd</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/passwd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#%PAM-1.0
<b>password        sufficient      pam_ldap.so</b>
password        required        pam_unix.so sha512 shadow nullok</pre>
<h5><span class="mw-headline" id="Create_home_folders_at_login">Create home folders at login</span></h5>
<p>If you want home folders to be created at login (eg: if you are not using NFS to store home folders), edit <code>/etc/pam.d/system-login</code> and add <code>pam_mkhomedir.so</code> to the <i>session</i> section above any "sufficient" items. This will cause home folder creation when logging in at a tty, from ssh, xdm, sddm, gdm, etc. You might choose to edit additional files in the same way, such as <code>/etc/pam.d/su</code> and <code>/etc/pam.d/su-l</code> to enable it for <code>su</code> and <code>su --login</code>. If you do not want to do this for ssh logins, edit <code>system-local-login</code> instead of <code>system-login</code>, etc.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/system-login</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...top of file not shown...
session    optional   pam_loginuid.so
session    include    system-auth
session    optional   pam_motd.so          motd=/etc/motd
session    optional   pam_mail.so          dir=/var/spool/mail standard quiet
-session   optional   pam_systemd.so
session    required   pam_env.so
<b>session    required   pam_mkhomedir.so skel=/etc/skel umask=0077</b></pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/su-l</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...top of file not shown...
<b>session         required        pam_mkhomedir.so skel=/etc/skel umask=0077</b>
session         sufficient      pam_ldap.so
session         required        pam_unix.so</pre>
<h5><span class="mw-headline" id="Enable_sudo">Enable sudo</span></h5>
<p>To enable sudo from an LDAP user, edit <code>/etc/pam.d/sudo</code>. You will also need to modify sudoers accordingly.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/sudo</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#%PAM-1.0
<b>auth      sufficient    pam_ldap.so</b>
auth      required      pam_unix.so  <b>try_first_pass</b>
auth      required      pam_nologin.so
</pre>
<p>You will also need to add in <code>/etc/openldap/ldap.conf</code> the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openldap/ldap.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">sudoers_base ou=sudoers,dc=example,dc=org</pre>
<h3><span class="mw-headline" id="Online_and_offline_authentication_with_SSSD">Online and offline authentication with SSSD</span></h3>
<p>SSSD is a system daemon. Its primary function is to provide access to identity and authentication remote resource through a common framework that can provide caching and offline support to the system. It provides PAM and NSS modules, and in the future will D-BUS based interfaces for extended user information. It provides also a better database to store local users as well as extended user data.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You must configure <a href="../en/OpenLDAP.html#OpenLDAP_over_TLS" title="OpenLDAP">StartTLS</a> for your LDAP server, or SSSD will not work</div>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sssd">sssd</a></span> package.
</p>
<h4><span class="mw-headline" id="SSSD_configuration">SSSD configuration</span></h4>
<p>If it does not exist create <code>/etc/sssd/sssd.conf</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sssd/sssd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[sssd]
config_file_version = 2
services = nss, pam
domains = LDAP

[domain/LDAP]
cache_credentials = true
enumerate = true

id_provider = ldap
auth_provider = ldap

ldap_uri = ldap://server1.example.org, ldap://server2.example.org
ldap_search_base = dc=example,dc=org
ldap_id_use_start_tls = true
ldap_tls_reqcert = demand
ldap_tls_cacert = /etc/openldap/certs/cacerts.pem
chpass_provider = ldap
ldap_chpass_uri = ldap://server1.example.org
entry_cache_timeout = 600
ldap_network_timeout = 2

# OpenLDAP supports posixGroup, uncomment the following two lines
# to get group membership support (and comment the other conflicting parameters)
#ldap_schema = rfc2307
#ldap_group_member = memberUid

# Other LDAP servers may support this instead
ldap_schema = rfc2307bis
ldap_group_member = uniqueMember</pre>
<p>The above is an example only. See <span class="plainlinks archwiki-template-man" title="$ man 5 sssd.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sssd.conf.5">sssd.conf(5)</a></span> for the full details.
</p>
<p>Finally set the file permissions <code>chmod 600 /etc/sssd/sssd.conf</code> otherwise sssd will fail to start.
</p>
<h4><span class="mw-headline" id="NSCD_configuration">NSCD configuration</span></h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> <i>nscd</i> was removed in <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/packaging/packages/glibc/-/commit/25032a8abb2760257c3dceb78e649a0a2c4e3ab2">glibc 2.38-4</a>. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:LDAP_authentication.html">Talk:LDAP authentication</a>)</div>
</div>
<p>Disable caching for passwd, group and netgroup entries in <code>/etc/nscd.conf</code> as it will interfere with sssd caching.
</p>
<p>Keep caching enabled for hosts entries otherwise some services may fail to start.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nscd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Begin /etc/nscd.conf
<i>[...]</i>
enable-cache		passwd		<b>no</b>
<i>[...]</i>
enable-cache		group		<b>no</b>
<i>[...]</i>
enable-cache		hosts		yes
<i>[...]</i>
enable-cache		netgroup	<b>no</b>
<i>[...]</i>
# End /etc/nscd.conf
</pre>
<h4><span class="mw-headline" id="NSS_configuration_2">NSS configuration</span></h4>
<p>Edit <code>/etc/nsswitch.conf</code> as follows:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nsswitch.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Begin /etc/nsswitch.conf

passwd: files <b>sss</b>
group: files <b>sss</b>
shadow: files <b>sss</b>
<b>sudoers: files sss</b>

publickey: files

hosts: files dns myhostname
networks: files

protocols: files
services: files
ethers: files
rpc: files

netgroup: files

# End /etc/nsswitch.conf
</pre>
<h4><span class="mw-headline" id="PAM_configuration_2">PAM configuration</span></h4>
<p>The first step is to edit <code>/etc/pam.d/system-auth</code> as follows:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/system-auth</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#%PAM-1.0

<b>auth sufficient pam_sss.so forward_pass</b>
auth required pam_unix.so try_first_pass nullok
auth optional pam_permit.so
auth required pam_env.so

<b>account [default=bad success=ok user_unknown=ignore authinfo_unavail=ignore] pam_sss.so</b>
account required pam_unix.so
account optional pam_permit.so
account required pam_time.so

<b>password sufficient pam_sss.so</b>
password required pam_unix.so try_first_pass nullok sha512 shadow
password optional pam_permit.so

<b>session     required      pam_mkhomedir.so skel=/etc/skel/ umask=0077</b>
session required pam_limits.so
session required pam_unix.so
<b>session optional pam_sss.so</b>
session optional pam_permit.so</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you happen to use <a href="../en/GNOME/Keyring.html" title="GNOME/Keyring">GNOME/Keyring</a>: adding 'sufficient' in the beginning of the PAM stack results in Gnome Keyring not being unlocked. For a solution, look at <a rel="nofollow" class="external text" href="https://wiki.gnome.org/Projects/GnomeKeyring/Pam#Advanced_configuration">Advanced PAM Configuration</a>.</div>
<p>These PAM changes will apply to fresh login. To also allow the <code>su</code> command to authenticate through SSSD, edit <code>/etc/pam.d/su</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/su</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#%PAM-1.0
auth            sufficient        pam_rootok.so

<b>auth sufficient   pam_sss.so      forward_pass</b>
auth            required        pam_unix.so

<b>account [default=bad success=ok user_unknown=ignore authinfo_unavail=ignore] pam_sss.so</b>
account         required        pam_unix.so

session         required        pam_unix.so
<b>session optional pam_sss.so</b></pre>
<h5><span class="mw-headline" id="Enable_sudo_2">Enable sudo</span></h5>
<p>Edit <code>/etc/pam.d/sudo</code> as follows:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/sudo</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#%PAM-1.0
<b>auth           sufficient      pam_sss.so</b>
auth           required        pam_unix.so try_first_pass
auth           required        pam_nologin.so
</pre>
<p>Also add sudo service to the list of enabled services and the search base in <code>/etc/sssd/sssd.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sssd/sssd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[sssd]
...
services = nss, pam, <b>sudo</b>
...

[domain/LDAP]
...
ldap_sudo_search_base = ou=sudoers,dc=example,dc=org
...</pre>
<p>Alternately, <a href="../en/Sudo.html#Configuration" title="Sudo">configure sudo</a> to allow the desired LDAP users to use <i>sudo</i>.
</p>
<h5><span class="mw-headline" id="Password_management">Password management</span></h5>
<p>For changing expired passwords when logging in using <code>su</code> add a password entry to <code>/etc/pam.d/su</code> if it is missing:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/su</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#%PAM-1.0

[...]

auth        include     system-auth
account     include     system-auth
session     include     system-auth
<b>password    include     system-auth</b></pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">Start/enable</a> <code>sssd.service</code>.
</p>
<p>You should now be able to see details of your ldap users with <code>getent passwd <i>username</i></code> or <code>id <i>username</i></code>.
</p>
<p>Once you have logged in with a user the credentials will be cached and you will be able to login using the cached credentials when the ldap server is offline or unavailable.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://arthurdejong.org/nss-pam-ldapd/setup">The official page of the nss-pam-ldapd packet</a></li>
<li><a href="https://wiki.debian.org/LDAP/NSS" class="extiw" title="debian:LDAP/NSS">Debian Wiki - LDAP/NSS</a></li>
<li><a href="https://wiki.debian.org/LDAP/PAM" class="extiw" title="debian:LDAP/PAM">Debian Wiki - LDAP/PAM</a></li>
<li>
<a rel="nofollow" class="external text" href="https://www.fatofthelan.com/technical/using-ldap-for-single-authentication/">Using LDAP for single authentication</a><sup title="Last check status: domain name not resolved">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2023-10-29 ⓘ]</sup>
</li>
<li><a rel="nofollow" class="external text" href="https://web.archive.org/web/20121027055009/http://www.cs.dixie.edu/ldap/">Heterogeneous Network Authentication Introduction</a></li>
<li><a rel="nofollow" class="external text" href="https://readlist.com/lists/suse.com/suse-linux-e/36/182642.html">Discussion on suse's mailing lists about nss-pam-ldapd</a></li>
<li>
<a rel="nofollow" class="external text" href="https://docs.fedoraproject.org/en-US/Fedora/15/html/Deployment_Guide/chap-SSSD_User_Guide-Introduction.html">Fedora's SSSD User Guide</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2023-04-23 ⓘ]</sup>
</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Networking.html" title="Category:Networking">Networking</a></li>
<li><a href="../en/Category:Authentication.html" title="Category:Authentication">Authentication</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=LDAP_authentication&amp;oldid=791431">https://wiki.archlinux.org/index.php?title=LDAP_authentication&amp;oldid=791431</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 29 October 2023, at 19:17.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
