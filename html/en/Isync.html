<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>isync - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Isync rootpage-Isync skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installing" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installing">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installing</div>
		</a>
		
		<ul id="toc-Installing-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuring" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuring">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Configuring</div>
		</a>
		
		<ul id="toc-Configuring-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Usage" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Usage">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Usage</div>
		</a>
		
		<ul id="toc-Usage-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Tips and tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Using_Path_and/or_Inbox_on_NTFS_partitions" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_Path_and/or_Inbox_on_NTFS_partitions">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Using Path and/or Inbox on NTFS partitions</div>
			</a>
			
			<ul id="toc-Using_Path_and/or_Inbox_on_NTFS_partitions-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Calling_mbsync_automatically" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Calling_mbsync_automatically">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Calling mbsync automatically</div>
			</a>
			
			<ul id="toc-Calling_mbsync_automatically-sublist" class="vector-toc-list">
				<li id="toc-With_a_timer" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#With_a_timer">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.1</span>With a timer</div>
			</a>
			
			<ul id="toc-With_a_timer-sublist" class="vector-toc-list">
				<li id="toc-Integration_with_notmuch_or_mu4e" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Integration_with_notmuch_or_mu4e">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.1.1</span>Integration with notmuch or mu4e</div>
			</a>
			
			<ul id="toc-Integration_with_notmuch_or_mu4e-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-With_imapnotify" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#With_imapnotify">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.2</span>With imapnotify</div>
			</a>
			
			<ul id="toc-With_imapnotify-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Using_XOAUTH2" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_XOAUTH2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Using XOAUTH2</div>
			</a>
			
			<ul id="toc-Using_XOAUTH2-sublist" class="vector-toc-list">
				<li id="toc-oama" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#oama">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3.1</span>oama</div>
			</a>
			
			<ul id="toc-oama-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-oauth2token" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#oauth2token">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3.2</span>oauth2token</div>
			</a>
			
			<ul id="toc-oauth2token-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-mutt_oauth2.py" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#mutt_oauth2.py">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3.3</span>mutt_oauth2.py</div>
			</a>
			
			<ul id="toc-mutt_oauth2.py-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-oauth2ms" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#oauth2ms">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3.4</span>oauth2ms</div>
			</a>
			
			<ul id="toc-oauth2ms-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-SSL_error" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#SSL_error">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>SSL error</div>
			</a>
			
			<ul id="toc-SSL_error-sublist" class="vector-toc-list">
				<li id="toc-Step_#1:_Get_the_certificates" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Step_#1:_Get_the_certificates">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.1</span>Step #1: Get the certificates</div>
			</a>
			
			<ul id="toc-Step_#1:_Get_the_certificates-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Step_#2:_Setup_mbsync" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Step_#2:_Setup_mbsync">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.2</span>Step #2: Setup mbsync</div>
			</a>
			
			<ul id="toc-Step_#2:_Setup_mbsync-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-BAD_Command_with_Exchange_2003" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#BAD_Command_with_Exchange_2003">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>BAD Command with Exchange 2003</div>
			</a>
			
			<ul id="toc-BAD_Command_with_Exchange_2003-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Emails_on_remote_server_have_the_wrong_date" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Emails_on_remote_server_have_the_wrong_date">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Emails on remote server have the wrong date</div>
			</a>
			
			<ul id="toc-Emails_on_remote_server_have_the_wrong_date-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-External_links" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#External_links">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>External links</div>
		</a>
		
		<ul id="toc-External_links-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">isync</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Isync" title="Isync – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><span>
</span>
<a rel="nofollow" class="external text" href="https://isync.sourceforge.net/">isync</a> is a command line application to synchronize mailboxes; it supports Maildir and IMAP4 mailboxes. New messages, message deletions and flag changes can be propagated both ways.
</p>
<p>Synchronization is based on unique message identifiers (UIDs), so no identification conflicts can occur (as opposed to some other mail synchronizers).
Synchronization state is kept in one local text file per mailbox pair; multiple replicas of a mailbox can be maintained.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> isync is the name of the project, mbsync is the name of the executable</div>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installing">Installing</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=isync">isync</a></span> package.
</p>
<h2><span class="mw-headline" id="Configuring">Configuring</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> The access to <a rel="nofollow" class="external text" href="https://myaccount.google.com/lesssecureapps">lesssecureapps</a> is no longer possible without two-factor authentication. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Isync.html">Talk:Isync</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Google appears to block isync from downloading emails by default. If you have 2-step authentication enabled, you need to <a rel="nofollow" class="external text" href="https://myaccount.google.com/apppasswords">set up an app password</a> and use that with isync, otherwise you need to go to <a rel="nofollow" class="external text" href="https://myaccount.google.com/security">Google's Security Page</a> and toggle "Allow less secure apps" to "on".</li>
<li>
<b>Subfolders</b> setting in MaildirStore now seems to be required to be set:   <a rel="nofollow" class="external text" href="https://isync.sourceforge.net/mbsync.html">iSync Config SubFolders</a> <b>SubFolders Legacy</b> worked as previous unset - Oct 2017</li>
</ul>
</div>
<p>First, a main configuration file <code>.mbsyncrc</code> needs to be created in the user's home directory root. The package supplies an example <code>/usr/share/doc/isync/examples/mbsyncrc.sample</code> file. Another example for a Google-mail account is as follows:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.mbsyncrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">IMAPAccount gmail
# Address to connect to
Host imap.gmail.com
User <i>username</i>@gmail.com
Pass ***************
# To store the password in an encrypted file use PassCmd instead of Pass
# PassCmd "gpg2 -q --for-your-eyes-only --no-tty -d ~/.mailpass.gpg"
#
# Use TLS
TLSType IMAPS
# The following line should work. If you get certificate errors, uncomment the two following lines and read the "Troubleshooting" section.
CertificateFile /etc/ssl/certs/ca-certificates.crt
#CertificateFile ~/.cert/imap.gmail.com.pem
#CertificateFile ~/.cert/Equifax_Secure_CA.pem

IMAPStore gmail-remote
Account gmail

MaildirStore gmail-local
SubFolders Verbatim
# The trailing "/" is important
Path ~/.mail/gmail/
Inbox ~/.mail/gmail/Inbox

Channel gmail
Far :gmail-remote:
Near :gmail-local:
# Exclude everything under the internal [Gmail] folder, except the interesting folders
Patterns * ![Gmail]* "[Gmail]/Sent Mail" "[Gmail]/Starred" "[Gmail]/All Mail"
# Or include everything
#Patterns *
# Automatically create missing mailboxes, both locally and on the server
Create Both
# Sync the movement of messages between folders and deletions, add after making sure the sync works
Expunge Both
# Save the synchronization state files in the relevant directory
SyncState *
</pre>
<p>It is possible to avoid the proprietary <code>[Gmail]</code> (or <code>[Google Mail]</code>) folder categorization by using separate channels for each directory, and later merging them to a group:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.mbsyncrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Channel sync-googlemail-default
Far :gmail-remote:
Near :gmail-local:
# Select some mailboxes to sync
Patterns "INBOX" "arch"
Create Both

Channel sync-googlemail-sent
Far :gmail-remote:"[Google Mail]/Gesendet"
Near :gmail-local:sent
Create Near

Channel sync-googlemail-trash
Far :gmail-remote:"[Google Mail]/Papierkorb"
Near :gmail-local:trash
Create Near

# Get all the channels together into a group.
Group googlemail
Channel sync-googlemail-default
Channel sync-googlemail-sent
Channel sync-googlemail-trash
</pre>
<p>As you can see, name-translations are possible this way as well.
</p>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>First make any folders that were specified as Maildirs.
</p>
<pre>$ mkdir -p ~/.mail/gmail
</pre>
<p>Then to retrieve the mail for a specific channel run:
</p>
<pre>$ mbsync gmail
</pre>
<p>or to retrive the mail for all channels:
</p>
<pre>$ mbsync -a
</pre>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3>
<span id="Using_Path_and.2For_Inbox_on_NTFS_partitions"></span><span class="mw-headline" id="Using_Path_and/or_Inbox_on_NTFS_partitions">Using Path and/or Inbox on NTFS partitions</span>
</h3>
<p>Since NTFS partitions will not accept a semicolon in a filename, you need to change your InfoDelimiter and your FieldDelimiter to something else, you can achieve this by globaly (outside any store or channel configuration) changing the later, like below:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.mbsyncrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">FieldDelimiter -</pre>
<h3><span class="mw-headline" id="Calling_mbsync_automatically">Calling mbsync automatically</span></h3>
<h4><span class="mw-headline" id="With_a_timer">With a timer</span></h4>
<p>If you want to automatically synchronize your mailboxes, isync can be started automatically with a <a href="../en/Systemd/User.html" title="Systemd/User">systemd/User</a> unit. The following service file can start the <code>mbsync</code> command:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/mbsync.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Mailbox synchronization service

[Service]
Type=oneshot
ExecStart=/usr/bin/mbsync -Va

[Install]
WantedBy=default.target</pre>
<p>The following timer configures <code>mbsync</code> to be started 2 minutes after boot, and then every 5 minutes:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/mbsync.timer</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Mailbox synchronization timer

[Timer]
OnBootSec=2m
OnUnitActiveSec=5m
Unit=mbsync.service

[Install]
WantedBy=timers.target</pre>
<p>Once those two files are created, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Reload">reload</a> systemd, then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> <code>mbsync.timer</code>, adding the <code>--user</code> flag to <code>systemctl</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The mbsync service now only runs after login. It's also possible to launch the systemd-user instances after boot if you configure <a href="../en/Systemd/User.html#Automatic_start-up_of_systemd_user_instances" title="Systemd/User">Systemd/User#Automatic start-up of systemd user instances</a>.
</div>
<h5><span class="mw-headline" id="Integration_with_notmuch_or_mu4e">Integration with notmuch or mu4e</span></h5>
<p>If you want to run <a href="../en/Notmuch.html" title="Notmuch">notmuch</a> or mu/mu4e after automatically synchronizing your mails, it is preferable to modify the above <code>mbsync.service</code> by adding a post-start hook, like below:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/mbsync.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Mailbox synchronization service

[Service]
Type=oneshot
ExecStart=/usr/bin/mbsync -Va
ExecStartPost=/usr/bin/notmuch new</pre>
<p>You can also index <code>mu</code> by changing the <code>ExecStartPost</code> line to <code>ExecStartPost=/usr/bin/mu index</code>, or to <code>ExecStartPost=/usr/bin/emacsclient -e '(mu4e-update-index)'</code> if you are running emacsclient and would like to index <code>mu4e</code>.
</p>
<p>This modification assumes that you have already setup notmuch or mu/mu4e for your user. If the ExecStart command does not execute successfully, the ExecStartPost command will not execute, so be aware of this!
</p>
<p>Trigger syncing immediately when making local changes (such as marking messages as read) by watching the <code>.notmuch</code> directory:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/mbsync.path</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Path]
PathChanged=%h/mail/.notmuch

[Install]
WantedBy=default.target</pre>
<p>Systemd defaults ensure that the service will not trigger redundantly.
</p>
<h4><span class="mw-headline" id="With_imapnotify">With imapnotify</span></h4>
<p><a href="https://en.wikipedia.org/wiki/IMAP_IDLE" class="extiw" title="wikipedia:IMAP IDLE">IMAP IDLE</a> is a way to get <a href="https://en.wikipedia.org/wiki/Push_Technology" class="extiw" title="wikipedia:Push Technology">push notifications</a> to download new email, rather than polling the server intermittently. This has the advantage of saving bandwidth and delivering your mail as soon as it's available. Isync does not have native IDLE support, but we can use a program like <a rel="nofollow" class="external text" href="https://www.npmjs.com/package/imapnotify">imapnotify</a> to call mbsync when you receive new email. For this example we will use the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=goimapnotify">goimapnotify</a></span> package which is reported to work better with frequent network interruptions. 
</p>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=goimapnotify">goimapnotify</a></span> and create a configuration file for each mail server you want to poll. Note that the file name format, including the <i>.conf</i>, is necessary if you want to use the provided systemd service:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/imapnotify/gmail.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "host": "imap.gmail.com",
  "port": 993,
  "tls": true,
  "tlsOptions": {
    "rejectUnauthorized": false
  },
  "username": "username@gmail.com",
  "password": "",
    "passwordCmd": "pass gmail | head -n1",
  "onNewMail": "mbsync gmail",
  "onNewMailPost": "",
  "boxes": [ "INBOX" ]
}
</pre>
<p>(You can view the full configuration options in the project's <a rel="nofollow" class="external text" href="https://gitlab.com/shackra/goimapnotify">README</a>.)
</p>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">Start/enable</a> the  <code>goimapnotify@gmail.service</code> <a href="../en/Systemd/User.html" class="mw-redirect" title="User unit">user unit</a>.
</p>
<p>Note that IMAP IDLE only triggers when new mail arrives, not when there is undownloaded mail on the server. For example, if you receive 100 emails with your computer powered off, then turn on your computer, imapnotify will still not download new mail until you receive another email. For this reason you may want to run mbsync <a href="../en/Autostarting.html" title="Autostarting">once when you log in</a>.
</p>
<h3><span class="mw-headline" id="Using_XOAUTH2">Using XOAUTH2</span></h3>
<p>First install an XOAUTH2 SASL plugin, like <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/cyrus-sasl-xoauth2-git/">cyrus-sasl-xoauth2-git</a></span><sup><small>AUR</small></sup>.
</p>
<p>For all OAuth2 helpers listed below, choose either one among them, you need to provide a <code>client_id</code> and optionally a <code>client_secret</code> of your own or of a suitable FOSS registered application.
</p>
<p>In order to get a <code>client_id</code> and <code>client_secret</code>, you will need an app registration with the provider. You should create your own app registration if possible, otherwise, for example due to missing rights, you can use existing app registrations, such as <a rel="nofollow" class="external text" href="https://hg.mozilla.org/comm-central/file/tip/mailnews/base/src/OAuth2Providers.sys.mjs">Thunderbird's</a> (under <code>kIssuers</code>) or <a rel="nofollow" class="external text" href="https://github.com/harishkrupo/oauth2ms/issues/15">Evolution's</a>, which are publicly available until dynamic client registration is supported.
</p>
<p>Another option is to temporarily use an incognito browser window to create a free outlook.com account and use that to create the app registration.
</p>
<h4><span class="mw-headline" id="oama">oama</span></h4>
<p><a rel="nofollow" class="external text" href="https://github.com/pdobsan/oama">oama</a> is a utility which provides IMAP/SMTP clients with renewal capabilities and authorization of OAuth2 credentials. <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/oama-bin/">oama-bin</a></span><sup><small>AUR</small></sup> and configure it according to its <a rel="nofollow" class="external text" href="https://github.com/pdobsan/oama">README</a>.
You can find configuration templates in <code>/usr/share/oama</code>.
</p>
<p>Before you are able to use oama with your credentials you need to authorize OAuth2 access by running the command below:
</p>
<pre>$ oama authorize <i>service</i> <i>email</i>
</pre>
<p>Where <i>service</i> is your email provider (e.g. <i>google</i>) and <i>email</i> is your email address.
</p>
<p>After the authorization completed add <code>AuthMechs XOAUTH2</code> and <code>PassCmd "oama access <i>email</i>"</code> to the <code>IMAPAccount</code> section in the <code>.mbsyncrc</code>.
</p>
<h4><span class="mw-headline" id="oauth2token">oauth2token</span></h4>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/oauth2token/">oauth2token</a></span><sup><small>AUR</small></sup> and follow its <a rel="nofollow" class="external text" href="https://pypi.org/project/oauth2token/">README</a> to configure the account. It will be responsible for getting the current XOAUTH2 token using the account credentials every time mbsync needs to authenticate.
</p>
<p>Finally, add <code>AuthMechs XOAUTH2</code> and <code>PassCmd "oauth2get <i>provider</i> <i>account</i>"</code>, substituting <code><i>provider</i></code> and <code><i>account</i></code> with the values you used for <code>oauth2create</code>, to the <code>IMAPAccount</code> section in the <code>.mbsyncrc</code>.
</p>
<h4><span class="mw-headline" id="mutt_oauth2.py">mutt_oauth2.py</span></h4>
<p><code>mutt_oauth2.py</code> is known to work with Google and Microsoft accounts. Download <a rel="nofollow" class="external text" href="https://gitlab.com/muttmua/mutt/-/blob/master/contrib/mutt_oauth2.py">mutt_oauth2.py</a> (make it executable and put in your <code>PATH</code> if desired) and follow its <a rel="nofollow" class="external text" href="https://gitlab.com/muttmua/mutt/-/blob/master/contrib/mutt_oauth2.py.README">README</a> for background and to configure the account.
</p>
<p>In short, you will need to modify the <code>ENCRYPTION_PIPE</code> and <code>DECRYPTION_PIPE</code> for your preferred encryption system directly in script's source or specify them on each subsequent renew invocation using flags. During authorization, add the <code>client_id</code> and <code>client_secret</code> from an app registration with the provider (see <a href="#Using_XOAUTH2">#Using XOAUTH2</a>). Then to initialize your tokens, you run and answer the questions in:
</p>
<pre>$ mutt_oauth2.py userid@myschool.edu.tokens --verbose --authorize
</pre>
<p>Note that gmail only supports the <code>localhostauthcode</code> authflow while MS only supports the <code>authcode</code> authflow.
</p>
<p>To subsequently receive your access token (the script automatically handles renewing of tokens), you can run:
</p>
<pre>$ mutt_oauth2.py userid@myschool.edu.tokens
</pre>
<p>As the <code>ENCRYPTION_PIPE</code> and <code>DECRYPTION_PIPE</code> options are not stored within the token file, you have to pass them separately if you do not want to hardcode your gpg key name in script's source:
</p>
<pre>$ mutt_oauth2.py userid@myschool.edu.tokens --encryption-pipe 'gpg --encrypt --recipient &lt;gpg-key&gt;'
</pre>
<p>Finally, add <code>AuthMechs XOAUTH2</code> and <code>PassCmd "mutt_oauth2.py userid@myschool.edu.tokens"</code>, with the correct paths if necessary, to the <code>IMAPAccount</code> section in the <code>.mbsyncrc</code>.
</p>
<h4><span class="mw-headline" id="oauth2ms">oauth2ms</span></h4>
<p><code>oauth2ms</code> can be used to fetch oauth2 tokens from the Microsoft identity endpoint. 
Additionally, it can encode the token in the XOAUTH2 format to be used as authentication in IMAP mail servers.
</p>
<p>Install <code>oauth2ms</code> as <a rel="nofollow" class="external text" href="https://github.com/harishkrupo/oauth2ms#installation">indicated</a> and create a config file <code>$XDG_CONFIG_HOME/oauth2ms/config.json</code> <a rel="nofollow" class="external text" href="https://github.com/harishkrupo/oauth2ms#usage">containing</a> the <code> client_id</code>.
</p>
<p>Finally, add <code>AuthMechs XOAUTH2</code> and <code>PassCmd "oauth2ms"</code>, or the full path to <code>oauth2ms</code> if necessary, to the <code>IMAPAccount</code> section in <code>.mbsyncrc</code>.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="SSL_error">SSL error</span></h3>
<p>If you get the following error:
</p>
<pre>SSL error connecting imap.gmail.com (108.177.125.109:993): self signed certificate
</pre>
<p>Since google enforce SNI when you use TLS 1.3, ensure to run at least isync v1.3.0
See <a rel="nofollow" class="external free" href="https://sourceforge.net/p/isync/isync/merge-requests/2/">https://sourceforge.net/p/isync/isync/merge-requests/2/</a> for more details
</p>
<p>If you get certificate related errors like: 
</p>
<pre>SSL error connecting pop.mail.com (193.222.111.111:143): error:00000012:lib(0):func(0):reason(18)
</pre>
<p>you may need to retrieve the server's certificates manually in order for mbsync to correctly verify it.
</p>
<h4>
<span id="Step_.231:_Get_the_certificates"></span><span class="mw-headline" id="Step_#1:_Get_the_certificates">Step #1: Get the certificates</span>
</h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> This may not always be needed, e.g. for gmail <code>CertificateFile /etc/ssl/certs/ca-certificates.crt</code> in the config file may be suffcient (Discuss in <a href="../en/Talk:Isync.html#Step_#1:_Get_the_certificates" title="Talk:Isync">Talk:Isync#Step #1: Get the certificates</a>)</div>
</div>
<pre>$ mkdir ~/.cert
$ openssl s_client -connect some.imap.server:port -showcerts 2&gt;&amp;1 &lt; /dev/null | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sed -ne '1,/-END CERTIFICATE-/p' &gt; ~/.cert/some.imap.server.pem
</pre>
<p>This will create a certificate file called <code>~/.cert/some.imap.server.pem</code> (e.g. <code>~/.cert/imap.gmail.com.pem</code>). Alternatively one can download <a rel="nofollow" class="external text" href="https://gist.githubusercontent.com/petRUShka/af96ae25ce8280729b9ea049b929f31d/raw/a79471ce8aee3f6d04049039adf870a53a524f7f/get_certs.sh">get_certs.sh</a> and run it:
</p>
<pre>$ mkdir ~/.cert
$ wget https://gist.githubusercontent.com/petRUShka/af96ae25ce8280729b9ea049b929f31d/raw/a79471ce8aee3f6d04049039adf870a53a524f7f/get_certs.sh
$ sh get_certs.sh some.imap.server port ~/.cert/
</pre>
<p>If you wish to do this manually, you may enter:
</p>
<pre>$ openssl s_client -connect some.imap.server:port -showcerts
</pre>
<p>and it will display output something like:
</p>
<pre>CONNECTED(00000003)
depth=1 C = US, O = Google Inc, CN = Google Internet Authority
verify error:num=20:unable to get local issuer certificate
verify return:0
---
Certificate chain
 0 s:/C=US/ST=California/L=Mountain View/O=Google Inc/CN=imap.gmail.com
   i:/C=US/O=Google Inc/CN=Google Internet Authority
-----BEGIN CERTIFICATE-----
MIIDgDCCAumgAwIBAgIKO3MmiwAAAABopTANBgkqhkiG9w0BAQUFADBGMQswCQYD
VQQGEwJVUzETMBEGA1UEChMKR29vZ2xlIEluYzEiMCAGA1UEAxMZR29vZ2xlIElu
dGVybmV0IEF1dGhvcml0eTAeFw0xMjA5MTIxMTU1NDlaFw0xMzA2MDcxOTQzMjda
MGgxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRYwFAYDVQQHEw1N
b3VudGFpbiBWaWV3MRMwEQYDVQQKEwpHb29nbGUgSW5jMRcwFQYDVQQDEw5pbWFw
LmdtYWlsLmNvbTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA2OmU9DjI+DFQ
ThqIN4vL6EqZbzH0ejLKcc+zhxsq9BU5hXohSJ1sS5FUU2vReDKk8fd+ZR3cWtpf
CTYAUSvdnz1ZFjESSzyUBmGRqByhoc0yqdfb61NosA4CDaO+z7DtAgKyecqnAJad
TPYYf9aLk/UgJuc6GseitjzFYonXi6ECAwEAAaOCAVEwggFNMB0GA1UdJQQWMBQG
CCsGAQUFBwMBBggrBgEFBQcDAjAdBgNVHQ4EFgQUFuLyTg2NcsyaEESytZbLbQan
YIowHwYDVR0jBBgwFoAUv8Aw6/VDET5nup6R+/xq2uNrEiQwWwYDVR0fBFQwUjBQ
oE6gTIZKaHR0cDovL3d3dy5nc3RhdGljLmNvbS9Hb29nbGVJbnRlcm5ldEF1dGhv
cml0eS9Hb29nbGVJbnRlcm5ldEF1dGhvcml0eS5jcmwwZgYIKwYBBQUHAQEEWjBY
MFYGCCsGAQUFBzAChkpodHRwOi8vd3d3LmdzdGF0aWMuY29tL0dvb2dsZUludGVy
bmV0QXV0aG9yaXR5L0dvb2dsZUludGVybmV0QXV0aG9yaXR5LmNydDAMBgNVHRMB
Af8EAjAAMBkGA1UdEQQSMBCCDmltYXAuZ21haWwuY29tMA0GCSqGSIb3DQEBBQUA
A4GBAC1LV7tM6pcyVJLcwdPml4DomtowsjTrqvy5ZFa3SMKANK0iZBgFu74O0THX
8SxP/vn4eAs0yRQxcT1ZuoishLGQl5NoimLaQ4BGQnzFQHDJendfaVKDl21GenJp
is72sIrAeprsVU8PbNsllUamWsIjKr3DH5xQdH54hDtzQojY
-----END CERTIFICATE-----
 1 s:/C=US/O=Google Inc/CN=Google Internet Authority
   i:/C=US/O=Equifax/OU=Equifax Secure Certificate Authority
-----BEGIN CERTIFICATE-----
MIICsDCCAhmgAwIBAgIDC2dxMA0GCSqGSIb3DQEBBQUAME4xCzAJBgNVBAYTAlVT
MRAwDgYDVQQKEwdFcXVpZmF4MS0wKwYDVQQLEyRFcXVpZmF4IFNlY3VyZSBDZXJ0
aWZpY2F0ZSBBdXRob3JpdHkwHhcNMDkwNjA4MjA0MzI3WhcNMTMwNjA3MTk0MzI3
WjBGMQswCQYDVQQGEwJVUzETMBEGA1UEChMKR29vZ2xlIEluYzEiMCAGA1UEAxMZ
R29vZ2xlIEludGVybmV0IEF1dGhvcml0eTCBnzANBgkqhkiG9w0BAQEFAAOBjQAw
gYkCgYEAye23pIucV+eEPkB9hPSP0XFjU5nneXQUr0SZMyCSjXvlKAy6rWxJfoNf
NFlOCnowzdDXxFdF7dWq1nMmzq0yE7jXDx07393cCDaob1FEm8rWIFJztyaHNWrb
qeXUWaUr/GcZOfqTGBhs3t0lig4zFEfC7wFQeeT9adGnwKziV28CAwEAAaOBozCB
oDAOBgNVHQ8BAf8EBAMCAQYwHQYDVR0OBBYEFL/AMOv1QxE+Z7qekfv8atrjaxIk
MB8GA1UdIwQYMBaAFEjmaPkr0rKV10fYIyAQTzOYkJ/UMBIGA1UdEwEB/wQIMAYB
Af8CAQAwOgYDVR0fBDMwMTAvoC2gK4YpaHR0cDovL2NybC5nZW90cnVzdC5jb20v
Y3Jscy9zZWN1cmVjYS5jcmwwDQYJKoZIhvcNAQEFBQADgYEAuIojxkiWsRF8YHde
BZqrocb6ghwYB8TrgbCoZutJqOkM0ymt9e8kTP3kS8p/XmOrmSfLnzYhLLkQYGfN
0rTw8Ktx5YtaiScRhKqOv5nwnQkhClIZmloJ0pC3+gz4fniisIWvXEyZ2VxVKfml
UUIuOss4jHg7y/j7lYe8vJD5UDI=
-----END CERTIFICATE-----
---
Server certificate
subject=/C=US/ST=California/L=Mountain View/O=Google Inc/CN=imap.gmail.com
issuer=/C=US/O=Google Inc/CN=Google Internet Authority
---
No client certificate CA names sent
---
SSL handshake has read 2108 bytes and written 350 bytes
---
New, TLSv1/SSLv3, Cipher is ECDHE-RSA-RC4-SHA
Server public key is 1024 bit
Secure Renegotiation IS supported
Compression: NONE
Expansion: NONE
SSL-Session:
    Protocol  : TLSv1.1
    Cipher    : ECDHE-RSA-RC4-SHA
    Session-ID: 77136647F42633D82DEDFBB9EB62AB516547A3697D83BD1884726034613C1C09
    Session-ID-ctx: 
    Master-Key: 635957FBA0762B10694560488905F73BDD2DB674C41970542ED079446F27234E2CA51CF26938B8CA56DF5BBC71E429A7
    Key-Arg   : None
    PSK identity: None
    PSK identity hint: None
    SRP username: None
    TLS session ticket lifetime hint: 100800 (seconds)
    TLS session ticket:
    0000 - d6 5b a0 a7 10 0e 64 04-72 93 7c 9f 94 fa 07 57   .[....d.r.|....W
    0010 - f1 8b 9d 24 8b 9d 1b f3-a8 b1 4d 2c a9 00 e1 82   ...$......M,....
    0020 - 00 83 1e 3f e5 f2 b2 2c-d2 a8 87 83 16 02 0d 1e   ...?...,........
    0030 - bf b6 c1 d6 75 21 04 e6-63 6b ab 5b ed 94 7a 30   ....u!..ck.[..z0
    0040 - 1a d0 aa 44 c2 04 9b 10-06 28 b5 7b a0 43 a6 0d   ...D.....(.{.C..
    0050 - 3b 4a 85 1f 2e 07 0a e1-32 9b bd 5d 65 41 4c e2   ;J......2..]eAL.
    0060 - 7c d7 43 ec c4 18 77 53-b5 d4 84 b4 c9 bd 51 d6   |.C...wS......Q.
    0070 - 2d 4f 2e 10 a6 ed 38 c5-8e 9d f8 8b 8a 63 3f 7b   -O....8......c?{
    0080 - ee e6 b8 bf 7a f8 b8 e8-47 92 84 f1 9b 0c 63 30   ....z...G.....c0
    0090 - 76 d8 e1 44                                       v..D

    Start Time: 1352632558
    Timeout   : 300 (sec)
    Verify return code: 20 (unable to get local issuer certificate)
---
* OK Gimap ready for requests from 108.78.162.240 o67if11168976yhc.67
</pre>
<p>Simply copy the first block that begins with <code>-----BEGIN CERTIFICATE-----</code> and ends with <code>-----END CERTIFICATE-----</code>, paste into a file, and save with a .pem extension (this is necessary for the next step). Older instructions state that, with Gmail, both certificate blocks must be saved but on testing this was found to be unnecessary.
</p>
<p>Now, copy the root issuer certificate to your local certificate folder. In this example (Gmail), the root issuer is Equifax Secure Certificate Authority. This certificate is included in the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ca-certificates">ca-certificates</a></span> package.
</p>
<pre>$ cp /usr/share/ca-certificates/mozilla/Equifax_Secure_CA.crt ~/.cert/Equifax_Secure_CA.pem
</pre>
<h4>
<span id="Step_.232:_Setup_mbsync"></span><span class="mw-headline" id="Step_#2:_Setup_mbsync">Step #2: Setup mbsync</span>
</h4>
<p>Configure mbsync to use that certificate:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.mbsyncrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">IMAPAccount gmail
Host imap.gmail.com
# ...
CertificateFile ~/.cert/imap.gmail.com.pem</pre>
<h3><span class="mw-headline" id="BAD_Command_with_Exchange_2003">BAD Command with Exchange 2003</span></h3>
<p>When connecting to an MS Exchange 2003 server, there could be problems when using pipelining (i.e. executing multiple imap commands concurrently).  Such an issue could look as follows:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">mbsync -V exchange</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">&gt;&gt;&gt; 9 SELECT "arch"^M
* 250 EXISTS
* 0 RECENT
* FLAGS (\Seen \Answered \Flagged \Deleted \Draft $MDNSent)
* OK [PERMANENTFLAGS (\Seen \Answered \Flagged \Deleted \Draft $MDNSent)] Permanent flags
* OK [UNSEEN 241] Is the first unseen message
* OK [UIDVALIDITY 4352] UIDVALIDITY value
9 OK [READ-WRITE] SELECT completed.
&gt;&gt;&gt; 10 UID FETCH 1:1000000000 (UID FLAGS)^M
* 1 FETCH (UID 1 FLAGS (\Seen \Answered))
* 2 FETCH (UID 2 FLAGS (\Seen \Answered))
...
* 249 FETCH (UID 696 FLAGS ())
* 250 FETCH (UID 697 FLAGS (\Seen))
10 OK FETCH completed.
&gt;&gt;&gt; 11 APPEND "arch" (\Seen) {4878+}^M
(1 in progress) &gt;&gt;&gt; 12 UID FETCH 697 (BODY.PEEK[])^M
(2 in progress) &gt;&gt;&gt; 13 UID STORE 696 +FLAGS.SILENT (\Deleted)^M
12 BAD Command is not valid in this state.
</pre>
<p>So command 9 is to select a new folder, command 10 checks the mail and commands 11, 12 and 13 run in parallel, writing/getting/flagging a mail.  In this case, the Exchange server would terminate the connection after the BAD return value and go on to the next channel.  (And if all went well in this channel, mbsync would return with 0.)  After setting
</p>
<pre>PipelineDepth 1
</pre>
<p>in the IMAPStore config part of the Exchange, this problem did not occur any more.
</p>
<h3><span class="mw-headline" id="Emails_on_remote_server_have_the_wrong_date">Emails on remote server have the wrong date</span></h3>
<p>This fix works when syncing with fastmail, but it likely applies to other services as well.
</p>
<p>If you move an email to a new folder using an email client, and mbsync causes the email to appear with the wrong date on the server, add this to your configuration file: 
</p>
<pre>CopyArrivalDate yes
</pre>
<p>For example, without this setting, moving an old email from Inbox to Archive using mu4e and then
syncing to fastmail with mbsync will cause the email to appear in Archive but with the date of
the sync.
</p>
<p>mbsync uses mtime of email message when uploading from maildir to imap server. You can use <a rel="nofollow" class="external text" href="https://gist.github.com/artizirk/877ce9d30159323aac037e2a2af74509">fix_maildir_mail_mtime.py</a> script to set mtime from email header.
</p>
<h2><span class="mw-headline" id="External_links">External links</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://isync.sourceforge.net/">Home page</a></li>
<li><a rel="nofollow" class="external text" href="https://sourceforge.net/projects/isync/">Sourceforge page</a></li>
<li>
<a rel="nofollow" class="external text" href="https://kevin.deldycke.com/2012/08/gmail-backup-mbsync/">backing up gmail with mbsync</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2024-07-30 ⓘ]</sup>
</li>
<li><a rel="nofollow" class="external text" href="https://www.cyberciti.biz/faq/test-ssl-certificates-diagnosis-ssl-certificate/">How To Verify SSL Certificate From A Shell Prompt</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Mail_retrieval_agents.html" title="Category:Mail retrieval agents">Mail retrieval agents</a></li>
<li><a href="../en/Category:OpenPGP.html" title="Category:OpenPGP">OpenPGP</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Isync&amp;oldid=823186">https://wiki.archlinux.org/index.php?title=Isync&amp;oldid=823186</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 15 December 2024, at 09:18.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
