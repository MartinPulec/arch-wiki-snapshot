<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>ZFS - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-ZFS rootpage-ZFS skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Concepts" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Concepts">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Concepts</div>
		</a>
		
		<ul id="toc-Concepts-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Complications_of_being_out-of-tree" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Complications_of_being_out-of-tree">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Complications of being out-of-tree</div>
		</a>
		
		<ul id="toc-Complications_of_being_out-of-tree-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Installation</div>
		</a>
		
			<button aria-controls="toc-Installation-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Installation subsection</span>
			</button>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
			<li id="toc-Binary_kernel_module" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Binary_kernel_module">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Binary kernel module</div>
			</a>
			
			<ul id="toc-Binary_kernel_module-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-DKMS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#DKMS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>DKMS</div>
			</a>
			
			<ul id="toc-DKMS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Root_on_ZFS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Root_on_ZFS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Root on ZFS</div>
			</a>
			
			<ul id="toc-Root_on_ZFS-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Configuration</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-Importing_pools_at_startup" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Importing_pools_at_startup">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Importing pools at startup</div>
			</a>
			
			<ul id="toc-Importing_pools_at_startup-sublist" class="vector-toc-list">
				<li id="toc-zfs-import-scan" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#zfs-import-scan">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.1</span>zfs-import-scan</div>
			</a>
			
			<ul id="toc-zfs-import-scan-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-zfs-import-cache" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#zfs-import-cache">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.2</span>zfs-import-cache</div>
			</a>
			
			<ul id="toc-zfs-import-cache-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Automatically_mounting_filesystems" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Automatically_mounting_filesystems">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Automatically mounting filesystems</div>
			</a>
			
			<ul id="toc-Automatically_mounting_filesystems-sublist" class="vector-toc-list">
				<li id="toc-zfs-mount-generator" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#zfs-mount-generator">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.1</span>zfs-mount-generator</div>
			</a>
			
			<ul id="toc-zfs-mount-generator-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-fstab" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#fstab">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.2</span>fstab</div>
			</a>
			
			<ul id="toc-fstab-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Creating_a_hostid_file" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Creating_a_hostid_file">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Creating a hostid file</div>
			</a>
			
			<ul id="toc-Creating_a_hostid_file-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Storage_pools" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Storage_pools">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Storage pools</div>
		</a>
		
			<button aria-controls="toc-Storage_pools-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Storage pools subsection</span>
			</button>
		
		<ul id="toc-Storage_pools-sublist" class="vector-toc-list">
			<li id="toc-Experimenting_with_ZFS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Experimenting_with_ZFS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Experimenting with ZFS</div>
			</a>
			
			<ul id="toc-Experimenting_with_ZFS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Creating_ZFS_pools" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Creating_ZFS_pools">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Creating ZFS pools</div>
			</a>
			
			<ul id="toc-Creating_ZFS_pools-sublist" class="vector-toc-list">
				<li id="toc-The_ashift_property" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#The_ashift_property">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.1</span>The ashift property</div>
			</a>
			
			<ul id="toc-The_ashift_property-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-GRUB-compatible_pool_creation" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#GRUB-compatible_pool_creation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.2</span>GRUB-compatible pool creation</div>
			</a>
			
			<ul id="toc-GRUB-compatible_pool_creation-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Verifying_pool_status" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Verifying_pool_status">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Verifying pool status</div>
			</a>
			
			<ul id="toc-Verifying_pool_status-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Importing_a_pool_created_by_id" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Importing_a_pool_created_by_id">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>Importing a pool created by id</div>
			</a>
			
			<ul id="toc-Importing_a_pool_created_by_id-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Destroying_a_storage_pool" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Destroying_a_storage_pool">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5</span>Destroying a storage pool</div>
			</a>
			
			<ul id="toc-Destroying_a_storage_pool-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Exporting_a_storage_pool" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Exporting_a_storage_pool">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.6</span>Exporting a storage pool</div>
			</a>
			
			<ul id="toc-Exporting_a_storage_pool-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Extending_an_existing_pool" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Extending_an_existing_pool">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.7</span>Extending an existing pool</div>
			</a>
			
			<ul id="toc-Extending_an_existing_pool-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Attaching_a_device_to_(create)_a_mirror" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Attaching_a_device_to_(create)_a_mirror">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.8</span>Attaching a device to (create) a mirror</div>
			</a>
			
			<ul id="toc-Attaching_a_device_to_(create)_a_mirror-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Renaming_a_pool" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Renaming_a_pool">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.9</span>Renaming a pool</div>
			</a>
			
			<ul id="toc-Renaming_a_pool-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Setting_a_different_mount_point" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Setting_a_different_mount_point">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.10</span>Setting a different mount point</div>
			</a>
			
			<ul id="toc-Setting_a_different_mount_point-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Upgrading_pools" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Upgrading_pools">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.11</span>Upgrading pools</div>
			</a>
			
			<ul id="toc-Upgrading_pools-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Creating_datasets" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Creating_datasets">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Creating datasets</div>
		</a>
		
			<button aria-controls="toc-Creating_datasets-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Creating datasets subsection</span>
			</button>
		
		<ul id="toc-Creating_datasets-sublist" class="vector-toc-list">
			<li id="toc-Native_encryption" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Native_encryption">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>Native encryption</div>
			</a>
			
			<ul id="toc-Native_encryption-sublist" class="vector-toc-list">
				<li id="toc-Unlock/Mount_at_boot_time:_systemd" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Unlock/Mount_at_boot_time:_systemd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1.1</span>Unlock/Mount at boot time: systemd</div>
			</a>
			
			<ul id="toc-Unlock/Mount_at_boot_time:_systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Unlock_at_login_time:_PAM" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Unlock_at_login_time:_PAM">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1.2</span>Unlock at login time: PAM</div>
			</a>
			
			<ul id="toc-Unlock_at_login_time:_PAM-sublist" class="vector-toc-list">
				<li id="toc-SSH" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#SSH">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1.2.1</span>SSH</div>
			</a>
			
			<ul id="toc-SSH-sublist" class="vector-toc-list">
				<li id="toc-SSH_Key_&amp;_Password_when_required" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#SSH_Key_&amp;_Password_when_required">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1.2.1.1</span>SSH Key &amp; Password when required</div>
			</a>
			
			<ul id="toc-SSH_Key_&amp;_Password_when_required-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-SSH_Key_&amp;_Password" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#SSH_Key_&amp;_Password">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1.2.1.2</span>SSH Key &amp; Password</div>
			</a>
			
			<ul id="toc-SSH_Key_&amp;_Password-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Swap_volume" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Swap_volume">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2</span>Swap volume</div>
			</a>
			
			<ul id="toc-Swap_volume-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Access_Control_Lists" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Access_Control_Lists">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.3</span>Access Control Lists</div>
			</a>
			
			<ul id="toc-Access_Control_Lists-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Databases" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Databases">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.4</span>Databases</div>
			</a>
			
			<ul id="toc-Databases-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-/tmp" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#/tmp">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.5</span>/tmp</div>
			</a>
			
			<ul id="toc-/tmp-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Transmitting_snapshots_with_ZFS_Send_and_ZFS_Recv" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Transmitting_snapshots_with_ZFS_Send_and_ZFS_Recv">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.6</span>Transmitting snapshots with ZFS Send and ZFS Recv</div>
			</a>
			
			<ul id="toc-Transmitting_snapshots_with_ZFS_Send_and_ZFS_Recv-sublist" class="vector-toc-list">
				<li id="toc-Basic_ZFS_Send" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Basic_ZFS_Send">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.6.1</span>Basic ZFS Send</div>
			</a>
			
			<ul id="toc-Basic_ZFS_Send-sublist" class="vector-toc-list">
				<li id="toc-To_and_from_files" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#To_and_from_files">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.6.1.1</span>To and from files</div>
			</a>
			
			<ul id="toc-To_and_from_files-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Send_over_ssh" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Send_over_ssh">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.6.2</span>Send over ssh</div>
			</a>
			
			<ul id="toc-Send_over_ssh-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Incremental_Backups" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Incremental_Backups">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.6.3</span>Incremental Backups</div>
			</a>
			
			<ul id="toc-Incremental_Backups-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tuning" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tuning">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Tuning</div>
		</a>
		
			<button aria-controls="toc-Tuning-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tuning subsection</span>
			</button>
		
		<ul id="toc-Tuning-sublist" class="vector-toc-list">
			<li id="toc-General" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#General">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1</span>General</div>
			</a>
			
			<ul id="toc-General-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Scrubbing" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Scrubbing">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2</span>Scrubbing</div>
			</a>
			
			<ul id="toc-Scrubbing-sublist" class="vector-toc-list">
				<li id="toc-How_often_should_I_do_this?" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#How_often_should_I_do_this?">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2.1</span>How often should I do this?</div>
			</a>
			
			<ul id="toc-How_often_should_I_do_this?-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Start_with_a_service_or_timer" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Start_with_a_service_or_timer">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2.2</span>Start with a service or timer</div>
			</a>
			
			<ul id="toc-Start_with_a_service_or_timer-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Enabling_TRIM" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enabling_TRIM">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.3</span>Enabling TRIM</div>
			</a>
			
			<ul id="toc-Enabling_TRIM-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-SSD_Caching" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#SSD_Caching">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.4</span>SSD Caching</div>
			</a>
			
			<ul id="toc-SSD_Caching-sublist" class="vector-toc-list">
				<li id="toc-ZIL" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#ZIL">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.4.1</span>ZIL</div>
			</a>
			
			<ul id="toc-ZIL-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-L2ARC" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#L2ARC">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.4.2</span>L2ARC</div>
			</a>
			
			<ul id="toc-L2ARC-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-ZVOLs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ZVOLs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.5</span>ZVOLs</div>
			</a>
			
			<ul id="toc-ZVOLs-sublist" class="vector-toc-list">
				<li id="toc-RAIDZ_and_Advanced_Format_physical_disks" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#RAIDZ_and_Advanced_Format_physical_disks">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.5.1</span>RAIDZ and Advanced Format physical disks</div>
			</a>
			
			<ul id="toc-RAIDZ_and_Advanced_Format_physical_disks-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-I/O_Scheduler" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#I/O_Scheduler">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.6</span>I/O Scheduler</div>
			</a>
			
			<ul id="toc-I/O_Scheduler-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Creating_a_zpool_fails" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Creating_a_zpool_fails">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.1</span>Creating a zpool fails</div>
			</a>
			
			<ul id="toc-Creating_a_zpool_fails-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-ZFS_is_using_too_much_RAM" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ZFS_is_using_too_much_RAM">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.2</span>ZFS is using too much RAM</div>
			</a>
			
			<ul id="toc-ZFS_is_using_too_much_RAM-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-No_hostid_found" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#No_hostid_found">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.3</span>No hostid found</div>
			</a>
			
			<ul id="toc-No_hostid_found-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Pool_cannot_be_found_while_booting_from_SAS/SCSI_devices" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Pool_cannot_be_found_while_booting_from_SAS/SCSI_devices">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.4</span>Pool cannot be found while booting from SAS/SCSI devices</div>
			</a>
			
			<ul id="toc-Pool_cannot_be_found_while_booting_from_SAS/SCSI_devices-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-On_boot_the_zfs_pool_does_not_mount_stating:_"pool_may_be_in_use_from_other_system"' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#On_boot_the_zfs_pool_does_not_mount_stating:_"pool_may_be_in_use_from_other_system"'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.5</span>On boot the zfs pool does not mount stating: "pool may be in use from other system"</div>
			</a>
			
			<ul id='toc-On_boot_the_zfs_pool_does_not_mount_stating:_"pool_may_be_in_use_from_other_system"-sublist' class="vector-toc-list">
				<li id="toc-Unexported_pool" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Unexported_pool">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.5.1</span>Unexported pool</div>
			</a>
			
			<ul id="toc-Unexported_pool-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Incorrect_hostid" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Incorrect_hostid">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.5.2</span>Incorrect hostid</div>
			</a>
			
			<ul id="toc-Incorrect_hostid-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Devices_have_different_sector_alignment" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Devices_have_different_sector_alignment">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.6</span>Devices have different sector alignment</div>
			</a>
			
			<ul id="toc-Devices_have_different_sector_alignment-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Pool_resilvering_stuck/restarting/slow?" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Pool_resilvering_stuck/restarting/slow?">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.7</span>Pool resilvering stuck/restarting/slow?</div>
			</a>
			
			<ul id="toc-Pool_resilvering_stuck/restarting/slow?-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Fix_slow_boot_caused_by_failed_import_of_unavailable_pools_in_the_initramfs_zpool.cache" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Fix_slow_boot_caused_by_failed_import_of_unavailable_pools_in_the_initramfs_zpool.cache">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.8</span>Fix slow boot caused by failed import of unavailable pools in the initramfs zpool.cache</div>
			</a>
			
			<ul id="toc-Fix_slow_boot_caused_by_failed_import_of_unavailable_pools_in_the_initramfs_zpool.cache-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-ZFS_Command_History" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ZFS_Command_History">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.9</span>ZFS Command History</div>
			</a>
			
			<ul id="toc-ZFS_Command_History-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">9</span>Tips and tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Create_an_Archiso_image_with_ZFS_support" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Create_an_Archiso_image_with_ZFS_support">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.1</span>Create an Archiso image with ZFS support</div>
			</a>
			
			<ul id="toc-Create_an_Archiso_image_with_ZFS_support-sublist" class="vector-toc-list">
				<li id="toc-Using_self-built_ZFS_packages_from_the_AUR" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Using_self-built_ZFS_packages_from_the_AUR">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.1.1</span>Using self-built ZFS packages from the AUR</div>
			</a>
			
			<ul id="toc-Using_self-built_ZFS_packages_from_the_AUR-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_the_archzfs_unofficial_user_repository" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Using_the_archzfs_unofficial_user_repository">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.1.2</span>Using the archzfs unofficial user repository</div>
			</a>
			
			<ul id="toc-Using_the_archzfs_unofficial_user_repository-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Finishing_up" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Finishing_up">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.1.3</span>Finishing up</div>
			</a>
			
			<ul id="toc-Finishing_up-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Automatic_snapshots" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Automatic_snapshots">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.2</span>Automatic snapshots</div>
			</a>
			
			<ul id="toc-Automatic_snapshots-sublist" class="vector-toc-list">
				<li id="toc-zrepl" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#zrepl">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.2.1</span>zrepl</div>
			</a>
			
			<ul id="toc-zrepl-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-sanoid" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#sanoid">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.2.2</span>sanoid</div>
			</a>
			
			<ul id="toc-sanoid-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-ZFS_Automatic_Snapshot_Service_for_Linux" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#ZFS_Automatic_Snapshot_Service_for_Linux">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.2.3</span>ZFS Automatic Snapshot Service for Linux</div>
			</a>
			
			<ul id="toc-ZFS_Automatic_Snapshot_Service_for_Linux-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Creating_a_share" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Creating_a_share">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.3</span>Creating a share</div>
			</a>
			
			<ul id="toc-Creating_a_share-sublist" class="vector-toc-list">
				<li id="toc-NFS" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#NFS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.3.1</span>NFS</div>
			</a>
			
			<ul id="toc-NFS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-SMB" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#SMB">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.3.2</span>SMB</div>
			</a>
			
			<ul id="toc-SMB-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Encryption_in_ZFS_using_dm-crypt" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Encryption_in_ZFS_using_dm-crypt">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.4</span>Encryption in ZFS using dm-crypt</div>
			</a>
			
			<ul id="toc-Encryption_in_ZFS_using_dm-crypt-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Emergency_chroot_repair_with_archzfs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Emergency_chroot_repair_with_archzfs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.5</span>Emergency chroot repair with archzfs</div>
			</a>
			
			<ul id="toc-Emergency_chroot_repair_with_archzfs-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Bind_mount" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Bind_mount">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.6</span>Bind mount</div>
			</a>
			
			<ul id="toc-Bind_mount-sublist" class="vector-toc-list">
				<li id="toc-fstab_2" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#fstab_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.6.1</span>fstab</div>
			</a>
			
			<ul id="toc-fstab_2-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Monitoring_/_Mailing_on_Events" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Monitoring_/_Mailing_on_Events">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.7</span>Monitoring / Mailing on Events</div>
			</a>
			
			<ul id="toc-Monitoring_/_Mailing_on_Events-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Wrap_shell_commands_in_pre_&amp;_post_snapshots" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Wrap_shell_commands_in_pre_&amp;_post_snapshots">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.8</span>Wrap shell commands in pre &amp; post snapshots</div>
			</a>
			
			<ul id="toc-Wrap_shell_commands_in_pre_&amp;_post_snapshots-sublist" class="vector-toc-list">
				<li id="toc-znp" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#znp">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.8.1</span>znp</div>
			</a>
			
			<ul id="toc-znp-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Remote_unlocking_of_ZFS_encrypted_root" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Remote_unlocking_of_ZFS_encrypted_root">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.9</span>Remote unlocking of ZFS encrypted root</div>
			</a>
			
			<ul id="toc-Remote_unlocking_of_ZFS_encrypted_root-sublist" class="vector-toc-list">
				<li id="toc-Changing_the_SSH_server_port" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Changing_the_SSH_server_port">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.9.1</span>Changing the SSH server port</div>
			</a>
			
			<ul id="toc-Changing_the_SSH_server_port-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Unlocking_from_a_Windows_machine_using_PuTTY/Plink" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Unlocking_from_a_Windows_machine_using_PuTTY/Plink">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.9.2</span>Unlocking from a Windows machine using PuTTY/Plink</div>
			</a>
			
			<ul id="toc-Unlocking_from_a_Windows_machine_using_PuTTY/Plink-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Enabling_bclone_support" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enabling_bclone_support">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.10</span>Enabling bclone support</div>
			</a>
			
			<ul id="toc-Enabling_bclone_support-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">10</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">ZFS</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/ZFS" title="ZFS – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/ZFS.html" title="ZFS – português" lang="pt" hreflang="pt" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/ZFS" title="ZFS – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/File_systems.html" title="File systems">File systems</a></li>
<li><a href="../en/ZFS/Virtual_disks.html" title="ZFS/Virtual disks">ZFS/Virtual disks</a></li>
<li><a href="../en/Install_Arch_Linux_on_ZFS.html" title="Install Arch Linux on ZFS">Install Arch Linux on ZFS</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/ZFS" class="extiw" title="wikipedia:ZFS">ZFS</a> is an advanced filesystem, originally developed and released by <a href="https://en.wikipedia.org/wiki/Sun_Microsystems" class="extiw" title="wikipedia:Sun Microsystems">Sun Microsystems</a> for the solaris operating system. Nowadays ZFS usually refers to the fork <a rel="nofollow" class="external text" href="https://github.com/openzfs/zfs">OpenZFS</a>, which ports the original implementation to other operating systems, including Linux, while continuing the development of solaris ZFS. This article will treat ZFS as synonmous with OpenZFS.
</p>
<p>ZFS is featureful. Features of ZFS include: an improved page cache algorithm: <a href="https://en.wikipedia.org/wiki/Adaptive_replacement_cache" class="extiw" title="wikipedia:Adaptive replacement cache">ARC</a>, deduplication, pooled storage,  <a href="https://en.wikipedia.org/wiki/Snapshot_(computer_storage)" class="extiw" title="wikipedia:Snapshot (computer storage)">snapshots</a>, replication, data integrity verification and automatic repair (scrubbing), <a href="https://en.wikipedia.org/wiki/RAID-Z" class="extiw" title="wikipedia:RAID-Z">RAID-Z</a> and much more.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Concepts">Concepts</span></h2>
<p>Unlike regular filesystems where a filesystem reside on a single block device, ZFS stores data in storage pools. Pools are composed of vdevs (virtual devices) which are themselves composed of block devices. Pools always write data to the vdev with most percentage of free space (so data are naturally striped across vdevs). Vdevs on the other hand can use more complex configurations such as RAIDZ and mirror. In the simplest configuration a pool can be created on a single vdev composed of a single partition, which behaves similar to regular filesystems.
</p>
<p>Once created, storage resources can be allocated from the pool. Such resources are groupd into units of what called datasets. There are 4 types of datasets:
</p>
<ol>
<li>file system: File systems are basically a directory tree and can be mounted like regular filesystems into the system namespace.</li>
<li>volume (zvol): A volume represented as a block device</li>
<li>snapshot: A snapshot of a file system or a volume</li>
<li>bookmark: A snapshot that does not hold data, used for incremental replication.</li>
</ol>
<p>Dataset are identified by a unique path with the following syntax:
</p>
<pre>pool(/segment)+((#|@)bookmark/snapshot name)?
</pre>
<p>where <code>#</code> is used for bookmarks and <code>@</code> is used for snapshots.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This is a short summary of <span class="plainlinks archwiki-template-man" title="$ man 7 zpoolconcepts"><a rel="nofollow" class="external text" href="https://openzfs.github.io/openzfs-docs/man/master/7/zpoolconcepts.7.html">zpoolconcepts(7)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 7 zfsconcepts"><a rel="nofollow" class="external text" href="https://openzfs.github.io/openzfs-docs/man/master/7/zfsconcepts.7.html">zfsconcepts(7)</a></span>. It is highly recommended to read them to familarize with the concepts as well as technical terms not covered here.</div>
<h2><span class="mw-headline" id="Complications_of_being_out-of-tree">Complications of being out-of-tree</span></h2>
<p>Due to complex legal reasons, the Linux kernel maintainers refuse to accept ZFS into the linux kernel. As such, ZFS is developed as an out-of-tree module. A consequence of this arrangement is that kernel updates will break the kernel API that ZFS uses from time to time. Whenever this happenes, ZFS would have to change their code to adapt to this new API. This means there will be a time period where ZFS does not work on the latest mainline kernel release.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Since the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> package closely tracks the updates of the latest stable branch, it would be a better idea to use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-lts">linux-lts</a></span> instead if you do not want to pin the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> package to an unsupported version.</div>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>As an out-of-tree module, there are 2 types of packages you can choose to install. Either installing it as a binary kernel module built against a specific kernel version or installing its source as a <a href="../en/Dynamic_Kernel_Module_Support.html" class="mw-redirect" title="DKMS">DKMS</a> module that gets automatically rebuilt anytime the kernel updates.
</p>
<p>In addition to the kernel modules, users would also need to install userspaces tools such as <span class="plainlinks archwiki-template-man" title="$ man 8 zpool"><a rel="nofollow" class="external text" href="https://openzfs.github.io/openzfs-docs/man/master/8/zpool.8.html">zpool(8)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 8 zfs"><a rel="nofollow" class="external text" href="https://openzfs.github.io/openzfs-docs/man/master/8/zfs.8.html">zfs(8)</a></span>. These userspace tools are usually packaged as a single package called <code>zfs-utils*</code>.
</p>
<p>All of the kernel module packages mentioned below correctly specified their dependency on their corresponding <code>zfs-utils*</code> packages so when installing you just need to satisfy their dependency.
</p>
<h3><span class="mw-headline" id="Binary_kernel_module">Binary kernel module</span></h3>
<table class="wikitable">
<caption>Comparison of packages
</caption>
<tbody>
<tr>
<th>Package
</th>
<th>Repository
</th>
<th>ZFS release type
</th>
<th>Targeting kernel
</th>
<th>Binary package
</th>
<th>Notes
</th>
</tr>
<tr>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zfs-linux-lts/">zfs-linux-lts</a></span><sup><small>AUR</small></sup>
</td>
<td>AUR
</td>
<td>Stable
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-lts">linux-lts</a></span>
</td>
<td>No
</td>
<td rowspan="2">Highly recommended to use <a href="../DeveloperWiki:Building_in_a_clean_chroot.html#Convenience_way" title="DeveloperWiki:Building in a clean chroot">devtools</a> when building newer versions of the ZFS package as otherwise you'd have to uninstall your current ZFS package to upgrade the kernel.
</td>
</tr>
<tr>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zfs-linux/">zfs-linux</a></span><sup><small>AUR</small></sup>
</td>
<td>AUR
</td>
<td>Stable
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span>
</td>
<td>No
</td>
</tr>
<tr>
<td>zfs-linux-lts-poscat
</td>
<td>
<a href="../en/Unofficial_user_repositories.html#archlinuxcn" class="mw-redirect" title="Archlinuxcn">archlinuxcn</a>
</td>
<td>Stable
</td>
<td>linux-lts
</td>
<td>Yes
</td>
<td rowspan="2">Automatically updated and rebuilt against new kernel versions by a build bot every few hours, additionally provides a mkinitcpio hook for systemd based initrds
</td>
</tr>
<tr>
<td>zfs-linux-lts-rc-poscat
</td>
<td>archlinuxcn
</td>
<td>Release candidate
</td>
<td>linux-lts
</td>
<td>Yes
</td>
</tr>
<tr>
<td>zfs-linux
</td>
<td>
<a href="../en/Unofficial_user_repositories.html#archzfs" title="Unofficial user repositories">archzfs</a>
</td>
<td>Stable
</td>
<td>linux
</td>
<td>Yes
</td>
<td>
</td>
</tr>
<tr>
<td>zfs-linux-lts
</td>
<td>archzfs
</td>
<td>Stable
</td>
<td>linux-lts
</td>
<td>Yes
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3><span class="mw-headline" id="DKMS">DKMS</span></h3>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zfs-dkms/">zfs-dkms</a></span><sup><small>AUR</small></sup>: stable release</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zfs-dkms-staging-git/">zfs-dkms-staging-git</a></span><sup><small>AUR</small></sup>: stable release with cherry picked patches for compatibility with latest <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> kernel</li>
</ul>
<h3><span class="mw-headline" id="Root_on_ZFS">Root on ZFS</span></h3>
<p>See <a href="../en/Install_Arch_Linux_on_ZFS.html" title="Install Arch Linux on ZFS">Install Arch Linux on ZFS</a>.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<h3><span class="mw-headline" id="Importing_pools_at_startup">Importing pools at startup</span></h3>
<p>ZFS provides systemd services for automatically importing pools and targets for other units to determine the state of ZFS initialization. These are:
</p>
<ul>
<li>
<code>zfs.target</code> which is reached when all ZFS services completes</li>
<li>
<code>zfs-import.target</code> which is reached when ZFS pools finish importing</li>
<li>
<code>zfs-volumes.target</code> which is reached when zvols all appear under <code>/dev</code>
</li>
<li>
<code>zfs-import-scan.service</code> which imports pools by scanning for devices using libblkid</li>
<li>
<code>zfs-import-cache.service</code> which imports pools by consulting a <code>zpool.cache</code> file</li>
<li>
<code>zfs-volume-wait.service</code> which waits for all zvols to be available.</li>
</ul>
<p>You should choose one between <code>zfs-import-scan.service</code> and <code>zfs-import-cache.service</code> and enable the rest.
</p>
<h4><span class="mw-headline" id="zfs-import-scan">zfs-import-scan</span></h4>
<p><code>zfs-import-scan.service</code> uses <code>zpool import</code>'s default logic of scanning devices using blkid, this means no <code>zpool.cache</code> files are needed. This is the recommended method since <code>zpool.cache</code> is <a rel="nofollow" class="external text" href="https://github.com/openzfs/zfs/issues/1035#issuecomment-13411970">deprecated</a>.
</p>
<p>It is important to make sure non of your pools are imported with the <code>cachefile</code> option enabled since <code>zfs-import-scan.service</code> will not start if <code>zpool.cache</code> exists and is not empty. You can achieve this by enabling the <a rel="nofollow" class="external text" href="https://openzfs.github.io/openzfs-docs/Performance%20and%20Tuning/Module%20Parameters.html#zfs-autoimport-disable"><code>zfs_autoimport_disable</code></a> option of the <code>zfs</code> module. You should also either remove the existing <code>zpool.cache</code> or setting <code>cachefile</code> to <code>none</code> for all imported pools when booting.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> It should be noted that if root is used on ZFS the best method remains zfs-import-cache, because the pool with root at each boot will change its cachefile property to default and the zpool.cache file in /etc/zfs will be recreated, making zfs-import-scan unusable. A workaround would be to recreate an empty zpool.cache file with <b>touch</b> and make it unbootable with <b>chattr +i</b>, but then upon generation of the initramfs with mkinitcpio, the system would be unbootable for corrupted zpool.cache.</div>
<h4><span class="mw-headline" id="zfs-import-cache">zfs-import-cache</span></h4>
<p><code>zfs-import-cache.service</code> uses <code>zpool import -c &lt;zpool.cache&gt;</code> when importing pools which reads device paths from the <code>zpool.cache</code>. 
</p>
<p>Using this method means you need to be conscious about the device paths while creating ZFS pools, since some device paths may change between boots or hardware modifications, which would lead to stale cache and failure of pool imports. See <a href="../en/Persistent_block_device_naming.html" title="Persistent block device naming">Persistent block device naming</a> on how to choose devices paths that are persistent.
</p>
<h3><span class="mw-headline" id="Automatically_mounting_filesystems">Automatically mounting filesystems</span></h3>
<p>The services <code>zfs-import-scan.service</code> and <code>zfs-import-cache.service</code> will import the pools without mounting any filesystems. To also mount filesystems on startup there are 2 methods, depending on if your filesystems are configured using <code>mountpoint=legacy</code> or not. If your filesystems are configured with a mix of legacy mount and non-legacy mount you'll need to use both methods.
</p>
<h4><span class="mw-headline" id="zfs-mount-generator">zfs-mount-generator</span></h4>
<p>If your filesystems use non-legacy mount, it is recommended to use <a rel="nofollow" class="external text" href="https://openzfs.github.io/openzfs-docs/man/master/8/zfs-mount-generator.8.html">zfs-mount-generator</a>, which is a <span class="plainlinks archwiki-template-man" title="$ man 7 systemd.generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.generator.7">systemd.generator(7)</a></span> that generates systemd mount units for all filesystems of imported zfs pools with the property <code>canmount=on</code> to mount filesystems on boot. By default though zfs-mount-generator won't do anything since it requires <code>zfs list</code> caches. You need to:
</p>
<ol>
<li>Enable and start the tracking ZEDLET <code>zfs-zed.service</code> <pre># systemctl enable zfs-zed.service
# systemctl restart zfs-zed.service</pre>
</li>
<li>Create the <code>/etc/zfs/zfs-list.cache</code> directory. <pre>mkdir -p /etc/zfs/zfs-list.cache</pre>
</li>
<li>Enable tracking for individual pools by creating empty files named after your pools in <code>/etc/zfs/zfs-list.cache/</code>. Zed will only update the list of filesystems if the file for the pool already exists and is writable. <pre># touch /etc/zfs/zfs-list.cache/&lt;pool-name&gt;</pre>
</li>
<li>Check the contents of <code>/etc/zfs/zfs-list.cache/&lt;pool-name&gt;</code>. If it is empty, <code>zed</code> has not detected any events and therefore has not refreshed the cache file. Change a monitored property somewhere on the pool to emit a new ZFS event which will trigger the ZEDLET and refresh the cache file. The first example below assumes <code>relatime</code> is enabled on the pool <code>zroot</code> and that it is inherited by the child filesystem <code>fs1</code>. Trigger an event by changing a property and then reverting it: <pre># zfs set relatime=off zroot/fs1
# zfs inherit relatime zroot/fs1
</pre> If inherit is not available (e.g. you are working with the root pool) simply make the change on the pool itself and revert it manually rather than using inherit:<pre># zfs set relatime=off zroot
# zfs set relatime=on zroot
</pre>
</li>
</ol>
<h4><span class="mw-headline" id="fstab">fstab</span></h4>
<p>If your filesystem uses legacy mount, then you should specify the mountpoint in the <a href="../en/Fstab.html" title="Fstab">fstab</a> file. The device field should be the name (full path) of your filesystem and the dump and fsck fields should be left as 0.
</p>
<h3><span class="mw-headline" id="Creating_a_hostid_file">Creating a hostid file</span></h3>
<p>While not strictly necessary, it is usually a good idea to create a <code>/etc/hostid</code> file:
</p>
<pre># zgenhostid $(hostid)
</pre>
<h2><span class="mw-headline" id="Storage_pools">Storage pools</span></h2>
<h3><span class="mw-headline" id="Experimenting_with_ZFS">Experimenting with ZFS</span></h3>
<p>Users wishing to experiment with ZFS with no possibility of real data loss can refer to <a href="../en/ZFS/Virtual_disks.html" title="ZFS/Virtual disks">ZFS/Virtual disks</a>.
</p>
<h3><span class="mw-headline" id="Creating_ZFS_pools">Creating ZFS pools</span></h3>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> One may want to read <a href="#The_ashift_property">#The ashift property</a> first as it may be recommend to set <code>ashift</code> on pool creation.</div>
<p>To create a ZFS pool:
</p>
<pre># zpool create -R &lt;root&gt; -o &lt;poolopts&gt; -O &lt;dsetprops&gt; &lt;pool&gt; &lt;vdevs&gt;
</pre>
<p>Where each <code>vdev</code> is either a device or has the format:
</p>
<pre>&lt;vdev type&gt; &lt;device&gt; ... &lt;device&gt;
</pre>
<ul>
<li>
<b>-R</b>: Mounts all filesystems under this directory, useful for not intefering with existing system</li>
<li>
<b>-o</b>: Specifies the properties of the pool, can be used multiple times. Some properties such as <code>ashift</code> cannot be changed once created. (technically <code>ashift</code> is per vdev but to configure it per vdev you'll need to use <code>zpool add</code>)</li>
<li>
<b>-O</b>: Specifies the properties of the root dataset of the pool, can be used multple times. Some properties such as <code>normalization</code> cannot be changed once created.</li>
<li>
<b>pool</b>: This is the name of the pool.</li>
<li>
<b>vdev type</b>: See <span class="plainlinks archwiki-template-man" title="$ man 7 zpoolconcepts"><a rel="nofollow" class="external text" href="https://openzfs.github.io/openzfs-docs/man/master/7/zpoolconcepts.7.html">zpoolconcepts(7)</a></span> for a list of supported vdev types.</li>
<li>
<b>device</b>: A block device, can be either a full path or the file name part of the path</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Depending on the <a href="#Importing_pools_at_startup">method</a> you chose to use to mount the pools, you might need to be conscious about the device path you use to create pools.
</div>
<p>For example, to create a pool on a single partition:
</p>
<pre># zpool create -R /mnt pool /dev/sda
</pre>
<p>To create a pool with a single <code>raidz1</code> vdev:
</p>
<pre># zpool create -R /mnt pool \
               raidz1 \
                  ata-ST3000DM001-9YN166_S1F0KDGY \
                  ata-ST3000DM001-9YN166_S1F0JKRR \
                  ata-ST3000DM001-9YN166_S1F0KBP8 \
                  ata-ST3000DM001-9YN166_S1F0JTM1
</pre>
<p>To create a pool with two <code>mirror</code> vdevs:
</p>
<pre># zpool create -R /mnt pool \
               mirror \
                  ata-ST3000DM001-9YN166_S1F0KDGY \
                  ata-ST3000DM001-9YN166_S1F0JKRR \
               mirror \
                  ata-ST3000DM001-9YN166_S1F0KBP8 \
                  ata-ST3000DM001-9YN166_S1F0JTM1
</pre>
<h4><span class="mw-headline" id="The_ashift_property">The ashift property</span></h4>
<p><code>ashift</code> is an immutable per-vdev property that determines the (logical) sector size, which is 2^ashift bytes. For optimal performance, the logical sector size should always be greater than or equal to the physical sector size of the disks.
</p>
<p>By default, <code>zpool create</code> should be able to correctly determine the physical sector size of the device. This should suffice in a single disk setup. 
</p>
<p>However, if your are (or intend to) using vdev setups that can replace failed disks, such as <code>mirror</code> or <code>raidzX</code>, it is usually a good idea to always use <code>ashift=12</code>, since using 4kb logical sector size on a 512b physical disk won't have a performance penalty while the converse will. (unless your devices are the <a rel="nofollow" class="external text" href="https://github.com/openzfs/zfs/blob/master/cmd/zpool/os/linux/zpool_vdev_os.c#L99">few rare SSDs</a> that uses an 8kb sector size)
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Use 
<pre>$ lsblk --filter 'TYPE=="DISK"' -o NAME,PHY-SEC
</pre>
<p>to check the physical sector sizes of your disks.
</p>
<p>Additionally, if you are using NVMe drives, it might be possible to format it using a more performant LBA format than the factory default (see <span class="plainlinks archwiki-template-man" title="$ man 1 nvme-format"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nvme-format.1">nvme-format(1)</a></span>).
</p>
</div>
<h4><span class="mw-headline" id="GRUB-compatible_pool_creation">GRUB-compatible pool creation</span></h4>
<p>By default, <i>zpool create</i> enables all features on a pool. If <code>/boot</code> resides on ZFS when using <a href="../en/GRUB.html" title="GRUB">GRUB</a> you must only enable features supported by GRUB otherwise GRUB will not be able to read the pool. ZFS includes compatibility files (see <code>/usr/share/zfs/compatibility.d</code>) to assist in creating pools at specific feature sets, of which grub2 is an option.
</p>
<p>You can create a pool with only the compatible features enabled:
</p>
<pre># zpool create -o compatibility=grub2 $POOL_NAME $VDEVS
</pre>
<h3><span class="mw-headline" id="Verifying_pool_status">Verifying pool status</span></h3>
<p>If the command is successful, there will be no output. Using the <a href="../en/File_systems.html#Mount_a_file_system" class="mw-redirect" title="Mount">mount</a> command will show that the pool is mounted. Using <code>zpool status</code> will show that the pool has been created:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># zpool status</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">  pool: bigdata
 state: ONLINE
 scan: none requested
config:

        NAME                                       STATE     READ WRITE CKSUM
        bigdata                                    ONLINE       0     0     0
          -0                                       ONLINE       0     0     0
            ata-ST3000DM001-9YN166_S1F0KDGY-part1  ONLINE       0     0     0
            ata-ST3000DM001-9YN166_S1F0JKRR-part1  ONLINE       0     0     0
            ata-ST3000DM001-9YN166_S1F0KBP8-part1  ONLINE       0     0     0
            ata-ST3000DM001-9YN166_S1F0JTM1-part1  ONLINE       0     0     0

errors: No known data errors
</pre>
<h3><span class="mw-headline" id="Importing_a_pool_created_by_id">Importing a pool created by id</span></h3>
<p>In accordance with the <a rel="nofollow" class="external text" href="https://openzfs.github.io/openzfs-docs/man/master/8/zpool-import.8.html">zpool-import.8</a> manual, to import an existing pool you need to use flags:
</p>
<ul><li>
<code>-c <i>cachefile</i></code> Reads configuration from the given cachefile that was created with the cachefile pool property. This cachefile is used instead of searching for devices.</li></ul>
<ul><li>
<code>-d <i>dir/device</i></code> Uses device or searches for devices or files in dir. The <code>-d</code> option can be specified multiple times.</li></ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Avoid using kernel names e.g. <code>/dev/sd<i>a</i></code> for operations that require saving a new cache file.
If you will use these kernel names by saving the cache file, in case they change the system will have problems to automatically mount the pools.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Use ID names inside <code>/dev/disk/by-id/</code> to mount an existing pool when cachefile cannot be used or if you want to mount it with other properties/mount point.</div>
<p>To import an existing pool to run a chroot on it consult <a href="../it/Install_Arch_Linux_on_ZFS.html#Export/Import_dei_pool" title="Install Arch Linux on ZFS (Italiano)">Export/Import dei pool(Italiano)</a>
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Unfortunately, there are changes in place to this page and the <a href="../en/Install_Arch_Linux_on_ZFS.html" title="Install Arch Linux on ZFS">Install Arch Linux on ZFS</a> page, and several key commands have been removed from the guides.</div>
<h3><span class="mw-headline" id="Destroying_a_storage_pool">Destroying a storage pool</span></h3>
<p>To destroy a whole pool:
</p>
<pre># zpool destroy &lt;pool&gt;
</pre>
<p>And now when checking the status:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># zpool status</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">no pools available
</pre>
<h3><span class="mw-headline" id="Exporting_a_storage_pool">Exporting a storage pool</span></h3>
<p>To export a pool:
</p>
<pre># zpool export &lt;pool&gt;
</pre>
<h3><span class="mw-headline" id="Extending_an_existing_pool">Extending an existing pool</span></h3>
<p>A device (a partition or a disk) can be added to an existing zpool:
</p>
<pre># zpool add &lt;pool&gt; &lt;device-id&gt;
</pre>
<h3>
<span id="Attaching_a_device_to_.28create.29_a_mirror"></span><span class="mw-headline" id="Attaching_a_device_to_(create)_a_mirror">Attaching a device to (create) a mirror</span>
</h3>
<p>A device (a partition or a disk) can be attached aside an existing device to be its mirror (similar to RAID 1):
</p>
<pre># zpool attach &lt;pool&gt; &lt;device-id|mirror&gt; &lt;new-device-id&gt;
</pre>
<p>You can attach the new device to an already existing mirror vdev (e.g. to upgrade from a 2-device to a 3-device mirror) or <a rel="nofollow" class="external text" href="https://askubuntu.com/a/1303462">attach it to single device to create a new mirror vdev</a>.
</p>
<h3><span class="mw-headline" id="Renaming_a_pool">Renaming a pool</span></h3>
<p>Renaming a pool that is already created is accomplished in 2 steps:
</p>
<pre># zpool export oldname
# zpool import oldname newname
</pre>
<h3><span class="mw-headline" id="Setting_a_different_mount_point">Setting a different mount point</span></h3>
<p>The mount point for a given zpool can be moved at will with one command:
</p>
<pre># zfs set mountpoint=/foo/bar poolname
</pre>
<h3><span class="mw-headline" id="Upgrading_pools">Upgrading pools</span></h3>
<p>When upgrading ZFS to a new version, new feature might be available. However for compatibility reasons ZFS won't automatically enable new features on previously created pools. Instead they need to be manually turned on for each pool.
</p>
<p>To check for upgrade availability:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ zpool upgrade</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">This system supports ZFS pool feature flags.

All pools are formatted using feature flags.

Every feature flags pool has all supported and requested features enabled.</pre>
<p>An example output with upgradable pools:
</p>
<pre>This system supports ZFS pool feature flags.

All pools are formatted using feature flags.


Some supported features are not enabled on the following pools. Once a
feature is enabled the pool may become incompatible with software
that does not support the feature. See zpool-features(7) for details.

Note that the pool 'compatibility' feature can be used to inhibit
feature upgrades.

POOL  FEATURE
<hr>
rpool
      redaction_list_spill
      raidz_expansion
      fast_dedup
      longname
      large_microzap
</pre>
<p>To upgrade a single pool:
</p>
<pre># zpool upgrade &lt;pool&gt;
</pre>
<p>To upgrade all pools:
</p>
<pre># zpool upgrade -a
</pre>
<h2><span class="mw-headline" id="Creating_datasets">Creating datasets</span></h2>
<p>Users can optionally create a dataset under the zpool as opposed to manually creating directories under the zpool. Datasets allow for an increased level of control (quotas for example) in addition to snapshots. To be able to create and mount a dataset, a directory of the same name must not pre-exist in the zpool. To create a dataset, use:
</p>
<pre># zfs create &lt;nameofzpool&gt;/&lt;nameofdataset&gt;
</pre>
<p>It is then possible to apply ZFS specific attributes to the dataset. For example, one could assign a quota limit to a specific directory within a dataset:
</p>
<pre># zfs set quota=20G &lt;nameofzpool&gt;/&lt;nameofdataset&gt;/&lt;directory&gt;
</pre>
<p>To see all the commands available in ZFS, see <span class="plainlinks archwiki-template-man" title="$ man 8 zfs">zfs(8)</span> or <span class="plainlinks archwiki-template-man" title="$ man 8 zpool">zpool(8)</span>.
</p>
<h3><span class="mw-headline" id="Native_encryption">Native encryption</span></h3>
<p>ZFS offers the following supported encryption options: <code>aes-128-ccm</code>, <code>aes-192-ccm</code>, <code>aes-256-ccm</code>, <code>aes-128-gcm</code>, <code>aes-192-gcm</code> and <code>aes-256-gcm</code>. When encryption is set to <code>on</code>, <code>aes-256-gcm</code> will be used. See <a rel="nofollow" class="external text" href="https://openzfs.github.io/openzfs-docs/man/8/zfs-change-key.8.html#Encryption">zfs-change-key(8)</a> for a description of the native encryption, including limitations.
</p>
<p>The following keyformats are supported: <code>passphrase</code>, <code>raw</code>, <code>hex</code>.
</p>
<p>One can also specify/increase the default iterations of PBKDF2 when using <code>passphrase</code> with <code>-o pbkdf2iters &lt;n&gt;</code>, although it may increase the decryption time.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>To import a pool with keys, one needs to specify the <code>-l</code> flag, without this flag encrypted datasets will be left unavailable until the keys are loaded. See <a href="#Importing_a_pool_created_by_id">#Importing a pool created by id</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup>.</li>
<li>Native ZFS encryption has been made available in the stable 0.8.0 release or newer. Previously it was only available in development versions provided by packages like <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zfs-linux-git/">zfs-linux-git</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zfs-dkms-git/">zfs-dkms-git</a></span><sup><small>AUR</small></sup> or other development builds. Users who were only using the development versions for the native encryption, may now switch to the stable releases if they wish.</li>
<li>The default encryption suite was changed from <code>aes-256-ccm</code> to <code>aes-256-gcm</code> in the 0.8.4 release.</li>
</ul>
</div>
<p>To create a dataset including native encryption with a passphrase, use:
</p>
<pre># zfs create -o encryption=on -o keyformat=passphrase &lt;nameofzpool&gt;/&lt;nameofdataset&gt;
</pre>
<p>To use a key instead of using a passphrase:
</p>
<pre># dd if=/dev/random of=/path/to/key bs=32 count=1 iflag=fullblock
# zfs create -o encryption=on -o keyformat=raw -o keylocation=file:///path/to/key &lt;nameofzpool&gt;/&lt;nameofdataset&gt;
</pre>
<p>The easy way to make a key in human-readable form (<code>keyformat=hex</code>):
</p>
<pre># od -Anone -x -N 32 -w64 /dev/random | tr -d [:blank:] &gt; /path/to/hex.key
</pre>
<p>To verify the key location:
</p>
<pre># zfs get keylocation &lt;nameofzpool&gt;/&lt;nameofdataset&gt;
</pre>
<p>To change the key location:
</p>
<pre># zfs set keylocation=file:///path/to/key &lt;nameofzpool&gt;/&lt;nameofdataset&gt;
</pre>
<p>You can also manually load the keys by using one of the following commands:
</p>
<pre># zfs load-key &lt;nameofzpool&gt;/&lt;nameofdataset&gt; # load key for a specific dataset
# zfs load-key -a # load all keys
# zfs load-key -r zpool/dataset # load all keys in a dataset
</pre>
<p>To mount the created encrypted dataset:
</p>
<pre># zfs mount &lt;nameofzpool&gt;/&lt;nameofdataset&gt;
</pre>
<h4>
<span id="Unlock.2FMount_at_boot_time:_systemd"></span><span class="mw-headline" id="Unlock/Mount_at_boot_time:_systemd">Unlock/Mount at boot time: systemd</span>
</h4>
<p>It is possible to automatically unlock a pool dataset on boot time by using a <a href="../en/Systemd.html" title="Systemd">systemd</a> unit. For example create the following service to unlock any specific dataset: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/zfs-load-key@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Load %I encryption keys
Before=systemd-user-sessions.service zfs-mount.service
After=zfs-import.target
Requires=zfs-import.target
DefaultDependencies=no

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/usr/bin/bash -c 'until (systemd-ask-password "Encrypted ZFS password for %I" --no-tty | zfs load-key %I); do echo "Try again!"; done'

[Install]
WantedBy=zfs-mount.service
</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable/start">Enable/start</a> the service for each encrypted dataset, (e.g. <code>zfs-load-key@pool0-dataset0.service</code>). Note the use of <code>-</code>, which is an escaped <code>/</code> in systemd unit definitions. See <code>systemd-escape(1)</code> for more info.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <code>Before=systemd-user-sessions.service</code> ensures that systemd-ask-password is invoked before the local IO devices are handed over to the <a href="../en/Desktop_environment.html" title="Desktop environment">desktop environment</a>.</div>
<p>An alternative is to load all possible keys:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/zfs-load-key.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Load encryption keys
DefaultDependencies=no
After=zfs-import.target
Before=zfs-mount.service

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/usr/bin/zfs load-key -a
StandardInput=tty-force

[Install]
WantedBy=zfs-mount.service</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable/start">Enable/start</a> <code>zfs-load-key.service</code>.
</p>
<h4><span class="mw-headline" id="Unlock_at_login_time:_PAM">Unlock at login time: PAM</span></h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> Missing prompts in front of commands. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:ZFS.html">Talk:ZFS</a>)</div>
</div>
<p>If you are not encrypting the root volume, but only the home volume or a user-specific volume, another idea is to <a rel="nofollow" class="external text" href="https://blog.trifork.com/2020/05/22/linux-homedir-encryption/">wait until login to decrypt it</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2024-11-06 ⓘ]</sup>.  The advantages of this method are that the system boots uninterrupted, and that when the user logs in, the same password can be used both to authenticate and to decrypt the home volume, so that the password is only entered once.
</p>
<p>First set the mountpoint to legacy to avoid having it mounted by <code>zfs mount -a</code>:
</p>
<pre>zfs set mountpoint=legacy zroot/data/home</pre>
<p>Ensure that it is in /etc/fstab so that <code>mount /home</code> will work:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">zroot/data/home         /home           zfs             rw,xattr,posixacl,noauto        0 0</pre>
<p>Alternatively, you can keep using ZFS mounts if you use both:
</p>
<pre>zfs set canmount=noauto zroot/data/home
zfs set org.openzfs.systemd:ignore=on zroot/data/home</pre>
<p>The first will stop ZFS automatically mounting it, and the second systemd, but you will still be able to manually (or through the following scripts) mount it. If you have child datasets, <code>org.openzfs.systemd:ignore=on</code> will be inherited, but you will need to set <code>canmount=noauto</code> on each as it is not inheritable, otherwise they will try to mount without a mountpoint.
</p>
<p>On a single-user system, with only one <code>/home</code> volume having the same encryption password as the user's password, it can be decrypted at login as follows: first create <code>/usr/local/bin/mount-zfs-homedir</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/local/bin/mount-zfs-homedir</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash
set -eu

# $PAM_USER will be the username of the user, you can use it for per-user home volumes.
HOME_VOLUME="zroot/data/home" 

if [ "$(zfs get keystatus "${HOME_VOLUME}" -Ho value)" != "available" ]; then
  PASSWORD=$(cat -)
  zfs load-key "${HOME_VOLUME}" &lt;&lt;&lt; "$PASSWORD" || continue
fi

# This will also mount any child datasets, unless they use a different key.
echo "$(zfs list -rHo name,keystatus,mounted "${HOME_VOLUME}")" | while IFS=$'\t' read -r NAME KEYSTATUS MOUNTED; do
  if [ "${MOUNTED}" != "yes" ] &amp;&amp; [ "${KEYSTATUS}" == "available" ]; then
    zfs mount "${NAME}" || true
  fi
done</pre>
<p>do not forget to make it <a href="../en/Help:Reading.html#Make_executable" class="mw-redirect" title="Executable">executable</a>; then get PAM to run it by adding the following line to /etc/pam.d/system-auth:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/system-auth</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">auth       optional                    pam_exec.so          expose_authtok /usr/local/bin/mount-zfs-homedir
</pre>
<p>Now it will transparently decrypt and mount the /home volume when you log in anywhere: on the console, via ssh, etc.
</p>
<h5><span class="mw-headline" id="SSH">SSH</span></h5>
<p>A caveat is that since your <code>~/.ssh</code> directory is not mounted, if you log in via ssh, you must use  password authentication the first time rather than relying on <code>~/.ssh/authorized_keys</code>.
</p>
<p>If you do not wish to enable (insecure) password authentication, you can instead move <code>~/.ssh/authorized_keys</code> to a new location. Make <code>/etc/ssh/user_config/</code> and inside it a folder for each user, owned by that user and with <code>700</code> permissions. Then move each user's <code>authorized_keys</code> into their respective folders, and edit the system sshd configuration:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">AuthorizedKeysFile /etc/ssh/user_config/%u/authorized_keys</pre>
<p>Then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>sshd.service</code>. You can also optionally make a link for each user from <code>~/.ssh/authorized_keys</code> to the new location so users can still edit it as they are used to.
</p>
<p>This will let you log in, but your home partition will not be mounted, and you will need to do so manually. There are multiple options to work around this:
</p>
<h6>
<span id="SSH_Key_.26_Password_when_required"></span><span class="mw-headline" id="SSH_Key_&amp;_Password_when_required">SSH Key &amp; Password when required</span>
</h6>
<p>It is possible to set up PAM to only prompt for a password via SSH when it is necessary to decrypt your home partition. You will need to enable both <code>publickey</code> and <code>keyboard-interactive</code> authentication methods:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PubkeyAuthentication yes
KbdInteractiveAuthentication yes
AuthenticationMethods publickey,keyboard-interactive

## Example of excluding a certain user who does not have an encrypted home directory.
#Match User nohome
#  KbdInteractiveAuthentication no
#  AuthenticationMethods publickey</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Note the comma in <code>AuthenticationMethods publickey,keyboard-interactive</code>, this means that you need to do <i>both</i> authentication methods to log in with SSH. The very similar <code>AuthenticationMethods publickey keyboard-interactive</code> means you can do <b>either</b> to log in, which would let someone bypass your public key auth.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You may ask why <code>keyboard-interactive</code> and not <code>password</code>? <code>password</code> is done client-side, so even if the auth is skipped, the user is still prompted and the password is just thrown away. With <code>keyboard-interactive</code> the user does not get prompted at all when we skip it.</div> 
<p>This will mean it asks for the password after validating the key, but using PAM we can stop it asking for the password when not needed. We make a script that will fail when the key is not available to us:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/local/bin/require-encrypted-homedir</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash
set -eu

HOME_VOLUME="zroot/data/home" # You can use $PAM_USER to use the username in the volume for a per-user solution.

if [ "$(zfs get keystatus "${HOME_VOLUME}" -Ho value)" != "available" ]; then
  exit 27 # PAM_TRY_AGAIN
elif [[ "${SSH_AUTH_INFO_0:-""}" =~ ^"publickey " ]]; then
  exit 0
else
  # If this happens, it implies a configuration error: either you are allowing auth without a public 
  # key, or have enabled this in a non-SSH PAM service. Both are dangerous and this should block it, 
  # but if you see it, fix your configuration.
  exit 3 # PAM_SERVICE_ERR
fi</pre>
<p>And make it <a href="../en/Help:Reading.html#Make_executable" class="mw-redirect" title="Executable">executable</a>.
</p>
<p>Now we want to configure PAM to call this, and skip asking for the password if the script succeeds because we already have the key available. Add this line above the existing auth line(s) you want to skip (all of them unless you have something else set up) for the SSH service:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/sshd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">auth sufficient pam_exec.so /usr/local/bin/require-encrypted-homedir</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> This is for <code>/etc/pam.d/sshd</code> <b>not</b> <code>/etc/pam.d/system-auth</code> as above. You do not want local users without a public key to be able to skip the password. There a safeguard in the script against this, but still best to be careful.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> When using private keys, the auth step is skipped in PAM as the private key authentication is handled entirely by <code>sshd</code>. This means that the script we are adding here will never be run for private keys and they cannot be skipped, however, we still do a check for defence-in-depth to try and ensure a key has been checked.</div> 
<p>With this, you will be prompted for a password only when the key is not loaded.
</p>
<h6>
<span id="SSH_Key_.26_Password"></span><span class="mw-headline" id="SSH_Key_&amp;_Password">SSH Key &amp; Password</span>
</h6>
<p>A simpler option is to just enable both methods, meaning your key still gets checked, but then you have to type the password too, which will decrypt your home partition.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PubkeyAuthentication yes
PasswordAuthentication yes
AuthenticationMethods publickey,password</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Note the comma in <code>AuthenticationMethods publickey,password</code>, this means that you need to do <i>both</i> authentication methods to log in with SSH. The very similar <code>AuthenticationMethods publickey password</code> means you can do <b>either</b> to log in, which would let someone bypass your public key auth.</div>
<p>This works (and will not let anyone authenticate with <i>just</i> a password), but has the downside of requiring your password every time.
</p>
<p>You can also specify something like:
</p>
<pre>AuthenticationMethods publickey password,publickey</pre>
<p>This allows clients to either use either just a public key, or one and a password. Which the client will do will be based on the <code>PreferredAuthentications</code> option. <code>-o PreferredAuthentications=password,publickey</code> will ask for the password, while <code>-o PreferredAuthentications=publickey</code> will not. This is more manual than automated fallback, but has less moving parts, and avoids asking you every time if you prefer <code>publickey</code> by default (you can use <a href="../en/OpenSSH.html#Configuration" title="OpenSSH">host-specific options</a> on clients to simplify setting these options).
</p>
<h3><span class="mw-headline" id="Swap_volume">Swap volume</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> 
<ul>
<li>On systems with extremely high memory pressure, using a zvol for swap can result in lockup, regardless of how much swap is still available. This issue is currently being investigated in <a rel="nofollow" class="external text" href="https://github.com/openzfs/zfs/issues/7734">OpenZFS issue #7734</a>
</li>
<li>Swap on zvol does not support resume from hibernation, attempt to resume will result in pool corruption. Possible workaround: <a rel="nofollow" class="external free" href="https://github.com/openzfs/zfs/issues/260#issuecomment-758782144">https://github.com/openzfs/zfs/issues/260#issuecomment-758782144</a>
</li>
</ul>
</div>
<p>ZFS does not allow to use swapfiles, but users can use a ZFS volume (ZVOL) as swap. It is important to set the ZVOL block size to match the system page size, which can be obtained by the <code>getconf PAGESIZE</code> command (default on x86_64 is 4KiB). Another option useful for keeping the system running well in low-memory situations is not caching the ZVOL data.
</p>
<p>Create a 8 GiB zfs volume:
</p>
<pre># zfs create -V 8G -b $(getconf PAGESIZE) -o compression=zle \
              -o logbias=throughput -o sync=always\
              -o primarycache=metadata -o secondarycache=none \
              -o com.sun:auto-snapshot=false &lt;pool&gt;/swap
</pre>
<p>Prepare it as swap partition:
</p>
<pre># mkswap -f /dev/zvol/&lt;pool&gt;/swap
# swapon /dev/zvol/&lt;pool&gt;/swap
</pre>
<p>To make it permanent, edit <code>/etc/fstab</code>. ZVOLs support discard, which can potentially help ZFS's block allocator and reduce fragmentation for all other datasets when/if swap is not full.
</p>
<p>Add a line to <code>/etc/fstab</code>:
</p>
<pre>/dev/zvol/&lt;pool&gt;/swap none swap discard 0 0
</pre>
<h3><span class="mw-headline" id="Access_Control_Lists">Access Control Lists</span></h3>
<p>To use <a href="../en/Access_Control_Lists.html" class="mw-redirect" title="ACL">ACL</a> on a dataset:
</p>
<pre># zfs set acltype=posixacl &lt;nameofzpool&gt;/&lt;nameofdataset&gt;
# zfs set xattr=sa &lt;nameofzpool&gt;/&lt;nameofdataset&gt;
</pre>
<p>Setting <code>xattr</code> is recommended for performance reasons <a rel="nofollow" class="external autonumber" href="https://github.com/openzfs/zfs/issues/170#issuecomment-27348094">[1]</a>.
</p>
<p>It may be preferable to enable ACL on the zpool as datasets will inherit the ACL parameters. Setting <code>aclinherit=passthrough</code> may be wanted as the default mode is <code>restricted</code> <a rel="nofollow" class="external autonumber" href="https://docs.oracle.com/cd/E19120-01/open.solaris/817-2271/gbaaz/index.html">[2]</a>; however, it is worth noting that <code>aclinherit</code> does not affect POSIX ACLs <a rel="nofollow" class="external autonumber" href="https://askubuntu.com/questions/342553/activate-acl-for-zfs-pool-ubuntu-13-04#comment1220577_392008">[3]</a>:
</p>
<pre># zfs set aclinherit=passthrough &lt;nameofzpool&gt;
# zfs set acltype=posixacl &lt;nameofzpool&gt;
# zfs set xattr=sa &lt;nameofzpool&gt;
</pre>
<h3><span class="mw-headline" id="Databases">Databases</span></h3>
<p>ZFS, unlike most other file systems, has a variable record size, or what is commonly referred to as a block size. By default, the recordsize on ZFS is 128KiB, which means it will dynamically allocate blocks of any size from 512B to 128KiB depending on the size of file being written. This can often help fragmentation and file access, at the cost that ZFS would have to allocate new 128KiB blocks each time only a few bytes are written to.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> At least MariaDB uses a default of 16Kib pages! Check your specific DBMS before setting this value. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:ZFS.html">Talk:ZFS</a>)</div>
</div>
<p>Most RDBMSes work in 8KiB-sized blocks by default. Although the block size is tunable for <a href="../en/MySQL.html" title="MySQL">MySQL/MariaDB</a>, <a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a>, and Oracle database, all three of them use an 8KiB block size <i>by default</i>. For both performance concerns and keeping snapshot differences to a minimum (for backup purposes, this is helpful), it is usually desirable to tune ZFS instead to accommodate the databases, using a command such as:
</p>
<pre># zfs set recordsize=8K &lt;pool&gt;/postgres
</pre>
<p>These RDBMSes also tend to implement their own caching algorithm, often similar to ZFS's own ARC. In the interest of saving memory, it is best to simply disable ZFS's caching of the database's file data and let the database do its own job:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <a href="#L2ARC">L2ARC</a> requires <code>primarycache</code> to function, because it is fed with data evicted from <code>primarycache</code>. If you intend to use the L2ARC, do not set the option below, otherwise no actual data will be cached on L2ARC.</div>
<pre># zfs set primarycache=metadata &lt;pool&gt;/postgres
</pre>
<p>ZFS uses the <a href="#ZIL">ZIL</a> for crash recovery, but databases are often syncing their data files to the file system on their own transaction commits anyway. The end result of this is that ZFS will be committing data <b>twice</b> to the data disks, and it can severely impact performance. You can tell ZFS to prefer to not use the ZIL, and in which case, data is only committed to the file system once. However, doing so on non-solid state storage (e.g. HDDs) can result in decreased read performance due to fragmentation (<a rel="nofollow" class="external text" href="https://openzfs.org/wiki/ZFS_on_high_latency_devices">OpenZFS Wiki</a>) -- with mechanical hard drives, please consider using a dedicated SSD as <a href="#ZIL">ZIL</a> rather than setting the option below. In addition, setting this for non-database file systems, or for pools with configured log devices, can also <i>negatively</i> impact the performance, so beware:
</p>
<pre># zfs set logbias=throughput &lt;pool&gt;/postgres
</pre>
<p>These can also be done at file system creation time, for example:
</p>
<pre># zfs create -o recordsize=8K \
             -o primarycache=metadata \
             -o mountpoint=/var/lib/postgres \
             -o logbias=throughput \
              &lt;pool&gt;/postgres
</pre>
<p>Please note: these kinds of tuning parameters are ideal for specialized applications like RDBMSes. You can easily <i>hurt</i> ZFS's performance by setting these on a general-purpose file system such as your /home directory.
</p>
<h3>
<span id=".2Ftmp"></span><span class="mw-headline" id="/tmp">/tmp</span>
</h3>
<p>If you would like to use ZFS to store your /tmp directory, which may be useful for storing arbitrarily-large sets of files or simply keeping your RAM free of idle data, you can generally improve performance of certain applications writing to /tmp by disabling file system sync. This causes ZFS to ignore an application's sync requests (eg, with <code>fsync</code> or <code>O_SYNC</code>) and return immediately. While this has severe application-side data consistency consequences (never disable sync for a database!), files in /tmp are less likely to be important and affected. Please note this does <i>not</i> affect the integrity of ZFS itself, only the possibility that data an application expects on-disk may not have actually been written out following a crash.
</p>
<pre># zfs set sync=disabled &lt;pool&gt;/tmp
</pre>
<p>Additionally, for security purposes, you may want to disable <b>setuid</b> and <b>devices</b> on the /tmp file system, which prevents some kinds of privilege-escalation attacks or the use of device nodes:
</p>
<pre># zfs set setuid=off &lt;pool&gt;/tmp
# zfs set devices=off &lt;pool&gt;/tmp
</pre>
<p>Combining all of these for a create command would be as follows:
</p>
<pre># zfs create -o setuid=off -o devices=off -o sync=disabled -o mountpoint=/tmp &lt;pool&gt;/tmp
</pre>
<p>Please note, also, that if you want /tmp on ZFS, you will need to <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Mask">mask</a> (disable) <a href="../en/Systemd.html" title="Systemd">systemd</a>'s automatic tmpfs-backed /tmp (<code>tmp.mount</code>, else ZFS will be unable to mount your dataset at boot-time or import-time.
</p>
<h3><span class="mw-headline" id="Transmitting_snapshots_with_ZFS_Send_and_ZFS_Recv">Transmitting snapshots with ZFS Send and ZFS Recv</span></h3>
<p>It is possible to pipe ZFS snapshots to an arbitrary target by pairing <code>zfs send</code> and <code>zfs recv</code>. This is done through standard output, which allows the data to be sent to any file, device, across the network, or manipulated mid-stream by incorporating additional programs in the pipe. 
</p>
<p>Below are examples of common scenarios:
</p>
<h4><span class="mw-headline" id="Basic_ZFS_Send">Basic ZFS Send</span></h4>
<p>First, create a snapshot of some ZFS filesystem:
</p>
<pre># zfs snapshot zpool0/archive/books@snap
</pre>
<p>Now send the snapshot to a new location on a different zpool:
</p>
<pre># zfs send -v zpool0/archive/books@snap | zfs recv zpool4/library
</pre>
<p>The contents of <code>zpool0/archive/books@snap</code> are now live at <code>zpool4/library</code>
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  See <a rel="nofollow" class="external text" href="https://openzfs.github.io/openzfs-docs/man/8/zfs-send.8.html">man zfs-send</a> and <a rel="nofollow" class="external text" href="https://openzfs.github.io/openzfs-docs/man/8/zfs-recv.8.html">man zfs-recv</a> for details on flags.</div>
<h5><span class="mw-headline" id="To_and_from_files">To and from files</span></h5>
<p>First, create a snapshot of some ZFS filesystem:
</p>
<pre># zfs snapshot zpool0/archive/books@snap
</pre>
<p>Write the snapshot to a gzip file:
</p>
<pre># zfs send zpool0/archive/books@snap &gt; /tmp/mybooks.gz
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Make sure to run <code>zfs send</code> with <code>-w</code> flag if you wish to preserve encryption during the send.</div>
<p>Now restore the snapshot from the file:
</p>
<pre># gzcat /tmp/mybooks.gz | zfs recv -F zpool0/archive/books
</pre>
<h4><span class="mw-headline" id="Send_over_ssh">Send over ssh</span></h4>
<p>First, create a snapshot of some ZFS filesystem:
</p>
<pre># zfs snapshot zpool1/filestore@snap
</pre>
<p>Next we pipe our "send" traffic over an ssh session running "recv":
</p>
<pre># zfs send -v zpool1/filestore@snap | ssh $HOST zfs recv coldstore/backups
</pre>
<p>The <code>-v</code> flag prints information about the datastream being generated. If you are using a passphrase or passkey, you will be prompted to enter it.
</p>
<h4><span class="mw-headline" id="Incremental_Backups">Incremental Backups</span></h4>
<p>You may wish update a previously sent ZFS filesystem without retransmitting all of the data over again. 
Alternatively, it may be necessary to keep a filesystem online during a lengthy transfer and it is now time to send writes that were made since the initial snapshot.
</p>
<p>First, create a snapshot of some ZFS filesystem:
</p>
<pre># zfs snapshot zpool1/filestore@initial
</pre>
<p>Next we pipe our "send" traffic over an ssh session running "recv":
</p>
<pre># zfs send -v -R zpool1/filestore@initial | ssh $HOST zfs recv coldstore/backups
</pre>
<p>Once changes are written, make another snapshot:
</p>
<pre># zfs snapshot zpool1/filestore@snap2
</pre>
<p>The following will send the differences that exist locally between zpool1/filestore@initial and zpool1/filestore@snap2 and create an additional snapshot for the remote filesystem coldstore/backups:
</p>
<pre># zfs send -v -i -R zpool1/filestore@initial | ssh $HOST zfs recv coldstore/backups
</pre>
<p>Now both zpool1/filestore and coldstore/backups have the @initial and @snap2 snapshots.
</p>
<p>On the remote host, you may now promote the latest snapshot to become the active filesystem:
</p>
<pre># rollback coldstore/backups@snap2
</pre>
<h2><span class="mw-headline" id="Tuning">Tuning</span></h2>
<h3><span class="mw-headline" id="General">General</span></h3>
<p>ZFS pools and datasets can be further adjusted using parameters.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> All settable properties, with the exception of quotas and reservations, inherit their value from the parent dataset.</div>
<p>To retrieve the current pool parameter status:
</p>
<pre># zfs get all &lt;pool&gt;
</pre>
<p>To retrieve the current dataset parameter status:
</p>
<pre># zfs get all &lt;pool&gt;/&lt;dataset&gt;
</pre>
<p>To disable access time (atime), which is enabled by default:
</p>
<pre># zfs set atime=off &lt;pool&gt;
</pre>
<p>To disable access time (atime) on a particular dataset:
</p>
<pre># zfs set atime=off &lt;pool&gt;/&lt;dataset&gt;
</pre>
<p>An alternative to turning off atime completely, <code>relatime</code> is available. This brings the default ext4/XFS atime semantics to ZFS, where access time is only updated if the modified time or changed time changes, or if the existing access time has not been updated within the past 24 hours. It is a compromise between <code>atime=off</code> and <code>atime=on</code>. This property <i>only</i> takes effect if <code>atime</code> is <code>on</code>:
</p>
<pre># zfs set atime=on &lt;pool&gt;
# zfs set relatime=on &lt;pool&gt;
</pre>
<p>Compression is just that, transparent compression of data. ZFS supports a few different algorithms, presently lz4 is the default, <i>gzip</i> is also available for seldom-written yet highly-compressible data; consult the <a rel="nofollow" class="external text" href="https://openzfs.github.io/openzfs-docs/Performance%20and%20Tuning/Workload%20Tuning.html">OpenZFS Wiki</a> for more details.
</p>
<p>To enable compression:
</p>
<pre># zfs set compression=on &lt;pool&gt;
</pre>
<p>To reset a property of a pool and/or dataset to its default state, use <code>zfs inherit</code>:
</p>
<pre># zfs inherit -rS atime &lt;pool&gt;
# zfs inherit -rS atime &lt;pool&gt;/&lt;dataset&gt;
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Using the <code>-r</code> flag will recursively reset all datasets of the zpool.</div>
<h3><span class="mw-headline" id="Scrubbing">Scrubbing</span></h3>
<p>Whenever data is read and ZFS encounters an error, it is silently repaired when possible, rewritten back to disk and logged so you can obtain an overview of errors on your pools. There is no fsck or equivalent tool for ZFS. Instead, ZFS supports a feature known as scrubbing. This traverses through all the data in a pool and verifies that all blocks can be read.
</p>
<p>To scrub a pool:
</p>
<pre># zpool scrub &lt;pool&gt;
</pre>
<p>To cancel a running scrub:
</p>
<pre># zpool scrub -s &lt;pool&gt;
</pre>
<h4>
<span id="How_often_should_I_do_this.3F"></span><span class="mw-headline" id="How_often_should_I_do_this?">How often should I do this?</span>
</h4>
<p>From the Oracle blog post <a rel="nofollow" class="external text" href="https://blogs.oracle.com/wonders-of-zfs-storage/disk-scrub-why-and-when-v2">Disk Scrub - Why and When?</a>:
</p>
<dl><dd>This question is challenging for Support to answer, because as always the true answer is "It Depends". So before I offer a general guideline, here are a few tips to help you create an answer more tailored to your use pattern.</dd></dl>
<dl><dd><ul>
<li>What is the expiration of your oldest backup? You should probably scrub your data at least as often as your oldest tapes expire so that you have a known-good restore point.</li>
<li>How often are you experiencing disk failures? While the recruitment of a hot-spare disk invokes a "resilver" -- a targeted scrub of just the VDEV which lost a disk -- you should probably scrub at least as often as you experience disk failures on average in your specific environment.</li>
<li>How often is the oldest piece of data on your disk read? You should scrub occasionally to prevent very old, very stale data from experiencing bit-rot and dying without you knowing it.</li>
</ul></dd></dl>
<dl><dd>If any of your answers to the above are "I do not know", the general guideline is: you should probably be scrubbing your zpool at least once per month. It is a schedule that works well for most use cases, provides enough time for scrubs to complete before starting up again on all but the busiest &amp; most heavily-loaded systems, and even on very large zpools (192+ disks) should complete fairly often between disk failures.</dd></dl>
<p>In the <a rel="nofollow" class="external text" href="https://pthree.org/2012/12/11/zfs-administration-part-vi-scrub-and-resilver/">ZFS Administration Guide</a> by Aaron Toponce, he advises to scrub consumer disks once a week.
</p>
<h4><span class="mw-headline" id="Start_with_a_service_or_timer">Start with a service or timer</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Starting with OpenZFS 2.1.3 weekly and monthly <a href="../en/Systemd.html" title="Systemd">systemd</a> timers/services are included. To use these <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a>/<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> <code>zfs-scrub-weekly@<i>pool-to-scrub</i>.timer</code> or <code>zfs-scrub-monthly@<i>pool-to-scrub</i>.timer</code> for the desired pool.</div>
<p>Using a <a href="../en/Systemd.html" title="Systemd">systemd</a> timer/service it is possible to automatically scrub pools.
</p>
<p>To perform scrubbing monthly on a particular pool:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/zfs-scrub@.timer</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Monthly zpool scrub on %i

[Timer]
OnCalendar=monthly
AccuracySec=1h
Persistent=true

[Install]
WantedBy=multi-user.target</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/zfs-scrub@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=zpool scrub on %i

[Service]
Nice=19
IOSchedulingClass=idle
KillSignal=SIGINT
ExecStart=/usr/bin/zpool scrub %i

[Install]
WantedBy=multi-user.target</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">Enable</a>/<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> <code>zfs-scrub@<i>pool-to-scrub</i>.timer</code> unit for monthly scrubbing the specified zpool.
</p>
<h3><span class="mw-headline" id="Enabling_TRIM">Enabling TRIM</span></h3>
<p>To quickly query your vdevs <a href="../en/Solid_state_drive.html#TRIM" class="mw-redirect" title="TRIM">TRIM</a> support, you can include trimming information in <code>zpool status</code> with <code>-t</code>. 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ zpool status -t tank</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">pool: tank
 state: ONLINE
  scan: none requested
 config:

	NAME                                     STATE     READ WRITE CKSUM
	tank                                     ONLINE       0     0     0
	  ata-ST31000524AS_5RP4SSNR-part1        ONLINE       0     0     0  (trim unsupported)
	  ata-CT480BX500SSD1_2134A59B933D-part1  ONLINE       0     0     0  (untrimmed)

errors: No known data errors</pre>
<p>ZFS is capable of trimming supported vdevs either on-demand or periodically via the <code>autotrim</code> property.
</p>
<p>Manually performing a TRIM operation on a zpool:
</p>
<pre> # zpool trim &lt;zpool&gt;
</pre>
<p>Enabling periodic trimming on all supported vdevs in a pool:
</p>
<pre> # zpool set autotrim=on &lt;zpool&gt;
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Because of how the automatic TRIM and a full <code>zpool trim</code> differ in their operation, <a rel="nofollow" class="external text" href="https://github.com/openzfs/zfs/commit/1b939560be5c51deecf875af9dada9d094633bf7">it can make sense to run a manual trim occasionally.</a> </div>
<p>To perform a full <code>zpool trim</code> monthly on a particular pool using a <a href="../en/Systemd.html" title="Systemd">systemd</a> timer/service:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/zfs-trim@.timer</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Monthly zpool trim on %i

[Timer]
OnCalendar=monthly
AccuracySec=1h
Persistent=true

[Install]
WantedBy=multi-user.target</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/zfs-trim@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=zpool trim on %i
Documentation=man:zpool-trim(8)
Requires=zfs.target
After=zfs.target
ConditionACPower=true
ConditionPathIsDirectory=/sys/module/zfs

[Service]
Nice=19
IOSchedulingClass=idle
KillSignal=SIGINT
ExecStart=/bin/sh -c '\
if /usr/bin/zpool status %i | grep "trimming"; then\
exec /usr/bin/zpool wait -t trim %i;\
else exec /usr/bin/zpool trim -w %i; fi'
ExecStop=-/bin/sh -c '/usr/bin/zpool trim -s %i 2&gt;/dev/null || true'

[Install]
WantedBy=multi-user.target</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">Enable</a>/<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> <code>zfs-trim@<i>pool-to-trim</i>.timer</code> unit for monthly trimming of the specified zpool.
</p>
<h3><span class="mw-headline" id="SSD_Caching">SSD Caching</span></h3>
<p>If your pool has no configured log devices, ZFS reserves space on the pool's data disks for its intent log (the ZIL, also called SLOG). If your data disks are slow (e.g. HDD) it is highly recommended to configure the ZIL on solid state drives for better write performance and also to consider a layer 2 adaptive replacement cache (L2ARC). The process to add them is very similar to adding a new VDEV.
</p>
<p>All of the below references to device-id are the IDs from <code>/dev/disk/by-id/*</code>.
</p>
<h4><span class="mw-headline" id="ZIL">ZIL</span></h4>
<p>To add a mirrored ZIL:
</p>
<pre> # zpool add &lt;pool&gt; log mirror &lt;device-id-1&gt; &lt;device-id-2&gt;
</pre>
<p>Or to add a single device ZIL:
</p>
<pre> # zpool add &lt;pool&gt; log &lt;device-id&gt;
</pre>
<p>Because the ZIL device stores data that has not been written to the pool, it is important to use devices that can finish writes when power is lost. It is also important to use redundancy, since a device failure can cause data loss. In addition, the ZIL is only used for sync writes, so may not provide any performance improvement when your data drives are as fast as your ZIL drive(s).
</p>
<h4><span class="mw-headline" id="L2ARC">L2ARC</span></h4>
<p>To add L2ARC:
</p>
<pre># zpool add &lt;pool&gt; cache &lt;device-id&gt;
</pre>
<p>L2ARC is only a read cache, so redundancy is unnecessary. Since <a rel="nofollow" class="external text" href="https://github.com/openzfs/zfs/releases/tag/zfs-2.0.0">ZFS version 2.0.0</a>, L2ARC is persisted across reboots.<a rel="nofollow" class="external autonumber" href="https://github.com/openzfs/zfs/pull/9582">[4]</a>
</p>
<p>L2ARC is generally only useful in workloads where the amount of hot data is <b>bigger</b> than system memory, but small enough to fit into L2ARC. The L2ARC is indexed by the ARC in system memory, consuming 70 bytes per record (default 128KiB). Thus, the equation for RAM usage is:
</p>
<pre>(L2ARC size) / (recordsize) * 70 bytes
</pre>
<p>Because of this, L2ARC can, in certain workloads, harm performance as it takes memory away from ARC.
</p>
<h3><span class="mw-headline" id="ZVOLs">ZVOLs</span></h3>
<p>ZFS volumes (ZVOLs) can suffer from the same block size-related issues as RDBMSes, but it is worth noting that the default recordsize for ZVOLs is 8 KiB already. If possible, it is best to align any partitions contained in a ZVOL to your recordsize (current versions of fdisk and gdisk by default automatically align at 1MiB segments, which works), and file system block sizes to the same size. Other than this, you might tweak the <b>recordsize</b> to accommodate the data inside the ZVOL as necessary (though 8 KiB tends to be a good value for most file systems, even when using 4 KiB blocks on that level).
</p>
<h4><span class="mw-headline" id="RAIDZ_and_Advanced_Format_physical_disks">RAIDZ and Advanced Format physical disks</span></h4>
<p>Each block of a ZVOL gets its own parity disks, and if you have physical media with logical block sizes of 4096B, 8192B, or so on, the parity needs to be stored in whole physical blocks, and this can drastically increase the space requirements of a ZVOL, requiring 2× or more physical storage capacity than the ZVOL's logical capacity. Setting the <b>recordsize</b> to 16k or 32k can help reduce this footprint drastically.
</p>
<p>See <a rel="nofollow" class="external text" href="https://github.com/openzfs/zfs/issues/1807">OpenZFS issue #1807</a> for details.
</p>
<h3>
<span id="I.2FO_Scheduler"></span><span class="mw-headline" id="I/O_Scheduler">I/O Scheduler</span>
</h3>
<p>While ZFS is expected to work well with modern schedulers including, <code>mq-deadline</code>, and <code>none</code>, experimenting with <a href="../en/Improving_performance.html#Changing_I/O_scheduler" title="Improving performance">manually setting</a> the I/O scheduler on ZFS disks may yield performance gains. The ZFS recomendation is "[...] users leave the default scheduler <a rel="nofollow" class="external text" href="https://github.com/openzfs/zfs/issues/9778#issuecomment-569347505">“unless you’re encountering a specific problem, or have clearly measured a performance improvement for your workload”</a>"<a rel="nofollow" class="external autonumber" href="https://openzfs.github.io/openzfs-docs/Performance%20and%20Tuning/Module%20Parameters.html#zfs-vdev-scheduler">[5]</a>
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Creating_a_zpool_fails">Creating a zpool fails</span></h3>
<p>If the following error occurs then it can be fixed.
</p>
<pre># the kernel failed to rescan the partition table: 16
# cannot label 'sdc': try using parted(8) and then provide a specific slice: -1
</pre>
<p>One reason this can occur is because ZFS expects pool creation to take less than 1 second<a rel="nofollow" class="external autonumber" href="https://github.com/openzfs/zfs/issues/2582">[6]</a><a rel="nofollow" class="external autonumber" href="https://github.com/openzfs/zfs/issues/1646">[7]</a>. This is a reasonable assumption under ordinary conditions, but in many situations it may take longer. Each drive will need to be cleared again before another attempt can be made.
</p>
<pre># parted /dev/sda rm 1
# parted /dev/sda rm 1
# dd if=/dev/zero of=/dev/sdb bs=512 count=1
# zpool labelclear /dev/sda
</pre>
<p>A brute force creation can be attempted over and over again, and with some luck the ZPool creation will take less than 1 second.
One cause for creation slowdown can be slow burst read writes on a drive. By reading from the disk in parallell to ZPool creation, it may be possible to increase burst speeds.
</p>
<pre># dd if=/dev/sda of=/dev/null
</pre>
<p>This can be done with multiple drives by saving the above command for each drive to a file on separate lines and running 
</p>
<pre># cat $FILE | parallel
</pre>
<p>Then run ZPool creation at the same time.
</p>
<h3><span class="mw-headline" id="ZFS_is_using_too_much_RAM">ZFS is using too much RAM</span></h3>
<p>By default, ZFS caches file operations (<a href="https://en.wikipedia.org/wiki/Adaptive_replacement_cache" class="extiw" title="wikipedia:Adaptive replacement cache">ARC</a>) using up to half of available system memory on the host. To adjust the ARC size, add the following to the <a href="../en/Kernel_parameters.html" title="Kernel parameters">Kernel parameters</a> list:
</p>
<pre>zfs.zfs_arc_max=536870912 # (for 512MiB)
</pre>
<p>In case that the default value of <code>zfs_arc_min</code> (1/32 of system memory) is higher than the specified <code>zfs_arc_max</code> it is needed to add also the following to the <a href="../en/Kernel_parameters.html" title="Kernel parameters">Kernel parameters</a> list:
</p>
<pre>zfs.zfs_arc_min=268435456 # (for 256MiB, needs to be lower than zfs.zfs_arc_max)
</pre>
<p>You may also want to increase <code>zfs_arc_sys_free</code> instead (in this example to 8GiB):
</p>
<pre># echo $((8*1024**3)) &gt; /sys/module/zfs/parameters/zfs_arc_sys_free
</pre>
<p>For a more detailed description, as well as other configuration options, see <a href="https://wiki.gentoo.org/wiki/ZFS#ARC" class="extiw" title="gentoo:ZFS">Gentoo:ZFS#ARC</a>.
</p>
<p>ZFS should release ARC as applications reserve more RAM, but some applications still <a rel="nofollow" class="external text" href="https://github.com/openzfs/zfs/issues/10255">get confused</a>, and reported <a rel="nofollow" class="external text" href="https://github.com/openzfs/zfs/issues/10251">free RAM is always wrong</a>. But in case all your applications work as intended and you have no problems, there is no need to change ARC settings.
</p>
<h3><span class="mw-headline" id="No_hostid_found">No hostid found</span></h3>
<p>An error that occurs at boot with the following lines appearing before initscript output:
</p>
<pre>ZFS: No hostid found on kernel command line or /etc/hostid.
</pre>
<p>This warning occurs because the ZFS module does not have access to the spl hosted. There are two solutions, for this. Either place the spl hostid in the <a href="../en/Kernel_parameters.html" title="Kernel parameters">kernel parameters</a> in the boot loader. For example, adding <code>spl.spl_hostid=0x00bab10c</code>.
</p>
<p>The other solution is to make sure that there is a hostid in <code>/etc/hostid</code>, and then <a href="../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">regenerate the initramfs</a> image. Which will copy the hostid into the initramfs image.
</p>
<h3>
<span id="Pool_cannot_be_found_while_booting_from_SAS.2FSCSI_devices"></span><span class="mw-headline" id="Pool_cannot_be_found_while_booting_from_SAS/SCSI_devices">Pool cannot be found while booting from SAS/SCSI devices</span>
</h3>
<p>In case you are booting a SAS/SCSI based, you might occassionally get boot problems where the pool you are trying to boot from cannot be found. A likely reason for this is that your devices are initialized too late into the process. That means that zfs cannot find any devices at the time when it tries to assemble your pool.
</p>
<p>In this case you should force the scsi driver to wait for devices to come online before continuing. You can do this by putting this into <code>/etc/modprobe.d/zfs.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/zfs.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options scsi_mod scan=sync</pre>
<p>Afterwards, <a href="../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">regenerate the initramfs</a>.
</p>
<p>This works because the zfs hook will copy the file at <code>/etc/modprobe.d/zfs.conf</code> into the initcpio which will then be used at build time.
</p>
<h3>
<span id="On_boot_the_zfs_pool_does_not_mount_stating:_.22pool_may_be_in_use_from_other_system.22"></span><span class="mw-headline" id='On_boot_the_zfs_pool_does_not_mount_stating:_"pool_may_be_in_use_from_other_system"'>On boot the zfs pool does not mount stating: "pool may be in use from other system"</span>
</h3>
<h4><span class="mw-headline" id="Unexported_pool">Unexported pool</span></h4>
<p>If the new installation does not boot because the zpool cannot be imported, chroot into the installation and properly export the zpool. See <a href="#Emergency_chroot_repair_with_archzfs">#Emergency chroot repair with archzfs</a>.
</p>
<p>Once inside the chroot environment, load the ZFS module and force import the zpool,
</p>
<pre># zpool import -a -f
</pre>
<p>now export the pool:
</p>
<pre># zpool export &lt;pool&gt;
</pre>
<p>To see the available pools, use,
</p>
<pre># zpool status
</pre>
<p>It is necessary to export a pool because of the way ZFS uses the hostid to track the system the zpool was created on. The hostid is generated partly based on the network setup. During the installation in the archiso the network configuration could be different generating a different hostid than the one contained in the new installation. Once the zfs filesystem is exported and then re-imported in the new installation, the hostid is reset. See <a rel="nofollow" class="external text" href="https://web.archive.org/web/20151101094022/http://osdir.com/ml/zfs-discuss/2011-06/msg00227.html">Re: Howto zpool import/export automatically? - msg#00227</a>.
</p>
<p>If ZFS complains about "pool may be in use" after every reboot, properly export pool as described above, and then <a href="../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">regenerate the initramfs</a> in normally booted system.
</p>
<h4><span class="mw-headline" id="Incorrect_hostid">Incorrect hostid</span></h4>
<p>Double check that the pool is properly exported. Exporting the zpool clears the hostid marking the ownership. So during the first boot the zpool should mount correctly. If it does not there is some other problem.
</p>
<p>Reboot again, if the zfs pool refuses to mount it means the hostid is not yet correctly set in the early boot phase and it confuses zfs. Manually tell zfs the correct number, once the hostid is coherent across the reboots the zpool will mount correctly.
</p>
<p>Boot using zfs_force and write down the hostid. This one is just an example.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ hostid</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">0a0af0f8
</pre>
<p>This number have to be added to the <a href="../en/Kernel_parameters.html" title="Kernel parameters">kernel parameters</a> as <code>spl.spl_hostid=0x0a0af0f8</code>. Another solution is writing the hostid inside the initram image, see the <a href="../en/Install_Arch_Linux_on_ZFS.html#Configure_systemd_ZFS_mounts" title="Install Arch Linux on ZFS">installation guide</a><sup>[<a href="../en/Help:Procedures.html#Fix_broken_section_links" title="Help:Procedures">broken link</a>: invalid section]</sup> explanation about this.
</p>
<p>Users can always ignore the check adding <code>zfs_force=1</code> in the <a href="../en/Kernel_parameters.html" title="Kernel parameters">kernel parameters</a>, but it is not advisable as a permanent solution.
</p>
<h3><span class="mw-headline" id="Devices_have_different_sector_alignment">Devices have different sector alignment</span></h3>
<p>Once a drive has become faulted it should be replaced A.S.A.P. with an identical drive.
</p>
<pre># zpool replace bigdata ata-ST3000DM001-9YN166_S1F0KDGY ata-ST3000DM001-1CH166_W1F478BD -f
</pre>
<p>but in this instance, the following error is produced:
</p>
<pre>cannot replace ata-ST3000DM001-9YN166_S1F0KDGY with ata-ST3000DM001-1CH166_W1F478BD: devices have different sector alignment
</pre>
<p>ZFS uses the ashift option to adjust for physical block size. When replacing the faulted disk, ZFS is attempting to use <code>ashift=12</code>, but the faulted disk is using a different ashift (probably <code>ashift=9</code>) and this causes the resulting error. 
</p>
<p>For Advanced Format disks with 4 KiB block size, an <code>ashift</code> of <code>12</code> is recommended for best performance. See <a rel="nofollow" class="external text" href="https://openzfs.github.io/openzfs-docs/Project%20and%20Community/FAQ.html#performance-considerations">OpenZFS FAQ: Performance Considerations</a> and <a rel="nofollow" class="external text" href="https://web.archive.org/web/20170913063528/https://wiki.illumos.org/display/illumos/ZFS+and+Advanced+Format+disks">ZFS and Advanced Format disks</a>.
</p>
<p>Use zdb to find the ashift of the zpool: <code>zdb </code>, then use the <code>-o</code> argument to set the ashift of the replacement drive:
</p>
<pre># zpool replace bigdata ata-ST3000DM001-9YN166_S1F0KDGY ata-ST3000DM001-1CH166_W1F478BD -o ashift=9 -f
</pre>
<p>Check the zpool status for confirmation:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># zpool status -v</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">pool: bigdata
state: DEGRADED
status: One or more devices is currently being resilvered.  The pool will
        continue to function, possibly in a degraded state.
action: Wait for the resilver to complete.
scan: resilver in progress since Mon Jun 16 11:16:28 2014
    10.3G scanned out of 5.90T at 81.7M/s, 20h59m to go
    2.57G resilvered, 0.17% done
config:

        NAME                                   STATE     READ WRITE CKSUM
        bigdata                                DEGRADED     0     0     0
        raidz1-0                               DEGRADED     0     0     0
            replacing-0                        OFFLINE      0     0     0
            ata-ST3000DM001-9YN166_S1F0KDGY    OFFLINE      0     0     0
            ata-ST3000DM001-1CH166_W1F478BD    ONLINE       0     0     0  (resilvering)
            ata-ST3000DM001-9YN166_S1F0JKRR    ONLINE       0     0     0
            ata-ST3000DM001-9YN166_S1F0KBP8    ONLINE       0     0     0
            ata-ST3000DM001-9YN166_S1F0JTM1    ONLINE       0     0     0

errors: No known data errors
</pre>
<h3>
<span id="Pool_resilvering_stuck.2Frestarting.2Fslow.3F"></span><span class="mw-headline" id="Pool_resilvering_stuck/restarting/slow?">Pool resilvering stuck/restarting/slow?</span>
</h3>
<p>According to <a rel="nofollow" class="external text" href="https://github.com/openzfs/zfs/issues/840">ZFS issue #840</a>, this is a known issue since 2012 with ZFS-ZED which causes the resilvering process to constantly restart, sometimes get stuck and be generally slow for some hardware. The simplest mitigation is to stop zfs-zed.service until the resilver completes.
</p>
<h3><span class="mw-headline" id="Fix_slow_boot_caused_by_failed_import_of_unavailable_pools_in_the_initramfs_zpool.cache">Fix slow boot caused by failed import of unavailable pools in the initramfs zpool.cache</span></h3>
<p>Your boot time can be significantly impacted if you update your intitramfs (eg when doing a kernel update) when you have additional but non-permanently attached pools imported because these pools will get added to your initramfs zpool.cache and ZFS will attempt to import these extra pools on every boot, regardless of whether you have exported it and removed it from your regular zpool.cache.
</p>
<p>If you notice ZFS trying to import unavailable pools at boot, first run:
</p>
<pre>$ zdb -C
</pre>
<p>To check your zpool.cache for pools you do not want imported at boot. If this command is showing (a) additional, currently unavailable pool(s), run:
</p>
<pre># zpool set cachefile=/etc/zfs/zpool.cache zroot
</pre>
<p>To clear the zpool.cache of any pools other than the pool named zroot. Sometimes there is no need to refresh your zpool.cache, but instead all you need to do is <a href="../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">regenerate the initramfs</a>.
</p>
<h3><span class="mw-headline" id="ZFS_Command_History">ZFS Command History</span></h3>
<p>ZFS logs changes to a pool's structure natively as a log of executed commands in a ring buffer (which cannot be turned off).
The log may be helpful when restoring a degraded or failed pool.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># zpool history zpool</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">History for 'zpool':
2023-02-19.16:28:44 zpool create zpool raidz1 /scratch/disk_1.img /scratch/disk_2.img /scratch/disk_3.img
2023-02-19.16:31:29 zfs set compression=lz4 zpool
2023-02-19.16:41:45 zpool scrub zpool
2023-02-19.17:00:57 zpool replace zpool /scratch/disk_1.img /scratch/bigger_disk_1.img
2023-02-19.17:01:34 zpool scrub zpool
2023-02-19.17:01:42 zpool replace zpool /scratch/disk_2.img /scratch/bigger_disk_2.img
2023-02-19.17:01:46 zpool replace zpool /scratch/disk_3.img /scratch/bigger_disk_3.img
</pre>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Create_an_Archiso_image_with_ZFS_support">Create an Archiso image with ZFS support</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-go-next.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is a candidate for moving to <a href="../en/Install_Arch_Linux_on_ZFS.html#Embedding_ZFS_module_into_custom_archiso" title="Install Arch Linux on ZFS">Install Arch Linux on ZFS#Embedding ZFS module into custom archiso</a>.</b></p>
<div>
<b>Notes:</b> The target links here for its Arch instructions, but is the natural context. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:ZFS.html">Talk:ZFS</a>)</div>
</div>
<p>Follow the <a href="../en/Archiso.html" title="Archiso">Archiso</a> steps for creating a fully functional Arch Linux live CD/DVD/USB image. To include ZFS support in the image, you can either build your choice of PKGBUILDs from the AUR or include prebuilt packages from one of the <a href="../en/Unofficial_user_repositories.html" title="Unofficial user repositories">unofficial user repositories</a>.
</p>
<h4><span class="mw-headline" id="Using_self-built_ZFS_packages_from_the_AUR">Using self-built ZFS packages from the AUR</span></h4>
<p>Build the ZFS packages you want by following the <a href="../en/Arch_User_Repository.html#Build_the_package" title="Arch User Repository">normal procedures</a>. If you are unsure, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zfs-dkms/">zfs-dkms</a></span><sup><small>AUR</small></sup> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zfs-utils/">zfs-utils</a></span><sup><small>AUR</small></sup> are likely to be compatible with the widest range of other modifications to the Archiso image you may wish to perform. Proceed to set up <a href="../en/Pacman/Tips_and_tricks.html#Custom_local_repository" title="Pacman/Tips and tricks">a custom local repository</a>. <a href="../en/Archiso.html#Custom_local_repository" title="Archiso">Include the resulting repository</a> in the Pacman configuration of your new profile.
</p>
<p>Include the built packages in the list of packages to be installed. The example below presumes you want to include only the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zfs-dkms/">zfs-dkms</a></span><sup><small>AUR</small></sup> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zfs-utils/">zfs-utils</a></span><sup><small>AUR</small></sup> packages.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">packages.x86_64</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
zfs-dkms
zfs-utils
</pre>
<p>If you include any <a href="../en/Dynamic_Kernel_Module_Support.html" class="mw-redirect" title="DKMS">DKMS</a> packages, make sure you also include headers for any kernels you are including in the ISO (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-headers">linux-headers</a></span> for the default kernel).
</p>
<h4><span class="mw-headline" id="Using_the_archzfs_unofficial_user_repository">Using the archzfs unofficial user repository</span></h4>
<p>Add the <a href="../en/Unofficial_user_repositories.html#archzfs" title="Unofficial user repositories">archzfs</a> unofficial user repository to <code>pacman.conf</code> in your new Archiso profile.
</p>
<p>Add the <code>archzfs-linux</code> group to the list of packages to be installed (the <code>archzfs</code> repository provides packages for the x86_64 architecture only).
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">packages.x86_64</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
archzfs-linux
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you later have problems running modprobe zfs, you should include the linux-headers in the packages.x86_64. </div>
<h4><span class="mw-headline" id="Finishing_up">Finishing up</span></h4>
<p>Regardless of where you source your ZFS packages from, you should finish by <a href="../en/Archiso.html#Build_the_ISO" title="Archiso">building the ISO</a>.
</p>
<h3><span class="mw-headline" id="Automatic_snapshots">Automatic snapshots</span></h3>
<h4><span class="mw-headline" id="zrepl">zrepl</span></h4>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zrepl/">zrepl</a></span><sup><small>AUR</small></sup> package provides a ZFS automatic replication service, which could also be used as a snapshotting service much like <a href="../en/Snapper.html" title="Snapper">snapper</a>.
</p>
<p>For details on how to configure the zrepl daemon, see the zrepl <a rel="nofollow" class="external text" href="https://zrepl.github.io/">documentation</a>. The configuration file should be located at <code>/etc/zrepl/zrepl.yml</code>. Then, run <code>zrepl configcheck</code> to make sure that the syntax of the config file is correct. Finally, enable <code>zrepl.service</code>.
</p>
<h4><span class="mw-headline" id="sanoid">sanoid</span></h4>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sanoid/">sanoid</a></span><sup><small>AUR</small></sup> is a policy-driven tool for taking snapshots. Sanoid also includes <code>syncoid</code>, which is for replicating snapshots. It comes with systemd services and a timer.
</p>
<p>Sanoid only prunes snapshots on the local system. To prune snapshots on the remote system, run sanoid there as well with prune options. Either use the <code>--prune-snapshots</code> command line option or use the <code>--cron</code> command line option together with the <code>autoprune = yes</code> and <code>autosnap = no</code> configuration options.
</p>
<h4><span class="mw-headline" id="ZFS_Automatic_Snapshot_Service_for_Linux">ZFS Automatic Snapshot Service for Linux</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zfs-auto-snapshot-git/">zfs-auto-snapshot-git</a></span><sup><small>AUR</small></sup> has not seen any updates since 2019, and the functionality is extremely limited. You are advised to switch to a newer tool like <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zrepl/">zrepl</a></span><sup><small>AUR</small></sup>. </div>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zfs-auto-snapshot-git/">zfs-auto-snapshot-git</a></span><sup><small>AUR</small></sup> package provides a shell script to automate the management of snapshots, with each named by date and label (hourly, daily, etc), giving quick and convenient snapshotting of all ZFS datasets. The package also installs cron tasks for quarter-hourly, hourly, daily, weekly, and monthly snapshots. Optionally adjust the <code>--keep parameter</code> from the defaults depending on how far back the snapshots are to go (the monthly script by default keeps data for up to a year).
</p>
<p>To prevent a dataset from being snapshotted at all, set <code>com.sun:auto-snapshot=false</code> on it. Likewise, set more fine-grained control as well by label, if, for example, no monthlies are to be kept on a snapshot, for example, set <code>com.sun:auto-snapshot:monthly=false</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> zfs-auto-snapshot-git will not create snapshots during <a href="#Scrubbing">scrubbing</a>. It is possible to override this by <a href="../en/Systemd.html#Editing_provided_units" title="Systemd">editing provided systemd unit</a> and removing <code>--skip-scrub</code> from <code>ExecStart</code> line. Consequences not known, someone please edit.</div>
<p>Once the package has been installed, <a href="../en/Systemd/Timers.html" title="Systemd/Timers">enable and start the selected timers</a> (<code>zfs-auto-snapshot-{frequent,daily,weekly,monthly}.timer</code>).
</p>
<h3><span class="mw-headline" id="Creating_a_share">Creating a share</span></h3>
<p>ZFS has support for creating shares by <a href="../en/NFS.html" title="NFS">NFS</a> or <a href="../en/Samba.html" class="mw-redirect" title="SMB">SMB</a>.
</p>
<h4><span class="mw-headline" id="NFS">NFS</span></h4>
<p>Make sure <a href="../en/NFS.html" title="NFS">NFS</a> has been installed/configured, note there is no need to edit the <code>/etc/exports</code> file. For sharing over NFS the services <code>nfs-server.service</code> and <code>zfs-share.service</code> should be <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">started</a>.
</p>
<p>To make a pool available on the network:
</p>
<pre># zfs set sharenfs=on <i>nameofzpool</i>
</pre>
<p>To make a dataset available on the network:
</p>
<pre># zfs set sharenfs=on <i>nameofzpool</i>/<i>nameofdataset</i>
</pre>
<p>To enable read/write access for a specific ip-range(s):
</p>
<pre># zfs set sharenfs="rw=@192.168.1.100/24,rw=@10.0.0.0/24" <i>nameofzpool</i>/<i>nameofdataset</i>
</pre>
<p>To check if the dataset is exported successfully:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># showmount -e `hostname`</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Export list for hostname:
/path/of/dataset 192.168.1.100/24
</pre>
<p>To view the current loaded exports state in more detail, use:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># exportfs -v</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"><i>/path/of/dataset</i>
    192.168.1.100/24(sync,wdelay,hide,no_subtree_check,mountpoint,sec=sys,rw,secure,no_root_squash,no_all_squash)</pre>
<p>To view the current NFS share list by ZFS:
</p>
<pre># zfs get sharenfs
</pre>
<h4><span class="mw-headline" id="SMB">SMB</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  SMB functionality is very limited. The usershare path must be <code>/var/lib/samba/usershares</code> and the only supported sharesmb options are <code>on</code> and <code>off</code>. Enabling guest access via <code>sharesmb=guest_ok=y</code> is not supported. </div>
<p>When sharing through SMB, using <code>usershares</code> in <code>/etc/samba/smb.conf</code> will allow ZFS to setup and create the shares. See <a href="../en/Samba.html#Enable_Usershares" title="Samba">Samba#Enable Usershares</a> for details.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/samba/smb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
    usershare path = /var/lib/samba/usershares
    usershare max shares = 100
    usershare allow guests = yes
    usershare owner only = no</pre>
<p>Create and set permissions on the user directory as root
</p>
<pre># mkdir /var/lib/samba/usershares
# chmod +t /var/lib/samba/usershares
</pre>
<p>To make a pool available on the network:
</p>
<pre># zfs set sharesmb=on <i>nameofzpool</i>
</pre>
<p>To make a dataset available on the network:
</p>
<pre># zfs set sharesmb=on <i>nameofzpool</i>/<i>nameofdataset</i>
</pre>
<p>To check if the dataset is exported successfully:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># smbclient -L localhost -U%</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">        Sharename       Type      Comment
        ---------       ----      -------
        IPC$            IPC       IPC Service (SMB Server Name)
        <i>nameofzpool</i>_<i>nameofdataset</i>        Disk      Comment: path/of/dataset
SMB1 disabled -- no workgroup available
</pre>
<p>To view the current SMB share list by ZFS:
</p>
<pre># zfs get sharesmb
</pre>
<h3><span class="mw-headline" id="Encryption_in_ZFS_using_dm-crypt">Encryption in ZFS using dm-crypt</span></h3>
<p>Before <a rel="nofollow" class="external text" href="https://github.com/openzfs/zfs/releases/tag/zfs-0.8.0">OpenZFS version 0.8.0</a>, ZFS did not support encryption directly (See <a href="#Native_encryption">#Native encryption</a>). Instead, zpools can be created on <a href="../en/Dm-crypt.html" title="Dm-crypt">dm-crypt</a> block devices. Since the zpool is created on the plain-text abstraction, it is possible to have the data encrypted while having all the advantages of ZFS like deduplication, compression, and data robustness. Furthermore, utilizing dm-crypt will encrypt the zpools metadata, which the native encryption can inherently not provide.<a rel="nofollow" class="external autonumber" href="https://openzfs.github.io/openzfs-docs/man/8/zfs-change-key.8.html#Encryption">[8]</a>
</p>
<p>dm-crypt, possibly via LUKS, creates devices in <code>/dev/mapper</code> and their name is fixed. So you just need to change <code>zpool create</code> commands to point to that names. The idea is configuring the system to create the <code>/dev/mapper</code> block devices and import the zpools from there. Since zpools can be created in multiple devices (raid, mirroring, striping, ...), it is important all the devices are encrypted otherwise the protection might be partially lost.
</p>
<p>For example, an encrypted zpool can be created using plain dm-crypt (without LUKS) with:
</p>
<pre># cryptsetup open --type=plain --hash=sha256 --cipher=aes-xts-plain64 --offset=0 \
             --key-file=/dev/sdZ --key-size=512 /dev/sdX enc
# zpool create zroot /dev/mapper/enc
</pre>
<p>In the case of a root filesystem pool, the <code>mkinitcpio.conf</code> HOOKS line will enable the keyboard for the password, create the devices, and load the pools. It will contain something like:
</p>
<pre>HOOKS=(... keyboard encrypt zfs ...)
</pre>
<p>Since the <code>/dev/mapper/enc</code> name is fixed no import errors will occur.
</p>
<p>Creating encrypted zpools works fine. But if you need encrypted directories, for example to protect your users' homes, ZFS loses some functionality.
</p>
<p>ZFS will see the encrypted data, not the plain-text abstraction, so compression and deduplication will not work. The reason is that encrypted data has always high entropy making compression ineffective and even from the same input you get different output (thanks to salting) making deduplication impossible. To reduce the unnecessary overhead it is possible to create a sub-filesystem for each encrypted directory and use <a href="../en/ECryptfs.html" title="ECryptfs">eCryptfs</a> on it.
</p>
<p>For example to have an encrypted home: (the two passwords, encryption and login, must be the same)
</p>
<pre># zfs create -o compression=off -o dedup=off -o mountpoint=/home/&lt;username&gt; &lt;zpool&gt;/&lt;username&gt;
# useradd -m &lt;username&gt;
# passwd &lt;username&gt;
# ecryptfs-migrate-home -u &lt;username&gt;
&lt;log in user and complete the procedure with ecryptfs-unwrap-passphrase&gt;
</pre>
<h3><span class="mw-headline" id="Emergency_chroot_repair_with_archzfs">Emergency chroot repair with archzfs</span></h3>
<p>To get into the ZFS filesystem from live system for maintenance, there are two options:
</p>
<ol>
<li>Build custom archiso with ZFS as described in <a href="#Create_an_Archiso_image_with_ZFS_support">#Create an Archiso image with ZFS support</a>.</li>
<li>Boot the latest official archiso and bring up the network. Then enable <a href="../en/Unofficial_user_repositories.html#archzfs" title="Unofficial user repositories">archzfs</a> repository inside the live system as usual, sync the pacman package database and install the <i>archzfs-archiso-linux</i> package.</li>
</ol>
<p>To start the recovery, load the ZFS kernel modules:
</p>
<pre># modprobe zfs
</pre>
<p>Import the pool:
</p>
<pre># zpool import -a -R /mnt
</pre>
<p>Mount the boot partition and EFI system partition (if any):
</p>
<pre># mount /dev/sda2 /mnt/boot
# mount /dev/sda1 /mnt/efi
</pre>
<p>Chroot into the ZFS filesystem:
</p>
<pre># arch-chroot /mnt /bin/bash
</pre>
<p>Check the kernel version:
</p>
<pre># pacman -Qi linux
# uname -r
</pre>
<p>uname will show the kernel version of the archiso. If they are different, run depmod (in the chroot) with the correct kernel version of the chroot installation:
</p>
<pre># depmod -a 3.6.9-1-ARCH (version gathered from pacman -Qi linux but using the matching kernel modules directory name under the chroot's /lib/modules)
</pre>
<p>This will load the correct kernel modules for the kernel version installed in the chroot installation.
</p>
<p><a href="../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">Regenerate the initramfs</a>. There should be no errors.
</p>
<h3><span class="mw-headline" id="Bind_mount">Bind mount</span></h3>
<p>Here a bind mount from /mnt/zfspool to /srv/nfs4/music is created. The configuration ensures that the zfs pool is ready before the bind mount is created.
</p>
<h4><span class="mw-headline" id="fstab_2">fstab</span></h4>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.mount"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.mount.5">systemd.mount(5)</a></span> for more information on how systemd converts fstab into mount unit files with <span class="plainlinks archwiki-template-man" title="$ man 8 systemd-fstab-generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-fstab-generator.8">systemd-fstab-generator(8)</a></span>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/mnt/zfspool		/srv/nfs4/music		none	bind,defaults,nofail,x-systemd.requires=zfs-mount.service	0 0
</pre>
<h3>
<span id="Monitoring_.2F_Mailing_on_Events"></span><span class="mw-headline" id="Monitoring_/_Mailing_on_Events">Monitoring / Mailing on Events</span>
</h3>
<p>See <a rel="nofollow" class="external text" href="https://ramsdenj.com/2016/08/29/arch-linux-on-zfs-part-3-followup.html">ZED: The ZFS Event Daemon</a> for more information.
</p>
<p>An email forwarder, such as <a href="../en/S-nail.html" title="S-nail">S-nail</a>, is required to accomplish this. Test it to be sure it is working correctly.
</p>
<p>Uncomment the following in the configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/zfs/zed.d/zed.rc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> ZED_EMAIL_ADDR="root"
 ZED_EMAIL_PROG="mailx"
 ZED_NOTIFY_VERBOSE=0
 ZED_EMAIL_OPTS="-s '@SUBJECT@' @ADDRESS@"
</pre>
<p>Update 'root' in <code>ZED_EMAIL_ADDR="root"</code> to the email address you want to receive notifications at.
</p>
<p>If you are keeping your mailrc in your home directory, you can tell mail to get it from there by setting <code>MAILRC</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/zfs/zed.d/zed.rc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">export MAILRC=/home/&lt;user&gt;/.mailrc</pre>
<p>This works because ZED sources this file, so <code>mailx</code> sees this environment variable.
</p>
<p>If you want to receive an email no matter the state of your pool, you will want to set <code>ZED_NOTIFY_VERBOSE=1</code>. You will need to do this temporary to test.
</p>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>zfs-zed.service</code>.
</p>
<p>With <code>ZED_NOTIFY_VERBOSE=1</code>, you can test by running a scrub as root: <code>zpool scrub &lt;pool-name&gt;</code>.
</p>
<h3>
<span id="Wrap_shell_commands_in_pre_.26_post_snapshots"></span><span class="mw-headline" id="Wrap_shell_commands_in_pre_&amp;_post_snapshots">Wrap shell commands in pre &amp; post snapshots</span>
</h3>
<p>Since it is so cheap to make a snapshot, we can use this as a measure of security for sensitive commands such as system and package upgrades. If we make a snapshot before, and one after, we can later diff these snapshots to find out what changed on the filesystem after the command executed. Furthermore we can also rollback in case the outcome was not desired.
</p>
<h4><span class="mw-headline" id="znp">znp</span></h4>
<p>E.g.:
</p>
<pre># zfs snapshot -r zroot@pre
# pacman -Syu
# zfs snapshot -r zroot@post
# zfs diff zroot@pre zroot@post 
# zfs rollback zroot@pre
</pre>
<p>A utility that automates the creation of pre and post snapshots around a shell command is <a rel="nofollow" class="external text" href="https://gist.github.com/erikw/eeec35be33e847c211acd886ffb145d5">znp</a>.
</p>
<p>E.g.:
</p>
<pre># znp pacman -Syu
# znp find / -name "something*" -delete
</pre>
<p>and you would get snapshots created before and after the supplied command, and also output of the commands logged to file for future reference so we know what command created the diff seen in a pair of pre/post snapshots.
</p>
<h3><span class="mw-headline" id="Remote_unlocking_of_ZFS_encrypted_root">Remote unlocking of ZFS encrypted root</span></h3>
<p>As of <a rel="nofollow" class="external text" href="https://github.com/archzfs/archzfs/pull/261">PR #261</a>, <code>archzfs</code> supports SSH unlocking of natively-encrypted ZFS datasets. This section describes how to use this feature, and is largely based on <a href="../en/Dm-crypt/Specialties.html#Busybox_based_initramfs_(built_with_mkinitcpio)" title="Dm-crypt/Specialties">dm-crypt/Specialties#Busybox based initramfs (built with mkinitcpio)</a>.
</p>
<ol>
<li>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-netconf">mkinitcpio-netconf</a></span> to provide hooks for setting up early user space networking.</li>
<li>Choose an SSH server to use in early user space. The options are <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-tinyssh">mkinitcpio-tinyssh</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-dropbear">mkinitcpio-dropbear</a></span>, and are mutually exclusive.
<ol><li>If using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-tinyssh">mkinitcpio-tinyssh</a></span>, it is also recommended to install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tinyssh">tinyssh</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/tinyssh-convert-git/">tinyssh-convert-git</a></span><sup><small>AUR</small></sup>. This tool converts an existing OpenSSH hostkey to the TinySSH key format, preserving the key fingerprint and avoiding connection warnings. The TinySSH and Dropbear mkinitcpio install scripts will automatically convert existing hostkeys when generating a new initcpio image.</li></ol>
</li>
<li>Decide whether to use an existing OpenSSH key or generate a new one (recommended) for the host that will be connecting to and unlocking the encrypted ZFS machine. Copy the public key into <code>/etc/tinyssh/root_key</code> or <code>/etc/dropbear/root_key</code>. When generating the initcpio image, this file will be added to <code>authorized_keys</code> for the root user and is only valid in the initrd environment.</li>
<li>Add the <code>ip=</code> <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> to your boot loader configuration. The <code>ip</code> string is <a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/nfs/nfsroot.html">highly configurable</a>. A simple DHCP example is shown below.<pre>ip=:::::eth0:dhcp</pre>
</li>
<li>Edit <code>/etc/mkinitcpio.conf</code> to include the <code>netconf</code>, <code>dropbear</code> or <code>tinyssh</code>, and <code>zfsencryptssh</code> hooks before the <code>zfs</code> hook:<pre>HOOKS=(... netconf &lt;tinyssh&gt;|&lt;dropbear&gt; zfsencryptssh zfs ...)</pre>
</li>
<li>
<a href="../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">Regenerate the initramfs</a>.</li>
<li>Reboot and try it out!</li>
</ol>
<h4><span class="mw-headline" id="Changing_the_SSH_server_port">Changing the SSH server port</span></h4>
<p>By default, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-tinyssh">mkinitcpio-tinyssh</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio-dropbear">mkinitcpio-dropbear</a></span> listen on port <code>22</code>. You may wish to change this.
</p>
<p>For <b>TinySSH</b>, copy <code>/usr/lib/initcpio/hooks/tinyssh</code> to <code>/etc/initcpio/hooks/tinyssh</code>, and find/modify the following line in the <code>run_hook()</code> function:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/hooks/tinyssh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/usr/bin/tcpserver -HRDl0 0.0.0.0 &lt;new_port&gt; /usr/sbin/tinysshd -v /etc/tinyssh/sshkeydir &amp;
</pre>
<p>For <b>Dropbear</b>, copy <code>/usr/lib/initcpio/hooks/dropbear</code> to <code>/etc/initcpio/hooks/dropbear</code>, and find/modify the following line in the <code>run_hook()</code> function:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/hooks/tinyssh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> /usr/sbin/dropbear -E -s -j -k -p &lt;new_port&gt;
</pre>
<p><a href="../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">Regenerate the initramfs</a>.
</p>
<h4>
<span id="Unlocking_from_a_Windows_machine_using_PuTTY.2FPlink"></span><span class="mw-headline" id="Unlocking_from_a_Windows_machine_using_PuTTY/Plink">Unlocking from a Windows machine using PuTTY/Plink</span>
</h4>
<p>First, we need to use <code>puttygen.exe</code> to import and convert the OpenSSH key generated earlier into PuTTY's <i>.ppk</i> private key format. We will call it <code>zfs_unlock.ppk</code> for this example.
</p>
<p>The mkinitcpio-netconf process above does not setup a shell (nor do we need need one). However, because there is no shell, PuTTY will immediately close after a successful connection. This can be disabled in the PuTTY SSH configuration (<i>Connection &gt; SSH &gt; [X] Do not start a shell or command at all</i>), but it still does not allow us to see stdout or enter the encryption passphrase. Instead, we use <code>plink.exe</code> with the following parameters:
</p>
<pre>plink.exe -ssh -l root -i c:\path\to\zfs_unlock.ppk &lt;hostname&gt;
</pre>
<p>The plink command can be put into a batch script for ease of use.
</p>
<h3><span class="mw-headline" id="Enabling_bclone_support">Enabling bclone support</span></h3>
<p>To use <code>cp --reflink</code> and other commands needing bclone support, it is necessary to upgrade the <i>feature flags</i> if coming from a version prior to 2.2.2. This will allow the pool to have support for bclone. This is done with <code>zpool upgrade</code>, if the status of the pool show this is possible.
</p>
<p>It is also required to enable a module parameter, otherwise userspace apps will not be able to use this feature. You can do this by putting this into <code>/etc/modprobe.d/zfs.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/zfs.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options zfs zfs_bclone_enabled=1</pre>
<p>Check that is working, and how much space is being saved with the command: <code>zpool get all POOLNAME | grep clon</code>
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://pthree.org/2012/12/04/zfs-administration-part-i-vdevs/">Aaron Toponce's 17-part blog on ZFS</a></li>
<li><a rel="nofollow" class="external text" href="https://zfsonlinux.org/">OpenZFS releases</a></li>
<li><a rel="nofollow" class="external text" href="https://openzfs.github.io/openzfs-docs/Project%20and%20Community/FAQ.html">OpenZFS FAQ</a></li>
<li><a rel="nofollow" class="external text" href="https://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/zfs.html">FreeBSD Handbook - The Z File System</a></li>
<li><a rel="nofollow" class="external text" href="https://docs.oracle.com/cd/E19253-01/819-5461/index.html">Oracle Solaris ZFS Administration Guide</a></li>
<li><a rel="nofollow" class="external text" href="https://web.archive.org/web/20161028084224/http://www.solarisinternals.com/wiki/index.php/ZFS_Best_Practices_Guide">ZFS Best Practices Guide</a></li>
<li><a rel="nofollow" class="external text" href="https://docs.oracle.com/cd/E23823_01/html/819-5461/gavwg.html">ZFS Troubleshooting Guide</a></li>
<li><a rel="nofollow" class="external text" href="https://web.archive.org/web/20171213164254/http://royal.pingdom.com/2013/06/04/zfs-backup/">How Pingdom uses ZFS to back up 5TB of MySQL data every day</a></li>
<li><a rel="nofollow" class="external text" href="https://www.linuxquestions.org/questions/linux-from-scratch-13/%5Bhow-to%5D-add-zfs-to-the-linux-kernel-4175514510/">Tutorial on adding the modules to a custom kernel</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/danboid/creating-ZFS-disks-under-Linux">How to create cross platform ZFS disks under Linux</a></li>
<li><a rel="nofollow" class="external text" href="https://blog.heckel.xyz/2017/01/08/zfs-encryption-openzfs-zfs-on-linux/">How-To: Using ZFS Encryption at Rest in OpenZFS (ZFS on Linux, ZFS on FreeBSD, …)</a></li>
<li><a rel="nofollow" class="external text" href="https://archzfs.leibelt.de/">Archzfs iso download page: Frequently updated and downloadable archzfs linux iso with full OpenZFS support since 2016</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:File_systems.html" title="Category:File systems">File systems</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_broken_section_links.html" title="Category:Pages with broken section links">Pages with broken section links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Move.html" title="Category:Pages or sections flagged with Template:Move">Pages or sections flagged with Template:Move</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=ZFS&amp;oldid=826265">https://wiki.archlinux.org/index.php?title=ZFS&amp;oldid=826265</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 2 February 2025, at 20:03.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
