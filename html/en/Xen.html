<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Xen - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Xen rootpage-Xen skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
			<button aria-controls="toc-Installation-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Installation subsection</span>
			</button>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
			<li id="toc-System_requirements" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#System_requirements">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>System requirements</div>
			</a>
			
			<ul id="toc-System_requirements-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Installation_of_the_Xen_Hypervisor" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Installation_of_the_Xen_Hypervisor">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Installation of the Xen Hypervisor</div>
			</a>
			
			<ul id="toc-Installation_of_the_Xen_Hypervisor-sublist" class="vector-toc-list">
				<li id="toc-Building_xen" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Building_xen">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2.1</span>Building xen</div>
			</a>
			
			<ul id="toc-Building_xen-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Modification_of_the_bootloader" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Modification_of_the_bootloader">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Modification of the bootloader</div>
			</a>
			
			<ul id="toc-Modification_of_the_bootloader-sublist" class="vector-toc-list">
				<li id="toc-UEFI" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#UEFI">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.1</span>UEFI</div>
			</a>
			
			<ul id="toc-UEFI-sublist" class="vector-toc-list">
				<li id="toc-systemd-boot" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#systemd-boot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.1.1</span>systemd-boot</div>
			</a>
			
			<ul id="toc-systemd-boot-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-EFISTUB" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#EFISTUB">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.1.2</span>EFISTUB</div>
			</a>
			
			<ul id="toc-EFISTUB-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-BIOS" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#BIOS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.2</span>BIOS</div>
			</a>
			
			<ul id="toc-BIOS-sublist" class="vector-toc-list">
				<li id="toc-GRUB" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#GRUB">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.2.1</span>GRUB</div>
			</a>
			
			<ul id="toc-GRUB-sublist" class="vector-toc-list">
				<li id="toc-Building_GRUB_images_for_booting_guests" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Building_GRUB_images_for_booting_guests">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.2.1.1</span>Building GRUB images for booting guests</div>
			</a>
			
			<ul id="toc-Building_GRUB_images_for_booting_guests-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Syslinux" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Syslinux">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.2.2</span>Syslinux</div>
			</a>
			
			<ul id="toc-Syslinux-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Creation_of_a_network_bridge" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Creation_of_a_network_bridge">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.4</span>Creation of a network bridge</div>
			</a>
			
			<ul id="toc-Creation_of_a_network_bridge-sublist" class="vector-toc-list">
				<li id="toc-Systemd-networkd" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Systemd-networkd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.4.1</span>Systemd-networkd</div>
			</a>
			
			<ul id="toc-Systemd-networkd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Network_Manager" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Network_Manager">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.4.2</span>Network Manager</div>
			</a>
			
			<ul id="toc-Network_Manager-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Installation_of_Xen_systemd_services" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Installation_of_Xen_systemd_services">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.5</span>Installation of Xen systemd services</div>
			</a>
			
			<ul id="toc-Installation_of_Xen_systemd_services-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Confirming_successful_installation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Confirming_successful_installation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.6</span>Confirming successful installation</div>
			</a>
			
			<ul id="toc-Confirming_successful_installation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Configure_Best_Practices" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Configure_Best_Practices">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.7</span>Configure Best Practices</div>
			</a>
			
			<ul id="toc-Configure_Best_Practices-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Using_Xen" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Using_Xen">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Using Xen</div>
		</a>
		
			<button aria-controls="toc-Using_Xen-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Using Xen subsection</span>
			</button>
		
		<ul id="toc-Using_Xen-sublist" class="vector-toc-list">
			<li id='toc-Create_a_domU_"hard_disk"' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#Create_a_domU_"hard_disk"'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Create a domU "hard disk"</div>
			</a>
			
			<ul id='toc-Create_a_domU_"hard_disk"-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Create_a_domU_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Create_a_domU_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Create a domU configuration</div>
			</a>
			
			<ul id="toc-Create_a_domU_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Managing_a_domU" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Managing_a_domU">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Managing a domU</div>
			</a>
			
			<ul id="toc-Managing_a_domU-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Configuring_a_hardware_virtualized_(HVM)_Arch_domU" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Configuring_a_hardware_virtualized_(HVM)_Arch_domU">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Configuring a hardware virtualized (HVM) Arch domU</div>
		</a>
		
		<ul id="toc-Configuring_a_hardware_virtualized_(HVM)_Arch_domU-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuring_a_paravirtualized_(PV)_Arch_domU" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Configuring_a_paravirtualized_(PV)_Arch_domU">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Configuring a paravirtualized (PV) Arch domU</div>
		</a>
		
		<ul id="toc-Configuring_a_paravirtualized_(PV)_Arch_domU-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id='toc-"xl_list"_complains_about_libxl' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#"xl_list"_complains_about_libxl'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>"xl list" complains about libxl</div>
			</a>
			
			<ul id='toc-"xl_list"_complains_about_libxl-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-"xl_create"_fails' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#"xl_create"_fails'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>"xl create" fails</div>
			</a>
			
			<ul id='toc-"xl_create"_fails-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Creating_HVM_fails" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Creating_HVM_fails">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Creating HVM fails</div>
			</a>
			
			<ul id="toc-Creating_HVM_fails-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Arch_Linux_guest_hangs_with_a_ctrl-d_message" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Arch_Linux_guest_hangs_with_a_ctrl-d_message">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>Arch Linux guest hangs with a ctrl-d message</div>
			</a>
			
			<ul id="toc-Arch_Linux_guest_hangs_with_a_ctrl-d_message-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-failed_to_execute_'/usr/lib/udev/socket:/org/xen/xend/udev_event'_'socket:/org/xen/xend/udev_event':_No_such_file_or_directory" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#failed_to_execute_'/usr/lib/udev/socket:/org/xen/xend/udev_event'_'socket:/org/xen/xend/udev_event':_No_such_file_or_directory">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5</span>failed to execute '/usr/lib/udev/socket:/org/xen/xend/udev_event' 'socket:/org/xen/xend/udev_event': No such file or directory</div>
			</a>
			
			<ul id="toc-failed_to_execute_'/usr/lib/udev/socket:/org/xen/xend/udev_event'_'socket:/org/xen/xend/udev_event':_No_such_file_or_directory-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Xen</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-de mw-list-item"><a href="https://wiki.archlinux.de/title/Xen" title="Xen – Deutsch" lang="de" hreflang="de" class="interlanguage-link-target"><span>Deutsch</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Xen" title="Xen – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Xen" title="Xen – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Category:Hypervisors.html" title="Category:Hypervisors">Category:Hypervisors</a></li>
<li><a href="../en/Moving_an_existing_install_into_(or_out_of)_a_virtual_machine.html" title="Moving an existing install into (or out of) a virtual machine">Moving an existing install into (or out of) a virtual machine</a></li>
</ul>
</div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> The sections need better structuring. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Xen.html">Talk:Xen</a>)</div>
</div>
<p>From <a rel="nofollow" class="external text" href="https://wiki.xen.org/wiki/Xen_Overview">Xen Overview</a>:
</p>
<dl><dd>Xen is an open-source type-1 or baremetal hypervisor, which makes it possible to run many instances of an operating system or indeed different operating systems in parallel on a single machine (or host). Xen is the only type-1 hypervisor that is available as open source.</dd></dl>
<p>The Xen hypervisor is a thin layer of software which emulates a computer architecture allowing multiple operating systems to run simultaneously. The hypervisor is started by the boot loader of the computer it is installed on. Once the hypervisor is loaded, it starts the <a rel="nofollow" class="external text" href="https://wiki.xen.org/wiki/Dom0">dom0</a> (short for "domain 0", sometimes called the host or privileged domain) which in our case runs Arch Linux. Once the <i>dom0</i> has started, one or more <a rel="nofollow" class="external text" href="https://wiki.xen.org/wiki/DomU">domU</a> (short for user domains, sometimes called VMs or guests) can be started and controlled from the <i>dom0</i>.  For the <i>domU</i>, Xen supports paravirtualized (PV) domains, hardware virtualized  domains (HVM), and paravirtualised domains inside a hardware virtualization wrapper (PVH). See <a rel="nofollow" class="external text" href="https://wiki.xen.org/wiki/Xen_Overview">Xen.org</a> for a full overview.
</p>
<p>The Xen hypervisor relies on a full install of the base operating system. Before attempting to install the Xen hypervisor, the  host machine should have a fully operational and up-to-date install of Arch Linux. This installation can be a minimal install with only the base package and does not require a <a href="../en/Desktop_environment.html" title="Desktop environment">Desktop environment</a> or even <a href="../en/Xorg.html" title="Xorg">Xorg</a>.
</p>
<p>If you are building a new host from scratch, see the <a href="../en/Installation_guide.html" title="Installation guide">Installation guide</a> for instructions on installing Arch Linux.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Do not run other virtualization software such as <a href="../en/VirtualBox.html" title="VirtualBox">VirtualBox</a> when running Xen hypervisor, it might hang your system. See this <a rel="nofollow" class="external text" href="https://www.virtualbox.org/ticket/12146">bug report (wontfix)</a>.</div>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<h3><span class="mw-headline" id="System_requirements">System requirements</span></h3>
<p>The Xen hypervisor requires kernel level support which is included in recent Linux kernels and is built into the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-lts">linux-lts</a></span> Arch kernel packages. To run HVM <i>domU</i>, the physical hardware must have either Intel VT-x or AMD-V (SVM) virtualization support. In order to verify this, run the following command when the Xen hypervisor is not running:
</p>
<pre>$ grep -E "(vmx|svm)" --color=always /proc/cpuinfo
</pre>
<p>If the above command does not produce output, then hardware virtualization support is unavailable and your hardware is unable to run HVM <i>domU</i> (or you are already running the Xen hypervisor). If you believe the CPU supports one of these features you should access the host system's BIOS configuration menu during the boot process and look if options related to virtualization support have been disabled. If such an option exists and is disabled, then enable it, boot the system and repeat the above command. The Xen hypervisor also supports PCI passthrough where PCI devices can be passed directly to the <i>domU</i> even in the absence of <i>dom0</i> support for the device. In order to use PCI passthrough, the CPU must support IOMMU/VT-d.
</p>
<h3><span class="mw-headline" id="Installation_of_the_Xen_Hypervisor">Installation of the Xen Hypervisor</span></h3>
<p>To install the Xen hypervisor, <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xen/">xen</a></span><sup><small>AUR</small></sup> package. It provides the Xen hypervisor, current xl interface and all configuration and support files, including systemd services. To run most VMs, you will also need to install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xen-qemu/">xen-qemu</a></span><sup><small>AUR</small></sup>.
</p>
<p>For BIOS support in VMs, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=seabios">seabios</a></span>.  For UEFI support, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=edk2-ovmf">edk2-ovmf</a></span>. To boot VM-local kernels inside of a PVH VM, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xen-pvhgrub/">xen-pvhgrub</a></span><sup><small>AUR</small></sup>.
</p>
<h4><span class="mw-headline" id="Building_xen">Building xen</span></h4>
<p>It is recommended that xen and its components are built in a clean environment, either in a VM or a chroot.  When building Xen, there are environmental variables that can be passed to <i>makepkg</i>.
</p>
<ol>
<li>
<i>build_stubdom</i> -- Build the components to run Xen stubdoms, mainly for <a rel="nofollow" class="external text" href="https://wiki.xenproject.org/wiki/Dom0_Disaggregation">dom0 disaggregation</a>.  Components for stubdom are broken off into <i>xen-stubdom</i> if built.  Defaults to false.</li>
<li>
<i>boot_dir</i>-- Your boot directory.  Defaults to <i>/boot</i>.</li>
<li>
<i>efi_dir</i>, <i>efi_mountpoint</i> -- Your EFI directory and mountpoint.   Defaults to <i>/boot</i>.</li>
</ol>
<p>Pass these arguments to makepkg as variables:
</p>
<pre>$ build_stubdom=true efi_dir="/boot/EFI" makepkg
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/xen-docs/">xen-docs</a></span><sup><small>AUR</small></sup> will be also built for the man pages and documentation. If you choose to build stubdom support, a <i>xen-stubdom</i> package will be built. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The plan for Xen on Arch Linux is to eventually phase stubdom out in favor of PVH domains.</div>
<h3><span class="mw-headline" id="Modification_of_the_bootloader">Modification of the bootloader</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Never assume your system will boot after changes to the boot system. This might be the most common error new as well as old users do. Make sure you have a alternative way to boot your system like a USB stick or other livemedia <b>BEFORE</b> you make changes to your boot system.</div>
<p>The boot loader must be modified to load a special Xen kernel (<code>xen.gz</code> or in the case of UEFI <code>xen.efi</code>) which is then used to boot the normal kernel. To do this a new bootloader entry is needed.
</p>
<h4><span class="mw-headline" id="UEFI">UEFI</span></h4>
<p>Xen supports booting from UEFI as specified in <a rel="nofollow" class="external text" href="https://xenbits.xen.org/docs/unstable/misc/efi.html">Xen EFI systems</a>.  It also might be necessary to use <a href="../en/Unified_Extensible_Firmware_Interface.html#efibootmgr" class="mw-redirect" title="UEFI">efibootmgr</a> to set boot order and other parameters. 
</p>
<p>First, ensure the <code>xen.efi</code> file is in the <a href="../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a> along with your kernel and ramdisk files.
</p>
<p>Second, Xen requires an ASCII (no UTF-8, UTC-16, etc) configuration file that specifies what kernel should be booted as <a rel="nofollow" class="external text" href="https://wiki.xen.org/wiki/Dom0">dom0</a>.  This file must be placed in the same <a href="../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a> as the binary.  Xen looks for several configuration files and uses the first one it finds.  The order of search starts with the <code>.efi</code> extension of the binary's name replaced by <code>.cfg</code>, then drops trailing name components at <code>.</code>, <code>-</code> and <code>_</code> until a match is found.  Typically, a single file named <code>xen.cfg</code> is used with the system requirements, such as:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">xen.cfg</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[global]
default=xen

[xen]
options=console=vga iommu=force:true,qinval:true,debug:true loglvl=all noreboot=true reboot=no vga=ask ucode=scan
kernel=vmlinuz-linux root=/dev/sdaX rw add_efi_memmap #earlyprintk=xen
ramdisk=initramfs-linux.img
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> See <a rel="nofollow" class="external text" href="https://xenbits.xen.org/docs/unstable/misc/efi.html">Xen efi.cfg</a> for additional parameters in this file. For the options line, see <a rel="nofollow" class="external text" href="https://xenbits.xen.org/docs/unstable/misc/xen-command-line.html">Xen Command Line options</a> for a full list of options available such as serial console, limiting dom0 vCPU and memory, scheduling, Intel and AMD microcode and more.  For example, <a rel="nofollow" class="external text" href="https://wiki.xen.org/wiki/Xen_Project_Best_Practices">Xen Project Best Practices</a> dictates to disabling memory ballooning for dom0.  To do that, edit the <code>xen.cfg</code> line for <code>options</code> to specify the additional parameters.</div>
<h5><span class="mw-headline" id="systemd-boot">systemd-boot</span></h5>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> You can continue to boot the <a rel="nofollow" class="external text" href="https://wiki.xen.org/wiki/Dom0">dom0</a> kernel directly even after Xen is installed and configured.  This can be useful in the event that an Xen installation becomes unbootable or misconfigured.  Therefore, it is recommended to keep the original systemd-boot loader entries configured on the system as rescue boot options and just add additional entries for Xen.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> At the time of the system's <a href="../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a> installation, the ESP partition should have been mounted to <code>/boot</code> as this is where the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/Xen/">Xen</a></span><sup><small>AUR</small></sup> package and EFI binaries were configured and built for, not <code>/boot/efi</code>.</div>
<p>Add a new EFI-type loader entry. See <a href="../en/Systemd-boot.html#UEFI_Shells_or_other_EFI_applications" title="Systemd-boot">systemd-boot#UEFI Shells or other EFI applications</a> for more details.  For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/boot/loader/entries/10-xen.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">title   Xen Hypervisor
efi     /xen.efi
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The current <a href="../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a> and Xen efi binary combination does not allow parameters passed on the <code>efi</code> line of the loader's entry.  However, the Xen documentation states that <code>-cfg=file.cfg</code> can be used as an UEFI Shell parameter which is not true for the efi line option. For now, you can only have one Xen EFI entry which limits you to only one configuration file.</div>
<h5><span class="mw-headline" id="EFISTUB">EFISTUB</span></h5>
<p>It is possible to boot an EFI kernel directly from UEFI by using <a href="../en/EFISTUB.html" title="EFISTUB">EFISTUB</a>.  
</p>
<p>Drop to the build-in <a href="../en/Unified_Extensible_Firmware_Interface.html#Launching_UEFI_Shell" class="mw-redirect" title="UEFI">UEFI shell</a> and call the EFI file directly.  For example:
</p>
<pre>Shell&gt; fs0:
FS0:\&gt; xen.efi
</pre>
<p>Note that a <code>xen.cfg</code> configuration file in the <a href="../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a> is still required as outlined above.  In addition, a different configuration file may be specified with the <code>-cfg=file.cfg</code> parameter.  For example:
</p>
<pre>Shell&gt; fs0:
FS0:\&gt; xen.efi -cfg=xen-rescue.cfg
</pre>
<p>These additional configuration files must reside in the same directory as the Xen EFI binary and linux stub files.
</p>
<h4><span class="mw-headline" id="BIOS">BIOS</span></h4>
<p>Xen supports booting from system firmware configured as BIOS.
</p>
<h5><span class="mw-headline" id="GRUB">GRUB</span></h5>
<p>For <a href="../en/GRUB.html" title="GRUB">GRUB</a> users, install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/grub-xen-git/">grub-xen-git</a></span><sup><small>AUR</small></sup> package for booting <i>dom0</i> as well as building <a rel="nofollow" class="external text" href="https://wiki.xenproject.org/wiki/PvGrub2">PvGrub2</a> images for booting user domains.
</p>
<p>The file <code>/etc/default/grub</code> can be edited to customize the Xen boot commands. For example, to allocate 512 MiB of RAM to <i>dom0</i> at boot, modify <code>/etc/default/grub</code> by replacing the line:
</p>
<pre>#GRUB_CMDLINE_XEN_DEFAULT=""
</pre>
<p>with
</p>
<pre>GRUB_CMDLINE_XEN_DEFAULT="dom0_mem=512M"
</pre>
<p>More information on GRUB configuration keys for Xen can be found in the <a rel="nofollow" class="external text" href="https://www.gnu.org/software/grub/manual/grub/html_node/Simple-configuration.html#Simple-configuration">GRUB documentation</a>.
</p>
<p>After customizing the options, update the bootloader configuration with the following command:
</p>
<pre># grub-mkconfig -o /boot/grub/grub.cfg
</pre>
<p>More information on using the GRUB bootloader is available at <a href="../en/GRUB.html" title="GRUB">GRUB</a>.
</p>
<h6><span class="mw-headline" id="Building_GRUB_images_for_booting_guests">Building GRUB images for booting guests</span></h6>
<p>Besides the usual platform targets, the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/grub-xen-git/">grub-xen-git</a></span><sup><small>AUR</small></sup> package builds GRUB for three additional targets that can be used to boot Xen guests: <i>i386-xen</i>, <i>i386-xen_pvh</i>, and <i>x86_64-xen</i>. To create a boot image from one of these targets, first create a GRUB configuration file. Depending on your preference, this file can either locate and load a GRUB configuration file in the guest or it could manage more of the boot process from <i>dom0</i>.  Assuming all that is needed is to locate and load a configuration file in the guest, add the following to a file,
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">grub.cfg</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">search -s root -f /boot/grub/grub.cfg
configfile /boot/grub/grub.cfg
</pre>
<p>and then create a <a href="../en/GRUB/Tips_and_tricks.html#GRUB_standalone" title="GRUB/Tips and tricks">GRUB/Tips and tricks#GRUB standalone</a> image that will incorporate that file:
</p>
<pre> # grub-mkstandalone -O x86_64-xen -o /usr/lib/xen/boot/pv-grub2-x86_64-xen "/boot/grub/grub.cfg=./grub.cfg"
</pre>
<p>Lastly, add that image as value of the kernel in the domU configuration file (for a 64-bit guest in this example):
</p>
<pre> kernel = "/usr/lib/xen/boot/pv-grub2-x86_64-xen"
</pre>
<p>More examples of configuring GRUB images for GRUB guests can be found in the Xen Project's <a rel="nofollow" class="external text" href="https://wiki.xenproject.org/wiki/PvGrub2">PvGrub2 documentation</a>.
</p>
<h5><span class="mw-headline" id="Syslinux">Syslinux</span></h5>
<p>For <a href="../en/Syslinux.html" title="Syslinux">Syslinux</a> users, add a stanza like this to your <code>/boot/syslinux/syslinux.cfg</code>:
</p>
<pre>LABEL xen
    MENU LABEL Xen
    KERNEL mboot.c32
    APPEND ../xen-X.Y.Z.gz --- ../vmlinuz-linux console=tty0 root=/dev/sdaX ro --- ../initramfs-linux.img
</pre>
<p>where <code>X.Y.Z</code> is your xen version and <code>/dev/sdaX</code> is your <a href="../en/Fstab.html#Identifying_file_systems" title="Fstab">root partition</a>.
</p>
<p>This also requires <code>mboot.c32</code> (and <code>libcom32.c32</code>) to be in the same directory as <code>syslinux.cfg</code>. If you do not have <code>mboot.c32</code> in <code>/boot/syslinux</code>, copy it from:
</p>
<pre># cp /usr/lib/syslinux/bios/mboot.c32 /boot/syslinux
</pre>
<h3><span class="mw-headline" id="Creation_of_a_network_bridge">Creation of a network bridge</span></h3>
<p>Xen requires that network communications between <i>domU</i> and the <i>dom0</i> (and beyond) be set up manually. The use of both DHCP and static addressing is possible, and the choice should be determined by the network topology. Complex setups are possible, see the <a rel="nofollow" class="external text" href="https://wiki.xen.org/wiki/Xen_Networking">Networking</a> article on the Xen wiki for details and <code>/etc/xen/scripts</code> for scripts for various networking configurations. A basic bridged network, in which a virtual switch is created in <i>dom0</i> that every <i>domU</i> is attached to, can be set up by creating a <a href="../en/Network_bridge.html" title="Network bridge">network bridge</a> with the expected name <code>xenbr0</code>.
</p>
<p>See <a href="../en/Network_bridge.html#Creating_a_bridge" title="Network bridge">Network bridge#Creating a bridge</a> for details.
</p>
<h4><span class="mw-headline" id="Systemd-networkd">Systemd-networkd</span></h4>
<p>See <a href="../en/Systemd-networkd.html#Bridge_interface" title="Systemd-networkd">Systemd-networkd#Bridge interface</a> for details.
</p>
<h4><span class="mw-headline" id="Network_Manager">Network Manager</span></h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Merge-arrows-2.svg" decoding="async" width="36" height="40" class="mw-file-element"></span></span><b>This article or section is a candidate for merging with <a href="../en/Network_bridge.html#With_NetworkManager" title="Network bridge">Network_bridge#With_NetworkManager</a>.</b></p>
<div>
<b>Notes:</b> Duplicates the main page. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Xen.html">Talk:Xen</a>)</div>
</div>
<p>Gnome's Network Manager can sometime be troublesome. If following the bridge creation section outlined in the <a href="../en/Network_bridge.html" title="Network bridge">bridges</a> section of the wiki are unclear or do not work, then the following steps may work.
</p>
<p>Open the Network Settings and disable the interface you wish to use in your bridge (ex enp5s0). Edit the setting to off and uncheck "connect automatically."
</p>
<p>Create a new bridge connection profile by clicking on the "+" symbol in the bottom left of the network settings. Optionally, run:
</p>
<pre># nm-connection-editor
</pre>
<p>to bring up the window immediately. Once the window opens, select Bridge.
</p>
<p>Click "Add" next to the "Bridged Connections" and select the interface you wished to use in your bridge (ex. Ethernet). Select the device mac address that corresponds to the interface you intend to use and save the settings
</p>
<p>If your bridge is going to receive an IP address via DHCP, leave the IPv4/IPv6 sections as they are. If DHCP is not running for this particular connection, make sure to give your bridge an IP address. Needless to say, all connections will fail if an IP address is not assigned to the bridge. If you forget to add the IP address when you first create the bridge, it can always be edited later.
</p>
<p>Now, as root, run: 
</p>
<pre># nmcli con show
</pre>
<p>You should see a connection that matches the name of the bridge you just created. Highlight and copy the UUID on that connection, and then run (again as root):
</p>
<pre># nmcli con up &lt;UUID OF CONNECTION&gt;
</pre>
<p>A new connection should appear under the network settings. It may take 30 seconds to a minute. To confirm that it is up and running, run:
</p>
<pre># brctl show
</pre>
<p>to show a list of active bridges.
</p>
<p>Reboot. If everything works properly after a reboot (ie. bridge starts automatically), then you are all set.
</p>
<p>&lt;optional&gt; In your network settings, remove the connection profile on your bridge interface that does NOT connect to the bridge. This just keeps things from being confusing later on.
</p>
<h3><span class="mw-headline" id="Installation_of_Xen_systemd_services">Installation of Xen systemd services</span></h3>
<p>The Xen <i>dom0</i> requires the <code>xenstored.service</code>, <code>xenconsoled.service</code>, <code>xendomains.service</code> and <code>xen-init-dom0.service</code> to be <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Started">started</a> and possibly <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enabled">enabled</a>.
</p>
<h3><span class="mw-headline" id="Confirming_successful_installation">Confirming successful installation</span></h3>
<p>Reboot your <i>dom0</i> host and ensure that the Xen kernel boots correctly and that all settings survive a reboot. A properly set up <i>dom0</i> should report the following when you run <code>xl list</code> as root:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># xl list</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Name                                        ID   Mem VCPUs	State	Time(s)
Domain-0                                     0   511     2     r-----   41652.9
</pre>
<p>Of course, the Mem, VCPUs and Time columns will be different depending on machine configuration and uptime. The important thing is that <i>dom0</i> is listed.
</p>
<p>In addition to the required steps above, see <a rel="nofollow" class="external text" href="https://wiki.xen.org/wiki/Xen_Best_Practices">best practices for running Xen</a> which includes information on allocating a fixed amount of memory and how to dedicate (pin) a CPU core for <i>dom0</i> use. It also may be beneficial to create a xenfs filesystem mount point by including in <code>/etc/fstab</code>
</p>
<pre>none /proc/xen xenfs defaults 0 0
</pre>
<h3><span class="mw-headline" id="Configure_Best_Practices">Configure Best Practices</span></h3>
<p>Review <a rel="nofollow" class="external text" href="https://wiki.xen.org/wiki/Xen_Project_Best_Practices">Xen Project Best Practices</a> before using Xen.
</p>
<h2><span class="mw-headline" id="Using_Xen">Using Xen</span></h2>
<p>Xen supports both paravirtualized (PV) and hardware virtualized (HVM) <i>domU</i>. In the following sections the steps for creating HVM and PV <i>domU</i> running Arch Linux are described. In general, the steps for creating an HVM <i>domU</i> are independent of the <i>domU</i> OS and HVM <i>domU</i> support a wide range of operating systems including Microsoft Windows. To use HVM <i>domU</i> the <i>dom0</i> hardware must have virtualization support. Paravirtualized <i>domU</i> do not require virtualization support, but instead require modifications to the guest operating system making the installation procedure different for each operating system (see the <a rel="nofollow" class="external text" href="https://wiki.xen.org/wiki/Category:Guest_Install">Guest Install</a> page of the Xen wiki for links to instructions). Some operating systems (e.g., Microsoft Windows) cannot be installed as a PV <i>domU</i>. In general, HVM <i>domU</i> often run slower than PV <i>domU</i> since HVMs run on emulated hardware. While there are some common steps involved in setting up PV and HVM <i>domU</i>, the processes are substantially different. In both cases, for each <i>domU</i>, a "hard disk" will need to be created and a configuration file needs to be written. Additionally, for installation each <i>domU</i> will need access to a copy of the installation ISO stored on the <i>dom0</i> (see the <a rel="nofollow" class="external text" href="https://archlinux.org/download/">Download Page</a> to obtain the Arch Linux ISO).
</p>
<h3>
<span id="Create_a_domU_.22hard_disk.22"></span><span class="mw-headline" id='Create_a_domU_"hard_disk"'>Create a domU "hard disk"</span>
</h3>
<p>Xen supports a number of different types of "hard disks" including <a href="../en/LVM.html" title="LVM">Logical Volumes</a>, <a href="../en/Partitioning.html" title="Partitioning">raw partitions</a>, and image files. To create a <a href="https://en.wikipedia.org/wiki/Sparse_file" class="extiw" title="wikipedia:Sparse file">sparse file</a>, that will grow to a maximum of 10GiB, called <code>domU.img</code>, use:
</p>
<pre>$ truncate -s 10G domU.img
</pre>
<p>If file IO speed is of greater importance than domain portability, using <a href="../en/LVM.html" title="LVM">Logical Volumes</a> or <a href="../en/Partitioning.html" title="Partitioning">raw partitions</a> may be a better choice.
</p>
<p>Xen may present any partition / disk available to the host machine to a domain as either a partition or disk. This means that, for example, an LVM partition on the host can appear as a hard drive (and hold multiple partitions) to a domain. Note that making sub-partitons on a partition will make accessing those partitions on the host machine more difficult. See <span class="plainlinks archwiki-template-man" title="$ man 8 kpartx"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/kpartx.8">kpartx(8)</a></span> for information on how to map out partitions within a partition.
</p>
<h3><span class="mw-headline" id="Create_a_domU_configuration">Create a domU configuration</span></h3>
<p>Each <i>domU</i> requires a separate configuration file that is used to create the virtual machine. Full details about the configuration files can be found at the <a rel="nofollow" class="external text" href="https://wiki.xenproject.org/wiki/XenConfigurationFileOptions">Xen Wiki</a> or the <span class="plainlinks archwiki-template-man" title="$ man 5 xl.cfg"><a rel="nofollow" class="external text" href="https://xenbits.xen.org/docs/unstable/man/xl.cfg.5.html">xl.cfg(5)</a></span> man page. Both HVM and PV <i>domU</i> share some components of the configuration file. These include
</p>
<pre>name = "domU"
memory = 512
disk = [ "file:/path/to/ISO,sdb,r", "phy:/path/to/partition,sda1,w" ]
vif = [ 'mac=00:16:3e:XX:XX:XX,bridge=xenbr0' ]
</pre>
<p>The <code>name=</code> is the name by which the xl tools manage the <i>domU</i> and needs to be unique across all <i>domU</i>. The <code>disk=</code> includes information about both the installation media (<code>file:</code>) and the partition created for the <i>domU</i> <code>phy</code>. If an image file is being used instead of a physical partition, the <code>phy:</code> needs to be changed to <code>file:</code>. The <code>vif=</code> defines a network controller. The <code>00:16:3e</code> MAC block is reserved for Xen domains, so the last three digits of the <code>mac=</code> must be randomly filled in (hex values 0-9 and a-f only).
</p>
<h3><span class="mw-headline" id="Managing_a_domU">Managing a domU</span></h3>
<p>If a <i>domU</i> should be started on boot, create a symlink to the configuration file in <code>/etc/xen/auto</code> and ensure the <code>xendomains</code> service is set up correctly. Some useful commands for managing <i>domU</i> are:
</p>
<pre># xl top
# xl list
# xl console domUname
# xl shutdown domUname
# xl destroy domUname
</pre>
<h2>
<span id="Configuring_a_hardware_virtualized_.28HVM.29_Arch_domU"></span><span class="mw-headline" id="Configuring_a_hardware_virtualized_(HVM)_Arch_domU">Configuring a hardware virtualized (HVM) Arch domU</span>
</h2>
<p>In order to use HVM <i>domU</i> install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mesa">mesa</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=numactl">numactl</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bluez-libs">bluez-libs</a></span> packages.
</p>
<p>A minimal configuration file for a HVM Arch <i>domU</i> is:
</p>
<pre>name = 'HVM_domU'
builder = 'hvm'
memory = 512
vcpus = 2
disk = [ 'phy:/dev/vg0/hvm_arch,xvda,w', 'file:/path/to/ISO,hdc:cdrom,r' ]
vif = [ 'mac=00:16:3e:00:00:00,bridge=xenbr0' ]
vnc = 1
vnclisten = '0.0.0.0'
vncdisplay = 1
</pre>
<p>Since HVM machines do not have a console, they can only be connected to via a <a href="../en/List_of_applications/Internet.html#Remote_desktop_servers" class="mw-redirect" title="Vncserver">vncviewer</a>. The configuration file allows for unauthenticated remote access of the <i>domU</i> vncserver and is not suitable for unsecured networks. The vncserver will be available on port <code>590X</code>, where X is the value of <code>vncdisplay</code>, of the <i>dom0</i>. The <i>domU</i> can be created with:
</p>
<pre># xl create /path/to/config/file
</pre>
<p>and its status can be checked with
</p>
<pre># xl list
</pre>
<p>Once the <i>domU</i> is created, connect to it via the vncserver and install Arch Linux as described in the <a href="../en/Installation_guide.html" title="Installation guide">Installation guide</a>.
</p>
<h2>
<span id="Configuring_a_paravirtualized_.28PV.29_Arch_domU"></span><span class="mw-headline" id="Configuring_a_paravirtualized_(PV)_Arch_domU">Configuring a paravirtualized (PV) Arch domU</span>
</h2>
<p>A minimal configuration file for a PV Arch <i>domU</i> is:
</p>
<pre>name = "PV_domU"
kernel = "/mnt/arch/boot/x86_64/vmlinuz-linux"
ramdisk = "/mnt/arch/boot/x86_64/initramfs-linux.img"
extra = "archisobasedir=arch archisodevice=UUID=<i>YYYY-mm-dd-HH-MM-SS</i>-00"
memory = 512
disk = [ "phy:/path/to/partition,sda1,w", "file:/path/to/ISO,sdb,r" ]
vif = [ 'mac=00:16:3e:XX:XX:XX,bridge=xenbr0' ]
</pre>
<p>This file needs to tweaked for your specific use. Most importantly, the <code>archisodevice=UUID=<i>YYYY-mm-dd-HH-MM-SS</i>-00</code> line must be edited to use the creation date and time of the ISO being used. 
</p>
<p>Before creating the <i>domU</i>, the installation ISO must be loop-mounted. To do this, ensure the directory <code>/mnt</code> exists and is empty, then run the following command (being sure to fill in the correct ISO path):
</p>
<pre># mount -o loop /path/to/iso /mnt
</pre>
<p>Once the ISO is mounted, the <i>domU</i> can be created with:
</p>
<pre># xl create -c /path/to/config/file
</pre>
<p>The "-c" option will enter the <i>domU'</i>s console when successfully created. Then you can install Arch Linux as described in the <a href="../en/Installation_guide.html" title="Installation guide">Installation guide</a>, but with the following deviations. The block devices listed in the disks line of the cfg file will show up as <code>/dev/xvd*</code>. Use these devices when partitioning the <i>domU</i>. After installation and before the <i>domU</i> is rebooted, the <code>xen-blkfront</code>, <code>xen-fbfront</code>, <code>xen-netfront</code>, <code>xen-kbdfront</code> modules must be added to <a href="../en/Mkinitcpio.html" title="Mkinitcpio">Mkinitcpio</a>. Without these modules, the <i>domU</i> will not boot correctly. For booting, it is not necessary to install Grub. Xen has a Python-based grub emulator, so all that is needed to boot is a <code>grub.cfg</code> file: (It may be necessary to create the <code>/boot/grub</code> directory)
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/boot/grub/grub.cfg</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">menuentry 'Arch GNU/Linux, with Linux core repo kernel' --class arch --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-core repo kernel-true-__UUID__' {
        insmod gzio
        insmod part_msdos
        insmod ext2
        set root='hd0,msdos1'
        if [ x$feature_platform_search_hint = xy ]; then
          search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1  __UUID__
        else
          search --no-floppy --fs-uuid --set=root __UUID__
        fi
        echo    'Loading Linux core repo kernel ...'
        linux   /boot/vmlinuz-linux root=UUID=__UUID__ ro
        echo    'Loading initial ramdisk ...'
        initrd  /boot/initramfs-linux.img
}
</pre>
<p>This file must be edited to match the UUID of the root partition. From within the <i>domU</i>, run the following command:
</p>
<pre># blkid
</pre>
<p>Replace all instances of <code>__UUID__</code> with the real UUID of the root partition (the one that mounts as <code>/</code>).:
</p>
<pre># sed -i 's/__UUID__/12345678-1234-1234-1234-123456789abcd/g' /boot/grub/grub.cfg
</pre>
<p>Shutdown the <i>domU</i> with the <code>poweroff</code> command. The console will be returned to the hypervisor when the domain is fully shut down, and the domain will no longer appear in the xl domains list. Now the ISO file may be unmounted:
</p>
<pre># umount /mnt
</pre>
<p>The <i>domU</i> cfg file should now be edited. Delete the <code>kernel =</code>, <code>ramdisk =</code>, and <code>extra =</code> lines and replace them with the following line:
</p>
<pre>bootloader = "pygrub"
</pre>
<p>Also remove the ISO disk from the <code>disk =</code> line.
</p>
<p>The Arch <i>domU</i> is now set up. It may be started with the same line as before:
</p>
<pre># xl create -c /etc/xen/archdomu.cfg
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3>
<span id=".22xl_list.22_complains_about_libxl"></span><span class="mw-headline" id='"xl_list"_complains_about_libxl'>"xl list" complains about libxl</span>
</h3>
<p>Either you have not booted into the Xen system, or xen modules listed in <code>xencommons</code> script are not installed.
</p>
<h3>
<span id=".22xl_create.22_fails"></span><span class="mw-headline" id='"xl_create"_fails'>"xl create" fails</span>
</h3>
<p>Check the guest's kernel is located correctly, check the <code>pv-xxx.cfg</code> file for spelling mistakes (like using <code>initrd</code> instead of <code>ramdisk</code>).
</p>
<h3><span class="mw-headline" id="Creating_HVM_fails">Creating HVM fails</span></h3>
<p>If creating HVM fails with:
</p>
<pre>libxl: error: libxl_dm.c:3131:device_model_spawn_outcome: Domain 33:domain 33 device model: spawn failed (rc=-3)
libxl: error: libxl_dm.c:3351:device_model_postconfig_done: Domain 33:Post DM startup configs failed, rc=-3
libxl: error: libxl_create.c:1837:domcreate_devmodel_started: Domain 33:device model did not start: -3
libxl: error: libxl_aoutils.c:646:libxl__kill_xs_path: Device Model already exited
</pre>
<p>You have missed to install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=numactl">numactl</a></span>.
</p>
<h3><span class="mw-headline" id="Arch_Linux_guest_hangs_with_a_ctrl-d_message">Arch Linux guest hangs with a ctrl-d message</span></h3>
<p>Press <code>ctrl-d</code> until you get back to a prompt, rebuild its initramfs described.
</p>
<h3>
<span id="failed_to_execute_.27.2Fusr.2Flib.2Fudev.2Fsocket:.2Forg.2Fxen.2Fxend.2Fudev_event.27_.27socket:.2Forg.2Fxen.2Fxend.2Fudev_event.27:_No_such_file_or_directory"></span><span class="mw-headline" id="failed_to_execute_'/usr/lib/udev/socket:/org/xen/xend/udev_event'_'socket:/org/xen/xend/udev_event':_No_such_file_or_directory">failed to execute '/usr/lib/udev/socket:/org/xen/xend/udev_event' 'socket:/org/xen/xend/udev_event': No such file or directory</span>
</h3>
<p>This is caused by <code>/etc/udev/rules.d/xend.rules</code>. Xend is deprecated and not used, so it is safe to remove that file.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.xenproject.org/">The homepage at xen.org</a></li>
<li><a rel="nofollow" class="external text" href="https://wiki.xenproject.org/wiki/Main_Page">The wiki at xen.org </a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Hypervisors.html" title="Category:Hypervisors">Hypervisors</a></li>
<li><a href="../en/Category:Kernel.html" title="Category:Kernel">Kernel</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Xen&amp;oldid=805958">https://wiki.archlinux.org/index.php?title=Xen&amp;oldid=805958</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 14 April 2024, at 10:44.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
