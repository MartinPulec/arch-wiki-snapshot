<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>DNS-over-HTTPS - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-DNS-over-HTTPS rootpage-DNS-over-HTTPS skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Client_startup" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Client_startup">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Client startup</div>
		</a>
		
			<button aria-controls="toc-Client_startup-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Client startup subsection</span>
			</button>
		
		<ul id="toc-Client_startup-sublist" class="vector-toc-list">
			<li id="toc-Disable_any_services_bound_to_port_53" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Disable_any_services_bound_to_port_53">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Disable any services bound to port 53</div>
			</a>
			
			<ul id="toc-Disable_any_services_bound_to_port_53-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Change_system_DNS_server" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Change_system_DNS_server">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Change system DNS server</div>
			</a>
			
			<ul id="toc-Change_system_DNS_server-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Startup" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Startup">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Startup</div>
			</a>
			
			<ul id="toc-Startup-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Test_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Test_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4</span>Test configuration</div>
			</a>
			
			<ul id="toc-Test_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Client_configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Client_configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Client configuration</div>
		</a>
		
			<button aria-controls="toc-Client_configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Client configuration subsection</span>
			</button>
		
		<ul id="toc-Client_configuration-sublist" class="vector-toc-list">
			<li id="toc-Select_preferred_upstream_DNS_server" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Select_preferred_upstream_DNS_server">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Select preferred upstream DNS server</div>
			</a>
			
			<ul id="toc-Select_preferred_upstream_DNS_server-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Service_does_not_start_properly_in_wired_connection" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Service_does_not_start_properly_in_wired_connection">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Service does not start properly in wired connection</div>
			</a>
			
			<ul id="toc-Service_does_not_start_properly_in_wired_connection-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">DNS-over-HTTPS</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 2 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-2" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">2 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/DNS-over-HTTPS" title="DNS-over-HTTPS – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/DNS-over-HTTPS" title="DNS-over-HTTPS – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/DNS_over_HTTPS_servers.html" title="DNS over HTTPS servers">DNS over HTTPS servers</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://github.com/m13253/dns-over-https">DNS-over-HTTPS</a> is an implementation of <a href="../en/Domain_name_resolution.html#Privacy_and_security" class="mw-redirect" title="DNS over HTTPS">DNS over HTTPS</a>. It can act as a stub resolver.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dns-over-https">dns-over-https</a></span> package.
</p>
<h2><span class="mw-headline" id="Client_startup">Client startup</span></h2>
<h3><span class="mw-headline" id="Disable_any_services_bound_to_port_53">Disable any services bound to port 53</span></h3>
<p>To see if any programs are using port 53, run:
</p>
<pre>$ ss -lp 'sport = :domain'
</pre>
<p>If the output contains more than the first line of column names, you need to disable whatever service is using port 53. You are ready to proceed once the above command outputs nothing more than the following line:
</p>
<pre>Netid State   Recv-Q  Send-Q   Local Address:Port     Peer Address:Port Process
</pre>
<h3><span class="mw-headline" id="Change_system_DNS_server">Change system DNS server</span></h3>
<p>Change your system's DNS server to an address in the <code>listen = </code> section of the configuration file. If you don't know what you're doing, <code>127.0.0.1</code> is recommended. 
</p>
<p>This can be accomplished either through your <a href="../en/Network_configuration.html#Network_managers" title="Network configuration">Network Manager</a> or through editing <a href="../en/Domain_name_resolution.html" class="mw-redirect" title="/etc/resolv.conf">/etc/resolv.conf</a>.
</p>
<h3><span class="mw-headline" id="Startup">Startup</span></h3>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> or <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>doh-client.service</code>.
</p>
<h3><span class="mw-headline" id="Test_configuration">Test configuration</span></h3>
<p>To test if your system's DNS works, type <code>nslookup www.google.com</code> into the command line. Note that this will work before DNS-over-HTTPS is configured, assuming you had a DNS configuration before installing this.
</p>
<h2><span class="mw-headline" id="Client_configuration">Client configuration</span></h2>
<p>The client configuration file is <code>/etc/dns-over-https/doh-client.conf</code> by default
</p>
<h3><span class="mw-headline" id="Select_preferred_upstream_DNS_server">Select preferred upstream DNS server</span></h3>
<p>To select a preferred <a href="../en/Category:Domain_Name_System.html" class="mw-redirect" title="DNS server">DNS server</a>, uncomment one of the profiles. 
</p>
<p>If your preferred server is not listed, you may use the following template in the <code>[upstream]</code> section.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dns-over-https/doh-client.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[[upstream.upstream_ietf]]
    url = "https://[IP or web address]/dns-query"
    weight = 20</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Service_does_not_start_properly_in_wired_connection">Service does not start properly in wired connection</span></h3>
<p>As <a rel="nofollow" class="external text" href="https://github.com/m13253/dns-over-https/issues/150#issuecomment-1709965957">explained by the developer</a>:
</p>
<dl>
<dd>ArchLinux doesn’t come with a default network management framework, thus systemd comes without online detection pre-configured.</dd>
<dd>If you are on Wi-Fi, I suggest making sure systemd’s online detection can function properly. I believe your system have already installed some network management framework such as NetworkManager to help you manage Wi-Fi passwords.</dd>
<dd>Or, if you are on wired network, simply modifying the .service file to disable online detection would be the easiest solution. Installing NetworkManager for a non-mobile machine might be against the K.I.S.S. principle, and we don’t want it.</dd>
</dl>
<p>Upstream <a rel="nofollow" class="external text" href="https://github.com/m13253/dns-over-https/issues/150#issuecomment-1706261425">suggests</a> to use a <a href="../en/Systemd.html#Drop-in_files" class="mw-redirect" title="Drop-in snippet">drop-in snippet</a> to your service file to:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/doh-client.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
After=multi-user.target

[Service]
Type=idle</pre>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Domain_Name_System.html" title="Category:Domain Name System">Domain Name System</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=DNS-over-HTTPS&amp;oldid=798897">https://wiki.archlinux.org/index.php?title=DNS-over-HTTPS&amp;oldid=798897</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 30 January 2024, at 13:57.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
