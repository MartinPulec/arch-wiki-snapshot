<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>OpenVPN - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.44.2">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-OpenVPN rootpage-OpenVPN skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Installation</span>
			</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Kernel_configuration" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Kernel_configuration">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Kernel configuration</span>
			</div>
		</a>
		
		<ul id="toc-Kernel_configuration-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Connect_to_a_VPN_provided_by_a_third_party" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Connect_to_a_VPN_provided_by_a_third_party">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Connect to a VPN provided by a third party</span>
			</div>
		</a>
		
		<ul id="toc-Connect_to_a_VPN_provided_by_a_third_party-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Create_a_Public_Key_Infrastructure_(PKI)_from_scratch" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Create_a_Public_Key_Infrastructure_(PKI)_from_scratch">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Create a Public Key Infrastructure (PKI) from scratch</span>
			</div>
		</a>
		
		<ul id="toc-Create_a_Public_Key_Infrastructure_(PKI)_from_scratch-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-A_basic_Layer-3_IP_routing_configuration" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#A_basic_Layer-3_IP_routing_configuration">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>A basic Layer-3 IP routing configuration</span>
			</div>
		</a>
		
			<button aria-controls="toc-A_basic_Layer-3_IP_routing_configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle A basic Layer-3 IP routing configuration subsection</span>
			</button>
		
		<ul id="toc-A_basic_Layer-3_IP_routing_configuration-sublist" class="vector-toc-list">
			<li id="toc-Example_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Example_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>Example configuration</span>
				</div>
			</a>
			
			<ul id="toc-Example_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-The_server_configuration_file" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#The_server_configuration_file">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2</span>
					<span>The server configuration file</span>
				</div>
			</a>
			
			<ul id="toc-The_server_configuration_file-sublist" class="vector-toc-list">
				<li id="toc-Hardening_the_server" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Hardening_the_server">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2.1</span>
					<span>Hardening the server</span>
				</div>
			</a>
			
			<ul id="toc-Hardening_the_server-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enabling_compression" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Enabling_compression">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2.2</span>
					<span>Enabling compression</span>
				</div>
			</a>
			
			<ul id="toc-Enabling_compression-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Deviating_from_the_standard_port_and/or_protocol" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Deviating_from_the_standard_port_and/or_protocol">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2.3</span>
					<span>Deviating from the standard port and/or protocol</span>
				</div>
			</a>
			
			<ul id="toc-Deviating_from_the_standard_port_and/or_protocol-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Running_multiple_instances_of_OpenVPN_on_different_ports_on_the_physical_machine" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Running_multiple_instances_of_OpenVPN_on_different_ports_on_the_physical_machine">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2.4</span>
					<span>Running multiple instances of OpenVPN on different ports on the physical machine</span>
				</div>
			</a>
			
			<ul id="toc-Running_multiple_instances_of_OpenVPN_on_different_ports_on_the_physical_machine-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-The_client_configuration_profile" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#The_client_configuration_profile">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.3</span>
					<span>The client configuration profile</span>
				</div>
			</a>
			
			<ul id="toc-The_client_configuration_profile-sublist" class="vector-toc-list">
				<li id="toc-Run_as_unprivileged_user" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Run_as_unprivileged_user">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.3.1</span>
					<span>Run as unprivileged user</span>
				</div>
			</a>
			
			<ul id="toc-Run_as_unprivileged_user-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Converting_certificates_to_encrypted_.p12_format" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Converting_certificates_to_encrypted_.p12_format">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.4</span>
					<span>Converting certificates to encrypted .p12 format</span>
				</div>
			</a>
			
			<ul id="toc-Converting_certificates_to_encrypted_.p12_format-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Testing_the_OpenVPN_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Testing_the_OpenVPN_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.5</span>
					<span>Testing the OpenVPN configuration</span>
				</div>
			</a>
			
			<ul id="toc-Testing_the_OpenVPN_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Configure_the_MTU_with_Fragment_and_MSS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Configure_the_MTU_with_Fragment_and_MSS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.6</span>
					<span>Configure the MTU with Fragment and MSS</span>
				</div>
			</a>
			
			<ul id="toc-Configure_the_MTU_with_Fragment_and_MSS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-IPv6" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#IPv6">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.7</span>
					<span>IPv6</span>
				</div>
			</a>
			
			<ul id="toc-IPv6-sublist" class="vector-toc-list">
				<li id="toc-Connect_to_the_server_via_IPv6" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Connect_to_the_server_via_IPv6">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.7.1</span>
					<span>Connect to the server via IPv6</span>
				</div>
			</a>
			
			<ul id="toc-Connect_to_the_server_via_IPv6-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Provide_IPv6_inside_the_tunnel" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Provide_IPv6_inside_the_tunnel">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.7.2</span>
					<span>Provide IPv6 inside the tunnel</span>
				</div>
			</a>
			
			<ul id="toc-Provide_IPv6_inside_the_tunnel-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Starting_OpenVPN" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Starting_OpenVPN">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Starting OpenVPN</span>
			</div>
		</a>
		
			<button aria-controls="toc-Starting_OpenVPN-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Starting OpenVPN subsection</span>
			</button>
		
		<ul id="toc-Starting_OpenVPN-sublist" class="vector-toc-list">
			<li id="toc-Manual_startup" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Manual_startup">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.1</span>
					<span>Manual startup</span>
				</div>
			</a>
			
			<ul id="toc-Manual_startup-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-systemd_service_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#systemd_service_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.2</span>
					<span>systemd service configuration</span>
				</div>
			</a>
			
			<ul id="toc-systemd_service_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Letting_NetworkManager_start_a_connection" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Letting_NetworkManager_start_a_connection">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.3</span>
					<span>Letting NetworkManager start a connection</span>
				</div>
			</a>
			
			<ul id="toc-Letting_NetworkManager_start_a_connection-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-NetworkManager-native_VPN_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#NetworkManager-native_VPN_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.4</span>
					<span>NetworkManager-native VPN configuration</span>
				</div>
			</a>
			
			<ul id="toc-NetworkManager-native_VPN_configuration-sublist" class="vector-toc-list">
				<li id="toc-GUI_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#GUI_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.4.1</span>
					<span>GUI configuration</span>
				</div>
			</a>
			
			<ul id="toc-GUI_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-CLI_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#CLI_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.4.2</span>
					<span>CLI configuration</span>
				</div>
			</a>
			
			<ul id="toc-CLI_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Sync_state_with_connection" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Sync_state_with_connection">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.4.3</span>
					<span>Sync state with connection</span>
				</div>
			</a>
			
			<ul id="toc-Sync_state_with_connection-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Automatically_connect_to_VPN_via_CLI" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Automatically_connect_to_VPN_via_CLI">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.4.4</span>
					<span>Automatically connect to VPN via CLI</span>
				</div>
			</a>
			
			<ul id="toc-Automatically_connect_to_VPN_via_CLI-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Troubleshooting">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.4.5</span>
					<span>Troubleshooting</span>
				</div>
			</a>
			
			<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
				<li id="toc-No_certificate_password" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#No_certificate_password">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.4.5.1</span>
					<span>No certificate password</span>
				</div>
			</a>
			
			<ul id="toc-No_certificate_password-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Routing_client_traffic_through_the_server" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Routing_client_traffic_through_the_server">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">7</span>
				<span>Routing client traffic through the server</span>
			</div>
		</a>
		
			<button aria-controls="toc-Routing_client_traffic_through_the_server-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Routing client traffic through the server subsection</span>
			</button>
		
		<ul id="toc-Routing_client_traffic_through_the_server-sublist" class="vector-toc-list">
			<li id="toc-Firewall_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Firewall_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.1</span>
					<span>Firewall configuration</span>
				</div>
			</a>
			
			<ul id="toc-Firewall_configuration-sublist" class="vector-toc-list">
				<li id="toc-firewalld" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#firewalld">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.1.1</span>
					<span>firewalld</span>
				</div>
			</a>
			
			<ul id="toc-firewalld-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-ufw" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#ufw">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.1.2</span>
					<span>ufw</span>
				</div>
			</a>
			
			<ul id="toc-ufw-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-iptables" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#iptables">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.1.3</span>
					<span>iptables</span>
				</div>
			</a>
			
			<ul id="toc-iptables-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Prevent_leaks_if_VPN_goes_down" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Prevent_leaks_if_VPN_goes_down">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.2</span>
					<span>Prevent leaks if VPN goes down</span>
				</div>
			</a>
			
			<ul id="toc-Prevent_leaks_if_VPN_goes_down-sublist" class="vector-toc-list">
				<li id="toc-ufw_2" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#ufw_2">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.2.1</span>
					<span>ufw</span>
				</div>
			</a>
			
			<ul id="toc-ufw_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-vpnfailsafe" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#vpnfailsafe">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.2.2</span>
					<span>vpnfailsafe</span>
				</div>
			</a>
			
			<ul id="toc-vpnfailsafe-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-dhcpcd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#dhcpcd">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">7.3</span>
					<span>dhcpcd</span>
				</div>
			</a>
			
			<ul id="toc-dhcpcd-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Layer-3_IPv4_routing" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Layer-3_IPv4_routing">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">8</span>
				<span>Layer-3 IPv4 routing</span>
			</div>
		</a>
		
			<button aria-controls="toc-Layer-3_IPv4_routing-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Layer-3 IPv4 routing subsection</span>
			</button>
		
		<ul id="toc-Layer-3_IPv4_routing-sublist" class="vector-toc-list">
			<li id="toc-Prerequisites_for_routing_a_LAN" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Prerequisites_for_routing_a_LAN">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.1</span>
					<span>Prerequisites for routing a LAN</span>
				</div>
			</a>
			
			<ul id="toc-Prerequisites_for_routing_a_LAN-sublist" class="vector-toc-list">
				<li id="toc-Routing_tables" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Routing_tables">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.1.1</span>
					<span>Routing tables</span>
				</div>
			</a>
			
			<ul id="toc-Routing_tables-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Connect_the_server_LAN_to_a_client" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connect_the_server_LAN_to_a_client">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.2</span>
					<span>Connect the server LAN to a client</span>
				</div>
			</a>
			
			<ul id="toc-Connect_the_server_LAN_to_a_client-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Connect_the_client_LAN_to_a_server" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connect_the_client_LAN_to_a_server">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.3</span>
					<span>Connect the client LAN to a server</span>
				</div>
			</a>
			
			<ul id="toc-Connect_the_client_LAN_to_a_server-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Connect_both_the_client_and_server_LANs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connect_both_the_client_and_server_LANs">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.4</span>
					<span>Connect both the client and server LANs</span>
				</div>
			</a>
			
			<ul id="toc-Connect_both_the_client_and_server_LANs-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Connect_clients_and_client_LANs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connect_clients_and_client_LANs">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.5</span>
					<span>Connect clients and client LANs</span>
				</div>
			</a>
			
			<ul id="toc-Connect_clients_and_client_LANs-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-DNS" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#DNS">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">9</span>
				<span>DNS</span>
			</div>
		</a>
		
			<button aria-controls="toc-DNS-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle DNS subsection</span>
			</button>
		
		<ul id="toc-DNS-sublist" class="vector-toc-list">
			<li id="toc-The_pull-resolv-conf_custom_scripts" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#The_pull-resolv-conf_custom_scripts">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">9.1</span>
					<span>The pull-resolv-conf custom scripts</span>
				</div>
			</a>
			
			<ul id="toc-The_pull-resolv-conf_custom_scripts-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-The_update-resolv-conf_custom_script" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#The_update-resolv-conf_custom_script">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">9.2</span>
					<span>The update-resolv-conf custom script</span>
				</div>
			</a>
			
			<ul id="toc-The_update-resolv-conf_custom_script-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-The_update-systemd-resolved_custom_script" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#The_update-systemd-resolved_custom_script">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">9.3</span>
					<span>The update-systemd-resolved custom script</span>
				</div>
			</a>
			
			<ul id="toc-The_update-systemd-resolved_custom_script-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Override_DNS_servers_using_NetworkManager" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Override_DNS_servers_using_NetworkManager">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">9.4</span>
					<span>Override DNS servers using NetworkManager</span>
				</div>
			</a>
			
			<ul id="toc-Override_DNS_servers_using_NetworkManager-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Layer-2_Ethernet_bridging" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Layer-2_Ethernet_bridging">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">10</span>
				<span>Layer-2 Ethernet bridging</span>
			</div>
		</a>
		
		<ul id="toc-Layer-2_Ethernet_bridging-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration_generators" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Configuration_generators">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">11</span>
				<span>Configuration generators</span>
			</div>
		</a>
		
			<button aria-controls="toc-Configuration_generators-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration generators subsection</span>
			</button>
		
		<ul id="toc-Configuration_generators-sublist" class="vector-toc-list">
			<li id="toc-ovpngen" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ovpngen">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">11.1</span>
					<span>ovpngen</span>
				</div>
			</a>
			
			<ul id="toc-ovpngen-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-openvpn-unroot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#openvpn-unroot">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">11.2</span>
					<span>openvpn-unroot</span>
				</div>
			</a>
			
			<ul id="toc-openvpn-unroot-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting_2" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting_2">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">12</span>
				<span>Troubleshooting</span>
			</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting_2-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting_2-sublist" class="vector-toc-list">
			<li id="toc-Client_daemon_not_reconnecting_after_suspend" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Client_daemon_not_reconnecting_after_suspend">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.1</span>
					<span>Client daemon not reconnecting after suspend</span>
				</div>
			</a>
			
			<ul id="toc-Client_daemon_not_reconnecting_after_suspend-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Connection_drops_out_after_some_time_of_inactivity" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connection_drops_out_after_some_time_of_inactivity">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.2</span>
					<span>Connection drops out after some time of inactivity</span>
				</div>
			</a>
			
			<ul id="toc-Connection_drops_out_after_some_time_of_inactivity-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-PID_files_not_present" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#PID_files_not_present">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.3</span>
					<span>PID files not present</span>
				</div>
			</a>
			
			<ul id="toc-PID_files_not_present-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Route_configuration_fails_with_systemd-networkd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Route_configuration_fails_with_systemd-networkd">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.4</span>
					<span>Route configuration fails with systemd-networkd</span>
				</div>
			</a>
			
			<ul id="toc-Route_configuration_fails_with_systemd-networkd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-tls-crypt_unwrap_error:_packet_too_short" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#tls-crypt_unwrap_error:_packet_too_short">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.5</span>
					<span>tls-crypt unwrap error: packet too short</span>
				</div>
			</a>
			
			<ul id="toc-tls-crypt_unwrap_error:_packet_too_short-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-NetworkManager_fails_to_connect_using_imported_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#NetworkManager_fails_to_connect_using_imported_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.6</span>
					<span>NetworkManager fails to connect using imported configuration</span>
				</div>
			</a>
			
			<ul id="toc-NetworkManager_fails_to_connect_using_imported_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-OpenVPN_connection_fails_after_update_to_OpenSSL3" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#OpenVPN_connection_fails_after_update_to_OpenSSL3">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.7</span>
					<span>OpenVPN connection fails after update to OpenSSL3</span>
				</div>
			</a>
			
			<ul id="toc-OpenVPN_connection_fails_after_update_to_OpenSSL3-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">13</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar vector-feature-custom-font-size-clientpref--excluded">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">OpenVPN</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-de mw-list-item"><a href="https://wiki.archlinux.de/title/OpenVPN" title="OpenVPN – Deutsch" lang="de" hreflang="de" data-title="OpenVPN" data-language-autonym="Deutsch" data-language-local-name="Deutsch" class="interlanguage-link-target"><span>Deutsch</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/OpenVPN" title="OpenVPN – 日本語" lang="ja" hreflang="ja" data-title="OpenVPN" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/OpenVPN" title="OpenVPN – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" data-title="OpenVPN" data-language-autonym="中文（简体）" data-language-local-name="中文（简体）" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end vector-feature-custom-font-size-clientpref--excluded">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Linux_Containers/Using_VPNs.html" title="Linux Containers/Using VPNs">Linux_Containers/Using_VPNs</a></li>
<li><a href="../en/OpenVPN/Checklist_guide.html" class="mw-redirect" title="OpenVPN Checklist Guide">OpenVPN Checklist Guide</a></li>
<li><a href="../en/Easy-RSA.html" title="Easy-RSA">Easy-RSA</a></li>
</ul>
</div>
<p>This article describes a basic installation and configuration of <a rel="nofollow" class="external text" href="https://openvpn.net">OpenVPN</a>, suitable for private and small business use. For more detailed information, please see <span class="plainlinks archwiki-template-man" title="$ man 8 openvpn"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/openvpn.8">openvpn(8)</a></span> and the <a rel="nofollow" class="external text" href="https://openvpn.net/index.php/open-source/documentation">OpenVPN documentation</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2025-11-17—HTTP 404]</sup>. OpenVPN is a robust and highly flexible <a href="https://en.wikipedia.org/wiki/VPN" class="extiw" title="wikipedia:VPN">VPN</a> daemon. It supports <a href="https://en.wikipedia.org/wiki/SSL/TLS" class="extiw" title="wikipedia:SSL/TLS">SSL/TLS</a> security, <a href="https://en.wikipedia.org/wiki/Bridging_(networking)" class="extiw" title="wikipedia:Bridging (networking)">Ethernet bridging</a>, <a href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol" class="extiw" title="wikipedia:Transmission Control Protocol">TCP</a> or <a href="https://en.wikipedia.org/wiki/User_Datagram_Protocol" class="extiw" title="wikipedia:User Datagram Protocol">UDP</a> <a href="https://en.wikipedia.org/wiki/Tunneling_protocol" class="extiw" title="wikipedia:Tunneling protocol">tunnel transport</a> through <a href="https://en.wikipedia.org/wiki/Proxy_server" class="extiw" title="wikipedia:Proxy server">proxies</a> or <a href="https://en.wikipedia.org/wiki/Network_address_translation" class="extiw" title="wikipedia:Network address translation">NAT</a>. Additionally it has support for dynamic IP addresses and <a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol" class="extiw" title="wikipedia:Dynamic Host Configuration Protocol">DHCP</a>, scalability to hundreds or thousands of users, and portability to most major OS platforms.
</p>
<p>OpenVPN is tightly bound to the <a rel="nofollow" class="external text" href="https://www.openssl.org">OpenSSL</a> library, and derives much of its crypto capabilities from it. It supports conventional encryption using a <a href="https://en.wikipedia.org/wiki/Pre-shared_key" class="extiw" title="wikipedia:Pre-shared key">pre-shared secret key</a> (Static Key mode) or <a href="https://en.wikipedia.org/wiki/Public_key" class="extiw" title="wikipedia:Public key">public key security</a> (<a href="https://en.wikipedia.org/wiki/SSL/TLS" class="extiw" title="wikipedia:SSL/TLS">SSL/TLS</a> mode) using client &amp; server certificates. Additionally it supports unencrypted TCP/UDP tunnels.
</p>
<p>OpenVPN is designed to work with the <a href="https://en.wikipedia.org/wiki/TUN/TAP" class="extiw" title="wikipedia:TUN/TAP">TUN/TAP</a> virtual networking interface that exists on most platforms. Overall, it aims to offer many of the key features of <a href="https://en.wikipedia.org/wiki/Ipsec" class="extiw" title="wikipedia:Ipsec">IPSec</a> but with a relatively lightweight footprint. OpenVPN was written by James Yonan and is published under the <a href="https://en.wikipedia.org/wiki/GNU_General_Public_License" class="extiw" title="wikipedia:GNU General Public License">GNU General Public License (GPL)</a>.
</p>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Installation">Installation</h2></div>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openvpn">openvpn</a></span> package, which provides both server and client mode.
</p>
<p>Available frontends:
</p>
<ul><li>
<b> NetworkManager OpenVPN</b> — NetworkManager VPN plugin for OpenVPN.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://wiki.gnome.org/Projects/NetworkManager/VPN">https://wiki.gnome.org/Projects/NetworkManager/VPN</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager-openvpn">networkmanager-openvpn</a></span>
</dd></dl>
<ul><li>
<b>QOpenVPN</b> — Simple OpenVPN GUI written in PyQt for systemd based distributions.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/xmikos/qopenvpn">https://github.com/xmikos/qopenvpn</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=qopenvpn">qopenvpn</a></span>
</dd></dl>
<ul><li>
<b>eOVPN</b> — Application to connect, manage and update OpenVPN configurations. Written in GTK. Supports both OpenVPN 2 and OpenVPN 3 with <a rel="nofollow" class="external text" href="https://openvpn.net/blog/openvpn-data-channel-offload/">Data Channel Offload</a>
</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/jkotra/eOVPN">https://github.com/jkotra/eOVPN</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/eovpn/">eovpn</a></span><sup><small>AUR</small></sup>
</dd></dl>
<div class="mw-heading mw-heading2"><h2 id="Kernel_configuration">Kernel configuration</h2></div>
<p>OpenVPN requires TUN/TAP support, which is already configured in the default kernel. Users of custom kernel should make sure to enable the <code>tun</code> module (<code>CONFIG_TUN</code>) in <i>Device Drivers &gt; Network device support &gt; Network core driver support &gt; Universal TUN/TAP device driver support</i>.
</p>
<p>Read <a href="../en/Kernel_module.html" title="Kernel module">Kernel module</a> for more information.
</p>
<div class="mw-heading mw-heading2"><h2 id="Connect_to_a_VPN_provided_by_a_third_party">Connect to a VPN provided by a third party</h2></div>
<p>To connect to a VPN service provided by a third party, most of the following can most likely be ignored, especially regarding server setup. Begin with <a href="#The_client_configuration_profile">#The client configuration profile</a> and skip ahead to <a href="#Starting_OpenVPN">#Starting OpenVPN</a> after that. One should use the provider certificates and instructions, see <a href="../en/Category:VPN_providers.html" title="Category:VPN providers">Category:VPN providers</a> for examples that can be adapted to other providers. <a href="../en/Linux_Containers/Using_VPNs.html" class="mw-redirect" title="OpenVPN client in Linux Containers">OpenVPN client in Linux Containers</a> also has general applicable instructions, while it goes a step further by isolating an OpenVPN client process into a container.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Most free VPN providers will (often only) offer <a href="../en/PPTP_server.html" title="PPTP server">PPTP</a>, which is drastically easier to setup and configure, but <a rel="nofollow" class="external text" href="https://poptop.sourceforge.net/dox/protocol-security.phtml">not secure</a>.</div>
<div class="mw-heading mw-heading2"><h2 id="Create_a_Public_Key_Infrastructure_(PKI)_from_scratch">
<span id="Create_a_Public_Key_Infrastructure_.28PKI.29_from_scratch"></span>Create a Public Key Infrastructure (PKI) from scratch</h2></div>
<p>When setting up an OpenVPN server, users need to create a <a href="https://en.wikipedia.org/wiki/Public_key_infrastructure" class="extiw" title="wikipedia:Public key infrastructure">Public Key Infrastructure (PKI)</a> which is detailed in the <a href="../en/Easy-RSA.html" title="Easy-RSA">Easy-RSA</a> article.  Once the needed certificates, private keys, and associated files are created via following the steps in the separate article, one should have 5 files in <code>/etc/openvpn/server</code> at this point:
</p>
<pre>ca.crt
dh.pem
servername.crt
servername.key
ta.key
</pre>
<p>Alternatively, as of OpenVPN 2.4, one can use Easy-RSA to generate certificates and keys using elliptic curves. See the OpenVPN documentation for details.
</p>
<div class="mw-heading mw-heading2"><h2 id="A_basic_Layer-3_IP_routing_configuration">A basic Layer-3 IP routing configuration</h2></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Unless otherwise explicitly stated, the rest of this article assumes a basic Layer-3 IP routing configuration.</div>
<p>OpenVPN is an extremely versatile piece of software and many configurations are possible, in fact machines can be both servers and clients.
</p>
<p>With the release of v2.4, server configurations are stored in <code>/etc/openvpn/server</code> and client configurations are stored in <code>/etc/openvpn/client</code> and each mode has its own respective systemd unit, namely, <code>openvpn-client@.service</code> and <code>openvpn-server@.service</code>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Example_configuration">Example configuration</h3></div>
<p>The OpenVPN package comes with a collection of example configuration files for different purposes. The sample server and client configuration files make an ideal starting point for a basic OpenVPN setup with the following features:
</p>
<ul>
<li>Uses <a href="https://en.wikipedia.org/wiki/Public_key_infrastructure" class="extiw" title="wikipedia:Public key infrastructure">Public Key Infrastructure (PKI)</a> for authentication.</li>
<li>Creates a VPN using a virtual TUN network interface (OSI Layer-3 IP routing).</li>
<li>Listens for client connections on UDP port 1194 (OpenVPN's official IANA port number<a rel="nofollow" class="external autonumber" href="https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml?search=openvpn">[1]</a>).</li>
<li>Distributes virtual addresses to connecting clients from the 10.8.0.0/24 subnet.</li>
</ul>
<p>For more advanced configurations, please see the <span class="plainlinks archwiki-template-man" title="$ man 8 openvpn"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/openvpn.8">openvpn(8)</a></span> man page and the <a rel="nofollow" class="external text" href="https://openvpn.net/index.php/open-source/documentation">OpenVPN documentation</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2025-11-17—HTTP 404]</sup>.
</p>
<div class="mw-heading mw-heading3"><h3 id="The_server_configuration_file">The server configuration file</h3></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Note that if the server is behind a firewall or a NAT translating router, the OpenVPN port must be forwarded on to the server.</div>
<p>Copy the example server configuration file <code>/usr/share/openvpn/examples/server.conf</code> to <code>/etc/openvpn/server/server.conf</code>.
</p>
<p>Edit the file making a minimum of the following changes:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/server/server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ca ca.crt
cert servername.crt
key servername.key
dh dh.pem

tls-crypt ta.key # Replaces <i>tls-auth ta.key 0</i>

user nobody
group nobody
</pre>
<p>If TLS with elliptic curves is used, specify <code>dh none</code> and <code>ecdh-curve secp521r1</code> (or <code>ecdh-curve ed25519</code>). DH parameters file is not used when using elliptic curves. Starting from OpenVPN 2.4.8, it is required to specify the type of elliptic curves in server configuration. Otherwise the server would fail to recognize the curve type and possibly use an incompatible one, resulting in authentication errors.
</p>
<div class="mw-heading mw-heading4"><h4 id="Hardening_the_server">Hardening the server</h4></div>
<p>If security is a priority, additional configuration is recommended including: limiting the server to use a strong cipher/auth method and (optionally) limiting the set of enabled TLS ciphers to the newer ciphers. Starting from OpenVPN 2.4, the server and the client will automatically negotiate AES-256-GCM in TLS mode.
</p>
<p>Add the following to <code>/etc/openvpn/server/server.conf</code>:
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> Usage instructions belong into the wiki text, not into code blocks. Avoid subjective terms like "bleeding edge security". (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:OpenVPN.html">Talk:OpenVPN</a>)</div>
</div>
<p>Bleeding edge security:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/server/server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">cipher AES-256-GCM
auth SHA512
tls-version-min 1.3
#Uncomment  tls-cipher to limit possible negotiation options to the strongest ciphers, doing so it's no longer possible to generate certs with current easyrsa, <a rel="nofollow" class="external text" href="https://wiki.openssl.org/index.php/TLS1.3">more information</a>
#tls-cipher TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
</pre>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> Compatibility options do not fit into a hardening section. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:OpenVPN.html">Talk:OpenVPN</a>)</div>
</div>
<p>Compatibility with most devices:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/server/server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">cipher AES-256-GCM
auth SHA512
tls-version-min 1.2
tls-cipher TLS-DHE-RSA-WITH-AES-256-GCM-SHA384:TLS-DHE-RSA-WITH-AES-128-GCM-SHA256:TLS-DHE-RSA-WITH-AES-256-CBC-SHA:TLS-DHE-RSA-WITH-CAMELLIA-256-CBC-SHA:TLS-DHE-RSA-WITH-AES-128-CBC-SHA:TLS-DHE-RSA-WITH-CAMELLIA-128-CBC-SHA
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> 
<ul>
<li>The .ovpn client profile <b>must</b> contain a matching cipher and auth line to work properly (at least with the iOS and Android client).</li>
<li>Using <code>tls-cipher</code> incorrectly may cause difficulty with debugging connections and may not be necessary. See <a rel="nofollow" class="external text" href="https://community.openvpn.net/openvpn/wiki/Hardening#Useof--tls-cipher">OpenVPN’s community wiki</a> for more information.</li>
</ul>
</div>
<div class="mw-heading mw-heading4"><h4 id="Enabling_compression">Enabling compression</h4></div>
<p>Enabling compression is not recommended by upstream; doing so opens to the server the so-called VORACLE attack vector.  See <a rel="nofollow" class="external text" href="https://community.openvpn.net/openvpn/wiki/VORACLE">this</a> article.
</p>
<div class="mw-heading mw-heading4"><h4 id="Deviating_from_the_standard_port_and/or_protocol">
<span id="Deviating_from_the_standard_port_and.2For_protocol"></span>Deviating from the standard port and/or protocol</h4></div>
<p>It is generally recommended to use OpenVPN over UDP, because <a rel="nofollow" class="external text" href="https://web.archive.org/web/20220724145449/sites.inka.de/bigred/devel/tcp-tcp.html">TCP over TCP is a bad idea</a><a rel="nofollow" class="external autonumber" href="https://adsabs.harvard.edu/abs/2005SPIE.6011..138H">[2]</a>.
</p>
<p>Some networks may disallow OpenVPN connections on the default port and/or protocol. One strategy to circumvent this is to mimic HTTPS traffic which is very likely unobstructed.
</p>
<p>To do so, configure <code>/etc/openvpn/server/server.conf</code> as such:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/server/server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">port 443
proto tcp
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> The .ovpn client profile <b>must</b> contain a matching port and proto line to work properly!</div>
<div class="mw-heading mw-heading4"><h4 id="Running_multiple_instances_of_OpenVPN_on_different_ports_on_the_physical_machine">Running multiple instances of OpenVPN on different ports on the physical machine</h4></div>
<p>One can have multiple, concurrent instances of OpenVPN running on the same box.  Each server needs to be defined in <code>/etc/openvpn/server/</code> as a separate .conf file.  At a minimum, the parallel servers need to be running on different ports.  A simple setup directs traffic connecting in to a separate IP pool.  More advanced setups are beyond the scope of this guide.
</p>
<p>Consider this example, running 2 concurrent servers, one port 443/udp and another on port 80/tcp.
</p>
<p>First modify <code>/etc/openvpn/server/server.conf</code> created as so:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/server/server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">port 443
proto udp
server 10.8.0.0 255.255.255.0
</pre>
<p>Now copy it and modify the copy to run on 80/tcp:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/server/server2.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">port 80
proto tcp
server 10.8.1.0 255.255.255.0
</pre>
<p>Be sure to setup the corresponding entries in the firewall, see the relevant sections in <a href="#Firewall_configuration">#Firewall configuration</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="The_client_configuration_profile">The client configuration profile</h3></div>
<p>Copy the example client configuration file <code>/usr/share/openvpn/examples/client.conf</code> to <code>/etc/openvpn/client/</code>.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> As of 2.5.0-3, "OpenVPN now uses a netlink interface for network configuration. The systemd units start the process with a dedicated unprivileged user 'openvpn', with extra capabilities(7). The configuration should no longer drop privileges, so remove 'user' and 'group' directives. Scripts that require elevated privileges may need a workaround." (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:OpenVPN.html">Talk:OpenVPN</a>)</div>
</div>
<p>Edit the following:
</p>
<ul>
<li>The <code>remote</code> directive to reflect either the server's <a href="https://en.wikipedia.org/wiki/Fully_qualified_domain_name" class="extiw" title="wikipedia:Fully qualified domain name">Fully Qualified Domain Name</a>, hostname (as known to the client), or its IP address.</li>
<li>Uncomment the <code>user</code> and <code>group</code> directives to drop privileges.</li>
<li>The <code>ca</code>, <code>cert</code>, and <code>key</code> parameters to reflect the path and names of the keys and certificates.</li>
<li>Enable the TLS HMAC handshake protection (<code>--tls-crypt</code> or <code>--tls-auth</code>).</li>
</ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/client/client.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">client
remote elmer.acmecorp.org 1194

user nobody
group nobody
ca ca.crt
cert client.crt
key client.key

tls-crypt ta.key # Replaces <i>tls-auth ta.key 1</i>
</pre>
<div class="mw-heading mw-heading4"><h4 id="Run_as_unprivileged_user">Run as unprivileged user</h4></div>
<p>Using the options <code>user nobody</code> and <code>group nobody</code> in the configuration file makes <i>OpenVPN</i> drop its <code>root</code> privileges after establishing the connection. The downside is that upon VPN disconnect the daemon is unable to delete its set network routes again. If one wants to limit transmitting traffic without the VPN connection, then lingering routes may be considered beneficial. It can also happen, however, that the OpenVPN server pushes updates to routes at runtime of the tunnel. A client with dropped privileges will be unable to perform the update and exit with an error.
</p>
<p>As it could seem to require manual action to manage the routes, the options <code>user nobody</code> and <code>group nobody</code> might seem undesirable. Depending on setup, however, there are different ways to handle these situations: 
</p>
<ul>
<li>For errors of the unit, a simple way is to <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">edit</a> it and add a <code>Restart=on-failure</code> to the <code>[Service]</code> section. Though, this alone will not delete any obsoleted routes, so it may happen that the restarted tunnel is not routed properly.</li>
<li>The package contains the <code>/usr/lib/openvpn/plugins/openvpn-plugin-down-root.so</code>, which can be used to let <i>openvpn</i> fork a process with root privileges with the only task to execute a custom script when receiving a down signal from the main process, which is handling the tunnel with dropped privileges (see also its <a rel="nofollow" class="external text" href="https://community.openvpn.net/openvpn/browser/plugin/down-root/README?rev=d02a86d37bed69ee3fb63d08913623a86c88da15">README</a>).</li>
</ul>
<p>The OpenVPN HowTo's linked below go further by creating a dedicated non-privileged user/group, instead of the already existing <code>nobody</code>. The advantage is that this avoids potential risks when sharing a user among daemons:
</p>
<ul>
<li>The <a rel="nofollow" class="external text" href="https://openvpn.net/index.php/open-source/documentation/howto.html#security">OpenVPN HowTo</a> explains another way how to create an unprivileged user mode and wrapper script to have the routes restored automatically.</li>
<li>It is possible to let OpenVPN start as a non-privileged user in the first place, without ever running as root, see <a rel="nofollow" class="external text" href="https://community.openvpn.net/openvpn/wiki/UnprivilegedUser">this OpenVPN wiki</a> (howto). The howto assumes the presence of System V init, rather than <a href="../en/Systemd.html" title="Systemd">Systemd</a> and does not cover the handling of <code>--up</code>/<code>--down</code> scripts - those should be handled the same way as the <i>ip</i> command, with additional attention to access rights.</li>
<li>It is also possible to run OpenVPN from within unprivileged podman container, see <a rel="nofollow" class="external text" href="https://community.openvpn.net/openvpn/wiki/UnprivilegedUser#RunOpenVPNwithinunprivilegedpodmancontainer">this section of OpenVPN HowTo</a>
</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> <a href="#openvpn-unroot">#openvpn-unroot</a> describes a tool to automate above setup.</div>
<div class="mw-heading mw-heading3"><h3 id="Converting_certificates_to_encrypted_.p12_format">Converting certificates to encrypted .p12 format</h3></div>
<p>Some software will only read VPN certificates that are stored in a password-encrypted .p12 file. These can be generated with the following command:
</p>
<pre># openssl pkcs12 -export -inkey keys/bugs.key -in keys/bugs.crt -certfile keys/ca.crt -out keys/bugs.p12
</pre>
<div class="mw-heading mw-heading3"><h3 id="Testing_the_OpenVPN_configuration">Testing the OpenVPN configuration</h3></div>
<p>Run <code>openvpn /etc/openvpn/server/server.conf</code> (as the root user) on the server, and <code>openvpn /etc/openvpn/client/client.conf</code> (as the root user) on the client.  Example output should be similar to the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># openvpn /etc/openvpn/server/server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Wed Dec 28 14:41:26 2011 OpenVPN 2.2.1 x86_64-unknown-linux-gnu [SSL] [LZO2] [EPOLL] [eurephia] built on Aug 13 2011
Wed Dec 28 14:41:26 2011 NOTE: OpenVPN 2.1 requires '--script-security 2' or higher to call user-defined scripts or executables
Wed Dec 28 14:41:26 2011 Diffie-Hellman initialized with 2048 bit key
...
Wed Dec 28 14:41:54 2011 bugs/95.126.136.73:48904 MULTI: primary virtual IP for bugs/95.126.136.73:48904: 10.8.0.6
Wed Dec 28 14:41:57 2011 bugs/95.126.136.73:48904 PUSH: Received control message: 'PUSH_REQUEST'
Wed Dec 28 14:41:57 2011 bugs/95.126.136.73:48904 SENT CONTROL [bugs]: 'PUSH_REPLY,route 10.8.0.1,topology net30,ping 10,ping-restart 120,ifconfig 10.8.0.6 10.8.0.5' (status=1)</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># openvpn /etc/openvpn/client/client.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Wed Dec 28 14:41:50 2011 OpenVPN 2.2.1 i686-pc-linux-gnu [SSL] [LZO2] [EPOLL] [eurephia] built on Aug 13 2011
Wed Dec 28 14:41:50 2011 NOTE: OpenVPN 2.1 requires '--script-security 2' or higher to call user-defined scripts or executables
...
Wed Dec 28 14:41:57 2011 GID set to nobody
Wed Dec 28 14:41:57 2011 UID set to nobody
Wed Dec 28 14:41:57 2011 Initialization Sequence Completed</pre>
<p><a href="../en/Network_configuration.html#IP_addresses" title="Network configuration">Find the IP address</a> assigned to the tunX interface on the server, and <a href="../en/Network_configuration.html#Ping" class="mw-redirect" title="Ping">ping</a> it from the client.
</p>
<p><a href="../en/Network_configuration.html#IP_addresses" title="Network configuration">Find the IP address</a> assigned to the tunX interface on the client, and <a href="../en/Network_configuration.html#Ping" class="mw-redirect" title="Ping">ping</a> it from the server.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> If using a firewall, make sure that IP packets on the TUN device are not blocked.</div>
<div class="mw-heading mw-heading3"><h3 id="Configure_the_MTU_with_Fragment_and_MSS">Configure the MTU with Fragment and MSS</h3></div>
<p>If experiencing issues when using (remote) services over OpenVPN (e.g. web browsing, <a href="../en/Domain_name_resolution.html" class="mw-redirect" title="DNS">DNS</a>, <a href="../en/NFS.html" title="NFS">NFS</a>), it may be needed to set a MTU value manually.
</p>
<p>The following message may indicate the MTU value should be adjusted:
</p>
<pre>read UDPv4 [EMSGSIZE Path-MTU=1407]: Message too long (code=90)
</pre>
<p>In order to get the  maximum segment size (MSS), the client needs to discover the smallest MTU along the path to the server. In order to do this  ping the server and disable fragmentation, then specify the maximum packet size <a rel="nofollow" class="external autonumber" href="https://www.sonassi.com/help/troubleshooting/setting-correct-mtu-for-openvpn">[3]</a>:
</p>
<pre># ping -M do -s 1500 -c 1 example.com
</pre>
<p>Decrease the 1500 value by 10 each time, until the ping succeeds.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Clients that do not support the 'fragment' directive (e.g. OpenELEC, <a rel="nofollow" class="external text" href="https://docs.openvpn.net/connecting/connecting-to-access-server-with-apple-ios/faq-regarding-openvpn-connect-ios/">iOS app</a>) are not able to connect to a server that uses the <code>fragment</code> directive. See <code>mtu-test</code> as alternative solution.</div>
<p>Update the client configuration to use the succeeded MTU value, e.g.:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/client/client.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">remote example.com 1194

tun-mtu 1400 
mssfix 1360
</pre>
<p>OpenVPN may be instructed to test the MTU every time on client connect. Be patient, since the client may not inform about the test being run and the connection may appear as nonfunctional until finished.  The following will add about 3 minutes to OpenVPN start time. It is advisable to configure the fragment size unless a client will be connecting over many different networks and the bottle neck is not on the server side:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/client/client.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">remote example.com 1194

mtu-test
</pre>
<div class="mw-heading mw-heading3"><h3 id="IPv6">IPv6</h3></div>
<div class="mw-heading mw-heading4"><h4 id="Connect_to_the_server_via_IPv6">Connect to the server via IPv6</h4></div>
<p>Starting from OpenVPN 2.4, OpenVPN will use <code>AF_INET</code> defined by the OS when just using <code>proto udp</code> or <code>proto tcp</code>, which in most cases will be IPv4 only. To use both IPv4 and IPv6, use <code>proto udp6</code> or <code>proto tcp6</code>. To enforce only IPv4-only, use <code>proto udp4</code> or <code>proto tcp4</code>. On older OpenVPN versions, one server instance can only support either IPv4 or IPv6.
</p>
<div class="mw-heading mw-heading4"><h4 id="Provide_IPv6_inside_the_tunnel">Provide IPv6 inside the tunnel</h4></div>
<p>In order to provide IPv6 inside the tunnel, have an IPv6 prefix routed to the OpenVPN server. Either set up a static route on the gateway (if a static block is assigned), or use a DHCPv6 client to get a prefix with DHCPv6 Prefix delegation (see <a href="../en/IPv6.html#Prefix_delegation_(DHCPv6-PD)" title="IPv6">IPv6 Prefix delegation</a> for details). Also consider using a unique local address from the address block fc00::/7. Both methods have advantages and disadvantages:
</p>
<ul>
<li>Many ISPs only provide dynamically changing IPv6 prefixes. OpenVPN does not support prefix changes, so change the server.conf every time the prefix is changed (Maybe can be automated with a script).</li>
<li>ULA addresses are not routed to the Internet, and setting up NAT is not as straightforward as with IPv4. This means one cannot route the entire traffic over the tunnel. Those wanting to connect two sites via IPv6, without the need to connect to the Internet over the tunnel, may want to use the ULA addresses for ease.</li>
</ul>
<p>Alternatively, a NDP proxy should work. See <a rel="nofollow" class="external text" href="https://unix.stackexchange.com/questions/136211/routing-public-ipv6-traffic-through-openvpn-tunnel">this StackExchange post</a>.
</p>
<p>After having received a prefix (a /64 is recommended), append the following to the server.conf:
</p>
<pre>server-ipv6 2001:db8:0:123::/64
</pre>
<p>This is the IPv6 equivalent to the default 10.8.0.0/24 network of OpenVPN and needs to be taken from the DHCPv6 client. Or use for example fd00:1234::/64.
</p>
<p>Those wanting to push a route to a home network (192.168.1.0/24 equivalent), need to also append:
</p>
<pre>push "route-ipv6 2001:db8:0:abc::/64"
</pre>
<p>OpenVPN does not yet include DHCPv6, so there is no method to e.g. push DNS server over IPv6. This needs to be done with IPv4. The <a rel="nofollow" class="external text" href="https://community.openvpn.net/openvpn/wiki/IPv6">OpenVPN Wiki</a> provides some other configuration options.
</p>
<div class="mw-heading mw-heading2"><h2 id="Starting_OpenVPN">Starting OpenVPN</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Manual_startup">Manual startup</h3></div>
<p>To troubleshoot a VPN connection, start the client's daemon manually with <code>openvpn /etc/openvpn/client/client.conf</code> as root. The server can be started the same way using its own configuration file (e.g., <code>openvpn /etc/openvpn/server/server.conf</code>).
</p>
<div class="mw-heading mw-heading3"><h3 id="systemd_service_configuration">systemd service configuration</h3></div>
<p>To start the OpenVPN server automatically at system boot, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>openvpn-server@<i>configuration</i>.service</code> on the applicable machine. For a client, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>openvpn-client@<i>configuration</i>.service</code> instead. (Leave <code>.conf</code> out of the <code><i>configuration</i></code> string.)
</p>
<p>For example, if the client configuration file is <code>/etc/openvpn/client/<i>client</i>.conf</code>, the service name is <code>openvpn-client@<i>client</i>.service</code>. Or, if the server configuration file is <code>/etc/openvpn/server/<i>server</i>.conf</code>, the service name is <code>openvpn-server@<i>server</i>.service</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> If <code>openvpn-client@<i>configuration</i>.service</code> units take a long time to start, it might be the network manager is not triggering the <code>network-online.target</code> systemd target at the right moment. For example, when using <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a>, check that <code>systemd-networkd-wait-online.service</code> is properly configured.</div>
<div class="mw-heading mw-heading3"><h3 id="Letting_NetworkManager_start_a_connection">Letting NetworkManager start a connection</h3></div>
<p>One might not always need to run a VPN tunnel and/or only want to establish it for a specific NetworkManager connection. This can be done by adding a script to <code>/etc/NetworkManager/dispatcher.d/</code>. In the following example "Provider" is the name of the NetworkManager connection:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/NetworkManager/dispatcher.d/10-openvpn</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
case "$2" in
  up)
    if [ "$CONNECTION_ID" = "Provider" ]; then
      systemctl start openvpn-client@<i>&lt;configuration&gt;</i>
    fi
  ;;
  down)
    systemctl stop openvpn-client@<i>&lt;configuration&gt;</i>
  ;;
esac</pre>
<p>See <a href="../en/NetworkManager.html#Network_services_with_NetworkManager_dispatcher" title="NetworkManager">NetworkManager#Network services with NetworkManager dispatcher</a> for more details.
</p>
<div class="mw-heading mw-heading3"><h3 id="NetworkManager-native_VPN_configuration">NetworkManager-native VPN configuration</h3></div>
<p><a href="../en/NetworkManager.html" title="NetworkManager">NetworkManager</a> supports OpenVPN management using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager-openvpn">networkmanager-openvpn</a></span>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> 
<ul>
<li>NetworkManager only support <i>mobile</i> configuration files (usually ending in <i>.ovpn</i>), i.e with inline certificate and only one file (Linux configurations usually come with a userpass file and a detached certificate).</li>
<li>No error messages are produced for unsupported options, open the <a href="../en/Systemd/Journal.html#Filtering_output" title="Systemd/Journal">journal</a> for <i>networkmanager</i> to see the used options.</li>
</ul>
</div>
<div class="mw-heading mw-heading4"><h4 id="GUI_configuration">GUI configuration</h4></div>
<p>In your desktop environment <a href="../en/NetworkManager.html#Front-ends" title="NetworkManager">network settings</a> (or <code>nm-connection-editor</code>). Click the plus sign to add a new connection and choose OpenVPN and manually enter the settings. You also can optionally import <a href="#The_client_configuration_profile">#The client configuration profile</a> by selecting <i>Import a saved VPN configuration...</i> and selecting the appropriate file.
</p>
<div class="mw-heading mw-heading4"><h4 id="CLI_configuration">CLI configuration</h4></div>
<p>For importing a configuration:
</p>
<pre>$ nmcli connection import type openvpn file <i>file</i>.ovpn
</pre>
<p>To do a manual configuration:
</p>
<pre>$ nmcli connection add type vpn vpn-type openvpn ...
</pre>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 5 nm-settings-nmcli"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nm-settings-nmcli.5#vpn_setting">nm-settings-nmcli(5) § vpn setting</a></span> for the detailed options.
</p>
<p>If you want to setup login and password, check that there is no <code>auth-user-pass</code> line in the openvpn file or remove it. Then after the import:
</p>
<pre>$ nmcli connection modify <i>name</i> \
   +vpn.data "connection-type=password-tls, username=<i>USERNAME</i>" \
   vpn.user-name <i>USERNAME</i> \
   +vpn.secrets "password=<i>PASS</i>"
</pre>
<p>You will then be able to connect without re-entering the password with:
</p>
<p>$ nmcli connection up <i>name</i>
</p>
<div class="mw-heading mw-heading4"><h4 id="Sync_state_with_connection">Sync state with connection</h4></div>
<p>NetworkManager supports syncing the VPN state with a <a href="../en/Network_configuration.html#Check_the_connection" title="Network configuration">interface connection state</a>, i.e start the VPN together with the connection and bringing it down when the connection goes down.
</p>
<p>To achieve this, open <code>nm-connection-editor</code> and select a network connection (not the VPN), then head to the <i>General</i> section, tick <i>Automatically connect to VPN</i> and select the appropriate configuration in the dropdown menu.
</p>
<div class="mw-heading mw-heading4"><h4 id="Automatically_connect_to_VPN_via_CLI">Automatically connect to VPN via CLI</h4></div>
<p>First, list your connections as follows: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">nmcli connection</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME     UUID                                  TYPE      DEVICE
zrh-003  d46e4a92-778e-4792-b085-e1f638ecb8e3  vpn       enp1s0
enp1s0   1715b889-3c47-3e21-a86f-94ce207297a9  ethernet  enp1s0
tun0     7405f329-255d-4b50-b98d-c2e865a443a4  tun       tun0
</pre>
<p>Copy the UUID of the VPN Connection you want to connect automatically to (here, d46e4a92-778e-4792-b085-e1f638ecb8e3), then edit the primary connection (here the Ethernet one) to make it use the VPN: 
</p>
<pre>$ nmcli c edit enp1s0
nmcli&gt; set connection.secondaries d46e4a92-778e-4792-b085-e1f638ecb8e3
nmcli&gt; save persistent
Connection 'enp1s0' (1715b889-3c47-3e21-a86f-94ce207297a9) successfully updated.
</pre>
<p>Afterwards, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>NetworkManager.service</code>
</p>
<div class="mw-heading mw-heading4"><h4 id="Troubleshooting">Troubleshooting</h4></div>
<div class="mw-heading mw-heading5"><h5 id="No_certificate_password">No certificate password</h5></div>
<p>If you get:
</p>
<pre>Warning: password for 'vpn.secrets.password' not given in 'passwd-file' and nmcli cannot ask without '--ask' option.
Error: Connection activation failed: No valid secrets
</pre>
<p>Even with
</p>
<pre>[vpn]
cert-pass-flags=0
</pre>
<p>You can add:
</p>
<pre>[vpn-secrets]
cert-pass=<i>anything_you_want</i>
</pre>
<div class="mw-heading mw-heading2"><h2 id="Routing_client_traffic_through_the_server">Routing client traffic through the server</h2></div>
<p>Without further configuration only traffic directly to and from the OpenVPN server's IP passes through the VPN. To have other traffic, like web traffic pass through the VPN, correspondent routes must be added.  Either add routes in the client's configuration or configure the server to push these routes to the client.
</p>
<p>To redirect traffic to and from a subnet of the server, add <code>push "route &lt;address pool&gt; &lt;subnet&gt;"</code> right before the <code>remote &lt;address&gt; &lt;port&gt; udp/tcp</code>, like:
</p>
<pre>route 192.168.1.0 255.255.255.0
</pre>
<p>To redirect all traffic including Internet traffic to the server, add the following in the client's configuration:
</p>
<pre>redirect-gateway def1 bypass-dhcp ipv6
</pre>
<p>If running an IPv4-only server, drop the <code>ipv6</code> option. If running IPv6-only, use <code>redirect-gateway ipv6 !ipv4</code>.
</p>
<p>To make the server push routes, <a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">append</a> <code>push "redirect-gateway def1 bypass-dhcp ipv6"</code> to the configuration file (i.e. <code>/etc/openvpn/server/server.conf</code>) <a rel="nofollow" class="external autonumber" href="https://openvpn.net/index.php/open-source/documentation/howto.html#redirect">[4]</a> of the server. Note this is not a requirement and may even give performance issue:
</p>
<pre>push "redirect-gateway def1 bypass-dhcp ipv6"
</pre>
<p>If running an IPv4-only server, drop the <code>ipv6</code> option. If running IPv6-only, use <code>push "redirect-gateway ipv6 !ipv4"</code>
</p>
<p>Use the <code>push "route &lt;address pool&gt; &lt;subnet&gt;"</code> option to allow clients reaching other subnets/devices behind the server:
</p>
<pre>push "route 192.168.1.0 255.255.255.0"
push "route 192.168.2.0 255.255.255.0"
</pre>
<p>Optionally, push local <a href="../en/Domain_name_resolution.html" class="mw-redirect" title="DNS">DNS</a> settings to clients (e.g. the DNS-server of the router and domain prefix <i>.internal</i>):
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> One may need to use a simple <a href="../en/Domain_name_resolution.html" class="mw-redirect" title="DNS">DNS</a> forwarder like <a href="../en/BIND.html" title="BIND">BIND</a> and push the IP address of the OpenVPN server as DNS to clients.</div>
<pre>push "dhcp-option DNS 192.168.1.1"
push "dhcp-option DOMAIN internal"
</pre>
<p>After setting up the configuration file, <a href="../en/Internet_sharing.html#Enable_packet_forwarding" title="Internet sharing">enable packet forwarding</a> on the server. Additionally, the server's <a href="../en/Category:Firewalls.html" class="mw-redirect" title="Firewall">firewall</a> needs to be adjusted to allow VPN traffic, which is described below for both <a href="#ufw">ufw</a> and <a href="#iptables">iptables</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> There are potential pitfalls when routing all traffic through a VPN server. Refer to the <a rel="nofollow" class="external text" href="https://openvpn.net/index.php/open-source/documentation/howto.html#redirect">OpenVPN documentation</a> for more information.</div>
<div class="mw-heading mw-heading3"><h3 id="Firewall_configuration">Firewall configuration</h3></div>
<div class="mw-heading mw-heading4"><h4 id="firewalld">firewalld</h4></div>
<p>If using the default port 1194, enable the <code>openvpn</code> service. Otherwise, create a new service with a different port.
</p>
<pre># firewall-cmd --zone=public --add-service openvpn
</pre>
<p>Now add masquerade to the zone:
</p>
<pre># firewall-cmd --zone=FedoraServer --add-masquerade
</pre>
<p>Make these changes permanent:
</p>
<pre># firewall-cmd --runtime-to-permanent
</pre>
<div class="mw-heading mw-heading4"><h4 id="ufw">ufw</h4></div>
<p>In order to allow <a href="../en/Uncomplicated_Firewall.html" class="mw-redirect" title="Ufw">ufw</a> forwarding (VPN) traffic <a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">append</a> the following to <code>/etc/default/ufw</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/default/ufw</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">DEFAULT_FORWARD_POLICY="ACCEPT"</pre>
<p>Change <code>/etc/ufw/before.rules</code>, and <a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">append</a> the following code after the header and before the "*filter" line:
</p>
<ul>
<li>Change the IP/subnet mask to match the <code>server</code> set in the OpenVPN server configuration.</li>
<li>Change the <a href="../en/Network_configuration.html#Check_the_connection" title="Network configuration">network interface</a> to the connection used by OpenVPN server.</li>
</ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ufw/before.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># NAT (Network Address Translation) table rules
*nat
:POSTROUTING ACCEPT [0:0]

# Allow traffic from clients to the interface
-A POSTROUTING -s 10.8.0.0/24 -o <i>interface</i> -j MASQUERADE

# Optionally duplicate this line for each subnet if your setup requires it
-A POSTROUTING -s 10.8.1.0/24 -o <i>interface</i> -j MASQUERADE

# do not delete the "COMMIT" line or the NAT table rules above will not be processed
COMMIT

# Don't delete these required lines, otherwise there will be errors
*filter</pre>
<p>Make sure to open the chosen OpenVPN port (default 1194/udp):
</p>
<pre># ufw allow 1194/udp
</pre>
<p>To apply the changes. <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Reload">reload</a>/<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> ufw:
</p>
<pre># ufw reload
</pre>
<div class="mw-heading mw-heading4"><h4 id="iptables">iptables</h4></div>
<p>In order to allow VPN traffic through an <a href="../en/Iptables.html" title="Iptables">iptables</a> firewall, first create an iptables rule for NAT forwarding <a rel="nofollow" class="external autonumber" href="https://openvpn.net/index.php/open-source/documentation/howto.html#redirect">[5]</a> on the server. An example (assuming the interface to forward to is named <code>eth0</code>):
</p>
<pre># iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE
</pre>
<p>If running multiple servers on different IP pools, add a corresponding line for each one, for example:
</p>
<pre># iptables -t nat -A POSTROUTING -s 10.8.1.0/24 -o eth0 -j MASQUERADE
</pre>
<p>If the server cannot be pinged through the VPN, one may need to add explicit rules to open up TUN/TAP interfaces to all traffic. If that is the case, do the following <a rel="nofollow" class="external autonumber" href="https://community.openvpn.net/openvpn/wiki/255-qconnection-initiated-with-xxxxq-but-i-cannot-ping-the-server-through-the-vpn">[6]</a>:
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> There are security implications for the following rules if one does not trust all clients which connect to the server. Refer to the <a rel="nofollow" class="external text" href="https://community.openvpn.net/openvpn/wiki/255-qconnection-initiated-with-xxxxq-but-i-cannot-ping-the-server-through-the-vpn">OpenVPN documentation on this topic</a> for more details.</div>
<pre># iptables -A INPUT -i tun+ -j ACCEPT
# iptables -A FORWARD -i tun+ -j ACCEPT
# iptables -A INPUT -i tap+ -j ACCEPT
# iptables -A FORWARD -i tap+ -j ACCEPT
</pre>
<p>Additionally be sure to accept connections from the OpenVPN port (default 1194) and through the physical interface:
</p>
<pre># iptables -A INPUT -i eth0 -m state --state NEW -p udp --dport 1194 -j ACCEPT
# iptables -A FORWARD -i tun+ -o eth0 -m state --state RELATED,ESTABLISHED -j ACCEPT
# iptables -A FORWARD -i eth0 -o tun+ -m state --state RELATED,ESTABLISHED -j ACCEPT
# iptables -A FORWARD -i tap+ -o eth0 -m state --state RELATED,ESTABLISHED -j ACCEPT
# iptables -A FORWARD -i eth0 -o tap+ -m state --state RELATED,ESTABLISHED -j ACCEPT
</pre>
<p>When satisfied, make the changes permanent as shown in <a href="../en/Iptables.html#Configuration_and_usage" title="Iptables">iptables#Configuration and usage</a>.
</p>
<p>Those with multiple <code>tun</code> or <code>tap</code> interfaces, or more than one VPN configuration can "pin" the name of the interface by specifying it in the OpenVPN configuration file, e.g. <code>tun22</code> instead of <code>tun</code>. This is advantageous if different firewall rules for different interfaces or OpenVPN configurations are wanted.
</p>
<div class="mw-heading mw-heading3"><h3 id="Prevent_leaks_if_VPN_goes_down">Prevent leaks if VPN goes down</h3></div>
<p>This prevents all traffic through the default interface (enp3s0 for example) and only allows traffic through tun0.
If the OpenVPN connection drops, the system will lose its internet access thereby preventing connections through the default network interface.
</p>
<p>One may want to set up a script to restart OpenVPN if it goes down.
</p>
<div class="mw-heading mw-heading4"><h4 id="ufw_2">ufw</h4></div>
<pre> # Default policies
 ufw default deny incoming
 ufw default deny outgoing
 
 # Openvpn interface (adjust interface accordingly to your configuration)
 ufw allow in on tun0
 ufw allow out on tun0
 
 # Local Network (adjust ip accordingly to your configuration)
 ufw allow in on enp3s0 from 192.168.1.0/24
 ufw allow out on enp3s0 to 192.168.1.0/24
 
 # Openvpn (adjust port accordingly to your configuration)
 ufw allow in on enp3s0 from any port 1194
 ufw allow out on enp3s0 to any port 1194
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> DNS <b>will not</b> work <b>unless</b> running a dedicated DNS server like <a href="../en/BIND.html" title="BIND">BIND</a>.
<p>Alternatively, one can allow DNS leaks. <b>Be sure to trust your DNS server!</b>
</p>
<pre> # DNS
 ufw allow in from any to any port 53
 ufw allow out from any to any port 53
</pre>
</div>
<div class="mw-heading mw-heading4"><h4 id="vpnfailsafe">vpnfailsafe</h4></div>
<p>Alternatively, the <a rel="nofollow" class="external text" href="https://github.com/wknapik/vpnfailsafe">vpnfailsafe</a> (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/vpnfailsafe-git/">vpnfailsafe-git</a></span><sup><small>AUR</small></sup>) script can be used by the client to prevent DNS leaks and ensure that all traffic to the internet goes over the VPN. If the VPN tunnel goes down, internet access will be cut off, except for connections to the VPN server(s). The script contains the functionality of <a href="#The_update-resolv-conf_custom_script">update-resolv-conf</a>, so the two do not need to be combined.
</p>
<div class="mw-heading mw-heading3"><h3 id="dhcpcd">dhcpcd</h3></div>
<p><code>redirect-gateway</code> adds special routes to the system routing table. If running <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhcpcd">dhcpcd</a></span> and the local DHCP configuration changes, perhaps because the Wi-Fi access point has changed, then <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhcpcd">dhcpcd</a></span> will delete all of these special routes. The easiest way to restore them is to prompt <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openvpn">openvpn</a></span> to reconnect, using <code>/etc/dhcpcd.exit-hook</code>:
</p>
<pre># Prompt openvpn to reconnect when the network reconnects.
if $if_configured &amp;&amp; $if_up &amp;&amp; [ "$reason" != ROUTERADVERT ]; then
    state="$(systemctl show -P ActiveState openvpn-client@config)"
    if [ "$state" == 'active' ]; then
        pid="$(systemctl show -P MainPID openvpn-client@config)"
        kill -USR1 "$pid"
    fi
fi
</pre>
<p>Replace <code>@config</code> with the name of your client config.
</p>
<div class="mw-heading mw-heading2"><h2 id="Layer-3_IPv4_routing">Layer-3 IPv4 routing</h2></div>
<p>This section describes how to connect client/server LANs to each other using Layer-3 IPv4 routing.
</p>
<div class="mw-heading mw-heading3"><h3 id="Prerequisites_for_routing_a_LAN">Prerequisites for routing a LAN</h3></div>
<p>For a host to be able to forward IPv4 packets between the LAN and VPN, it must be able to forward the packets between its NIC and its tun/tap device. See <a href="../en/Internet_sharing.html#Enable_packet_forwarding" title="Internet sharing">Internet sharing#Enable packet forwarding</a> for configuration details.
</p>
<div class="mw-heading mw-heading4"><h4 id="Routing_tables">Routing tables</h4></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Investigate if a routing protocol like RIP, QUAGGA, BIRD, etc can be used (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:OpenVPN.html">Talk:OpenVPN</a>)</div>
</div>
<p>By default, all IP packets on a LAN addressed to a different subnet get sent to the default gateway.  If the LAN/VPN gateway is also the default gateway, there is no problem and the packets get properly forwarded. If not, the gateway has no way of knowing where to send the packets.  There are a couple of solutions to this problem.
</p>
<ul>
<li>Add a static route to the default gateway routing the VPN subnet to the LAN/VPN gateway's IP address.</li>
<li>Add a static route on each host on the LAN that needs to send IP packets back to the VPN.</li>
<li>Use <a href="../en/Iptables.html" title="Iptables">iptables</a>' NAT feature on the LAN/VPN gateway to masquerade the incoming VPN IP packets.</li>
</ul>
<div class="mw-heading mw-heading3"><h3 id="Connect_the_server_LAN_to_a_client">Connect the server LAN to a client</h3></div>
<p>The server is on a LAN using the 10.66.0.0/24 subnet.  To inform the client about the available subnet, add a push directive to the server configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/server/server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">push "route 10.66.0.0 255.255.255.0"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> To route more LANs from the server to the client, add more push directives to the server configuration file, but keep in mind that the server side LANs will need to know how to route to the client.</div>
<div class="mw-heading mw-heading3"><h3 id="Connect_the_client_LAN_to_a_server">Connect the client LAN to a server</h3></div>
<p>Prerequisites:
</p>
<ul>
<li>Any subnets used on the client side, must be unique and not in use on the server or by any other client. In this example we will use 192.168.4.0/24 for the clients LAN.</li>
<li>Each client's certificate has a unique Common Name, in this case bugs.</li>
<li>The server may not use the duplicate-cn directive in its configuration file.</li>
<li>The CCD folder must be accessible via user and group defined in the server configuration file (typically nobody:nobody)</li>
</ul>
<p>Create a client configuration directory on the server.  It will be searched for a file named the same as the client's common name, and the directives will be applied to the client when it connects.
</p>
<pre># mkdir -p /etc/openvpn/ccd
</pre>
<p>Create a file in the client configuration directory called bugs, containing the <code>iroute 192.168.4.0 255.255.255.0</code> directive.  It tells the server what subnet should be routed to the client:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/ccd/bugs</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">iroute 192.168.4.0 255.255.255.0</pre>
<p>Add the client-config-dir and the <code>route 192.168.4.0 255.255.255.0</code> directive to the server configuration file. It tells the server what subnet should be routed from the tun device to the server LAN:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/server/server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">client-config-dir ccd
route 192.168.4.0 255.255.255.0
</pre>
<p>If accessing a machine in the client LAN from a machine in the server LAN, remember that packet forwarding needs to be enabled on the client (<a href="../en/Internet_sharing.html#Enable_packet_forwarding" title="Internet sharing">Internet sharing#Enable packet forwarding</a>).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> 
<ul>
<li>If running openVPN as a daemon with systemd, you may need to specify an absolute path to your <code>ccd</code> directory.</li>
<li>To route more LANs from the client to the server, add more iroute and route directives to the appropriate configuration files, but keep in mind that the client side LANs will need to know how to route to the server.</li>
</ul>
</div>
<div class="mw-heading mw-heading3"><h3 id="Connect_both_the_client_and_server_LANs">Connect both the client and server LANs</h3></div>
<p>Combine the two previous sections:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/server/server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">push "route 10.66.0.0 255.255.255.0"

client-config-dir ccd
route 192.168.4.0 255.255.255.0
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/ccd/bugs</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">iroute 192.168.4.0 255.255.255.0
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Remember to make sure that all the LANs or the needed hosts can route to all the destinations.</div>
<div class="mw-heading mw-heading3"><h3 id="Connect_clients_and_client_LANs">Connect clients and client LANs</h3></div>
<p>By default clients will not see each other. To allow IP packets to flow between clients and/or client LANs, add a client-to-client directive to the server configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/server/server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">client-to-client
</pre>
<p>In order for another client or client LAN to see a specific client LAN, add a push directive for each client subnet to the server configuration file (this will make the server announce the available subnet(s) to other clients):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/server/server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">client-to-client
push "route 192.168.4.0 255.255.255.0"
push "route 192.168.5.0 255.255.255.0"
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> One may need to adjust the <a href="#Firewall_configuration">firewall</a> to allow client traffic passing through the VPN server.</div>
<div class="mw-heading mw-heading2"><h2 id="DNS">DNS</h2></div>
<p>For Linux, the OpenVPN client can receive DNS host information from the server, but the client expects an external command to act on this information. No such commands are configured by default. They must be specified with the <code>up</code> and <code>down</code> options. There are a few alternatives for what scripts to use, but none are officially recognised by OpenVPN, so in order for any of them to work, <code>script-security</code> must be set to 2. The <code>down-root</code> plugin can be used instead of the <code>down</code> option if <a href="#Run_as_unprivileged_user">running as an unprivileged user</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="The_pull-resolv-conf_custom_scripts">The pull-resolv-conf custom scripts</h3></div>
<p>These scripts are <a rel="nofollow" class="external text" href="https://github.com/OpenVPN/openvpn/tree/master/contrib/pull-resolv-conf">maintained by</a><sup>[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2025-11-17—HTTP 404]</sup> OpenVPN. They are <code>client.up</code> and <code>client.down</code>, and they are packaged in <code>/usr/share/openvpn/contrib/pull-resolv-conf/</code>. The following is an excerpt of a resulting client configuration using the scripts in conjunction with the <code>down-root</code> plugin:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/client/<i>clienttunnel</i>.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">user nobody
group nobody
# Optional, choose a suitable path to chroot into
chroot /srv
script-security 2
up /usr/share/openvpn/contrib/pull-resolv-conf/client.up 
plugin /usr/lib/openvpn/plugins/openvpn-plugin-down-root.so "/usr/share/openvpn/contrib/pull-resolv-conf/client.down tun0"
</pre>
<p>These scripts use the <code>resolvconf</code> command if present. <a href="../en/Systemd-resolved.html#Automatically" class="mw-redirect" title="Systemd-resolvconf">systemd-resolvconf</a> and <a href="../en/Openresolv.html" title="Openresolv">Openresolv</a> both implement this command. See their wiki pages for more information on getting a working <i>resolvconf</i> implementation.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> As of October 2019, systemd-resolvconf works as long as the systemd-resolved service is running. Openresolv will not work out of the box because <code>client.up</code> will only create private DNS server entries. These require extra configuration of openresolv to work. See <span class="plainlinks archwiki-template-man" title="$ man 8 resolvconf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/resolvconf.8">resolvconf(8)</a></span> for more details on private DNS servers in openresolv.</div>
<p>If no implementation of <i>resolvconf</i> is present, <code>client.up</code> preserves the existing <code>resolv.conf</code> at <code>/etc/resolv.conf.ovpnsave</code> and writes a new one. This new one will not have any of the original DNS servers.
</p>
<p>When editing these scripts, copy them somewhere else and edit them there, so that the changes do not get overwritten by the next <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openvpn">openvpn</a></span> package upgrade. <code>/etc/openvpn/client/</code> is a pretty good place.
</p>
<pre># cp /usr/share/openvpn/contrib/pull-resolv-conf/* /etc/openvpn/client/
</pre>
<p><a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Textedit">Edit</a> <code>/etc/openvpn/client/client.up</code> and <code>/etc/openvpn/client/client.down</code>.
</p>
<div class="mw-heading mw-heading3"><h3 id="The_update-resolv-conf_custom_script">The update-resolv-conf custom script</h3></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Another script, <a href="#The_update-systemd-resolved_custom_script">update-systemd-resolved</a>, is recommended by the author of update-resolv-conf for systems with systemd.</div>
<p>The <a rel="nofollow" class="external text" href="https://github.com/masterkorp/openvpn-update-resolv-conf">openvpn-update-resolv-conf</a> script is available as an alternative to packaged scripts. It needs to be saved for example at <code>/etc/openvpn/update-resolv-conf</code> and made <a href="../en/Help:Reading.html#Make_executable" class="mw-redirect" title="Executable">executable</a>.
</p>
<p>Users preferring a package may use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/openvpn-update-resolv-conf-git/">openvpn-update-resolv-conf-git</a></span><sup><small>AUR</small></sup> but will still need to do the following:
</p>
<p>Once the script is installed add lines like the following into the OpenVPN client configuration file:
</p>
<pre>script-security 2
up /etc/openvpn/update-resolv-conf
down /etc/openvpn/update-resolv-conf
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> If manually placing the script on the filesystem, be sure to have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openresolv">openresolv</a></span> installed.</div>
<p>Now, when launching the OpenVPN connection, <code>resolv.conf</code> should be updated accordingly, and also should get returned to normal when the connection is closed.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> When using <code>openresolv</code> with the <i>-p</i> or <i>-x</i> options in a script (as both the included <code>client.up</code> and <code>update-resolv-conf</code> scripts currently do), a DNS resolver like <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dnsmasq">dnsmasq</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=unbound">unbound</a></span> is required for <code>openresolv</code> to correctly update <code>/etc/resolv.conf</code>.  In contrast, when using the default DNS resolution from <code>libc</code> the <i>-p</i> and <i>-x</i> options must be removed in order for <code>/etc/resolv.conf</code> to be correctly updated by <code>openresolv</code>.
For example, if the script contains a command like <code>resolvconf -p -a </code> and the default DNS resolver from <code>libc</code> is being used, change the command in the script to be <code>resolvconf -a </code>.</div>
<div class="mw-heading mw-heading3"><h3 id="The_update-systemd-resolved_custom_script">The update-systemd-resolved custom script</h3></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Since <a href="../en/Systemd.html" title="Systemd">systemd</a> 229, <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> has exposed an API through DBus allowing management of DNS configuration on a per-link basis. Tools such as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openresolv">openresolv</a></span> may not work reliably when <code>/etc/resolv.conf</code> is managed by <code>systemd-resolved</code>, and will not work at all if using <code>resolve</code> instead of <code>dns</code> in <code>/etc/nsswitch.conf</code>.</div>
<p>The <a rel="nofollow" class="external text" href="https://github.com/jonathanio/update-systemd-resolved">update-systemd-resolved</a> script links OpenVPN with <code>systemd-resolved</code> via DBus to update the DNS records.
</p>
<p>Copy the script into <code>/etc/openvpn/scripts</code> and mark as <a href="../en/Help:Reading.html#Make_executable" class="mw-redirect" title="Executable">executable</a> (or <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/openvpn-update-systemd-resolved/">openvpn-update-systemd-resolved</a></span><sup><small>AUR</small></sup>) and <a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">append</a> the following lines into the OpenVPN client configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/client/client.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">client
remote example.com 1194 udp

script-security 2
setenv PATH /usr/bin
up /etc/openvpn/scripts/update-systemd-resolved
down /etc/openvpn/scripts/update-systemd-resolved
down-pre
</pre>
<p>In order to send all DNS traffic through the VPN tunnel and prevent DNS leaks, also add the following line (see <a rel="nofollow" class="external autonumber" href="https://github.com/jonathanio/update-systemd-resolved#dns-leakage">[7]</a>):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/client/client.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dhcp-option DOMAIN-ROUTE .
</pre>
<p>Make sure that the <a href="../en/Systemd-resolved.html" title="Systemd-resolved">systemd-resolved</a> service is configured and running. Also, since openvpn 2.5.0-3 scripts are running as openvpn user instead of root. Thus, add a PolicyKit rule to allow OpenVPN systemd units to call DBus with SetLinkDNS:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/polkit-1/rules.d/00-openvpn-resolved.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">polkit.addRule(function(action, subject) {
    if (action.id == 'org.freedesktop.resolve1.set-dns-servers' ||
        action.id == 'org.freedesktop.resolve1.set-domains' ||
        action.id == 'org.freedesktop.resolve1.set-dnssec') {
        if (subject.user == 'openvpn') {
            return polkit.Result.YES;
        }
    }
});
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> When using the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/openvpn-update-systemd-resolved/">openvpn-update-systemd-resolved</a></span><sup><small>AUR</small></sup> package, the path to the <code>update-systemd-resolved</code> script in <code>client.conf</code> should be changed from <code>/etc/openvpn/scripts/</code> to <code>/usr/bin/</code> and polkit rules are already set up.</div>
<div class="mw-heading mw-heading3"><h3 id="Override_DNS_servers_using_NetworkManager">Override DNS servers using NetworkManager</h3></div>
<p>By default <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager-openvpn">networkmanager-openvpn</a></span> plugin appends DNS servers provided by OpenVPN to <code>/etc/resolv.conf</code>.
</p>
<p>To verify that the correct DNS server(s) are configured, see <code>resolvectl status</code> if systemd-resolved is in use, for other resolvers see <a href="../en/Domain_name_resolution.html" title="Domain name resolution">Domain name resolution</a>.
</p>
<div class="mw-heading mw-heading2"><h2 id="Layer-2_Ethernet_bridging">Layer-2 Ethernet bridging</h2></div>
<p>Establishing an Ethernet bridge enables access to other devices within a subnet of the server. For example, accessing other machines in the local network of the OpenVPN server via <a href="../en/Samba.html" title="Samba">Samba</a> would be possible with this approach. Clients would be assigned an IP address as if it were within the same subnet.
</p>
<p>This is generally a two step process: 1) establishing the tap interface and the network bridge on the OpenVPN server to bridge the tap interface and the Ethernet interface, and 2) configuring the OpenVPN server.
</p>
<p>See <a href="../en/OpenVPN/Bridge.html" class="mw-redirect" title="OpenVPN Bridge">OpenVPN Bridge</a>.
</p>
<div class="mw-heading mw-heading2"><h2 id="Configuration_generators">Configuration generators</h2></div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> Users are highly recommended to pass through the manual configuration described above to gain knowledge about options and usage before using any additional automation scripts.</div>
<div class="mw-heading mw-heading3"><h3 id="ovpngen">ovpngen</h3></div>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ovpngen/">ovpngen</a></span><sup><small>AUR</small></sup> package provides a simple shell script that creates OpenVPN compatible tunnel profiles in the unified file format suitable for the OpenVPN Connect app for Android and iOS.
</p>
<p>Simply invoke the script with 5 tokens:
</p>
<ol>
<li>Server Fully Qualified Domain Name of the OpenVPN server (or IP address).</li>
<li>Full path to the CA cert.</li>
<li>Full path to the client cert.</li>
<li>Full path to the client private key.</li>
<li>Full path to the server TLS shared secret key.</li>
<li>Optionally a port number.</li>
<li>Optionally a protocol (udp or tcp).</li>
</ol>
<p>Example:
</p>
<pre># ovpngen example.org /etc/openvpn/server/ca.crt /etc/easy-rsa/pki/signed/client1.crt /etc/easy-rsa/pki/private/client1.key /etc/openvpn/server/ta.key &gt; foo.ovpn
</pre>
<p>If the server is configured to use tls-crypt, as is suggested in <a href="#The_server_configuration_file">#The server configuration file</a>, <a rel="nofollow" class="external text" href="https://github.com/graysky2/ovpngen/issues/4">manually edit</a> the resulting <code>foo.ovpn</code> replacing <code>&lt;tls-auth&gt;</code> and <code>&lt;/tls-auth&gt;</code> with <code>&lt;tls-crypt&gt;</code> and <code>&lt;/tls-crypt&gt;</code>.
</p>
<p>The resulting <code>foo.ovpn</code> can be edited if desired as the script does insert some commented lines. <code>foo.ovpn</code> will not automatically route all traffic through the VPN, so consider following <a href="#Routing_client_traffic_through_the_server">#Routing client traffic through the server</a> to enable redirection.
</p>
<p>The client expects this file to be located in <code>/etc/openvpn/client/foo.conf</code>. Note the change in file extension from 'ovpn' to 'conf' in this case.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> If the server.conf contains a specified cipher and/or auth line, it is highly recommended that users manually edit the generated .ovpn file adding matching lines for cipher and auth.  Failure to do so may results in connection errors!</div>
<div class="mw-heading mw-heading3"><h3 id="openvpn-unroot">openvpn-unroot</h3></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> If using a custom script, perhaps for configuring <a href="#DNS">#DNS</a>, add these scripts to the configuration before calling openvpn-unroot on it. Failing to do so will cause problems if the scripts require root permissions.</div>
<p>The steps necessary for OpenVPN to <a href="#Run_as_unprivileged_user">#Run as unprivileged user</a>, can be performed automatically using <a rel="nofollow" class="external text" href="https://github.com/wknapik/openvpn-unroot">openvpn-unroot</a> (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/openvpn-unroot-git/">openvpn-unroot-git</a></span><sup><small>AUR</small></sup>).
</p>
<p>It automates the actions required for the <a rel="nofollow" class="external text" href="https://community.openvpn.net/openvpn/wiki/UnprivilegedUser">OpenVPN howto</a> by adapting it to systemd, and also working around the bug for persistent tun devices mentioned in the note.
</p>
<div class="mw-heading mw-heading2"><h2 id="Troubleshooting_2">Troubleshooting</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Client_daemon_not_reconnecting_after_suspend">Client daemon not reconnecting after suspend</h3></div>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/openvpn-reconnect/">openvpn-reconnect</a></span><sup><small>AUR</small></sup>, available on the AUR, solves this problem by sending a SIGHUP to openvpn after waking up from suspend.
</p>
<p>Alternatively, restart OpenVPN after suspend by creating the following systemd service:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/openvpn-reconnect.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Restart OpenVPN after suspend

[Service]
ExecStart=/usr/bin/pkill --signal SIGHUP --exact openvpn

[Install]
WantedBy=sleep.target</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">Enable</a> this service for it to take effect.
</p>
<div class="mw-heading mw-heading3"><h3 id="Connection_drops_out_after_some_time_of_inactivity">Connection drops out after some time of inactivity</h3></div>
<p>If the VPN-Connection drops some seconds after it stopped transmitting data and, even though it states it is connected, no data can be transmitted through the tunnel, try adding a <code>keepalive</code>directive to the server's configuration:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/openvpn/server/server.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">keepalive 10 120
</pre>
<p>In this case the server will send ping-like messages to all of its clients every 10 seconds, thus keeping the tunnel up.
If the server does not receive a response within 120 seconds from a specific client, it will assume this client is down.
</p>
<p>A small ping-interval can increase the stability of the tunnel, but will also cause slightly higher traffic. Depending on the connection, also try lower intervals than 10 seconds.
</p>
<div class="mw-heading mw-heading3"><h3 id="PID_files_not_present">PID files not present</h3></div>
<p>The default systemd service file for openvpn-client does not have the --writepid flag enabled, despite creating /run/openvpn-client. If this breaks a configuration (such as an i3bar VPN indicator), simply change <code>openvpn-client@.service</code> using a <a href="../en/Systemd.html#Drop-in_files" class="mw-redirect" title="Drop-in snippet">drop-in snippet</a>:
</p>
<pre>[Service]
ExecStart=
ExecStart=/usr/sbin/openvpn --suppress-timestamps --nobind --config %i.conf --writepid /run/openvpn-client/%i.pid
</pre>
<div class="mw-heading mw-heading3"><h3 id="Route_configuration_fails_with_systemd-networkd">Route configuration fails with systemd-networkd</h3></div>
<p>When using <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> to manage network connections and attempting to tunnel all outgoing traffic through the VPN, OpenVPN may fail to add routes. This is a result of systemd-networkd attempting to manage the tun interface before OpenVPN finishes configuring the routes. When this happens, the following message will appear in the OpenVPN log.
</p>
<pre>openvpn[458]: RTNETLINK answers: Network is unreachable
openvpn[458]: ERROR: Linux route add command failed: external program exited with error status: 2
</pre>
<p>From systemd-233, systemd-networkd can be configured to ignore the tun connections and allow OpenVPN to manage them. To do this, create the following file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/90-tun-ignore.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=tun*

[Link]
Unmanaged=true</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Restart</a> <code>systemd-networkd.service</code> to apply the changes. To verify that the changes took effect, start the previously problematic OpenVPN connection and run <code>networkctl</code>. The output should have a line similar to the following:
</p>
<pre>7 tun0             none               routable    unmanaged
</pre>
<div class="mw-heading mw-heading3"><h3 id="tls-crypt_unwrap_error:_packet_too_short">tls-crypt unwrap error: packet too short</h3></div>
<p>This error shows up in the server log when a client that does not support tls-crypt, or a client that is misconfigured to use tls-auth while the server is configured to use tls-crypt, attempts to connect.
</p>
<p>To support clients that do not support tls-crypt, replace <code>tls-crypt ta.key</code> with <code>tls-auth ta.key 0</code> (the default) in <code>server.conf</code>. Also replace <code>tls-crypt ta.key</code> with <code>tls-auth ta.key 1</code> (the default) in <code>client.conf</code>.
</p>
<div class="mw-heading mw-heading3"><h3 id="NetworkManager_fails_to_connect_using_imported_configuration">NetworkManager fails to connect using imported configuration</h3></div>
<p>There is a known upstream bug <a rel="nofollow" class="external autonumber" href="https://bugs.kde.org/show_bug.cgi?id=396530">[8]</a><a rel="nofollow" class="external autonumber" href="https://bugs.launchpad.net/ubuntu/+source/network-manager-openvpn/+bug/1847144">[9]</a><a rel="nofollow" class="external autonumber" href="https://gitlab.gnome.org/GNOME/NetworkManager-openvpn/-/issues/54">[10]</a> in conjunction with importing existing OpenVPN configurations (<i>.ovpn</i> files) under KDE via the GUI (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=plasma-nm">plasma-nm</a></span> <i>not</i> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nm-connection-editor">nm-connection-editor</a></span>) that causes certain advanced options such as <code>tls-crypt</code> to be silently ignored. The created NetworkManager connection profile will therefore be incomplete and the connection ultimately fails.
</p>
<p>Logs might reveal errors such as the following:
</p>
<pre>TLS Error: TLS handshake failed
TLS Error: TLS key negotiation failed to occur within 60 seconds (check your network connectivity)
</pre>
<p>A workaround is to resort to NetworkManager's command-line utility <i>nmcli</i> to import the connection profile as is shown in <a href="#CLI_configuration">#CLI configuration</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="OpenVPN_connection_fails_after_update_to_OpenSSL3">OpenVPN connection fails after update to OpenSSL3</h3></div>
<p>There exists an issue with PKCS#12 encoded user certificates/private key files (usually denoted by a <i>.pfx</i> or <i>.p12</i> file ending) with OpenSSL3, c.f. also <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?pid=2067602">[11]</a>. This leads to connections which worked perfectly before updating to OpenSSL3 not being able to connect with the following log messages produced (in this case via NetworkManager):
</p>
<pre>nm-openvpn[14025]: WARNING: No server certificate verification method has been enabled.  See <a rel="nofollow" class="external free" href="https://openvpn.net/howto.html#mitm">https://openvpn.net/howto.html#mitm</a> for more info.
nm-openvpn[14025]: NOTE: the current --script-security setting may allow this configuration to call user-defined scripts
nm-openvpn[14025]: OpenSSL: error:0308010C:digital envelope routines::unsupported
nm-openvpn[14025]: OpenSSL: error:11800071:PKCS12 routines::mac verify failure
nm-openvpn[14025]: Decoding PKCS12 failed. Probably wrong password or unsupported/legacy encryption
nm-openvpn[14025]: SIGUSR1[soft,private-key-password-failure] received, process restarting
</pre>
<p>The reason is that older versions of OpenSSL used algorithms, which are now deprecated, to encrypt the PKCS#12 files.
</p>
<p>To solve this issue the PKCS#12 file must be re-encrypted with a non-legacy algorithm.
</p>
<pre>$ cd path/to/the/pfx-file
$ mv mykeys.pfx mykeys.pfx.bak
$ openssl pkcs12 -in mykeys.pfx.bak -out mykeys.pfx -aes256 -legacy
</pre>
<div class="mw-heading mw-heading2"><h2 id="See_also">See also</h2></div>
<ul><li><a href="https://en.wikipedia.org/wiki/OpenVPN" class="extiw" title="wikipedia:OpenVPN">Wikipedia:OpenVPN</a></li></ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Virtual_Private_Network.html" title="Category:Virtual Private Network">Virtual Private Network</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=OpenVPN&amp;oldid=853256">https://wiki.archlinux.org/index.php?title=OpenVPN&amp;oldid=853256</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 17 November 2025, at 16:05.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true"><span class="mw-page-title-main">OpenVPN</span></div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
