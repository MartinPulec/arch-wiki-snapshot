<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Package Proxy Cache - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.43.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Package_Proxy_Cache rootpage-Package_Proxy_Cache skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Package_cache_sharing" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Package_cache_sharing">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Package cache sharing</span>
			</div>
		</a>
		
			<button aria-controls="toc-Package_cache_sharing-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Package cache sharing subsection</span>
			</button>
		
		<ul id="toc-Package_cache_sharing-sublist" class="vector-toc-list">
			<li id="toc-Read-only_cache" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Read-only_cache">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.1</span>
					<span>Read-only cache</span>
				</div>
			</a>
			
			<ul id="toc-Read-only_cache-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Overlay_mount_of_read-only_cache" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Overlay_mount_of_read-only_cache">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.2</span>
					<span>Overlay mount of read-only cache</span>
				</div>
			</a>
			
			<ul id="toc-Overlay_mount_of_read-only_cache-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Distributed_read-only_cache" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Distributed_read-only_cache">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.3</span>
					<span>Distributed read-only cache</span>
				</div>
			</a>
			
			<ul id="toc-Distributed_read-only_cache-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Read-write_cache" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Read-write_cache">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.4</span>
					<span>Read-write cache</span>
				</div>
			</a>
			
			<ul id="toc-Read-write_cache-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Two-way_with_rsync_or_FTP" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Two-way_with_rsync_or_FTP">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.5</span>
					<span>Two-way with rsync or FTP</span>
				</div>
			</a>
			
			<ul id="toc-Two-way_with_rsync_or_FTP-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Synchronize_pacman_package_cache_using_synchronization_programs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Synchronize_pacman_package_cache_using_synchronization_programs">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.6</span>
					<span>Synchronize pacman package cache using synchronization programs</span>
				</div>
			</a>
			
			<ul id="toc-Synchronize_pacman_package_cache_using_synchronization_programs-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Proxy_server" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Proxy_server">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Proxy server</span>
			</div>
		</a>
		
			<button aria-controls="toc-Proxy_server-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Proxy server subsection</span>
			</button>
		
		<ul id="toc-Proxy_server-sublist" class="vector-toc-list">
			<li id="toc-Dynamic_reverse_proxy_cache_using_nginx" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Dynamic_reverse_proxy_cache_using_nginx">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>Dynamic reverse proxy cache using nginx</span>
				</div>
			</a>
			
			<ul id="toc-Dynamic_reverse_proxy_cache_using_nginx-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Squid" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Squid">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>Squid</span>
				</div>
			</a>
			
			<ul id="toc-Squid-sublist" class="vector-toc-list">
				<li id="toc-Install_Squid" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Install_Squid">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2.1</span>
					<span>Install Squid</span>
				</div>
			</a>
			
			<ul id="toc-Install_Squid-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Configure_Squid" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Configure_Squid">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2.2</span>
					<span>Configure Squid</span>
				</div>
			</a>
			
			<ul id="toc-Configure_Squid-sublist" class="vector-toc-list">
				<li id="toc-Cache_Rules" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Cache_Rules">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2.2.1</span>
					<span>Cache Rules</span>
				</div>
			</a>
			
			<ul id="toc-Cache_Rules-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Maximum_Filesize" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Maximum_Filesize">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2.2.2</span>
					<span>Maximum Filesize</span>
				</div>
			</a>
			
			<ul id="toc-Maximum_Filesize-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Cache_Directory" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Cache_Directory">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2.2.3</span>
					<span>Cache Directory</span>
				</div>
			</a>
			
			<ul id="toc-Cache_Directory-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Shutdown_Lifetime" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Shutdown_Lifetime">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2.2.4</span>
					<span>Shutdown Lifetime</span>
				</div>
			</a>
			
			<ul id="toc-Shutdown_Lifetime-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Start_Squid" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Start_Squid">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2.3</span>
					<span>Start Squid</span>
				</div>
			</a>
			
			<ul id="toc-Start_Squid-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Follow_Squid_access_log" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Follow_Squid_access_log">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2.4</span>
					<span>Follow Squid access log</span>
				</div>
			</a>
			
			<ul id="toc-Follow_Squid_access_log-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Manual_Arch_Install" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Manual_Arch_Install">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2.5</span>
					<span>Manual Arch Install</span>
				</div>
			</a>
			
			<ul id="toc-Manual_Arch_Install-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Intercepting_local_requests" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Intercepting_local_requests">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2.6</span>
					<span>Intercepting local requests</span>
				</div>
			</a>
			
			<ul id="toc-Intercepting_local_requests-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Pacoloco_proxy_cache_server" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Pacoloco_proxy_cache_server">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3</span>
					<span>Pacoloco proxy cache server</span>
				</div>
			</a>
			
			<ul id="toc-Pacoloco_proxy_cache_server-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Flexo_proxy_cache_server" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Flexo_proxy_cache_server">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4</span>
					<span>Flexo proxy cache server</span>
				</div>
			</a>
			
			<ul id="toc-Flexo_proxy_cache_server-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Package Proxy Cache</span></h1>
				</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><br>
If you want to install the same Arch packages over and over —e.g. for testing purposes— it could help if you would not have to get the packages every time from the internet. This article shows you how to share packages so that you can greatly decrease your download times.
</p>
<p>Which solution is best depends on your individual use-case. The methods can be grouped into <a href="#Package_cache_sharing">#Package cache sharing</a> of the machines, or deploying a <a href="#Proxy_server">#Proxy server</a> for extra caching on one machine and configuring the machines to use it accordingly.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Package_cache_sharing">Package cache sharing</span></h2>
<p>For all solutions to share the package cache, keep in mind that, by default, <code>pacman -Sc</code> removes package tarballs from the cache that correspond to packages that are not installed on the machine the command was issued on. Because <i>pacman</i> cannot predict what packages are installed on all machines that share the cache, it will end up deleting files that should not be.
</p>
<p>To clean up the cache so that only <i>outdated</i> tarballs are deleted:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[options]
CleanMethod = KeepCurrent</pre>
<h3><span class="mw-headline" id="Read-only_cache">Read-only cache</span></h3>
<p>Pacman 6.1.0 supports cache servers directly. Cache servers will be tried before any non-cache servers, will not be removed from the server pool because of HTTP 404 download errors, and will not be used for database files.
</p>
<p>If you are looking for a quick solution, you can simply run a <a rel="nofollow" class="external text" href="https://gist.github.com/willurd/5720255">basic temporary webserver</a> which other computers can use as their cache server.
</p>
<p>Start serving this directory. For example, with <a href="../en/Python.html" title="Python">Python</a> <a rel="nofollow" class="external text" href="https://docs.python.org/3/library/http.server.html#http-server-cli">http.server</a> module:
</p>
<pre>$ python -m http.server -d /var/cache/pacman/pkg/
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> By default, Python <code>http.server</code> listens on port <code>8000</code> of any interface. To use another port, or bind only to specific address, simply add a parameter and an argument:
<pre>$ python -m http.server -d /var/cache/pacman/pkg/ --bind 127.0.0.1 8080
</pre>
</div>
<p>Then <a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Textedit">edit</a> <code>/etc/pacman.d/mirrorlist</code> on each client machine to add this server:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/mirrorlist</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CacheServer = http://<i>server-ip</i>:<i>port</i></pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Do <b>not</b> append <code>/repos/$repo/os/$arch</code> to this custom server like for other entries, as this hierarchy does not exist and therefore queries will fail.</div>
<p>If looking for a more standalone solution, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=darkhttpd">darkhttpd</a></span> offers a very minimal webserver. Replace the previous <code>python</code> command with e.g.:
</p>
<pre>[http]$ darkhttpd /var/cache/pacman/pkg --no-server-id
</pre>
<p>You could also run darkhttpd as a <i>systemd</i> service for convenience: see <a href="../en/Systemd.html#Writing_unit_files" title="Systemd">Systemd#Writing unit files</a>.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=miniserve">miniserve</a></span>, a small web server written in Rust, can also be used:
</p>
<pre>$ miniserve /var/cache/pacman/pkg
</pre>
<p>Then edit <code>/etc/pacman.d/mirrorlist</code> as above with the first url miniserve is available at.
</p>
<p>If you are already running a web server for some other purpose, you might wish to reuse that as your local repository server instead. For example, if you already serve a site with <a href="../en/Nginx.html" title="Nginx">nginx</a>, you can add an <i>nginx</i> server block listening on port 8080:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nginx/nginx.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server {
    listen 8080;
    root /var/cache/pacman/pkg;
    server_name myarchrepo.localdomain;
    try_files $uri $uri/;
}
</pre>
<p>Remember to <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>nginx.service</code> after making this change.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Whichever web server you use, make sure the firewall configuration (if any) allows the configured port to be reached by the desired traffic, and disallows any undesired traffic. See <a href="../en/Security.html#Network_and_firewalls" title="Security">Security#Network and firewalls</a>.</div>
<h3><span class="mw-headline" id="Overlay_mount_of_read-only_cache">Overlay mount of read-only cache</span></h3>
<p>It is possible to use one machine on a local network as a read-only package cache by <a href="../en/Overlay_filesystem.html" title="Overlay filesystem">overlay mounting</a> its <code>/var/cache/pacman/pkg</code> directory. Such a configuration is advantageous if this server has installed on it a reasonably comprehensive selection of up-to-date packages which are also used by other boxes. This is useful for maintaining a number of machines at the end of a low bandwidth upstream connection.
</p>
<p>As an example, to use this method:
</p>
<pre># mkdir /tmp/remote_pkg /mnt/workdir_pkg /tmp/pacman_pkg
# sshfs <i>remote_username</i>@<i>remote_pkgcache_addr</i>:/var/cache/pacman/pkg /tmp/remote_pkg -C
# mount -t overlay overlay -o lowerdir=/tmp/remote_pkg,upperdir=/var/cache/pacman/pkg,workdir=/mnt/workdir_pkg /tmp/pacman_pkg
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The working directory must be an empty directory on the same mounted device as the upper directory. See <a href="../en/Overlay_filesystem.html#Usage" title="Overlay filesystem">Overlay filesystem#Usage</a>.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If listing the <code>/tmp/pacman_pkg</code> overlay directory gives errors, e.g., "Stale file handle", try overlay mounting with options <code>-o redirect_dir=off -o index=off</code>.</div>
<p>After this, run <i>pacman</i> using the option <code>--cachedir /tmp/pacman_pkg</code>, e.g.:
</p>
<pre># pacman -Syu --cachedir /tmp/pacman_pkg
</pre>
<h3><span class="mw-headline" id="Distributed_read-only_cache">Distributed read-only cache</span></h3>
<p>There are Arch-specific tools for automatically discovering other computers on your network offering a package cache. Try <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacredir">pacredir</a></span>, <a href="../en/Pacserve.html" title="Pacserve">pacserve</a>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/pkgdistcache/">pkgdistcache</a></span><sup><small>AUR</small></sup>, or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/paclan/">paclan</a></span><sup><small>AUR</small></sup>. pkgdistcache uses Avahi instead of plain UDP which may work better in certain home networks that route instead of bridge between Wi-Fi and Ethernet.
</p>
<p>Historically, there was <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=64391">PkgD</a> and <a rel="nofollow" class="external text" href="https://github.com/toofishes/multipkg">multipkg</a>, but they are no longer maintained.
</p>
<h3><span class="mw-headline" id="Read-write_cache">Read-write cache</span></h3>
<p>In order to share packages between multiple computers, simply share <code>/var/cache/pacman/</code> using any network-based mount protocol. This section shows how to use <a href="../en/SSHFS.html" title="SSHFS">SSHFS</a> to share a package cache plus the related library-directories between multiple computers on the same local network. Keep in mind that a network shared cache can be slow depending on the file-system choice, among other factors.
</p>
<p>First, install any network-supporting filesystem packages: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sshfs">sshfs</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=curlftpfs">curlftpfs</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=samba">samba</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nfs-utils">nfs-utils</a></span>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>To use <i>sshfs</i>, consider reading <a href="../en/SSH_keys.html" class="mw-redirect" title="Using SSH Keys">Using SSH Keys</a>.</li>
<li>By default, <i>smbfs</i> does not serve filenames that contain colons, which results in the client downloading the offending package afresh. To prevent this, use the <code>mapchars</code> mount option on the client.</li>
</ul>
</div>
<p>Then, to share the actual packages, mount <code>/var/cache/pacman/pkg</code> from the server to <code>/var/cache/pacman/pkg</code> on every client machine.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Do not make <code>/var/cache/pacman/pkg</code> or any of its ancestors (e.g., <code>/var</code>) a symlink. Pacman expects these to be directories. When <i>pacman</i> re-installs or upgrades itself, it will remove the symlinks and create empty directories instead. However during the transaction <i>pacman</i> relies on some files residing there, hence breaking the update process. Refer to <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/50298">FS#50298</a> for further details.</div>
<h3><span class="mw-headline" id="Two-way_with_rsync_or_FTP">Two-way with rsync or FTP</span></h3>
<p>Another approach in a local environment is <a href="../en/Rsync.html" title="Rsync">rsync</a>. Choose a server for caching and enable the <a href="../en/Rsync.html#As_a_daemon" title="Rsync">rsync daemon</a>. On clients synchronize two-way with this share via the rsync protocol. Filenames that contain colons are no problem for the rsync protocol.
</p>
<p>Draft example for a client, using <code>uname -m</code> within the share name ensures an architecture-dependent sync:
</p>
<pre># rsync ... rsync://server/share_$(uname -m)/ /var/cache/pacman/pkg/ 
# pacman -Syu
# paccache --remove --keep 3
# rsync --delete ... /var/cache/pacman/pkg/ rsync://server/share_$(uname -m)/
</pre>
<p>Instead of relying on unencrypted <a href="../en/Rsync.html#As_a_daemon" title="Rsync">rsync daemon</a> a more secure security option is rsync over ssh, 
<a href="../en/Rsync.html#Automated_backup_with_SSH" title="Rsync">Rsync#Automated backup with SSH</a> gives an overview.
</p>
<p>In case rsync is not available in your local environment, a simple ftp service is suitable for the two-way sync as well. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lftp">lftp</a></span> provides a <code>--mirror</code> and a <code>--delete</code> option to sync a local with a remote storage.
</p>
<h3><span class="mw-headline" id="Synchronize_pacman_package_cache_using_synchronization_programs">Synchronize pacman package cache using synchronization programs</span></h3>
<p>Use <a href="../en/Syncthing.html" title="Syncthing">Syncthing</a> or <a href="../en/Resilio_Sync.html" title="Resilio Sync">Resilio Sync</a> to synchronize the <i>pacman</i> cache directories (i.e. <code>/var/cache/pacman/pkg</code>).
</p>
<h2><span class="mw-headline" id="Proxy_server">Proxy server</span></h2>
<p>For proxy server solutions, keep in mind the machines should only use HTTP mirrors, because a proxy server cannot introspect <a href="../en/Category:Web.html" class="mw-redirect" title="HTTPS">HTTPS</a> connections by default.
</p>
<h3><span class="mw-headline" id="Dynamic_reverse_proxy_cache_using_nginx">Dynamic reverse proxy cache using nginx</span></h3>
<p><a href="../en/Nginx.html" title="Nginx">nginx</a> can be used to proxy package requests to official upstream mirrors and cache the results to the local disk. All subsequent requests for that package will be served directly from the local cache, minimizing the amount of internet traffic needed to update a large number of computers. 
</p>
<p>In this example, the cache server will run at <code>http://cache.domain.example:8080/</code> and store the packages in <code>/srv/http/pacman-cache/</code>. 
</p>
<p>Install <a href="../en/Nginx.html" title="Nginx">nginx</a> on the computer that is going to host the cache. Create the directory for the cache and adjust the permissions so nginx can write files to it:
</p>
<pre># mkdir /srv/http/pacman-cache
# chown http:http /srv/http/pacman-cache
</pre>
<p>Use the <a rel="nofollow" class="external text" href="https://github.com/nastasie-octavian/nginx_pacman_cache_config/blob/c54eca4776ff162ab492117b80be4df95880d0e2/nginx.conf">nginx pacman cache config</a> as a starting point for <code>/etc/nginx/nginx.conf</code>. Check that the <code>resolver</code> directive works for your needs. In the upstream server blocks, configure the <code>proxy_pass</code> directives with addresses of official mirrors, see examples in the configuration file about the expected format. Once you are satisfied with the configuration file <a href="../en/Nginx.html#Running" title="Nginx">start and enable nginx</a>.
</p>
<p>In order to use the cache each Arch Linux computer (including the one hosting the cache) must have the following line at the top of the <code>mirrorlist</code> file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/mirrorlist</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Server = http://cache.domain.example:8080/$repo/os/$arch
...
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  You will need to create a method to clear old packages, as the cache directory will continue to grow over time. <code>paccache</code> (which is provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman-contrib">pacman-contrib</a></span>) can be used to automate this using retention criteria of your choosing. For example, <code>find /srv/http/pacman-cache/ -type d -exec paccache -v -r -k 2 -c {} \;</code> will keep the last 2 versions of packages in your cache directory.</div>
<h3><span class="mw-headline" id="Squid">Squid</span></h3>
<p><a href="../en/Squid.html" title="Squid">Squid</a> proxy can be setup to only cache arch packages and can be used with aif/pacman/wget/etc with minimal configuration on the client system.
</p>
<h4><span class="mw-headline" id="Install_Squid">Install Squid</span></h4>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=squid">squid</a></span>.
</p>
<h4><span class="mw-headline" id="Configure_Squid">Configure Squid</span></h4>
<p>This is the minimum configuration to get squid cache arch packages.
</p>
<h5><span class="mw-headline" id="Cache_Rules">Cache Rules</span></h5>
<p>Before defining these rules, remove/comment (if you do not need them) all the default refresh_patterns
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/squid/squid.conf </pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">refresh_pattern \.pkg\.tar\.   0       20%     4320      reload-into-ims
refresh_pattern .              0       0%      0</pre>
<p>That should define that *.pkg.tar.* gets cached, and anything else should not.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> <a rel="nofollow" class="external free" href="https://www.squid-cache.org/Doc/config/refresh_pattern">https://www.squid-cache.org/Doc/config/refresh_pattern</a>
</div>
<h5><span class="mw-headline" id="Maximum_Filesize">Maximum Filesize</span></h5>
<p>Objects larger than this size will NOT be saved on disk:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/squid/squid.conf </pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">maximum_object_size 256 MB</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> <a rel="nofollow" class="external free" href="https://www.squid-cache.org/Doc/config/maximum_object_size">https://www.squid-cache.org/Doc/config/maximum_object_size</a>
</div>
<h5><span class="mw-headline" id="Cache_Directory">Cache Directory</span></h5>
<p>Set the cache dir and its maximum size and subdirs:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/squid/squid.conf </pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">cache_dir aufs /var/cache/squid 10000 16 256</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> <a rel="nofollow" class="external free" href="https://www.squid-cache.org/Doc/config/cache_dir">https://www.squid-cache.org/Doc/config/cache_dir</a>
</div>
<h5><span class="mw-headline" id="Shutdown_Lifetime">Shutdown Lifetime</span></h5>
<p>Time to wait until all active client sockets are closed:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/squid/squid.conf </pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">shutdown_lifetime 1 seconds </pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> <a rel="nofollow" class="external free" href="https://www.squid-cache.org/Doc/config/shutdown_lifetime">https://www.squid-cache.org/Doc/config/shutdown_lifetime</a>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<p>Every time you change the cache_dir path (and after fresh install), you need to (re)create this directory:
</p>
<pre># squid -z</pre>
<p>and it could be helpful to check the configuration file before running squid:
</p>
<pre># squid -k parse</pre>
</div>
<h4><span class="mw-headline" id="Start_Squid">Start Squid</span></h4>
<p>Just <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> <code>squid.service</code> or if squid is already running <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> it. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<p>It could be helpful to check the configuration file before running:
</p>
<pre># squid -k check</pre>
</div>
<h4><span class="mw-headline" id="Follow_Squid_access_log">Follow Squid access log</span></h4>
<p>To see the access to squid:
</p>
<pre># tail -f /var/log/squid/access.log</pre>
<p>You should see this for packages that are directed to original host:
</p>
<pre>...TCP_MISS/200...DIRECT...</pre>
<p>and for packages that are delivered from the cache:
</p>
<pre>...TCP_HIT/200...NONE...</pre>
<h4><span class="mw-headline" id="Manual_Arch_Install">Manual Arch Install</span></h4>
<p>On the individual machines, add <a href="../en/Environment_variables.html" title="Environment variables">environment variables</a> for your proxy. To do so for testing:
</p>
<pre># export http_proxy='http://<i>your_squid_machine_ip</i>:3128/'
# export ftp_proxy='ftp://<i>your_squid_machine_ip</i>:3128/'
</pre>
<p>Now it should use your proxy. Watch the squid logs to verify this. Once it works, add the <code>http_proxy</code> and/or <code>ftp_proxy</code> variables in an appropriate place on the installed system, e.g. in <code>/etc/profile.d/proxy.sh</code>.
</p>
<h4><span class="mw-headline" id="Intercepting_local_requests">Intercepting local requests</span></h4>
<p>If you want all HTTP requests on local machine <i>automagically</i> go through squid, we first need to add an intercepting port for squid:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/squid/squid.conf </pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">http_port 3127 intercept</pre>
<p>and iptables rules to redirect all (except the ones from squid) port 80 requests to squid:
</p>
<pre># iptables -t nat -A OUTPUT -p tcp --dport 80 -m owner --uid-owner proxy -j ACCEPT
# iptables -t nat -A OUTPUT -p tcp --dport 80 -j REDIRECT --to-ports 3127</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> <a rel="nofollow" class="external free" href="https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxLocalhost">https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxLocalhost</a>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
if you get random slow download speeds in vagrant/packer/virtualbox, try using <code>virtio</code> network device type.</div>
<h3><span class="mw-headline" id="Pacoloco_proxy_cache_server">Pacoloco proxy cache server</span></h3>
<p><a rel="nofollow" class="external text" href="https://github.com/anatol/pacoloco">Pacoloco</a> is an easy-to-use proxy cache server for <i>pacman</i> repositories. It also allows <a rel="nofollow" class="external text" href="https://github.com/anatol/pacoloco/commit/048b09956b0d8ef71c0ed1f804fd332d9ab5e3c8">automatic prefetching</a> of the cached packages.
</p>
<p>It can be installed as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacoloco">pacoloco</a></span>. Open the configuration file and add <i>pacman</i> mirrors:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacoloco.yaml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">port: 9129
repos:
  mycopy:
    urls:
      - http://mirror.lty.me/archlinux
      - http://mirrors.kernel.org/archlinux
</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Restart</a> <code>pacoloco.service</code> and the proxy repository will be available at <code>http://<i>myserver</i>:9129/repo/mycopy</code>.
</p>
<h3><span class="mw-headline" id="Flexo_proxy_cache_server">Flexo proxy cache server</span></h3>
<p><a rel="nofollow" class="external text" href="https://github.com/nroi/flexo">Flexo</a> is yet another proxy cache server for <i>pacman</i> repositories. Flexo is available as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/flexo-git/">flexo-git</a></span><sup><small>AUR</small></sup>. Once installed, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> the <code>flexo.service</code> unit.
</p>
<p>Flexo runs on port <code>7878</code> by default. Enter <code>Server = http://<i>myserver</i>:7878/$repo/os/$arch</code> to the top of your <code>/etc/pacman.d/mirrorlist</code> so that <i>pacman</i> downloads packages via Flexo.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Package_management.html" title="Category:Package management">Package management</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Package_Proxy_Cache&amp;oldid=833373">https://wiki.archlinux.org/index.php?title=Package_Proxy_Cache&amp;oldid=833373</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 5 May 2025, at 17:09.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki.svg" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul></ul>
</div>
</body>
</html>
