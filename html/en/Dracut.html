<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>dracut - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Dracut rootpage-Dracut skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Usage" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Usage">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Usage</div>
		</a>
		
			<button aria-controls="toc-Usage-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Usage subsection</span>
			</button>
		
		<ul id="toc-Usage-sublist" class="vector-toc-list">
			<li id="toc-Additional_options" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Additional_options">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Additional options</div>
			</a>
			
			<ul id="toc-Additional_options-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Advanced_configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Advanced_configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Advanced configuration</div>
		</a>
		
			<button aria-controls="toc-Advanced_configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Advanced configuration subsection</span>
			</button>
		
		<ul id="toc-Advanced_configuration-sublist" class="vector-toc-list">
			<li id="toc-dracut_modules" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#dracut_modules">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>dracut modules</div>
			</a>
			
			<ul id="toc-dracut_modules-sublist" class="vector-toc-list">
				<li id="toc-TPM2" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#TPM2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.1</span>TPM2</div>
			</a>
			
			<ul id="toc-TPM2-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Early_kernel_module_loading" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Early_kernel_module_loading">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Early kernel module loading</div>
			</a>
			
			<ul id="toc-Early_kernel_module_loading-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Kernel_command_line_options" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Kernel_command_line_options">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Kernel command line options</div>
			</a>
			
			<ul id="toc-Kernel_command_line_options-sublist" class="vector-toc-list">
				<li id="toc-Miscellaneous_notes" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Miscellaneous_notes">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.1</span>Miscellaneous notes</div>
			</a>
			
			<ul id="toc-Miscellaneous_notes-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Unified_kernel_image" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Unified_kernel_image">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4</span>Unified kernel image</div>
			</a>
			
			<ul id="toc-Unified_kernel_image-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Tips and tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-View_information_about_generated_image" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#View_information_about_generated_image">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>View information about generated image</div>
			</a>
			
			<ul id="toc-View_information_about_generated_image-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Change_compression_program" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Change_compression_program">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Change compression program</div>
			</a>
			
			<ul id="toc-Change_compression_program-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Performance_considerations" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Performance_considerations">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Performance considerations</div>
			</a>
			
			<ul id="toc-Performance_considerations-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Generate_a_new_initramfs_on_kernel_upgrade" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Generate_a_new_initramfs_on_kernel_upgrade">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>Generate a new initramfs on kernel upgrade</div>
			</a>
			
			<ul id="toc-Generate_a_new_initramfs_on_kernel_upgrade-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Bluetooth_keyboard_support" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Bluetooth_keyboard_support">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.5</span>Bluetooth keyboard support</div>
			</a>
			
			<ul id="toc-Bluetooth_keyboard_support-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Hibernation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Hibernation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Hibernation</div>
			</a>
			
			<ul id="toc-Hibernation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-LVM_/_software_RAID_/_LUKS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#LVM_/_software_RAID_/_LUKS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>LVM / software RAID / LUKS</div>
			</a>
			
			<ul id="toc-LVM_/_software_RAID_/_LUKS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-A_stop_job_is_running_for_"brltty"' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#A_stop_job_is_running_for_"brltty"'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>A stop job is running for "brltty"</div>
			</a>
			
			<ul id='toc-A_stop_job_is_running_for_"brltty"-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-No_usable_keyslot_is_available" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#No_usable_keyslot_is_available">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>No usable keyslot is available</div>
			</a>
			
			<ul id="toc-No_usable_keyslot_is_available-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">dracut</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 2 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-2" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">2 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Dracut" title="Dracut – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/Dracut.html" title="Dracut – português" lang="pt" hreflang="pt" class="interlanguage-link-target"><span>Português</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Booster.html" title="Booster">booster</a></li>
<li><a href="../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a></li>
<li><a href="../en/Unified_kernel_image.html" title="Unified kernel image">Unified kernel image</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://github.com/dracut-ng/dracut-ng/wiki">dracut</a> creates an initial image used by the kernel for preloading the block device modules (such as IDE, SCSI or <a href="../en/RAID.html" title="RAID">RAID</a>) which are needed to access the root filesystem. Upon installing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span>, you can choose between <a href="../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a> and <i>dracut</i>. <i>dracut</i> is used by Fedora, RHEL, Gentoo, and Debian, among others. Arch uses <a href="../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a> by default.
</p>
<p>You can read the full project documentation for <i>dracut</i> <a rel="nofollow" class="external text" href="https://github.com/dracut-ng/dracut-ng/wiki">in the documentation</a>.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dracut">dracut</a></span> package, or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dracut-git/">dracut-git</a></span><sup><small>AUR</small></sup> for the latest development version.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If <i>dracut</i> works on your machine <b>after you test it</b>, you can <a href="../en/Pacman.html#Removing_packages" class="mw-redirect" title="Uninstall">uninstall</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio">mkinitcpio</a></span>.</div>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p><code>dracut</code> is easy to use and typically does not require user configuration, even when using non-standard setups, like <a href="../en/Dm-crypt/Encrypting_an_entire_system.html#LVM_on_LUKS" title="Dm-crypt/Encrypting an entire system">LVM on LUKS</a>.
</p>
<p>To generate an initramfs for the running kernel:
</p>
<pre># dracut --hostonly --no-hostonly-cmdline /boot/initramfs-linux.img
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  In some cases especially when you are installing a system for the first time the above command will not work use the following:
<pre># dracut --regenerate-all
</pre>
 </div>
<p>To generate a fallback initramfs run:
</p>
<pre># dracut /boot/initramfs-linux-fallback.img
</pre>
<p><code>/boot/initramfs-linux.img</code> refers to the output image file. If you are using the non-regular kernel, consider changing the file name. For example, for the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-lts">linux-lts</a></span> kernel, the output file should be named <code>/boot/initramfs-linux-lts.img</code>. However, you can name these files whatever you wish as long as your <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> configuration uses the same file names.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The files created through these commands embed any installed <a href="../en/Microcode.html" title="Microcode">Microcode</a> images.</div>
<h3><span class="mw-headline" id="Additional_options">Additional options</span></h3>
<p>The <code>--force</code> flag overwrites the image file if it is already present.
</p>
<p>The <code>--kver</code> option specifies which kernel to use. The argument to this option must match the name of a directory present in <code>/usr/lib/modules</code>.
</p>
<p>More flags can be found with <span class="plainlinks archwiki-template-man" title="$ man 8 dracut"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dracut.8">dracut(8)</a></span>.
</p>
<h2><span class="mw-headline" id="Advanced_configuration">Advanced configuration</span></h2>
<p>It is important to note that there are two distinct approaches how the various tasks during initial ramdisk phase are performed:
</p>
<dl>
<dt>
<i>Shell (bash/busybox/dash/ksh) based</i> initial ramdisk</dt>
<dd>An init script is started that in turn scans the filesystem of the initial ramdisk for dracut scripts to be executed.</dd>
</dl>
<dl>
<dt>
<i>systemd based (default)</i> initial ramdisk</dt>
<dd>systemd is already started at the beginning of the initial ramdisk phase. The tasks to be executed are determined by regular systemd unit files. See <a rel="nofollow" class="external text" href="https://www.freedesktop.org/software/systemd/man/latest/bootup.html">systemd bootup process</a>.</dd>
</dl>
<p>The concrete variant is determined by the absence or presence of the systemd dracut module. See <a href="#dracut_modules">#dracut modules</a> for more details.
</p>
<p><code>dracut</code> can be configured by directly passing arguments on the command line (see <span class="plainlinks archwiki-template-man" title="$ man 8 dracut"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dracut.8#OPTIONS">dracut(8) § OPTIONS</a></span>). If you wish to always execute <code>dracut</code> with a certain set of flags, you can save a specified configuration in a <code>.conf</code> file in <code>/etc/dracut.conf.d/</code>. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dracut.conf.d/myflags.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">hostonly="yes"
compress="lz4"
add_drivers+=" i915 "
omit_dracutmodules+=" systemd network "</pre>
<p>You can see more configuration options with <span class="plainlinks archwiki-template-man" title="$ man 5 dracut.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dracut.conf.5">dracut.conf(5)</a></span>. Fuller descriptions of each option can be found with <span class="plainlinks archwiki-template-man" title="$ man 8 dracut"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dracut.8">dracut(8)</a></span>. We will describe a few common options in what follows.
</p>
<h3><span class="mw-headline" id="dracut_modules">dracut modules</span></h3>
<p><i>dracut</i> uses a modular approach to build the initramfs (see <span class="plainlinks archwiki-template-man" title="$ man 7 dracut.modules"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dracut.modules.7">dracut.modules(7)</a></span>). All of <i>dracut</i> 's builtin modules are located in <code>/lib/dracut/modules.d</code> and can be listed with <code>dracut --list-modules</code>. Extra modules can be provided by external packages e.g. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dracut-sshd-git/">dracut-sshd-git</a></span><sup><small>AUR</small></sup>. <i>dracut</i> 's built-in modules unfortunately lack documentation, although their names can be self-explanatory.
</p>
<p>Some of the modules are active/inactive by default, and can be activated/deactivated with <code>--add</code>/<code>--omit</code> command line argument or with the <code>add_dracutmodules+=""</code>/<code>omit_dracutmodules+=""</code> persistent config entry lines.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dracut.conf.d/myflags.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># ...
add_dracutmodules+=" <i>dracut modules to activate</i> "
omit_dracutmodules+=" <i>dracut modules to deactivate</i> "
# ...</pre>
<p>The following table lists dracut modules, required packages (<i>dracut</i> 's optional dependencies) and module descriptions.
</p>
<p>Most dracut modules are dependent on other dracut modules. As an example the bluetooth dracut module depends on the dbus dracut module. The table below only lists direct dracut module dependencies, i.e. the required packages for a given module listed in the <code>module-setup.sh</code> for the given dracut module.
</p>
<p>Dracut modules not meant to be used on Arch Linux (e.g. ifcfg) are intentionally omitted in the table below.
</p>
<p>For additional dracut module documentation, see the <a rel="nofollow" class="external text" href="https://github.com/dracut-ng/dracut-ng/wiki/modules">upstream dracut wiki</a>.
</p>
<table class="wikitable">
<tbody>
<tr>
<th>dracut module
</th>
<th>Required packages
</th>
<th>Description
</th>
</tr>
<tr>
<td>bluetooth
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bluez">bluez</a></span>
</td>
<td>
<a href="../en/Bluetooth.html" title="Bluetooth">Bluetooth</a> (keyboard)
</td>
</tr>
<tr>
<td>btrfs
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=btrfs-progs">btrfs-progs</a></span>
</td>
<td>Scans for <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a> on block devices
</td>
</tr>
<tr>
<td>busybox
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=busybox">busybox</a></span>
</td>
<td>Allows use of <a href="../en/BusyBox.html" title="BusyBox">BusyBox</a> (on your own risk)
</td>
</tr>
<tr>
<td>crypt
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span>
</td>
<td>Support for encrypted <a href="../en/Dm-crypt.html" title="Dm-crypt">Dm-crypt</a> file systems
</td>
</tr>
<tr>
<td>dash
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dash">dash</a></span>
</td>
<td>Allows use of <a href="../en/Dash.html" title="Dash">Dash</a> (on your own risk)
</td>
</tr>
<tr>
<td>dmraid
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dmraid">dmraid</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=multipath-tools">multipath-tools</a></span>
</td>
<td>dmraid dracut module support
</td>
</tr>
<tr>
<td>mksh
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mksh/">mksh</a></span><sup><small>AUR</small></sup>
</td>
<td>mksh dracut module support (on your own risk)
</td>
</tr>
<tr>
<td>multipath
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=multipath-tools">multipath-tools</a></span>
</td>
<td>Multipath dracut module support
</td>
</tr>
<tr>
<td>dmsquash-live-ntfs
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fuse3">fuse3</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ntfs-3g">ntfs-3g</a></span>
</td>
<td>Live on <a href="../en/NTFS.html" title="NTFS">NTFS</a>
</td>
</tr>
<tr>
<td>lvm
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lvm2">lvm2</a></span>
</td>
<td>Support for <a href="../en/LVM.html" title="LVM">LVM</a>
</td>
</tr>
<tr>
<td>mdraid
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mdadm">mdadm</a></span>
</td>
<td>Support MD devices, also known as software <a href="../en/RAID.html" title="RAID">RAID</a> devices
</td>
</tr>
<tr>
<td>memstrack
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/memstrack/">memstrack</a></span><sup><small>AUR</small></sup>
</td>
<td>Support memstrack
</td>
</tr>
<tr>
<td>nvdimm
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ndctl">ndctl</a></span>
</td>
<td>NVDIMM support
</td>
</tr>
<tr>
<td>plymouth
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=plymouth">plymouth</a></span>
</td>
<td>
<a href="../en/Plymouth.html" title="Plymouth">Plymouth</a> boot splash
</td>
</tr>
<tr>
<td>rescue
</td>
<td>
</td>
<td>Includes various utilities for rescue mode (such as ping, ssh, vi, fsck.*)
</td>
</tr>
<tr>
<td>resume
</td>
<td>
</td>
<td>Allows initramfs to resume from low-power state
</td>
</tr>
<tr>
<td>rngd
</td>
<td>
</td>
<td>Starts random generator service on early boot
</td>
</tr>
<tr>
<td>syslog
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/rsyslog/">rsyslog</a></span><sup><small>AUR</small></sup>
</td>
<td>Enable logging with <a href="../en/Rsyslog.html" title="Rsyslog">Rsyslog</a>
</td>
</tr>
<tr>
<td>squash
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=squashfs-tools">squashfs-tools</a></span>
</td>
<td>Support for building a squashed initramfs
</td>
</tr>
<tr>
<td>tpm2-tss
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tpm2-tools">tpm2-tools</a></span>
</td>
<td>
<a href="../en/Trusted_Platform_Module.html" title="Trusted Platform Module">Trusted Platform Module</a>
</td>
</tr>
<tr>
<td>base
</td>
<td>
</td>
<td>Base module with required utilities
</td>
</tr>
<tr>
<td>bash
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bash">bash</a></span>
</td>
<td>Bash is the preferred interpreter, if there are more available
</td>
</tr>
<tr>
<td>biosdevname
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/biosdevname/">biosdevname</a></span><sup><small>AUR</small></sup>
</td>
<td>Enables BIOS network device renaming
</td>
</tr>
<tr>
<td>caps
</td>
<td>
</td>
<td>Supports dropping capabilities before init
</td>
</tr>
<tr>
<td>convertfs
</td>
<td>
</td>
<td>Merges / into /usr on next boot
</td>
</tr>
<tr>
<td>crypt-gpg
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnupg">gnupg</a></span>
</td>
<td>Adds support GPG for crypto operations and SmartCards (may requires GPG keys)
</td>
</tr>
<tr>
<td>crypt-loop
</td>
<td>
</td>
<td>Adds support for encrypted loopback devices (symmetric key)
</td>
</tr>
<tr>
<td>dbus
</td>
<td>
</td>
<td>Virtual package for dbus-broker or dbus-daemon
</td>
</tr>
<tr>
<td>dbus-broker
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dbus-broker">dbus-broker</a></span>
</td>
<td>Use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dbus-broker">dbus-broker</a></span> as dbus service provider
</td>
</tr>
<tr>
<td>dbus-daemon
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dbus">dbus</a></span>
</td>
<td>Use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dbus">dbus</a></span> as dbus service provider
</td>
</tr>
<tr>
<td>debug
</td>
<td>
</td>
<td>Enable debug features
</td>
</tr>
<tr>
<td>dm
</td>
<td>
</td>
<td>Adds support of device-mapper
</td>
</tr>
<tr>
<td>dmsquash-live-autooverlay
</td>
<td>
</td>
<td>Creates a partition for overlayfs usage in the free space on the root filesystem's parent block device
</td>
</tr>
<tr>
<td>dracut-systemd
</td>
<td>
</td>
<td>Base systemd dracut module
</td>
</tr>
<tr>
<td>drm
</td>
<td>
</td>
<td>Includes kernel modules that provides DRM support
</td>
</tr>
<tr>
<td>ecryptfs
</td>
<td>
</td>
<td>Adds ecryptfs filesystems support
</td>
</tr>
<tr>
<td>fido2
</td>
<td>
</td>
<td>Allows to unlock an encrypted filesystem using a FIDO2 security token
</td>
</tr>
<tr>
<td>fips
</td>
<td>
</td>
<td>Enforces FIPS security standard regulations
</td>
</tr>
<tr>
<td>fs-lib
</td>
<td>
</td>
<td>Library for filesystem tools (including fsck.* and mount)
</td>
</tr>
<tr>
<td>fstab-sys
</td>
<td>
</td>
<td>Arranges for arbitrary partitions to be mounted before rootfs
</td>
</tr>
<tr>
<td>i18n
</td>
<td>
</td>
<td>Includes keymaps, console fonts, etc.
</td>
</tr>
<tr>
<td>img-lib
</td>
<td>
</td>
<td>Library to includes various tools for decompressing images
</td>
</tr>
<tr>
<td>integrity
</td>
<td>
</td>
<td>Adds support for Extended Verification Module
</td>
</tr>
<tr>
<td>kernel-modules
</td>
<td>
</td>
<td>Kernel modules for root filesystems and other boot-time devices
</td>
</tr>
<tr>
<td>kernel-modules-extra
</td>
<td>
</td>
<td>Extra out-of-tree kernel modules
</td>
</tr>
<tr>
<td>lunmask
</td>
<td>
</td>
<td>Masks LUN devices to select only ones which required to boot
</td>
</tr>
<tr>
<td>lvmmerge
</td>
<td>
</td>
<td>Merges lvm snapshots
</td>
</tr>
<tr>
<td>lvmthinpool-monitor
</td>
<td>
</td>
<td>Monitor LVM thinpool service
</td>
</tr>
<tr>
<td>masterkey
</td>
<td>
</td>
<td>Masterkey that can be used to decrypt other keys and keyutils
</td>
</tr>
<tr>
<td>modsign
</td>
<td>
</td>
<td>Adds signing kernel modules support
</td>
</tr>
<tr>
<td>overlayfs
</td>
<td>
</td>
<td>Kernel module for overlayfs
</td>
</tr>
<tr>
<td>pcsc
</td>
<td>
</td>
<td>Adds support for PCSC Smart cards
</td>
</tr>
<tr>
<td>pkcs11
</td>
<td>
</td>
<td>Includes PKCS#11 libraries
</td>
</tr>
<tr>
<td>pollcdrom
</td>
<td>
</td>
<td>Enables CD-ROM polling
</td>
</tr>
<tr>
<td>qemu
</td>
<td>
</td>
<td>Includes kernel modules for QEMU environment
</td>
</tr>
<tr>
<td>rescue
</td>
<td>
</td>
<td>utilities for rescue mode (such as ping, ssh, vi, fsck.*)
</td>
</tr>
<tr>
<td>rootfs-block
</td>
<td>
</td>
<td>Arranges for the block device containing the rootfs to be mounted
</td>
</tr>
<tr>
<td>securityfs
</td>
<td>
</td>
<td>Arranges for the securityfs to be mounted early
</td>
</tr>
<tr>
<td>selinux
</td>
<td>
</td>
<td>Arranges for the selinux policy to be loaded
</td>
</tr>
<tr>
<td>shutdown
</td>
<td>
</td>
<td>Sets up hooks to run on shutdown
</td>
</tr>
<tr>
<td>systemd
</td>
<td>
</td>
<td>Adds systemd as early init initialization system
</td>
</tr>
<tr>
<td>terminfo
</td>
<td>
</td>
<td>Includes a terminfo file
</td>
</tr>
<tr>
<td>udev-rules
</td>
<td>
</td>
<td>Includes udev and some basic rules
</td>
</tr>
<tr>
<td>uefi-lib
</td>
<td>
</td>
<td>Library to include UEFI tools
</td>
</tr>
<tr>
<td>usrmount
</td>
<td>
</td>
<td>Mounts /usr
</td>
</tr>
<tr>
<td>virtfs
</td>
<td>
</td>
<td>Adds virtual filesystems (9p) support
</td>
</tr>
<tr>
<td>virtiofs
</td>
<td>
</td>
<td>Adds virtiofs filesystems support
</td>
</tr>
<tr>
<td>warpclock
</td>
<td>
</td>
<td>Sets kernel's timezone and reset the system time if adjtime is set to LOCAL
</td>
</tr>
<tr>
<td>watchdog
</td>
<td>
</td>
<td>Includes watchdog devices management; works only if systemd not in use
</td>
</tr>
<tr>
<td>watchdog-modules
</td>
<td>
</td>
<td>Includes watchdog kernel modules to be loaded early in booting
</td>
</tr>
</tbody>
</table>
<p>Dracut modules that are meant to be used when  <a href="../en/Network_configuration.html#IP_addresses" title="Network configuration">IP address</a> is expected to be available during early boot.
</p>
<table class="wikitable">
<tbody>
<tr>
<th>networking dracut module
</th>
<th>Required packages
</th>
<th>Description
</th>
</tr>
<tr>
<td>cifs
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cifs-utils">cifs-utils</a></span>
</td>
<td>Support for <a href="../en/Samba.html" title="Samba">Samba</a>
</td>
</tr>
<tr>
<td>nbd
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nbd">nbd</a></span>
</td>
<td>Support network block devices
</td>
</tr>
<tr>
<td>network-manager
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=networkmanager">networkmanager</a></span>
</td>
<td>
<a href="../en/NetworkManager.html" title="NetworkManager">NetworkManager</a> support
</td>
</tr>
<tr>
<td>nfs
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nfs-utils">nfs-utils</a></span>
</td>
<td>
<a href="../en/NFS.html" title="NFS">NFS</a> support - NFSv3 and NFSv4
</td>
</tr>
<tr>
<td>nvmf
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvme-cli">nvme-cli</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=jq">jq</a></span>
</td>
<td>NVMe over Fibre Channel and NVMe-over Fabrics support (NVMeoF only with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dracut-git/">dracut-git</a></span><sup><small>AUR</small></sup>)
</td>
</tr>
<tr>
<td>iscsi
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=open-iscsi">open-iscsi</a></span>
</td>
<td>
<a href="../en/ISCSI.html" title="ISCSI">ISCSI</a> support
</td>
</tr>
<tr>
<td>ssh-client
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span>
</td>
<td>Installs ssh and scp along with config files and specified keys
</td>
</tr>
<tr>
<td>network-legacy
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dhclient">dhclient</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iproute2">iproute2</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iputils">iputils</a></span>
</td>
<td>Legacy <a href="../en/Network_configuration.html" class="mw-redirect" title="Network">network</a> support
</td>
</tr>
<tr>
<td>connman
</td>
<td>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=connman">connman</a></span>
</td>
<td>Support for <a href="../en/ConnMan.html" title="ConnMan">ConnMan</a> networking
</td>
</tr>
<tr>
<td>kernel-network-modules
</td>
<td>
</td>
<td>Includes and loads kernel modules for network devices
</td>
</tr>
<tr>
<td>livenet
</td>
<td>
</td>
<td>Fetch live updates for SquashFS images
</td>
</tr>
<tr>
<td>network
</td>
<td>
</td>
<td>Virtual module for network service providers
</td>
</tr>
<tr>
<td>url-lib
</td>
<td>
</td>
<td>Library to includes curl and SSL certs
</td>
</tr>
<tr>
<td>qemu-net
</td>
<td>
</td>
<td>Includes network kernel modules for QEMU environment
</td>
</tr>
<tr>
<td>systemd-network-management
</td>
<td>
</td>
<td>Adds network management for systemd. Includes systemd-networkd, systemd-resolved and some othr networking related dracut modules
</td>
</tr>
<tr>
<td>systemd-networkd
</td>
<td>
</td>
<td>
<a href="../en/Systemd-networkd.html" title="Systemd-networkd">Systemd-networkd</a>
</td>
</tr>
<tr>
<td>net-lib
</td>
<td>
</td>
<td>Networking library with <i>ip</i> (only with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dracut-git/">dracut-git</a></span><sup><small>AUR</small></sup>)
</td>
</tr>
</tbody>
</table>
<h4><span class="mw-headline" id="TPM2">TPM2</span></h4>
<p>To make use of <i>systemd</i> 's unlocking of <i>luks2</i> encrypted volumes using TPM2 through <a href="../en/Trusted_Platform_Module.html#systemd-cryptenroll" title="Trusted Platform Module">systemd-cryptenroll</a>, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tpm2-tools">tpm2-tools</a></span> package and enable the <code>tpm2-tss</code> <i>dracut</i> module.
</p>
<h3><span class="mw-headline" id="Early_kernel_module_loading">Early kernel module loading</span></h3>
<p>Dracut enables early loading (at the initramfs stage, via <code>modprobe</code>) through its <code>--force_drivers</code> command or <code>force_drivers+=""</code> config entry line. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dracut.conf.d/myflags.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># ...
force_drivers+=" nvidia nvidia_modeset nvidia_uvm nvidia_drm "
# ...</pre>
<h3><span class="mw-headline" id="Kernel_command_line_options">Kernel command line options</span></h3>
<p>Kernel command line options can be placed in a <i>.conf</i> file in <code>/etc/dracut.conf.d/</code>, and set via the <code>kernel_cmdline=</code> flag. Dracut will automatically source this file and create a <code>01-default.conf</code> file and place it inside the initramfs directory <code>/etc/cmdline.d/</code>. For example, your kernel command line options file could look like:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dracut.conf.d/cmdline.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">kernel_cmdline="rd.luks.uuid=luks-f6c738f3-ee64-4633-b6b0-eceddb1bb010 rd.lvm.lv=arch/root rd.lvm.lv=arch/swap  root=/dev/arch/root rootfstype=ext4 rootflags=rw,relatime"</pre>
<h4><span class="mw-headline" id="Miscellaneous_notes">Miscellaneous notes</span></h4>
<p>It is not necessary to specify the root block device for <code>dracut</code>. From <span class="plainlinks archwiki-template-man" title="$ man 7 dracut.cmdline"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dracut.cmdline.7">dracut.cmdline(7)</a></span>:
</p>
<dl><dd>The root device used by the kernel is specified in the boot configuration file on the kernel command line, as always.</dd></dl>
<p>However, it may be useful to set some parameters early, and you can enable additional features like prompting for additional command line parameters. See <span class="plainlinks archwiki-template-man" title="$ man 7 dracut.cmdline"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dracut.cmdline.7">dracut.cmdline(7)</a></span> for all options. Here are some example configuration options:
</p>
<ul>
<li>Resume from a swap partition: <code>resume=UUID=80895b78-7312-45bc-afe5-58eb4b579422</code>
</li>
<li>Prompt for additional kernel command line parameters: <code>rd.cmdline=ask</code> <div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> <code>rd.cmdline=ask</code> may cause an issue where the keyboard is not yet initialized prior to its prompt forcing a hard reset. See <a rel="nofollow" class="external text" href="https://github.com/dracut-ng/dracut-ng/issues/164">dracut-ng issue 164</a>. Fixed in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dracut-git/">dracut-git</a></span><sup><small>AUR</small></sup> . </div>
</li>
<li>Print informational output even if <code>quiet</code> is set: <code>rd.info</code>
</li>
</ul>
<h3><span class="mw-headline" id="Unified_kernel_image">Unified kernel image</span></h3>
<p><i>dracut</i> can produce <a href="../en/Unified_kernel_image.html" title="Unified kernel image">unified kernel images</a> with the <code>--uefi</code> command line option or with the <code>uefi="yes"</code> configuration option.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="View_information_about_generated_image">View information about generated image</span></h3>
<p>You can view information about a generated initramfs image, which you may wish to view in a pager: 
</p>
<pre># lsinitrd <i>/path/to/initramfs_or_uefi_image</i> | less
</pre>
<p>This command will list the arguments passed to <code>dracut</code> when the image was created, the list of included <code>dracut</code> modules, and the list of all included files.
</p>
<h3><span class="mw-headline" id="Change_compression_program">Change compression program</span></h3>
<p>To reduce the amount of time spent compressing the final image, you may change the compression program used.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Make sure your kernel has your chosen decompression support compiled in, otherwise you will not be able to boot. You must also have the chosen compression program package installed.</div>
<p>Simply add any one of the following lines (not multiple) <a href="#Advanced_configuration">to your dracut configuration</a>:
</p>
<pre>compress="cat"
compress="gzip"
compress="bzip2"
compress="lzma"
compress="xz"
compress="lzo"
compress="lz4"
compress="zstd"
</pre>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gzip">gzip</a></span> is the default compression program used. <code>compress="cat"</code> will make the initramfs with no compression.
</p>
<p>You can also use a non-officially-supported compression program:
</p>
<pre>compress="<i>program</i>"
</pre>
<h3><span class="mw-headline" id="Performance_considerations">Performance considerations</span></h3>
<p>Some considerations to optimize the boot and initramfs creation performance are:
</p>
<ul><li>Understand and configure the fastest compression. If the kernel modules are already compressed, perhaps there is no need to re-compress the initramfs on creation.</li></ul>
<ul><li>Understand the impact if including systemd into your initramfs. If it slows things down, omit it. If it makes things faster, include it.</li></ul>
<ul><li>Consider using dracut-cpio (available in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dracut-git/">dracut-git</a></span><sup><small>AUR</small></sup> ). See the <code>--enhanced-cpio</code> option for applicability.</li></ul>
<ul><li>Minimize the number of kernel modules and dracut modules included in initramfs. As an example: If <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nfs-utils">nfs-utils</a></span> is installed (but not required to boot), then you need to explicitly omit the nfs dracut module, otherwise network boot will be enabled in the generated initramfs in default configuration - see <a rel="nofollow" class="external free" href="https://github.com/dracut-ng/dracut-ng/pull/297">https://github.com/dracut-ng/dracut-ng/pull/297</a>.</li></ul>
<ul><li>Consider using busybox instead of bash.</li></ul>
<ul><li>Consider hostonly.</li></ul>
<h3><span class="mw-headline" id="Generate_a_new_initramfs_on_kernel_upgrade">Generate a new initramfs on kernel upgrade</span></h3>
<p>It is possible to automatically generate new initramfs images upon each kernel upgrade. The instructions here are for the default <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> kernel, but it should be easy to add extra hooks for other kernels.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dracut-ukify/">dracut-ukify</a></span><sup><small>AUR</small></sup> package is the modern way to generate a <a href="../en/Unified_kernel_image.html" title="Unified kernel image">unified kernel image</a> using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd-ukify">systemd-ukify</a></span>. Unlike the methods below, you can <a href="../en/Unified_Extensible_Firmware_Interface/Secure_Boot.html" title="Unified Extensible Firmware Interface/Secure Boot">sign</a> your whole kernel image <a rel="nofollow" class="external text" href="https://0pointer.net/blog/brave-new-trusted-boot-world.html">including the initramfs</a>. Using the <code>uefi_secureboot_cert</code> and <code>uefi_secureboot_key</code> options in your dracut config (<span class="plainlinks archwiki-template-man" title="$ man 5 dracut.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/dracut.conf.5">dracut.conf(5)</a></span>).</li>
<li>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dracut-hook/">dracut-hook</a></span><sup><small>AUR</small></sup> package includes hooks and scripts similar to the below. Alternatively, you may want <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dracut-uefi-hook/">dracut-uefi-hook</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/dracut-hook-uefi/">dracut-hook-uefi</a></span><sup><small>AUR</small></sup> instead, if you want an initramfs image that is an EFI executable (i.e. <code><i>esp</i>/EFI/Linux/linux-<i>kernel</i>-<i>machine_id</i>-<i>build_id</i>.efi</code>). EFI binaries in this directory are automatically detected by <a href="../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a> and therefore do not need an entry in <code>/boot/loader/loader.conf</code>.</li>
</ul>
</div>
<p>As the command to figure out the kernel version is somewhat complex, it will not work by itself in a <a href="../en/Pacman.html#Hooks" class="mw-redirect" title="Pacman hook">pacman hook</a>. So create a script anywhere on your system. For this example it will be created in <code>/usr/local/bin/</code>.
</p>
<p>The script will also copy the new <code>vmlinuz</code> kernel file to <code>/boot/</code>, since the kernel packages do not place files in <code>/boot/</code> anymore.<a rel="nofollow" class="external autonumber" href="https://lists.archlinux.org/archives/list/arch-general@lists.archlinux.org/message/ZSO3ZLU2ATKBRLZBPOE3EHR6GS63RO3P/">[1]</a>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/local/bin/dracut-install.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/env bash

args=('--force' '--no-hostonly-cmdline')

while read -r line; do
	if [[ "$line" == 'usr/lib/modules/'+([^/])'/pkgbase' ]]; then
		read -r pkgbase &lt; "/${line}"
		kver="${line#'usr/lib/modules/'}"
		kver="${kver%'/pkgbase'}"

		install -Dm0644 "/${line%'/pkgbase'}/vmlinuz" "/boot/vmlinuz-${pkgbase}"
		dracut "${args[@]}" --hostonly "/boot/initramfs-${pkgbase}.img" --kver "$kver"
		dracut "${args[@]}" --no-hostonly "/boot/initramfs-${pkgbase}-fallback.img" --kver "$kver"
	fi
done
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/local/bin/dracut-remove.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/env bash

while read -r line; do
	if [[ "$line" == 'usr/lib/modules/'+([^/])'/pkgbase' ]]; then
		read -r pkgbase &lt; "/${line}"
		rm -f "/boot/vmlinuz-${pkgbase}" "/boot/initramfs-${pkgbase}.img" "/boot/initramfs-${pkgbase}-fallback.img"
	fi
done
</pre>
<p>You need to make the scripts <a href="../en/Help:Reading.html#Make_executable" class="mw-redirect" title="Executable">executable</a>. If you wish to add or remove flags, you should <a href="#Advanced_configuration">add them to your dracut configuration</a>.
</p>
<p>The next step is creating <a href="../en/Pacman.html#Hooks" class="mw-redirect" title="Pacman hook">pacman hooks</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/90-dracut-install.hook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Trigger]
Type = Path
Operation = Install
Operation = Upgrade
Target = usr/lib/modules/*/pkgbase

[Action]
Description = Updating linux initcpios (with dracut!)...
When = PostTransaction
Exec = /usr/local/bin/dracut-install.sh
Depends = dracut
NeedsTargets
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/60-dracut-remove.hook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Trigger]
Type = Path
Operation = Remove
Target = usr/lib/modules/*/pkgbase

[Action]
Description = Removing linux initcpios...
When = PreTransaction
Exec = /usr/local/bin/dracut-remove.sh
NeedsTargets
</pre>
<p>You should stop <a href="../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a> from creating and removing initramfs images as well, either by removing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio">mkinitcpio</a></span> or with the following commands:
</p>
<pre># ln -sf /dev/null /etc/pacman.d/hooks/90-mkinitcpio-install.hook
# ln -sf /dev/null /etc/pacman.d/hooks/60-mkinitcpio-remove.hook
</pre>
<h3><span class="mw-headline" id="Bluetooth_keyboard_support">Bluetooth keyboard support</span></h3>
<p>Dracut will enable the bluetooth module automatically when a bluetooth keyboard is detected. However it is required that dracut is in hostonly mode for this. This seems to not be the default. To enable hostonly mode you can add the following to your dracut configuration:
</p>
<pre>hostonly=yes
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Hibernation">Hibernation</span></h3>
<p>If resuming from hibernation does not work, you may need to configure <code>dracut</code> to include the <code>resume</code> module. You will need to <a href="#dracut_modules">add a configuration file</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dracut.conf.d/resume-from-hibernate.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">add_dracutmodules+=" resume "</pre>
<p>If applicable to your system, you may also want to see <a href="../en/Dm-crypt/Swap_encryption.html#Using_a_swap_partition" title="Dm-crypt/Swap encryption">instructions to resume from an encrypted swap partition</a> including the <a href="../en/Dm-crypt/Swap_encryption.html#dracut" title="Dm-crypt/Swap encryption">dracut specific instructions</a>.
</p>
<h3>
<span id="LVM_.2F_software_RAID_.2F_LUKS"></span><span class="mw-headline" id="LVM_/_software_RAID_/_LUKS">LVM / software RAID / LUKS</span>
</h3>
<p>If the kernel has issues auto discovering and mounting LVM / software RAID / LUKS blocks. You can retry generating an initramfs with the following kernel command line options:
</p>
<pre>rd.auto rd.lvm=1 rd.dm=1 rd.md=1 rd.luks=1
</pre>
<h3>
<span id="A_stop_job_is_running_for_.22brltty.22"></span><span class="mw-headline" id='A_stop_job_is_running_for_"brltty"'>A stop job is running for "brltty"</span>
</h3>
<p>If you have issues booting or very long shutdown processes while the system waits for <code>brltty</code>, add the following to the dracut configuration line:
</p>
<pre>omit_dracutmodules+=" brltty "
</pre>
<p>Alternatively, uninstall <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=brltty">brltty</a></span> if it is not needed.
</p>
<h3><span class="mw-headline" id="No_usable_keyslot_is_available">No usable keyslot is available</span></h3>
<pre>Cannot use whirlpool hash for keyslot encryption. 
Keyslot open failed. 
No usable keyslot is available.
</pre>
<p>A failure to boot with a message similar to the above typically will only require the user to include the <code>crypt</code> module via <code>add_dracutmodules</code>. However, if you continue to get the message after adding it, you may need to adjust your configuration with the following.
</p>
<pre>install_items+=" /usr/lib/ossl-modules/legacy.so "
</pre>
<p>This is because <a href="../en/OpenSSL.html" title="OpenSSL">OpenSSL</a> deprecated the whirlpool hash and moved it to that library. Dracut does not automatically gather it when using Arch.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/dracut_(software)" class="extiw" title="wikipedia:dracut (software)">Wikipedia:dracut (software)</a></li>
<li><a href="https://wiki.gentoo.org/wiki/Dracut" class="extiw" title="gentoo:Dracut">Gentoo:Dracut</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Initramfs.html" title="Category:Initramfs">Initramfs</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Dracut&amp;oldid=812659">https://wiki.archlinux.org/index.php?title=Dracut&amp;oldid=812659</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 20 July 2024, at 07:57.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
