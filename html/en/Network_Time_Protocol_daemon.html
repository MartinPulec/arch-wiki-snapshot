<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Network Time Protocol daemon - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Network_Time_Protocol_daemon rootpage-Network_Time_Protocol_daemon skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Configuration</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-Connection_to_NTP_servers" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connection_to_NTP_servers">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Connection to NTP servers</div>
			</a>
			
			<ul id="toc-Connection_to_NTP_servers-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Leap_seconds_file" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Leap_seconds_file">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Leap seconds file</div>
			</a>
			
			<ul id="toc-Leap_seconds_file-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-NTP_server_mode" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#NTP_server_mode">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>NTP server mode</div>
			</a>
			
			<ul id="toc-NTP_server_mode-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Usage" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Usage">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Usage</div>
		</a>
		
			<button aria-controls="toc-Usage-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Usage subsection</span>
			</button>
		
		<ul id="toc-Usage-sublist" class="vector-toc-list">
			<li id="toc-Start_ntpd_at_boot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Start_ntpd_at_boot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Start ntpd at boot</div>
			</a>
			
			<ul id="toc-Start_ntpd_at_boot-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Synchronize_time_once_per_boot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Synchronize_time_once_per_boot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Synchronize time once per boot</div>
			</a>
			
			<ul id="toc-Synchronize_time_once_per_boot-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Tips and tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Start_ntpd_on_network_connection" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Start_ntpd_on_network_connection">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Start ntpd on network connection</div>
			</a>
			
			<ul id="toc-Start_ntpd_on_network_connection-sublist" class="vector-toc-list">
				<li id="toc-Netctl" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Netctl">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.1</span>Netctl</div>
			</a>
			
			<ul id="toc-Netctl-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-NetworkManager" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#NetworkManager">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.2</span>NetworkManager</div>
			</a>
			
			<ul id="toc-NetworkManager-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-KDE" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#KDE">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.3</span>KDE</div>
			</a>
			
			<ul id="toc-KDE-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Using_ntpd_with_GPS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_ntpd_with_GPS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Using ntpd with GPS</div>
			</a>
			
			<ul id="toc-Using_ntpd_with_GPS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Running_in_a_chroot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Running_in_a_chroot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Running in a chroot</div>
			</a>
			
			<ul id="toc-Running_in_a_chroot-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Restrict_listening_sockets" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Restrict_listening_sockets">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>Restrict listening sockets</div>
			</a>
			
			<ul id="toc-Restrict_listening_sockets-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Network Time Protocol daemon</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 4 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-4" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">4 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/Network_Time_Protocol_daemon.html" title="Network Time Protocol daemon – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Network_Time_Protocol_daemon" title="Network Time Protocol daemon – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Network_Time_Protocol_daemon.html" title="Network Time Protocol daemon – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Network_Time_Protocol_daemon" title="Network Time Protocol daemon – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/NTPsec.html" class="mw-redirect" title="NTPSec">NTPSec</a></li>
<li><a href="../en/Chrony.html" title="Chrony">Chrony</a></li>
<li><a href="../en/System_time.html#Time_synchronization" class="mw-redirect" title="Time synchronization">Time synchronization</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/Network_Time_Protocol" class="extiw" title="wikipedia:Network Time Protocol">Network Time Protocol</a> is the most common method to synchronize the <a href="../en/System_time.html" title="System time">software clock</a> of a GNU/Linux system with internet time servers. It is designed to mitigate the effects of variable network latency and can usually maintain time to within tens of milliseconds over the public Internet. The accuracy on local area networks is even better, up to one millisecond.
</p>
<p><a rel="nofollow" class="external text" href="https://support.ntp.org/bin/view/Main/WebHome#The_NTP_Project">The NTP Project</a> provides a reference implementation of the protocol called simply NTP. This article further describes how to set up and run the NTP daemon, both as a client and as a server.
</p>
<p>See <a href="../en/System_time.html#Time_synchronization" title="System time">System time#Time synchronization</a> for other NTP implementations.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ntp">ntp</a></span> package. By default, <i>ntpd</i> works in client mode without further configuration. You can skip to <a href="#Usage">#Usage</a> if you want to use the Arch Linux default configuration file for it. For server configuration, see <a href="#NTP_server_mode">#NTP server mode</a>.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>The main daemon is <i>ntpd</i>, which is configured in <code>/etc/ntp.conf</code>. Refer to <span class="plainlinks archwiki-template-man" title="$ man 5 ntp.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ntp.conf.5">ntp.conf(5)</a></span> for detail.
</p>
<h3><span class="mw-headline" id="Connection_to_NTP_servers">Connection to NTP servers</span></h3>
<p>NTP servers are classified in a hierarchical system with many levels called <i>strata</i>: the devices which are considered independent time sources are classified as <i>stratum 0</i> sources; the servers directly connected to <i>stratum 0</i> devices are classified as <i>stratum 1</i> sources; servers connected to <i>stratum 1</i> sources are then classified as <i>stratum 2</i> sources and so on.
</p>
<p>It has to be understood that a server's stratum cannot be taken as an indication of its accuracy or reliability. Typically, stratum 2 servers are used for general synchronization purposes: if you do not already know the servers you are going to connect to, you should choose a server pool close to your location from the <a rel="nofollow" class="external text" href="https://www.pool.ntp.org/">pool.ntp.org</a> servers (<a rel="nofollow" class="external text" href="https://support.ntp.org/bin/view/Servers/NTPPoolServers">alternative link</a>).
</p>
<p>Since <i>ntp</i> version 4.2.7.p465-2, Arch Linux uses its own default vendor pool of NTP servers provided by <a rel="nofollow" class="external text" href="https://www.pool.ntp.org">the NTP Pool Project</a> (see <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/41700">FS#41700</a>). Modify those to suit your needs, e.g. if you want to use your country's servers with an option:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ntp.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server 0.fr.pool.ntp.org iburst
server 1.fr.pool.ntp.org iburst
server 2.fr.pool.ntp.org iburst
server 3.fr.pool.ntp.org iburst
</pre>
<p>The <code>iburst</code> option is recommended, and sends a burst of packets only if it cannot obtain a connection with the first attempt. The <code>burst</code> option always does this, even on the first attempt, and should never be used without explicit permission and may result in blacklisting.
</p>
<h3><span class="mw-headline" id="Leap_seconds_file">Leap seconds file</span></h3>
<p>In order for the system to be able to provide the <a href="https://en.wikipedia.org/wiki/International_Atomic_Time" class="extiw" title="wikipedia:International Atomic Time">International Atomic Time</a> to an application that requests it, the list of leap seconds must be loaded. The list is part of the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tzdata">tzdata</a></span> package and can be loaded by adding the following line to the NTP configuration file:
</p>
<pre>leapfile /usr/share/zoneinfo/leap-seconds.list
</pre>
<h3><span class="mw-headline" id="NTP_server_mode">NTP server mode</span></h3>
<p>If setting up an NTP server, check that you have <a rel="nofollow" class="external text" href="https://www.ntp.org/current-stable/orphan/">orphan mode</a> enabled, so that, in case it loses internet access, it will continue serving time to the network; enable orphan mode using the <code>tos</code> configuration parameter (you can set up to <a rel="nofollow" class="external text" href="https://www.ntp.org/ntpfaq/NTP-s-algo.htm#Q-ALGO-BASIC-STRATUM">stratum 15</a>) so that it will never be used unless internet access is lost:
</p>
<pre>tos orphan 15
</pre>
<p>Next, define the rules that will allow clients to connect to your service (<i>localhost</i> is considered a client too) using the <i>restrict</i> command; you should already have a line like this in your file:
</p>
<pre>restrict default nomodify nopeer noquery
</pre>
<p>This restricts everyone from modifying anything and prevents everyone from querying the status of your time server: <code>nomodify</code> prevents reconfiguring <i>ntpd</i> (with <i>ntpq</i> or <i>ntpdc</i>), and <code>noquery</code> is important to <a rel="nofollow" class="external text" href="https://lists.archlinux.org/archives/list/arch-dev-public@lists.archlinux.org/thread/QOJ3ADKWXOQ2HCW6WSLIS3N2U6SC7YV7/">prevent</a> dumping status data from <i>ntpd</i> (also with <i>ntpq</i> or <i>ntpdc</i>).
</p>
<p>You can also add other options:
</p>
<pre>restrict default kod limited nomodify notrap nopeer noquery
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This still allows other people to query your time server. You need to add <code>noserve</code> to stop serving time. It will also block time synchronization since it blocks all packets except <i>ntpq</i> and <i>ntpdc</i> queries.</div>
<p>If you want to change any of these, see the full docs for the "restrict" option in <span class="plainlinks archwiki-template-man" title="$ man 5 ntp.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ntp.conf.5">ntp.conf(5)</a></span>, the detailed ntp <a rel="nofollow" class="external text" href="https://support.ntp.org/bin/view/Support/AccessRestrictions">instructions</a> and <a href="#Usage">#Usage</a>.
</p>
<p>Following this line, you need to tell <i>ntpd</i> what to allow through into your server; the following line is enough if you are not configuring an NTP server:
</p>
<pre>restrict 127.0.0.1
</pre>
<p>If you want to force DNS resolution to the IPv6 namespace, write <code>-6</code> before the IP address or host name (<code>-4</code> forces IPv4 instead), for example:
</p>
<pre>restrict -6 default kod limited nomodify notrap nopeer noquery
restrict -6 ::1    # ::1 is the IPv6 equivalent for 127.0.0.1
</pre>
<p>Lastly, specify the drift file (which keeps track of your clock's time deviation) and optionally the log file location:
</p>
<pre>driftfile /var/lib/ntp/ntp.drift
logfile /var/log/ntp.log
</pre>
<p>A very basic configuration file will look like this:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ntp.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server 0.pool.ntp.org iburst
server 1.pool.ntp.org iburst
server 2.pool.ntp.org iburst
server 3.pool.ntp.org iburst
tos orphan 15

restrict default kod limited nomodify notrap nopeer noquery
restrict -6 default kod limited nomodify notrap nopeer noquery

restrict 127.0.0.1
restrict -6 ::1  

driftfile /var/lib/ntp/ntp.drift
logfile /var/log/ntp.log
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Defining the log file is not mandatory, but it is always a good idea to have feedback for <i>ntpd</i> operations.</div>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>The package has a default client-mode configuration and its own user and group to drop root privileges after starting. If you start it from the console, you should always do so with the <code>-u</code> option:
</p>
<pre># ntpd -u ntp:ntp
</pre>
<p>The <code>-u</code> option is employed by the two included systemd services. These services also use the <code>-g</code> option, which disables a threshold (so-called <i>panic-gate</i>). Hence, they will synchonize time even in case the ntp-server's time exceeds the threshold deviation from the system clock.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> One reason the panic-gate was introduced is that background jobs/services may be susceptible to time-jumps. If the system's clock was never synchronized before, consider stopping them before running <i>ntpd</i> for the first time.</div>
<p>Both services are tied to the system's resolver, and will start synchronizing when an active network connection is detected.
</p>
<h3><span class="mw-headline" id="Start_ntpd_at_boot">Start ntpd at boot</span></h3>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">Enable</a> the daemon with <code>ntpd.service</code>. See also <a href="#Running_in_a_chroot">#Running in a chroot</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The systemd command <i>timedatectl</i> can only be used to control <a href="../en/Systemd-timesyncd.html" title="Systemd-timesyncd">systemd-timesyncd</a>. Executing <code>timedatectl set-ntp 1</code> as root will inadvertedly stop a running <code>ntpd.service</code>.<a rel="nofollow" class="external autonumber" href="https://lists.freedesktop.org/archives/systemd-devel/2015-April/030277.html">[1]</a>
</div>
<p>Use <i>ntpq</i> to see the list of configured peers and status of synchronization:
</p>
<pre>$ ntpq -p
</pre>
<p>The delay, offset and jitter columns should be non-zero. The servers <i>ntpd</i> is synchronizing with are prefixed by an asterisk. It can take several minutes before <i>ntpd</i> selects a server to synchronize with; try checking after 17 minutes (1024 seconds).
</p>
<h3><span class="mw-headline" id="Synchronize_time_once_per_boot">Synchronize time once per boot</span></h3>
<p>Alternatively, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>ntpdate.service</code> to synchronize time once (option <code>-q</code>) and non-forking (option <code>-n</code>) per boot, instead of running the daemon in the background. This method is discouraged on servers, and in general on machines that run without rebooting for more than a few days.
</p>
<p>If the synchronized time should be written to the hardware clock as well, configure the provided unit as described in <a href="../en/Systemd.html#Editing_provided_units" title="Systemd">systemd#Editing provided units</a> before starting it:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/ntpdate.service.d/hwclock.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=/usr/bin/hwclock -w</pre>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Start_ntpd_on_network_connection">Start ntpd on network connection</span></h3>
<p><i>ntpd</i> can be started by your network manager, so that the daemon only runs when the computer is online.
</p>
<h4><span class="mw-headline" id="Netctl">Netctl</span></h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> add <code>-u</code> and optionally refer to <a href="#Usage">#Usage</a>, or use systemctl if possible (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Network_Time_Protocol_daemon.html">Talk:Network Time Protocol daemon</a>)</div>
</div>
<p>Append the following lines to your <a href="../en/Netctl.html" title="Netctl">netctl</a> profile:
</p>
<pre>ExecUpPost='/usr/bin/ntpd || true'
ExecDownPre='killall ntpd || true'
</pre>
<h4><span class="mw-headline" id="NetworkManager">NetworkManager</span></h4>
<p>The <i>ntpd</i> daemon can be brought up/down along with a network connection through the use of NetworkManager's <a href="../en/NetworkManager.html#Network_services_with_NetworkManager_dispatcher" title="NetworkManager">dispatcher</a> scripts. The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/networkmanager-dispatcher-ntpd/">networkmanager-dispatcher-ntpd</a></span><sup><small>AUR</small></sup> package installs one, pre-configured to start and stop the <a href="#Start_ntpd_at_boot">ntpd service</a> with a connection.
</p>
<h4><span class="mw-headline" id="KDE">KDE</span></h4>
<p>KDE can use NTP (ntp must be installed) by right clicking the clock and selecting <i>Adjust date/time</i>. However, this requires the ntp daemon to be <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Disable">disabled</a> before configuring KDE to use NTP. <a rel="nofollow" class="external autonumber" href="https://bugs.kde.org/show_bug.cgi?id=178968">[2]</a>
</p>
<h3><span class="mw-headline" id="Using_ntpd_with_GPS">Using ntpd with GPS</span></h3>
<p>Most of the articles online about configuring <i>ntpd</i> to receive time from a GPS suggest to use the SHM (shared memory) method. However, at least since <i>ntpd</i> version 4.2.8, a <i>much better</i> method is available. It connects directly to <i>gpsd</i>, so <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gpsd">gpsd</a></span> needs to be installed.
</p>
<p>Add these lines to your <code>/etc/ntp.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ntp.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#=========================================================
#  GPSD native ntpd driver
#=========================================================
# This driver exists from at least ntp version 4.2.8
# Details at
#   <a rel="nofollow" class="external free" href="https://www.eecis.udel.edu/~mills/ntp/html/drivers/driver46.html">https://www.eecis.udel.edu/~mills/ntp/html/drivers/driver46.html</a>
server 127.127.46.0 
fudge 127.127.46.0 time1 0.0 time2 0.0 refid GPS</pre>
<p>This will work as long as you have <i>gpsd</i> working. It connects to <i>gpsd</i> via the local socket and queries the "gpsd_json" object that is returned.
</p>
<p>To test the setup, first ensure that <i>gpsd</i> is working by running:
</p>
<pre>$ cgps -s 
</pre>
<p>Then wait a few minutes and run <code>ntpq -p</code>. This will show if <i>ntpd</i> is talking to <i>gpsd</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ntpq -p</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">remote           refid            st t when poll reach   delay   offset  jitter
 ==================================================================================
*GPSD_JSON(0)    .GPS.            0 l   55   64  377    0.000    2.556  14.109</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>If the <i>reach</i> column is 0, it means <i>ntpd</i> has not been able to talk to <i>gpsd</i>. Wait a few minutes and try again. Sometimes it takes <i>ntpd</i> a while.</li>
<li>The GPS device must have PPS capabilities. You can test if your device is capable running <code>ppscheck /dev/gps0</code>.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <i>ntpd</i> expects that your GPS device is called e.g. <code>/dev/gps0</code>. If your GPS device is connected via USB, it may appear as <code>/dev/ttyUSB0</code> instead, and you may have to create a symlink <code>ln -s /dev/ttyUSB0 /dev/gps0</code> and run <i>gpsd</i> on that linked <code>/dev/gps0</code> so that the <code>GPSD_JSON</code> line appears as expected. <i>gpsd</i> should be run with the <code>-n</code> flag on the <code>GPSD_OPTIONS</code> line and use <code>/dev/gps0</code> on the <code>DEVICES</code> line in the <code>/etc/default/gpsd</code> config file.</div>
<h3><span class="mw-headline" id="Running_in_a_chroot">Running in a chroot</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <i>ntpd</i> should be started as non-root (default in the Arch Linux package) before attempting to jail it in a chroot, since chroots are relatively useless at securing processes running as root.</div>
<p>Create a new directory <code>/etc/systemd/system/ntpd.service.d/</code> if it does not exist and a file named <code>customexec.conf</code> inside with the following content:
</p>
<pre>[Service]
ExecStart=
ExecStart=/usr/bin/ntpd -g -u ntp:ntp <b>-i /var/lib/ntp</b>
</pre>
<p>Then, edit <code>/etc/ntp.conf</code> to change the driftfile path such that it is relative to the chroot directory, rather than to the real system root. Change:
</p>
<pre>driftfile       /var/lib/ntp/ntp.drift
</pre>
<p>to
</p>
<pre>driftfile       /ntp.drift
</pre>
<p>Create a suitable chroot environment so that getaddrinfo() will work by creating pertinent directories and files (as root):
</p>
<pre># mkdir /var/lib/ntp/etc /var/lib/ntp/lib /var/lib/ntp/proc
# mkdir /var/lib/ntp/usr /var/lib/ntp/usr/lib
# touch /var/lib/ntp/etc/resolv.conf /var/lib/ntp/etc/services
</pre>
<p>and by bind-mounting the aformentioned files:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
#ntpd chroot mounts
/etc/resolv.conf  /var/lib/ntp/etc/resolv.conf none bind 0 0
/etc/services	  /var/lib/ntp/etc/services none bind 0 0
/lib		  /var/lib/ntp/lib none bind 0 0
/usr/lib	  /var/lib/ntp/usr/lib none bind 0 0
/proc		  /var/lib/ntp/proc none bind 0 0
</pre>
<pre># mount -a
</pre>
<p>Finally, restart <code>ntpd</code> daemon again. Once it restarted you can verify that the daemon process is chrooted by checking where <code>/proc/{PID}/root</code> symlinks to: 
</p>
<pre># ps -C ntpd | awk '{print $1}' | sed 1d | while read -r PID; do ls -l /proc/$PID/root; done
</pre>
<p>should now link to <code>/var/lib/ntp</code> instead of <code>/</code>.
</p>
<p>It is relatively difficult to be sure that your driftfile configuration is actually working without waiting a while, as <i>ntpd</i> does not read or write it very often. If you get it wrong, it will log an error; if you get it right, it will update the timestamp. If you do not see any errors about it after a full day of running, and the timestamp is updated, you should be confident of success.
</p>
<h3><span class="mw-headline" id="Restrict_listening_sockets">Restrict listening sockets</span></h3>
<p>You can limit sockets <i>ntpd</i> is listening to using the <i>interface</i> option:
</p>
<pre>interface [listen | ignore | drop] [all | ipv4 | ipv6 | wildcard | name | address[/prefixlen]]
</pre>
<p>like
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ntp.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">interface listen lo
interface listen enp3s0
interface ignore enp5s0</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external free" href="https://www.ntp.org/">https://www.ntp.org/</a></li>
<li><a rel="nofollow" class="external free" href="https://support.ntp.org/">https://support.ntp.org/</a></li>
<li><a rel="nofollow" class="external free" href="https://www.pool.ntp.org/">https://www.pool.ntp.org/</a></li>
<li><a rel="nofollow" class="external free" href="https://www.eecis.udel.edu/~mills/ntp/html/index.html">https://www.eecis.udel.edu/~mills/ntp/html/index.html</a></li>
<li><a rel="nofollow" class="external free" href="https://www.akadia.com/services/ntp_synchronize.html">https://www.akadia.com/services/ntp_synchronize.html</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Network_Time_Protocol.html" title="Category:Network Time Protocol">Network Time Protocol</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Network_Time_Protocol_daemon&amp;oldid=807197">https://wiki.archlinux.org/index.php?title=Network_Time_Protocol_daemon&amp;oldid=807197</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 1 May 2024, at 07:04.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
