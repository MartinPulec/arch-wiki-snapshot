<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>NFS/Kerberos - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-NFS_Kerberos rootpage-NFS skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Prerequisites" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Prerequisites">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Prerequisites</div>
		</a>
		
		<ul id="toc-Prerequisites-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Server_configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Server_configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Server configuration</div>
		</a>
		
		<ul id="toc-Server_configuration-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Client_configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Client_configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Client configuration</div>
		</a>
		
		<ul id="toc-Client_configuration-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">NFS/Kerberos</span></h1>
				</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <a href="../../en/NFS.html" title="NFS">NFS</a>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p>Kerberos is one of the few security mechanisms available for NFS. It provides strong per-user authentication, strong data encryption, and (with NFSv4) removes the requirement for matching UIDs/GIDs between client and server.
</p>
<p>NFSv4 is recommended for Kerberos. Although it is possible to enable Kerberos in NFSv3, it will not provide 100% coverage as the auxiliary NFSv3 protocols (e.g. the "mount" protocol) remain insecure, and the lack of idmapping in NFSv3 severely reduces the usability of Kerberos as well.
</p>
<h2><span class="mw-headline" id="Prerequisites">Prerequisites</span></h2>
<p>Kerberos requires a <b>KDC</b> (Key Distribution Center) service to be running somewhere. The <code>krb5-kdc.service</code> that comes with MIT Kerberos (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=krb5">krb5</a></span>) is a good option for small setups that do not warrant the complexity of Active Directory or FreeIPA. The second option is Heimdal, found on some BSDs and as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/heimdal/">heimdal</a></span><sup><small>AUR</small></sup> on Arch.
</p>
<p>NFSv4 <b>idmapping</b> becomes much more important to have with Kerberos. Both the server and the clients should have the same idmapping domain configured: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/idmapd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[General]
Domain = example.com</pre>
<h2><span class="mw-headline" id="Server_configuration">Server configuration</span></h2>
<p>Each NFS server needs a Kerberos principal for <code>nfs/<i>server.fqdn</i></code> to be created on the KDC, and its keys added to the server's <code>/etc/krb5.keytab</code>. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Why? (Discuss in <a rel="nofollow" class="external text" href="../../en/Talk:NFS/Kerberos.html">Talk:NFS/Kerberos</a>)</div>
</div>
<p>It is recommended to <i>also</i> have the standard <code>host/</code> principal there as well, for other purposes.
</p>
</div>
<pre>fileserv# kadmin -p frob/admin
Password for frob/admin@EXAMPLE.COM: *********
kadmin:  addprinc -nokey nfs/fs.example.com
kadmin:  ktadd nfs/fs.example.com
</pre>
<p><code>gssproxy.service</code> must be <a href="../../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enabled</a> and <a href="../../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">started</a> on the server. 
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Earlier systems used <code>rpc.svcgssd</code>, but it is no longer present in modern nfs-utils and has been fully superseded by gssproxy.</div>
<p>gssproxy comes pre-configured with NFS server support (the <code>/etc/gssproxy/24-nfs-server.conf</code> file is part of the standard package) and does not need any tweaking, other than placing the NFS service keytab in the standard location.
</p>
<p>Your <code>/etc/exports</code> should offer the Kerberos authentication flavors in the <code>sec=</code> option:
</p>
<pre>/home    *(rw,sec=krb5p)
/usr     10.147.0.0/16(rw,sec=krb5p:krb5i:krb5:sys) *(rw,sec=krb5p)
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Do not use the obsolete <code>gss/krb5p(...)</code> syntax. It still works, but you should not be using it anymore.</div>
<p>The available flavors are:
</p>
<ul>
<li>
<code>krb5p</code> provides 'privacy' (Kerberos-based encryption). It is sufficiently secure to be used over Internet, but might provide poor throughput over a LAN – consider using <code>krb5</code> inside RPC-with-TLS instead.</li>
<li>
<code>krb5i</code> provides 'integrity' (Kerberos-based MAC) but <i>not</i> encryption. It might be useful for serving static data as it still protects against packet tampering.</li>
<li>
<code>krb5</code> provides <i>only</i> authentication, without data integrity or encryption. It is a good choice if you have RPC-over-TLS enabled via <code>xprtsec=</code> <i>or</i> if Kerberos is being run over an otherwise "secure" LAN (e.g. over a WireGuard tunnel), but certainly not in the clear over public networks.</li>
<li>
<code>sys</code> is the traditional UID-based (non-Kerberos) NFS security mode.</li>
</ul>
<h2><span class="mw-headline" id="Client_configuration">Client configuration</span></h2>
<p>In addition to users, each NFS client should have a <i>machine</i> Kerberos principal in <code>/etc/krb5.keytab</code>, which will be used in situations where user Kerberos tickets are not yet available – in particular, it will be needed to actually mount the filesystem at boot time before any users have logged in yet (or if mounting is done via autofs). More generally, all operations done "as root" will be authenticated as the machine principal.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The machine identity is also mandatory for some internal NFS operations if NFSv4.0 or NFSv4.1 are used, although no longer mandatory in NFSv4.2.</div>
<p>Unlike in the server case, the client machine does not need an <code>nfs/</code> principal specifically – it is enough to have the generic <code>host/<i>the.fqdn</i></code> principal. (See the rpc.gssd manual page for what it looks for.)
</p>
<p>The client must have <code>rpc-gssd.service</code> active (i.e. the <code>rpc.gssd</code> daemon).
</p>
<p>Options used when mounting the filesystems are very similar to the options used in <code>/etc/exports</code>; you can specify one or more flavors using the <code>sec=</code> option. Although the client will automatically use the strongest mode offered, it is nevertheless recommended to explicitly require e.g. <code>sec=krb5p</code> to prevent downgrade attacks.
</p>
<p>Once the filesystem has been mounted, root may already access it (using the machine's Kerberos credentials), but <b>every</b> non-root user needs their own Kerberos tickets to be present. This means either having the user manually run <code>kinit</code> for themselves, or setting up <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pam-krb5">pam-krb5</a></span> to acquire tickets during login (which only works for password-based logins), or using <code>gssproxy</code> or <span class="plainlinks archwiki-template-man" title="$ man 1 k5start"><a rel="nofollow" class="external text" href="https://manned.org/k5start.1">k5start(1)</a></span> (from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/kstart/">kstart</a></span><sup><small>AUR</small></sup>) to acquire tickets from a keytab file. 
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> You will likely need to set up k5start to <i>renew</i> tickets as they expire a few hours after being acquired.</div>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../en/Category:Network_sharing.html" title="Category:Network sharing">Network sharing</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=NFS/Kerberos&amp;oldid=804337">https://wiki.archlinux.org/index.php?title=NFS/Kerberos&amp;oldid=804337</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 23 March 2024, at 12:29.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
