<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>JFS - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.43.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-JFS rootpage-JFS skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Background" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Background">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Background</span>
			</div>
		</a>
		
			<button aria-controls="toc-Background-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Background subsection</span>
			</button>
		
		<ul id="toc-Background-sublist" class="vector-toc-list">
			<li id="toc-GNU/Linux_development_team" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#GNU/Linux_development_team">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.1</span>
					<span>GNU/Linux development team</span>
				</div>
			</a>
			
			<ul id="toc-GNU/Linux_development_team-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Technical_features" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Technical_features">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.2</span>
					<span>Technical features</span>
				</div>
			</a>
			
			<ul id="toc-Technical_features-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Installation</span>
			</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Optimizations" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Optimizations">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Optimizations</span>
			</div>
		</a>
		
			<button aria-controls="toc-Optimizations-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Optimizations subsection</span>
			</button>
		
		<ul id="toc-Optimizations-sublist" class="vector-toc-list">
			<li id="toc-Defragmenting_JFS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Defragmenting_JFS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>Defragmenting JFS</span>
				</div>
			</a>
			
			<ul id="toc-Defragmenting_JFS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Deadline_I/O_scheduler" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Deadline_I/O_scheduler">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>Deadline I/O scheduler</span>
				</div>
			</a>
			
			<ul id="toc-Deadline_I/O_scheduler-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-External_journal" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#External_journal">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3</span>
					<span>External journal</span>
				</div>
			</a>
			
			<ul id="toc-External_journal-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-noatime_fstab_attribute" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#noatime_fstab_attribute">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.4</span>
					<span>noatime fstab attribute</span>
				</div>
			</a>
			
			<ul id="toc-noatime_fstab_attribute-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Journal_modes" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Journal_modes">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.5</span>
					<span>Journal modes</span>
				</div>
			</a>
			
			<ul id="toc-Journal_modes-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Variable_block_sizes" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Variable_block_sizes">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.6</span>
					<span>Variable block sizes</span>
				</div>
			</a>
			
			<ul id="toc-Variable_block_sizes-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-fsck_and_recovery" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#fsck_and_recovery">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>fsck and recovery</span>
			</div>
		</a>
		
		<ul id="toc-fsck_and_recovery-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Cautionary_notes" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Cautionary_notes">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Cautionary notes</span>
			</div>
		</a>
		
			<button aria-controls="toc-Cautionary_notes-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Cautionary notes subsection</span>
			</button>
		
		<ul id="toc-Cautionary_notes-sublist" class="vector-toc-list">
			<li id="toc-JFS_root_mounts_read_only_on_startup" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#JFS_root_mounts_read_only_on_startup">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>JFS root mounts read only on startup</span>
				</div>
			</a>
			
			<ul id="toc-JFS_root_mounts_read_only_on_startup-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-JFS_and_secure_deletions" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#JFS_and_secure_deletions">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2</span>
					<span>JFS and secure deletions</span>
				</div>
			</a>
			
			<ul id="toc-JFS_and_secure_deletions-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Forced_fsck_on_JFS_root_file_system" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Forced_fsck_on_JFS_root_file_system">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.3</span>
					<span>Forced fsck on JFS root file system</span>
				</div>
			</a>
			
			<ul id="toc-Forced_fsck_on_JFS_root_file_system-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-JFS_losing_files" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#JFS_losing_files">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.4</span>
					<span>JFS losing files</span>
				</div>
			</a>
			
			<ul id="toc-JFS_losing_files-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Benchmarks" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Benchmarks">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Benchmarks</span>
			</div>
		</a>
		
		<ul id="toc-Benchmarks-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Conclusions" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Conclusions">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">7</span>
				<span>Conclusions</span>
			</div>
		</a>
		
		<ul id="toc-Conclusions-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">8</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">JFS</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/JFS" title="JFS – 日本語" lang="ja" hreflang="ja" data-title="JFS" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/File_systems.html" title="File systems">File systems</a></li>
</ul>
</div>
<p>The <a href="https://en.wikipedia.org/wiki/Journaled_File_System" class="extiw" title="w:Journaled File System">Journaled File System</a> (JFS) is a <a href="https://en.wikipedia.org/wiki/journaling_file_system" class="extiw" title="w:journaling file system">journaling file system</a> that was open-sourced by IBM in 1999 and support for which has been available in the Linux kernel since 2002. 
</p>
<p>This article introduces the reader to the JFS file system. In particular, procedures for implementation, maintenance and optimization will be presented along with background information on the file system itself and some cautionary notes on precarious implementations.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Background">Background</span></h2>
<ul>
<li>In 1990, JFS1, (then simply called JFS), was released for AIX version 3.1. The filesystem was closely tied to its targeted hardware, IBM's AIX line of UNIX servers, being a proprietary design.</li>
<li>In 1995, heavy development began on improving JFS, focusing on scalability and expanded features.</li>
<li>In 1997, parallel development began on moving the improved JFS source back to AIX.</li>
<li>In 1999, the improved JFS design was released for OS/2.</li>
<li>In 2001, the improved filesystem (newly termed JFS2), was released for AIX 5L.</li>
<li>The current GNU/Linux version is a port based on JFS for OS/2.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> While there are potential issues, JFS file systems for OS/2 and GNU/Linux are inter-operable.<a rel="nofollow" class="external autonumber" href="http://72.14.253.104/search?q=cache:xrFItCW2XdUJ:osdir.com/ml/file-systems.jfs.general/2006-02/msg00008.html+jfs+os/2+linux&amp;hl=en&amp;ct=clnk&amp;cd=1&amp;gl=au&amp;client=firefox-a">[1]</a>.</div>
<p>While it is difficult to make general comparisons between JFS and other file systems available on UNIX and UNIX-like operating systems, it is claimed that JFS uses less CPU resources than other GNU/Linux file systems <a rel="nofollow" class="external autonumber" href="https://www.debian-administration.org/articles/388">[2]</a>. With certain optimizations, JFS has also been claimed to be faster for certain file operations, as compared to other GNU/Linux file systems (see <a rel="nofollow" class="external autonumber" href="https://www.redhat.com/archives/ext3-users/2005-July/msg00018.html">[3]</a>,<a href="#Benchmarks">Benchmarks</a>).
</p>
<h3>
<span id="GNU.2FLinux_development_team"></span><span class="mw-headline" id="GNU/Linux_development_team">GNU/Linux development team</span>
</h3>
<p>The development of the GNU/Linux JFS port is headed by
</p>
<ul>
<li>Dave Kleikamp (dave dot kleikamp at oracle dot com)</li>
<li>HP: <a rel="nofollow" class="external free" href="https://jfs.sourceforge.net/">https://jfs.sourceforge.net/</a>
</li>
</ul>
<h3><span class="mw-headline" id="Technical_features">Technical features</span></h3>
<p>JFS is a modern file system supporting many features, a few of which are listed here.
</p>
<ul>
<li>fully 64-bit.</li>
<li>dynamic space allocation for i-nodes, i.e. no running out of i-nodes on file systems with large number of small files.</li>
<li>Directory structures designed for speed and efficiency:
<ul>
<li>directories with eight or fewer entries have their contents storied inline within that directory's i-node.</li>
<li>directories with more than eight entries have their contents stored in a <a href="https://en.wikipedia.org/wiki/B%2B_tree" class="extiw" title="wikipedia:B+ tree">B+ tree</a> keyed on name.</li>
</ul>
</li>
<li>JFS utilizes extents for allocating blocks for large files.</li>
<li>Support for extended attributes in addition to standard Unix-style permissions.</li>
<li>Support for both internal and external logs (<a href="#External_journal">see below</a>).</li>
<li>Extremely Scalable; Consistent performance from minimum file size up to 4 petabytes.</li>
<li>Algorithms designed for high performance on very large systems.</li>
<li>Performance tuned for GNU/Linux.</li>
<li>Designed from the ground up to provide Transaction/Log (not an add-on).</li>
<li>Restarts after a system failure &lt; 1 sec.</li>
<li>Proven Journaling FS technology (10+ years in AIX).</li>
<li>Original design goals: Performance, Robustness, SMP.</li>
<li>Team members from the original AIX JFS Designed/Developed this file system.</li>
<li>Designed to operate on SMP hardware, with code optimized for at least a 4-way SMP machine.</li>
<li>TRIM support (since Kernel 3.7).</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> JFS uses a journal to maintain consistency of metadata <i>only</i>. Thus, only consistency of metadata (and not actual file contents) can be assured in the case of improper shutdown. This is also the case for XFS and ReiserFS. Ext3, on the other hand, does support journaling of <i>both</i> metadata and data <a rel="nofollow" class="external autonumber" href="http://www.thehackademy.net/madchat/ebooks/FileSystem/up2-6Galli.pdf">[4]</a>, though with a significant performance penalty, and not by default.</div>
<p>A more comprehensive (and technical) overview of the features in JFS can be found in the <a rel="nofollow" class="external text" href="https://jfs.sourceforge.net/project/pub/jfs.pdf">JFS Overview</a> authored by developer Steve Best.
</p>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>The JFS driver is built as a module in the standard Arch kernel packages. 
</p>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=jfsutils">jfsutils</a></span> package must be <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">installed</a> to perform all file system related tasks.
</p>
<p>Creation of a JFS file system can be done with the either:
</p>
<pre># mkfs.jfs /dev/target_dev
</pre>
<p>or:
</p>
<pre># jfs_mkfs /dev/target_dev
</pre>
<p>Both commands are equivalent.
</p>
<h2><span class="mw-headline" id="Optimizations">Optimizations</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> BFQ seems to work much better under load in 2021 (Discuss in <a href="../en/Talk:JFS.html#JFS_Performance" title="Talk:JFS">Talk:JFS#JFS Performance</a>)</div>
</div>
<p>There are several concepts that can be implemented with a JFS filesystem to boost its performance:
</p>
<ul>
<li>Periodic defragmentation of the file system.</li>
<li>Using the deadline I/O scheduler.</li>
<li>Utilizing an external journal.</li>
</ul>
<h3><span class="mw-headline" id="Defragmenting_JFS">Defragmenting JFS</span></h3>
<p>JFS, like all file systems, will degrade in performance over time due to file fragmentation <a rel="nofollow" class="external autonumber" href="https://web.archive.org/web/20090205150843/http://docs.hp.com/en/5576/JFS_Tuning.pdf">[5]</a>. While there is in-place defragmentation code in the JFS utilities, this is code held over from the OS/2 port and has yet to be implemented <a rel="nofollow" class="external autonumber" href="https://www.mail-archive.com/jfs-discussion@lists.sourceforge.net/msg00573.html">[6]</a>. For file systems that can be taken off-line for a time, one can execute a script like the following to defragment their JFS file system
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> This script is <b>dangerous</b> and may result in the wiping of an entire hard disk, if arguments get switched! Doing this type of operation is only recommended for people who have confidence in doing backups and file system operations.</div>
<pre>umount /dev/hdc1
dd bs=4k if=/dev/hdc1 of=/dev/hdj1
jfs_fsck /dev/hdj1
mount -o ro /dev/hdj1 /fs/hdj1
jfs_mkfs /dev/hdc1
mount -o rw /dev/hdc1 /fs/hdc1
(cd /fs/hdj1 &amp;&amp; tar -cS -b8 --one-file-system -f - .) | (cd /fs/hdc1 &amp;&amp; tar -xS -b8 -p -f -)
umount /dev/hdj1
</pre>
<p>In this example, <code>/dev/hdc1</code> is the device with the data that needs backing up and <code>/dev/hdj1</code> is the device that holds the backup. 
</p>
<p>Basically, this script copies the data off the JFS file system to a backup drive, formats the original JFS file system and finally writes back the data from the backup to the freshly formatted drive in a way that JFS will write its allocation trees in a defragmentated way.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If a VMWare session is sitting on an underlying JFS partition that is highly fragmented, performance of the virtual machine may be significantly degraded.</div>
<h3>
<span id="Deadline_I.2FO_scheduler"></span><span class="mw-headline" id="Deadline_I/O_scheduler">Deadline I/O scheduler</span>
</h3>
<p>JFS seems to perform better when the kernel has been configured to use the <a href="../en/Improving_performance.html#Input/output_schedulers" title="Improving performance">Deadline I/O Scheduler</a>. Indeed, JFS's performance seems to exceed that of other GNU/Linux file systems with this particular scheduler being employed <a rel="nofollow" class="external autonumber" href="https://www.redhat.com/archives/ext3-users/2005-July/msg00018.html">[7]</a>.
</p>
<h3><span class="mw-headline" id="External_journal">External journal</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> As this is a relatively new feature to the GNU/Linux port of JFS, it is recommended to upgrade to the very latest version of jfsutils before attempting to implement an external journal (earlier versions seem to give errors when trying to create the journal device).</div>
<p>As with any journaled file system, a journal is constantly accessed in accordance with disk activity. Having the journal log on the same device as the its corresponding file system thus can cause a degradation in I/O throughput. This degradation can be alleviated by putting the journal log on a separate device all together. 
</p>
<p>To make a journal device, first create a partition that is 128MB. Using a partition that is bigger than 128MB results in the excess being ignored, according to mkfs.jfs. You can either create an external log for an already-existing JFS file system by executing the following:
</p>
<pre># mkfs.jfs -J journal_dev /dev/external_journal             # creates a journal on device /dev/external_journal
# mkfs.jfs -J device=/dev/external_journal /dev/jfs_device  # attaches the external journal to the existing file 
                                                          #   system on /dev/jfs_device
</pre>
<p>or a command can be issued to create both a new external journal and its corresponding JFS file system:
</p>
<pre># mkfs.jfs -j /dev/external_journal /dev/jfs_device
</pre>
<p>This last command formats BOTH the external journal and the JFS file system.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Obviously, an external journal is only effective if the journal and its file system exists on separate <i>physical</i> devices.</div>
<h3><span class="mw-headline" id="noatime_fstab_attribute">noatime fstab attribute</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> Duplicates <a href="../en/Fstab.html#atime_options" title="Fstab">fstab#atime options</a>. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:JFS.html">Talk:JFS</a>)</div>
</div>
<p>Every time a file is accessed (read or write) the default for most file systems is to append the metadata associated with that file with an updated access time. Thus, even read operations incur an overhead associated with a write to the file system. This can lead to a significant degradation in performance in some usage scenarios. Appending <i>noatime</i> to the fstab line for a JFS file system stops this action from happening. As access time is of little importance in most scenarios, this alteration has been widely touted as a fast and easy way to get a performance boost out of one's hardware. Even Linus Torvalds seems to be a proponent of this optimization <a rel="nofollow" class="external autonumber" href="https://web.archive.org/web/20130509184416/http://kerneltrap.org/node/14148">[8]</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>One may also specify a <b>relatime</b> option which updates the atime if the previous atime is older than the mtime or ctime <a rel="nofollow" class="external autonumber" href="https://web.archive.org/web/20130509184416/http://kerneltrap.org/node/14148">[9]</a>. In terms of performance, this will not be as fast as the <i>noatime</i> mount option, but is useful if using applications that need to know when files were last read (like <i>mutt</i>).</li>
<li>Using the <i>noatime/relatime</i> option can improve disk performance with any file system, not just JFS.</li>
</ul>
</div>
<p>Here is an example <code>/etc/fstab</code> entry with the <b>noatime</b> tag:
</p>
<pre>/dev/sdb1 /media/backup jfs rw,users,noauto,noatime 0  0
</pre>
<p>One may also mount a file system with the <b>noatime</b> attribute by invoking something similar to the following:
</p>
<pre># mount -o noatime -t jfs /dev/jfs_dev /mnt/jfs_fs
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Access time is NOT the same as the <i>last-modified</i> time. Disabling access time will still enable you to see when files were last modified by a write operation.</div>
<h3><span class="mw-headline" id="Journal_modes">Journal modes</span></h3>
<p>JFS does not support various journal modes like <a href="../en/Ext3.html" title="Ext3">ext3</a>. Thus, passing the mount option <i>data=writeback</i> with <i>mount</i> or in <code>/etc/fstab</code> will have no effect on a JFS file system. JFS's current journaling mode is similar to Ext3's default journaling mode: <i>ordered</i> <a rel="nofollow" class="external autonumber" href="https://www.ibm.com/developerworks/linux/linux390/perf/tuning_res_journaling.html">[10]</a>.
</p>
<h3><span class="mw-headline" id="Variable_block_sizes">Variable block sizes</span></h3>
<p>While the OS/2 port of JFS supports block sizes of 512, 1024, 2048, and 4096 bytes, the Linux port of JFS is only able to use 4k blocks. Even though code exists in JFS utilities that correspond to file systems using variable size blocks, this has yet to be implemented <a rel="nofollow" class="external autonumber" href="https://archive.today/2013.06.19-023417/http://osdir.com/ml/file-systems.jfs.general/2003-02/msg00017.html">[11]</a>. As larger block sizes tend to favor performance (smaller ones favor efficient space usage), implementing smaller block sizes for JFS in Linux has been given a low priority for implementation by JFS developers.
</p>
<h2><span class="mw-headline" id="fsck_and_recovery">fsck and recovery</span></h2>
<p>In the event that the file system does not get properly unmounted before being powered down, one will usually have to run <b>fsck</b> on a JFS file system in order to be able to remount it. This procedure usually only takes a few seconds, unless the log has been damaged. If running fsck returns an unrecognized file system error, try running <b>fsck.jfs</b> on the target device. Normally, <i>fsck</i> is all that is needed.
</p>
<h2><span class="mw-headline" id="Cautionary_notes">Cautionary notes</span></h2>
<p>While JFS is very stable in its current stage of development, there are some cautionary notes on using this file system.
</p>
<h3><span class="mw-headline" id="JFS_root_mounts_read_only_on_startup">JFS root mounts read only on startup</span></h3>
<p>Occasionally, a JFS root partition will be unable to mount in normal read-write mode. This is usually due to the fact that the JFS root file system fails its fsck after an unclean shutdown. It is rare that JFS fails out of fsck, and it is usually due to the JFS log itself being corrupted.
</p>
<p>All that is required in this scenario is to boot your machine with a relatively recent Arch Linux LiveCD. Booting an Arch Linux livecd will give you access to all the JFS utilities and will load a kernel that is able to recognize JFS file systems. After booting the CD simply run <i>fsck</i> (or possibly <i>fsck.jfs</i>) on your JFS root and it should recover just fine (even though the fsck will probably take longer than normal due to the log probably being damaged). Once the <i>fsck</i> finishes, you should be able to boot your machine like normal.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This scenario happens less than 10% of the time in the case of an improper shutdown.</div>
<h3><span class="mw-headline" id="JFS_and_secure_deletions">JFS and secure deletions</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This section applies to any journaled file system, not just JFS.</div>
<p>The effectiveness of deleting files by overwriting their corresponding file system blocks with random data (i.e. using utilities like <i>shred</i>) can not be assured <a rel="nofollow" class="external autonumber" href="https://lists.kde.org/?l=kfm-devel&amp;m=105770965822522&amp;w=2">[12]</a>. Given the design of journaled file systems, maintenance issues, and performance liabilities; reliable shredding of files as a deletion method does not sit highly on the priority list for implementation on any journaled file system.
</p>
<h3><span class="mw-headline" id="Forced_fsck_on_JFS_root_file_system">Forced fsck on JFS root file system</span></h3>
<p>One may force a <i>fsck</i> (<i>f</i>ile <i>s</i>ystem che<i>ck</i>) on the root file system by entering:
</p>
<pre># touch /forcefsck
</pre>
<p>and rebooting. On Arch linux systems with a JFS root on a partition under control of <i>device-mapper</i> (i.e. the root device is a <i>lvm</i> or a LUKS encrypted one), forcing an <i>fsck</i> can sometimes remove the <code>/usr/man/man3/</code> directory. The reason for this issue is not clear, but the problem has been replicated <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=41261">[13]</a>. 
</p>
<p>It is suggested to get a list of Arch Packages that use <code>/usr/man/man3/</code> by issuing a command similar to
</p>
<pre># find /var/lib/pacman/local/ -name files | xargs grep -F "/man/man3/" | cut -d: -f1 | sort -u | awk -F/ '{print $6}' &gt; man3_pkg_list
</pre>
<p>before attempting a forced <i>fsck</i> on a JFS root partition <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?pid=309319#p309319">[14]</a>. If <code>/usr/man/man3</code> does indeed disappear, simply reinstall all the packages listed in <i>man3_pkg_list</i>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If this problem does indeed happen, reinstalling all the packages using <code>/usr/man/man3/</code> does appear to fix the issue <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?pid=309585#p309585">[15]</a>.</div>
<p>As stated above, the reason for this issue is not clear at the moment; but it may have something to do with the fact that a forced <i>fsck</i> runs through higher phases of file system checks that only happen when a JFS log gets damaged in an improper dismounting of the partition.
</p>
<h3><span class="mw-headline" id="JFS_losing_files">JFS losing files</span></h3>
<p>In JFS; journal writes are indefinitely postponed until there is another trigger such as memory pressure or an unmount operation. This infinite write delay limits reliability, as a crash can result in data loss even for data that was written minutes or hours before.<a rel="nofollow" class="external autonumber" href="https://www.usenix.org/events/usenix05/tech/general/full_papers/prabhakaran/prabhakaran.pdf">[16]</a>
</p>
<h2><span class="mw-headline" id="Benchmarks">Benchmarks</span></h2>
<p>As benchmarks measuring file system performance tend to be focused at specific types of disk usage, it is difficult to decipher good general comparisons rating how well JFS performs against other files systems. As mentioned before, it has been noted that JFS has a tendency to use less CPU resources than other GNU/Linux file systems and (with the right optimizations) is faster than other GNU/Linux file systems for certain types of file operations. It has been noted that JFS slows down when working with many files, however<a rel="nofollow" class="external autonumber" href="https://web.archive.org/web/20190627163218/http://fsbench.netnation.com/">[17]</a><a rel="nofollow" class="external autonumber" href="https://www.debian-administration.org/articles/388">[18]</a>. In the references are some links to benchmarks; but as always, it is best to test and see what works best for your own system and work load.
</p>
<h2><span class="mw-headline" id="Conclusions">Conclusions</span></h2>
<p>JFS is a stable, feature-rich file system that has not been publicized as much as some of the other Linux file systems. With optimizations, JFS is stable, CPU efficient and fast. In particular, VMWare sessions stand to benefit enormously from a properly optimized and defragmented, underlying JFS file system.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li>A more technical <a rel="nofollow" class="external text" href="https://jfs.sourceforge.net/project/pub/jfs.pdf">overview</a> of JFS</li>
<li><a rel="nofollow" class="external text" href="https://www.linux.com/news/30-days-jfs">30 days with JFS</a></li>
<li>JFS <a rel="nofollow" class="external text" href="https://jfs.sourceforge.net/">Sourceforge</a> page</li>
<li>Note on <a rel="nofollow" class="external text" href="http://www.sabi.co.uk/blog/anno06-2nd.html#060422b">defragmenting</a> JFS file systems</li>
<li>JFS Recovery <a rel="nofollow" class="external text" href="https://sourceforge.net/projects/jfsrec">Sourceforge</a> page</li>
<li>
<a rel="nofollow" class="external text" href="https://web.archive.org/web/20040719103341/http://conferences.oreillynet.com/presentations/os2002/best_steve.pdf">Presentation</a> on JFS given by Steve Best (pdf)</li>
<li><a rel="nofollow" class="external text" href="https://www.debian-administration.org/articles/388">Debian file system comparison</a></li>
<li><a href="https://en.wikipedia.org/wiki/JFS_(file_system)" class="extiw" title="wikipedia:JFS (file system)">Wikipedia:JFS (file system)</a></li>
<li>Some <a rel="nofollow" class="external text" href="https://web.archive.org/web/20190627163218/http://fsbench.netnation.com/">filesystem benchmarks</a>
</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:File_systems.html" title="Category:File systems">File systems</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=JFS&amp;oldid=826109">https://wiki.archlinux.org/index.php?title=JFS&amp;oldid=826109</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 30 January 2025, at 02:48.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki.svg" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul></ul>
</div>
</body>
</html>
