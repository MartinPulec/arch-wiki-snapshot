<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>systemd/Sandboxing - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.43.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Systemd_Sandboxing rootpage-Systemd skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-General" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#General">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>General</span>
			</div>
		</a>
		
		<ul id="toc-General-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Capabilities" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Capabilities">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Capabilities</span>
			</div>
		</a>
		
		<ul id="toc-Capabilities-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Common_directives" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Common_directives">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Common directives</span>
			</div>
		</a>
		
			<button aria-controls="toc-Common_directives-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Common directives subsection</span>
			</button>
		
		<ul id="toc-Common_directives-sublist" class="vector-toc-list">
			<li id="toc-Without_special_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Without_special_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>Without special configuration</span>
				</div>
			</a>
			
			<ul id="toc-Without_special_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Configurable_directives" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Configurable_directives">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>Configurable directives</span>
				</div>
			</a>
			
			<ul id="toc-Configurable_directives-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Advanced_directives" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Advanced_directives">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Advanced directives</span>
			</div>
		</a>
		
			<button aria-controls="toc-Advanced_directives-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Advanced directives subsection</span>
			</button>
		
		<ul id="toc-Advanced_directives-sublist" class="vector-toc-list">
			<li id="toc-chroot_jail" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#chroot_jail">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>chroot jail</span>
				</div>
			</a>
			
			<ul id="toc-chroot_jail-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-system.conf" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#system.conf">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>system.conf</span>
			</div>
		</a>
		
			<button aria-controls="toc-system.conf-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle system.conf subsection</span>
			</button>
		
		<ul id="toc-system.conf-sublist" class="vector-toc-list">
			<li id="toc-Disabling_non-native_syscalls" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Disabling_non-native_syscalls">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>Disabling non-native syscalls</span>
				</div>
			</a>
			
			<ul id="toc-Disabling_non-native_syscalls-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enabling_more_unit_statistics" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enabling_more_unit_statistics">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2</span>
					<span>Enabling more unit statistics</span>
				</div>
			</a>
			
			<ul id="toc-Enabling_more_unit_statistics-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">systemd/Sandboxing</h1>
				</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <bdi dir="ltr"><a href="../../en/Systemd.html" title="Systemd">Systemd</a></bdi>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../../en/Firejail.html" title="Firejail">Firejail</a></li>
<li><a href="../../en/AppArmor.html" title="AppArmor">AppArmor</a></li>
<li><a href="../../en/Cgroups.html" title="Cgroups">cgroups</a></li>
</ul>
</div>
<p>systemd enables users to harden and sandbox system service units. Because of technical limitations, and ironically security reasons, user units can not be hardened or sandboxed properly since this would make privilege escalation issues possible. This does not affect system units which use the <code>User=</code> directive.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> <a href="../../en/Firejail.html" title="Firejail">Firejail</a> can sandbox applications run as an unprivileged and explicitly allowed user but uses a SUID binary, which is in theory susceptible to privilege escalation vulnerabilities.</div>
<p>Because of the nature of other unit types, only service units can be hardened/sandboxed in the traditional sense. See <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.exec"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.exec.5">systemd.exec(5)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.resource-control"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.resource-control.5">systemd.resource-control(5)</a></span> for more information.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="General">General</span></h2>
<p>Since hardening/sandboxing effectively restricts an application, it is not possible to use all the sandboxing directives. A web server for example should not use <code>PrivateNetwork=true</code> since it usually needs network access.
</p>
<p><code>systemd-analyze security <i>unit</i></code> generates a score for the unit showing all the used directives, which can be helpful to determine what settings to try next.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The score is slightly misleading. Only a simple <code>Hello world</code> can achieve a near perfect score. No application can use <i>all</i> the sandboxing settings.</div>
<p>Unfortunately, systemd's error messages on misconfiguration relating to sandboxing are sometimes vague and/or misleading. Setting the log level temporarily to <code>debug</code> may help getting actually relevant information.
</p>
<pre># systemctl log-level debug
</pre>
<h2><span class="mw-headline" id="Capabilities">Capabilities</span></h2>
<p><span class="plainlinks archwiki-template-man" title="$ man 7 capabilities"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/capabilities.7">capabilities(7)</a></span> are used to grant a process certain elevated privileges. For example, <code>CAP_NET_BIND_SERVICE</code> can be used so that an otherwise unprivileged process can bind ports below 1024, eliminating the need for it to start with root privileges at all. Another notable example is <code>CAP_DAC_READ_SEARCH</code> to grant a backup program unrestricted read access to all locations.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>It is good practice to <i>always</i> use <code>CapabilityBoundingSet</code> and <code>AmbientCapabilities</code> together.</li>
<li>
<code>systemd-analyze capability</code> provides a list of capabilities which can be used with systemd. This can be useful should you run an experimental kernel which adds capabilities.</li>
</ul>
</div>
<p>In service units, you can accomplish this by using <code>AmbientCapabilities=</code> to grant it capabilities and <code>CapabilityBoundingSet=</code> to ensure nothing beyond the intended scope is granted:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">example.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
AmbientCapabilities=<i>CAP_NET_BIND_SERVICE</i>
CapabilityBoundingSet=<i>CAP_NET_BIND_SERVICE</i></pre>
<h2><span class="mw-headline" id="Common_directives">Common directives</span></h2>
<p>Most of these directives can be applied to most applications without causing too many problems.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> "Impact" and "Potential for breakage" are all <i>relative</i> since they depend on the environment and the unit.</div>
<h3><span class="mw-headline" id="Without_special_configuration">Without special configuration</span></h3>
<p>Simple boolean settings which can either be enabled or not. They can not be configured.
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Directive</th>
<th>Impact<sup>1</sup>
</th>
<th>Breakage<sup>2</sup>
</th>
<th>Notes
</th>
</tr>
<tr>
<td><code>LockPersonality</code></td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td>
</td>
</tr>
<tr>
<td><code>MemoryDenyWriteExecute</code></td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">Medium<sup>3</sup>
</td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td>Incompatible with dynamically generated code at runtime, including JIT, executable stacks, C compiler code "trampoline"
</td>
</tr>
<tr>
<td><code>NoNewPrivileges</code></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">High</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td>
</td>
</tr>
<tr>
<td><code>PrivateDevices</code></td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td>
<code>/dev/null</code> and similar will still be there
</td>
</tr>
<tr>
<td><code>PrivateNetwork</code></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">High</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">Very high</td>
<td>Disallows <i>any</i> network access.
</td>
</tr>
<tr>
<td><code>PrivateTmp</code></td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td>
</td>
</tr>
<tr>
<td><code>PrivateUsers</code></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">High</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">High</td>
<td>
</td>
</tr>
<tr>
<td><code>RestrictRealtime</code></td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td>May prevent denial-of-service situations
</td>
</tr>
<tr>
<td><code>RestrictSUIDSGID</code></td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td>Best used with <code>NoNewPrivileges</code>
</td>
</tr>
</tbody>
</table>
<ol>
<li>How effective the directive is</li>
<li>How likely the directive is to break something</li>
<li>Can be enhanced with <code>SystemCallFilter</code>
</li>
</ol>
<h3><span class="mw-headline" id="Configurable_directives">Configurable directives</span></h3>
<p>Most of these directives are quite powerful and will affect a lot. It is recommended to consider using at least some of them.
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Directive</th>
<th>Value</th>
<th>Impact<sup>1</sup>
</th>
<th>Breakage<sup>2</sup>
</th>
<th>Notes
</th>
</tr>
<tr>
<td rowspan="3"><code>ProtectSystem</code></td>
<td><code>strict</code></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Very high</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">Very high</td>
<td>Usually used with <code>ReadWritePaths=</code>
</td>
</tr>
<tr>
<td><code>full</code></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">High</td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td>May break e.g web servers using <a href="../../en/Transport_Layer_Security.html#ACME_clients" class="mw-redirect" title="ACME">ACME</a> to renew their own keys which <i>may</i> be in <code>/etc</code>
</td>
</tr>
<tr>
<td><code>true</code></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">High</td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td>There are in theory few applications which write to <code>/boot</code> and <code>/usr</code>
</td>
</tr>
<tr>
<td rowspan="3"><code>ProtectHome</code></td>
<td><code>true</code></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">High</td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td>Some applications may need persistent data stored in <code>XDG_CONFIG_HOME</code><sup>3</sup>
</td>
</tr>
<tr>
<td><code>tmpfs</code></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">High</td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td>Home directories contain a lot of sensitive data and using either <code>tmpfs</code> or <code>true</code> may prevent leaks.<sup>4</sup>
</td>
</tr>
<tr>
<td><code>read-only</code></td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td>Ideal for backup services
</td>
</tr>
<tr>
<td rowspan="2">
<code>ProtectProc</code><sup>5</sup>
</td>
<td><code>invisible</code></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">High</td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td>
</td>
</tr>
<tr>
<td><code>noaccess</code></td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td>
</td>
</tr>
<tr>
<td><code>RestrictAddressFamilies</code></td>
<td>e.g <code>AF_UNIX AF_INET AF_INET6</code>
</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td>Takes a space-separated list of address families, <span class="plainlinks archwiki-template-man" title="$ man 7 address_families"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/address_families.7">address_families(7)</a></span>.
</td>
</tr>
</tbody>
</table>
<ol>
<li>How effective the directive is</li>
<li>How likely the directive is to break something</li>
<li>
<code>StateDirectory=</code> can be used to mitigate some of the negative consequences</li>
<li>This also makes <code>/run/user/</code> inaccessible, preventing leakage using IPC sockets. In theory, there may also be sockets elsewhere, e.g <code>/tmp</code>.</li>
<li>Defaults to the <a href="../../en/Security.html#hidepid" class="mw-redirect" title="Hidepid">hidepid</a> value of the <code>/proc</code> mount when directive is omitted, which is usually <code>0</code> (unrestricted)</li>
</ol>
<h2><span class="mw-headline" id="Advanced_directives">Advanced directives</span></h2>
<p>These directives are not useful for most units and are thus used more rarely.
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Directive</th>
<th>Value</th>
<th>Impact</th>
<th>Breakage</th>
<th>Notes
</th>
</tr>
<tr>
<td><code>DynamicUser</code></td>
<td>Boolean, e.g <code>true</code>
</td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td>Needs to be combined with <code>StateDirectory=</code>, <code>RuntimeDirectory=</code>, <code>CacheDirectory=</code>, <code>LogsDirectory=</code> and <code>ConfigurationDirectory=</code>.<a rel="nofollow" class="external autonumber" href="https://0pointer.net/blog/dynamic-users-with-systemd.html">[1]</a>
</td>
</tr>
<tr>
<td>
<code>ProtectClock</code><sup>1</sup>
</td>
<td>Boolean</td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td>Some users reported <code>smartctl</code> can not run when this is set, but this should be relatively safe.
</td>
</tr>
<tr>
<td>
<code>ProtectControlGroups</code><sup>1</sup>
</td>
<td>Boolean</td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td>
</td>
</tr>
<tr>
<td>
<code>ProtectHostname</code><sup>1</sup>
</td>
<td>Boolean</td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td>
</td>
</tr>
<tr>
<td>
<code>ProtectKernelLogs</code><sup>1</sup>
</td>
<td>Boolean</td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td>All official kernels have <code>SECURITY_DMESG_RESTRICT</code> set to <code>y</code>, but this is still defense in depth.
</td>
</tr>
<tr>
<td>
<code>ProtectKernelModules</code><sup>1</sup>
</td>
<td>Boolean</td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td>
</td>
</tr>
<tr>
<td>
<code>ProtectKernelTunables</code><sup>1</sup>
</td>
<td>Boolean</td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td>
</td>
</tr>
<tr>
<td><code>RestrictFileSystems</code></td>
<td>e.g <code>ext4 tmpfs</code>
</td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td>Takes a space-separated list of file systems or a set, e.g <code>@network</code>. See <code>systemd-analyze filesystems</code> for a full list.
</td>
</tr>
<tr>
<td><code>SystemCallArchitectures</code></td>
<td>e.g <code>native</code>
</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Low</td>
<td>See also <a href="#Disabling_non-native_syscalls">#Disabling non-native syscalls</a> - prefer using this to opt out a unit from the system default instead.
</td>
</tr>
<tr>
<td><code>SystemCallFilter</code></td>
<td>e.g <code>@system-service</code>
</td>
<td style="background: #ddd; color: inherit; vertical-align: middle; text-align: center;">Medium</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">High</td>
<td>See <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.exec"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.exec.5#SYSTEM_CALL_FILTERING">systemd.exec(5) § SYSTEM CALL FILTERING</a></span> - forgetting just a single syscall will lead to your application segfaulting at possibly inopportune times.
</td>
</tr>
</tbody>
</table>
<ol><li>Redundant and unnecessary to specify if the service unit does not run with elevated privileges resulting from use of e.g <code>AmbientCapabilities=</code> or running as root. If a service unit is running as another normal and unprivileged <code>User=</code>, these settings are entirely superfluous and can be safely omitted.</li></ol>
<h3><span class="mw-headline" id="chroot_jail">chroot jail</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> While this works in practice, it is partly relying on undocumented side effects of directives and can break at any time with new versions of systemd. For these reasons, it is considered unsupported by the developers of systemd. A feature request has been filed to make this an intended and supported functionality.<a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/33688">[2]</a>
</div>
<p>It is possible to severely restrict what a process can see by specifying <code>TemporaryFileSystem=/:ro</code> and mounting required paths into this chroot-like jail.
<code>RootDirectory</code> requires a directory to be present, whereas <code>TemporaryFileSystem</code> does not and will override <code>/</code> seamlessly. Both, and especially the latter, appear to be secure chroot-like directives, which can not be broken out easily, as they do not use the <code>chroot</code> syscall.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> <code>ProtectSystem</code> and <code>ProtectHome</code> are incompatible with <code>TemporaryFileSystem=/:ro</code> and will cause the latter to be undone, making <code>/</code> visible again. However, these directives are not needed since paths will be whitelisted anyways. See the warning above, this happens because interactions between these directives were never considered/supported.</div>
<p>All required paths must be mounted into this jail via <code>BindReadOnlyPaths</code> and <code>BindPaths</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">example_jailed_unit.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Example unit

[Service]
ExecStart=/home/someuser/executable
User=someuser
Group=someuser
TemporaryFileSystem=/:ro
PrivateTmp=true
BindReadOnlyPaths=/usr/lib /lib64 /lib
BindPaths=/home/someuser/executable</pre>
<p>This is a minimal example and most application will need more paths whitelisted. Some common paths include:
</p>
<ul>
<li>
<code>/etc/ca-certificates</code>, <code>/etc/ssl</code>
</li>
<li><code>/etc/resolv.conf</code></li>
<li><code>/usr/share/zoneinfo</code></li>
<li>Any sockets you need, e.g <code>/var/run/mysqld/mysqld.sock</code>
</li>
</ul>
<p>It will be likely that debugging is at some point necessary when trying to sandbox a unit for the first time. If a unit can not be started at all and fails with <code>status=203/EXEC</code>, either the executable itself or required libraries are not accessible. Starting with broad paths at first (e.g allowing the entirety of <code>/usr</code>) and narrowing it down later can help, too.
</p>
<h2><span class="mw-headline" id="system.conf">system.conf</span></h2>
<p>Changes to <code>/etc/systemd/system.conf</code> are global, so they will affect every unit. See <span class="plainlinks archwiki-template-man" title="$ man 5 systemd-system.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-system.conf.5">systemd-system.conf(5)</a></span>
</p>
<h3><span class="mw-headline" id="Disabling_non-native_syscalls">Disabling non-native syscalls</span></h3>
<p>Non-native binaries, in almost all cases 32-bit binaries, may partially compromise the security of the system because they <a href="../../en/Security.html#Userspace_ASLR_comparison" title="Security">do not have access to more hardening</a>. There have been some relatively minor vulnerabilities, like <a rel="nofollow" class="external text" href="https://www.cvedetails.com/cve/CVE-2009-0835/">CVE-2009-0835</a>, which affected non-native syscalls.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This <b>will</b> break 32-bit binaries. Trying to execute such a binary will result in a file not found error.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">SystemCallArchitectures=native</pre>
<p>This works well on most systems, but it needs to be at least partially disabled if e.g <a href="../../en/Official_repositories.html#multilib" class="mw-redirect" title="Multilib">multilib</a> is in use. Especially gaming with <a href="../../en/Wine.html" title="Wine">Wine</a> may be impacted. Using <code>systemd-run</code> or modifying the session slice to override <code>SystemCallArchitectures</code> can be used to disable restrictions partially.
</p>
<h3><span class="mw-headline" id="Enabling_more_unit_statistics">Enabling more unit statistics</span></h3>
<p>systemd does not track all resource usage of a unit by default. Enable <code>Default*Accounting</code> to get more statistics in the <code>systemctl status</code> output and the journal. This is not strictly a security setting, but it will certainly make debugging easier and can provide useful insights into resource usage.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">DefaultCPUAccounting=yes
DefaultIOAccounting=yes
DefaultIPAccounting=yes
DefaultMemoryAccounting=yes
DefaultTasksAccounting=yes</pre>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../en/Category:Sandboxing.html" title="Category:Sandboxing">Sandboxing</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Systemd/Sandboxing&amp;oldid=830332">https://wiki.archlinux.org/index.php?title=Systemd/Sandboxing&amp;oldid=830332</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 2 April 2025, at 01:05.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki.svg" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul></ul>
</div>
</body>
</html>
