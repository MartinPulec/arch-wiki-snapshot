<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Self-encrypting drives - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.45.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Self-encrypting_drives rootpage-Self-encrypting_drives skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Overview" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Overview">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Overview</span>
			</div>
		</a>
		
			<button aria-controls="toc-Overview-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Overview subsection</span>
			</button>
		
		<ul id="toc-Overview-sublist" class="vector-toc-list">
			<li id="toc-Key_management_technical_implementation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Key_management_technical_implementation">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.1</span>
					<span>Key management technical implementation</span>
				</div>
			</a>
			
			<ul id="toc-Key_management_technical_implementation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Advantages" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Advantages">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.2</span>
					<span>Advantages</span>
				</div>
			</a>
			
			<ul id="toc-Advantages-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Disadvantages" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Disadvantages">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.3</span>
					<span>Disadvantages</span>
				</div>
			</a>
			
			<ul id="toc-Disadvantages-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Linux_support" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Linux_support">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Linux support</span>
			</div>
		</a>
		
		<ul id="toc-Linux_support-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Using_sedutil" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Using_sedutil">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Using sedutil</span>
			</div>
		</a>
		
			<button aria-controls="toc-Using_sedutil-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Using sedutil subsection</span>
			</button>
		
		<ul id="toc-Using_sedutil-sublist" class="vector-toc-list">
			<li id="toc-Encrypting_the_root_(boot)_drive" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Encrypting_the_root_(boot)_drive">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>Encrypting the root (boot) drive</span>
				</div>
			</a>
			
			<ul id="toc-Encrypting_the_root_(boot)_drive-sublist" class="vector-toc-list">
				<li id="toc-Check_if_your_disk_supports_OPAL" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Check_if_your_disk_supports_OPAL">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.1</span>
					<span>Check if your disk supports OPAL</span>
				</div>
			</a>
			
			<ul id="toc-Check_if_your_disk_supports_OPAL-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Download_the_rescue_image_(optional)" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Download_the_rescue_image_(optional)">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.2</span>
					<span>Download the rescue image (optional)</span>
				</div>
			</a>
			
			<ul id="toc-Download_the_rescue_image_(optional)-sublist" class="vector-toc-list">
				<li id="toc-Create_a_bootable_drive" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Create_a_bootable_drive">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.2.1</span>
					<span>Create a bootable drive</span>
				</div>
			</a>
			
			<ul id="toc-Create_a_bootable_drive-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Using_Pre-boot_Authorisation_(PBA)" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Using_Pre-boot_Authorisation_(PBA)">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.3</span>
					<span>Using Pre-boot Authorisation (PBA)</span>
				</div>
			</a>
			
			<ul id="toc-Using_Pre-boot_Authorisation_(PBA)-sublist" class="vector-toc-list">
				<li id="toc-Encrypting_your_drive" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Encrypting_your_drive">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.3.1</span>
					<span>Encrypting your drive</span>
				</div>
			</a>
			
			<ul id="toc-Encrypting_your_drive-sublist" class="vector-toc-list">
				<li id="toc-Enable_locking" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Enable_locking">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.3.1.1</span>
					<span>Enable locking</span>
				</div>
			</a>
			
			<ul id="toc-Enable_locking-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Set_a_password" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Set_a_password">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.3.1.2</span>
					<span>Set a password</span>
				</div>
			</a>
			
			<ul id="toc-Set_a_password-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Install_the_Pre-boot_Authorisation" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Install_the_Pre-boot_Authorisation">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.3.1.3</span>
					<span>Install the Pre-boot Authorisation</span>
				</div>
			</a>
			
			<ul id="toc-Install_the_Pre-boot_Authorisation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Troubleshooting:_PBA_Cold_Reboot_Locks_Drives_Again" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Troubleshooting:_PBA_Cold_Reboot_Locks_Drives_Again">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.3.1.4</span>
					<span>Troubleshooting: PBA Cold Reboot Locks Drives Again</span>
				</div>
			</a>
			
			<ul id="toc-Troubleshooting:_PBA_Cold_Reboot_Locks_Drives_Again-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Troubleshooting:_UEFI_loses_its_boot_configuration" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Troubleshooting:_UEFI_loses_its_boot_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.3.1.5</span>
					<span>Troubleshooting: UEFI loses its boot configuration</span>
				</div>
			</a>
			
			<ul id="toc-Troubleshooting:_UEFI_loses_its_boot_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Using_a_mkinitcpio_hook" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Using_a_mkinitcpio_hook">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.4</span>
					<span>Using a mkinitcpio hook</span>
				</div>
			</a>
			
			<ul id="toc-Using_a_mkinitcpio_hook-sublist" class="vector-toc-list">
				<li id="toc-Encrypting_your_drive_2" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Encrypting_your_drive_2">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.4.1</span>
					<span>Encrypting your drive</span>
				</div>
			</a>
			
			<ul id="toc-Encrypting_your_drive_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Partition_the_drive" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Partition_the_drive">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.4.2</span>
					<span>Partition the drive</span>
				</div>
			</a>
			
			<ul id="toc-Partition_the_drive-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enable_locking_2" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Enable_locking_2">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.4.3</span>
					<span>Enable locking</span>
				</div>
			</a>
			
			<ul id="toc-Enable_locking_2-sublist" class="vector-toc-list">
				<li id="toc-Lock_boot_partition_as_read-only_(optional)" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Lock_boot_partition_as_read-only_(optional)">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.4.3.1</span>
					<span>Lock boot partition as read-only (optional)</span>
				</div>
			</a>
			
			<ul id="toc-Lock_boot_partition_as_read-only_(optional)-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Install_the_operating_system" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Install_the_operating_system">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.4.4</span>
					<span>Install the operating system</span>
				</div>
			</a>
			
			<ul id="toc-Install_the_operating_system-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Setup_mkinitcpio" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Setup_mkinitcpio">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.4.5</span>
					<span>Setup mkinitcpio</span>
				</div>
			</a>
			
			<ul id="toc-Setup_mkinitcpio-sublist" class="vector-toc-list">
				<li id="toc-Custom_mkinitcpio_hook" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Custom_mkinitcpio_hook">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.4.5.1</span>
					<span>Custom mkinitcpio hook</span>
				</div>
			</a>
			
			<ul id="toc-Custom_mkinitcpio_hook-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Custom_hook_in_mkinitcpio_config" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Custom_hook_in_mkinitcpio_config">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.4.5.2</span>
					<span>Custom hook in mkinitcpio config</span>
				</div>
			</a>
			
			<ul id="toc-Custom_hook_in_mkinitcpio_config-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Regenerate_mkinitcpio_image" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Regenerate_mkinitcpio_image">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.4.5.3</span>
					<span>Regenerate mkinitcpio image</span>
				</div>
			</a>
			
			<ul id="toc-Regenerate_mkinitcpio_image-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Accessing_the_drive_from_a_live_distribution" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Accessing_the_drive_from_a_live_distribution">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.5</span>
					<span>Accessing the drive from a live distribution</span>
				</div>
			</a>
			
			<ul id="toc-Accessing_the_drive_from_a_live_distribution-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Disable_locking" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Disable_locking">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.6</span>
					<span>Disable locking</span>
				</div>
			</a>
			
			<ul id="toc-Disable_locking-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Re-enable_locking_and_the_PBA" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Re-enable_locking_and_the_PBA">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.7</span>
					<span>Re-enable locking and the PBA</span>
				</div>
			</a>
			
			<ul id="toc-Re-enable_locking_and_the_PBA-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Encrypting_a_non-root_drive" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Encrypting_a_non-root_drive">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>Encrypting a non-root drive</span>
				</div>
			</a>
			
			<ul id="toc-Encrypting_a_non-root_drive-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Changing_the_passphrase" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Changing_the_passphrase">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3</span>
					<span>Changing the passphrase</span>
				</div>
			</a>
			
			<ul id="toc-Changing_the_passphrase-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Waking_up_from_suspend" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Waking_up_from_suspend">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.4</span>
					<span>Waking up from suspend</span>
				</div>
			</a>
			
			<ul id="toc-Waking_up_from_suspend-sublist" class="vector-toc-list">
				<li id="toc-Preparing_drive_for_sleep" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Preparing_drive_for_sleep">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.4.1</span>
					<span>Preparing drive for sleep</span>
				</div>
			</a>
			
			<ul id="toc-Preparing_drive_for_sleep-sublist" class="vector-toc-list">
				<li id="toc-With_mkinitcpio_hook" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#With_mkinitcpio_hook">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.4.1.1</span>
					<span>With mkinitcpio hook</span>
				</div>
			</a>
			
			<ul id="toc-With_mkinitcpio_hook-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-With_systemd_service" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#With_systemd_service">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.4.1.2</span>
					<span>With systemd service</span>
				</div>
			</a>
			
			<ul id="toc-With_systemd_service-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Using_cryptsetup" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Using_cryptsetup">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Using cryptsetup</span>
			</div>
		</a>
		
			<button aria-controls="toc-Using_cryptsetup-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Using cryptsetup subsection</span>
			</button>
		
		<ul id="toc-Using_cryptsetup-sublist" class="vector-toc-list">
			<li id="toc-Encrypting_a_partition" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Encrypting_a_partition">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>Encrypting a partition</span>
				</div>
			</a>
			
			<ul id="toc-Encrypting_a_partition-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Removing_a_locking_range" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Removing_a_locking_range">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.2</span>
					<span>Removing a locking range</span>
				</div>
			</a>
			
			<ul id="toc-Removing_a_locking_range-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Secure_disk_erasure" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Secure_disk_erasure">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.3</span>
					<span>Secure disk erasure</span>
				</div>
			</a>
			
			<ul id="toc-Secure_disk_erasure-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Suspend/hibernation_support" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Suspend/hibernation_support">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.4</span>
					<span>Suspend/hibernation support</span>
				</div>
			</a>
			
			<ul id="toc-Suspend/hibernation_support-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-BIOS_based_ATA-password" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#BIOS_based_ATA-password">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>BIOS based ATA-password</span>
			</div>
		</a>
		
		<ul id="toc-BIOS_based_ATA-password-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar no-font-mode-scale">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Self-encrypting drives</span></h1>
							
</header>
				<div class="vector-column-end no-font-mode-scale">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Data-at-rest_encryption.html" title="Data-at-rest encryption">Data-at-rest encryption</a></li>
<li><a href="../en/Trusted_Platform_Module.html" title="Trusted Platform Module">Trusted Platform Module</a></li>
<li><a href="../en/Dm-crypt/Encrypting_an_entire_system.html" title="Dm-crypt/Encrypting an entire system">dm-crypt/Encrypting an entire system</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/Hardware-based_full_disk_encryption" class="extiw" title="wikipedia:Hardware-based full disk encryption">Hardware-based full-disk encryption</a> (FDE) is now available from many hard disk (HDD) vendors, becoming increasingly common especially for <a href="../en/Solid_state_drive.html" title="Solid state drive">solid state drives</a>. The term "self-encrypting drive" (SED) is now common when referring to HDDs or SSDs with built-in full-disk encryption. <a href="https://en.wikipedia.org/wiki/Opal_Storage_Specification" class="extiw" title="wikipedia:Opal Storage Specification">OPAL</a> is a set of specifications for self-encrypting drives developed by the Trusted Computing Group.
</p>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Overview">Overview</h2></div>
<p>Many self-encrypting drives available today implement the <a rel="nofollow" class="external text" href="https://trustedcomputinggroup.org/resource/storage-work-group-storage-security-subsystem-class-opal/">OPAL</a>, <a rel="nofollow" class="external text" href="https://trustedcomputinggroup.org/resource/tcg-storage-security-subsystem-class-ruby-specification/">Ruby</a> or <a rel="nofollow" class="external text" href="https://trustedcomputinggroup.org/resource/storage-work-group-storage-security-subsystem-class-enterprise-specification/">Enterprise</a> standards developed by the Trusted Computing Group (TCG). Other standards such as Opalite and Pyrite only offer a subset of the functionalities offered by OPAL, and might not even offer any actual encryption of data at rest <a rel="nofollow" class="external autonumber" href="https://winmagic.com/en/opalite-pyrite-sed-specifications-simplified/">[1]</a>. The hardware manufactured according to the standards is <a rel="nofollow" class="external text" href="http://www.wavesys.com/self-encrypting-drive-compatibility-list">labeled</a> accordingly. 
</p>
<p>Unlocking of the drive can be done during operating system runtime using software utilities, in a pre-boot authentication environment, or with a <a href="#BIOS_based_ATA-password">#BIOS based ATA-password</a> on power up.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> "Encryption" in the context of this page refers to hardware-based encryption. See <a href="../en/Data-at-rest_encryption.html#Block_device_encryption" title="Data-at-rest encryption">Data-at-rest encryption#Block device encryption</a> and <a href="../en/Data-at-rest_encryption.html#Stacked_filesystem_encryption" title="Data-at-rest encryption">Data-at-rest encryption#Stacked filesystem encryption</a> for software-based encryption.</div>
<p>Refer to the <a href="#Advantages">#Advantages</a> and <a href="#Disadvantages">#Disadvantages</a> sections to better understand and decide if hardware-based full-disk encryption is what you want.
</p>
<div class="mw-heading mw-heading3"><h3 id="Key_management_technical_implementation">Key management technical implementation</h3></div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> This section is important to understand the core concepts behind effective key management, and secure erasure of the disk.</div>
<p>Key management takes place within the disk controller and encryption keys are usually 128 or 256 bit Advanced Encryption Standard (AES).
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> The Opal standards are full of acronyms. The sedutil refers to them in the <a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/wiki/FAQ">FAQ</a> and <a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/wiki/Command-Syntax">command syntax</a>. It would be useful to name the important acronyms (e.g. SID, MSID, locking SP, admin SP, MEK, DEK) in this section, because they are intrinsic to the key-management defined per standard. (See also <a href="https://en.wikipedia.org/wiki/Key_escrow" class="extiw" title="w:Key escrow">w:Key escrow</a>). (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Self-encrypting_drives.html">Talk:Self-encrypting drives</a>)</div>
</div>
<p>Self-encrypting drives adhering to the TCG OPAL 2.0 standard specification (almost all modern self-encrypting drives) implement key management via an authentication key, and a 2nd-level data encryption key. The data encryption key is the key against which data on the drive is actually encrypted. The authentication key is the user-facing 1st-level passphrase which decrypts the data encryption key (which in turn decrypts the data). This approach has specific advantages:
</p>
<ul>
<li>Allows the user to change the passphrase <i>without</i> losing the existing encrypted data on the disk
<ul><li>This improves security, as it is fast and easy to respond to security threats and revoke a compromised passphrase</li></ul>
</li>
<li>Facilitates near-instant and cryptographically secure full disk erasure.</li>
</ul>
<p>For those who are familiar, this concept is similar to the LUKS key management layer often used in a <a href="../en/Dm-crypt.html" title="Dm-crypt">dm-crypt</a> deployment. Using LUKS, the user can have multiple different keys (passphrases or keyfiles) to decrypt the master-key, which in turn decrypts the underlying data. This approach allows the user to change or revoke these keys as required <i>without</i> needing to re-encrypt the data, as the master 2nd-level encryption key <i>is unchanged</i> (itself being re-encrypted by the new passphrase).
</p>
<p>In fact, in drives featuring full-disk encryption, data is <i>always</i> encrypted with the data encryption key when stored to disk, even if there is no password set (e.g. a new drive). Manufacturers do this to make it easier for users who do not wish to enable the security features of the self-encrypting drive. These self-encrypting drives can be thought of as having a zero-length password by default that <i>always</i> transparently encrypts the data  (similar to how passwordless SSH keys can provide somewhat secure access without user intervention).
</p>
<p>If a user wishes to "enable" encryption at a later stage, they are able to configure an authentication key (such as a passphrase) which encrypts the existing data encryption key. The user will then be prompted for their passphrase when decrypting the data encryption key in the future. Crucially, because the existing data encryption key is not regenerated, setting a passphrase allows for the drive to be locked while preserving existing encrypted data on the disk, avoiding the need for the drive to be re-encrypted. On the flip-side, there is no way to re-encrypt the data itself, other than a secure full disk erasure.
</p>
<div class="mw-heading mw-heading3"><h3 id="Advantages">Advantages</h3></div>
<ul>
<li>Easier to setup (compared to software-based encryption)</li>
<li>Notably transparent to the user, except for initial bootup authentication</li>
<li>Data-at-Rest protection</li>
<li>Increased performance (CPU is freed up from calculations to encrypt and decrypt)</li>
<li>The main CPU and RAM are eliminated as possible attack targets</li>
<li>Optimally fast and <a href="#Secure_disk_erasure">#Secure disk erasure</a> (sanitation) (regardless of disk size)</li>
<li>Protection from alternative boot methods due to the possibility to encrypt the MBR, rendering the drive inaccessible before pre-boot authentication</li>
</ul>
<div class="mw-heading mw-heading3"><h3 id="Disadvantages">Disadvantages</h3></div>
<ul><li>The configuration of <a href="../en/Suspend_and_hibernate.html" class="mw-redirect" title="Suspend and hibernate">suspend and hibernate</a> modes is difficult and may be impossible, depending on the systems' EFI implementation.</li></ul>
<ul><li>A re-encryption of the data is not possible without a secure disk erasure.</li></ul>
<ul><li>Exploitations</li></ul>
<dl><dd>
<ul><li>Constant-power exploits</li></ul>
<dl><dd>Typical self-encrypting drives, once unlocked, will remain unlocked as long as power is provided. This vulnerability can be exploited by means of altering the environment external to the drive, without cutting power, in effect keeping the drive in an unlocked state. For example, it has been shown (by researchers at University of Erlangen-Nuremberg) that it is possible to reboot the computer into an attacker-controlled operating system without cutting power to the drive. The researchers have also demonstrated moving the drive to another computer without cutting power.<a rel="nofollow" class="external autonumber" href="https://www1.cs.fau.de/sed">[2]</a>
</dd></dl>
<ul><li>Key-in-memory exploits</li></ul>
<dl><dd>When the system is powered down into S3 ("sleep") mode, the drive is powered down, but the drive keeps access to the encryption key in its internal memory (NVRAM) to allow for a resume ("wake"). This is necessary because for system booted with an arbitrary operating system there is no standard mechanism to prompt the user to re-enter the pre-boot decryption passphrase again. An attacker (with physical access to the drive) can leverage this to access the drive. Taking together known exploits the researchers summarize "we were able to break hardware-based full-disk encryption on eleven [of twelve] of those systems provided they were running or in standby mode".<a rel="nofollow" class="external autonumber" href="https://www1.cs.fau.de/sed">[3]</a> Note, however, S3 ("sleep") is <b>not</b> currently supported by sedutil (the current available toolset for managing a TCG OPAL 2.0 self-encrypting drives via Linux)</dd></dl>
<ul><li>Compromised firmware</li></ul>
<dl><dd>The firmware of the drive may be compromised (backdoor) and data sent to it thus potentially compromised (decryptable by the malicious third party in question, provided access to physical drive is achievable). A study demonstrated methods for compromising device firmware, as well as applying invalid passwords to access data on OPAL devices.<a rel="nofollow" class="external autonumber" href="https://www.ieee-security.org/TC/SP2019/papers/310.pdf">[4]</a> If data is encrypted by the operating system (e.g. dm-crypt), the encryption key is unknown to the compromised drive, thus circumventing this attack vector entirely.</dd></dl>
</dd></dl>
<div class="mw-heading mw-heading2"><h2 id="Linux_support">Linux support</h2></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> List which TCG standards sedutil supports. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Self-encrypting_drives.html">Talk:Self-encrypting drives</a>)</div>
</div>
<p>The kernel supports OPAL self-encrypting drives via the <code>CONFIG_BLK_SED_OPAL</code> option.<a rel="nofollow" class="external autonumber" href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=455a7b238cd6bc68c4a550cbbd37c1e22b64f71c">[5]</a> All <a href="../en/Kernel.html#Officially_supported_kernels" title="Kernel">officially supported kernels</a> are built with this option enabled.
</p>
<p><a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil">sedutil</a>, under the umbrella of The <a rel="nofollow" class="external text" href="https://www.drivetrust.com">Drive Trust Alliance (DTA)</a>, is "an Open Source (GPLv3) effort to make core Self Encrypting Drive technology freely available to developers."<a rel="nofollow" class="external autonumber" href="https://www.drivetrust.com/source-code/">[6]</a>
</p>
<p><i>cryptsetup</i>, the command line utility for <a href="../en/Dm-crypt.html" title="Dm-crypt">dm-crypt</a>, gained limited OPAL support. See the <a rel="nofollow" class="external text" href="https://mirrors.edge.kernel.org/pub/linux/utils/cryptsetup/v2.7/v2.7.0-ReleaseNotes">cryptsetup 2.7.0 release notes</a> to check whether its capabilities suffice for your purpose.
</p>
<div class="mw-heading mw-heading2"><h2 id="Using_sedutil">Using sedutil</h2></div>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sedutil/">sedutil</a></span><sup><small>AUR</small></sup> package, which contains the <i>sedutil-cli</i> tool, and helper scripts to create a custom pre-boot authorization (PBA) image based off the <i>current</i> operating system in use (e.g. for setting a custom console keymap).  Alternatively, you can install <i>sedutil</i> solely for acquiring the <i>sedutil-cli</i> toolset, but download and use the <a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/wiki/Executable-Distributions">precompiled PBA image (for BIOS or UEFI)</a> provided by the Drive Trust Alliance.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> UEFI support currently requires that Secure Boot be turned off.</div>
<p>For devices connected via <a href="https://en.wikipedia.org/wiki/SATA" class="extiw" title="wikipedia:SATA">SATA</a>, <code>libata.allow_tpm</code> <b>must</b> be set to <code>1</code> (true) in order to use sedutil. Either add <code>libata.allow_tpm=1</code> to the <a href="../en/Kernel_parameters.html" title="Kernel parameters">kernel parameters</a>, or by setting <code>/sys/module/libata/parameters/allow_tpm</code> to <code>1</code> on a running system.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> Using <i>sedutil</i> with external drives, even if sedutil claims the drive supports OPAL, has been reported as bricking them. For example, WD My Book external hard drives owners should set up encryption with the <a rel="nofollow" class="external text" href="https://support.wdc.com/downloads.aspx?p=172">WD Security</a> utility in Windows, and then <a rel="nofollow" class="external text" href="https://github.com/geekhaidar/WD-Passport-Unlock-Linux">use sg_raw</a> for unlocking it. There is also a utility that supports setting up and unlocking such drives here: <a rel="nofollow" class="external text" href="https://github.com/0-duke/wdpassport-utils">wdpassport-utils</a>
</div>
<div class="mw-heading mw-heading3"><h3 id="Encrypting_the_root_(boot)_drive">
<span id="Encrypting_the_root_.28boot.29_drive"></span>Encrypting the root (boot) drive</h3></div>
<p>These instructions assume you have the <i>sedutil-cli</i> tool installed (via the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sedutil/">sedutil</a></span><sup><small>AUR</small></sup> package, or by other means)
</p>
<div class="mw-heading mw-heading4"><h4 id="Check_if_your_disk_supports_OPAL">Check if your disk supports OPAL</h4></div>
<pre># sedutil-cli --isValidSED <i>DRIVE</i>
</pre>
<p>If you get something like
</p>
<pre>sedutil:: Invalid or unsupported device: /dev/nvme1n1
</pre>
<p>then your disk does not support OPAL. On the contrary, the following output means OPAL standards 2.x are supported, as the drive has a 2 (or a 12 for both OPAL 1 and 2) in the second column indicating OPAL 2 support:
</p>
<pre>/dev/nvme2n1 SED -2--- HFS512GEJ9X110N                         :51070C30
</pre>
<p>Windows version of sedutils outputs (for an unsupported drive):
</p>
<pre>\\.\PhysicalDrive0 NO --- CT1000P3PSSD8    R413
</pre>
<p>The letter "P" in the column means the drive supports PYRITE rather than OPAL.
</p>
<p>You may also run <code>sedutil-cli --query <i>DRIVE</i></code> and look for a section like below being present:
</p>
<pre>OPAL 2.15 function (0x0203)
    Base comID = 0x0888, Initial PIN = 0x0, Reverted PIN = 0x0, comIDs = 1
    Locking Admins = 4, Locking Users = 9, Range Crossing = N
</pre>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> If the drive shows "P" for Pyrite, or supports Opalite, does that also mean it's supported (<i>in some capacity</i> at least) and the directions from this article apply to it as well? How does one verify that a Pyrite drive actually supports encryption at all, since it sounds like that isn't necessarily obligatory or well-defined? <a rel="nofollow" class="external autonumber" href="https://github.com/Drive-Trust-Alliance/sedutil/issues/310">[7]</a> (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Self-encrypting_drives.html">Talk:Self-encrypting drives</a>)</div>
</div>
<div class="mw-heading mw-heading4"><h4 id="Download_the_rescue_image_(optional)">
<span id="Download_the_rescue_image_.28optional.29"></span>Download the rescue image (optional)</h4></div>
<p>Note that this rescue image was built in 2017 and its PBA-Image, on newer AMD-Laptops causes the internal keyboard-input to fail - <a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/issues/422">thus requiring an external keyboard</a> to enter the Disk Password. You might want to build your own PBA instead.
</p>
<p>Download a <a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/wiki/Executable-Distributions">rescue system</a> for a machine provided by the Drive Trust Alliance, e.g. <code>RESCUE64.img.gz</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> UEFI support currently requires that Secure Boot be turned off.</div>
<div class="mw-heading mw-heading5"><h5 id="Create_a_bootable_drive">Create a bootable drive</h5></div>
<p>Decompress the rescue image (if required):
</p>
<pre>$ gunzip RESCUE64.img.gz
</pre>
<p>Create a <a href="../en/USB_flash_installation_medium.html" title="USB flash installation medium">bootable drive</a> using the downloaded rescue image, for example using dd:
</p>
<pre># dd bs=4M if=path/to/RESCUE64.img of=/dev/sdx status=progress conv=fsync oflag=direct
</pre>
<div class="mw-heading mw-heading4"><h4 id="Using_Pre-boot_Authorisation_(PBA)">
<span id="Using_Pre-boot_Authorisation_.28PBA.29"></span>Using Pre-boot Authorisation (PBA)</h4></div>
<p>The following steps will install a PBA image in your EFI/BIOS which will start before your system and prompt you for a password. If the password is correct, it will unlock the drive and reboot into the normal operating system boot loader.
</p>
<div class="mw-heading mw-heading5"><h5 id="Encrypting_your_drive">Encrypting your drive</h5></div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> 
<ul>
<li>These steps must be executed from the rescue system.</li>
<li>These steps will enable encryption for the entire drive (locking range 0). Whilst this does not usually delete the data, always make sure to have a backup.</li>
</ul>
</div>
<div class="mw-heading mw-heading6"><h6 id="Enable_locking">Enable locking</h6></div>
<p>Boot into the rescue system and use the output of <code>blkid</code> to help identify the correct drive, e.g. <code>/dev/sdx</code>.
</p>
<p>Setup the drive initially, which will be set both SID and Admin1 passwords to the same <i>PASSWORD</i> of your choice:
</p>
<pre># sedutil-cli --initialsetup <i>PASSWORD DRIVE</i>
</pre>
<p>Then enable the global locking range 0 (i.e. the entire drive):
</p>
<pre># sedutil-cli --enablelockingrange 0 <i>PASSWORD DRIVE</i>
# sedutil-cli --setmbrdone off <i>PASSWORD DRIVE</i>
</pre>
<div class="mw-heading mw-heading6"><h6 id="Set_a_password">Set a password</h6></div>
<p>To optionally change the <i>PASSWORD</i> from initial setup prior to continuing with setup:
</p>
<pre># sedutil-cli --setsidpassword <i>PASSWORD NEW_SID_PASSWORD DRIVE</i>
</pre>
<p>will change both the SID and Admin1 to <i>NEW_SID_PASSWORD</i>. To only change the Admin1 password:
</p>
<pre># sedutil-cli --setadmin1pwd <i>PASSWORD NEW_ADMIN1_PASSWORD DRIVE</i>
</pre>
<div class="mw-heading mw-heading6"><h6 id="Install_the_Pre-boot_Authorisation">Install the Pre-boot Authorisation</h6></div>
<p>Install the Pre-boot Authorisation (PBA) image:
</p>
<pre># gunzip /usr/sedutil/UEFI64-*.img.gz
# sedutil-cli --loadPBAimage <i>PASSWORD</i> /usr/sedutil/UEFI64-*.img <i>DRIVE</i>
</pre>
<p>Power off the computer to lock the drive.
</p>
<p>When the computer is next powered on, the PBA should ask for your password; then unlock the drive and chain-load the decrypted operating system.
</p>
<div class="mw-heading mw-heading6"><h6 id="Troubleshooting:_PBA_Cold_Reboot_Locks_Drives_Again">Troubleshooting: PBA Cold Reboot Locks Drives Again</h6></div>
<p>In <a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/issues/435">some cases</a>, the PBA will load, accept the password, and unlock the drives but when chain-loading to the decrypted operating system it will do a "cold" reboot which powers off the disks for a moment and result in the drives locking again. So you get stuck in a loop of always unlocking the drives but never booting from them.
</p>
<p>If this is the case, you will need to edit the <code>UEFI-*.img</code> to guarantee it does a "warm" reboot:
</p>
<pre># losetup --find --show ./UEFI64-*.img 
# partprobe /dev/loop0
# mount /dev/loop0p1 /mnt
# cd /mnt/EFI/boot
# $EDITOR syslinux.cfg # add " reboot=warm" (no quotes) to the end of the line starting with  "append"
# cd -
# sync
# umount /mnt
# losetup -D
</pre>
<p>Now you can copy the image to the drive again with:
</p>
<pre># sedutil-cli --loadPBAimage <i>PASSWORD</i> ./UEFI64-*.img <i>DRIVE</i>
</pre>
<p>If you are using the recovery image the above might not work (<code>losetup -f ./UIEFI64-*.img</code> fails with <code>no such file</code>), you can edit the file on your computer and copy it on the recovery USB drive (but after the end of the recovery image)
</p>
<pre># dd bs=4M if=UEFI64.img of=<i>DRIVE</i> seek=100
</pre>
<p><code>seek=100</code> will skip 400 MiB from the start of the drive to avoid overwriting the recovery image itself.
</p>
<p>Then, once the recovery is started you can get your image:
</p>
<pre># dd bs=4M if=<i>DRIVE</i> of=UEFI64.img skip=100 count=10
</pre>
<p><code>count</code>Ã—<code>bs</code> should be more then the file size.
</p>
<p>Truncate file to actual size:
</p>
<pre># truncate -s <i>IMGSIZE</i> UEFI64.img
</pre>
<div class="mw-heading mw-heading6"><h6 id="Troubleshooting:_UEFI_loses_its_boot_configuration">Troubleshooting: UEFI loses its boot configuration</h6></div>
<p>If you use an <a href="../en/EFI_boot_stub.html" title="EFI boot stub">EFI boot stub</a> and configured UEFI to boot your kernel directly, after the disk is unlocked the firmware might forget all its configuration (and it loses it on every unlock). In that case you can install an UEFI <a href="../en/Boot_loader.html" class="mw-redirect" title="Boot loader">boot loader</a> to the default/fallback boot path <code><i>esp</i>/EFI/BOOT/BOOTx64.EFI</code> and then the firmware would be able to boot it with its default configuration.
</p>
<p>It will be helpful to have an <a href="../en/USB_flash_installation_medium.html" title="USB flash installation medium">USB flash installation medium</a>: if you plug it in after unlocking the disk, it will auto-boot and let you configure your now-unlocked boot disk.
</p>
<div class="mw-heading mw-heading4"><h4 id="Using_a_mkinitcpio_hook">Using a mkinitcpio hook</h4></div>
<p>Instead of using a PBA, the drive can be setup to only encrypt the root partition whilst leaving the <code>/boot</code> partition accessible. This way, the system can boot and a <code>mkinitcpio</code> hook used to unlock the drive before the rest of the boot sequence is completed. This has the advantage of not needing to install a PBA and reboot, and also allows for easier support of resume from S3 sleep.
</p>
<div class="mw-heading mw-heading5"><h5 id="Encrypting_your_drive_2">Encrypting your drive</h5></div>
<p>Follow the steps outlined above to create a rescue system, then boot into it.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> 
<ul>
<li>These steps must be executed from the rescue system, or a live system with sedutil-cli installed.</li>
<li>These steps will <b>destroy all data</b> on the drive. Make sure to have a backup before starting!</li>
</ul>
</div>
<p>The first command will delete everything off of the drive. Omitting it will not save your data, because setting up the new locking range will destroy it anyway, and it might cause the subsequent commands to refuse operation.
</p>
<pre># sedutil-cli --yesIreallywanttoERASEALLmydatausingthePSID <i>PSID DRIVE</i>
# sedutil-cli --initialsetup <i>PASSWORD DRIVE</i>
# sedutil-cli --setMBREnable off <i>PASSWORD DRIVE</i>
</pre>
<p>The PSID (physical security identifier) can only be found on the physical drive label (the sticker on top of the drive).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> The PSID must be written without any dashes, spaces or underscores.</div>
<div class="mw-heading mw-heading5"><h5 id="Partition_the_drive">Partition the drive</h5></div>
<p><a href="../en/Partitioning.html" class="mw-redirect" title="Partition">Partition</a> the drive as desired, making sure the EFI and/or <code>/boot</code> partitions are at the start of the disk, immediately followed by the root partition. For example:
</p>
<ol>
<li>1G, FAT32, <code>/boot</code>
</li>
<li>ext4, <code>/</code>
</li>
</ol>
<p>Or a slightly more complex setup:
</p>
<ol>
<li>100M, FAT32, EFI</li>
<li>2G, ext4, <code>/boot</code>
</li>
<li>ext4, <code>/</code>
</li>
<li>Swap</li>
</ol>
<p>It is important the EFI and/or <code>/boot</code> partitions have enough space to hold all of the kernel images you may want to install. It will not be possible to expand these later without destroying all of the data in the root partition, as the encryption headers would be overwritten.
</p>
<div class="mw-heading mw-heading5"><h5 id="Enable_locking_2">Enable locking</h5></div>
<p>Use <code>lsblk --fs</code> to help identify the correct drive, e.g. <code>/dev/sdx</code>, then use <code>fdisk -l <i>DRIVE</i></code> to find:
</p>
<ul>
<li>RANGE_START = "Start" of the root partition</li>
<li>RANGE_LENGTH = "Sectors" of the root partition</li>
</ul>
<p>In the example below, RANGE_START would be 2097152 and RANGE_LENGTH 974675968. It is important that these numbers are divisible by 8 to work with <code>sedutil-cli</code>, rounding may be necessary.
</p>
<pre>Device       Start       End   Sectors   Size Type
/dev/sda1     2048   2097151   2095104  1023M EFI System
/dev/sda2  2097152 976773119 974675968 464.8G Linux filesystem
</pre>
<p>Create locking range 1 to only cover the root partition (and optionally swap):
</p>
<pre># sedutil-cli --setupLockingRange 1 <i>RANGE_START RANGE_LENGTH PASSWORD DRIVE</i>
# sedutil-cli --enablelockingrange 1 <i>PASSWORD DRIVE</i>
</pre>
<div class="mw-heading mw-heading6"><h6 id="Lock_boot_partition_as_read-only_(optional)">
<span id="Lock_boot_partition_as_read-only_.28optional.29"></span>Lock boot partition as read-only (optional)</h6></div>
<p>For extra security, the EFI and/or <code>/boot</code> partitions can be locked as read-only. Identify the RANGE_START and RANGE_LENGTH in the same manner as for the root partition, then issue the following commands:
</p>
<pre># sedutil-cli --setupLockingRange 2 <i>RANGE_START RANGE_LENGTH PASSWORD DRIVE</i>
# sedutil-cli --readonlyLockingRange 2 <i>PASSWORD DRIVE</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> Do not do this while using <a href="../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a>, as it expects the EFI system partition to be writable in order to write a random seed file to it, which will fail the boot process with an error. <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/30462">[8]</a>
</div>
<div class="mw-heading mw-heading5"><h5 id="Install_the_operating_system">Install the operating system</h5></div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> Powering off the system now will cause the drive to become locked. If this happens, boot into the rescue system and use the following command to unlock the range:
<pre># sedutil-cli --setlockingrange 1 rw <i>PASSWORD DRIVE</i>
</pre>
<p>Then proceed to reboot the system without powering off.
</p>
</div>
<p>You may now install the operating system, taking care to use the existing partitions and not alter them in any way. Once done, reboot into the new system without powering off first.
</p>
<div class="mw-heading mw-heading5"><h5 id="Setup_mkinitcpio">Setup mkinitcpio</h5></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> The presented mkinitcpio hook will not work on <a href="../en/Mkinitcpio.html" title="Mkinitcpio">systemd-based initial ramdisk setup</a>â€”in such case, the hook will install, but it will not run. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Self-encrypting_drives.html">Talk:Self-encrypting drives</a>)</div>
</div>
<div class="mw-heading mw-heading6"><h6 id="Custom_mkinitcpio_hook">Custom mkinitcpio hook</h6></div>
<p>Create a custom mkinitcpio hook to ask for the drive password on boot:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/install/sedutil</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash

help() {
    cat &lt;&lt;HELPEOF
Unlock OPAL drives by prompting for password
HELPEOF
}

build() {
    add_binary sedutil-cli
    add_binary clear
    add_binary find
    add_binary gawk
    add_binary grep
    add_binary readlink
    add_binary stty
    add_binary xargs
    add_binary partprobe

    add_runscript
}
</pre>
<p>The following script also contains code for unlocking the boot range, which can be uncommented if needed. Additionally, if you need to be able to resume from sleep, you may need to slightly modify the below script. See <a href="#Preparing_drive_for_sleep">#Preparing drive for sleep</a> for more information and caveats about S3 sleep.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/hooks/sedutil</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/ash

run_hook() {
	msg  "OPAL Drives Unlock"

	for block_device in $(list_block_devices)Â ; do
		ifÂ ! is_opal_drive "$block_device"Â ; then
			continue
		fi
		ifÂ ! is_opal_locked "$block_device"Â ; then
			continue
		fi
		opal_unlock "$block_device" "$(get_block_device_info $block_device)"
	done
	
	partprobe
}

list_block_devices() {
	for glob in 'sd[a-z]' 'nvme[0-9]n[0-9]' 'nvme[0-9][0-9]n[0-9][0-9]'Â ; do
		find /dev/ -name "$glob"
	done
	if [ $?Â != 0 ]Â ; then
		msg "Unable to list block devices"
	fi
}

is_opal_drive() {
	sedutil-cli --isValidSED "$1" &gt; /dev/null 2&gt; /dev/null
	return $?
}

is_opal_locked() {
	local locked=$(sedutil-cli --query "$1" | grep -A1 '^Locking function (0x0002)' | grep -Po '(?&lt;=Locked = )[YN]')
	test "$locked" = "Y"
	return $?
}

get_block_device_info() {
	sedutil-cli --query "$1" | gawk '/^\//{print;exit}'
	if [ $?Â != 0 ]Â ; then
		msg "Unable to query $1"
	fi
}

opal_unlock() {
	while trueÂ ; do
		stty -echo
		echo "Password for"
		echo -n "$2: "
		read pass
		stty echo

		# Unlock root range for read/write
		sedutil-cli --setlockingrange 1 rw "$pass" "$1"
		# Uncomment to also unlock boot range
		# sedutil-cli --setlockingrange 2 rw "$pass" "$1"
		if [ $?Â != 0 ]Â ; then
			echo "Failed to unlock!"
			continue
		fi
        
		echo "Unlocked!"
		break
	done
}</pre>
<div class="mw-heading mw-heading6"><h6 id="Custom_hook_in_mkinitcpio_config">Custom hook in mkinitcpio config</h6></div>
<p>Edit you mkinitcpio configuration to add the sedutil hook before udev. It is important the hook runs before udev, otherwise udev will get stuck trying to access the encrypted drive and cause I/O errors.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> It may be necessary to add the keyboard and keymap hooks to have a working keyboard on boot, together with the required kernel modules for your keyboard. See <a href="../en/Mkinitcpio/Minimal_initramfs.html#Keyboard_modules" title="Mkinitcpio/Minimal initramfs">mkinitcpio/Minimal initramfs#Keyboard modules</a> for more details.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> It is a good idea to create a separate mkinitcpio config and image as described in <a href="../en/Mkinitcpio.html#Customized_generation" title="Mkinitcpio">Mkinitcpio#Customized generation</a>, as your system may be unbootable if e.g. the keyboard does not work.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">HOOKS=(base keymap consolefont sedutil udev autodetect microcode modconf kms keyboard block filesystems fsck)</pre>
<div class="mw-heading mw-heading6"><h6 id="Regenerate_mkinitcpio_image">Regenerate mkinitcpio image</h6></div>
<p>Finally, <a href="../en/Regenerate_the_initramfs.html" class="mw-redirect" title="Regenerate the initramfs">regenerate the initramfs</a>.
</p>
<p>You may now reboot your system. If all goes well, the hook will prompt for a password to unlock your drive and then proceed with the rest of the boot process. If something went wrong, you can boot into the rescue system, manually unlock the drive, then reboot into your normal system using the default initcpio image and proceed to debug your system.
</p>
<div class="mw-heading mw-heading4"><h4 id="Accessing_the_drive_from_a_live_distribution">Accessing the drive from a live distribution</h4></div>
<p>The easiest way is to boot the encrypted SSD first, in order to run the shadow MBR. Then press the key that prompts the boot menu and boot whatever device you prefer. Such a way the SED will be completely transparent.
</p>
<p>Another way is to directly boot into the live distribution and use sedutil to unlock the SSD:
</p>
<pre># sedutil-cli --setlockingrange 0 rw <i>password drive</i>
# sedutil-cli --setmbrdone on <i>password drive</i>
# partprobe <i>drive</i>
</pre>
<p>Verify that you followed the instructions after the note in <a href="#Linux_support">#Linux support</a>.
</p>
<div class="mw-heading mw-heading4"><h4 id="Disable_locking">Disable locking</h4></div>
<p>If you want to turn off Locking and the PBA:
</p>
<pre># sedutil-cli --disableLockingRange 0 <i>password drive</i>
# sedutil-cli --setMBREnable off <i>password drive</i>
</pre>
<div class="mw-heading mw-heading4"><h4 id="Re-enable_locking_and_the_PBA">Re-enable locking and the PBA</h4></div>
<p>You can later re-enable locking and the PBA using this command sequence
</p>
<pre># sedutil-cli --enableLockingRange 0 <i>password drive</i>
# sedutil-cli --setMBREnable on <i>password drive</i>
</pre>
<div class="mw-heading mw-heading3"><h3 id="Encrypting_a_non-root_drive">Encrypting a non-root drive</h3></div>
<p>A secondary drive that is not used for the <a href="../en/Partitioning.html#/" title="Partitioning">system root</a>, for example a separate drive hosting a permanent <a href="../en/Partitioning.html#/data" title="Partitioning">/data</a> partition or a portable USB-drive, can be setup.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> How do you unlock the drive during boot (in late userspace), i.e. what is the equivalent of <code>/etc/crypttab</code> for <i>sedutil</i>? (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Self-encrypting_drives.html">Talk:Self-encrypting drives</a>)</div>
</div>
<p>A non-root drive does not require loading a PBA. So, activating the encryption is as simple as running:
</p>
<pre># sedutil-cli --initialsetup <i>password drive</i>
# sedutil-cli --enableLockingRange 0 <i>password drive</i>
# sedutil-cli --setMBREnable off <i>password drive</i>
</pre>
<p>If it is a portable drive and/or you want to unlock the drive manually, you should do the as in <a href="#Accessing_the_drive_from_a_live_distribution">#Accessing the drive from a live distribution</a>, but you need just the first command, because MBR shadowing has not been enabled:
</p>
<pre># sedutil-cli --setlockingrange 0 rw <i>password drive</i>
</pre>
<p>This will unlock the drive until it is disconnected or your machine goes into suspend, beware that this may cause loss of data.
</p>
<div class="mw-heading mw-heading3"><h3 id="Changing_the_passphrase">Changing the passphrase</h3></div>
<p>Changing the passphrase does <i>not</i> lose existing data on the drive, and does not require re-encryption of data.
</p>
<pre># sedutil-cli --setSIDPassword <i>password newpassword device</i>
# sedutil-cli --setAdmin1Pwd <i>password newpassword device</i>
</pre>
<p>Read the <a href="#Key_management_technical_implementation">#Key management technical implementation</a> section above to learn about how this is implemented securely within the drive, and why it is possible to change the passphrase <i>without</i> losing the existing encrypted data on the drive.
</p>
<div class="mw-heading mw-heading3"><h3 id="Waking_up_from_suspend">Waking up from suspend</h3></div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> Keeping the unlock password or hash on disk and in kernel memory is a requirement.</div>
<p>Suspending the system results in a crash by default, because power is being cut from the drive and that causes it to lock itself. In order to wake up from suspend the kernel should know a hashed password for the disk. This functionality is in-kernel since 4.11, but it is only available via a fork of sedutil, either <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sedutil-sleep-git/">sedutil-sleep-git</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sedutil-ladar/">sedutil-ladar</a></span><sup><small>AUR</small></sup>. Note the latter has additional features but a slightly different command syntax <a rel="nofollow" class="external autonumber" href="https://github.com/ladar/sedutil">[9]</a>.
</p>
<p>Generate a hashed password for the <a href="../en/Block_device.html" class="mw-redirect" title="Block device">block device</a> specified as <code><i>/dev/device</i></code>:
</p>
<pre># sedutil-sleep --printPasswordHash <i>password /dev/device</i>
</pre>
<div class="mw-heading mw-heading4"><h4 id="Preparing_drive_for_sleep">Preparing drive for sleep</h4></div>
<div class="mw-heading mw-heading5"><h5 id="With_mkinitcpio_hook">With mkinitcpio hook</h5></div>
<p>If already using a mkinitcpio hook to unlock the drive on boot, then you can simply add code as below to the hook to also prepare the drive for sleep. Make sure this code is placed after the command that unlocks the ranges <code>sedutil-cli --setlockingrange</code>, otherwise it will fail. In this example, <code>$pass</code> is a variable containing the password for unlocking, while <code>$1</code> is a variable containing the device to prepare for sleep, typically the root partition (e.g. <code>/dev/sda1</code>).
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/hooks/sedutil</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">sedutil-cli --prepareForS3Sleep 1 "$pass" "$1"
if [ $?Â != 0 ]Â ; then
	msg "Prepare for S3 failed for $1"
fi</pre>
<div class="mw-heading mw-heading5"><h5 id="With_systemd_service">With systemd service</h5></div>
<p>Create a <a href="../en/Systemd.html" title="Systemd">systemd</a> service, inserting hashes for each device:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/sedutil-sleep.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=sedutil-sleep

[Service]
Type=oneshot
#Add as many ExecStart lines as needed here
ExecStart=-+/usr/bin/sedutil-sleep -n -x --prepareForS3Sleep 0 <i>hash /dev/device</i>
#ExecStart=-+/usr/bin/sedutil-sleep -n -x --prepareForS3Sleep 0 <i>hash2 /dev/device</i>
RemainAfterExit=true

[Install]
WantedBy=multi-user.target</pre>
<div class="mw-heading mw-heading2"><h2 id="Using_cryptsetup">Using cryptsetup</h2></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Mention/crosslink crypttab support (Discuss in <a href="../en/Talk:Self-encrypting_drives.html#cryptsetup_support_for_OPAL" title="Talk:Self-encrypting drives">Talk:Self-encrypting drives#cryptsetup support for OPAL</a>)</div>
</div>
<p><i>cryptsetup</i> can be used to perform the initial setup of OPAL equivalent to the example of <a href="#Using_sedutil">sedutil</a>, albeit not for USB-drives. <i>cryptsetup</i> is always used on block devices, i.e. an individual partition, and adds a <a href="../en/Dm-crypt.html" class="mw-redirect" title="LUKS">LUKS</a> header to it which includes a LUKS encrypted OPAL key to unlock it. See <span class="plainlinks archwiki-template-man" title="$ man 8 cryptsetup"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cryptsetup.8#SED_(SELF_ENCRYPTING_DRIVE)_OPAL_EXTENSION">cryptsetup(8) Â§â€¯SED (SELF ENCRYPTING DRIVE) OPAL EXTENSION</a></span> for details.
</p>
<p>cryptsetup's advantage over sedutil is that, besides the initial <code>luksFormat</code> command, no special setup is required. It is just a LUKS device like any other which allows using all <a href="../en/Dm-crypt/Device_encryption.html#Cryptsetup_actions_specific_for_LUKS" title="Dm-crypt/Device encryption">features LUKS provides</a> and the option of using <a href="../en/Systemd-cryptenroll.html" title="Systemd-cryptenroll">systemd-cryptenroll</a>.
</p>
<p>See the <a rel="nofollow" class="external text" href="https://mirrors.edge.kernel.org/pub/linux/utils/cryptsetup/v2.7/v2.7.0-ReleaseNotes">cryptsetup 2.7.0 release notes</a> for command examples with OPAL related output of the LUKS header.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Other TCG Security Subsystem Class standards (e.g. TCG Ruby and TCG Enterprise) <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/-/issues/831">are not supported</a> since cryptsetup relies on the kernel for SED support and the kernel only supports OPAL.</div>
<div class="mw-heading mw-heading3"><h3 id="Encrypting_a_partition">Encrypting a partition</h3></div>
<p>Encrypting a partition with OPAL requires the OPAL admin password. If you have not previously set one, you will need to erase all data on the drive with <span class="plainlinks archwiki-template-man" title="$ man 8 cryptsetup-erase"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cryptsetup-erase.8">cryptsetup-erase(8)</a></span> to be able to create a new OPAL admin password. Follow the instructions in <a href="#Secure_disk_erasure">#Secure disk erasure</a> to perform the erase.
</p>
<p>OPAL hardware encryption can be set up on a partition using <span class="plainlinks archwiki-template-man" title="$ man 8 cryptsetup-luksFormat"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cryptsetup-luksFormat.8">cryptsetup-luksFormat(8)</a></span> option <code>--hw-opal-only</code>. This will avoid the performance penalty that software encryption brings to an encrypted partition and the CPU.
</p>
<p>Alternatively, the <code>--hw-opal</code> option can be used to setup both OPAL hardware encryption and dm-crypt software encryption at the same time. The default <a href="../en/Dm-crypt/Device_encryption.html#Encryption_options_for_LUKS_mode" title="Dm-crypt/Device encryption">dm-crypt encryption options</a> for LUKS2 apply and can be configured.
</p>
<p>For example, with <code>/dev/sd<i>XY</i></code> as the partition on a drive with OPAL support:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksFormat --hw-opal-only /dev/sd<i>XY</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">WARNING!
========
This will overwrite data on /dev/sd<i>XY</i> irrevocably.

Are you sure? (Type 'yes' in capital letters): YES
Enter passphrase for /dev/sd<i>XY</i>: 
Verify passphrase: 
Enter OPAL Admin password: 
Verify passphrase:</pre>
<p>Subsequent to the setup, the block device can be opened and formatted with a filesystem, see <a href="../en/Dm-crypt/Device_encryption.html#Unlocking/Mapping_LUKS_partitions_with_the_device_mapper" title="Dm-crypt/Device encryption">dm-crypt/Device encryption#Unlocking/Mapping LUKS partitions with the device mapper</a>. Only the LUKS passphrase is required from now on, because the header automatically unlocks the OPAL encryption.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> If the system's EFI/BIOS itself supports and is configured for <a href="#Using_Pre-boot_Authorisation_(PBA)">#Using Pre-boot Authorisation (PBA)</a>, it will additionally prompt for the <code>/dev/sd<i>XY</i></code> Admin1 password subsequently.</div>
<div class="mw-heading mw-heading3"><h3 id="Removing_a_locking_range">Removing a locking range</h3></div>
<p>Since OPAL locking ranges are neither readable nor writable while in a locked state, an encrypted partition cannot be repurposed until the OPAL locking range spanning it is removed.
</p>
<p>To remove OPAL encryption from a partition use <span class="plainlinks archwiki-template-man" title="$ man 8 cryptsetup-erase"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cryptsetup-erase.8">cryptsetup-erase(8)</a></span>:
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> This will erase the LUKS header (unlike when using software encryption) and remove the OPAL locking range irrecoverably removing access to the encrypted data. A backup of the LUKS header cannot be used to recover from this operation since the OPAL locking range cannot be restored to the previous state.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup erase -v /dev/sd<i>XY</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter OPAL Admin password:
Command successful.
</pre>
<div class="mw-heading mw-heading3"><h3 id="Secure_disk_erasure">Secure disk erasure</h3></div>
<p>Whole disk erasure is very fast, and remarkably simple for a self-encrypting drive. Simply passing a cryptographic disk erasure (or crypto erase) command (after providing the correct authentication credentials) will have the drive self-generate a new random data encryption key internally. This will permanently discard the old key, thus rendering the encrypted data irrevocably un-decryptable. The drive will now be in a 'new drive' state.
</p>
<p>Read the <a href="#Key_management_technical_implementation">#Key management technical implementation</a> section above to learn more about how this is implemented securely within the drive.
</p>
<p>The <a href="../en/Solid_state_drive/Memory_cell_clearing.html" title="Solid state drive/Memory cell clearing">Solid state drive/Memory cell clearing</a> article covers comprehensive guides to perform the erasure securely.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> The following command will erase <b>all data on the drive</b>, even if it is run only against a partition.</div>
<p>The following shows an example output by using <span class="plainlinks archwiki-template-man" title="$ man 8 cryptsetup-erase"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cryptsetup-erase.8">cryptsetup-erase(8)</a></span> to perform it:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup erase -v --hw-opal-factory-reset /dev/sd<i>X</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Enter OPAL PSID: 

WARNING!
========
WARNING: WHOLE disk will be factory reset and all data will be lost! Continue?

Are you sure? (Type 'yes' in capital letters): YES
Command successful.</pre>
<p>The <code>-v</code> option returns the <code>Command successful</code> output.
</p>
<p>The PSID (physical security identifier) can only be found on the physical drive label (the sticker on top of the drive).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> 
<ul>
<li>For <a href="../en/Solid_state_drive/NVMe.html" class="mw-redirect" title="NVMe">NVMe</a> drives use the namespace form of the device name, i.e. use <code>/dev/nvme<i>X</i>n<i>Y</i></code> rather than <code>/dev/nvme<i>X</i></code>.</li>
<li>The PSID must be written without any dashes, spaces or underscores.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> Check that your drive is using the <a href="../en/Advanced_Format.html" title="Advanced Format">optimal logical sector size</a> before performing the erase. Cryptsetup strongly recommends changing the drive's logical sector size to 4096 bytes for encryption performance.</div>
<div class="mw-heading mw-heading3"><h3 id="Suspend/hibernation_support">
<span id="Suspend.2Fhibernation_support"></span>Suspend/hibernation support</h3></div>
<p>Nothing special is required, they work exactly as with regular LUKS since OPAL reuses the existing LUKS framework.
</p>
<p>See <a href="../en/Dm-crypt/Swap_encryption.html" title="Dm-crypt/Swap encryption">dm-crypt/Swap encryption</a>.
</p>
<div class="mw-heading mw-heading2"><h2 id="BIOS_based_ATA-password">BIOS based ATA-password</h2></div>
<p>Previous to the industry's TCG OPAL 2.0 standard initiative, the relevant <a href="https://en.wikipedia.org/wiki/Parallel_ATA#ATA_standards_versions.2C_transfer_rates.2C_and_features" class="extiw" title="w:Parallel ATA">ATA</a> standard defined an "ATA security feature set" for full-disk encryption using self-encrypting drives. This relies on the PC BIOS, not the drive, to feature an unlocking mechanism utilizing the BIOS to setup the user's encryption passphrase. This legacy BIOS-based (ATA) method was considered more unreliable to setup and prone to error with regard to interoperability between PC vendors.<a rel="nofollow" class="external autonumber" href="https://web.archive.org/web/20200615155842/http://www.t13.org/documents/UploadedDocuments/docs2006/e05179r4-ACS-SecurityClarifications.pdf">[10]</a> Typical errors include, for example, inabilities to unlock a device once it is plugged into a system from a different hardware vendor. Hence, the availability of BIOS support for the legacy password mechanism decreases in availability, particularly for consumer hardware. 
</p>
<p>See <a href="../en/Solid_state_drive.html#Security" title="Solid state drive">Solid state drive#Security</a> for more information.
</p>
<div class="mw-heading mw-heading2"><h2 id="See_also">See also</h2></div>
<ul>
<li><a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil">sedutil (github)</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/wiki">sedutil official docs</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/wiki/Command-Syntax">sedutil-cli commands usage</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/Drive-Trust-Alliance/sedutil/issues/90">sedutil-sleep</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Storage.html" title="Category:Storage">Storage</a></li>
<li><a href="../en/Category:Data-at-rest_encryption.html" title="Category:Data-at-rest encryption">Data-at-rest encryption</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Self-encrypting_drives&amp;oldid=862774">https://wiki.archlinux.org/index.php?title=Self-encrypting_drives&amp;oldid=862774</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 25 January 2026, at 20:06.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container no-font-mode-scale">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue  vector-search-box-show-thumbnail vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search cdx-typeahead-search--show-thumbnail">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input mw-searchInput" autocomplete="off" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true"><span class="mw-page-title-main">Self-encrypting drives</span></div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only reading-lists-bookmark" id="ca-bookmark-sticky-header" tabindex="-1" data-event-name="watch-sticky-bookmark"><span class="vector-icon mw-ui-icon-wikimedia-bookmarkOutline mw-ui-icon-wikimedia-wikimedia-bookmarkOutline"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
