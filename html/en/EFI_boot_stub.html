<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>EFI boot stub - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.44.2">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-EFI_boot_stub rootpage-EFI_boot_stub skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Alternative:_Unified_kernel_image" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Alternative:_Unified_kernel_image">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Alternative: Unified kernel image</span>
			</div>
		</a>
		
		<ul id="toc-Alternative:_Unified_kernel_image-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Booting_an_EFI_boot_stub" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Booting_an_EFI_boot_stub">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Booting an EFI boot stub</span>
			</div>
		</a>
		
			<button aria-controls="toc-Booting_an_EFI_boot_stub-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Booting an EFI boot stub subsection</span>
			</button>
		
		<ul id="toc-Booting_an_EFI_boot_stub-sublist" class="vector-toc-list">
			<li id="toc-Using_UEFI_directly" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_UEFI_directly">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>Using UEFI directly</span>
				</div>
			</a>
			
			<ul id="toc-Using_UEFI_directly-sublist" class="vector-toc-list">
				<li id="toc-efibootmgr" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#efibootmgr">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1.1</span>
					<span>efibootmgr</span>
				</div>
			</a>
			
			<ul id="toc-efibootmgr-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-bcfg" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#bcfg">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1.2</span>
					<span>bcfg</span>
				</div>
			</a>
			
			<ul id="toc-bcfg-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Using_UEFI_Shell" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_UEFI_Shell">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>Using UEFI Shell</span>
				</div>
			</a>
			
			<ul id="toc-Using_UEFI_Shell-sublist" class="vector-toc-list">
				<li id="toc-Using_a_startup.nsh_script" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Using_a_startup.nsh_script">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2.1</span>
					<span>Using a startup.nsh script</span>
				</div>
			</a>
			
			<ul id="toc-Using_a_startup.nsh_script-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Tips and tricks</span>
			</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Boot_entry_with_fallback_ramdisk" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Boot_entry_with_fallback_ramdisk">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>Boot entry with fallback ramdisk</span>
				</div>
			</a>
			
			<ul id="toc-Boot_entry_with_fallback_ramdisk-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Archiso_on_ESP" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Archiso_on_ESP">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>Archiso on ESP</span>
				</div>
			</a>
			
			<ul id="toc-Archiso_on_ESP-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Troubleshooting</span>
			</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Changes_to_boot_entries_are_not_applied" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Changes_to_boot_entries_are_not_applied">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>Changes to boot entries are not applied</span>
				</div>
			</a>
			
			<ul id="toc-Changes_to_boot_entries_are_not_applied-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar vector-feature-custom-font-size-clientpref--excluded">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">EFI boot stub</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 6 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-6" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">6 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-de mw-list-item"><a href="https://wiki.archlinux.de/title/EFISTUB" title="EFISTUB – Deutsch" lang="de" hreflang="de" data-title="EFISTUB" data-language-autonym="Deutsch" data-language-local-name="Deutsch" class="interlanguage-link-target"><span>Deutsch</span></a></li>
<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/EFISTUB.html" title="EFISTUB – español" lang="es" hreflang="es" data-title="EFISTUB" data-language-autonym="Español" data-language-local-name="español" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-fr mw-list-item"><a href="../fr/EFISTUB.html" title="EFISTUB – français" lang="fr" hreflang="fr" data-title="EFISTUB" data-language-autonym="Français" data-language-local-name="français" class="interlanguage-link-target"><span>Français</span></a></li>
<li class="interlanguage-link interwiki-hu mw-list-item"><a href="../hu/EFI_boot_stub.html" title="EFI boot stub – magyar" lang="hu" hreflang="hu" data-title="EFI boot stub" data-language-autonym="Magyar" data-language-local-name="magyar" class="interlanguage-link-target"><span>Magyar</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/EFISTUB" title="EFISTUB – 日本語" lang="ja" hreflang="ja" data-title="EFISTUB" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/EFISTUB.html" title="EFISTUB – português" lang="pt" hreflang="pt" data-title="EFISTUB" data-language-autonym="Português" data-language-local-name="português" class="interlanguage-link-target"><span>Português</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end vector-feature-custom-font-size-clientpref--excluded">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Arch_boot_process.html" title="Arch boot process">Arch boot process</a></li>
<li><a href="../en/Unified_Extensible_Firmware_Interface.html" title="Unified Extensible Firmware Interface">Unified Extensible Firmware Interface</a></li>
<li><a href="../en/Unified_kernel_image.html" title="Unified kernel image">Unified kernel image</a></li>
</ul>
</div>
<p>An <b>EFI boot stub</b> (aka <b>EFI stub</b>) is a kernel that is an EFI executable, i.e. that can directly be booted from the UEFI. 
</p>
<p>Historically, this article and the <a href="https://wiki.debian.org/EFIStub" class="extiw" title="debian:EFIStub">Debian Wiki</a> used the terms as one word (EFISTUB or EFIStub).
</p>
<p>By default Arch Linux kernels are EFI boot stubs. If <a href="../en/Kernel/Traditional_compilation.html#Kernel_configuration" title="Kernel/Traditional compilation">compiling the kernel</a>, activate it by setting <code>CONFIG_EFI_STUB=y</code>. See <a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/efi-stub.html">The EFI Boot Stub</a> for more information.
</p>
<p>Before continuing, you need an <a href="../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a> and <a href="../en/EFI_system_partition.html#Mount_the_partition" title="EFI system partition">choose how it is mounted</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> 
<ul>
<li>
<a href="../en/Pacman.html" title="Pacman">pacman</a> will directly update the kernel that the UEFI will read if you mount the ESP to <code>/boot</code>.</li>
<li>EFI boot stubs can also be booted indirectly using a <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a>:
<ul>
<li>There are several UEFI boot managers which can provide additional options or simplify the process of UEFI booting</li>
<li>This is especially useful if you are experimenting with <a href="../en/Kernel_parameters.html" title="Kernel parameters">kernel parameters</a> or if you have multiple kernels/operating systems and your motherboard's UEFI boot menu is not easy to use.</li>
<li>A boot manager which has a file system driver for the partition where the kernel and initramfs reside (e.g. <a href="../en/REFInd.html" title="REFInd">rEFInd</a>) allows keeping them off of the ESP.</li>
</ul>
</li>
</ul>
</div>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Alternative:_Unified_kernel_image">Alternative: Unified kernel image</h2></div>
<p>A <a href="../en/Unified_kernel_image.html" title="Unified kernel image">unified kernel image</a> (UKI) itself is an EFI stub kernel, which also contains the initramfs and boot options in a single file.  The following table lists features of EFI stub that is not UKI compared to UKI, in the situation where they are booted from UEFI.
</p>
<table class="wikitable">
<tbody>
<tr>
<th></th>
<th>EFI stub that is non-UKI</th>
<th>Unified kernel image
</th>
</tr>
<tr>
<th>initramfs
</th>
<td>A separate file, stored in <a href="../en/EFI_system_partition.html" class="mw-redirect" title="ESP">ESP</a>
</td>
<td>Included
</td>
</tr>
<tr>
<th>boot option
</th>
<td>Stored in a UEFI variable</td>
<td>Included
</td>
</tr>
</tbody>
</table>
<p>When there is no problem, UKI is simpler, by requring only one file that contains everything necessary to boot. However with a non-UKI kernel, one can for example switch between different initramfs files or try various boot options for a single kernel image. For UKI, each change leads to a separate UKI.
</p>
<div class="mw-heading mw-heading2"><h2 id="Booting_an_EFI_boot_stub">Booting an EFI boot stub</h2></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> The initramfs path passed to the kernel EFI boot stub should be relative to the EFI system partition's root and use backslashes (in accordance with EFI standards). For example, if the initramfs is located in <code><i>esp</i>/EFI/arch/initramfs-linux.img</code>, the corresponding UEFI formatted line should be <code>initrd=\EFI\arch\initramfs-linux.img</code>. In the following examples we will assume that everything is under <code><i>esp</i>/</code>.</div>
<div class="mw-heading mw-heading3"><h3 id="Using_UEFI_directly">Using UEFI directly</h3></div>
<p>UEFI is designed to remove the need for an intermediate <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> such as <a href="../en/GRUB.html" title="GRUB">GRUB</a>. If your motherboard has a good UEFI implementation, it is possible to embed the kernel parameters within a UEFI boot entry and for the motherboard to boot Arch directly. You can use <a href="../en/Unified_Extensible_Firmware_Interface.html#efibootmgr" class="mw-redirect" title="Efibootmgr">efibootmgr</a> or UEFI Shell v2 to modify your motherboard's boot entries.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> 
<ul>
<li>Outdated UEFI implementations may have compatibility issues with the Linux kernel. If there is a newer version of your UEFI with bug fixes, consider flashing it with the manufacturer's recommended tool.</li>
<li>This item might be obsolete: Some firmwares (notably <b>Lenovo</b> and <b>Dell</b> laptops) do not pass command line parameters from the boot entries in NVRAM to the EFI binaries. (See <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=178154">this 2014 post at Arch BBS</a>) In that case, <a href="../en/Unified_kernel_image.html" title="Unified kernel image">unified kernel image</a> can be used.</li>
</ul>
</div>
<div class="mw-heading mw-heading4"><h4 id="efibootmgr">efibootmgr</h4></div>
<p>To create a boot entry with <i>efibootmgr</i> that will load the kernel:
</p>
<pre># efibootmgr --create --disk <i>/dev/sdX</i> --part <i>Y</i> --label "Arch Linux" --loader /vmlinuz-linux --unicode 'root=<i>block_device_identifier</i> rw initrd=\initramfs-linux.img'
</pre>
<p>Where <code><i>/dev/sdX</i></code> and <code><i>Y</i></code> are the drive and partition number where the ESP is located and <code>root=</code> parameters with your Linux root partitions.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> See <a href="../en/Kernel_parameters.html#Parameter_list" title="Kernel parameters">kernel parameters</a> for supported device name formats, <a href="../en/Persistent_block_device_naming.html" title="Persistent block device naming">persistent block device naming</a> for how to obtain the corresponding value and <a href="../en/Persistent_block_device_naming.html#Kernel_parameters" title="Persistent block device naming">Persistent block device naming#Kernel parameters</a> for examples.</div>
<p>If omitted, then the first partition on <code>/dev/sda</code> is used as the ESP.
</p>
<p>Note that the <code>-u</code>/<code>--unicode</code> argument in quotes is just the list of <a href="../en/Kernel_parameters.html" title="Kernel parameters">kernel parameters</a>, so you may need to add additional parameters (e.g. for <a href="../en/Power_management/Suspend_and_hibernate.html#Pass_hibernate_location_to_initramfs" title="Power management/Suspend and hibernate">suspend to disk</a>).
</p>
<p>An example with LTS Linux kernel, NVME storage, BTRFS filesystem with specific subvolume and hibernation on swap partition:
</p>
<pre># efibootmgr --create \
 --disk /dev/nvme0n1 --part 1 \
 --label "EFISTUB Arch" \
 --loader /vmlinuz-linux-lts \
 --unicode 'root=UUID=01a40dd8-28f0-4636-be1e-aeed60c98095 resume=UUID=2d877d5d-4ca1-4d46-a3d6-b6ee94cbbd78 rw rootflags=subvol=@ loglevel=3 quiet initrd=\initramfs-linux-lts.img'
</pre>
<p>For getting a list with the boot entries, setting the boot order or removing them, see <a href="../en/Unified_Extensible_Firmware_Interface.html#efibootmgr" class="mw-redirect" title="Efibootmgr">efibootmgr</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> 
<ul>
<li>You can simplify and automate this with the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/kesboot-git/">kesboot-git</a></span><sup><small>AUR</small></sup> package: it also contains a <a href="../en/Pacman.html#Hooks" class="mw-redirect" title="Pacman hook">pacman hook</a> that can add and remove EFI variables during actions with packages.</li>
<li>
<a rel="nofollow" class="external free" href="https://github.com/de-arl/auto-UEFI-entry">https://github.com/de-arl/auto-UEFI-entry</a> is a bash helper to create the commands.</li>
<li>It is convenient to save the command to create the boot entry in a shell script, which makes it easier to modify, for example when changing kernel parameters. In doing so, consider automating the deletion of old boot entries, as <i>efibootmgr</i> currently <a rel="nofollow" class="external text" href="https://github.com/rhboot/efibootmgr/issues/49">does not support editing existing entries</a>.</li>
<li>The forum post titled <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1090040#p1090040">The Linux kernel with built-in boot loader</a> might also be of interest.</li>
</ul>
</div>
<div class="mw-heading mw-heading4"><h4 id="bcfg">bcfg</h4></div>
<p>Some UEFI implementations make it difficult to modify the NVRAM successfully using <i>efibootmgr</i>. If <i>efibootmgr</i> cannot successfully create an entry, you can use the <a href="../en/Unified_Extensible_Firmware_Interface.html#bcfg" class="mw-redirect" title="UEFI">bcfg</a> command in UEFI Shell v2 (i.e., from the <a rel="nofollow" class="external text" href="https://archlinux.org/download/">Arch Linux live iso</a>).
</p>
<p>First, find out the device number where your <a href="../en/EFI_system_partition.html" class="mw-redirect" title="ESP">ESP</a> resides with:
</p>
<pre>Shell&gt; map
</pre>
<p>In this example, <code>1</code> is used as the device number. To list the contents of the <a href="../en/EFI_system_partition.html" class="mw-redirect" title="ESP">ESP</a>:
</p>
<pre>Shell&gt; ls FS1:
</pre>
<p>To view the current boot entries:
</p>
<pre>Shell&gt; bcfg boot dump
</pre>
<p>To add an entry for your kernel, use:
</p>
<pre>Shell&gt; bcfg boot add <i>N</i> FS1:\vmlinuz-linux "Arch Linux"
</pre>
<p>Where <code><i>N</i></code> is the location where the entry will be added in the boot menu. 0 is the first menu item. Menu items already existing will be shifted in the menu without being discarded.
</p>
<p>You can add kernel options directly: 
</p>
<pre>Shell&gt; bcfg boot -opt <i>N</i> "root=/dev/sda2 initrd=\initramfs-linux.img"
</pre>
<p>Or by creating a file on your ESP:
</p>
<pre>Shell&gt; edit FS1:\options.txt
</pre>
<p>In the file, add the boot line. For example:
</p>
<pre>root=/dev/sda2 rw initrd=\initramfs-linux.img
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Add extra spaces in the beginning of the line in the file. There is a <a href="https://en.wikipedia.org/wiki/Byte_order_mark" class="extiw" title="wikipedia:Byte order mark">byte order mark</a> at the beginning of the line that will squash any character next to it which will cause an error when booting.</div>
<p>Press <code>F2</code> to save and then <code>F3</code> to exit.
</p>
<p>Add these options to your previous entry:
</p>
<pre>Shell&gt; bcfg boot -opt <i>N</i> FS1:\options.txt
</pre>
<p>Repeat this process for any additional entries.
</p>
<p>To remove a previously added item do:
</p>
<pre>Shell&gt; bcfg boot rm <i>N</i>
</pre>
<div class="mw-heading mw-heading3"><h3 id="Using_UEFI_Shell">Using UEFI Shell</h3></div>
<p>If you do not want to create a permanent boot entry it is possible to launch the kernel from UEFI Shell since it is a normal UEFI application:
</p>
<pre>&gt; FS0:
&gt; \vmlinuz-linux root=PARTUUID=3518bb68-d01e-45c9-b973-0b5d918aae96 rw initrd=\initramfs-linux.img
</pre>
<p>In this case, the kernel parameters are passed as normal parameters to the EFI boot stub kernel.
</p>
<p>To avoid needing to remember all of your kernel parameters every time, you can save the executable command to a shell script such as <code>archlinux.nsh</code> on your EFI system partition, then run it with:
</p>
<pre>&gt; FS0:
&gt; archlinux
</pre>
<div class="mw-heading mw-heading4"><h4 id="Using_a_startup.nsh_script">Using a startup.nsh script</h4></div>
<p>Some UEFI implementations do not retain EFI variables between cold boots (e.g. <a href="../en/VirtualBox.html" title="VirtualBox">VirtualBox</a> before version 6.1) and anything set through the UEFI is lost on poweroff.
</p>
<p>The <a rel="nofollow" class="external text" href="https://www.uefi.org/sites/default/files/resources/UEFI_Shell_Spec_2_0.pdf">UEFI Shell Specification 2.0</a> establishes that a script called <code>startup.nsh</code> at the root of the ESP partition will always be interpreted and can contain arbitrary instructions; among those you can set a bootloading line. Make sure you mount the ESP partition on <code>/boot</code> and create a <code>startup.nsh</code> script that contains a kernel bootloading line. For example:
</p>
<pre>vmlinuz-linux rw root=/dev/sd<i>X</i> [rootfs=<i>myfs</i>] [rootflags=<i>myrootflags</i>] \
 [kernel.flag=<i>foo</i>] [<i>mymodule</i>.flag=<i>bar</i>] \
 initrd=\initramfs-linux.img
</pre>
<p>This method will work with almost all UEFI versions you may encounter in real hardware, you can use it as last resort. <b>The script must be a single long line.</b> Sections in brackets are optional and given only as a guide. Shell style linebreaks are for visual clarification only. FAT filesystems use the backslash as path separator and in this case, the backslash declares the initramfs is located in the root of the ESP partition.
</p>
<div class="mw-heading mw-heading2"><h2 id="Tips_and_tricks">Tips and tricks</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Boot_entry_with_fallback_ramdisk">Boot entry with fallback ramdisk</h3></div>
<p>Without a boot manager, the kernel command line is not changeable at boot time. To have at least some sort of fallback possibility, e.g. to use the <code>initramfs-linux-fallback.img</code> and/or start without Intel microcode, simply create a further boot entry with <i>efibootmgr</i>, e.g. labeled "Arch Linux fallback" and the desired fallback options.
</p>
<div class="mw-heading mw-heading3"><h3 id="Archiso_on_ESP">Archiso on ESP</h3></div>
<p>It is possible to put the Arch Linux ISO on the ESP to have a recovery system. As of 2025.08.01 release the size required is 1.2G.
</p>
<p>First download <a rel="nofollow" class="external text" href="https://archlinux.org/download/">archlinux-YYYY.MM.DD-x86_64.iso</a>.
</p>
<p>Next, create a directory for archiso in your ESP:
</p>
<pre># mkdir -p <i>esp</i>/EFI/archiso
</pre>
<p>Extract the contents of the <code>arch</code> directory in there:
</p>
<pre># bsdtar -v -x --no-same-permissions --strip-components 1 -f archlinux-<i>YYYY</i>.<i>MM</i>.<i>DD</i>-x86_64.iso -C <i>esp</i>/EFI/archiso arch
</pre>
<p>In the last step, create a boot entry using <code>efibootmgr</code>. Replace the following:
</p>
<p><code>diskpath</code> is the device path (eg. /dev/sda)
</p>
<p><code>diskpart</code> is the partition number
</p>
<pre># efibootmgr --create --disk <i>diskpath</i> \
--part <i>diskpart</i> \
--label "Arch (rescue system)" \
--loader '\EFI\archiso\boot\x86_64\vmlinuz-linux' \
--unicode 'archisobasedir=/EFI/archiso archisosearchfilename=/EFI/archiso/boot/x86_64/vmlinuz-linux initrd=\EFI\archiso\boot\x86_64\initramfs-linux.img'
</pre>
<p>You can now choose the rescue system from the UEFI boot loader.
</p>
<div class="mw-heading mw-heading2"><h2 id="Troubleshooting">Troubleshooting</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Changes_to_boot_entries_are_not_applied">Changes to boot entries are not applied</h3></div>
<p>Some motherboards, such as Haswell-era ASUS boards (<a rel="nofollow" class="external text" href="https://forums.archlinux.fr/viewtopic.php?t=19618">as encountered on the french forum</a>), will not notice changes to boot entries unless the system is booted with another pre-existing one.
</p>
<div class="mw-heading mw-heading2"><h2 id="See_also">See also</h2></div>
<ul>
<li><a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/efi-stub.html">Linux Kernel Documentation - The EFI Boot Stub</a></li>
<li><a rel="nofollow" class="external text" href="https://git.kernel.org/?p=linux/kernel/git/torvalds/linux.git;a=commitdiff;h=291f36325f9f252bd76ef5f603995f37e453fc60;hp=55839d515495e766605d7aaabd9c2758370a8d27">Linux kernel commit - x86, efi: EFI boot stub support</a></li>
<li><a rel="nofollow" class="external text" href="https://www.rodsbooks.com/efi-bootloaders/efistub.html">Rod Smith's - Using the Kernel's EFI Stub Loader</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Boot_loaders.html" title="Category:Boot loaders">Boot loaders</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=EFI_boot_stub&amp;oldid=854328">https://wiki.archlinux.org/index.php?title=EFI_boot_stub&amp;oldid=854328</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 28 November 2025, at 01:09.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true"><span class="mw-page-title-main">EFI boot stub</span></div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
