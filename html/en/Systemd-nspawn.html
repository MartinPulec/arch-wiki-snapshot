<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>systemd-nspawn - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Systemd-nspawn rootpage-Systemd-nspawn skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Examples" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Examples">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Examples</div>
		</a>
		
			<button aria-controls="toc-Examples-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Examples subsection</span>
			</button>
		
		<ul id="toc-Examples-sublist" class="vector-toc-list">
			<li id="toc-Create_and_boot_a_minimal_Arch_Linux_container" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Create_and_boot_a_minimal_Arch_Linux_container">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Create and boot a minimal Arch Linux container</div>
			</a>
			
			<ul id="toc-Create_and_boot_a_minimal_Arch_Linux_container-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Create_a_Debian_or_Ubuntu_environment" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Create_a_Debian_or_Ubuntu_environment">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Create a Debian or Ubuntu environment</div>
			</a>
			
			<ul id="toc-Create_a_Debian_or_Ubuntu_environment-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Create_a_Fedora_or_AlmaLinux_environment" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Create_a_Fedora_or_AlmaLinux_environment">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Create a Fedora or AlmaLinux environment</div>
			</a>
			
			<ul id="toc-Create_a_Fedora_or_AlmaLinux_environment-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Build_and_test_packages" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Build_and_test_packages">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4</span>Build and test packages</div>
			</a>
			
			<ul id="toc-Build_and_test_packages-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Management" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Management">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Management</div>
		</a>
		
			<button aria-controls="toc-Management-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Management subsection</span>
			</button>
		
		<ul id="toc-Management-sublist" class="vector-toc-list">
			<li id="toc-Default_systemd-nspawn_options" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Default_systemd-nspawn_options">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Default systemd-nspawn options</div>
			</a>
			
			<ul id="toc-Default_systemd-nspawn_options-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-machinectl" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#machinectl">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>machinectl</div>
			</a>
			
			<ul id="toc-machinectl-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-systemd_toolchain" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#systemd_toolchain">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>systemd toolchain</div>
			</a>
			
			<ul id="toc-systemd_toolchain-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Configuration</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-Per-container_settings" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Per-container_settings">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Per-container settings</div>
			</a>
			
			<ul id="toc-Per-container_settings-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enable_container_to_start_at_boot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enable_container_to_start_at_boot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Enable container to start at boot</div>
			</a>
			
			<ul id="toc-Enable_container_to_start_at_boot-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Resource_control" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Resource_control">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Resource control</div>
			</a>
			
			<ul id="toc-Resource_control-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Networking" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Networking">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>Networking</div>
			</a>
			
			<ul id="toc-Networking-sublist" class="vector-toc-list">
				<li id="toc-Use_host_networking" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Use_host_networking">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4.1</span>Use host networking</div>
			</a>
			
			<ul id="toc-Use_host_networking-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Use_a_virtual_Ethernet_link" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Use_a_virtual_Ethernet_link">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4.2</span>Use a virtual Ethernet link</div>
			</a>
			
			<ul id="toc-Use_a_virtual_Ethernet_link-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Use_a_network_bridge" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Use_a_network_bridge">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4.3</span>Use a network bridge</div>
			</a>
			
			<ul id="toc-Use_a_network_bridge-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-Use_a_"macvlan"_or_"ipvlan"_interface' class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href='#Use_a_"macvlan"_or_"ipvlan"_interface'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4.4</span>Use a "macvlan" or "ipvlan" interface</div>
			</a>
			
			<ul id='toc-Use_a_"macvlan"_or_"ipvlan"_interface-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Use_an_existing_interface" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Use_an_existing_interface">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4.5</span>Use an existing interface</div>
			</a>
			
			<ul id="toc-Use_an_existing_interface-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Port_mapping" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Port_mapping">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.5</span>Port mapping</div>
			</a>
			
			<ul id="toc-Port_mapping-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Domain_name_resolution" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Domain_name_resolution">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.6</span>Domain name resolution</div>
			</a>
			
			<ul id="toc-Domain_name_resolution-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Tips and tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Running_non-shell/init_commands" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Running_non-shell/init_commands">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Running non-shell/init commands</div>
			</a>
			
			<ul id="toc-Running_non-shell/init_commands-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Unprivileged_containers" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Unprivileged_containers">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Unprivileged containers</div>
			</a>
			
			<ul id="toc-Unprivileged_containers-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Use_an_X_environment" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Use_an_X_environment">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Use an X environment</div>
			</a>
			
			<ul id="toc-Use_an_X_environment-sublist" class="vector-toc-list">
				<li id="toc-Avoiding_xhost" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Avoiding_xhost">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.1</span>Avoiding xhost</div>
			</a>
			
			<ul id="toc-Avoiding_xhost-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_X_nesting/Xephyr" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Using_X_nesting/Xephyr">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.2</span>Using X nesting/Xephyr</div>
			</a>
			
			<ul id="toc-Using_X_nesting/Xephyr-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Run_Firefox" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Run_Firefox">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.3</span>Run Firefox</div>
			</a>
			
			<ul id="toc-Run_Firefox-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-3D_graphics_acceleration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#3D_graphics_acceleration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.4</span>3D graphics acceleration</div>
			</a>
			
			<ul id="toc-3D_graphics_acceleration-sublist" class="vector-toc-list">
				<li id="toc-NVIDIA_GPUs" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#NVIDIA_GPUs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3.4.1</span>NVIDIA GPUs</div>
			</a>
			
			<ul id="toc-NVIDIA_GPUs-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Access_host_filesystem" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Access_host_filesystem">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>Access host filesystem</div>
			</a>
			
			<ul id="toc-Access_host_filesystem-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Run_on_a_non-systemd_system" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Run_on_a_non-systemd_system">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5</span>Run on a non-systemd system</div>
			</a>
			
			<ul id="toc-Run_on_a_non-systemd_system-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Use_Btrfs_subvolume_as_container_root" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Use_Btrfs_subvolume_as_container_root">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.6</span>Use Btrfs subvolume as container root</div>
			</a>
			
			<ul id="toc-Use_Btrfs_subvolume_as_container_root-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Use_temporary_Btrfs_snapshot_of_container" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Use_temporary_Btrfs_snapshot_of_container">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.7</span>Use temporary Btrfs snapshot of container</div>
			</a>
			
			<ul id="toc-Use_temporary_Btrfs_snapshot_of_container-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Run_docker_in_systemd-nspawn" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Run_docker_in_systemd-nspawn">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.8</span>Run docker in systemd-nspawn</div>
			</a>
			
			<ul id="toc-Run_docker_in_systemd-nspawn-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-execv(...)_failed:_Permission_denied" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#execv(...)_failed:_Permission_denied">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>execv(...) failed: Permission denied</div>
			</a>
			
			<ul id="toc-execv(...)_failed:_Permission_denied-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Terminal_type_in_TERM_is_incorrect_(broken_colors)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Terminal_type_in_TERM_is_incorrect_(broken_colors)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2</span>Terminal type in TERM is incorrect (broken colors)</div>
			</a>
			
			<ul id="toc-Terminal_type_in_TERM_is_incorrect_(broken_colors)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Mounting_a_NFS_share_inside_the_container" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Mounting_a_NFS_share_inside_the_container">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.3</span>Mounting a NFS share inside the container</div>
			</a>
			
			<ul id="toc-Mounting_a_NFS_share_inside_the_container-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">systemd-nspawn</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/Systemd-nspawn.html" title="Systemd-nspawn – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Systemd-nspawn" title="Systemd-nspawn – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Systemd-nspawn" title="Systemd-nspawn – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Systemd.html" title="Systemd">systemd</a></li>
<li><a href="../en/Linux_Containers.html" title="Linux Containers">Linux Containers</a></li>
<li><a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a></li>
<li><a href="../en/Docker.html" title="Docker">Docker</a></li>
</ul>
</div>
<p><i>systemd-nspawn</i> is like the <a href="../en/Chroot.html" title="Chroot">chroot</a> command, but it is a <i>chroot on steroids</i>.
</p>
<p><i>systemd-nspawn</i> may be used to run a command or OS in a light-weight namespace container. It is more powerful than <a href="../en/Chroot.html" title="Chroot">chroot</a> since it fully virtualizes the file system hierarchy, as well as the process tree, the various IPC subsystems and the host and domain name.
</p>
<p><i>systemd-nspawn</i> limits access to various kernel interfaces in the container to read-only, such as <code>/sys</code>, <code>/proc/sys</code> or <code>/sys/fs/selinux</code>. Network interfaces and the system clock may not be changed from within the container. Device nodes may not be created. The host system cannot be rebooted and kernel modules may not be loaded from within the container.
</p>
<p><i>systemd-nspawn</i> is a simpler tool to configure than <a href="../en/Linux_Containers.html" class="mw-redirect" title="LXC">LXC</a> or <a href="../en/Libvirt.html" title="Libvirt">Libvirt</a>.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><i>systemd-nspawn</i> is part of and packaged with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd">systemd</a></span>.
</p>
<h2><span class="mw-headline" id="Examples">Examples</span></h2>
<h3><span class="mw-headline" id="Create_and_boot_a_minimal_Arch_Linux_container">Create and boot a minimal Arch Linux container</span></h3>
<p>First install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=arch-install-scripts">arch-install-scripts</a></span>.
</p>
<p>Next, create a directory to hold the container. In this example we will use <code>~/MyContainer</code>. 
</p>
<p>Next, we use <i>pacstrap</i> to install a basic Arch system into the container. At minimum we need to install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=base">base</a></span> package. 
</p>
<pre># pacstrap -K -c ~/MyContainer base <i>[additional packages/groups]</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=base">base</a></span> package does not depend on the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span> kernel package and is container-ready.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If creating from a different operating system where <i>pacstrap</i> is not available, <a href="../en/Install_Arch_Linux_from_existing_Linux.html#Method_A:_Using_the_bootstrap_tarball_(recommended)" title="Install Arch Linux from existing Linux">bootstrap tarball</a> can be used as container image. pacman keyring will need to be initialized inside the container, see <a href="../en/Install_Arch_Linux_from_existing_Linux.html#Initializing_pacman_keyring" title="Install Arch Linux from existing Linux">Install Arch Linux from existing Linux#Initializing pacman keyring</a>.</div>
<p>Once your installation is finished, enter the container, and set a root password:
</p>
<pre># systemd-nspawn -D ~/MyContainer
# passwd
# logout
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Setting root password is optional. You can get a root shell in a booted container directly without having to log in by running <code>machinectl shell root@MyContainer</code>. See <a href="#machinectl">#machinectl</a>.</div>
<p>Finally, boot into the container:
</p>
<pre># systemd-nspawn -b -D ~/MyContainer
</pre>
<p>The <code>-b</code> option will boot the container (i.e. run <code>systemd</code> as PID=1), instead of just running a shell, and <code>-D</code> specifies the directory that becomes the container's root directory.
</p>
<p>After the container starts, log in as "root" with your password.
</p>
<p>The container can be powered off by running <code>poweroff</code> from within the container. From the host, containers can be controlled by the <a href="#machinectl">machinectl</a> tool.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> To terminate the <i>session</i> from within the container, hold <code>Ctrl</code> and rapidly press <code>]</code> three times.</div>
<h3><span class="mw-headline" id="Create_a_Debian_or_Ubuntu_environment">Create a Debian or Ubuntu environment</span></h3>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=debootstrap">debootstrap</a></span>, and one or both of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=debian-archive-keyring">debian-archive-keyring</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ubuntu-keyring">ubuntu-keyring</a></span> depending on which distribution you want.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <i>systemd-nspawn</i> requires that the operating system in the container uses <i>systemd</i> init (has it running as PID 1) and <i>systemd-nspawn</i> is installed in the container. These requirements can be satisfied by making sure the <i>systemd-container</i> package is installed on the container system. The <i>systemd-container</i> package depends on dbus, which is not installed by default. Make sure the <i>dbus</i> or <i>dbus-broker</i> package is installed on the container system.</div>
<p>From there it is rather easy to set up Debian or Ubuntu environments:
</p>
<pre># cd /var/lib/machines
# debootstrap --include=dbus-broker,systemd-container --components=main,universe <i>codename</i> <i>container-name</i> <i>repository-url</i>
</pre>
<p>For Debian, valid code names are either the rolling names like "stable" and "testing" or release names like "stretch" and "sid". For Ubuntu, the code name like "xenial" or "zesty" should be used. A complete list of code names is in <code>/usr/share/debootstrap/scripts</code> and the official table of code names to version numbers can be found in <a rel="nofollow" class="external autonumber" href="https://wiki.ubuntu.com/DevelopmentCodeNames#Release_Naming_Scheme">[1]</a>. In case of a Debian image the "repository-url" can be <a rel="nofollow" class="external free" href="https://deb.debian.org/debian/">https://deb.debian.org/debian/</a>. For an Ubuntu image, the "repository-url" can be <a rel="nofollow" class="external free" href="http://archive.ubuntu.com/ubuntu/">http://archive.ubuntu.com/ubuntu/</a>. "repository-url" should <i>not</i> contain a trailing slash.
</p>
<p>Just like Arch, Debian and Ubuntu will not let you log in without a password. To set the root password, run <i>systemd-nspawn</i> without the <code>-b</code> option:
</p>
<pre># cd /var/lib/machines
# systemd-nspawn -D ./<i>container-name</i>
# passwd
# logout
</pre>
<h3><span class="mw-headline" id="Create_a_Fedora_or_AlmaLinux_environment">Create a Fedora or AlmaLinux environment</span></h3>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dnf">dnf</a></span>, and edit the <code>/etc/dnf/dnf.conf</code> file to add the required Fedora repositories.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dnf/dnf.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[fedora]                                                                                            
name=Fedora $releasever - $basearch
metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever&amp;arch=$basearch
gpgkey=https://getfedora.org/static/fedora.gpg

[updates]                                                                                           
name=Fedora $releasever - $basearch - Updates
metalink=https://mirrors.fedoraproject.org/metalink?repo=updates-released-f$releasever&amp;arch=$basearch
gpgkey=https://getfedora.org/static/fedora.gpg</pre>
<p>The <i>fedora.gpg</i> file contain the gpg keys for the latest Fedora releases <a rel="nofollow" class="external free" href="https://getfedora.org/security/">https://getfedora.org/security/</a>. To set up a minimal Fedora 37 container:
</p>
<pre># cd /var/lib/machines
# mkdir <i>container-name</i>
# dnf --releasever=37 --best --setopt=install_weak_deps=False --repo=fedora --repo=updates --installroot=/var/lib/machines/<i>container-name</i> install dhcp-client dnf fedora-release glibc glibc-langpack-en iputils less ncurses passwd systemd systemd-networkd systemd-resolved util-linux vim-default-editor
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  If you want to install a different Fedora release, keep in mind that different releases will have distinct <a rel="nofollow" class="external text" href="https://docs.fedoraproject.org/en-US/fedora-server/containerization/systemd-nspawn-setup/#_2_1_creating_a_container_directory_tree">package requirements</a>.
<p>If you are using btrfs filesystem create a subvolume instead of creating a directory.
</p>
</div>
<p>An Enterprise Linux derivative like AlmaLinux has three repositories enabled by default, <i>BaseOS</i> wich contains a core set that provides the basis for all installations, <i>AppStream</i> that includes additional applications, language packages, etc and <i>Extras</i> that contains packages not included in RHEL. So for a minimal container we only need to add the BaseOS repository to <code>/etc/dnf/dnf.conf</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dnf/dnf.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[baseos]                                                                                            
name=AlmaLinux $releasever - BaseOS                                          
mirrorlist=https://mirrors.almalinux.org/mirrorlist/$releasever/baseos       
gpgkey=https://repo.almalinux.org/almalinux/RPM-GPG-KEY-AlmaLinux-$releasever</pre>
<p>To create an AlmaLinux 9 minimal container:
</p>
<pre># dnf --repo=baseos --releasever=9 --best --installroot=/var/lib/machines/<i>container-name</i> --setopt=install_weak_deps=False install almalinux-release dhcp-client dnf glibc-langpack-en iproute iputils less passwd systemd vim-minimal
</pre>
<p>This will install the latest minor version of AlmaLinux 9, you can choose to install a specific point release, but you will need to change the <i>gpgpkey</i> entry to manually point to <i>RPM-GPG-KEY-AlmaLinux-9</i>
</p>
<p>Just like Arch, Fedora or AlmaLinux will not let you log in as root without a password. To set up the root password, run <i>systemd-nspawn</i> without the <code>-b</code> option:
</p>
<pre># systemd-nspawn -D /var/lib/machines/<i>container-name</i> passwd
</pre>
<h3><span class="mw-headline" id="Build_and_test_packages">Build and test packages</span></h3>
<p>See <a href="../en/Creating_packages_for_other_distributions.html" title="Creating packages for other distributions">Creating packages for other distributions</a> for example uses.
</p>
<h2><span class="mw-headline" id="Management">Management</span></h2>
<p>Containers located in <code>/var/lib/machines/</code> can be controlled by the <i>machinectl</i> command, which internally controls instances of the <code>systemd-nspawn@.service</code> unit. The subdirectories in <code>/var/lib/machines/</code> correspond to the container names, i.e. <code>/var/lib/machines/<i>container-name</i>/</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If the container cannot be moved into <code>/var/lib/machines/</code> for some reason, it can be symlinked. See <span class="plainlinks archwiki-template-man" title="$ man 1 machinectl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/machinectl.1#FILES_AND_DIRECTORIES">machinectl(1) § FILES AND DIRECTORIES</a></span> for details.</div>
<h3><span class="mw-headline" id="Default_systemd-nspawn_options">Default systemd-nspawn options</span></h3>
<p>Note that containers started via <i>machinectl</i> or <code>systemd-nspawn@.service</code> use different default options than containers started manually by the <i>systemd-nspawn</i> command. The extra options used by the service are:
</p>
<ul>
<li>
<code>-b</code>/<code>--boot</code> – Managed containers automatically search for an init program and invoke it as PID 1.</li>
<li>
<code>--network-veth</code> which implies <code>--private-network</code> – Managed containers get a virtual network interface and are disconnected from the host network. See <a href="#Networking">#Networking</a> for details.</li>
<li>
<code>-U</code> – Managed containers use the <span class="plainlinks archwiki-template-man" title="$ man 7 user_namespaces"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/user_namespaces.7">user_namespaces(7)</a></span> feature by default if supported by the kernel. See <a href="#Unprivileged_containers">#Unprivileged containers</a> for implications.</li>
<li><code>--link-journal=try-guest</code></li>
</ul>
<p>This behavior can be overridden in per-container configuration files. See <a href="#Configuration">#Configuration</a> for details.
</p>
<h3><span class="mw-headline" id="machinectl">machinectl</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <i>machinectl</i> tool requires <a href="../en/Systemd.html" title="Systemd">systemd</a> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dbus">dbus</a></span> to be installed in the container. See <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/685">[2]</a> for detailed discussion.</div>
<p>Containers can be managed by the <code>machinectl <i>subcommand</i> <i>container-name</i></code> command. For example, to start a container:
</p>
<pre>$ machinectl start <i>container-name</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <i>machinectl</i> requires that the container-name consists of only ASCII letters, digits and hyphens so that they are valid <a href="../en/Network_configuration.html#Set_the_hostname" class="mw-redirect" title="Hostname">hostnames</a>. For example, if the container-name contains an underscore, it simply will not be recognized and running <code>machinectl start container_name</code> will result in error <code>Invalid machine name container_name</code>. See <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/11765">[3]</a> and <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/commit/d65652f1f21a4b0c59711320f34266c635393c89">[4]</a> for more details.</div>
<p>Similarly, there are subcommands such as <code>poweroff</code>, <code>reboot</code>, <code>status</code> and <code>show</code>. See <span class="plainlinks archwiki-template-man" title="$ man 1 machinectl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/machinectl.1#Machine_Commands">machinectl(1) § Machine Commands</a></span> for detailed explanations.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Poweroff and reboot operations can be performed from within the container using the <code>poweroff</code> and <code>reboot</code> commands.</div>
<p>Other common commands are:
</p>
<ul>
<li>
<code>machinectl list</code> – show a list of currently running containers</li>
<li>
<code>machinectl login <i>container-name</i></code> – open an interactive login session in a container</li>
<li>
<code>machinectl shell <i>[username@]container-name</i></code> – open an interactive shell session in a container (this immediately invokes a user process without going through the login process in the container)</li>
<li>
<code>machinectl enable <i>container-name</i></code> and <code>machinectl disable <i>container-name</i></code> – enable or disable a container to start at boot, see <a href="#Enable_container_to_start_at_boot">#Enable container to start at boot</a> for details</li>
</ul>
<p><i>machinectl</i> also has subcommands for managing container (or virtual machine) images and image transfers. See <span class="plainlinks archwiki-template-man" title="$ man 1 machinectl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/machinectl.1#Image_Commands">machinectl(1) § Image Commands</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 1 machinectl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/machinectl.1#Image_Transfer_Commands">machinectl(1) § Image Transfer Commands</a></span> for details. As of 2023Q1, the first 3 examples at <span class="plainlinks archwiki-template-man" title="$ man 1 machinectl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/machinectl.1#EXAMPLES">machinectl(1) § EXAMPLES</a></span> demonstrate image transfer commands. <span class="plainlinks archwiki-template-man" title="$ man 1 machinectl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/machinectl.1#FILES_AND_DIRECTORIES">machinectl(1) § FILES AND DIRECTORIES</a></span> discusses where to find suitable images.
</p>
<h3><span class="mw-headline" id="systemd_toolchain">systemd toolchain</span></h3>
<p>Much of the core systemd toolchain has been updated to work with containers. Tools that do usually provide a <code>-M, --machine=</code> option which will take a container name as argument.
</p>
<p>Examples:
</p>
<p>See journal logs for a particular machine:
</p>
<pre># journalctl -M <i>container-name</i>
</pre>
<p>Show control group contents:
</p>
<pre>$ systemd-cgls -M <i>container-name</i>
</pre>
<p>See startup time of container:
</p>
<pre>$ systemd-analyze -M <i>container-name</i>
</pre>
<p>For an overview of resource usage:
</p>
<pre>$ systemd-cgtop
</pre>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<h3><span class="mw-headline" id="Per-container_settings">Per-container settings</span></h3>
<p>To specify per-container settings and not global overrides, the <i>.nspawn</i> files can be used. See <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.nspawn"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.nspawn.5">systemd.nspawn(5)</a></span> for details.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>
<i>.nspawn</i> files may be removed unexpectedly from <code>/etc/systemd/nspawn/</code> when you run <code>machinectl remove</code>. <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/15900">[5]</a>
</li>
<li>The interaction of network options specified in the <i>.nspawn</i> file and on the command line does not work correctly when there is <code>--settings=override</code> (which is specified in the <code>systemd-nspawn@.service</code> file). <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/12313#issuecomment-681116926">[6]</a> As a workaround, you need to include the option <code>VirtualEthernet=on</code>, even though the service specifies <code>--network-veth</code>.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Enable_container_to_start_at_boot">Enable container to start at boot</span></h3>
<p>When using a container frequently, you may want to start it at boot.
</p>
<p>First make sure that the <code>machines.target</code> is <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enabled">enabled</a>.
</p>
<p>Containers discoverable by <a href="#machinectl">machinectl</a> can be enabled or disabled:
</p>
<pre>$ machinectl enable <i>container-name</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>This has the effect of enabling the <code>systemd-nspawn@<i>container-name</i>.service</code> systemd unit.</li>
<li>As mentioned in <a href="#Default_systemd-nspawn_options">#Default systemd-nspawn options</a>, containers started by <i>machinectl</i> get a virtual Ethernet interface. To disable private networking, see <a href="#Use_host_networking">#Use host networking</a>.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Resource_control">Resource control</span></h3>
<p>You can take advantage of control groups to implement limits and resource management of your containers with <code>systemctl set-property</code>, see <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.resource-control"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.resource-control.5">systemd.resource-control(5)</a></span>. For example, you may want to limit the memory amount or CPU usage. To limit the memory consumption of your container to 2 GiB:
</p>
<pre># systemctl set-property systemd-nspawn@<i>container-name</i>.service MemoryMax=2G
</pre>
<p>Or to limit the CPU time usage to roughly the equivalent of 2 cores:
</p>
<pre># systemctl set-property systemd-nspawn@<i>container-name</i>.service CPUQuota=200%
</pre>
<p>This will create permanent files in <code>/etc/systemd/system.control/systemd-nspawn@<i>container-name</i>.service.d/</code>.
</p>
<p>According to the documentation, <code>MemoryHigh</code> is the preferred method to keep in check memory consumption, but it will not be hard-limited as is the case with <code>MemoryMax</code>. You can use both options leaving <code>MemoryMax</code> as the last line of defense. Also take in consideration that you will not limit the number of CPUs the container can see, but you will achieve similar results by limiting how much time the container will get at maximum, relative to the total CPU time.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you want these changes to be only temporary, you can pass the option <code>--runtime</code>. You can check their results with <i>systemd-cgtop</i>.</div>
<h3><span class="mw-headline" id="Networking">Networking</span></h3>
<p><i>systemd-nspawn</i> containers can use either <i>host networking</i> or <i>private networking</i>:
</p>
<ul>
<li>In the host networking mode, the container has full access to the host network. This means that the container will be able to access all network services on the host and packets coming from the container will appear to the outside network as coming from the host (i.e. sharing the same IP address).</li>
<li>In the private networking mode, the container is disconnected from the host's network. This makes all network interfaces unavailable to the container, with the exception of the loopback device and those explicitly assigned to the container. There is a number of different ways to set up network interfaces for the container:
<ul>
<li>An existing interface can be assigned to the container (e.g. if you have multiple Ethernet devices).</li>
<li>A virtual network interface associated with an existing interface (i.e. <a href="../en/VLAN.html" title="VLAN">VLAN</a> interface) can be created and assigned to the container.</li>
<li>A virtual Ethernet link between the host and the container can be created.</li>
</ul>
</li>
</ul>
<dl><dd>In the latter case the container's network is fully isolated (from the outside network as well as other containers) and it is up to the administrator to configure networking between the host and the containers. This typically involves creating a <a href="../en/Network_bridge.html" title="Network bridge">network bridge</a> to connect multiple (physical or virtual) interfaces or setting up a <a href="https://en.wikipedia.org/wiki/Network_Address_Translation" class="extiw" title="wikipedia:Network Address Translation">Network Address Translation</a> between multiple interfaces.</dd></dl>
<p>The host networking mode is suitable for <i>application containers</i> which do not run any networking software that would configure the interface assigned to the container. Host networking is the default mode when you run <i>systemd-nspawn</i> from the shell.
</p>
<p>On the other hand, the private networking mode is suitable for <i>system containers</i> that should be isolated from the host system. The creation of virtual Ethernet links is a very flexible tool allowing to create complex virtual networks. This is the default mode for containers started by <i>machinectl</i> or <code>systemd-nspawn@.service</code>.
</p>
<p>The following subsections describe common scenarios. See <span class="plainlinks archwiki-template-man" title="$ man 1 systemd-nspawn"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-nspawn.1#Networking_Options">systemd-nspawn(1) § Networking Options</a></span> for details about the available <i>systemd-nspawn</i> options.
</p>
<h4><span class="mw-headline" id="Use_host_networking">Use host networking</span></h4>
<p>To disable private networking and the creation of a virtual Ethernet link used by containers started with <i>machinectl</i>, add a <i>.nspawn</i> file with the following option:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/nspawn/<i>container-name</i>.nspawn</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Network]
VirtualEthernet=no</pre>
<p>This will override the <code>-n</code>/<code>--network-veth</code> option used in <code>systemd-nspawn@.service</code> and the newly started containers will use the host networking mode.
</p>
<h4><span class="mw-headline" id="Use_a_virtual_Ethernet_link">Use a virtual Ethernet link</span></h4>
<p>If a container is started with the <code>-n</code>/<code>--network-veth</code> option, <i>systemd-nspawn</i> will create a virtual Ethernet link between the host and the container. The host side of the link will be available as a network interface named <code>ve-<i>container-name</i></code>. The container side of the link will be named <code>host0</code>. Note that this option implies <code>--private-network</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>If the container name is too long, the interface name will be shortened (e.g. <code>ve-long-conKQGh</code> instead of <code>ve-long-container-name</code>) to fit into the <a rel="nofollow" class="external text" href="https://stackoverflow.com/a/29398765">15-characters limit</a>. The full name will be set as the <code>altname</code> property of the interface (see <span class="plainlinks archwiki-template-man" title="$ man 8 ip-link"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ip-link.8">ip-link(8)</a></span>) and can be still used to reference the interface.</li>
<li>When examining the interfaces with <code>ip link</code>, interface names will be shown with a suffix, such as <code>ve-<i>container-name</i>@if2</code> and <code>host0@if9</code>. The <code>@if<i>N</i></code> is not actually part of the interface name; instead, <code>ip link</code> appends this information to indicate which "slot" the virtual Ethernet cable connects to on the other end.</li>
</ul>
<dl><dd>For example, a host virtual Ethernet interface shown as <code>ve-<i>foo</i>@if2</code> is connected to the container <code><i>foo</i></code>, and inside the container to the second network interface – the one shown with index 2 when running <code>ip link</code> inside the container. Similarly, the interface named <code>host0@if9</code> in the container is connected to the 9th network interface on the host.</dd></dl>
</div>
<p>When you start the container, an IP address has to be assigned to both interfaces (on the host and in the container). If you use <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> on the host as well as in the container, this is done out-of-the-box:
</p>
<ul>
<li>the <code>/usr/lib/systemd/network/80-container-ve.network</code> file on the host matches the <code>ve-<i>container-name</i></code> interface and starts a DHCP server, which assigns IP addresses to the host interface as well as the container,</li>
<li>the <code>/usr/lib/systemd/network/80-container-host0.network</code> file in the container matches the <code>host0</code> interface and starts a DHCP client, which receives an IP address from the host.</li>
</ul>
<p>If you do not use <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a>, you can configure static IP addresses or start a DHCP server on the host interface and a DHCP client in the container. See <a href="../en/Network_configuration.html" title="Network configuration">Network configuration</a> for details.
</p>
<p>To give the container access to the outside network, you can configure NAT as described in <a href="../en/Internet_sharing.html#Enable_NAT" title="Internet sharing">Internet sharing#Enable NAT</a>. If you use <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a>, this is done (partially) automatically via the <code>IPMasquerade=both</code> option in <code>/usr/lib/systemd/network/80-container-ve.network</code>. However, this issues just one <a href="../en/Iptables.html" title="Iptables">iptables</a> (or <a href="../en/Nftables.html" title="Nftables">nftables</a>) rule such as
</p>
<pre>-t nat -A POSTROUTING -s 192.168.163.192/28 -j MASQUERADE
</pre>
<p>The <code>filter</code> table has to be configured manually as shown in <a href="../en/Internet_sharing.html#Enable_NAT" title="Internet sharing">Internet sharing#Enable NAT</a>. You can use a wildcard to match all interfaces starting with <code>ve-</code>:
</p>
<pre># iptables -A FORWARD -i ve-+ -o <i>internet0</i> -j ACCEPT
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <i>systemd-networkd</i> and <i>systemd-nspawn</i> can interface with <a href="../en/Iptables.html" title="Iptables">iptables</a> (using the <a rel="nofollow" class="external text" href="https://tldp.org/HOWTO/Querying-libiptc-HOWTO/whatis.html">libiptc</a> library) as well as with <a href="../en/Nftables.html" title="Nftables">nftables</a> <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/13307">[7]</a><a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/blob/9ca34cf5a4a20d48f829b2a36824255aac29078c/NEWS#L295-L304">[8]</a>. In both cases IPv4 and IPv6 NAT is supported.</div>
<p>Additionally, you need to open the UDP port 67 on the <code>ve-+</code> interfaces for incoming connections to the DHCP server (operated by <i>systemd-networkd</i>):
</p>
<pre># iptables -A INPUT -i ve-+ -p udp -m udp --dport 67 -j ACCEPT
</pre>
<h4><span class="mw-headline" id="Use_a_network_bridge">Use a network bridge</span></h4>
<p>If you have configured a <a href="../en/Network_bridge.html" title="Network bridge">network bridge</a> on the host system, you can create a virtual Ethernet link for the container and add its host side to the network bridge. This is done with the <code>--network-bridge=<i>bridge-name</i></code> option. Note that <code>--network-bridge</code> implies <code>--network-veth</code>, i.e. the virtual Ethernet link is created automatically. However, the host side of the link will use the <code>vb-</code> prefix instead of <code>ve-</code>, so the <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> options for starting the DHCP server and IP masquerading will not be applied.
</p>
<p>The bridge management is left to the administrator. For example, the bridge can connect virtual interfaces with a physical interface, or it can connect only virtual interfaces of several containers. See <a href="../en/Systemd-networkd.html#Network_bridge_with_DHCP" title="Systemd-networkd">systemd-networkd#Network bridge with DHCP</a> and <a href="../en/Systemd-networkd.html#Network_bridge_with_static_IP_addresses" title="Systemd-networkd">systemd-networkd#Network bridge with static IP addresses</a> for example configurations using <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a>.
</p>
<p>There is also a <code>--network-zone=<i>zone-name</i></code> option which is similar to <code>--network-bridge</code> but the network bridge is managed automatically by <i>systemd-nspawn</i> and <i>systemd-networkd</i>. The bridge interface named <code>vz-<i>zone-name</i></code> is automatically created when the first container configured with <code>--network-zone=<i>zone-name</i></code> is started, and is automatically removed when the last container configured with <code>--network-zone=<i>zone-name</i></code> exits. Hence, this option makes it easy to place multiple related containers on a common virtual network. Note that <code>vz-*</code> interfaces are managed by <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> same way as <code>ve-*</code> interfaces using the options from the <code>/usr/lib/systemd/network/80-container-vz.network</code> file.
</p>
<h4>
<span id="Use_a_.22macvlan.22_or_.22ipvlan.22_interface"></span><span class="mw-headline" id='Use_a_"macvlan"_or_"ipvlan"_interface'>Use a "macvlan" or "ipvlan" interface</span>
</h4>
<p>Instead of creating a virtual Ethernet link (whose host side may or may not be added to a bridge), you can create a virtual interface on an existing physical interface (i.e. <a href="../en/VLAN.html" title="VLAN">VLAN</a> interface) and add it to the container. The virtual interface will be bridged with the underlying host interface and thus the container will be exposed to the outside network, which allows it to obtain a distinct IP address via DHCP from the same LAN as the host is connected to.
</p>
<p><i>systemd-nspawn</i> offers 2 options:
</p>
<ul>
<li>
<code>--network-macvlan=<i>interface</i></code> – the virtual interface will have a different MAC address than the underlying physical <code><i>interface</i></code> and will be named <code>mv-<i>interface</i></code>.</li>
<li>
<code>--network-ipvlan=<i>interface</i></code> – the virtual interface will have the same MAC address as the underlying physical <code><i>interface</i></code> and will be named <code>iv-<i>interface</i></code>.</li>
</ul>
<p>Both options imply <code>--private-network</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> To allow the host to communicate with the container, create a macvlan or ipvlan interface on the host attaching it to the same physical interface as the container uses and set up a network connection on it. Make sure the virtual interface name does not conflict with the virtual interface created by <i>systemd-nspawn</i>. See <a href="../en/Systemd-networkd.html#MACVLAN_bridge" title="Systemd-networkd">systemd-networkd#MACVLAN bridge</a> for an example using <i>systemd-networkd</i>.</div>
<h4><span class="mw-headline" id="Use_an_existing_interface">Use an existing interface</span></h4>
<p>If the host system has multiple physical network interfaces, you can use the <code>--network-interface=<i>interface</i></code> to assign <code><i>interface</i></code> to the container (and make it unavailable to the host while the container is started). Note that <code>--network-interface</code> implies <code>--private-network</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Passing wireless network interfaces to <i>systemd-nspawn</i> containers is currently not supported. <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/7873">[9]</a>
</div>
<h3><span class="mw-headline" id="Port_mapping">Port mapping</span></h3>
<p>When private networking is enabled, individual ports on the host can be mapped to ports on the container using the <code>-p</code>/<code>--port</code> option or by using the <code>Port</code> setting in an <i>.nspawn</i> file. For example, to map a TCP port 8000 on the host to the TCP port 80 in the container:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/nspawn/<i>container-name</i>.nspawn</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Network]
Port=tcp:8000:80</pre>
<p>This works by issuing <a href="../en/Iptables.html" title="Iptables">iptables</a> rules to the <code>nat</code> table, but the <code>FORWARD</code> chain in the <code>filter</code> table needs to be configured manually as shown in <a href="#Use_a_virtual_Ethernet_link">#Use a virtual Ethernet link</a>. Additionally, if you followed <a href="../en/Simple_stateful_firewall.html" title="Simple stateful firewall">Simple stateful firewall</a>, run the following command to allow new connections to the host's <code><i>wan_interface</i></code> on a forwarded port to be established:
</p>
<pre># iptables -A FORWARD -i <i>wan_interface</i> -o ve-+ -p tcp --syn --dport 8000 -m conntrack --ctstate NEW -j ACCEPT
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <i>systemd-nspawn</i> explicitly excludes the <code>loopback</code> interface when mapping ports. Hence, for the example above, <code>localhost:8000</code> connects to the host and not to the container. Only connections to other interfaces are subjected to port mapping. See <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/6106">[10]</a> for details.</div>
<h3><span class="mw-headline" id="Domain_name_resolution">Domain name resolution</span></h3>
<p><a href="../en/Domain_name_resolution.html" title="Domain name resolution">Domain name resolution</a> in the container can be configured the same way as on the host system. Additionally, <i>systemd-nspawn</i> provides options to manage the <code>/etc/resolv.conf</code> file inside the container:
</p>
<ul>
<li>
<code>--resolv-conf</code> can be used on command-line</li>
<li>
<code>ResolvConf=</code> can be used in <i>.nspawn</i> files</li>
</ul>
<p>These corresponding options have many possible values which are described in <span class="plainlinks archwiki-template-man" title="$ man 1 systemd-nspawn"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-nspawn.1#Integration_Options">systemd-nspawn(1) § Integration Options</a></span>. The default value is <code>auto</code>, which means that:
</p>
<ul>
<li>If <code>--private-network</code> is enabled, the <code>/etc/resolv.conf</code> is left as it is in the container.</li>
<li>Otherwise, if <a href="../en/Systemd-resolved.html" title="Systemd-resolved">systemd-resolved</a> is running on the host, its stub <code>resolv.conf</code> file is copied or bind-mounted into the container.</li>
<li>Otherwise, the <code>/etc/resolv.conf</code> file is copied or bind-mounted from the host to the container.</li>
</ul>
<p>In the last two cases, the file is copied, if the container root is writeable, and bind-mounted if it is read-only.
</p>
<p>For the second case where <a href="../en/Systemd-resolved.html" title="Systemd-resolved">systemd-resolved</a> runs on the host, <i>systemd-nspawn</i> expects it to also run in the container, so that the container can use the stub symlink file <code>/etc/resolv.conf</code> from the host. If not, the default value <code>auto</code> no longer works, and you should replace the symlink by using one of the <code>replace-*</code> options.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3>
<span id="Running_non-shell.2Finit_commands"></span><span class="mw-headline" id="Running_non-shell/init_commands">Running non-shell/init commands</span>
</h3>
<p>From <span class="plainlinks archwiki-template-man" title="$ man 1 systemd-nspawn"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-nspawn.1#Execution_Options">systemd-nspawn(1) § Execution Options</a></span>:
</p>
<dl><dd>[The option] <code>--as-pid2</code> [invokes] the shell or specified program as process ID (PID) 2 instead of PID 1 (init). [...] It is recommended to use this mode to invoke arbitrary commands in containers, unless they have been modified to run correctly as PID 1. <b>Or in other words: this switch should be used for pretty much all commands</b>, except when the command refers to an init or shell implementation [...] This option may not be combined with <code>--boot</code>.</dd></dl>
<h3><span class="mw-headline" id="Unprivileged_containers">Unprivileged containers</span></h3>
<p><i>systemd-nspawn</i> supports unprivileged containers, though the containers need to be booted as root.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> Very little of <a href="../en/Linux_Containers.html#Enable_support_to_run_unprivileged_containers_(optional)" title="Linux Containers">Linux Containers#Enable support to run unprivileged containers (optional)</a> applies to systemd-nspawn. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Systemd-nspawn.html">Talk:Systemd-nspawn</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This feature requires <span class="plainlinks archwiki-template-man" title="$ man 7 user_namespaces"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/user_namespaces.7">user_namespaces(7)</a></span>, for further info see <a href="../en/Linux_Containers.html#Enable_support_to_run_unprivileged_containers_(optional)" title="Linux Containers">Linux Containers#Enable support to run unprivileged containers (optional)</a>.</div>
<p>The easiest way to do this is to let <i>systemd-nspawn</i> automatically choose an unused range of UIDs/GIDs by using the <code>-U</code> option:
</p>
<pre># systemd-nspawn -bUD ~/MyContainer
</pre>
<p>If kernel supports user namespaces, the <code>-U</code> option is equivalent to <code>--private-users=pick --private-users-ownership=auto</code>. See <span class="plainlinks archwiki-template-man" title="$ man 1 systemd-nspawn"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-nspawn.1#User_Namespacing_Options">systemd-nspawn(1) § User Namespacing Options</a></span> for details.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You can also specify the UID/GID range of the container manually, however, this is rarely useful.</div>
<p>If a container has been started with a private UID/GID range using the <code>--private-users-ownership=chown</code> option (or on a filesystem where <code>-U</code> requires <code>--private-users-ownership=chown</code>), you need to keep using it that way to avoid permission errors. Alternatively, it is possible to undo the effect of <code>--private-users-ownership=chown</code> on the container's file system by specifying a range of IDs starting at 0:
</p>
<pre># systemd-nspawn -D ~/MyContainer --private-users=0 --private-users-ownership=chown
</pre>
<h3><span class="mw-headline" id="Use_an_X_environment">Use an X environment</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> The note about the systemd version at the end of this section seems to be obsolete. For me (systemd version 239) X applications also work if <code>/tmp/.X11-unix</code> is bound rw. (Discuss in <a href="../en/Talk:Systemd-nspawn.html#/tmp/.X11-unix_contents_have_to_be_bind-mounted_as_read-only_-_still_relevant?" title="Talk:Systemd-nspawn">Talk:Systemd-nspawn#/tmp/.X11-unix contents have to be bind-mounted as read-only - still relevant?</a>)</div>
</div>
<p>See <a href="../en/Xhost.html" title="Xhost">Xhost</a> and <a href="../en/Chroot.html#Run_graphical_applications_from_chroot" class="mw-redirect" title="Change root">Change root#Run graphical applications from chroot</a>.
</p>
<p>You will need to set the <code>DISPLAY</code> environment variable inside your container session to connect to the external X server.
</p>
<p>X stores some required files in the <code>/tmp</code> directory. In order for your container to display anything, it needs access to those files. To do so, append the <code>--bind-ro=/tmp/.X11-unix</code> option when starting the container.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Since systemd version 235, <code>/tmp/.X11-unix</code> contents <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/7093">have to be bind-mounted as read-only</a>, otherwise they will disappear from the filesystem. The read-only mount flag does not prevent using <code>connect()</code> syscall on the socket. If you binded also <code>/run/user/1000</code> then you might want to explicitly bind <code>/run/user/1000/bus</code> as read-only to protect the dbus socket from being deleted. </div>
<h4><span class="mw-headline" id="Avoiding_xhost">Avoiding xhost</span></h4>
<p><code>xhost</code> only provides rather coarse access rights to the X server. More fine-grained access control is possible via the <code>$XAUTHORITY</code> file. Unfortunately, just making the <code>$XAUTHORITY</code> file accessible in the container will not do the job:
your <code>$XAUTHORITY</code> file is specific to your host, but the container is a different host.
The following trick adapted from <a rel="nofollow" class="external text" href="https://stackoverflow.com/a/25280523">stackoverflow</a> can be used to make your X server accept the <code>$XAUTHORITY</code> file from an X application run inside the container:
</p>
<pre>$ XAUTH=/tmp/container_xauth
$ xauth nextract - "$DISPLAY" | sed -e 's/^..../ffff/' | xauth -f "$XAUTH" nmerge -
# systemd-nspawn -D myContainer --bind=/tmp/.X11-unix --bind="$XAUTH" -E DISPLAY="$DISPLAY" -E XAUTHORITY="$XAUTH" --as-pid2 /usr/bin/xeyes
</pre>
<p>The second line above sets the connection family to "FamilyWild", value <code>65535</code>, which causes the entry to match every display. See <span class="plainlinks archwiki-template-man" title="$ man 7 Xsecurity"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/Xsecurity.7">Xsecurity(7)</a></span> for more information.
</p>
<h4>
<span id="Using_X_nesting.2FXephyr"></span><span class="mw-headline" id="Using_X_nesting/Xephyr">Using X nesting/Xephyr</span>
</h4>
<p>Another simple way to run X applications and avoid the risks of a shared X desktop is using X nesting.
The advantages here are avoiding interaction between in-container applications and non-container applications entirely and being able to run a different <a href="../en/Desktop_environment.html" title="Desktop environment">desktop environment</a> or <a href="../en/Window_manager.html" title="Window manager">window manager</a>. The downsides are less performance, and the lack of hardware acceleration when using <a href="../en/Xephyr.html" title="Xephyr">Xephyr</a>.
</p>
<p>Start Xephyr outside of the container using:
</p>
<pre># Xephyr :1 -resizeable
</pre>
<p>Then start the container with the following options:
</p>
<pre>--setenv=DISPLAY=:1 --bind-ro=/tmp/.X11-unix/X1
</pre>
<p>No other binds are necessary.
</p>
<p>You might still need to manually set <code>DISPLAY=:1</code> in the container under some circumstances (mostly if used with <code>-b</code>).
</p>
<h4><span class="mw-headline" id="Run_Firefox">Run Firefox</span></h4>
<pre> # systemd-nspawn --setenv=DISPLAY=:0 \
              --setenv=XAUTHORITY=~/.Xauthority \
              --bind-ro=$HOME/.Xauthority:/root/.Xauthority \
              --bind=/tmp/.X11-unix \
              -D ~/containers/firefox \
              --as-pid2 \
              firefox
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> As such, firefox is run as the root user which comes with its own risks if not using <a href="#Unprivileged_containers">#Unprivileged containers</a>. In that case, you may first opt to <a href="../en/Users_and_groups.html#Example_adding_a_user" title="Users and groups">add a user</a> inside the container, and then add the <code>--user &lt;username&gt;</code> option in <i>systemd-nspawn</i> invocation.</div>
<p>Alternatively you can boot the container and let e.g. <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> set up the virtual network interface:
</p>
<pre># systemd-nspawn --bind-ro=$HOME/.Xauthority:/root/.Xauthority \
              --bind=/tmp/.X11-unix \
              -D ~/containers/firefox \
              --network-veth -b
</pre>
<p>Once your container is booted, run the Xorg binary like so:
</p>
<pre># systemd-run -M firefox --setenv=DISPLAY=:0 firefox
</pre>
<h4><span class="mw-headline" id="3D_graphics_acceleration">3D graphics acceleration</span></h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> How does <a href="../en/Vulkan.html" title="Vulkan">Vulkan</a>, <a href="../en/OpenGL.html" title="OpenGL">OpenGL</a> successor for 3D acceleration, comes into the scene? (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Systemd-nspawn.html">Talk:Systemd-nspawn</a>)</div>
</div>
<p>To enable accelerated 3D graphics, it may be necessary to bind mount <code>/dev/dri</code> to the container by adding the following line to the <i>.nspawn</i> file:
</p>
<pre>Bind=/dev/dri
</pre>
<p>The above trick was adopted from <a rel="nofollow" class="external text" href="https://web.archive.org/web/20190925003151/https://patrickskiba.com/sysytemd-nspawn/2019/03/21/graphical-applications-in-systemd-nspawn.html">patrickskiba.com</a>. This notably solves the problem of
</p>
<pre>libGL error: MESA-LOADER: failed to retrieve device information
libGL error: Version 4 or later of flush extension not found
libGL error: failed to load driver: i915
</pre>
<p>You can confirm that it has been enabled by running <code>glxinfo</code> or <code>glxgears</code>.
</p>
<h5><span class="mw-headline" id="NVIDIA_GPUs">NVIDIA GPUs</span></h5>
<p>If you cannot install the same NVIDIA driver version on the container as on the host, you may need to also bind the driver library files. You can run <code>pacman -Ql nvidia-utils</code> on the host to see all the files it contains. You do not need to copy everything over. The following systemd override file will bind all the necessary files over when the container is run via <code>machinectl start <i>container-name</i></code>.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> No reason to bind from <code>/usr/lib/</code> into <code>/usr/lib/x86_64-linux-gnu/</code>. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Systemd-nspawn.html">Talk:Systemd-nspawn</a>)</div>
</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/systemd-nspawn@.service.d/nvidia-gpu.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=systemd-nspawn --quiet --keep-unit --boot --link-journal=try-guest --machine=%i \
--bind=/dev/dri \
--bind=/dev/shm \
--bind=/dev/nvidia0 \
--bind=/dev/nvidiactl \
--bind=/dev/nvidia-modeset \
--bind=/usr/bin/nvidia-bug-report.sh:/usr/bin/nvidia-bug-report.sh \
--bind=/usr/bin/nvidia-cuda-mps-control:/usr/bin/nvidia-cuda-mps-control \
--bind=/usr/bin/nvidia-cuda-mps-server:/usr/bin/nvidia-cuda-mps-server \
--bind=/usr/bin/nvidia-debugdump:/usr/bin/nvidia-debugdump \
--bind=/usr/bin/nvidia-modprobe:/usr/bin/nvidia-modprobe \
--bind=/usr/bin/nvidia-ngx-updater:/usr/bin/nvidia-ngx-updater \
--bind=/usr/bin/nvidia-persistenced:/usr/bin/nvidia-persistenced \
--bind=/usr/bin/nvidia-powerd:/usr/bin/nvidia-powerd \
--bind=/usr/bin/nvidia-sleep.sh:/usr/bin/nvidia-sleep.sh \
--bind=/usr/bin/nvidia-smi:/usr/bin/nvidia-smi \
--bind=/usr/bin/nvidia-xconfig:/usr/bin/nvidia-xconfig \
--bind=/usr/lib/gbm/nvidia-drm_gbm.so:/usr/lib/x86_64-linux-gnu/gbm/nvidia-drm_gbm.so \
--bind=/usr/lib/libEGL_nvidia.so:/usr/lib/x86_64-linux-gnu/libEGL_nvidia.so \
--bind=/usr/lib/libGLESv1_CM_nvidia.so:/usr/lib/x86_64-linux-gnu/libGLESv1_CM_nvidia.so \
--bind=/usr/lib/libGLESv2_nvidia.so:/usr/lib/x86_64-linux-gnu/libGLESv2_nvidia.so \
--bind=/usr/lib/libGLX_nvidia.so:/usr/lib/x86_64-linux-gnu/libGLX_nvidia.so \
--bind=/usr/lib/libcuda.so:/usr/lib/x86_64-linux-gnu/libcuda.so \
--bind=/usr/lib/libnvcuvid.so:/usr/lib/x86_64-linux-gnu/libnvcuvid.so \
--bind=/usr/lib/libnvidia-allocator.so:/usr/lib/x86_64-linux-gnu/libnvidia-allocator.so \
--bind=/usr/lib/libnvidia-cfg.so:/usr/lib/x86_64-linux-gnu/libnvidia-cfg.so \
--bind=/usr/lib/libnvidia-egl-gbm.so:/usr/lib/x86_64-linux-gnu/libnvidia-egl-gbm.so \
--bind=/usr/lib/libnvidia-eglcore.so:/usr/lib/x86_64-linux-gnu/libnvidia-eglcore.so \
--bind=/usr/lib/libnvidia-encode.so:/usr/lib/x86_64-linux-gnu/libnvidia-encode.so \
--bind=/usr/lib/libnvidia-fbc.so:/usr/lib/x86_64-linux-gnu/libnvidia-fbc.so \
--bind=/usr/lib/libnvidia-glcore.so:/usr/lib/x86_64-linux-gnu/libnvidia-glcore.so \
--bind=/usr/lib/libnvidia-glsi.so:/usr/lib/x86_64-linux-gnu/libnvidia-glsi.so \
--bind=/usr/lib/libnvidia-glvkspirv.so:/usr/lib/x86_64-linux-gnu/libnvidia-glvkspirv.so \
--bind=/usr/lib/libnvidia-ml.so:/usr/lib/x86_64-linux-gnu/libnvidia-ml.so \
--bind=/usr/lib/libnvidia-ngx.so:/usr/lib/x86_64-linux-gnu/libnvidia-ngx.so \
--bind=/usr/lib/libnvidia-opticalflow.so:/usr/lib/x86_64-linux-gnu/libnvidia-opticalflow.so \
--bind=/usr/lib/libnvidia-ptxjitcompiler.so:/usr/lib/x86_64-linux-gnu/libnvidia-ptxjitcompiler.so \
--bind=/usr/lib/libnvidia-rtcore.so:/usr/lib/x86_64-linux-gnu/libnvidia-rtcore.so \
--bind=/usr/lib/libnvidia-tls.so:/usr/lib/x86_64-linux-gnu/libnvidia-tls.so \
--bind=/usr/lib/libnvidia-vulkan-producer.so:/usr/lib/x86_64-linux-gnu/libnvidia-vulkan-producer.so \
--bind=/usr/lib/libnvoptix.so:/usr/lib/x86_64-linux-gnu/libnvoptix.so \
--bind=/usr/lib/modprobe.d/nvidia-utils.conf:/usr/lib/x86_64-linux-gnu/modprobe.d/nvidia-utils.conf \
--bind=/usr/lib/nvidia/wine/_nvngx.dll:/usr/lib/x86_64-linux-gnu/nvidia/wine/_nvngx.dll \
--bind=/usr/lib/nvidia/wine/nvngx.dll:/usr/lib/x86_64-linux-gnu/nvidia/wine/nvngx.dll \
--bind=/usr/lib/nvidia/xorg/libglxserver_nvidia.so:/usr/lib/x86_64-linux-gnu/nvidia/xorg/libglxserver_nvidia.so \
--bind=/usr/lib/vdpau/libvdpau_nvidia.so:/usr/lib/x86_64-linux-gnu/vdpau/libvdpau_nvidia.so \
--bind=/usr/lib/xorg/modules/drivers/nvidia_drv.so:/usr/lib/x86_64-linux-gnu/xorg/modules/drivers/nvidia_drv.so \
--bind=/usr/share/X11/xorg.conf.d/10-nvidia-drm-outputclass.conf:/usr/share/X11/xorg.conf.d/10-nvidia-drm-outputclass.conf \
--bind=/usr/share/dbus-1/system.d/nvidia-dbus.conf:/usr/share/dbus-1/system.d/nvidia-dbus.conf \
--bind=/usr/share/egl/egl_external_platform.d/15_nvidia_gbm.json:/usr/share/egl/egl_external_platform.d/15_nvidia_gbm.json \
--bind=/usr/share/glvnd/egl_vendor.d/10_nvidia.json:/usr/share/glvnd/egl_vendor.d/10_nvidia.json \
--bind=/usr/share/licenses/nvidia-utils/LICENSE:/usr/share/licenses/nvidia-utils/LICENSE \
--bind=/usr/share/vulkan/icd.d/nvidia_icd.json:/usr/share/vulkan/icd.d/nvidia_icd.json \
--bind=/usr/share/vulkan/implicit_layer.d/nvidia_layers.json:/usr/share/vulkan/implicit_layer.d/nvidia_layers.json \
DeviceAllow=/dev/dri rw
DeviceAllow=/dev/shm rw
DeviceAllow=/dev/nvidia0 rw
DeviceAllow=/dev/nvidiactl rw
DeviceAllow=/dev/nvidia-modeset rw</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Whenever you upgrade your NVIDIA drivers on the host, you will need to restart the container and may need to run <code>ldconfig</code> in it to update the libraries.</div>
<h3><span class="mw-headline" id="Access_host_filesystem">Access host filesystem</span></h3>
<p>See <code>--bind</code> and <code>--bind-ro</code> in <span class="plainlinks archwiki-template-man" title="$ man 1 systemd-nspawn"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-nspawn.1">systemd-nspawn(1)</a></span>.
</p>
<p>If both the host and the container are Arch Linux, then one could, for example, share the pacman cache:
</p>
<pre># systemd-nspawn --bind=/var/cache/pacman/pkg
</pre>
<p>Or you can specify per-container bind using the file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/nspawn/<i>my-container</i>.nspawn</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Files]
Bind=/var/cache/pacman/pkg
</pre>
<p>See <a href="#Per-container_settings">#Per-container settings</a>.
</p>
<p>To bind the directory to a different path within the container, add the path be separated by a colon. For example:
</p>
<pre># systemd-nspawn --bind=<i>/path/to/host_dir:/path/to/container_dir</i>
</pre>
<p>In case of <a href="#Unprivileged_containers">#Unprivileged containers</a>, the resulting mount points will be owned by the nobody user. This can be modified with the <code>idmap</code> mount option:
</p>
<pre># systemd-nspawn --bind=<i>/path/to/host_dir:/path/to/container_dir</i>:idmap
</pre>
<h3><span class="mw-headline" id="Run_on_a_non-systemd_system">Run on a non-systemd system</span></h3>
<p>See <a href="../en/Init.html#systemd-nspawn" title="Init">Init#systemd-nspawn</a>.
</p>
<h3><span class="mw-headline" id="Use_Btrfs_subvolume_as_container_root">Use Btrfs subvolume as container root</span></h3>
<p>To use a <a href="../en/Btrfs.html#Subvolumes" title="Btrfs">Btrfs subvolume</a> as a template for the container's root, use the <code>--template</code> flag. This takes a snapshot of the subvolume and populates the root directory for the container with it.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If the template path specified is not the root of a subvolume, the <b>entire</b> tree is copied. This will be very time consuming.</div>
<p>For example, to use a snapshot located at <code>/.snapshots/403/snapshot</code>:
</p>
<pre># systemd-nspawn --template=/.snapshots/403/snapshots -b -D <i>my-container</i>
</pre>
<p>where <code><i>my-container</i></code> is the name of the directory that will be created for the container. After powering off, the newly created subvolume is retained.
</p>
<h3><span class="mw-headline" id="Use_temporary_Btrfs_snapshot_of_container">Use temporary Btrfs snapshot of container</span></h3>
<p>One can use the <code>--ephemeral</code> or <code>-x</code> flag to create a temporary btrfs snapshot of the container and use it as the container root. Any changes made while booted in the container will be lost. For example:
</p>
<pre># systemd-nspawn -D <i>my-container</i> -xb
</pre>
<p>where <i>my-container</i> is the directory of an <b>existing</b> container or system. For example, if <code>/</code> is a btrfs subvolume one could create an ephemeral container of the currently running host system by doing:
</p>
<pre># systemd-nspawn -D / -xb 
</pre>
<p>After powering off the container, the btrfs subvolume that was created is immediately removed.
</p>
<h3><span class="mw-headline" id="Run_docker_in_systemd-nspawn">Run docker in systemd-nspawn</span></h3>
<p>Since <a href="../en/Docker.html" title="Docker">Docker</a> 20.10, it is possible to run Docker containers inside an unprivileged <i>systemd-nspawn</i> container with <i>cgroups v2</i> enabled (default in Arch Linux) without undermining security measures by disabling cgroups and user namespaces. To do so, edit <code>/etc/systemd/nspawn/myContainer.nspawn</code> (create if absent) and add the following configurations.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/nspawn/myContainer.nspawn</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Exec]
SystemCallFilter=add_key keyctl bpf
</pre>
<p>Then, Docker should work as-is inside the container.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The configuration above exposes the system calls <i>add_key</i>, <i>keyctl</i> and <i>bpf</i> to the container, which are not namespaced. This could still be a security risk, even though it is much lower than disabling user namespacing entirely like what one had to do before cgroups v2.</div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Bind-mounting <code>/proc</code> and <code>/sys</code> with read-write access into unprivileged containers is not secure. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Systemd-nspawn.html">Talk:Systemd-nspawn</a>)</div>
</div>
<p>With recent versions of systemd, you would also need to need  the following workaround:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/nspawn/myContainer.nspawn</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Files]
Bind=/proc:/run/proc
Bind=/sys:/run/sys
</pre>
<p>See <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/27994">[11]</a> for more details.
</p>
<p>Since <i>overlayfs</i> does not work with user namespaces and is unavailable inside <i>systemd-nspawn</i>, by default, Docker falls back to using the inefficient <i>vfs</i> as its storage driver, which creates a copy of the image each time a container is started. This can be worked around by using <i>fuse-overlayfs</i> as its storage driver. To do so, we need to first expose <i>fuse</i> to the container:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/nspawn/myContainer.nspawn</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Files]
Bind=/dev/fuse
</pre>
<p>and then allow the container to read and write the device node:
</p>
<pre># systemctl set-property systemd-nspawn@myContainer DeviceAllow='/dev/fuse rwm'
</pre>
<p>Finally, install the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fuse-overlayfs">fuse-overlayfs</a></span> inside the container. You need to restart the container for all the configuration to take effect.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3>
<span id="execv.28....29_failed:_Permission_denied"></span><span class="mw-headline" id="execv(...)_failed:_Permission_denied">execv(...) failed: Permission denied</span>
</h3>
<p>When trying to boot the container via <code>systemd-nspawn -bD <i>/path/to/container</i></code> (or executing something in the container), and the following error comes up:
</p>
<pre>execv(/usr/lib/systemd/systemd, /lib/systemd/systemd, /sbin/init) failed: Permission denied
</pre>
<p>even though the permissions of the files in question (i.e. <code>/lib/systemd/systemd</code>) are correct, this can be the result of having mounted the file system on which the container is stored as non-root user. For example, if you mount your disk manually with an entry in <a href="../en/Fstab.html" title="Fstab">fstab</a> that has the options <code>noauto,user,...</code>, <i>systemd-nspawn</i> will not allow executing the files even if they are owned by root.
</p>
<h3>
<span id="Terminal_type_in_TERM_is_incorrect_.28broken_colors.29"></span><span class="mw-headline" id="Terminal_type_in_TERM_is_incorrect_(broken_colors)">Terminal type in TERM is incorrect (broken colors)</span>
</h3>
<p>When logging into the container via <code>machinectl login</code>, the colors and keystrokes in the terminal within the container might be broken. This may be due to an incorrect terminal type in <code>TERM</code> environment variable. The environment variable is not inherited from the shell on the host, but falls back to a default fixed in systemd (<code>vt220</code>), unless explicitly configured. To configure, within the container create a configuration overlay for the <code>container-getty@.service</code> systemd service that launches the login getty for <code>machinectl login</code>, and set <code>TERM</code> to the value that matches the host terminal you are logging in from:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/container-getty@.service.d/term.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
Environment=TERM=xterm-256color</pre>
<p>Alternatively use <code>machinectl shell</code>. It properly inherits the <code>TERM</code> environment variable from the terminal.
</p>
<h3><span class="mw-headline" id="Mounting_a_NFS_share_inside_the_container">Mounting a NFS share inside the container</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> A section added to the discussion page have been added, claiming for a sort of partial work around (January 2023) (Discuss in <a href="../en/Talk:Systemd-nspawn.html#A_trick_way_to_mount_a_NFS_share_with_the_container" title="Talk:Systemd-nspawn">Talk:Systemd-nspawn#A trick way to mount a NFS share with the container</a>)</div>
</div>
<p>Not possible at this time (June 2019).
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a href="../en/Getty.html#Nspawn_console" title="Getty">Automatic console login</a></li>
<li><a rel="nofollow" class="external text" href="https://lwn.net/Articles/572957/">Creating containers with systemd-nspawn</a></li>
<li><a rel="nofollow" class="external text" href="https://www.youtube.com/results?search_query=systemd-nspawn&amp;aq=f">Presentation by Lennart Poettering on systemd-nspawn</a></li>
<li><a rel="nofollow" class="external text" href="https://dabase.com/e/12009/">Running Firefox in a systemd-nspawn container</a></li>
<li><a rel="nofollow" class="external text" href="https://web.archive.org/web/20190925003151/https://patrickskiba.com/sysytemd-nspawn/2019/03/21/graphical-applications-in-systemd-nspawn.html">Graphical applications in systemd-nspawn</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Virtualization.html" title="Category:Virtualization">Virtualization</a></li>
<li><a href="../en/Category:Sandboxing.html" title="Category:Sandboxing">Sandboxing</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Systemd-nspawn&amp;oldid=812725">https://wiki.archlinux.org/index.php?title=Systemd-nspawn&amp;oldid=812725</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 21 July 2024, at 08:13.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
