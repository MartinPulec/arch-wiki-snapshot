<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Internet sharing - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Internet_sharing rootpage-Internet_sharing skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Requirements" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Requirements">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Requirements</div>
		</a>
		
		<ul id="toc-Requirements-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Configuration</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-Static_IP_address" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Static_IP_address">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Static IP address</div>
			</a>
			
			<ul id="toc-Static_IP_address-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enable_packet_forwarding" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enable_packet_forwarding">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Enable packet forwarding</div>
			</a>
			
			<ul id="toc-Enable_packet_forwarding-sublist" class="vector-toc-list">
				<li id="toc-Packet_forwarding_with_systemd-networkd" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Packet_forwarding_with_systemd-networkd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.1</span>Packet forwarding with systemd-networkd</div>
			</a>
			
			<ul id="toc-Packet_forwarding_with_systemd-networkd-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Enable_NAT" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enable_NAT">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Enable NAT</div>
			</a>
			
			<ul id="toc-Enable_NAT-sublist" class="vector-toc-list">
				<li id="toc-With_iptables" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#With_iptables">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.1</span>With iptables</div>
			</a>
			
			<ul id="toc-With_iptables-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-With_nftables" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#With_nftables">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.2</span>With nftables</div>
			</a>
			
			<ul id="toc-With_nftables-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-With_firewalld" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#With_firewalld">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.3</span>With firewalld</div>
			</a>
			
			<ul id="toc-With_firewalld-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Assigning_IP_addresses_to_the_client_PC(s)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Assigning_IP_addresses_to_the_client_PC(s)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4</span>Assigning IP addresses to the client PC(s)</div>
			</a>
			
			<ul id="toc-Assigning_IP_addresses_to_the_client_PC(s)-sublist" class="vector-toc-list">
				<li id="toc-Manually_adding_an_IP" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Manually_adding_an_IP">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4.1</span>Manually adding an IP</div>
			</a>
			
			<ul id="toc-Manually_adding_an_IP-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Clients_cannot_access_the_internet_or_cannot_connect" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Clients_cannot_access_the_internet_or_cannot_connect">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Clients cannot access the internet or cannot connect</div>
			</a>
			
			<ul id="toc-Clients_cannot_access_the_internet_or_cannot_connect-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Internet sharing</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 4 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-4" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">4 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-fr mw-list-item"><a href="../fr/Internet_sharing.html" title="Internet sharing – français" lang="fr" hreflang="fr" class="interlanguage-link-target"><span>Français</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%8D%E3%83%83%E3%83%88%E5%85%B1%E6%9C%89" title="インターネット共有 – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Internet_sharing.html" title="Internet sharing – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Internet_sharing" title="Internet sharing – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Android_tethering.html" title="Android tethering">Android tethering</a></li>
<li><a href="../en/Software_access_point.html" title="Software access point">Software access point</a></li>
<li><a href="../en/Bridge_with_netctl.html" title="Bridge with netctl">Bridge with netctl</a></li>
<li><a href="../en/Ad-hoc_networking.html" title="Ad-hoc networking">Ad-hoc networking</a></li>
<li><a href="../en/Sharing_PPP_Connection.html" title="Sharing PPP Connection">Sharing PPP Connection</a></li>
<li><a href="../en/Simple_stateful_firewall.html" title="Simple stateful firewall">Simple stateful firewall</a></li>
<li><a href="../en/Router.html" title="Router">Router</a></li>
<li><a href="../en/Mobile_broadband_modem.html" class="mw-redirect" title="USB 3G Modem">USB 3G Modem</a></li>
</ul>
</div>
<p>This article explains how to share the internet connection from one machine to other(s). 
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Requirements">Requirements</span></h2>
<p>The machine acting as server should have an additional network device. That network device requires a functional <a href="https://en.wikipedia.org/wiki/Data_link_layer" class="extiw" title="wikipedia:Data link layer">data link layer</a> to the machine(s) that are going to receive internet access:
</p>
<ul>
<li>To be able to share internet to several machines a <a href="https://en.wikipedia.org/wiki/Network_switch" class="extiw" title="wikipedia:Network switch">switch</a> can provide the data link layer connection.</li>
<li>A wireless device can share access to several machines as well, see <a href="../en/Software_access_point.html" title="Software access point">Software access point</a> first for this case.</li>
<li>If you are sharing to only one machine, a <a href="https://en.wikipedia.org/wiki/Ethernet_crossover_cable" class="extiw" title="wikipedia:Ethernet crossover cable">crossover cable</a> is sufficient. In case one of the two computers' ethernet cards has <a href="https://en.wikipedia.org/wiki/Medium_Dependent_Interface#Auto_MDI-X" class="extiw" title="wikipedia:Medium Dependent Interface">MDI-X</a> capability, a crossover cable is not necessary and a regular ethernet cable can be used. Executing <code>ethtool <i>interface</i> | grep MDI</code> as root helps to figure it.</li>
</ul>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>This section assumes that the network device connected to the client computer(s) is named <code>net0</code> and the network device connected to the internet as <code>internet0</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> You can rename your devices to this scheme using <a href="../en/Udev.html#Setting_static_device_names" title="Udev">udev#Setting static device names</a>.</div>
<p>All configuration is done on the server computer, except for the final step of <a href="#Assigning_IP_addresses_to_the_client_PC(s)">#Assigning IP addresses to the client PC(s)</a>.
</p>
<h3><span class="mw-headline" id="Static_IP_address">Static IP address</span></h3>
<p>On the server computer, assign a static IPv4 address to the interface connected to the other machines. The first 3 bytes of this address cannot be exactly the same as those of another interface, unless both interfaces have netmasks strictly greater than /24.
</p>
<pre># ip link set up dev net0
# ip addr add 192.168.123.100/24 dev net0 # arbitrary address
</pre>
<p>To have your static IP assigned at boot, you can use a <a href="../en/Network_configuration.html#Network_managers" class="mw-redirect" title="Network manager">network manager</a>.
</p>
<h3><span class="mw-headline" id="Enable_packet_forwarding">Enable packet forwarding</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Enabling IP forwarding without a properly configured <a href="../en/Category:Firewalls.html" class="mw-redirect" title="Firewall">firewall</a> is a security risk.</div>
<p>To check the current packet forwarding settings, run:
</p>
<pre># sysctl -a | grep forward
</pre>
<p>You will note options for controlling forwarding per default, per interface, as well as separate options for IPv4/IPv6 per interface. For detailed description of all available options, see <a rel="nofollow" class="external text" href="https://docs.kernel.org/networking/ip-sysctl.html">the kernel documentation</a>.
</p>
<p>To enable IPv4 and IPv6 packet forwarding, <a href="../en/Sysctl.html#Configuration" title="Sysctl">configure sysctl</a> to set these settings:
</p>
<pre>net.ipv4.ip_forward = 1
net.ipv4.conf.all.forwarding = 1
net.ipv6.conf.all.forwarding = 1
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> To enable packet forwarding selectively for a specific interface, use <code>net.<i>ipv[46]</i>.conf.<i>interface_name</i>.forwarding=1</code> instead.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> 
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> Most likely outdated. As systemd-netword 256+ now supports setting IPv4Fowarding on a per link level. Please delete this Note, and below warning on confirmation. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Internet_sharing.html">Talk:Internet sharing</a>)</div>
</div>
<p>If the system uses <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> to control the network interfaces, a per-interface setting for IPv4 is not possible, i.e. systemd logic propagates any configured forwarding into a global (for all interfaces) setting for IPv4. The advised work-around is to use a firewall to forbid forwarding again on selective interfaces. See the <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.network"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.network.5">systemd.network(5)</a></span> manual page for more information. The <code>IPForward=kernel</code> semantics introduced in a previous systemd release 220/221 to honor kernel settings does not apply anymore.<a rel="nofollow" class="external autonumber" href="https://github.com/poettering/systemd/commit/765afd5c4dbc71940d6dd6007ecc3eaa5a0b2aa1">[1]</a> <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/blob/a2088fd025deb90839c909829e27eece40f7fce4/NEWS">[2]</a>
</p>
</div>
<p>To make changes persistent across reboots, see <a href="../en/Sysctl.html#Configuration" title="Sysctl">Sysctl#Configuration</a>. You might consider writing settings to a file with a descriptive filename, such as <code>/etc/sysctl.d/30-ipforward.conf</code>.
</p>
<p>Afterwards it is advisable to double-check forwarding is enabled as required after a reboot.
</p>
<h4><span class="mw-headline" id="Packet_forwarding_with_systemd-networkd">Packet forwarding with systemd-networkd</span></h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Merge-arrows-2.svg" decoding="async" width="36" height="40" class="mw-file-element"></span></span><b>This article or section is a candidate for merging with <a href="../en/Systemd-networkd.html#[Network]" title="Systemd-networkd">systemd-networkd#[Network]</a>.</b></p>
<div>
<b>Notes:</b> An arbitrary file naming does not make sense for a generic example. A <i>.network</i> file without a <code>[Match]</code> section does not make sense. Simply say what needs to be set and link to the <a href="../en/Systemd-networkd.html#[Network]" title="Systemd-networkd">systemd-networkd#[Network]</a> page. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Internet_sharing.html">Talk:Internet sharing</a>)</div>
</div>
<p>If you are using <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> to manage your network configuration, you can also persist those settings across reboots:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/20-lan.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Network]
IPv4Forwarding=yes
...</pre>
<p>This essentially sets the same <code>net.<i>ipv[46]</i>.conf.<i>interface_name</i>.forwarding=1</code> as mentioned in previous section. For IPv6 the configuration is <code>IPv6Forwarding=yes</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> As of systemd 256, the <code>IPv6Forwarding</code> option does not behave as documented, see <a rel="nofollow" class="external autonumber" href="https://github.com/systemd/systemd/issues/33414">[3]</a>.</div>
<p>This sets up packet forwarding for the specific interface only. For internet sharing to properly work, you need to enable packet forwarding on both (all) interfaces where traffic should be routed between. Typically your <code>lan</code> and <code>wan</code> interfaces.
</p>
<p>See also <a href="../en/Systemd-networkd.html#[Network]" title="Systemd-networkd">systemd-networkd#[Network]</a>.
</p>
<h3><span class="mw-headline" id="Enable_NAT">Enable NAT</span></h3>
<h4><span class="mw-headline" id="With_iptables">With iptables</span></h4>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iptables">iptables</a></span> package. Use iptables to enable NAT:
</p>
<pre># iptables -t nat -A POSTROUTING -o internet0 -j MASQUERADE
# iptables -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
# iptables -A FORWARD -i net0 -o internet0 -j ACCEPT
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Of course, this also works with a mobile broadband connection (usually called ppp0 on routing PC).</div>
<p>Use <code>-I DOCKER-USER</code> instead of <code>-A FORWARD</code> if you installed docker. <a rel="nofollow" class="external autonumber" href="https://docs.docker.com/network/iptables/">[4]</a>
</p>
<pre># iptables -t nat -A POSTROUTING -o internet0 -j MASQUERADE
# iptables -I DOCKER-USER 1 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
# iptables -I DOCKER-USER 2 -i net0 -o internet0 -j ACCEPT
</pre>
<p>If connected via PPPoE, clamp mss to pmtu in order to prevent fragmentation:
</p>
<pre># iptables -t mangle -A FORWARD -o ppp0 -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu
</pre>
<p>Read the <a href="../en/Iptables.html" title="Iptables">iptables</a> article for more information (especially saving the rule and applying it automatically on boot). There is also an excellent guide on iptables <a href="../en/Simple_stateful_firewall.html" title="Simple stateful firewall">Simple stateful firewall</a>.
</p>
<h4><span class="mw-headline" id="With_nftables">With nftables</span></h4>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nftables">nftables</a></span> package. To enable NAT with <a href="../en/Nftables.html" title="Nftables">nftables</a>, you will have to create the <code>postrouting</code> chain in a new/existing table:
</p>
<pre># nft add table inet nat
# nft add chain inet nat postrouting '{ type nat hook postrouting priority 100 ; }'
</pre>
<p>After that, you have to masquerade the <code>net0</code> addresses for <code>internet0</code>:
</p>
<pre># nft add rule inet nat postrouting oifname internet0 masquerade
</pre>
<p>Many firewall configurations, like <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/packaging/packages/nftables/-/blob/main/nftables.conf">the default</a> <code>/etc/nftables.conf</code>, set the default policy of the 'filter' table's 'forward' chain to 'drop'. In such cases, you will need rules to allow forwarding NAT traffic:
</p>
<pre># nft add rule inet filter forward ct state related,established accept
# nft add rule inet filter forward iifname net0 oifname internet0 accept
</pre>
<p>You can find more information on NAT in nftables in the <a rel="nofollow" class="external text" href="https://wiki.nftables.org/wiki-nftables/index.php/Performing_Network_Address_Translation_(NAT)">nftables Wiki</a>. If you want to make these changes permanent, follow the instructions on <a href="../en/Nftables.html" title="Nftables">nftables</a>.
</p>
<h4><span class="mw-headline" id="With_firewalld">With firewalld</span></h4>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=firewalld">firewalld</a></span> package. <a href="../en/Firewalld.html" title="Firewalld">firewalld</a> is a firewall daemon which relies on <a href="../en/Nftables.html" title="Nftables">nftables</a> or <a href="../en/Iptables.html" title="Iptables">iptables</a>. First change the firewalld zones of network interfaces:
</p>
<pre># firewall-cmd --zone=external --change-interface=internet0 --permanent
# firewall-cmd --zone=internal --change-interface=net0 --permanent
</pre>
<p>Then add a new policy to let traffic flow between the internal and external zone:
</p>
<pre># firewall-cmd --permanent --new-policy int2ext
# firewall-cmd --permanent --policy int2ext --add-ingress-zone internal
# firewall-cmd --permanent --policy int2ext --add-egress-zone external
# firewall-cmd --permanent --policy int2ext --set-target ACCEPT
# firewall-cmd --reload
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> You can use stricter policy rules than bare <code>ACCEPT</code> as illustrated in the <code>Firewall Rules</code> section of the firewalld concept page<a rel="nofollow" class="external autonumber" href="https://firewalld.org/documentation/concepts.html">[5]</a>
<p>For example, to allow only nodes in <code>192.168.2.0/24</code> to access the internet, do:
</p>
<p><code>firewall-cmd --permanent --policy int2ext --add-rich-rule='rule family=ipv4 source address=192.168.2.0/24 accept'</code>
Do not forget to reload rules afterwards:
</p>
<code>firewall-cmd --reload</code>
</div>
<h3>
<span id="Assigning_IP_addresses_to_the_client_PC.28s.29"></span><span class="mw-headline" id="Assigning_IP_addresses_to_the_client_PC(s)">Assigning IP addresses to the client PC(s)</span>
</h3>
<p>If you are planning to regularly have several machines using the internet shared by this machine, then is a good idea to install a <a href="https://en.wikipedia.org/wiki/DHCP" class="extiw" title="wikipedia:DHCP">DHCP</a> server. See <a href="../en/Router.html#DNS_and_DHCP" title="Router">Router#DNS and DHCP</a> for the available options. Then configure a DHCP client on every client PC, see <a href="../en/Network_configuration.html#Network_managers" title="Network configuration">Network configuration#Network managers</a>.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> This is not an iptables guide. Expanding the chain with <code>iptables -I</code> might skip other important rules; if you need to script an ON/OFF switch for this, use custom chain with a jump placed carefully in the INPUT chain. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Internet_sharing.html">Talk:Internet sharing</a>)</div>
</div>
<p>Incoming connections to UDP port 67 has to be allowed for DHCP server. It also necessary to allow incoming connections to UDP/TCP port 53 for DNS requests.
</p>
<pre># iptables -I INPUT -p udp --dport 67 -i net0 -j ACCEPT
# iptables -I INPUT -p udp --dport 53 -s 192.168.123.0/24 -j ACCEPT
# iptables -I INPUT -p tcp --dport 53 -s 192.168.123.0/24 -j ACCEPT
</pre>
<p>Alternatively using <a href="../en/Firewalld.html" title="Firewalld">firewalld</a>
</p>
<pre># firewall-cmd --zone=internal --permanent --add-service dns
# firewall-cmd --zone=internal --permanent --add-service dhcp
# firewall-cmd --zone=internal --permanent --add-service dhcpv6
</pre>
<p>If you are not planning to use this setup regularly, you can manually add an IP to each client instead.
</p>
<h4><span class="mw-headline" id="Manually_adding_an_IP">Manually adding an IP</span></h4>
<p>Instead of using DHCP, a static IP address and a default route via <code>192.168.123.100</code> can also be configured manually. There are many tools available to configure the network accordingly. One prominent example of such a tool is <span class="plainlinks archwiki-template-man" title="$ man 8 ip"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ip.8">ip(8)</a></span>, see <a href="../en/Network_configuration.html#Network_management" title="Network configuration">Network configuration#Network management</a>. Alternatively, one can use a <code>.network</code> file, see <a href="../en/Systemd-networkd.html#Wired_adapter_using_a_static_IP" title="Systemd-networkd">Systemd-networkd#Wired adapter using a static IP</a> to setup a static IP.
</p>
<p>Configure a DNS server for each client, see <a href="../en/Domain_name_resolution.html" title="Domain name resolution">Domain name resolution</a> for details.
</p>
<p>That is it. The client PC should now have Internet.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<p>If you are able to connect the two PCs but cannot send data (for example, if the client PC makes a DHCP request to the server PC, the server PC receives the request and offers an IP to the client, but the client does not accept it, timing out instead), check that you do not have other <a href="../en/Iptables.html" title="Iptables">iptables</a> rules <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1093208">interfering</a>.
</p>
<h3><span class="mw-headline" id="Clients_cannot_access_the_internet_or_cannot_connect">Clients cannot access the internet or cannot connect</span></h3>
<p>Symptoms might also include: Clients get <code>host is  down</code> when pinging host, gets <code>no route to host</code> when pinging devices outside the LAN (that should be forwarded by NAT), DHCP offers not crossing a bridge, ... 
</p>
<p>It is known that <a href="../en/Docker.html" title="Docker">docker</a> may cause these problems. Simply <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Disabling">disabling</a> <code>docker.service</code> and <code>docker.socket</code> solves this problem.
</p>
<p><a rel="nofollow" class="external text" href="https://github.com/moby/moby/issues/43719">docker github issue</a>.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://xyne.dev/notes/network/dhcp_with_dns.html">Xyne's guide and scripts for launching a subnet with DHCP and DNS</a></li>
<li>
<a href="../en/NetworkManager.html" title="NetworkManager">NetworkManager</a> can be configured for internet sharing if used.</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Network_sharing.html" title="Category:Network sharing">Network sharing</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Internet_sharing&amp;oldid=811201">https://wiki.archlinux.org/index.php?title=Internet_sharing&amp;oldid=811201</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 24 June 2024, at 13:25.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
