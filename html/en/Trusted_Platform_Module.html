<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Trusted Platform Module - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.3">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Trusted_Platform_Module rootpage-Trusted_Platform_Module skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Versions" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Versions">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Versions</div>
		</a>
		
		<ul id="toc-Versions-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Usage" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Usage">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Usage</div>
		</a>
		
			<button aria-controls="toc-Usage-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Usage subsection</span>
			</button>
		
		<ul id="toc-Usage-sublist" class="vector-toc-list">
			<li id="toc-Checking_support" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Checking_support">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Checking support</div>
			</a>
			
			<ul id="toc-Checking_support-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Data-at-rest_encryption_with_LUKS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Data-at-rest_encryption_with_LUKS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Data-at-rest encryption with LUKS</div>
			</a>
			
			<ul id="toc-Data-at-rest_encryption_with_LUKS-sublist" class="vector-toc-list">
				<li id="toc-systemd-cryptenroll" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#systemd-cryptenroll">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.1</span>systemd-cryptenroll</div>
			</a>
			
			<ul id="toc-systemd-cryptenroll-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-SSH" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#SSH">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>SSH</div>
			</a>
			
			<ul id="toc-SSH-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-GnuPG" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#GnuPG">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4</span>GnuPG</div>
			</a>
			
			<ul id="toc-GnuPG-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Other_good_examples_of_TPM_2.0_usage" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Other_good_examples_of_TPM_2.0_usage">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.5</span>Other good examples of TPM 2.0 usage</div>
			</a>
			
			<ul id="toc-Other_good_examples_of_TPM_2.0_usage-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Accessing_PCR_registers" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Accessing_PCR_registers">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Accessing PCR registers</div>
		</a>
		
		<ul id="toc-Accessing_PCR_registers-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-TPM2_LUKS2_unlocking_still_asking_for_password" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#TPM2_LUKS2_unlocking_still_asking_for_password">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>TPM2 LUKS2 unlocking still asking for password</div>
			</a>
			
			<ul id="toc-TPM2_LUKS2_unlocking_still_asking_for_password-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Trusted Platform Module</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Trusted_Platform_Module" title="Trusted Platform Module – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pl mw-list-item"><a href="../pl/Trusted_Platform_Module.html" title="Trusted Platform Module – polski" lang="pl" hreflang="pl" class="interlanguage-link-target"><span>Polski</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/%E5%8F%AF%E4%BF%A1%E5%B9%B3%E5%8F%B0%E6%A8%A1%E5%9D%97" title="可信平台模块 – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Self-encrypting_drives.html" title="Self-encrypting drives">Self-encrypting drives</a></li>
<li><a href="../en/Smartcards.html" title="Smartcards">Smartcards</a></li>
<li><a href="../en/Trusted_Platform_Module/1.2.html" title="Trusted Platform Module/1.2">Trusted Platform Module/1.2</a></li>
</ul>
</div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Needs clarification about usage difference between TPM 1.2 and 2.0, Evil Maid attack defense and Trusted boot. PCR registers sealing and using in combination with LUKS. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Trusted_Platform_Module.html">Talk:Trusted Platform Module</a>)</div>
</div>
<p><a href="https://en.wikipedia.org/wiki/Trusted_Platform_Module" class="extiw" title="wikipedia:Trusted Platform Module">Trusted Platform Module</a> (TPM) is an international standard for a secure cryptoprocessor, which is a dedicated microprocessor designed to secure hardware by integrating cryptographic keys into devices.
</p>
<p>In practice a TPM can be used for various different security applications such as <a href="../en/Unified_Extensible_Firmware_Interface/Secure_Boot.html" class="mw-redirect" title="Secure Boot">secure boot</a>, key storage and <a href="../en/Random_number_generation.html" title="Random number generation">random number generation</a>.
</p>
<p>TPM is naturally supported only on devices that have TPM hardware support. If your hardware has TPM support but it is not showing up, it might need to be enabled in the BIOS settings.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Versions">Versions</span></h2>
<p>There are two very different TPM specifications: 2.0 and 1.2, which also use different software stacks. This article only describes TPM 2.0, for the older TPM 1.2 see <a href="../en/Trusted_Platform_Module/1.2.html" title="Trusted Platform Module/1.2">/1.2</a>.
</p>
<p>If you are not sure, you can run this command to check it:
</p>
<pre>$ cat /sys/class/tpm/tpm*/tpm_version_major
</pre>
<p>TPM 2.0 allows direct access via <code>/dev/tpm0</code> (one client at a time), kernel-managed access via <code>/dev/tpmrm0</code>, or managed access through the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tpm2-abrmd">tpm2-abrmd</a></span> resource manager daemon. <a rel="nofollow" class="external text" href="https://groups.google.com/g/linux.debian.bugs.dist/c/OWBHw40g6Vk/m/rnwwkVapDAAJ">According to</a> a systemd project member, using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tpm2-abrmd">tpm2-abrmd</a></span> is no longer recommended. There are two choices of userspace tools, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tpm2-tools">tpm2-tools</a></span> by Intel and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ibm-tss/">ibm-tss</a></span><sup><small>AUR</small></sup> by IBM.
</p>
<p>TPM 2.0 requires <a href="../en/Unified_Extensible_Firmware_Interface.html" class="mw-redirect" title="UEFI">UEFI</a> boot; BIOS or Legacy boot systems can only use TPM 1.2.
</p>
<p>Some TPM chips can be switched between 2.0 and 1.2 through a firmware upgrade (which can be done only a limited number of times).
</p>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> This section is a stub. You can help by expanding it with information on how to set up and use a TPM 2.0 device. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Trusted_Platform_Module.html">Talk:Trusted Platform Module</a>)</div>
</div>
<p>Many informative resources to learn how to configure and make use of TPM 2.0 services in daily applications are available from the <a rel="nofollow" class="external text" href="https://tpm2-software.github.io/">tpm2-software community</a>.
</p>
<h3><span class="mw-headline" id="Checking_support">Checking support</span></h3>
<p>TPM 2.0 support (either through a <a href="https://en.wikipedia.org/wiki/Trusted_Platform_Module#TPM_2.0_implementations" class="extiw" title="wikipedia:Trusted Platform Module">hardware or software implementation</a>)  has been a requirement for computers certified to run Windows 10 since 2016-07-28.<a rel="nofollow" class="external autonumber" href="https://www.computerworld.com/article/3101427/microsoft-mandates-windows-10-hardware-change-for-pc-security.html">[1]</a> Linux has support for TPM 2.0 since version 3.20<a rel="nofollow" class="external autonumber" href="https://www.phoronix.com/scan.php?page=news_item&amp;px=Linux-3.20-TPM-2.0-Security">[2]</a> and should not require any other steps to be enabled on a default Arch install.
</p>
<p>Two ways to verify whether TPM 2.0 is setup without specific software:
</p>
<ul>
<li>checking the logs, e.g., by running <code>journalctl -k --grep=tpm</code> as root</li>
<li>read the value of <code>/sys/class/tpm/tpm0/device/description</code><a rel="nofollow" class="external autonumber" href="https://github.com/tpm2-software/tpm2-tools/issues/604#issuecomment-342784674">[3]</a> or <code>/sys/class/tpm/tpm0/tpm_version_major</code>
</li>
</ul>
<h3><span class="mw-headline" id="Data-at-rest_encryption_with_LUKS">Data-at-rest encryption with LUKS</span></h3>
<p>There are two methods for unlocking a LUKS volume using a TPM.  You can use <a href="../en/Clevis.html" title="Clevis">Clevis</a> or <a href="#systemd-cryptenroll">#systemd-cryptenroll</a>.
</p>
<p>Using either method, an encrypted volume or volumes may be unlocked using keys stored in a TPM, either automatically at boot or manually at a later time.  Using a TPM for this purpose ensures that your drives will not unlock unless certain conditions are met, such as your firmware not having been modified and <a href="../en/Unified_Extensible_Firmware_Interface/Secure_Boot.html" class="mw-redirect" title="Secure Boot">Secure Boot</a> not having been disabled (see <a href="#Accessing_PCR_registers">#Accessing PCR registers</a>).
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If you use this method on your root volume, this means that, as long as the previously mentioned certain conditions are met, your computer will <b>unlock automatically</b> at boot without needing to enter an encryption password.
<ul>
<li>This means that access to data is protected in case only the encrypted disk is stolen, but not in case the whole PC gets stolen.</li>
<li>Be aware that this method makes you more vulnerable to <a href="https://en.wikipedia.org/wiki/Cold_boot_attack" class="extiw" title="wikipedia:Cold boot attack">cold boot attacks</a>, because even if your computer has been powered off for a long time (ensuring the memory is completely cleared), an attacker could simply turn it on and wait for the TPM to load the key automatically. This may be a concern for high-value targets.</li>
</ul>
</div>
<h4><span class="mw-headline" id="systemd-cryptenroll">systemd-cryptenroll</span></h4>
<p>See <a href="../en/Systemd-cryptenroll.html#Trusted_Platform_Module" title="Systemd-cryptenroll">systemd-cryptenroll#Trusted Platform Module</a>.
</p>
<h3><span class="mw-headline" id="SSH">SSH</span></h3>
<p>For TPM sealed SSH keys, there are two options:
</p>
<ul><li>
<b>ssh-tpm-agent</b> — ssh-agent compatible agent using TPM backed keys.</li></ul>
<dl>
<dd>
<a rel="nofollow" class="external free" href="https://github.com/Foxboron/ssh-tpm-agent">https://github.com/Foxboron/ssh-tpm-agent</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ssh-tpm-agent">ssh-tpm-agent</a></span>
</dd>
<dd>See <a rel="nofollow" class="external text" href="https://linderud.dev/blog/store-ssh-keys-inside-the-tpm-ssh-tpm-agent/">Store ssh keys inside the TPM: ssh-tpm-agent</a>.</dd>
</dl>
<ul><li>
<b>tpm2-pkcs11</b> — PKCS#11 interface for Trusted Platform Module 2.0 hardware.</li></ul>
<dl>
<dd>
<a rel="nofollow" class="external free" href="https://github.com/tpm2-software/tpm2-pkcs11">https://github.com/tpm2-software/tpm2-pkcs11</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tpm2-pkcs11">tpm2-pkcs11</a></span>
</dd>
<dd>See <a rel="nofollow" class="external text" href="https://github.com/tpm2-software/tpm2-pkcs11/blob/master/docs/SSH.md">SSH configuration</a> and <a rel="nofollow" class="external text" href="https://incenp.org/notes/2020/tpm-based-ssh-key.html">Using a TPM for SSH authentication</a> (2020-01).</dd>
</dl>
<h3><span class="mw-headline" id="GnuPG">GnuPG</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Add instructions for probing the TPM to find out which keys it supports. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Trusted_Platform_Module.html">Talk:Trusted Platform Module</a>)</div>
</div>
<p><a href="../en/GnuPG.html" title="GnuPG">GnuPG</a>, since version 2.3, supports moving compatible keys into the TPM. See <a rel="nofollow" class="external text" href="https://gnupg.org/blog/20210315-using-tpm-with-gnupg-2.3.html">Using a TPM with GnuPG 2.3</a> for the instructions.
</p>
<h3><span class="mw-headline" id="Other_good_examples_of_TPM_2.0_usage">Other good examples of TPM 2.0 usage</span></h3>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://threat.tevora.com/secure-boot-tpm-2/">Configuring Secure Boot + TPM 2</a> (2018-06, Debian)</li>
<li>
<a rel="nofollow" class="external text" href="https://www.youtube.com/watch?v=XwaSyHJIos8">Using the TPM - It's Not Rocket Science (Anymore)</a> - Johannes Holland &amp; Peter Huewe (2020-11, Youtube): examples for OpenSSL with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tpm2-tss-engine">tpm2-tss-engine</a></span>
</li>
</ul>
<h2><span class="mw-headline" id="Accessing_PCR_registers">Accessing PCR registers</span></h2>
<p>Platform Configuration Registers (PCR) contain hashes that can be read at any time but can only be written via the extend operation, which depends on the previous hash value, thus making a sort of blockchain. They are intended to be used for platform hardware and software integrity checking between boots (e.g. protection against <a href="https://en.wikipedia.org/wiki/en:Evil_Maid_attack" class="extiw" title="wikipedia:en:Evil Maid attack">Evil Maid attack</a>).  They can be used to unlock encryption keys and proving that the correct OS was booted.
</p>
<p>The <a rel="nofollow" class="external text" href="https://trustedcomputinggroup.org/resource/pc-client-specific-platform-firmware-profile-specification/">TCG PC Client Specific Platform Firmware Profile Specification</a> defines the registers in use, and <a rel="nofollow" class="external text" href="https://uapi-group.org/specifications/specs/linux_tpm_pcr_registry/">The Linux TPM PCR Registry</a> assigns Linux system components using them.
</p>
<p>The registers are:
</p>
<dl><dd></dd></dl>
<table class="wikitable">

<tbody>
<tr>
<th scope="col">PCR
</th>
<th scope="col">Use
</th>
<th scope="col">Notes
</th>
</tr>
<tr>
<td>PCR0
</td>
<td>Core System Firmware executable code (aka Firmware)
</td>
<td>May change if you upgrade your UEFI
</td>
</tr>
<tr>
<td>PCR1
</td>
<td>Core System Firmware data (aka UEFI settings)
</td>
<td>
</td>
</tr>
<tr>
<td>PCR2
</td>
<td>Extended or pluggable executable code
</td>
<td>
</td>
</tr>
<tr>
<td>PCR3
</td>
<td>Extended or pluggable firmware data
</td>
<td>Set during Boot Device Select UEFI boot phase
</td>
</tr>
<tr>
<td>PCR4
</td>
<td>Boot Manager Code and Boot Attempts
</td>
<td>Measures the boot manager and the devices that the firmware tried to boot from
</td>
</tr>
<tr>
<td>PCR5
</td>
<td>Boot Manager Configuration and Data
</td>
<td>Can measure configuration of boot loaders; includes the GPT Partition Table
</td>
</tr>
<tr>
<td>PCR6
</td>
<td>Resume from S4 and S5 Power State Events
</td>
<td>
</td>
</tr>
<tr>
<td>PCR7
</td>
<td>Secure Boot State
</td>
<td>Contains the full contents of PK/KEK/db, as well as the specific certificates used to validate each boot application<a rel="nofollow" class="external autonumber" href="https://superuser.com/questions/1640985/how-to-enable-bitlocker-when-booting-windows-10-from-a-non-microsoft-boot-manage">[4]</a>
<p>When used, shim additionally extends it with its own MokList, MokListX, and MokSBState.
</p>
</td>
</tr>
<tr>
<td>PCR8<sup>1</sup>
</td>
<td>Hash of the kernel command line
</td>
<td>Supported by <a rel="nofollow" class="external text" href="https://lists.gnu.org/archive/html/grub-devel/2017-07/msg00003.html">grub</a> and <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/pull/2587">systemd-boot</a>
</td>
</tr>
<tr>
<td>PCR9<sup>1</sup>
</td>
<td>Hash of the initrd and EFI Load Options
</td>
<td>Linux measures the initrd and EFI Load Options, essentially the kernel cmdline options.
</td>
</tr>
<tr>
<td>PCR10<sup>1</sup>
</td>
<td>Reserved for Future Use
</td>
<td>
</td>
</tr>
<tr>
<td>PCR11<sup>1</sup>
</td>
<td>Hash of the <a href="../en/Unified_kernel_image.html" title="Unified kernel image">Unified kernel image</a>
</td>
<td>see <span class="plainlinks archwiki-template-man" title="$ man 7 systemd-stub"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-stub.7">systemd-stub(7)</a></span>
</td>
</tr>
<tr>
<td>PCR12<sup>1</sup>
</td>
<td>Overridden kernel command line, Credentials
</td>
<td>see <span class="plainlinks archwiki-template-man" title="$ man 7 systemd-stub"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-stub.7">systemd-stub(7)</a></span>
</td>
</tr>
<tr>
<td>PCR13<sup>1</sup>
</td>
<td>System Extensions
</td>
<td>see <span class="plainlinks archwiki-template-man" title="$ man 7 systemd-stub"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-stub.7">systemd-stub(7)</a></span>
</td>
</tr>
<tr>
<td>PCR14<sup>1</sup>
</td>
<td>shim's MokList, MokListX, and MokSBState.
</td>
<td>
<a rel="nofollow" class="external autonumber" href="https://github.com/rhboot/shim/blob/main/README.tpm">[5]</a>
</td>
</tr>
<tr>
<td>PCR15<sup>1</sup>
</td>
<td>
</td>
<td>Unused
</td>
</tr>
<tr>
<td>PCR16<sup>1</sup>
</td>
<td>Debug
</td>
<td>May be used and reset at any time. May be absent from an official firmware release.
</td>
</tr>
<tr>
<td>PCR23
</td>
<td>Application Support
</td>
<td>The OS can set and reset this PCR.
</td>
</tr>
</tbody>
</table>
<ol><li>Use case defined by the OS and might change between various Linux distros and Windows devices.</li></ol>
<p>On Windows, BitLocker uses PCR8-11 (Legacy) or PCR11-14 (UEFI) for its own purposes.
Documentation from tianocore<a rel="nofollow" class="external autonumber" href="https://github.com/tianocore-docs/edk2-TrustedBootChain/blob/main/4_Other_Trusted_Boot_Chains.md">[6]</a>.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tpm2-totp">tpm2-totp</a></span> facilitates this check with a human observer and dedicated trusted device.
</p>
<p>The current PCR values can be listed with <span class="plainlinks archwiki-template-man" title="$ man 1 systemd-analyze"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-analyze.1">systemd-analyze(1)</a></span>:
</p>
<pre>$ systemd-analyze pcrs
</pre>
<p>Or, alternatively with <span class="plainlinks archwiki-template-man" title="$ man 1 tpm2_pcrread"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/tpm2_pcrread.1">tpm2_pcrread(1)</a></span> from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tpm2-tools">tpm2-tools</a></span>:
</p>
<pre># tpm2_pcrread
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="TPM2_LUKS2_unlocking_still_asking_for_password">TPM2 LUKS2 unlocking still asking for password</span></h3>
<p>If you followed the <a href="#Data-at-rest_encryption_with_LUKS">instruction described above</a> for automatically unlocking luks2 devices with enrolled keys in a TPM2 hardware module, but still receive a prompt to input a password during the initramfs boot stage. You may need to <a href="../en/Kernel_module.html#Early_module_loading" title="Kernel module">early load</a> the kernel module (you can obtain its name with <code>systemd-cryptenroll --tpm2-device=list</code>) that is responsible for handling your specific TPM2 module.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a href="https://wiki.gentoo.org/wiki/Trusted_Platform_Module" class="extiw" title="gentoo:Trusted Platform Module">Gentoo:Trusted Platform Module</a></li>
<li>TPM-JS testing tool: <a rel="nofollow" class="external text" href="https://github.com/google/tpm-js">source</a> - <a rel="nofollow" class="external text" href="https://google.github.io/tpm-js/">live web version</a>.</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Security.html" title="Category:Security">Security</a></li>
<li><a href="../en/Category:Hardware.html" title="Category:Hardware">Hardware</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Trusted_Platform_Module&amp;oldid=821352">https://wiki.archlinux.org/index.php?title=Trusted_Platform_Module&amp;oldid=821352</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 24 November 2024, at 18:09.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
