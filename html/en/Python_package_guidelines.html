<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Python package guidelines - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.45.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Python_package_guidelines rootpage-Python_package_guidelines skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Package_naming" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Package_naming">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Package naming</span>
			</div>
		</a>
		
		<ul id="toc-Package_naming-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Architecture" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Architecture">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Architecture</span>
			</div>
		</a>
		
		<ul id="toc-Architecture-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Source" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Source">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Source</span>
			</div>
		</a>
		
		<ul id="toc-Source-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Installation_methods" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation_methods">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Installation methods</span>
			</div>
		</a>
		
			<button aria-controls="toc-Installation_methods-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Installation methods subsection</span>
			</button>
		
		<ul id="toc-Installation_methods-sublist" class="vector-toc-list">
			<li id="toc-Standards_based_(PEP_517)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Standards_based_(PEP_517)">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>Standards based (PEP 517)</span>
				</div>
			</a>
			
			<ul id="toc-Standards_based_(PEP_517)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-setuptools_or_distutils" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#setuptools_or_distutils">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.2</span>
					<span>setuptools or distutils</span>
				</div>
			</a>
			
			<ul id="toc-setuptools_or_distutils-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Check" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Check">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Check</span>
			</div>
		</a>
		
		<ul id="toc-Check-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Tips and tricks</span>
			</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Using_Python_version" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_Python_version">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.1</span>
					<span>Using Python version</span>
				</div>
			</a>
			
			<ul id="toc-Using_Python_version-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_site-packages" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_site-packages">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.2</span>
					<span>Using site-packages</span>
				</div>
			</a>
			
			<ul id="toc-Using_site-packages-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Test_directory_in_site-package" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Test_directory_in_site-package">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.3</span>
					<span>Test directory in site-package</span>
				</div>
			</a>
			
			<ul id="toc-Test_directory_in_site-package-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Disable_pytest_options" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Disable_pytest_options">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.4</span>
					<span>Disable pytest options</span>
				</div>
			</a>
			
			<ul id="toc-Disable_pytest_options-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Fix_reproducibility_issue_with_meson-python" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Fix_reproducibility_issue_with_meson-python">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.5</span>
					<span>Fix reproducibility issue with meson-python</span>
				</div>
			</a>
			
			<ul id="toc-Fix_reproducibility_issue_with_meson-python-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Running_tests_with_an_installed_package" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Running_tests_with_an_installed_package">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.6</span>
					<span>Running tests with an installed package</span>
				</div>
			</a>
			
			<ul id="toc-Running_tests_with_an_installed_package-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar no-font-mode-scale">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Python package guidelines</span></h1>
							
</header>
				<div class="vector-column-end no-font-mode-scale">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-navigation">
<b><a href="../en/Arch_package_guidelines.html" title="Arch package guidelines">Arch package guidelines</a></b>
<hr>
<p><a href="../en/32-bit_package_guidelines.html" title="32-bit package guidelines">32-bit</a> – <a href="../en/CLR_package_guidelines.html" title="CLR package guidelines">CLR</a> – <a href="../en/CMake_package_guidelines.html" title="CMake package guidelines">CMake</a> – <a href="../en/Cross-compiling_tools_package_guidelines.html" title="Cross-compiling tools package guidelines">Cross</a> – <a href="../en/DKMS_package_guidelines.html" title="DKMS package guidelines">DKMS</a> – <a href="../en/Eclipse_plugin_package_guidelines.html" title="Eclipse plugin package guidelines">Eclipse</a> – <a href="../en/Electron_package_guidelines.html" title="Electron package guidelines">Electron</a> – <a href="../en/Font_package_guidelines.html" title="Font package guidelines">Font</a> – <a href="../en/Free_Pascal_package_guidelines.html" title="Free Pascal package guidelines">Free Pascal</a> – <a href="../en/GNOME_package_guidelines.html" title="GNOME package guidelines">GNOME</a> – <a href="../en/Go_package_guidelines.html" title="Go package guidelines">Go</a> – <a href="../en/Haskell_package_guidelines.html" title="Haskell package guidelines">Haskell</a> – <a href="../en/Java_package_guidelines.html" title="Java package guidelines">Java</a> – <a href="../en/KDE_package_guidelines.html" title="KDE package guidelines">KDE</a> – <a href="../en/Kernel_module_package_guidelines.html" title="Kernel module package guidelines">Kernel modules</a> – <a href="../en/Lisp_package_guidelines.html" title="Lisp package guidelines">Lisp</a> – <a href="../en/Meson_package_guidelines.html" title="Meson package guidelines">Meson</a> – <a href="../en/MinGW_package_guidelines.html" title="MinGW package guidelines">MinGW</a> – <a href="../en/Node.js_package_guidelines.html" title="Node.js package guidelines">Node.js</a> – <a href="../en/Nonfree_applications_package_guidelines.html" title="Nonfree applications package guidelines">Nonfree</a> – <a href="../en/OCaml_package_guidelines.html" title="OCaml package guidelines">OCaml</a> – <a href="../en/Perl_package_guidelines.html" title="Perl package guidelines">Perl</a> – <a href="../en/PHP_package_guidelines.html" title="PHP package guidelines">PHP</a> – <a class="mw-selflink selflink">Python</a> – <a href="../en/R_package_guidelines.html" title="R package guidelines">R</a> – <a href="../en/Ruby_package_guidelines.html" title="Ruby package guidelines">Ruby</a> – <a href="../en/Rust_package_guidelines.html" title="Rust package guidelines">Rust</a> - <a href="../en/Arch_package_guidelines/Security.html" title="Arch package guidelines/Security">Security</a> – <a href="../en/Shell_package_guidelines.html" title="Shell package guidelines">Shell</a> – <a href="../en/VCS_package_guidelines.html" title="VCS package guidelines">VCS</a> – <a href="../en/Web_application_package_guidelines.html" title="Web application package guidelines">Web</a> – <a href="../en/Wine_package_guidelines.html" title="Wine package guidelines">Wine</a>
</p>
</div>
<p>This document covers standards and guidelines on writing <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILDs</a> for <a href="../en/Python.html" title="Python">Python</a> software.
</p>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Package_naming">Package naming</h2></div>
<p>For <a href="../en/Python.html#Installation" title="Python">Python 3</a> library modules, use <code>python-<i>modulename</i></code>. Also use the prefix if the package provides a program that is strongly coupled to the Python ecosystem (e.g. <i>pip</i> or <i>tox</i>). For other applications, use only the program name.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> The package name should be entirely lowercase.</div>
<div class="mw-heading mw-heading2"><h2 id="Architecture">Architecture</h2></div>
<p>See <a href="../en/PKGBUILD.html#arch" title="PKGBUILD">PKGBUILD#arch</a>.
</p>
<p>A Python package that contains C extensions is architecture-dependent. Otherwise it is most likely architecture-independent.
</p>
<p>Packages built using <a rel="nofollow" class="external text" href="https://setuptools.pypa.io/">setuptools</a> define their C extensions using the <code>ext_modules</code> keyword in <code>setup.py</code>.
</p>
<div class="mw-heading mw-heading2"><h2 id="Source">Source</h2></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> With <a rel="nofollow" class="external text" href="https://rfc.archlinux.page/0020-sources-for-python-packaging/">RFC0020</a> the default is to use upstream provided source tarballs, instead of PyPI provided sdist tarballs.</div>
<p>Download URLs linked from the PyPI website include an unpredictable hash that needs to be fetched from the PyPI website each time a package must be updated. This makes them unsuitable for use in a PKGBUILD. PyPI <a rel="nofollow" class="external text" href="https://github.com/pypa/pypi-legacy/issues/438#issuecomment-226940730">provides</a> an alternative stable scheme: <a href="../en/PKGBUILD.html#source" title="PKGBUILD">PKGBUILD#source</a> <code>source=()</code> array should use the following URL templates:
</p>
<dl>
<dt>Source package</dt>
<dd></dd>
<dd><code>https://files.pythonhosted.org/packages/source/${_name::1}/${_name//-/_}/${_name//-/_}-$pkgver.tar.gz</code></dd>
<dt>Pure Python wheel package</dt>
<dd>
<code>https://files.pythonhosted.org/packages/py2.py3/${_name::1}/$_name/${_name//-/_}-$pkgver-py2.py3-none-any.whl</code> (Bilingual – Python 2 and Python 3 compatible)</dd>
<dd>
<code>https://files.pythonhosted.org/packages/py3/${_name::1}/$_name/${_name//-/_}-$pkgver-py3-none-any.whl</code> (Python 3 only)</dd>
<dd>Note that the distribution name can contain dashes, while its representation in a wheel filename cannot (they are converted to underscores).</dd>
<dt>Architecture specific wheel package</dt>
<dd>Additional architecture-specific arrays can be added by appending an underscore and the architecture name, e.g.  <code>source_x86_64=('...')</code>. Also <code>_py=cp310</code> can be used to not repeat the Python version:</dd>
<dd><code>https://files.pythonhosted.org/packages/$_py/${_name::1}/$_name/${_name//-/_}-$pkgver-$_py-${_py}m-manylinux1_x86_64.whl</code></dd>
</dl>
<p>Note that a custom <code><b>_name</b></code> variable is used instead of <code>pkgname</code> since Python packages are generally prefixed with <code>python-</code>. This variable can generically be defined as follows:
</p>
<pre>_name=${pkgname#python-}
</pre>
<div class="mw-heading mw-heading2"><h2 id="Installation_methods">Installation methods</h2></div>
<p>Python packages are generally installed using language-specific package manager such as <a rel="nofollow" class="external text" href="https://pip.pypa.io/">pip</a>, which fetches packages from an online repository (usually <a rel="nofollow" class="external text" href="https://pypi.org/">PyPI</a>, the Python Package Index) and tracks the relevant files.
</p>
<p>However, for managing Python packages from within <code>PKGBUILD</code>s, one needs to "install" the Python package to the temporary location <code><i>$pkgdir</i>/usr/lib/python<i>&lt;Python version&gt;</i>/site-packages/<i>$pkgname</i></code>.
</p>
<p>For Python packages using <a rel="nofollow" class="external text" href="https://www.python.org/dev/peps/pep-0517/">standard metadata</a> to specify their build backend in <code>pyproject.toml</code>, this can most easily achieved using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-build">python-build</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-installer">python-installer</a></span>.
Old packages might fail to specify that they use setuptools, and only offer a <code>setup.py</code> that has to be invoked manually.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Dependencies from the package's metadata must be defined in the <code>depends</code> array otherwise they will not be installed.</div>
<div class="mw-heading mw-heading3"><h3 id="Standards_based_(PEP_517)">
<span id="Standards_based_.28PEP_517.29"></span>Standards based (PEP 517)</h3></div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong>  When building from upstream provided source tarballs and upstream relies on git to derive a version string for the project, it is required to set tooling specific environment variables to <code>$pkgver</code> before building a wheel:
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-flit-core">python-flit-core</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-hatch-vcs">python-hatch-vcs</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-setuptools-scm">python-setuptools-scm</a></span>: <code>SETUPTOOLS_SCM_PRETEND_VERSION</code>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-pbr">python-pbr</a></span>: <code>PBR_VERSION</code>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-pdm-backend">python-pdm-backend</a></span>: <code>PDM_BUILD_SCM_VERSION</code>
</li>
</ul>
</div>
<p>A standards based workflow is straightforward: Build a wheel using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-build">python-build</a></span> and install it to <code>$pkgdir</code> using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-installer">python-installer</a></span>:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Besides <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-build">python-build</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-installer">python-installer</a></span>, you will also need to add the <a rel="nofollow" class="external text" href="https://packaging.python.org/en/latest/tutorials/packaging-projects/#choosing-a-build-backend">build backend</a> used by the package to <code>makedepends</code>. All build backends that are available in the repo are members of the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/groups/x86_64/python-build-backend/">python-build-backend</a></span> group. Check the <code>build-system.build-backend</code> in the project's <code>pyproject.toml</code> which is applicable for your project. If it is not configured, it defaults to <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-setuptools">python-setuptools</a></span>.</div>
<pre>makedepends=(python-build python-installer python-wheel)

build() {
    cd $_name-$pkgver
    python -m build --wheel --no-isolation
}

package() {
    cd $_name-$pkgver
    python -m installer --destdir="$pkgdir" dist/*.whl
}</pre>
<p>where:
</p>
<ul>
<li>
<code>--wheel</code> results in only a wheel file to be built, no source distribution.</li>
<li>
<code>--no-isolation</code> means that the package is built using what is installed on your system (which includes packages you specified in <code>depends</code>), by default the tool creates an isolated virtual environment and performs the build there.</li>
<li>
<code>--destdir="$pkgdir"</code> prevents trying to directly install in the host system instead of inside the package file, which would result in a permission error</li>
<li>
<code>--compile-bytecode=...</code> or <code>--no-compile-bytecode</code> can be passed to <code>installer</code>, but the default is sensibly picked, so this should not be necessary.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Skipping <code>build</code> and putting the <code>.whl</code> file in your <code>source</code> array is discouraged in favor of building from source, and should only be used when the latter is not a viable option (for example, packages which <b>only</b> come with wheel sources, and therefore cannot be built from source).</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> If your package is a <a href="../en/VCS_package_guidelines.html" title="VCS package guidelines">VCS package</a> (<code>python-…-git</code>), include the command <code>git -C "${srcdir}/${pkgname}" clean -dfx</code> in your <code>prepare</code> function. This removes stale wheels along with other build artifacts, and helps prevent issues further down the road. See also upstream issues for <a rel="nofollow" class="external text" href="https://github.com/pypa/setuptools/issues/1347">setuptools</a> and <a rel="nofollow" class="external text" href="https://github.com/python-poetry/poetry/issues/1329">Poetry</a>.</div>
<div class="mw-heading mw-heading3"><h3 id="setuptools_or_distutils">setuptools or distutils</h3></div>
<p>If no <code>pyproject.toml</code> can be found or it fails to contain a <code>[build-system]</code> table, it means the project is using the old legacy format, where the project provides a <i>setup.py</i> file, which invokes the <code>setup</code> function from <i>setuptools</i> or <i>distutils.core</i>.
</p>
<p>Such packages usually can also be built and installed using the method described above using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-build">python-build</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-installer">python-installer</a></span>, and this is the preferred method. But they will also additionally need <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-setuptools">python-setuptools</a></span> in <code>makedepends</code>. 
</p>
<p>You <i>can</i> still build and install these packages using the old, deprecated way of running <i>setup.py</i> directly, which is shown below and it is described here for those cases, where the pep-517 compliant way does not work for some reason.
</p>
<p>But note that you will get the following warning in the output of the <code>package</code> step, when building a package using this method:
</p>
<pre>SetuptoolsDeprecationWarning: setup.py install is deprecated.</pre>
<p>Also note that Python versions from 3.12 onwards do not include <i>distutils</i> in the standard library any more, which means that packages for projects still using <i>setup.py</i> generally need to have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-setuptools">python-setuptools</a></span> in <code>makedepends</code>, since that provides its own version of <i>distutils</i>.
</p>
<p><br>
</p>
<pre>makedepends=('python-setuptools')

build() {
    cd $_name-$pkgver
    python setup.py build
}

package() {
    cd $_name-$pkgver
    python setup.py install --root="$pkgdir" --optimize=1
}</pre>
<p>where:
</p>
<ul>
<li>
<code>--root="$pkgdir"</code> works like <code>--destdir</code> above</li>
<li>
<code>--optimize=1</code> compiles optimized bytecode files (<i>.opt-1.pyc</i>) so they can be tracked by <a href="../en/Pacman.html" title="Pacman">pacman</a> instead of being created on the host system on demand.</li>
<li>Adding <code>--skip-build</code> optimizes away the unnecessary attempt to re-run the build steps already run in the <code>build()</code> function, if that is the case.</li>
</ul>
<p>If a package uses <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-setuptools-scm">python-setuptools-scm</a></span>, the package most likely will not build with an error such as:
</p>
<pre>LookupError: setuptools-scm was unable to detect version for /build/python-jsonschema/src/jsonschema-3.2.0.

Make sure you're either building from a fully intact git repository or PyPI tarballs. Most other sources (such as GitHub's tarballs, a git checkout without the .git folder) don't contain the necessary metadata and will not work.</pre>
<p>To get it building <code>SETUPTOOLS_SCM_PRETEND_VERSION</code> has to be exported as an environment variable with <code>$pkgver</code> as the value:
</p>
<pre>export SETUPTOOLS_SCM_PRETEND_VERSION=$pkgver
</pre>
<div class="mw-heading mw-heading2"><h2 id="Check">Check</h2></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> 
<ul>
<li>Avoid using <code>tox</code> to run testsuites as it is explicitly designed to test repeatable configurations downloaded from PyPI while <code>tox</code> is running, and does <b>not</b> test the version that will be installed by the package. This defeats the purpose of having a <i>check</i> function at all.</li>
<li>Avoid adding pytest plugins for linting, coverage or type checking to <b>checkdepends</b> (see the <a href="#Disable_pytest_options">#Disable pytest options</a> section for details). This makes bootstrapping harder and these tests are not required for distribution packaging as they do not test functionality.</li>
<li>Avoid using relative paths when setting a custom <code>PYTHONPATH</code> for tests, as it may lead to non-obvious error cases. Use absolute paths instead.</li>
</ul>
</div>
<p>Most Python projects providing a testsuite use the unittest runner or nosetests or pytest (provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python">python</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-nose">python-nose</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-pytest">python-pytest</a></span>, respectively) to run tests with <code>test</code> in the name of the file or directory containing the testsuite. In general, simply running <code>nosetests</code> or <code>pytest</code> is enough to run the testsuite.
</p>
<pre>check(){
    cd $_name-$pkgver
    
    # Builtin unittest
    python -m unittest discover -v

    # For nosetests
    nosetests

    # For pytest
    pytest
}
</pre>
<p>If there is a compiled C extension, the tests need to be run using a <code>$PYTHONPATH</code>, that reflects the current major and minor version of Python in order to find and load it.
</p>
<pre>check(){
    cd $_name-$pkgver
    local python_version=$(python -c 'import sys; print("".join(map(str, sys.version_info[:2])))')
    
    # Builtin unittest
    PYTHONPATH="$PWD/build/lib.linux-$CARCH-cpython-$python_version" python -m unittest discover -vs .
    
    # For nosetests
    PYTHONPATH="$PWD/build/lib.linux-$CARCH-cpython-$python_version" nosetests

    # For pytest
    PYTHONPATH="$PWD/build/lib.linux-$CARCH-cpython-$python_version" pytest
}</pre>
<div class="mw-heading mw-heading2"><h2 id="Tips_and_tricks">Tips and tricks</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Using_Python_version">Using Python version</h3></div>
<p>Sometimes during preparing, building, testing or installation it is required to refer to the system's major and minor Python version (e.g. <code>3.9</code> or <code>3.10</code>). Do not hardcode this and instead use a call to the Python interpreter to retrieve the information and store it in a local variable:
</p>
<pre>check(){
  local python_version=$(python -c 'import sys; print(".".join(map(str, sys.version_info[:2])))')
  ...
}</pre>
<div class="mw-heading mw-heading3"><h3 id="Using_site-packages">Using site-packages</h3></div>
<p>Sometimes during building, testing or installation it is required to refer to the system's <code>site-packages</code> directory. Do not hardcode this directory and use a call to the Python interpreter instead to retrieve the path and store it in a local variable:
</p>
<pre>check(){
  local site_packages=$(python -c "import site; print(site.getsitepackages()[0])")
  ...
}</pre>
<div class="mw-heading mw-heading3"><h3 id="Test_directory_in_site-package">Test directory in site-package</h3></div>
<p>Make sure to not install a directory named just <code>tests/</code> directly under <code>site-packages/</code> (i.e. <code>/usr/lib/pythonX.Y/site-packages/tests/</code>). Doing so could lead to conflicts between packages. Python package projects using <i>setuptools</i> are sometimes misconfigured to include the directory containing its tests as a top level Python package. If you encounter this, you can help by filing an issue with the package project and ask them to fix this, e.g. <a rel="nofollow" class="external text" href="https://github.com/Lightning-AI/lightning/issues/10335">like this</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Disable_pytest_options">Disable pytest options</h3></div>
<p>When running pytest, it is mostly desirable to not run with additional plugins. Especially plugins for linting and coverage are counterproductive in packaging, as changes in behavior may have tests fail.
To disable pytest options such as <code>addopts</code> it is preferred to use an option override on the command line over patching any configuration files used by pytest due to the maintenance overhead.
</p>
<p>To unset all additional options use
</p>
<pre>pytest -o addopts=""
</pre>
<div class="mw-heading mw-heading3"><h3 id="Fix_reproducibility_issue_with_meson-python">Fix reproducibility issue with meson-python</h3></div>
<p>When using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=meson-python">meson-python</a></span> as a PEP 517 build backend it uses randomized folder paths <a rel="nofollow" class="external text" href="https://github.com/mesonbuild/meson-python/issues/703">that create reproducibility issues</a>. This can be circumvented by hardcoding the used folder with the <code>-Cbuild-dir</code> flag:
</p>
<pre>python -m build --wheel --no-isolation -Cbuild-dir=build
</pre>
<div class="mw-heading mw-heading3"><h3 id="Running_tests_with_an_installed_package">Running tests with an installed package</h3></div>
<p>Some packages require being installed to have the tests run successfully. In such cases, such as for example <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-narwhals">python-narwhals</a></span>, you can create a <i>virtual environment</i> to install the built package and run the tests there.
</p>
<pre>python -m venv --system-site-packages test-env
test-env/bin/python -m installer dist/*.whl
test-env/bin/python -P -m pytest
</pre>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Arch_package_guidelines.html" title="Category:Arch package guidelines">Arch package guidelines</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Python_package_guidelines&amp;oldid=850782">https://wiki.archlinux.org/index.php?title=Python_package_guidelines&amp;oldid=850782</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 26 October 2025, at 13:04.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container no-font-mode-scale">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue  vector-search-box-show-thumbnail vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search cdx-typeahead-search--show-thumbnail">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input mw-searchInput" autocomplete="off" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true"><span class="mw-page-title-main">Python package guidelines</span></div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only reading-lists-bookmark" id="ca-bookmark-sticky-header" tabindex="-1" data-event-name="watch-sticky-bookmark"><span class="vector-icon mw-ui-icon-wikimedia-bookmarkOutline mw-ui-icon-wikimedia-wikimedia-bookmarkOutline"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
