<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Patching packages - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.43.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Patching_packages rootpage-Patching_packages skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Creating_patches" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Creating_patches">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Creating patches</span>
			</div>
		</a>
		
		<ul id="toc-Creating_patches-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Applying_patches" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Applying_patches">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Applying patches</span>
			</div>
		</a>
		
		<ul id="toc-Applying_patches-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Using_quilt" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Using_quilt">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Using quilt</span>
			</div>
		</a>
		
		<ul id="toc-Using_quilt-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Patching packages</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AB%E3%83%91%E3%83%83%E3%83%81%E3%82%92%E9%81%A9%E7%94%A8" title="パッケージにパッチを適用 – 日本語" lang="ja" hreflang="ja" data-title="パッケージにパッチを適用" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/Patching_packages.html" title="Patching packages – português" lang="pt" hreflang="pt" data-title="Patching packages" data-language-autonym="Português" data-language-local-name="português" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Patching_packages" title="Patching packages – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" data-title="Patching packages" data-language-autonym="中文（简体）" data-language-local-name="中文（简体）" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Creating_packages.html" title="Creating packages">Creating packages</a></li>
</ul>
</div>
<p>This article covers how to create and how to apply patches to packages in the <a href="../en/Arch_build_system.html" title="Arch build system">Arch build system</a> (ABS).
</p>
<p>A <a href="https://en.wikipedia.org/wiki/Patch_(computing)" class="extiw" title="wikipedia:Patch (computing)">patch</a> describes a set of line changes for one or multiple files. Patches are typically used to automate the changing of source code.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Creating_patches">Creating patches</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you only need to change one or two lines, you might want to use <a href="../en/Core_utilities.html#Essentials" class="mw-redirect" title="Sed">sed</a> instead.</div>
<p>The <a href="https://en.wikipedia.org/wiki/diff" class="extiw" title="wikipedia:diff">diff</a> tool compares files line by line. If you save its output you have a patch, e.g. <code>diff --unified --recursive --text foo bar &gt; foobar.patch</code> (which can be shortened to <code>diff -ura</code>). If you pass directories <i>diff</i> will compare the files they contain.
</p>
<ol>
<li>Delete the <code>src</code> directory if you have already built the package.</li>
<li>Run <code>makepkg --nobuild</code>/<code>makepkg -o</code> which will download and extract the source files, specified in <code>PKGBUILD</code>, but not build them. If the system you are making the patch on does not have the required dependencies, you may have to run <code>makepkg --nobuild --nodeps</code>/<code>makepkg -od</code> instead.</li>
<li>Create two copies of the extracted directory in the <code>src</code> directory, one as a pristine copy and one for your altered version. We will call them <code>package.orig</code> and <code>package.new</code>.</li>
<li>Make your changes in the <code>package.new</code> directory.</li>
<li>Run <code>diff -ura package.orig package.new --color</code> and check if the patch looks good.</li>
<li>Run <code>diff -ura package.orig package.new &gt; package.patch</code> to create the patch.</li>
<li>Change into the initial <code>package.orig</code> directory from which you made copies and apply the patch using <code>patch --strip=1 --input=../package.patch</code> (which can be shortened to <code>patch -p1 -i ../package.patch</code>). Verify that the patch is working by building and installing the modified package with <code>makepkg --noextract --install</code>/<code>makepkg -ei</code>.</li>
</ol>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You can also create patches with <a href="../en/Git.html" title="Git">Git</a> using <code>git diff</code> or <code>git format-patch</code> <a rel="nofollow" class="external autonumber" href="https://stackoverflow.com/questions/6658313/generate-a-git-patch-for-a-specific-commit">[1]</a>.</div>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 1 diff"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/diff.1">diff(1)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 1 git-diff"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/git-diff.1">git-diff(1)</a></span> for more info.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong>  Most git hosting platforms (such as GitHub or GitLab) allow to generate patches for a specific commit or a specific merge/pull request by appending <code>.patch</code> to their URL. For GitHub, consider also adding a <code>?full_index=1</code> parameter at the end of the URL to avoid checksum mismatches due to future changes to the object hash length.</div>
<h2><span class="mw-headline" id="Applying_patches">Applying patches</span></h2>
<p>This section outlines how to apply patches you created or downloaded from the Internet from within a <code>PKGBUILD</code>'s <code>prepare()</code> function. Follow these steps:
</p>
<ol>
<li>Add an entry to the <code>source</code> array of the <code>PKGBUILD</code> for the patch file, separated from the original source url by a space. If the file is available online, you can provide the full URL and it will automatically be downloaded and placed in the <code>src</code> directory. If it is a patch you created yourself, or is otherwise not available, you should place the patch file in the same directory as the <code>PKGBUILD</code> file, and just add the name of the file to the source array so that it is copied into the <code>src</code> directory. If you redistribute the <code>PKGBUILD</code>, you should, of course, include the patch with the <code>PKGBUILD</code>.</li>
<li>Then use <code>makepkg -g &gt;&gt; PKGBUILD</code> or <code>updpkgsums</code> (from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pacman-contrib">pacman-contrib</a></span>) to update the <code>sha512sums</code> array. Or manually add an entry to the <code>sha512sums</code> array; you can generate the sum of your patch using <i>sha512sum</i> tool.</li>
<li>Create the <code>prepare()</code> function in the <code>PKGBUILD</code> if one is not already present.</li>
<li>The first step is to change into the directory that needs to be patched (in the <code>prepare()</code> function, not on your terminal! You want to automate the process of applying the patch).  You can do this with something like <code>cd $pkgname-$pkgver</code>. <code>$pkgname-$pkgver</code> is often the name of a directory created by untarring a downloaded source file, but not in all cases.</li>
<li>Now you simply need to apply the patch from within this directory. This is very simply done by adding <code>patch -p1 -i <i>pkgname</i>.patch</code> to your <code>prepare()</code> function, changing <code><i>pkgname</i>.patch</code> to the name of the file containing the diff (the file that was automatically copied into your <code>src</code> directory because it was in the <code>source</code> array of the <code>PKGBUILD</code> file).</li>
</ol>
<p>An example prepare-function:
</p>
<pre>prepare() {
    cd $pkgname-$pkgver
    patch -Np1 -i ../eject.patch
}
</pre>
<p>Alternatively, you can use the <code>--directory</code>/<code>-d</code> flag of <code>patch</code> without having to cd first. The example above would then become:
</p>
<pre>prepare() {
    patch -d $pkgname-$pkgver -Np1 -i ../eject.patch
}
</pre>
<p>Run <code>makepkg</code> from the terminal now. If all goes well, the patch will be automatically applied, and your new package will contain whatever changes were included in the patch.  If not, you may have to experiment with the <code>--strip</code>/<code>-p</code> option of patch. While experimenting, you might find <code>--dry-run</code>, <code>--reverse</code> or <code>--verbose</code> options usable. Read <span class="plainlinks archwiki-template-man" title="$ man 1 patch"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/patch.1">patch(1)</a></span> for more information.
</p>
<p>Basically it works as follows. If the diff file was created to apply patches to files in <code>myversion/</code>, the diff files will be applied to <code>myversion/file</code>. You are running it from within the <code>yourversion/</code> directory (because you would cd into that directory in the <code>PKGBUILD</code>), so when patch applies the file, you want it to apply it to the file <code>file</code>, taking off the <code>myversion/</code> part. <code>-p1</code> does this, by removing one directory from the path. However, if the developer patched in <code>myfiles/myversion</code>, you need to remove two directories, so you use <code>-p2</code>.
</p>
<p>If you do not apply a <code>-p</code> option, it will take off all directory structure. This is OK if all the files are in the base directory, but if the patch was created on <code>myversion/</code> and one of the edited files was <code>myversion/src/file</code>, and you run the patch without a <code>-p</code> option from within <code>yourversion</code>, it will try to patch a file named <code>yourversion/file</code>.
</p>
<p>Most developers create patches from the parent directory of the directory that is being patched, so <code>-p1</code> will usually be right.
</p>
<h2><span class="mw-headline" id="Using_quilt">Using quilt</span></h2>
<p>A simpler way to create patches is using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=quilt">quilt</a></span> which provides better support for managing many patches, such as applying patches, refreshing patches, and reverting patched files to original state. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=quilt">quilt</a></span> is used on <a href="https://wiki.debian.org/UsingQuilt" class="extiw" title="debian:UsingQuilt">Debian</a> to manage their patches. See <a rel="nofollow" class="external text" href="http://www.shakthimaan.com/downloads/glv/quilt-tutorial/quilt-doc.pdf">Using Quilt</a> for basic information about basic quilt usage to generate, apply patches, and reverting patched files.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul><li>
<a rel="nofollow" class="external free" href="http://www.kegel.com/academy/opensource.html">http://www.kegel.com/academy/opensource.html</a> — Useful information on patching files</li></ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Package_management.html" title="Category:Package management">Package management</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Patching_packages&amp;oldid=814381">https://wiki.archlinux.org/index.php?title=Patching_packages&amp;oldid=814381</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 12 August 2024, at 08:35.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki.svg" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul></ul>
</div>
</body>
</html>
