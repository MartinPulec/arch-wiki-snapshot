<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Unbound - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.45.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Unbound rootpage-Unbound skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Installation</span>
			</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Configuration</span>
			</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-Local_DNS_server" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Local_DNS_server">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>Local DNS server</span>
				</div>
			</a>
			
			<ul id="toc-Local_DNS_server-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Root_hints" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Root_hints">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>Root hints</span>
				</div>
			</a>
			
			<ul id="toc-Root_hints-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-DNSSEC_validation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#DNSSEC_validation">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3</span>
					<span>DNSSEC validation</span>
				</div>
			</a>
			
			<ul id="toc-DNSSEC_validation-sublist" class="vector-toc-list">
				<li id="toc-Testing_validation" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Testing_validation">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3.1</span>
					<span>Testing validation</span>
				</div>
			</a>
			
			<ul id="toc-Testing_validation-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Forwarding_queries" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Forwarding_queries">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4</span>
					<span>Forwarding queries</span>
				</div>
			</a>
			
			<ul id="toc-Forwarding_queries-sublist" class="vector-toc-list">
				<li id="toc-Allow_local_network_to_use_DNS" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Allow_local_network_to_use_DNS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4.1</span>
					<span>Allow local network to use DNS</span>
				</div>
			</a>
			
			<ul id="toc-Allow_local_network_to_use_DNS-sublist" class="vector-toc-list">
				<li id="toc-Using_openresolv" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Using_openresolv">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4.1.1</span>
					<span>Using openresolv</span>
				</div>
			</a>
			
			<ul id="toc-Using_openresolv-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Exclude_local_subnets_from_answers" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Exclude_local_subnets_from_answers">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4.1.2</span>
					<span>Exclude local subnets from answers</span>
				</div>
			</a>
			
			<ul id="toc-Exclude_local_subnets_from_answers-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Include_local_DNS_server" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Include_local_DNS_server">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4.1.3</span>
					<span>Include local DNS server</span>
				</div>
			</a>
			
			<ul id="toc-Include_local_DNS_server-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Forward_all_remaining_requests" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Forward_all_remaining_requests">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4.2</span>
					<span>Forward all remaining requests</span>
				</div>
			</a>
			
			<ul id="toc-Forward_all_remaining_requests-sublist" class="vector-toc-list">
				<li id="toc-Using_openresolv_2" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Using_openresolv_2">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4.2.1</span>
					<span>Using openresolv</span>
				</div>
			</a>
			
			<ul id="toc-Using_openresolv_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Manually_specifying_DNS_servers" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Manually_specifying_DNS_servers">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4.2.2</span>
					<span>Manually specifying DNS servers</span>
				</div>
			</a>
			
			<ul id="toc-Manually_specifying_DNS_servers-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Forwarding_using_DNS_over_TLS" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Forwarding_using_DNS_over_TLS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4.3</span>
					<span>Forwarding using DNS over TLS</span>
				</div>
			</a>
			
			<ul id="toc-Forwarding_using_DNS_over_TLS-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Access_control" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Access_control">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.5</span>
					<span>Access control</span>
				</div>
			</a>
			
			<ul id="toc-Access_control-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Usage" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Usage">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Usage</span>
			</div>
		</a>
		
			<button aria-controls="toc-Usage-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Usage subsection</span>
			</button>
		
		<ul id="toc-Usage-sublist" class="vector-toc-list">
			<li id="toc-Starting_Unbound" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Starting_Unbound">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>Starting Unbound</span>
				</div>
			</a>
			
			<ul id="toc-Starting_Unbound-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Remotely_control_Unbound" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Remotely_control_Unbound">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>Remotely control Unbound</span>
				</div>
			</a>
			
			<ul id="toc-Remotely_control_Unbound-sublist" class="vector-toc-list">
				<li id="toc-Setting_up_unbound-control" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Setting_up_unbound-control">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2.1</span>
					<span>Setting up unbound-control</span>
				</div>
			</a>
			
			<ul id="toc-Setting_up_unbound-control-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_unbound-control" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Using_unbound-control">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2.2</span>
					<span>Using unbound-control</span>
				</div>
			</a>
			
			<ul id="toc-Using_unbound-control-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Tips and tricks</span>
			</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Domain_blacklisting" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Domain_blacklisting">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>Domain blacklisting</span>
				</div>
			</a>
			
			<ul id="toc-Domain_blacklisting-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Adding_an_authoritative_DNS_server" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Adding_an_authoritative_DNS_server">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.2</span>
					<span>Adding an authoritative DNS server</span>
				</div>
			</a>
			
			<ul id="toc-Adding_an_authoritative_DNS_server-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-WAN_facing_DNS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#WAN_facing_DNS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.3</span>
					<span>WAN facing DNS</span>
				</div>
			</a>
			
			<ul id="toc-WAN_facing_DNS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Roothints_systemd_timer" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Roothints_systemd_timer">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.4</span>
					<span>Roothints systemd timer</span>
				</div>
			</a>
			
			<ul id="toc-Roothints_systemd_timer-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Keeping_DNS_cache_always_up_to_date" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Keeping_DNS_cache_always_up_to_date">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.5</span>
					<span>Keeping DNS cache always up to date</span>
				</div>
			</a>
			
			<ul id="toc-Keeping_DNS_cache_always_up_to_date-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Serving_expired_records" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Serving_expired_records">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.6</span>
					<span>Serving expired records</span>
				</div>
			</a>
			
			<ul id="toc-Serving_expired_records-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Troubleshooting</span>
			</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Issues_concerning_num-threads" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Issues_concerning_num-threads">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>Issues concerning num-threads</span>
				</div>
			</a>
			
			<ul id="toc-Issues_concerning_num-threads-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-First_lookup_fails_after_start" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#First_lookup_fails_after_start">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2</span>
					<span>First lookup fails after start</span>
				</div>
			</a>
			
			<ul id="toc-First_lookup_fails_after_start-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Timeout_on_(recursive)_lookup" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Timeout_on_(recursive)_lookup">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.3</span>
					<span>Timeout on (recursive) lookup</span>
				</div>
			</a>
			
			<ul id="toc-Timeout_on_(recursive)_lookup-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar no-font-mode-scale">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Unbound</span></h1>
							
</header>
				<div class="vector-column-end no-font-mode-scale">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Domain_name_resolution.html" title="Domain name resolution">Domain name resolution</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://unbound.net/">Unbound</a> is a validating, recursive, and caching DNS resolver. According to <a href="https://en.wikipedia.org/wiki/Unbound_(DNS_Server)" class="extiw" title="wikipedia:Unbound (DNS Server)">Wikipedia</a>:
</p>
<dl><dd>Unbound has supplanted the Berkeley Internet Name Domain (<a href="../en/BIND.html" title="BIND">BIND</a>) as the default, base-system name server in several open source projects, where it is perceived as smaller, more modern, and more secure for most applications.</dd></dl>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Installation">Installation</h2></div>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=unbound">unbound</a></span> package.
</p>
<p>Additionally, the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=expat">expat</a></span> package is required for <a href="#DNSSEC_validation">#DNSSEC validation</a>.
</p>
<div class="mw-heading mw-heading2"><h2 id="Configuration">Configuration</h2></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Add instructions for configuring persistent cache with <a href="../en/Valkey.html" class="mw-redirect" title="Redis">Redis</a>. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Unbound.html">Talk:Unbound</a>)</div>
</div>
<p>A default configuration is already included at <code>/etc/unbound/unbound.conf</code>. The following sections highlight different settings for the configuration file. See <span class="plainlinks archwiki-template-man" title="$ man 5 unbound.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/unbound.conf.5">unbound.conf(5)</a></span> for other settings and more details.
</p>
<p>Unless otherwise specified, any options listed in this section are to be placed under the <code>server</code> section in the configuration like so:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/unbound/unbound.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server:
  ...
  <i>setting</i>: <i>value</i>
  ...
</pre>
<div class="mw-heading mw-heading3"><h3 id="Local_DNS_server">Local DNS server</h3></div>
<p>If you want to use <i>unbound</i> as your local DNS server, set your nameserver to the loopback addresses <code>::1</code> and <code>127.0.0.1</code> in <code>/etc/resolv.conf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/resolv.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">nameserver ::1
nameserver 127.0.0.1
options edns0 trust-ad
</pre>
<p>Make sure to protect <code>/etc/resolv.conf</code> from modification as described in <a href="../en/Domain_name_resolution.html#Overwriting_of_/etc/resolv.conf" title="Domain name resolution">Domain name resolution#Overwriting of /etc/resolv.conf</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> A simple way to do this is to install <a href="../en/Openresolv.html" title="Openresolv">openresolv</a> and configure <code>/etc/resolvconf.conf</code>:
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/resolvconf.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">name_servers="::1 127.0.0.1"
resolv_conf_options="edns0 trust-ad"</pre>
<p>Then run <code>resolvconf -u</code> to generate <code>/etc/resolv.conf</code>.
</p>
</div>
<p>See <a href="../en/Domain_name_resolution.html#Lookup_utilities" title="Domain name resolution">Domain name resolution#Lookup utilities</a> on how to test your settings.
</p>
<p>Check specifically that the server being used is <code>::1</code> or <code>127.0.0.1</code> after making permanent changes to <a href="../en/Domain_name_resolution.html" class="mw-redirect" title="Resolv.conf">resolv.conf</a>.
</p>
<p>You can now setup <i>unbound</i> such that it is <a href="#Forwarding_queries">#Forwarding queries</a>, perhaps all queries, to the DNS servers of your choice.
</p>
<div class="mw-heading mw-heading3"><h3 id="Root_hints">Root hints</h3></div>
<p>For recursively querying a host that is not cached as an address, the resolver needs to start at the top of the server tree and query the root servers, to know where to go for the top level domain for the address being queried. Unbound comes with default builtin hints. Therefore, if the package is updated regularly, no manual intervention is required. Otherwise, it is good practice to use a root-hints file since the builtin hints may become outdated.
</p>
<p>First point <i>unbound</i> to the <code>root.hints</code> file:
</p>
<pre>root-hints: root.hints
</pre>
<p>Then, put a <i>root hints</i> file into the <i>unbound</i> configuration directory. The simplest way to do this is to run the command:
</p>
<pre># curl --output /etc/unbound/root.hints https://www.internic.net/domain/named.cache</pre>
<p>When actually using this file, and not the builtin hints, it is a good idea to update <code>root.hints</code> every six months or so in order to make sure the list of root servers is up to date. This can be done manually or by using a <a href="../en/Systemd_timer.html" class="mw-redirect" title="Systemd timer">systemd timer</a>. See <a href="#Roothints_systemd_timer">#Roothints systemd timer</a> for an example.
</p>
<div class="mw-heading mw-heading3"><h3 id="DNSSEC_validation">DNSSEC validation</h3></div>
<p>To use <a href="../en/DNSSEC.html" title="DNSSEC">DNSSEC</a> validation, the following setting for the server trust anchor should be under <code>server:</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/unbound/unbound.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">	trust-anchor-file: "/etc/unbound/trusted-key.key"
</pre>
<p>This setting is already enabled in the default configuration file.
</p>
<p><code>/etc/unbound/trusted-key.key</code> is copied from <code>/etc/trusted-key.key</code>, which is provided by the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dnssec-anchors">dnssec-anchors</a></span> dependency, whose <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILD</a> generates the file with <span class="plainlinks archwiki-template-man" title="$ man 8 unbound-anchor"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/unbound-anchor.8">unbound-anchor(8)</a></span>.
</p>
<p>DNSSEC validation will only be done if the DNS server being queried supports it. If general <a href="#Forwarding_queries">#Forwarding queries</a> have been set to DNS servers that do not support DNSSEC, their answers, whatever they are, should be considered insecure since no DNSSEC validation could be performed.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Including DNSSEC checking significantly increases DNS lookup times for initial lookups before the address is cached.</div>
<div class="mw-heading mw-heading4"><h4 id="Testing_validation">Testing validation</h4></div>
<p>To test if DNSSEC is working, after <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Starting">starting</a> <code>unbound.service</code>, do:
</p>
<pre>$ unbound-host -vDr test.dnscheck.tools
</pre>
<p>The response should be the IP address with the word <code>(secure)</code> next to it.
</p>
<pre>$ unbound-host -vDr badsig.test.dnscheck.tools
</pre>
<p>Here the response should include <code>(BOGUS (security failure))</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> If you use a separate DNS forwarder that does not do DNSSEC, remove <code>-r</code> from the options to get the correct response. Otherwise all <code>rcodes</code> respond as <code>SERVFAIL</code>.</div>
<p>Additionally you can use <i>drill</i> to test the resolver as follows:
</p>
<pre>$ drill badsig.test.dnscheck.tools
$ drill test.dnscheck.tools
</pre>
<p>The first command should give an <code>rcode</code> of <code>SERVFAIL</code>. The second should give an <code>rcode</code> of <code>NOERROR</code>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Forwarding_queries">Forwarding queries</h3></div>
<p>If you only want to forward queries to an external DNS server, skip ahead to <a href="#Forward_all_remaining_requests">#Forward all remaining requests</a>.
</p>
<div class="mw-heading mw-heading4"><h4 id="Allow_local_network_to_use_DNS">Allow local network to use DNS</h4></div>
<div class="mw-heading mw-heading5"><h5 id="Using_openresolv">Using openresolv</h5></div>
<p>If your network manager supports <a href="../en/Openresolv.html" title="Openresolv">openresolv</a>, you can <a rel="nofollow" class="external text" href="https://roy.marples.name/projects/openresolv/configuration/">configure it</a> to provide local DNS servers and search domains to Unbound:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/resolvconf.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
private_interfaces="*"

# Write out unbound configuration file
unbound_conf=/etc/unbound/resolvconf.conf</pre>
<p>Run <code>resolvconf -u</code> to generate the file.
</p>
<p>Configure Unbound to read the openresolv's generated file and allow replies with <a href="https://en.wikipedia.org/wiki/Private_network" class="extiw" title="wikipedia:Private network">private IP address ranges</a><a rel="nofollow" class="external autonumber" href="https://roy.marples.name/projects/openresolv/configuration/resolvers/unbound/">[1]</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/unbound/unbound.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">include: "/etc/unbound/resolvconf.conf"
...
server:
...
	private-domain: "intranet"
	private-domain: "internal"
	private-domain: "private"
	private-domain: "corp"
	private-domain: "home"
	private-domain: "lan"

	unblock-lan-zones: yes
	insecure-lan-zones: yes
...
</pre>
<p>Additionally you may want to disable DNSSEC validation for private DNS namespaces (see <a href="https://tools.ietf.org/html/rfc6762#appendix-G" class="extiw" title="rfc:6762">RFC 6762 Appendix G</a>):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/unbound/unbound.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
server:
...
	domain-insecure: "intranet"
	domain-insecure: "internal"
	domain-insecure: "private"
	domain-insecure: "corp"
	domain-insecure: "home"
	domain-insecure: "lan"
...
</pre>
<div class="mw-heading mw-heading5"><h5 id="Exclude_local_subnets_from_answers">Exclude local subnets from answers</h5></div>
<p>Will be useful to exclude local networks from DNS answers because it would protect against <a href="https://en.wikipedia.org/wiki/DNS_rebinding" class="extiw" title="wikipedia:DNS rebinding">DNS rebinding</a> attacks. By default this feature is not active but you can add any subnet you want in configuration file:
</p>
<pre>private-address: <i>local_subnet/subnet_mask</i>
</pre>
<p>You can add all <a href="https://en.wikipedia.org/wiki/Private_network" class="extiw" title="wikipedia:Private network">private and link-local</a> subnets by this strings:
</p>
<pre>private-address:  10.0.0.0/8
private-address:  172.16.0.0/12
private-address:  192.168.0.0/16
private-address:  169.254.0.0/16
private-address:  fd00::/8
private-address:  fe80::/10
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Blocking subnet 127.0.0.0/8 would affect some application as spam or advertising blocklists. Adding ::ffff:0:0/96 stops IPv4-mapped IPv6 addresses from bypassing the filter.</div>
<p>Note that <i>Unbound</i> may have adresses from excluded subnets in answers if they belong to domains from <code>private-domain</code> or specifed by <code>local-data</code>, so you need to define <code>private-domain</code> how described at <a href="#Using_openresolv">#Using openresolv</a> to able query local domains adresses.
</p>
<div class="mw-heading mw-heading5"><h5 id="Include_local_DNS_server">Include local DNS server</h5></div>
<p>To include a local DNS server for both forward and reverse local addresses a set of lines similar to these below is necessary with a forward and reverse lookup (choose the IP address of the server providing DNS for the local network accordingly by changing 10.0.0.1 in the lines below):
</p>
<pre>local-zone: "10.in-addr.arpa." transparent
</pre>
<p>This line above is important to get the reverse lookup to work correctly.
</p>
<pre>forward-zone:
name: "mynetwork.com."
forward-addr: 10.0.0.1
</pre>
<pre>forward-zone:
name: "10.in-addr.arpa."
forward-addr: 10.0.0.1
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> There is a difference between forward zones and stub zones - stub zones will only work when connected to an authoritative DNS server directly. This would work for lookups from a <a href="../en/BIND.html" title="BIND">BIND</a> DNS server if it is providing authoritative DNS - but if you are referring queries to an <i>unbound</i> server in which internal lookups are forwarded on to another DNS server, then defining the referral as a stub zone in the machine here will not work. In that case it is necessary to define a forward zone as above, since forward zones can have daisy chain lookups onward to other DNS servers. i.e. forward zones can refer queries to recursive DNS servers. This distinction is important as you do not get any error messages indicating what the problem is if you use a stub zone inappropriately.</div>
<p>You can set up the localhost forward and reverse lookups with the following lines:
</p>
<pre>local-zone: "localhost." static
local-data: "localhost. 10800 IN NS localhost."
local-data: "localhost. 10800 IN SOA localhost. nobody.invalid. 1 3600 1200 604800 10800"
local-data: "localhost. 10800 IN A 127.0.0.1"
local-zone: "127.in-addr.arpa." static
local-data: "127.in-addr.arpa. 10800 IN NS localhost."
local-data: "127.in-addr.arpa. 10800 IN SOA localhost. nobody.invalid. 2 3600 1200 604800 10800"
local-data: "1.0.0.127.in-addr.arpa. 10800 IN PTR localhost."
</pre>
<div class="mw-heading mw-heading4"><h4 id="Forward_all_remaining_requests">Forward all remaining requests</h4></div>
<div class="mw-heading mw-heading5"><h5 id="Using_openresolv_2">Using openresolv</h5></div>
<p>If your network manager supports <a href="../en/Openresolv.html" title="Openresolv">openresolv</a>, you can <a rel="nofollow" class="external text" href="https://roy.marples.name/projects/openresolv/configuration/">configure it</a> to provide upstream DNS servers to Unbound.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/resolvconf.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
# Write out unbound configuration file
unbound_conf=/etc/unbound/resolvconf.conf</pre>
<p>Run <code>resolvconf -u</code> to generate the file.
</p>
<p>Finally configure Unbound to read the openresolv's generated file<a rel="nofollow" class="external autonumber" href="https://roy.marples.name/projects/openresolv/configuration/resolvers/unbound/">[2]</a>:
</p>
<pre>include: "/etc/unbound/resolvconf.conf"
</pre>
<div class="mw-heading mw-heading5"><h5 id="Manually_specifying_DNS_servers">Manually specifying DNS servers</h5></div>
<p>To use specific servers for default forward zones that are outside of the local machine and outside of the local network add a forward zone with the name <code>.</code> to the configuration file. In this example, all requests are forwarded to Google's DNS servers:
</p>
<pre>forward-zone:
  name: "."
  forward-addr: 8.8.8.8
  forward-addr: 8.8.4.4
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> 
<ul>
<li>This example uses Google Public DNS. Replace it with a DNS resolver you trust. See <a href="../en/Domain_name_resolution.html#Third-party_DNS_services" title="Domain name resolution">Domain name resolution#Third-party DNS services</a>.</li>
<li>It is highly advised to use an <a href="../en/Domain_name_resolution.html#Privacy_and_security" title="Domain name resolution">encrypted protocol</a> when connecting to third-party DNS services. See <a href="#Forwarding_using_DNS_over_TLS">#Forwarding using DNS over TLS</a>.</li>
</ul>
</div>
<div class="mw-heading mw-heading4"><h4 id="Forwarding_using_DNS_over_TLS">Forwarding using DNS over TLS</h4></div>
<p>To use <a href="../en/DNS_over_TLS.html" class="mw-redirect" title="DNS over TLS">DNS over TLS</a>, you will need to enable the <code>tls-system-cert</code> option, allow unbound to forward TLS requests and also specify any number of servers that allow DNS over TLS.
</p>
<p>For each server you will need to specify the connection port using <code>@</code> and its domain name with <code>#</code>. The domain name is required for TLS authentication and also allows setting stub-zones and using the <code>unbound-control forward control</code> command with domain names. There should not be any spaces in the <code>forward-addr</code> specification.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/unbound/unbound.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
server:
...
	tls-system-cert: yes
...
forward-zone:
        name: "."
        forward-tls-upstream: yes
        forward-addr: 1.1.1.1@853#cloudflare-dns.com
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> This example uses Cloudflare's public DNS resolver. Replace it with a DNS resolver you trust. See <a href="../en/Domain_name_resolution.html#Third-party_DNS_services" title="Domain name resolution">Domain name resolution#Third-party DNS services</a>.</div>
<div class="mw-heading mw-heading3"><h3 id="Access_control">Access control</h3></div>
<p>You can specify the interfaces to answer queries from by IP address. The default, is to listen on <i>localhost</i>.
</p>
<p>To listen on all interfaces, use the following:
</p>
<pre>interface: 0.0.0.0
interface: ::0
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> Unless you specifically want to run an open DNS resolver, do not configure the resolver to listen on public (internet-facing) IP addresses or all IP addresses (<code>0.0.0.0</code> and <code>::</code>).</div>
<p>To control which systems can access the server by IP address, use the <code>access-control</code> option:
</p>
<pre>access-control: <i>subnet</i> <i>action</i>
</pre>
<p>For example:
</p>
<pre>access-control: 192.168.1.0/24 allow
</pre>
<p><i>action</i> can be one of <code>deny</code> (drop message), <code>refuse</code> (polite error reply), <code>allow</code> (recursive ok), or <code>allow_snoop</code> (recursive and nonrecursive ok). By default everything is refused except for localhost.
</p>
<div class="mw-heading mw-heading2"><h2 id="Usage">Usage</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Starting_Unbound">Starting Unbound</h3></div>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">Start/enable</a> the <code>unbound.service</code> systemd service.
</p>
<div class="mw-heading mw-heading3"><h3 id="Remotely_control_Unbound">Remotely control Unbound</h3></div>
<p><i>unbound</i> ships with the <code>unbound-control</code> utility which enables us to remotely administer the unbound server. It is similar to the <a href="../en/Pdnsd.html#pdnsd-ctl" title="Pdnsd">pdnsd-ctl</a> command of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pdnsd">pdnsd</a></span>.
</p>
<div class="mw-heading mw-heading4"><h4 id="Setting_up_unbound-control">Setting up unbound-control</h4></div>
<p>Before you can start using it, the following steps need to be performed:
</p>
<p>1) Firstly, you need to run the following command
</p>
<pre># unbound-control-setup
</pre>
<p>which will generate a self-signed certificate and private key for the server, as well as the client. These files will be created in the <code>/etc/unbound</code> directory.
</p>
<p>2) After that, edit <code>/etc/unbound/unbound.conf</code> and put the following contents in that. The <code>control-enable: yes</code> option is necessary, the rest can be adjusted as required.
</p>
<pre>remote-control:
    # Enable remote control with unbound-control(8) here.
    # set up the keys and certificates with unbound-control-setup.
    control-enable: yes
   
    # what interfaces are listened to for remote control.
    # give 0.0.0.0 and ::0 to listen to all interfaces.
    control-interface: 127.0.0.1
   
    # port number for remote control operations.
    control-port: 8953
   
    # unbound server key file.
    server-key-file: "/etc/unbound/unbound_server.key"
   
    # unbound server certificate file.
    server-cert-file: "/etc/unbound/unbound_server.pem"
   
    # unbound-control key file.
    control-key-file: "/etc/unbound/unbound_control.key"
   
    # unbound-control certificate file.
    control-cert-file: "/etc/unbound/unbound_control.pem"
</pre>
<div class="mw-heading mw-heading4"><h4 id="Using_unbound-control">Using unbound-control</h4></div>
<p>Some of the commands that can be used with <i>unbound-control</i> are:
</p>
<ul>
<li>print statistics without resetting them: <pre># unbound-control stats_noreset</pre>
</li>
<li>dump cache to stdout: <pre># unbound-control dump_cache</pre>
</li>
<li>flush cache and reload configuration: <pre># unbound-control reload</pre>
</li>
</ul>
<p>Please refer to <span class="plainlinks archwiki-template-man" title="$ man 8 unbound-control"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/unbound-control.8">unbound-control(8)</a></span> for a detailed look at the operations it supports.
</p>
<div class="mw-heading mw-heading2"><h2 id="Tips_and_tricks">Tips and tricks</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Domain_blacklisting">Domain blacklisting</h3></div>
<p>To blacklist a domain, use <code>local-zone: "<i>domainname</i>" always_refuse</code>.
</p>
<p>Save the blacklist as a separate file (e.g. <code>/etc/unbound/blacklist.conf</code>) for ease of management and include it from <code>/etc/unbound/unbound.conf</code>. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/unbound/blacklist.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">local-zone: "blacklisted.example" always_refuse
local-zone: "anotherblacklisted.example" always_refuse
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/unbound/unbound.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">server:
...
  include: /etc/unbound/blacklist.conf
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> 
<ul>
<li>In order to return some OK statuses on those hosts, you can change the 127.0.0.1 redirection to a server you control and have that server respond with empty 204 replies, see <a rel="nofollow" class="external text" href="https://www.shadowandy.net/2014/04/adblocking-nginx-serving-1-pixel-gif-204-content.htm">this page</a>
</li>
<li>To convert a hosts file from another source to the unbound format do: <pre>$ grep '^0\.0\.0\.0' <i>hostsfile</i> | awk '{print "local-zone: \""$2"\" always_refuse"}' &gt; /etc/unbound/blacklist.conf</pre>
</li>
<li>A list of potential sources for the blacklist can be found in <a rel="nofollow" class="external text" href="https://github.com/openwrt/packages/blob/master/net/adblock/files/README.md">OpenWrt's adblock package's README</a>.</li>
</ul>
</div>
<div class="mw-heading mw-heading3"><h3 id="Adding_an_authoritative_DNS_server">Adding an authoritative DNS server</h3></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Running two DNS servers is not inherently more secure than running one providing all features. (Discuss in <a href="../en/Talk:Unbound.html#Two_DNS_servers_are_not_inherently_more_secure_than_one" title="Talk:Unbound">Talk:Unbound#Two DNS servers are not inherently more secure than one</a>)</div>
</div>
<p>For users who wish to run both a validating, recursive, caching DNS server as well as an authoritative DNS server on a single machine then it may be useful to refer to the wiki page <a href="../en/NSD.html" title="NSD">NSD</a> which gives an example of a configuration for such a system.  Having one server for authoritative DNS queries and a separate DNS server for the validating, recursive, caching DNS functions gives increased security over a single DNS server providing all of these functions. Many users have used Bind as a single DNS server, and some help on migration from Bind to the combination of running NSD and Bind is provided in the <a href="../en/NSD.html" title="NSD">NSD</a> wiki page.
</p>
<div class="mw-heading mw-heading3"><h3 id="WAN_facing_DNS">WAN facing DNS</h3></div>
<p>It is also possible to change the configuration files and interfaces on which the server is listening so that DNS queries from machines outside of the local network can access specific machines within the LAN. This is useful for web and mail servers which are accessible from anywhere, and the same techniques can be employed as has been achieved using bind for many years, in combination with suitable port forwarding on firewall machines to forward incoming requests to the right machine.
</p>
<div class="mw-heading mw-heading3"><h3 id="Roothints_systemd_timer">Roothints systemd timer</h3></div>
<p>Here is an example systemd service and timer that update <code>root.hints</code> monthly using the method in <a href="#Root_hints">#Root hints</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/roothints.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Update root hints for unbound
After=network.target

[Service]
ExecStart=/usr/bin/curl -o /etc/unbound/root.hints https://www.internic.net/domain/named.cache</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/roothints.timer</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Run root.hints monthly

[Timer]
OnCalendar=monthly
Persistent=true

[Install]
WantedBy=timers.target</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">Start/enable</a> the <code>roothints.timer</code> systemd timer.
</p>
<div class="mw-heading mw-heading3"><h3 id="Keeping_DNS_cache_always_up_to_date">Keeping DNS cache always up to date</h3></div>
<p>unbound supports prefetching where cached DNS entries are automatically updated before they expire to keep the cache always up to date. To quote the <span class="plainlinks archwiki-template-man" title="$ man 5 unbound.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/unbound.conf.5">unbound.conf(5)</a></span> man page, turning it on gives about 10 percent more traffic and load on the machine, but popular items do not expire from the cache. This is particularly useful on mobile links with high RTT.
</p>
<p>To enable prefetching, add this under the <code>server</code> section:
</p>
<pre>prefetch: yes
</pre>
<div class="mw-heading mw-heading3"><h3 id="Serving_expired_records">Serving expired records</h3></div>
<p>In March 2020, <a href="https://tools.ietf.org/html/rfc8767" class="extiw" title="rfc:8767">RFC 8767</a> was published that specifies when and how a resolver can serve stale data from its cache. If the data is unable to be authoritatively refreshed when the TTL expires, the record MAY be used as though it is unexpired. Since version 1.6.0, Unbound has the ability to answer with expired records.
</p>
<p>To enable serving expired records, add this under the <code>server</code> section:
</p>
<pre>serve-expired: yes
serve-expired-ttl: 172800  # between 86400 (1 day) and 259200 (3 days)
serve-expired-client-timeout: 1800  # RFC 8767 recommended value
</pre>
<div class="mw-heading mw-heading2"><h2 id="Troubleshooting">Troubleshooting</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Issues_concerning_num-threads">Issues concerning num-threads</h3></div>
<p><span class="plainlinks archwiki-template-man" title="$ man 5 unbound.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/unbound.conf.5#outgoing~2">unbound.conf(5) § outgoing~2</a></span> mentions:
</p>
<pre>     outgoing-range: &lt;number&gt;
             Number of ports to open. This number of file  descriptors  can  be  opened  per thread.
</pre>
<p>and some sources suggest that the <code>num-threads</code> parameter should be set to the number of cpu cores. The sample <code>unbound.conf.example</code> file merely has:
</p>
<pre>       # number of threads to create. 1 disables threading.
       # num-threads: 1
</pre>
<p>However it is not possible to arbitrarily increase <code>num-threads</code> above <code>1</code> without causing <i>unbound</i> to start with warnings in the logs about exceeding the number of file descriptors. In reality for most users running on small networks or on a single machine it should be unnecessary to seek performance enhancement by increasing <code>num-threads</code> above <code>1</code>. If you do wish to do so then refer to <a rel="nofollow" class="external text" href="https://nlnetlabs.nl/documentation/unbound/howto-optimise/">official documentation</a> and the following rule of thumb should work:
</p>
<dl><dd>Set <code>num-threads</code> equal to the number of CPU cores on the system. E.g. for 4 CPUs with 2 cores each, use 8.</dd></dl>
<p>Set the <code>outgoing-range</code> to as large a value as possible, see the sections in the referred web page above on how to overcome the limit of <code>1024</code> in total. This services more clients at a time. With 1 core, try <code>950</code>. With 2 cores, try <code>450</code>. With 4 cores try <code>200</code>. The <code>num-queries-per-thread</code> is best set at half the number of the <code>outgoing-range</code>.
</p>
<p>Because of the limit on <code>outgoing-range</code> thus also limits <code>num-queries-per-thread</code>, it is better to compile with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libevent">libevent</a></span>, so that there is no <code>1024</code> limit on <code>outgoing-range</code>. If you need to compile this way for a heavy duty DNS server then you will need to compile the programme from source instead of using the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=unbound">unbound</a></span> package.
</p>
<div class="mw-heading mw-heading3"><h3 id="First_lookup_fails_after_start">First lookup fails after start</h3></div>
<p>Without a storage backend configured, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=unbound">unbound</a></span> will start with a completely empty cache on every boot and every service (re)start. With an empty cache the first request will fire of a relatively large amount of queries to upstream/remote DNS servers. That number of requests will quickly hit an <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=unbound">unbound</a></span> quotum. The default <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=unbound">unbound</a></span> 1.22.0 configuration limits the number of upstream queries to 128. Even <a rel="nofollow" class="external text" href="https://github.com/NLnetLabs/unbound/commit/fd1a1d5fa0f012e8eeaa0ecc89da52d9ca25c216">a future release with a default of 200</a> will not solve this issue completely.
</p>
<p>The result is that your first DNS lookup will fail, and the second lookup succeeds. With error logging enabled, you will see a message like:
</p>
<pre>error: SERVFAIL &lt;1.1.1.1.in-addr.arpa. PTR IN&gt;: all servers for this domain failed, at zone 1.1.1.in-addr.arpa. no server to query no addresses for nameservers}}
</pre>
<p>In debug mode the log will show something like:
</p>
<pre>debug: request 1.1.1.1.in-addr.arpa. has exceeded the maximum global quota on number of upstream queries 131}}
</pre>
<p>Change your unbound.conf and restart <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=unbound">unbound</a></span>, to increase the default quotum to <a rel="nofollow" class="external text" href="https://www.mail-archive.com/unbound-users@lists.nlnetlabs.nl/msg01850.html">a more relaxed value according to other users experiencing this issue</a>, for example:
</p>
<pre>max-global-quota: 300
</pre>
<div class="mw-heading mw-heading3"><h3 id="Timeout_on_(recursive)_lookup">
<span id="Timeout_on_.28recursive.29_lookup"></span>Timeout on (recursive) lookup</h3></div>
<p>Even with a 1 Gbit/s FTTH connection, the default <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=unbound">unbound</a></span> configuration might lead to timeouts on recursive lookups. In debug mode, log will show:
</p>
<pre>debug: drop reply, it is older than discard-timeout
</pre>
<p>In case you want to wait a little longer for an answer then 1.9 seconds, the default time-out, change your <code>unbound.conf</code>:
</p>
<pre>discard-timeout: 3800  # in milliseconds
</pre>
<div class="mw-heading mw-heading2"><h2 id="See_also">See also</h2></div>
<ul><li><a rel="nofollow" class="external text" href="https://github.com/jodrell/unbound-block-hosts/">Block hosts that contain advertisements</a></li></ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Domain_Name_System.html" title="Category:Domain Name System">Domain Name System</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Unbound&amp;oldid=855195">https://wiki.archlinux.org/index.php?title=Unbound&amp;oldid=855195</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 5 December 2025, at 04:33.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container no-font-mode-scale">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue  vector-search-box-show-thumbnail vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search cdx-typeahead-search--show-thumbnail">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input mw-searchInput" autocomplete="off" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true"><span class="mw-page-title-main">Unbound</span></div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only reading-lists-bookmark" id="ca-bookmark-sticky-header" tabindex="-1" data-event-name="watch-sticky-bookmark"><span class="vector-icon mw-ui-icon-wikimedia-bookmarkOutline mw-ui-icon-wikimedia-wikimedia-bookmarkOutline"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
