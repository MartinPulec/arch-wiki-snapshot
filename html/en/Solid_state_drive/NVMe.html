<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Solid state drive/NVMe - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Solid_state_drive_NVMe rootpage-Solid_state_drive skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Management" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Management">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Management</div>
		</a>
		
			<button aria-controls="toc-Management-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Management subsection</span>
			</button>
		
		<ul id="toc-Management-sublist" class="vector-toc-list">
			<li id="toc-SMART" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#SMART">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>SMART</div>
			</a>
			
			<ul id="toc-SMART-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Secure_erase" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Secure_erase">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Secure erase</div>
			</a>
			
			<ul id="toc-Secure_erase-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Firmware_update" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Firmware_update">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Firmware update</div>
			</a>
			
			<ul id="toc-Firmware_update-sublist" class="vector-toc-list">
				<li id="toc-Generic" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Generic">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.1</span>Generic</div>
			</a>
			
			<ul id="toc-Generic-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Intel/Solidigm" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Intel/Solidigm">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.2</span>Intel/Solidigm</div>
			</a>
			
			<ul id="toc-Intel/Solidigm-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Kingston" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Kingston">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.3</span>Kingston</div>
			</a>
			
			<ul id="toc-Kingston-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Samsung" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Samsung">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.4</span>Samsung</div>
			</a>
			
			<ul id="toc-Samsung-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Western_Digital" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Western_Digital">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3.5</span>Western Digital</div>
			</a>
			
			<ul id="toc-Western_Digital-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Performance" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Performance">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Performance</div>
		</a>
		
			<button aria-controls="toc-Performance-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Performance subsection</span>
			</button>
		
		<ul id="toc-Performance-sublist" class="vector-toc-list">
			<li id="toc-Sector_size" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Sector_size">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Sector size</div>
			</a>
			
			<ul id="toc-Sector_size-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Airflow" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Airflow">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Airflow</div>
			</a>
			
			<ul id="toc-Airflow-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Testing" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Testing">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Testing</div>
			</a>
			
			<ul id="toc-Testing-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Power_Saving_(APST)" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Power_Saving_(APST)">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Power Saving (APST)</div>
		</a>
		
		<ul id="toc-Power_Saving_(APST)-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Controller_failure_due_to_broken_APST_support" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Controller_failure_due_to_broken_APST_support">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Controller failure due to broken APST support</div>
			</a>
			
			<ul id="toc-Controller_failure_due_to_broken_APST_support-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Controller_failure_due_to_broken_suspend_support" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Controller_failure_due_to_broken_suspend_support">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Controller failure due to broken suspend support</div>
			</a>
			
			<ul id="toc-Controller_failure_due_to_broken_suspend_support-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Solid state drive/NVMe</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/%E3%82%BD%E3%83%AA%E3%83%83%E3%83%89%E3%82%B9%E3%83%86%E3%83%BC%E3%83%88%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96/NVMe" title="ソリッドステートドライブ/NVMe – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <a href="../../en/Solid_state_drive.html" title="Solid state drive">Solid state drive</a>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../../en/Solid_state_drive.html" class="mw-redirect" title="Solid State Drive">Solid State Drive</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/NVM_Express" class="extiw" title="wikipedia:NVM Express">NVM Express</a> (NVMe) is a specification for accessing <a href="../../en/Solid_state_drive.html" class="mw-redirect" title="SSD">SSDs</a> attached through the PCI Express bus. As a logical device interface, NVM Express has been designed from the ground up, capitalizing on the low latency and parallelism of PCI Express SSDs, and mirroring the parallelism of contemporary CPUs, platforms and applications.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>NVMe devices should show up as <code>/dev/nvme*</code>. See <a href="../../en/Device_file.html#NVMe" title="Device file">Device file#NVMe</a> for an explanation on their naming.
</p>
<p>Extra userspace NVMe tools can be found in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvme-cli">nvme-cli</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nvme-cli-git/">nvme-cli-git</a></span><sup><small>AUR</small></sup>.
</p>
<p>See <a href="../../en/Solid_state_drive.html" class="mw-redirect" title="Solid State Drives">Solid State Drives</a> for supported filesystems, maximizing performance, minimizing disk reads/writes, etc.
</p>
<h2><span class="mw-headline" id="Management">Management</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This section was adapted from <a rel="nofollow" class="external autonumber" href="https://nvmexpress.org/open-source-nvme-management-utility-nvme-command-line-interface-nvme-cli/">[1]</a>.</div>
<p>List all the NVMe SSDs attached with name, serial number, size, LBA format and serial:
</p>
<pre># nvme list
</pre>
<p>List information about a drive and features it supports in a human-friendly way:
</p>
<pre># nvme id-ctrl -H /dev/nvme0
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> In order to make sense of the abbreviations used, see reference section "Identify Controller data structure" in the relevant <a rel="nofollow" class="external text" href="https://nvmexpress.org/developers/nvme-specification/">NVMe specification</a>, (e.g. bottom of page 172 for the 1.4a specification).</div>
<p>List information about a namespace and features it supports:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Namespaces are the construct in NVMe technology that hold user data. An NVMe controller can have multiple namespaces attached to it. Most NVMe SSDs today just use a single namespace, but multi-tenant applications, virtualization and security have use cases for multiple namespaces.</div>
<pre># nvme id-ns /dev/nvme0n1
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> In order to make sense of the abbreviations used, see reference section "Identify Namespace data structure" in the relevant <a rel="nofollow" class="external text" href="https://nvmexpress.org/developers/nvme-specification/">NVMe specification</a> (e.g. page 163 for the 1.4a specification).</div>
<p>Output the NVMe error log page:
</p>
<pre># nvme error-log /dev/nvme0
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Look for output where error count does not equal 0 to find out if there are any errors in the error log.</div>
<p>Delete a namespace:
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> This command will delete all data on the specified namespace. Use with caution!</div>
<pre># nvme delete-ns /dev/nvme0n1
</pre>
<p>Create a new namespace, e.g creating a smaller size namespace to overprovision an SSD for improved endurance, performance, and latency:
</p>
<pre># nvme create-ns /dev/nvme0
</pre>
<p>See <code>nvme help</code> and <span class="plainlinks archwiki-template-man" title="$ man 1 nvme"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nvme.1">nvme(1)</a></span> for a list of all commands along with a terse description.
</p>
<h3><span class="mw-headline" id="SMART">SMART</span></h3>
<p>Output the NVMe SMART log page for health status, temp, endurance, and more:
</p>
<pre># nvme smart-log /dev/nvme0
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Use the <code>-H</code> option to output even more information, e.g. <code>nvme smart-log -H /dev/nvme0</code>.</div>
<p>NVMe support was added to <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=smartmontools">smartmontools</a></span> <a rel="nofollow" class="external text" href="https://www.smartmontools.org/wiki/NVMe_Support#SmartmontoolsNVMesupport1">in version 6.5</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <a rel="nofollow" class="external text" href="https://www.smartmontools.org/wiki/NVMe_Support#SmartmontoolsNVMesupport1">smartmontools official wiki</a> reports this support as experimental.</div>
<p>Currently implemented features (as taken from the wiki):
</p>
<ul>
<li>Basic information about controller name, firmware, capacity (<code>smartctl -i</code>)</li>
<li>Controller and namespace capabilities (<code>smartctl -c</code>)</li>
<li>SMART overall-health self-assessment test result and warnings (<code>smartctl -H</code>)</li>
<li>NVMe SMART attributes (<code>smartctl -A</code>)</li>
<li>NVMe error log (<code>smartctl -l error[,NUM]</code>)</li>
<li>Ability to fetch any nvme log (<code>smartctl -l nvmelog,N,SIZE</code>)</li>
<li>The smartd daemon tracks health (<code>-H</code>), error count (<code>-l error</code>) and temperature (<code>-W DIFF,INFO,CRIT</code>)</li>
</ul>
<p>See <a href="../../en/S.M.A.R.T..html" title="S.M.A.R.T.">S.M.A.R.T.</a> and the <a rel="nofollow" class="external text" href="https://www.smartmontools.org/wiki/NVMe_Support">official wiki entry</a> for more information, and see <a rel="nofollow" class="external text" href="https://www.percona.com/blog/2017/02/09/using-nvme-command-line-tools-to-check-nvme-flash-health/">this article</a> for contextual information about the output.
</p>
<h3><span class="mw-headline" id="Secure_erase">Secure erase</span></h3>
<p>See <a href="../../en/Solid_state_drive/Memory_cell_clearing.html#NVMe_drive" title="Solid state drive/Memory cell clearing">Solid state drive/Memory cell clearing#NVMe drive</a>.
</p>
<h3><span class="mw-headline" id="Firmware_update">Firmware update</span></h3>
<h4><span class="mw-headline" id="Generic">Generic</span></h4>
<p>Firmware can be managed using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvme-cli">nvme-cli</a></span>. To display available slots and check whether Slot 1 is read-only: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme fw-log /dev/nvme0</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Firmware Log for device:nvme0
afi  : 0x11
frs1 : 0x32303132345a3553 (S5Z42102)
frs2 : 0x32303132345a3553 (S5Z42102)
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme id-ctrl /dev/nvme0 -H | grep Firmware</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">  [9:9] : 0x1	Firmware Activation Notices Supported
  [4:4] : 0x1	Firmware Activate Without Reset Supported
  [3:1] : 0x2	Number of Firmware Slots
  [0:0] : 0	Firmware Slot 1 Read/Write
</pre>
<p>Download and commit firmware to specified slot. In the example below, firmware is first committed without activation (<code>-a 0</code>). Next, an existing image is activated (<code>-a 2</code>). Refer to the <a rel="nofollow" class="external text" href="https://nvmexpress.org/wp-content/uploads/NVM-Express-1_4b-2020.09.21-Ratified.pdf">NVMe specification</a> for details on firmware commit <i>action</i> values.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme fw-download -f S5Z42_fw_S5Z42105.bin /dev/nvme0</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Firmware download success
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme fw-commit -s 2 -a 0 /dev/nvme0</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Success committing firmware action:0 slot:2
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme fw-log /dev/nvme0</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Firmware Log for device:nvme0
afi  : 0x21
frs1 : 0x32303132345a3553 (S5Z42102)
frs2 : 0x35303132345a3553 (S5Z42105)
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme fw-commit -s 2 -a 2 /dev/nvme0</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Success committing firmware action:2 slot:2
</pre>
<p>Finally reset the controller to load the new firmware:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If <code>Firmware Activate Without Reset</code> is marked as supported as in the example above, this step may not be necessary.</div>
<pre># nvme reset /dev/nvme0
</pre>
<p>This can also be done manually if needed:
</p>
<pre># echo 1 &gt; /sys/class/nvme/nvme0/reset_controller
</pre>
<h4>
<span id="Intel.2FSolidigm"></span><span class="mw-headline" id="Intel/Solidigm">Intel/Solidigm</span>
</h4>
<p>After Intel SSD business was acquired by SK Hynix<a rel="nofollow" class="external autonumber" href="https://news.solidigm.com/en-WW/212943-sk-hynix-completes-the-first-phase-of-intel-nand-and-ssd-business-acquisition">[2]</a><a rel="nofollow" class="external autonumber" href="https://www.anandtech.com/show/17134/intel-sells-ssd-business-to-sk-hynix-as-new-subsidiary-solidigm">[3]</a>, its "Memory and Storage Tool" (Intel MAS) lost support for SSDs and can now only be used to manage Optane devices.<a rel="nofollow" class="external autonumber" href="https://www.intel.com/content/www/us/en/download/19520/intel-memory-and-storage-tool-cli-command-line-interface.html">[4]</a>
</p>
<p>Solidigm, the US subsidiary formed from Intel's SSD business acquisition, provides a new utility to manage former Intel SSDs: <i>"The Solidigm Storage Tool, also called SST, assists with managing Solidigm SSDs. It provides access to drive information and health, SMART Attributes, Firmware Updates, diagnostic scans, and secure erase."</i><a rel="nofollow" class="external autonumber" href="https://www.solidigm.com/content/solidigm/us/en/support-page/drivers-downloads/ka-00085.html">[5]</a>
</p>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/solidigm-sst-storage-tool-cli/">solidigm-sst-storage-tool-cli</a></span><sup><small>AUR</small></sup>, then check whether your drive has an update available:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># sst show -ssd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">- ABCD012345NS512A -

Capacity : 512.11 GB (512,110,190,592 bytes)
DevicePath : /dev/nvme0n1
DeviceStatus : Healthy
Firmware : 004C
FirmwareUpdateAvailable : 005C
Index : 0
MaximumLBA : 1000215215
ModelNumber : INTEL SSDPEKNW512G8
ProductFamily : Intel SSD 660p Series
SMARTEnabled : True
SectorDataSize : 512
SerialNumber : ABCD012345NS512A</pre>
<p>If so execute the <code>load</code> command as follows, using the index value given in the previous command:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># sst load -ssd <i>index</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">WARNING! You have selected to update the drives firmware! 
Proceed with the update? (Y|N): Y
Updating firmware...
Firmware update successful
</pre>
<p>For more information, refer to the user guide provided on the tool's aforementioned official page.
</p>
<h4><span class="mw-headline" id="Kingston">Kingston</span></h4>
<p>Kingston does not provide separate firmware downloads on their website, instead referring users to a Windows only utility. Firmware files appear to use a predictable naming scheme based on the firmware revision:
</p>
<p>https://media.kingston.com/support/downloads/<b>S5Z42105.zip</b>
</p>
<p>Then proceed with the <a href="#Generic">generic flashing instructions</a>.
</p>
<h4><span class="mw-headline" id="Samsung">Samsung</span></h4>
<p>Next to "Samsung Magician Software" for Windows users Samsung also provides SSD firmware as bootable ISO images:
</p>
<p><a rel="nofollow" class="external free" href="https://semiconductor.samsung.com/consumer-storage/support/tools/">https://semiconductor.samsung.com/consumer-storage/support/tools/</a>
</p>
<p>They can be written onto a bootable CD or USB drive, or you can unpack the image and do everything live:
</p>
<pre>$ curl -OL https://samsung.com/.../<b>xxx</b>.iso
$ bsdtar -xf <b>xxx</b>.iso initrd
$ bsdtar -xf initrd root
# ./root/fumagician/fumagician
</pre>
<p>Instead of using the manufacturer's program you might prefer to use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvme-cli">nvme-cli</a></span> and upload the firmware manually as explained in the <a href="#Generic">previous section</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ls -1 root/fumagician/*.enc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">root/fumagician/1B2QJXD7.enc
root/fumagician/DSRD.enc
</pre>
<p>The first file is the firmware.
</p>
<h4><span class="mw-headline" id="Western_Digital">Western Digital</span></h4>
<p>Western Digital only supports updating via their Windows based Dashboard software. However, the firmware can be downloaded directly if you know where to look.<a rel="nofollow" class="external autonumber" href="https://community.frame.work/t/western-digital-drive-update-guide-without-windows-wd-dashboard/20616">[6]</a>
</p>
<p>First, navigate to the <a rel="nofollow" class="external text" href="https://wddashboarddownloads.wdc.com/wdDashboard/config/devices/lista_devices.xml">list of all drives</a> and find your drive (<code>model=<i>model_number</i></code>).
</p>
<p>Under your particular drive model there will be one or more <code>&lt;url&gt;</code> entries. If there are multiple URLs then you may need to try each one using the directions below and check the <code>&lt;dependency&gt;</code> tag for your current firmware version.
</p>
<p>Now, download the drive-specific XML file:
</p>
<pre>$ curl https://wddashboarddownloads.wdc.com/<i>url_entry</i>
</pre>
<p>Inside this drive-specific XML file should be a <code>&lt;fwfile&gt;</code> tag with a <code><i>xxxx</i>.fluf</code> filename. This is the name of the file you want; you can download it by replacing <code>device_properties.xml</code> from the previous URL with this filename.
</p>
<p>A full URL example for a SN850X drive:
</p>
<pre>$ curl --remote-name https://wddashboarddownloads.wdc.com/wdDashboard/firmware/WD_BLACK_SN850X_2000GB/620331WD/620331WD.fluf
</pre>
<p>Once you have the <i>.fluf</i> file, updating can be performed using the <a href="#Generic">generic flashing instructions</a>. Be aware that this is not officially supported by Western Digital, may not work correctly, and could possibly damage your device. Be extra careful that you are updating with the correct drive and version of firmware.
</p>
<h2><span class="mw-headline" id="Performance">Performance</span></h2>
<h3><span class="mw-headline" id="Sector_size">Sector size</span></h3>
<p>See <a href="../../en/Advanced_Format.html#NVMe_solid_state_drives" title="Advanced Format">Advanced Format#NVMe solid state drives</a>.
</p>
<h3><span class="mw-headline" id="Airflow">Airflow</span></h3>
<p>NVMe SSDs are known to be affected by high operating temperatures and will throttle performance over certain thresholds.<a rel="nofollow" class="external autonumber" href="https://www.legitreviews.com/samsung-ssd-950-pro-512gb-nvme-pcie-ssd-review_174096/3">[7]</a>
</p>
<h3><span class="mw-headline" id="Testing">Testing</span></h3>
<p>Raw device performance tests can be run with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=hdparm">hdparm</a></span>:
</p>
<pre># hdparm -Tt --direct /dev/nvme0n1
</pre>
<h2>
<span id="Power_Saving_.28APST.29"></span><span class="mw-headline" id="Power_Saving_(APST)">Power Saving (APST)</span>
</h2>
<p>To check NVMe power states, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvme-cli">nvme-cli</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nvme-cli-git/">nvme-cli-git</a></span><sup><small>AUR</small></sup>, and run <code>nvme get-feature /dev/nvme[0-9] -f 0x0c -H</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme get-feature /dev/nvme0 -f 0x0c -H</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">get-feature:0xc (Autonomous Power State Transition), Current value:0x000001
        Autonomous Power State Transition Enable (APSTE): Enabled
        Auto PST Entries        .................

...
</pre>
<p>When APST is enabled the output should contain "Autonomous Power State Transition Enable (APSTE): Enabled" and there should be non-zero entries in the table below indicating the idle time before transitioning into each of the available states.
</p>
<p>If APST is enabled but no non-zero states appear in the table, the latencies might be too high for any states to be enabled by default. The output of <code>nvme id-ctrl /dev/nvme[0-9]</code> (as the root user) should show the available non-operational power states of the NVME controller. If the total latency of any state (enlat + xlat) is greater than 25000 (25ms) you must pass a value at least that high as parameter <code>default_ps_max_latency_us</code> for the <code>nvme_core</code> <a href="../../en/Kernel_module.html" title="Kernel module">kernel module</a>. This should enable APST and make the table in <code>nvme get-feature</code> (as the root user) show the entries.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Controller_failure_due_to_broken_APST_support">Controller failure due to broken APST support</span></h3>
<p>Some NVMe devices may exhibit issues related to power saving (APST). This is a known issue for Kingston A2000 <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?pid=1926994#p1926994">[8]</a> as of firmware <i>S5Z42105</i> and has previously been reported on Samsung NVMe drives (Linux v4.10) <a rel="nofollow" class="external autonumber" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1678184">[9]</a><a rel="nofollow" class="external autonumber" href="https://askubuntu.com/questions/905710/ext4-fs-error-after-ubuntu-17-04-upgrade/906105#906105">[10]</a>
</p>
<p>A failure renders the device unusable until system reset, with kernel logs similar to:
</p>
<pre> nvme nvme0: I/O 566 QID 7 timeout, aborting
 nvme nvme0: I/O 989 QID 1 timeout, aborting
 nvme nvme0: I/O 990 QID 1 timeout, aborting
 nvme nvme0: I/O 840 QID 6 timeout, reset controller
 nvme nvme0: I/O 24 QID 0 timeout, reset controller
 nvme nvme0: Device not ready; aborting reset, CSTS=0x1
 ...
 nvme nvme0: Device not ready; aborting reset, CSTS=0x1
 nvme nvme0: Device not ready; aborting reset, CSTS=0x1
 nvme nvme0: failed to set APST feature (-19)
</pre>
<p>As a workaround, add the <a href="../../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> <code>nvme_core.default_ps_max_latency_us=0</code> to completely disable APST, or set a custom threshold to disable specific states.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> This kernel parameter may no longer be necessary with recent versions of Linux Kernel. (e.g., v4.14.221, v4.19.175, v5.4.97, v5.10.15, v5.11-rc7, and later). <a rel="nofollow" class="external autonumber" href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=538e4a8c571efdf131834431e0c14808bcfb1004">[11]</a> (Discuss in <a rel="nofollow" class="external text" href="../../en/Talk:Solid_state_drive/NVMe.html">Talk:Solid state drive/NVMe</a>)</div>
</div>
<p>Since March 2021 a firmware update <a rel="nofollow" class="external text" href="https://www.kingston.com/unitedkingdom/en/support/technical/ksm-firmware-update">9</a> from Kingston is available. As Kingston only supports Windows, downloads for Linux can be found via <a rel="nofollow" class="external text" href="https://www.heise.de/downloads/18/3/0/9/6/7/4/4/A2000_-_S5Z42109.zip">heise.de</a> or <a rel="nofollow" class="external text" href="https://github.com/vulgo/kingston-a2000-firmware-bin-linux">github</a>. It is expected that, as long as the kernel workaround is in place, the firmware update will not do much as the deepest powersaving states are not reached anyway.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># smartctl -c /dev/nvme0</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Supported Power States
St Op     Max   Active     Idle   RL RT WL WT  Ent_Lat  Ex_Lat
 0 +     9.00W       -        -    0  0  0  0        0       0
 1 +     4.60W       -        -    1  1  1  1        0       0
 2 +     3.80W       -        -    2  2  2  2        0       0
 3 -   0.0450W       -        -    3  3  3  3     2000    2000
 4 -   0.0040W       -        -    4  4  4  4    15000   15000
</pre>
<p>The value passed is the maximum exit latency (<i>Ex_Lat</i>). For example, to disable PS4 set <code>nvme_core.default_ps_max_latency_us=2000</code>.
</p>
<h3><span class="mw-headline" id="Controller_failure_due_to_broken_suspend_support">Controller failure due to broken suspend support</span></h3>
<p>Some users (for example, see <a href="../../en/Laptop/HP.html" title="Laptop/HP">Laptop/HP</a>) have reported suspend failures with certain NVMe drives. As above, the failure renders the device inoperable until system reset, with kernel messages
</p>
<pre>nvme nvme0: Device not ready; aborting reset, CSTS=0x3
nvme nvme0: Removing after probe failure status: -19
</pre>
<p>As a workaround, add the <a href="../../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> <code>iommu=soft</code> to use a software replacement for the hardware IOMMU. (For further details, see <a rel="nofollow" class="external text" href="https://docs.kernel.org/arch/x86/x86_64/boot-options.html">this documentation</a>.) This has the potential to cause some slight processing overhead.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> The following solution does not explain why it works, nor provide sources. (Discuss in <a rel="nofollow" class="external text" href="../../en/Talk:Solid_state_drive/NVMe.html">Talk:Solid state drive/NVMe</a>)</div>
</div>
<p>Also you can try kernel parameter <code>amd_iommu=off</code> or better <code>amd_iommu=fullflush</code> on HP laptops with AMD CPU and KIOXIA KBG40ZN* nvme's, after you get I/O error with messages like this:
</p>
<pre>Failed to rotate /var/log/journal/*/system.journal: Read-only file system
nvme nvme0: Device not ready; aborting reset, CSTS=0x3
BTRFS error (device nvme0n1): bdev /dev/nvme0n1p* errs: wr 2, rd 0, flush 0, corrupt 0, gen 0
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://nvmexpress.org/open-source-nvme-ssd-management-utility-nvme-command-line-interface-nvme-cli/">Open Source NVMe™ Management Utility – NVMe Command Line Interface (NVMe-CLI)</a></li>
<li><a rel="nofollow" class="external text" href="https://metebalci.com/blog/a-quick-tour-of-nvm-express-nvme/">A Quick Tour of NVM Express (NVMe)</a></li>
<li><a rel="nofollow" class="external text" href="https://nvmexpress.org/wp-content/uploads/NVM-Express-1_4b-2020.09.21-Ratified.pdf">NVM Express Base Specification, Revision 1.4b</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../en/Category:Storage.html" title="Category:Storage">Storage</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Solid_state_drive/NVMe&amp;oldid=811422">https://wiki.archlinux.org/index.php?title=Solid_state_drive/NVMe&amp;oldid=811422</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 28 June 2024, at 12:03.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
