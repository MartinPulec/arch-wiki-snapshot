<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Onlyoffice Documentserver - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.43.0">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Onlyoffice_Documentserver rootpage-Onlyoffice_Documentserver skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Installation</span>
			</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Configuration</span>
			</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-local.json" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#local.json">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>local.json</span>
				</div>
			</a>
			
			<ul id="toc-local.json-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-RabbitMQ" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#RabbitMQ">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>RabbitMQ</span>
				</div>
			</a>
			
			<ul id="toc-RabbitMQ-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Database" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Database">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3</span>
					<span>Database</span>
				</div>
			</a>
			
			<ul id="toc-Database-sublist" class="vector-toc-list">
				<li id="toc-PostgreSQL" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#PostgreSQL">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3.1</span>
					<span>PostgreSQL</span>
				</div>
			</a>
			
			<ul id="toc-PostgreSQL-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-MariaDB" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#MariaDB">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3.2</span>
					<span>MariaDB</span>
				</div>
			</a>
			
			<ul id="toc-MariaDB-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Restrict_access" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Restrict_access">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.4</span>
					<span>Restrict access</span>
				</div>
			</a>
			
			<ul id="toc-Restrict_access-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Webserver" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Webserver">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.5</span>
					<span>Webserver</span>
				</div>
			</a>
			
			<ul id="toc-Webserver-sublist" class="vector-toc-list">
				<li id="toc-Nginx_/_no_SSL" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Nginx_/_no_SSL">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.5.1</span>
					<span>Nginx / no SSL</span>
				</div>
			</a>
			
			<ul id="toc-Nginx_/_no_SSL-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Nginx_/_reverse_proxy_with_SSL" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Nginx_/_reverse_proxy_with_SSL">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.5.2</span>
					<span>Nginx / reverse proxy with SSL</span>
				</div>
			</a>
			
			<ul id="toc-Nginx_/_reverse_proxy_with_SSL-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Starting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Starting">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Starting</span>
			</div>
		</a>
		
		<ul id="toc-Starting-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Nextcloud_app" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Nextcloud_app">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Nextcloud app</span>
			</div>
		</a>
		
		<ul id="toc-Nextcloud_app-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Troubleshooting</span>
			</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Onlyoffice_Docker_container_on_ZFS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Onlyoffice_Docker_container_on_ZFS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>Onlyoffice Docker container on ZFS</span>
				</div>
			</a>
			
			<ul id="toc-Onlyoffice_Docker_container_on_ZFS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Pkg:_Error_reading_from_file." class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Pkg:_Error_reading_from_file.">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2</span>
					<span>Pkg: Error reading from file.</span>
				</div>
			</a>
			
			<ul id="toc-Pkg:_Error_reading_from_file.-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-ONLYOFFICE_cannot_be_reached_after_upgrade_to_8.2.0" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ONLYOFFICE_cannot_be_reached_after_upgrade_to_8.2.0">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.3</span>
					<span>ONLYOFFICE cannot be reached after upgrade to 8.2.0</span>
				</div>
			</a>
			
			<ul id="toc-ONLYOFFICE_cannot_be_reached_after_upgrade_to_8.2.0-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Onlyoffice Documentserver</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Onlyoffice_Documentserver" title="Onlyoffice Documentserver – 日本語" lang="ja" hreflang="ja" data-title="Onlyoffice Documentserver" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><a rel="nofollow" class="external text" href="https://www.onlyoffice.com/">Onlyoffice Documentserver</a> is a full-featured backend for editing different office documents like Open Document, Word, Excel, etc. online in your browser. The software is open source and can be easily deployed and integrated into existing server software. Available frontends are <a href="../en/Nextcloud.html" title="Nextcloud">Nextcloud</a> or the Onlyoffice CommunityServer. It can be also used in own software, see <a rel="nofollow" class="external text" href="https://github.com/ONLYOFFICE/document-server-integration">following examples</a> for PHP, Nodejs, etc.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/onlyoffice-documentserver-bin/">onlyoffice-documentserver-bin</a></span><sup><small>AUR</small></sup> package. Further you will need <a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a> or <a href="../en/MariaDB.html" title="MariaDB">MariaDB</a> as a database backend and the <a href="../en/Redis.html" title="Redis">Redis</a> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=rabbitmq">rabbitmq</a></span> services installed.
</p>
<p>Alternatively, install via docker and run:
</p>
<pre>$ docker pull onlyoffice/documentserver
$ docker run -i -t -d -p PORT:80 --restart=always onlyoffice/documentserver
</pre>
<p>Where PORT can be either 80, if not already in use by another web server, or different, e.g. 9980.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<h3><span class="mw-headline" id="local.json">local.json</span></h3>
<p>You can create local.json in /etc/webapps/onlyoffice/documentserver, where are possible to overwrite any parts of config (below full local.json with rabbitmq, mariadb, redis and accesskey configuration:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/onlyoffice/documentserver/local.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
        "queue": {
                "type": "rabbitmq"
        },
        "rabbitmq": {
                "url": "amqp://onlyoffice:onlyoffice@127.0.0.1:5672/onlyoffice"
        },
        "services": {
                "CoAuthoring": {
                        "sql": {
                                "type": "mariadb",
                                "dbHost": "127.0.0.1",
                                "dbPort": 3306,
                                "dbName": "onlyoffice",
                                "dbUser": "onlyoffice",
                                "dbPass": "ONLYOFFICE_DB_PASSWD"
                        },
                        "redis": {
                                "name": "redis",
                                "host": "127.0.0.1",
                                "port": 6379,
                                "db": "10"
                        },
                        "server": {
                                "port": 8000,
                                "workerpercpu": 1,
                                "mode": "production"
                        },
                        "secret": {
                                "browser": {"string": "YOUR SECRET IN NEXTCLOUD"},
                                "inbox": {"string": "YOUR SECRET IN NEXTCLOUD"},
                                "outbox": {"string": "YOUR SECRET IN NEXTCLOUD"},
                                "session": {"string": "YOUR SECRET IN NEXTCLOUD"}
                        },
                        "token": {
                                "enable": {
                                        "browser": true,
                                        "request": {
                                                "inbox": true,
                                                "outbox": true
                                        }
                                 }
                        }
}
}
}
</pre>
<p>You should NOT edit the default.json config file.
</p>
<h3><span class="mw-headline" id="RabbitMQ">RabbitMQ</span></h3>
<p>You may create vhost in your RabbitMQ for onlyoffice and select it in local.json:
</p>
<pre>$ rabbitmqctl add_vhost onlyoffice
$ rabbitmqctl add_user onlyoffice onlyoffice
$ rabbitmqctl set_permissions -p onlyoffice onlyoffice ".*" ".*" ".*"
</pre>
<h3><span class="mw-headline" id="Database">Database</span></h3>
<h4><span class="mw-headline" id="PostgreSQL">PostgreSQL</span></h4>
<p>The PostgreSQL database backend needs to be configured. Here is an example database setup:
</p>
<pre>[postgres]$ psql -c "CREATE DATABASE onlyoffice;"
[postgres]$ psql -c "CREATE USER onlyoffice WITH password 'onlyoffice';"
[postgres]$ psql -c "GRANT ALL privileges ON DATABASE onlyoffice TO onlyoffice;"
</pre>
<p>As of PostgreSQL 15, it's required to give <b>admin</b> privileges to the <b>onlyoffice</b> user in psql so that the database schema migration command successfully executes:
</p>
<pre>[postgres]$ psql -c "ALTER DATABASE onlyoffice OWNER TO onlyoffice;"
</pre>
<p>To migrate the documentserver database schema, run following command:
</p>
<pre>$ psql -hlocalhost -Uonlyoffice -d onlyoffice -f /usr/share/webapps/onlyoffice/documentserver/server/schema/postgresql/createdb.sql
</pre>
<h4><span class="mw-headline" id="MariaDB">MariaDB</span></h4>
<p>Login to mariadb and create a database and a user:
</p>
<pre>$ create database onlyoffice;
$ create user 'onlyoffice'@'localhost' identified by '<i>ONLYOFFICE_DB_PASSWD</i>';
$ grant all on onlyoffice.* to 'onlyoffice'@'localhost';
$ flush privileges;
</pre>
<p>Then import schemadb:
</p>
<pre>$ mysql -uonlyoffice -p onlyoffice &lt; /usr/share/webapps/onlyoffice/documentserver/server/schema/mysql/createdb.sql
</pre>
<p>Change the <code>sql</code> section in your <code>local.json</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/onlyoffice/documentserver/local.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">"sql": {
    "type": "mariadb",
    "dbHost": "localhost",
    "dbPort": "3306",
    "dbName": "onlyoffice",
    "dbUser": "onlyoffice",
    "dbPass": "<i>ONLYOFFICE_DB_PASSWD</i>"
},
</pre>
<h3><span class="mw-headline" id="Restrict_access">Restrict access</span></h3>
<p>Restrict access to your documentserver.
</p>
<p>Enable security token:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/onlyoffice/documentserver/local.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">"token": {
    "enable": {
        "browser": true,
        "request": {
            "inbox": true,
            "outbox":true
        }
    },
    ...
},
</pre>
<p>Set a secret key:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/onlyoffice/documentserver/local.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">"secret": {
    "browser": {"string": "<i>DOC_SERVER_PASSWD</i>", "file": ""},
    "inbox": {"string": "<i>DOC_SERVER_PASSWD</i>", "file": ""},
    "outbox": {"string": "<i>DOC_SERVER_PASSWD</i>", "file": ""},
    "session": {"string": "<i>DOC_SERVER_PASSWD</i>", "file": ""}
},
</pre>
<p>Finally, set the <b>same</b> secret key in <i>Nextcloud &gt; Administration Settings &gt; ONLYOFFICE</i>.
</p>
<h3><span class="mw-headline" id="Webserver">Webserver</span></h3>
<h4>
<span id="Nginx_.2F_no_SSL"></span><span class="mw-headline" id="Nginx_/_no_SSL">Nginx / no SSL</span>
</h4>
<p>Here is an example for the <a href="../en/Nginx.html" title="Nginx">Nginx</a> webserver:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nginx/sites-available/onlyoffice-documentserver</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">map $http_host $this_host {
  "" $host;
  default $http_host;
}
map $http_x_forwarded_proto $the_scheme {
  default $http_x_forwarded_proto;
  "" $scheme;
}
map $http_x_forwarded_host $the_host {
  default $http_x_forwarded_host;
  "" $this_host;
}
map $http_upgrade $proxy_connection {
  default upgrade;
  "" close;
}
proxy_set_header Host $http_host;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection $proxy_connection;
proxy_set_header X-Forwarded-Host $the_host;
proxy_set_header X-Forwarded-Proto $the_scheme;
server {
  listen 0.0.0.0:80;
  listen [::]:80 default_server;
  server_tokens off;
  rewrite ^\/OfficeWeb(\/apps\/.*)$ /web-apps$1 redirect;
  location / {
    proxy_pass http://localhost:8000;
    proxy_buffers 4 256k; 
    proxy_max_temp_file_size 0;
  }
  location /spellchecker/ {
    proxy_pass http://localhost:8080/;
  }
}
</pre>
<h4>
<span id="Nginx_.2F_reverse_proxy_with_SSL"></span><span class="mw-headline" id="Nginx_/_reverse_proxy_with_SSL">Nginx / reverse proxy with SSL</span>
</h4>
<p>Create a Nginx configuration file like the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/nginx/conf.d/onlyoffice.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">upstream docservice {
  server 127.0.0.1:PORT;
}

map $http_host $this_host {
    "" $host;
    default $http_host;
}

map $http_x_forwarded_proto $the_scheme {
     default $http_x_forwarded_proto;
     "" $scheme;
}

map $http_x_forwarded_host $the_host {
    default $http_x_forwarded_host;
    "" $this_host;
}

map $http_upgrade $proxy_connection {
  default upgrade;
  "" close;
}

proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection $proxy_connection;
proxy_set_header X-Forwarded-Host $the_host;
proxy_set_header X-Forwarded-Proto $the_scheme;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

server {
    listen 0.0.0.0:443 ssl;
    listen [::]:443 ssl default_server;
    server_name SERVER_NAME
    server_tokens off;
    root /usr/share/nginx/html;

    ssl_certificate SSL_CERT;
    ssl_certificate_key SSL_KEY;
    ssl_verify_client off;
    ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
    ssl_protocols  TLSv1 TLSv1.1 TLSv1.2;
    ssl_session_cache  builtin:1000  shared:SSL:10m;
    ssl_prefer_server_ciphers   on;

    add_header X-Content-Type-Options nosniff;
    location / {
      proxy_pass http://docservice;
      proxy_http_version 1.1;
  }
}
</pre>
<p>Fill in PORT (default 8000), SERVER_NAME, SSL_CERT and SSL_KEY. This was taken from the <a rel="nofollow" class="external text" href="https://github.com/ONLYOFFICE/document-server-proxy/blob/master/nginx/proxy-https-to-http.conf">nginx reference config</a>.
</p>
<p>Reload Nginx:
</p>
<pre>$ nginx -t
$ nginx -s reload
</pre>
<h2><span class="mw-headline" id="Starting">Starting</span></h2>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable/start">Enable/start</a> the following services if you wish to use them locally on the same machine:
</p>
<ul>
<li><code>rabbitmq.service</code></li>
<li><code>redis.service</code></li>
<li><code>postgresql.service</code></li>
</ul>
<p>Finally, start the <i>documentserver</i> services:
</p>
<ul>
<li><code>onlyoffice-fileconverter.service</code></li>
<li><code>onlyoffice-docservice.service</code></li>
</ul>
<h2><span class="mw-headline" id="Nextcloud_app">Nextcloud app</span></h2>
<p>Install the ONLYOFFICE app within Nextcloud. Enter <i>Nextcloud &gt; Settings &gt; ONLYOFFICE</i> and fill in <i>Onlyoffice Docs address</i> with <i>https://SERVER_NAME</i>.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Onlyoffice_Docker_container_on_ZFS">Onlyoffice Docker container on ZFS</span></h3>
<p>When running onlyoffice/documentserver as a Docker container with the <code>data-root</code> pointing to a <a href="../en/ZFS.html" title="ZFS">ZFS</a> device, e.g. when <code>/var</code> is mounted as a ZFS pool, <code>docker run</code> might fail with <code>Error: Daemon failed to copy files</code>. 
</p>
<p>In this case, let Docker have its <code>data-root</code> on an ext4 partition, for instance <code>/var_ext4/lib/docker</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
    "data-root": "/var_ext4/lib/docker"
}
</pre>
<h3><span class="mw-headline" id="Pkg:_Error_reading_from_file.">Pkg: Error reading from file.</span></h3>
<p>If docservice exits with the above error, set the OPTIONS in <code>/etc/makepkg.conf</code> to the given default before building:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/makepkg.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
OPTIONS=(!strip docs libtool staticlibs emptydirs !zipman !purge !debug !lto !autodeps)
...
</pre>
<h3><span class="mw-headline" id="ONLYOFFICE_cannot_be_reached_after_upgrade_to_8.2.0">ONLYOFFICE cannot be reached after upgrade to 8.2.0</span></h3>
<p>Flush your redis database e.g. by executing
</p>
<pre>$ redis-cli flushall
</pre>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Office.html" title="Category:Office">Office</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Onlyoffice_Documentserver&amp;oldid=824285">https://wiki.archlinux.org/index.php?title=Onlyoffice_Documentserver&amp;oldid=824285</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 30 December 2024, at 16:19.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki.svg" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul></ul>
</div>
</body>
</html>
