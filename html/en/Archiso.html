<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-zebra-design-disabled vector-feature-custom-font-size-clientpref-disabled vector-feature-client-preferences-disabled vector-feature-typography-survey-disabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Archiso - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.41.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Archiso rootpage-Archiso skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-main-menu-container">
		</div>
	<input type="checkbox" id="vector-toc-collapsed-checkbox" class="vector-menu-checkbox">
			<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark vector-sticky-pinned-container">
				<div id="vector-toc-pinned-container" class="vector-pinned-container">
				<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Prepare_a_custom_profile" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Prepare_a_custom_profile">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Prepare a custom profile</div>
		</a>
		
			<button aria-controls="toc-Prepare_a_custom_profile-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Prepare a custom profile subsection</span>
			</button>
		
		<ul id="toc-Prepare_a_custom_profile-sublist" class="vector-toc-list">
			<li id="toc-Profile_structure" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Profile_structure">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Profile structure</div>
			</a>
			
			<ul id="toc-Profile_structure-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Selecting_packages" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Selecting_packages">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Selecting packages</div>
			</a>
			
			<ul id="toc-Selecting_packages-sublist" class="vector-toc-list">
				<li id="toc-Custom_local_repository" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Custom_local_repository">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.1</span>Custom local repository</div>
			</a>
			
			<ul id="toc-Custom_local_repository-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Packages_from_multilib" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Packages_from_multilib">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.2</span>Packages from multilib</div>
			</a>
			
			<ul id="toc-Packages_from_multilib-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Adding_files_to_image" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Adding_files_to_image">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Adding files to image</div>
			</a>
			
			<ul id="toc-Adding_files_to_image-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Adding_repositories_to_the_image" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Adding_repositories_to_the_image">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4</span>Adding repositories to the image</div>
			</a>
			
			<ul id="toc-Adding_repositories_to_the_image-sublist" class="vector-toc-list">
				<li id="toc-archzfs_example" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#archzfs_example">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4.1</span>archzfs example</div>
			</a>
			
			<ul id="toc-archzfs_example-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Kernel" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Kernel">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.5</span>Kernel</div>
			</a>
			
			<ul id="toc-Kernel-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Boot_loader" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Boot_loader">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.6</span>Boot loader</div>
			</a>
			
			<ul id="toc-Boot_loader-sublist" class="vector-toc-list">
				<li id="toc-UEFI_Secure_Boot" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#UEFI_Secure_Boot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.6.1</span>UEFI Secure Boot</div>
			</a>
			
			<ul id="toc-UEFI_Secure_Boot-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-systemd_units" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#systemd_units">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.7</span>systemd units</div>
			</a>
			
			<ul id="toc-systemd_units-sublist" class="vector-toc-list">
				<li id="toc-Login_manager" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Login_manager">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.7.1</span>Login manager</div>
			</a>
			
			<ul id="toc-Login_manager-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Changing_automatic_login" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Changing_automatic_login">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.7.2</span>Changing automatic login</div>
			</a>
			
			<ul id="toc-Changing_automatic_login-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Users_and_passwords" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Users_and_passwords">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.8</span>Users and passwords</div>
			</a>
			
			<ul id="toc-Users_and_passwords-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Changing_the_distribution_name_used_in_the_ISO" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Changing_the_distribution_name_used_in_the_ISO">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.9</span>Changing the distribution name used in the ISO</div>
			</a>
			
			<ul id="toc-Changing_the_distribution_name_used_in_the_ISO-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Build_the_ISO" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Build_the_ISO">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Build the ISO</div>
		</a>
		
			<button aria-controls="toc-Build_the_ISO-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Build the ISO subsection</span>
			</button>
		
		<ul id="toc-Build_the_ISO-sublist" class="vector-toc-list">
			<li id="toc-Removal_of_work_directory" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Removal_of_work_directory">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Removal of work directory</div>
			</a>
			
			<ul id="toc-Removal_of_work_directory-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Using_the_ISO" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Using_the_ISO">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Using the ISO</div>
		</a>
		
		<ul id="toc-Using_the_ISO-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Test_the_ISO_in_QEMU" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Test_the_ISO_in_QEMU">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Test the ISO in QEMU</div>
		</a>
		
		<ul id="toc-Test_the_ISO_in_QEMU-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Tips and tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Online_build" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Online_build">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>Online build</div>
			</a>
			
			<ul id="toc-Online_build-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Prepare_an_ISO_for_an_installation_via_SSH" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Prepare_an_ISO_for_an_installation_via_SSH">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2</span>Prepare an ISO for an installation via SSH</div>
			</a>
			
			<ul id="toc-Prepare_an_ISO_for_an_installation_via_SSH-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Automatically_connect_to_a_Wi-Fi_network_using_iwd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Automatically_connect_to_a_Wi-Fi_network_using_iwd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.3</span>Automatically connect to a Wi-Fi network using iwd</div>
			</a>
			
			<ul id="toc-Automatically_connect_to_a_Wi-Fi_network_using_iwd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Adjusting_the_size_of_the_root_file_system" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Adjusting_the_size_of_the_root_file_system">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.4</span>Adjusting the size of the root file system</div>
			</a>
			
			<ul id="toc-Adjusting_the_size_of_the_root_file_system-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Encryption" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Encryption">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.5</span>Encryption</div>
			</a>
			
			<ul id="toc-Encryption-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Google_Compute_Engine_images" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Google_Compute_Engine_images">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.6</span>Google Compute Engine images</div>
			</a>
			
			<ul id="toc-Google_Compute_Engine_images-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Libvirt_VM_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Libvirt_VM_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.7</span>Libvirt VM configuration</div>
			</a>
			
			<ul id="toc-Libvirt_VM_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Window_manager_freezes" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Window_manager_freezes">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1</span>Window manager freezes</div>
			</a>
			
			<ul id="toc-Window_manager_freezes-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

				</div>
	</nav>
		
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<label id="vector-toc-collapsed-button" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet vector-button-flush-left cdx-button--icon-only" for="vector-toc-collapsed-checkbox" role="button" aria-controls="vector-toc" tabindex="0" title="Table of Contents">
						<span class="vector-icon mw-ui-icon-wikimedia-listBullet"></span>
						<span>Toggle the table of contents</span>
					</label>
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Archiso</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 6 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-6" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">6 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/Archiso.html" title="Archiso – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-fr mw-list-item"><a href="../fr/Archiso.html" title="Archiso – français" lang="fr" hreflang="fr" class="interlanguage-link-target"><span>Français</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Archiso" title="Archiso – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/Archiso.html" title="Archiso – português" lang="pt" hreflang="pt" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Archiso.html" title="Archiso – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Archiso" title="Archiso – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<nav class="vector-page-tools-landmark vector-sticky-pinned-container" aria-label="Page tools">
						<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
			
						</div>
	</nav>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Preboot_Execution_Environment.html" class="mw-redirect" title="Archiso as pxe server">Archiso as pxe server</a></li>
<li><a href="../en/Offline_installation.html" title="Offline installation">Offline installation</a></li>
<li><a href="../en/USB_flash_installation_medium.html" title="USB flash installation medium">USB flash installation medium</a></li>
</ul>
</div> 
<p><a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archiso">Archiso</a> is a highly-customizable tool for building Arch Linux live CD/USB ISO images. The <a rel="nofollow" class="external text" href="https://archlinux.org/download/">official images</a> are built with Archiso. It can be used as the basis for rescue systems, linux installers or other systems. This wiki article explains how to install Archiso, and how to configure it to control aspects of the resulting ISO image such as included packages and files. Technical requirements and build steps can be found in the <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archiso/-/tree/master/docs">official project documentation</a>. Archiso is implemented with a number of bash scripts. The core component of Archiso is the <i>mkarchiso</i> command. Its options are documented in <i>mkarchiso -h</i> and not covered here.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=archiso">archiso</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/archiso-git/">archiso-git</a></span><sup><small>AUR</small></sup> package. The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/archiso-profiles/">archiso-profiles</a></span><sup><small>AUR</small></sup> package contains additional community-provided profiles.
</p>
<h2><span class="mw-headline" id="Prepare_a_custom_profile">Prepare a custom profile</span></h2>
<p>Archiso comes with two profiles, <b>releng</b> and <b>baseline</b>.
</p>
<ul>
<li>
<b>releng</b> is used to create the official monthly installation ISO. It can be used as a starting point for creating a customized ISO image.</li>
<li>
<b>baseline</b> is a minimalistic configuration, that includes only the bare minimum packages required to boot the live environment from the medium.</li>
</ul>
<p>To build an unmodified version of the profiles, skip to <a href="#Build_the_ISO">#Build the ISO</a>. Otherwise, if you wish to adapt or customize one of archiso's shipped profiles, copy it from <code>/usr/share/archiso/configs/<i>profile-name</i>/</code> to a writable directory with a name of your choice. For example:
</p>
<pre>$ cp -r /usr/share/archiso/configs/releng/ archlive
</pre>
<p>Proceed to the following sections to customize and build the custom profile.
</p>
<h3><span class="mw-headline" id="Profile_structure">Profile structure</span></h3>
<p>An archiso profile contains configuration that defines the resulting ISO image. The profile structure is documented in <code>/usr/share/doc/archiso/README.profile.rst</code><a rel="nofollow" class="external autonumber" href="https://gitlab.archlinux.org/archlinux/archiso/-/blob/master/docs/README.profile.rst">[1]</a>.
</p>
<h3><span class="mw-headline" id="Selecting_packages">Selecting packages</span></h3>
<p>Edit <code>packages.x86_64</code> to select which packages are to be installed on the live system image, listing packages line by line.
</p>
<h4><span class="mw-headline" id="Custom_local_repository">Custom local repository</span></h4>
<p>To add packages not located in standard Arch repositories (e.g. custom packages or packages from <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>/<a href="../en/Arch_build_system.html" class="mw-redirect" title="ABS">ABS</a>), set up a <a href="../en/Pacman/Tips_and_tricks.html#Custom_local_repository" class="mw-redirect" title="Custom local repository">custom local repository</a> and add your custom packages to it. Then add your repository to <code>pacman.conf</code> as follows: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"><i>archlive</i>/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
[<i>customrepo</i>]
SigLevel = Optional TrustAll
Server = file://<i>/path/to/customrepo</i>
...</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>The ordering within <code>pacman.conf</code> matters. To give top priority to your custom repository, place it above the other repository entries.</li>
<li>This <code>pacman.conf</code> is only used for building the image. It will not be used in the live environment. To do this, see <a href="#Adding_repositories_to_the_image">#Adding repositories to the image</a>.</li>
</ul>
</div>
<h4><span class="mw-headline" id="Packages_from_multilib">Packages from multilib</span></h4>
<p>To install packages from the <a href="../en/Official_repositories.html#multilib" class="mw-redirect" title="Multilib">multilib</a> repository, simply uncomment that repository in <code>pacman.conf</code>.
</p>
<h3><span class="mw-headline" id="Adding_files_to_image">Adding files to image</span></h3>
<p>The airootfs directory is used as the starting point for the <a href="https://en.wikipedia.org/wiki/Root_directory" class="extiw" title="wikipedia:Root directory">root directory</a> (<code>/</code>) of the live system on the image. All its contents will be copied over to the working directory before packages are installed.
</p>
<p>Place any custom files and/or directories in the desired location under <code>airootfs/</code>. For example, if you have a set of iptables scripts on your current system you want to be used on you live image, copy them over as such:
</p>
<pre>$ cp -r /etc/iptables <i>archlive</i>/airootfs/etc
</pre>
<p>Similarly, some care is required for special configuration files that reside somewhere down the hierarchy. Missing parts of the directory structure can be simply created with <span class="plainlinks archwiki-template-man" title="$ man 1 mkdir"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkdir.1">mkdir(1)</a></span>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> To add a file to the install user's home directory, place it in <code><i>archlive</i>/airootfs/root/</code>. To add a file to all other users home directories, place it in <code><i>archlive</i>/airootfs/etc/skel/</code>.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Custom files that conflict with those provided by packages will be overwritten unless a package specifies them as <a href="../en/Pacman/Pacnew_and_Pacsave.html#Package_backup_files" title="Pacman/Pacnew and Pacsave">backup files</a>.</div>
<p>By default, <a href="../en/File_permissions_and_attributes.html" class="mw-redirect" title="Permissions">permissions</a> will be <code>644</code> for files and <code>755</code> for directories. All of them will be owned by the root user. To set different permissions or ownership for specific files and/or folders, use the <code>file_permissions</code> associative array in <code>profiledef.sh</code>. See <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archiso/-/blob/master/docs/README.profile.rst">README.profile.rst</a> for details.
</p>
<h3><span class="mw-headline" id="Adding_repositories_to_the_image">Adding repositories to the image</span></h3>
<p>To add a repository that can be used in the live environment, create a <a href="../en/Pacman.html#Repositories_and_mirrors" title="Pacman">suitably modified</a> <code>pacman.conf</code> and place it in <code><i>archlive</i>/airootfs/etc/</code>.
</p>
<p>If the repository also uses a key, place the key in <code><i>archlive</i>/airootfs/usr/share/pacman/keyrings/</code>. The key file name must end with <code>.gpg</code>. Additionally, the key must be trusted. This can be accomplished by creating a GnuPG exported trust file in the same directory. The file name must end with <code>-trusted</code>. The first field is the key fingerprint, and the second is the trust. You can reference <code>/usr/share/pacman/keyrings/archlinux-trusted</code> for an example.
</p>
<h4><span class="mw-headline" id="archzfs_example">archzfs example</span></h4>
<p>The files in this example are:
</p>
<pre>airootfs
├── etc
│   ├── pacman.conf
│   └── pacman.d
│       └── archzfs_mirrorlist
└── usr
    └── share
        └── pacman
            └── keyrings
                ├── archzfs.gpg
                └── archzfs-trusted
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">airootfs/etc/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
[archzfs]
Include = /etc/pacman.d/archzfs_mirrorlist
...</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">airootfs/etc/pacman.d/archzfs_mirrorlist</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Server = https://archzfs.com/$repo/$arch
Server = https://mirror.sum7.eu/archlinux/archzfs/$repo/$arch
Server = https://mirror.biocrafting.net/archlinux/archzfs/$repo/$arch
Server = https://mirror.in.themindsmaze.com/archzfs/$repo/$arch
Server = https://zxcvfdsa.com/archzfs/$repo/$arch
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">airootfs/usr/share/pacman/keyrings/archzfs-trusted</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">DDF7DB817396A49B2A2723F7403BD972F75D9D76:4:</pre>
<p><code>archzfs.gpg</code> itself can be obtained directly from the repository site at <a rel="nofollow" class="external free" href="https://archzfs.com/archzfs.gpg">https://archzfs.com/archzfs.gpg</a>.
</p>
<h3><span class="mw-headline" id="Kernel">Kernel</span></h3>
<p>Although both archiso's included profiles only have <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span>, ISOs can be made to include other or even multiple <a href="../en/Kernel.html" class="mw-redirect" title="Kernels">kernels</a>.
</p>
<p>First, edit <code>packages.x86_64</code> to include kernel package names that you want. When <i>mkarchiso</i> runs, it will include all <code><i>work_dir</i>/airootfs/boot/vmlinuz-*</code> and <code><i>work_dir</i>/boot/initramfs-*.img</code> files in the ISO (and additionally in the FAT image used for UEFI booting).
</p>
<p><a href="../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a> presets by default will build fallback initramfs images. For an ISO, the main initramfs image would not typically include the <code>autodetect</code> hook, thus making an additional fallback image unnecessary. To prevent the creation of an fallback initramfs image, so that it does not take up space or slow down the build process, place a custom preset in <code><i>archlive</i>/airootfs/etc/mkinitcpio.d/<i>pkgbase</i>.preset</code>. For example, for <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-lts">linux-lts</a></span>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"><i>archlive</i>/airootfs/etc/mkinitcpio.d/linux-lts.preset</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PRESETS=('archiso')

ALL_kver='/boot/vmlinuz-linux-lts'
ALL_config='/etc/mkinitcpio.conf'

archiso_image="/boot/initramfs-linux-lts.img"</pre>
<p>Finally create <a href="#Boot_loader">boot loader configuration</a> to allow booting the kernel(s).
</p>
<h3><span class="mw-headline" id="Boot_loader">Boot loader</span></h3>
<p>Archiso supports <a href="../en/Syslinux.html" title="Syslinux">syslinux</a> for BIOS booting and <a href="../en/GRUB.html" title="GRUB">GRUB</a> or <a href="../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a> for UEFI booting. Refer to the articles of the boot loaders for information on their configuration syntax.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>The <b>releng</b> profile by default builds into an ISO that supports both BIOS and UEFI booting when burned to an optical disc using El Torito, or when written to a hard disk (or USB flash drive, or similar) using <a rel="nofollow" class="external text" href="https://wiki.syslinux.org/wiki/index.php?title=Isohybrid">Isohybrid</a>.</li>
<li>Due to the modular nature of isolinux, you are able to use lots of addons since all <i>.c32</i> files are copied and available to you. Take a look at the <a rel="nofollow" class="external text" href="https://wiki.syslinux.org/wiki/index.php/SYSLINUX">official syslinux site</a> and the <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archiso/-/tree/master/configs/releng/syslinux">archiso git repo</a>. Using said addons, it is possible to make visually attractive and complex menus. See <a rel="nofollow" class="external autonumber" href="https://wiki.syslinux.org/wiki/index.php?title=Comboot/menu.c32">[2]</a>.</li>
</ul>
</div>
<p>mkarchiso expects that GRUB configuration is in the <code>grub</code> directory, <a href="../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a> configuration is in the <code>efiboot</code> directory, and <a href="../en/Syslinux.html" title="Syslinux">syslinux</a> configuration in <code>syslinux</code> and <code>isolinux</code> directories.
</p>
<h4><span class="mw-headline" id="UEFI_Secure_Boot">UEFI Secure Boot</span></h4>
<p>If you want to make your Archiso bootable on a UEFI Secure Boot enabled environment, you must use a signed boot loader. You can follow the instructions on <a href="../en/Unified_Extensible_Firmware_Interface/Secure_Boot.html#Booting_an_installation_medium" class="mw-redirect" title="Secure Boot">Secure Boot#Booting an installation medium</a>.
</p>
<h3><span class="mw-headline" id="systemd_units">systemd units</span></h3>
<p>To <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> systemd services/sockets/timers for the live environment, you need to manually create the symbolic links just as <code>systemctl enable</code> does it.
</p>
<p>For example, to enable <code>gpm.service</code>, which contains <code>WantedBy=multi-user.target</code>, run:
</p>
<pre>$ mkdir -p <i>archlive</i>/airootfs/etc/systemd/system/multi-user.target.wants
$ ln -s /usr/lib/systemd/system/gpm.service <i>archlive</i>/airootfs/etc/systemd/system/multi-user.target.wants/
</pre>
<p>The required symlinks can be found out by reading the systemd unit, or if you have the service installed, by <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enabling">enabling</a> it and observing the systemctl output.
</p>
<h4><span class="mw-headline" id="Login_manager">Login manager</span></h4>
<p>Starting X at boot is done by enabling your login manager's <a href="../en/Systemd.html" title="Systemd">systemd</a> service. If you do not know which <i>.service</i> to enable, you can easily find out in case you are using the same program on the system you build your ISO on. Just use:
</p>
<pre>$ ls -l /etc/systemd/system/display-manager.service
</pre>
<p>Now create the same symlink in <code><i>archlive</i>/airootfs/etc/systemd/system/</code>. For LXDM:
</p>
<pre>$ ln -s /usr/lib/systemd/system/lxdm.service <i>archlive</i>/airootfs/etc/systemd/system/display-manager.service
</pre>
<p>This will enable LXDM at system start on your live system.
</p>
<h4><span class="mw-headline" id="Changing_automatic_login">Changing automatic login</span></h4>
<p>The configuration for getty's automatic login is located under <code>airootfs/etc/systemd/system/getty@tty1.service.d/autologin.conf</code>.
</p>
<p>You can modify this file to change the auto login user:
</p>
<pre>[Service]
ExecStart=
ExecStart=-/sbin/agetty --autologin <i><b>username</b></i> --noclear %I 38400 linux
</pre>
<p>Or remove <code>autologin.conf</code> altogether to disable auto login.
</p>
<p>If you are using the serial console, create <code>airootfs/etc/systemd/system/serial-getty@ttyS0.service.d/autologin.conf</code> with the following content instead:
</p>
<pre>[Service]
ExecStart=
ExecStart=-/sbin/agetty -o '-p -- \\u' --noclear --autologin root --keep-baud 115200,57600,38400,9600 - $TERM
</pre>
<h3><span class="mw-headline" id="Users_and_passwords">Users and passwords</span></h3>
<p>To create a <a href="../en/Users_and_groups.html" class="mw-redirect" title="User">user</a> which will be available in the live environment, you must manually edit <code><i>archlive</i>/airootfs/etc/passwd</code>, <code><i>archlive</i>/airootfs/etc/shadow</code>, <code><i>archlive</i>/airootfs/etc/group</code> and <code><i>archlive</i>/airootfs/etc/gshadow</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If these files exist, they must contain the root user and group.</div>
<p>For example, to add a user <code>archie</code>. Add them to <code><i>archlive</i>/airootfs/etc/passwd</code> following the <span class="plainlinks archwiki-template-man" title="$ man 5 passwd"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/passwd.5">passwd(5)</a></span> syntax:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"><i>archlive</i>/airootfs/etc/passwd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">root:x:0:0:root:/root:/usr/bin/zsh
archie:x:1000:1000::/home/archie:/usr/bin/zsh
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <code>passwd</code> file must end with a newline.</div>
<p>Generate a password hash with <code>openssl passwd -6</code> and add it to <code><i>archlive</i>/airootfs/etc/shadow</code> following the syntax of <span class="plainlinks archwiki-template-man" title="$ man 5 shadow"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/shadow.5">shadow(5)</a></span>. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"><i>archlive</i>/airootfs/etc/shadow</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">root::14871::::::
archie:$6$randomsalt$cij4/pJREFQV/NgAgh9YyBIoCRRNq2jp5l8lbnE5aLggJnzIRmNVlogAg8N6hEEecLwXHtMQIl2NX2HlDqhCU1:14871::::::</pre>
<p>Add the user's group and the groups which they will part of to <code><i>archlive</i>/airootfs/etc/group</code> according to <span class="plainlinks archwiki-template-man" title="$ man 5 group"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/group.5">group(5)</a></span>. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"><i>archlive</i>/airootfs/etc/group</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">root:x:0:root
adm:x:4:archie
wheel:x:10:archie
uucp:x:14:archie
archie:x:1000:</pre>
<p>Create the appropriate <code><i>archlive</i>/airootfs/etc/gshadow</code> according to <span class="plainlinks archwiki-template-man" title="$ man 5 gshadow"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/gshadow.5">gshadow(5)</a></span>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"><i>archlive</i>/airootfs/etc/gshadow</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">root:!*::root
archie:!*::</pre>
<p>Make sure <code>/etc/shadow</code> and <code>/etc/gshadow</code> have the correct permissions:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"><i>archlive</i>/profiledef.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
file_permissions=(
  ...
  ["/etc/shadow"]="0:0:0400"
  ["/etc/gshadow"]="0:0:0400"
)</pre>
<p>After package installation, <i>mkarchiso</i> will create all specified home directories for users listed in <code><i>archlive</i>/airootfs/etc/passwd</code> and copy <code><i>work_directory</i>/x86_64/airootfs/etc/skel/*</code> to them. The copied files will have proper user and group ownership.
</p>
<h3><span class="mw-headline" id="Changing_the_distribution_name_used_in_the_ISO">Changing the distribution name used in the ISO</span></h3>
<p>Start by copying the file <code>/etc/os-release</code> into the <code>etc/</code> folder in the rootfs. Then, edit the file accordingly. You can also change the name inside of GRUB and syslinux.
</p>
<h2><span class="mw-headline" id="Build_the_ISO">Build the ISO</span></h2>
<p>Build an ISO which you can then burn to CD or USB by running:
</p>
<pre># mkarchiso -v -w <i>/path/to/work_dir</i> -o <i>/path/to/out_dir</i> <i>/path/to/profile/</i>
</pre>
<ul>
<li>
<code>-w</code> specifies the working directory. If the option is not specified, it will default to <code>work</code> in the current directory.</li>
<li>
<code>-o</code> specifies the directory where the built ISO image will be placed. If the option is not specified, it will default to <code>out</code> in the current directory.</li>
<li>It should be noted the profile file <code>profiledef.sh</code> cannot be specified when running mkarchiso, only the path to the file.</li>
</ul>
<p>Replace <code><i>/path/to/profile/</i></code> with the path to your custom profile, or with <code>/usr/share/archiso/configs/releng/</code> if you are building an unmodified profile.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If memory allows, it is preferred to place the working directory on <a href="../en/Tmpfs.html" title="Tmpfs">tmpfs</a>. E.g.:
<pre># mkarchiso -v -w /tmp/archiso-tmp <i>/path/to/profile/</i>
</pre>
</div>
<p>When run, the script will download and install the packages you specified to <code><i>work_directory</i>/x86_64/airootfs</code>, create the kernel and init images, apply your customizations and finally build the ISO into the output directory.
</p>
<h3><span class="mw-headline" id="Removal_of_work_directory">Removal of work directory</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If <i>mkarchiso</i> is interrupted, run <span class="plainlinks archwiki-template-man" title="$ man 8 findmnt"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/findmnt.8">findmnt(8)</a></span> to make sure there are no mount binds before deleting it - otherwise, <b>you may lose data</b> (e.g. an external device mounted at <code>/run/media/<i>user</i>/<i>label</i></code> gets bound within <code>work/x86_64/airootfs/run/media/<i>user</i>/<i>label</i></code> during the build process).</div>
<p>The temporary files are copied into work directory. After successfully building the ISO , the work directory and its contents can be deleted. E.g.:
</p>
<pre># rm -rf <i>/path/to/work_dir</i>
</pre>
<h2><span class="mw-headline" id="Using_the_ISO">Using the ISO</span></h2>
<p>See <a href="../en/Installation_guide.html#Prepare_an_installation_medium" title="Installation guide">Installation guide#Prepare an installation medium</a> for various options.
</p>
<h2><span class="mw-headline" id="Test_the_ISO_in_QEMU">Test the ISO in QEMU</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the optional dependencies <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=qemu-desktop">qemu-desktop</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=edk2-ovmf">edk2-ovmf</a></span>.
</p>
<p>Use the convenience script <code>run_archiso</code> to run a built image using <a href="../en/QEMU.html" title="QEMU">QEMU</a>.
</p>
<pre>$ run_archiso -i <i>/path/to/</i>archlinux-<i>yyyy.mm.dd</i>-x86_64.iso
</pre>
<p>The virtual machine can also be run using UEFI emulation:
</p>
<pre>$ run_archiso -u -i <i>/path/to/</i>archlinux-<i>yyyy.mm.dd</i>-x86_64.iso
</pre>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Online_build">Online build</span></h3>
<p>If you do not have an arch system available or you need to setup Archiso from another GNU/Linux distribution, be aware there exists an <a rel="nofollow" class="external text" href="https://colab.research.google.com/github/tallero/archiso-profiles/">online builder</a>.
</p>
<h3><span class="mw-headline" id="Prepare_an_ISO_for_an_installation_via_SSH">Prepare an ISO for an installation via SSH</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Since <code>archlinux-2021.02.01-x86_64.iso</code>, <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archiso/-/tree/bd2b861aa39167e4fc658a354071b95fbd050c0f/configs/releng/airootfs/etc/systemd/system/cloud-init.target.wants">cloud-init support</a> is provided, and <code>sshd.service</code> is <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archiso/-/blob/bd2b861aa39167e4fc658a354071b95fbd050c0f/configs/releng/airootfs/etc/systemd/system/multi-user.target.wants/sshd.service">enabled by default</a>.</div>
<p>To <a href="../en/Install_Arch_Linux_via_SSH.html" title="Install Arch Linux via SSH">install Arch Linux via SSH</a> without any interaction with the system, an SSH public key must be placed in <code>authorized_keys</code>.
</p>
<p>Adding the SSH key can either be done manually (explained here), or <a href="../en/Install_Arch_Linux_via_SSH.html#Installation_on_a_headless_server" title="Install Arch Linux via SSH">by cloud-init</a>.
</p>
<p>To add the key manually, first <a href="#Prepare_a_custom_profile">copy Archiso's releng profile</a> to a writable directory. The following example uses <code>archlive</code>.
</p>
<pre>$ cp -r /usr/share/archiso/configs/<i>profile/</i> archlive
</pre>
<p>Create a <code>.ssh</code> directory in the home directory of the user which will be used to log in. The following example will be using the root user.
</p>
<pre>$ mkdir archlive/airootfs/root/.ssh
</pre>
<p>Add the SSH public key(s), which will be used to log in, to <code>authorized_keys</code>:
</p>
<pre>$ cat ~/.ssh/<i>key1</i>.pub &gt;&gt; archlive/airootfs/root/.ssh/authorized_keys
$ cat ~/.ssh/<i>key2</i>.pub &gt;&gt; archlive/airootfs/root/.ssh/authorized_keys
</pre>
<p>Set correct <a href="../en/File_permissions_and_attributes.html" class="mw-redirect" title="Permissions">permissions</a> and ownership for the <code>.ssh</code> directory and the <code>authorized_keys</code> file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">archlive/profiledef.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
file_permissions=(
  ...
  ["/root"]="0:0:0750"
  ["/root/.ssh"]="0:0:0700"
  ["/root/.ssh/authorized_keys"]="0:0:0600"
)</pre>
<p>Finally <a href="#Build_the_ISO">build the ISO</a>. Upon booting the ISO, <a href="../en/OpenSSH.html" title="OpenSSH">OpenSSH</a> will start and it will be possible to log in using the corresponding SSH private key(s).
</p>
<h3><span class="mw-headline" id="Automatically_connect_to_a_Wi-Fi_network_using_iwd">Automatically connect to a Wi-Fi network using iwd</span></h3>
<p>Create <code>/var/lib/iwd/</code> inside the profile's <code>airootfs</code> directory and set the correct permissions:
</p>
<pre>$ mkdir -p <i>archlive</i>/airootfs/var/lib/iwd
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">archlive/profiledef.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
file_permissions=(
  ...
  ["/var/lib/iwd"]="0:0:0700"
)</pre>
<p>Follow the instructions in <a href="../en/Iwd.html#Network_configuration" title="Iwd">iwd#Network configuration</a> and <span class="plainlinks archwiki-template-man" title="$ man 5 iwd.network"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/iwd.network.5">iwd.network(5)</a></span> to create a network configuration file for your Wi-Fi network.
</p>
<p>Save the configuration file inside <code><i>archlive</i>/airootfs/var/lib/iwd/</code>.
</p>
<h3><span class="mw-headline" id="Adjusting_the_size_of_the_root_file_system">Adjusting the size of the root file system</span></h3>
<p>When installing packages in the live environment, for example on hardware requiring <a href="../en/Dynamic_Kernel_Module_Support.html" class="mw-redirect" title="DKMS">DKMS</a> modules, the default size of the root file system might not allow the download and installation of such packages due to its size.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> See <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1628972#p1628972">BBS#210389</a> for the reason behind the chosen size, and <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/45618">FS#45618</a> for historical details.</div> 
<p>It will manifest as the following error message when downloading files or installing packages in the live environment:
</p>
<pre>error: partition / too full: 63256 blocks needed, 61450 blocks free
error: not enough free disk space
error: failed to commit transaction (not enough free disk space)
Errors occurred: no packages were upgraded.
</pre>
<p>To adjust the size on the fly: 
</p>
<pre># mount -o remount,size=<i>SIZE</i> /run/archiso/cowspace
</pre>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 5 tmpfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/tmpfs.5#size">tmpfs(5) § size</a></span> for the possible parameters of <code><i>SIZE</i></code>.
</p>
<p>To adjust the size at the bootloader stage (by pressing <code>e</code> or <code>Tab</code>) use the boot option:
</p>
<pre>cow_spacesize=<i>SIZE</i>
</pre>
<p>To adjust the size while building an image add the boot option to:
</p>
<ul>
<li><code>efiboot/loader/entries/*.cfg</code></li>
<li><code>grub/*.cfg</code></li>
<li><code>syslinux/*.cfg</code></li>
</ul>
<p>The result can be checked with:
</p>
<pre>$ df -h
</pre>
<p>See <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/mkinitcpio/mkinitcpio-archiso/blob/master/docs/README.bootparams">mkinitcpio-archiso boot parameters</a>.
</p>
<h3><span class="mw-headline" id="Encryption">Encryption</span></h3>
<p>In order for vanilla <code>mkarchiso</code> to produce encrypted images, <a href="../en/Dm-crypt.html" class="mw-redirect" title="LUKS">LUKS</a> support in <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archiso/-/merge_requests/217">archiso</a>, <a href="../en/Dm-crypt/System_configuration.html" title="Dm-crypt/System configuration">encrypt</a> hook's compatibility in <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/mkinitcpio/mkinitcpio-archiso/-/merge_requests/25">mkinitcpio-archiso</a> and nested <code>cryptkey</code>s support in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cryptsetup">cryptsetup</a></span> merge requests need to be approved.
</p>
<p>Packages with such features already merged are <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/archiso-encryption/">archiso-encryption</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">broken link</a>: package not found]</sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-archiso-encryption/">mkinitcpio-archiso-encryption</a></span><sup><small>AUR</small></sup> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/cryptsetup-nested-cryptkey/">cryptsetup-nested-cryptkey</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">broken link</a>: package not found]</sup>.
</p>
<p>To enable encryption on an existing profile: 
</p>
<ul>
<li>add <code>+luks</code> to the <code>airootfs_image_type</code> value in <code>profiledef.sh</code>;</li>
<li>set an <code>encryption_key</code> in <code>profiledef.sh</code> (to use a key file instead of a password).</li>
<li>enable the <code>encrypt</code> hook in <code>/etc/mkinitcpio.conf</code>;</li>
<li>add AUR packages (or build custom replacements with the aforementioned sources) to <code>packages.x86_64</code>
</li>
<li>add the <code>keys</code> buildmode to the <code>buildmodes</code> array in <code>profiledef.sh</code> (to build a second ISO containing the key file that put on external storage is able to boot the system).</li>
</ul>
<p>Example configurations based on the <code>baseline</code> and <code>releng</code> profiles are available as <code>ebaseline</code> and <code>ereleng</code> in the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/archiso-profiles/">archiso-profiles</a></span><sup><small>AUR</small></sup> package.
</p>
<h3><span class="mw-headline" id="Google_Compute_Engine_images">Google Compute Engine images</span></h3>
<p>A Google Compute Engine-compatible <code>releng</code> compressed image is available as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/archlinux-gce/">archlinux-gce</a></span><sup><small>AUR</small></sup>.
</p>
<h3><span class="mw-headline" id="Libvirt_VM_configuration">Libvirt VM configuration</span></h3>
<p>A <a href="../en/Libvirt.html" title="Libvirt">libvirt</a> configuration which runs the <code>releng</code> image is available as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/archlinux-libvirt/">archlinux-libvirt</a></span><sup><small>AUR</small></sup>.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Window_manager_freezes">Window manager freezes</span></h3>
<p>If you want to use a <a href="../en/Window_manager.html" title="Window manager">window manager</a> in the Live CD, you must add the necessary and correct <a href="../en/Xorg.html#Driver_installation" class="mw-redirect" title="Video drivers">video drivers</a>, or the WM may freeze on loading.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archiso">Archiso project page</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archiso/-/tree/master/docs">Official documentation</a></li>
<li><a rel="nofollow" class="external text" href="https://lists.archlinux.org/mailman3/lists/arch-releng.lists.archlinux.org/">Arch Linux Release Engineering mailing list</a></li>
<li><a rel="nofollow" class="external text" href="ircs://irc.libera.chat/archlinux-releng">#archlinux-releng — Arch Linux Release Engineering IRC channel</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/pierres/archiso-manager">archiso-manager — the tool used for building the official monthly ISOs</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Live_Arch_systems.html" title="Category:Live Arch systems">Live Arch systems</a></li>
<li><a href="../en/Category:Installation_process.html" title="Category:Installation process">Installation process</a></li>
<li><a href="../en/Category:Arch_projects.html" title="Category:Arch projects">Arch projects</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Archiso&amp;oldid=804822">https://wiki.archlinux.org/index.php?title=Archiso&amp;oldid=804822</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 29 March 2024, at 08:33.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
