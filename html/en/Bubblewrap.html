<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Bubblewrap - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Bubblewrap rootpage-Bubblewrap skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Configuration</div>
		</a>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration_managers_for_bubblewrap" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuration_managers_for_bubblewrap">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Configuration managers for bubblewrap</div>
		</a>
		
		<ul id="toc-Configuration_managers_for_bubblewrap-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Usage_examples" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Usage_examples">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Usage examples</div>
		</a>
		
			<button aria-controls="toc-Usage_examples-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Usage examples subsection</span>
			</button>
		
		<ul id="toc-Usage_examples-sublist" class="vector-toc-list">
			<li id="toc-No-op" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#No-op">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>No-op</div>
			</a>
			
			<ul id="toc-No-op-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Bash" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Bash">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Bash</div>
			</a>
			
			<ul id="toc-Bash-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Desktop_entries" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Desktop_entries">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Desktop entries</div>
			</a>
			
			<ul id="toc-Desktop_entries-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Filesystem_isolation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Filesystem_isolation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>Filesystem isolation</div>
			</a>
			
			<ul id="toc-Filesystem_isolation-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Using_X11" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_X11">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Using X11</div>
			</a>
			
			<ul id="toc-Using_X11-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Sandboxing_X11" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Sandboxing_X11">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Sandboxing X11</div>
			</a>
			
			<ul id="toc-Sandboxing_X11-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_portals" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_portals">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Using portals</div>
			</a>
			
			<ul id="toc-Using_portals-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Opening_URLs_from_wrapped_applications" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Opening_URLs_from_wrapped_applications">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>Opening URLs from wrapped applications</div>
			</a>
			
			<ul id="toc-Opening_URLs_from_wrapped_applications-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-New_session" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#New_session">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5</span>New session</div>
			</a>
			
			<ul id="toc-New_session-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Nested_namespaces" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Nested_namespaces">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.6</span>Nested namespaces</div>
			</a>
			
			<ul id="toc-Nested_namespaces-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Bubblewrap</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Bubblewrap" title="Bubblewrap – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Bubblewrap/Examples.html" title="Bubblewrap/Examples">Bubblewrap/Examples</a></li>
<li><a href="../en/Security.html" title="Security">Security</a></li>
<li><a href="../en/Firejail.html" title="Firejail">Firejail</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://github.com/containers/bubblewrap">Bubblewrap</a> is a lightweight sandbox application used by <a href="../en/Flatpak.html" title="Flatpak">Flatpak</a> and other container tools. It has a small installation footprint and minimal resource requirements. While the package is named bubblewrap, the actual command-line interface is <span class="plainlinks archwiki-template-man" title="$ man 1 bwrap"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/bwrap.1">bwrap(1)</a></span>. Notable features include support for cgroup/IPC/mount/network/PID/user/UTS <a href="https://en.wikipedia.org/wiki/Linux_namespaces" class="extiw" title="wikipedia:Linux namespaces">namespaces</a> and <a href="https://en.wikipedia.org/wiki/Seccomp" class="extiw" title="wikipedia:Seccomp">seccomp</a> filtering. Note that bubblewrap drops all <a href="../en/Capabilities.html" title="Capabilities">capabilities</a> within a sandbox and that child tasks cannot gain greater privileges than its parent. Notable feature exclusions include the lack of explicit support for blacklisting/whitelisting file paths. 
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Bubblewrap is a tool which provides sandboxing technologies like namespaces and seccomp filter. It does not by default provide a full sandbox that isolates weakpoints like the X11 window system (see <a href="#Sandboxing_X11">#Sandboxing X11</a>). Running untrusted code is never safe, sandboxing cannot change this.</div>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bubblewrap">bubblewrap</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/bubblewrap-git/">bubblewrap-git</a></span><sup><small>AUR</small></sup>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>For information about <span class="plainlinks archwiki-template-man" title="$ man 7 user_namespaces"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/user_namespaces.7">user_namespaces(7)</a></span> support in Arch Linux kernels see <a href="../en/Security.html#Sandboxing_applications" title="Security">Security#Sandboxing applications</a>.</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-hardened">linux-hardened</a></span> users may need to install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bubblewrap-suid">bubblewrap-suid</a></span> instead of the packages mentioned above. See <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/63316">FS#63316</a> for more information.</li>
</ul>
</div>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>Bubblewrap can be called directly from the command-line and/or within <a rel="nofollow" class="external text" href="https://github.com/containers/bubblewrap/blob/main/demos/bubblewrap-shell.sh">shell scripts</a> as part of a <a rel="nofollow" class="external text" href="https://github.com/containers/bubblewrap/blob/main/demos/flatpak-run.sh">complex wrapper</a>. Unlike applications such as <a href="../en/Firejail.html" title="Firejail">Firejail</a> which automatically set <code>/var</code> and <code>/etc</code> to read-only within the sandbox, Bubblewrap makes no such operating assumptions. It is up to the user to determine which configuration options to pass in accordance to the application being sandboxed. Bubblewrap does not automatically create user namespaces when running with setuid privileges and can accommodate typical environment variables including <code>$HOME</code> and <code>$USER</code>.
</p>
<p>It is highly recommended that you download <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=strace">strace</a></span> to see what files the program you are trying to sandbox needs access to.
</p>
<h2><span class="mw-headline" id="Configuration_managers_for_bubblewrap">Configuration managers for bubblewrap</span></h2>
<p>Instead of manually setting up the arguments a configuration manager can be used that configure bubblewrap automatically from a simpler configuration.
</p>
<ul><li>
<b><a href="../en/Bubblejail.html" title="Bubblejail">Bubblejail</a></b> — Bubblewrap-based sandbox with resource-based permission model (provides GUI to tweak permissions).</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/igo95862/bubblejail">https://github.com/igo95862/bubblejail</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/bubblejail/">bubblejail</a></span><sup><small>AUR</small></sup>
</dd></dl>
<h2><span class="mw-headline" id="Usage_examples">Usage examples</span></h2>
<p>Please see <a href="../en/Bubblewrap/Examples.html" title="Bubblewrap/Examples">/Examples</a> for examples on how bubblewrap can be used.
Alternatively, there are various projects that demonstrate how bubblewrap can be used for common applications:
</p>
<ul>
<li><a rel="nofollow" class="external text" href="https://github.com/valoq/bwscripts/">bwscripts</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/StandingPadAnimations/sandboxing-scripts">StandingPad's Bubblewrap scripts</a></li>
</ul>
<h3><span class="mw-headline" id="No-op">No-op</span></h3>
<p>A no-op bubblewrap invocation is as follows:
</p>
<pre>$ bwrap --dev-bind / / bash
</pre>
<p>This will spawn a <a href="../en/Bash.html" title="Bash">Bash</a> process which should behave exactly as outside a sandbox in most cases. If a sandboxed program misbehaves, you may want to start from the above no-op invocation, and work your way towards a more secure configuration step-by-step.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This operation will modify all the owner and group to <code>nobody</code> if the owner or group is not the current one, which suggests running some program like <code>sudo</code> will not work properly.</div>
<h3><span class="mw-headline" id="Bash">Bash</span></h3>
<p>Create a simple <a href="../en/Bash.html" title="Bash">Bash</a> sandbox: 
</p>
<ul><li>Determine available kernel namespaces</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ls /proc/self/ns</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">cgroup  ipc  mnt  net  pid  user uts
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The presence of <code>user</code> indicates that the kernel has exposed support for user namespaces with <code>CONFIG_USER_NS=y</code>
</div>
<ul>
<li>Bind as read-only the entire host <code>/</code> directory to <code>/</code> in the sandbox</li>
<li>Create a new user namespace and set the <a href="https://en.wikipedia.org/wiki/User_identifier" class="extiw" title="wikipedia:User identifier">user ID</a> to <code>256</code> and the <a href="https://en.wikipedia.org/wiki/Group_identifier" class="extiw" title="wikipedia:Group identifier">group ID</a> to <code>512</code>
</li>
</ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ bwrap --ro-bind / / --unshare-user --uid 256 --gid 512 bash</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">bash-4.4$ id
uid=256 gid=512 groups=512,65534(nobody)
bash-4.4$ ls -l /usr/bin/bash
-rwxr-xr-x 1 nobody nobody 811752 2017-01-01 04:20 /usr/bin/bash</pre>
<h3><span class="mw-headline" id="Desktop_entries">Desktop entries</span></h3>
<p>Leverage Bubblewrap within <a href="../en/Desktop_entries.html" title="Desktop entries">desktop entries</a>:
</p>
<ul>
<li>Bind as read-write the entire host <code>/</code> directory to <code>/</code> in the sandbox</li>
<li>Re-bind as read-only the <code>/var</code> and <code>/etc</code> directories in the sandbox</li>
<li>Mount a new devtmpfs filesystem to <code>/dev</code> in the sandbox</li>
<li>Create a tmpfs filesystem over the sandboxed <code>/run</code> directory</li>
<li>Disable network access by creating new network namespace</li>
</ul>
<pre>[Desktop Entry]
Name=nano Editor
Exec=bwrap --bind / / --dev /dev --tmpfs /run --unshare-net  st -e nano -o . %f
Type=Application
MimeType=text/plain;
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <code>--dev /dev</code> is required to write to <code>/dev/pty</code>
</div>
<ul><li>Example MuPDF desktop entry incorporating a <code>mupdf.sh</code> shell wrapper:</li></ul>
<pre>[Desktop Entry]
Name=MuPDF
Exec=mupdf.sh %f
Icon=application-pdf.svg
Type=Application
MimeType=application/pdf;application/x-pdf;
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Ensure that <code>mupdf.sh</code> is located within your executable PATH e.g. <code>PATH=$PATH:$HOME/bwrap</code>
</div>
<h3><span class="mw-headline" id="Filesystem_isolation">Filesystem isolation</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> It is the bubblewrap user’s responsibility to update the filesystem trees regularly.</div>
<p>To further hide the contents of the file system (such as those in <code>/var</code>, <code>/usr/bin</code> and <code>/usr/lib</code>) and to sandbox even the installation of software, pacman can be made to install Arch packages into isolated filesystem trees.
</p>
<p>In order to use pacman for installing software into the filesystem trees, you will need to install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fakeroot">fakeroot</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fakechroot">fakechroot</a></span>.
</p>
<p>Suppose you want to install the <code>xterm</code> package with pacman into an isolated filesystem tree. You should prepare your tree like this:
</p>
<pre>$ MYPACKAGE=xterm
$ mkdir -p ~/sandboxes/${MYPACKAGE}/files/var/lib/pacman
$ mkdir -p ~/sandboxes/${MYPACKAGE}/files/etc
$ cp /etc/pacman.conf ~/sandboxes/${MYPACKAGE}/files/etc/pacman.conf
</pre>
<p>You may want to edit <code>~/sandboxes/${MYPACKAGE}/files/etc/pacman.conf</code> and adjust the pacman configuration used:
</p>
<ul>
<li>Remove any undesired custom repositories and <code>IgnorePkg</code>, <code>IgnoreGroup</code>, <code>NoUpgrade</code> and <code>NoExtract</code> settings that are needed only for the host system.</li>
<li>You may need to remove the <code>CheckSpace</code> option so pacman will not complain about errors finding the root filesystem for checking disk space.</li>
</ul>
<p>Then install the <code>base</code> group along with the needed fakeroot into the isolated filesystem tree:
</p>
<pre>$ fakechroot fakeroot pacman -Syu \
    --root ~/sandboxes/${MYPACKAGE}/files \
    --dbpath ~/sandboxes/${MYPACKAGE}/files/var/lib/pacman \
    --config ~/sandboxes/${MYPACKAGE}/files/etc/pacman.conf \
    base fakeroot
</pre>
<p>Since you will be repeatedly calling bubblewrap with the same options, make an alias:
</p>
<pre>$ alias bw-install='bwrap                        \
     --bind ~/sandboxes/${MYPACKAGE}/files/ /    \
     --ro-bind /etc/resolv.conf /etc/resolv.conf \
     --tmpfs /tmp                                \
     --proc /proc                                \
     --dev /dev                                  \
     --chdir /                                   '
</pre>
<p>You will need to set up the <a href="../en/Locale.html" title="Locale">locales</a> by <a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Textedit">editing</a> <code>~/sandboxes/${MYPACKAGE}/files/etc/locale.gen</code> and running: 
</p>
<pre>$ bw-install locale-gen
</pre>
<p>Then set up pacman’s keyring:
</p>
<pre>$ bw-install fakeroot pacman-key --init
$ bw-install fakeroot pacman-key --populate
</pre>
<p>Now you can install the desired <code>xterm</code> package.
</p>
<pre>$ bw-install fakeroot pacman -S ${MYPACKAGE}
</pre>
<p>If the pacman command fails here, try running the command for populating the keyring again.
</p>
<p>Congratulations. You now have an isolated filesystem tree containing <code>xterm</code>. You can use <code>bw-install</code> again to upgrade your filesystem tree.
</p>
<p>You can now run your software with bubblewrap. <code><i>command</i></code> should be <code>xterm</code> in this case.
</p>
<pre>$ bwrap                                          \
     --ro-bind ~/sandboxes/${MYPACKAGE}/files/ / \
     --ro-bind /etc/resolv.conf /etc/resolv.conf \
     --tmpfs /tmp                                \
     --proc /proc                                \
     --dev /dev                                  \
     --chdir /                                   \
     <i>command</i>
</pre>
<p>Note that some files can be shared between packages. You can hardlink to all files of an existing parent filesystem tree to reuse them in a new tree:
</p>
<pre>$ cp -al ~/sandboxes/${MYPARENTPACKAGE} ~/sandboxes/${MYPACKAGE}
</pre>
<p>Then proceed with the installation as usual by calling pacman from <code>bw-install fakechroot fakeroot pacman ...</code>.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Using_X11">Using X11</span></h3>
<p>Bind mounting the host X11 socket to an alternative X11 socket may not work:
</p>
<pre>--bind /tmp/.X11-unix/X0 /tmp/.X11-unix/X8 --setenv DISPLAY :8
</pre>
<p>A workaround is to bind mount the host X11 socket to the same socket within the sandbox:
</p>
<pre>--bind /tmp/.X11-unix/X0 /tmp/.X11-unix/X0 --setenv DISPLAY :0
</pre>
<h3><span class="mw-headline" id="Sandboxing_X11">Sandboxing X11</span></h3>
<p>While bwrap provides some very nice isolation for sandboxed application, there is an easy escape as long as access to the X11 socket is available.
X11 does not include isolation between applications and is completely insecure. The only solution to this is to switch to a Wayland compositor with no access to the Xserver from the sandbox.
</p>
<p>There are however some workarounds that use <a href="../en/Xpra.html" title="Xpra">xpra</a> or <a href="../en/Xephyr.html" title="Xephyr">xephyr</a> to run in a new X11 environment. This would work with bwrap as well.
</p>
<p>To test X11 isolation, run <code>xinput test <i>id</i></code> (the keyboard id can be found with <code>xinput list</code>).
When run without additional X11 isolation, this will show that any application with X11 access can capture keyboard input of any other application, which is basically what a keylogger would do.
</p>
<p>The optimal solution to eliminate the X11 weak point is to switch to a Wayland compositor.
</p>
<h3><span class="mw-headline" id="Using_portals">Using portals</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Merge-arrows-2.svg" decoding="async" width="36" height="40" class="mw-file-element"></span></span><b>This article or section is a candidate for merging with <a href="../en/XDG_Desktop_Portal.html" title="XDG Desktop Portal">XDG Desktop Portal</a>.</b></p>
<div>
<b>Notes:</b> There is a dedicated page. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Bubblewrap.html">Talk:Bubblewrap</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong>  This takes advantage of workarounds that "trick" <code>xdg-desktop-poral</code> into thinking a sandboxed program is a Flatpak. As a reminder, running untrusted code is never safe, even in a sandbox, even with Portals</div>
<p><a rel="nofollow" class="external text" href="https://github.com/flatpak/xdg-desktop-portal/pull/741#issuecomment-1084218429%7C">With workarounds</a>, it is possible to sandbox programs with <a href="../en/XDG_Desktop_Portal.html" title="XDG Desktop Portal">XDG Desktop Portals</a>. The main advantage is with filesystem portals, as it makes it possible to not give a program access to the home directory, but still be able to access files. <a rel="nofollow" class="external text" href="https://github.com/flatpak/xdg-desktop-portal/pull/741#issuecomment-1081909119%7C">For security reasons</a> however, using portals requires tricking <code>xdg-desktop-portal</code> into thinking a sandboxed program is part of a Flatpak. This can be done by adding a <code>.flatpak-info</code> file to the sandbox's root filesystem.
</p>
<p>In addition, one also needs to run <code>xdg-dbus-proxy</code> for more fine control over what portals can be accessed. This should be ran in a sandboxed environment, and as such also needs a <code>.flatpak-info</code> file. At the minimum, the proxy needs to have talk access to <code>org.freedesktop.portal.Flatpak</code>. Additional portals can be found <a rel="nofollow" class="external text" href="https://docs.flatpak.org/en/latest/portal-api-reference.html">on the Flatpak documentation</a>.
</p>
<p>A common use case is to allow restricting a program from having 100% access to the home directory, and instead only giving access to files and folders the user selects in a file chooser. To achieve this, <code>xdg-dbus-proxy</code> can be started with the following arguments:
</p>
<pre>--talk=org.freedesktop.portal.Documents
--talk=org.freedesktop.portal.Flatpak
--talk=org.freedesktop.portal.Desktop
--talk=org.freedesktop.portal.FileChooser
</pre>
<p>Full example:
</p>
<pre>APP_NAME=app.application.Name
APP_FOLDER="$XDG_RUNTIME_DIR/app/$APP_NAME"
mkdir -p "$APP_FOLDER"
set_up_dbus_proxy() {
 bwrap \
   --new-session \
   --symlink /usr/lib64 /lib64 \
   --ro-bind /usr/lib /usr/lib \
   --ro-bind /usr/lib64 /usr/lib64 \
   --ro-bind /usr/bin /usr/bin \
   --bind "$XDG_RUNTIME_DIR" "$XDG_RUNTIME_DIR" \
   --ro-bind-data 3 "/.flatpak-info" \
   --die-with-parent \
   -- \
   env -i xdg-dbus-proxy \
   "$DBUS_SESSION_BUS_ADDRESS" \
   "$APP_FOLDER/bus" \
   --filter \
   --log \
   --talk=org.freedesktop.portal.Flatpak \
   --call="org.freedesktop.portal.Desktop=org.freedesktop.portal.Settings.Read@/org/freedesktop/portal/desktop" \
   --broadcast="org.freedesktop.portal.Desktop=org.freedesktop.portal.Settings.SettingChanged@/org/freedesktop/portal/desktop" 3&lt;&lt;EOF
[Application]
name=$APP_NAME
EOF
}

set_up_dbus_proxy &amp;
sleep 0.1

bwrap \
  ...
  --ro-bind-data 3 /.flatpak-info \
  ...
  3&lt;&lt;EOF
[Application]
name=$APP_NAME
EOF
</pre>
<h3><span class="mw-headline" id="Opening_URLs_from_wrapped_applications">Opening URLs from wrapped applications</span></h3>
<p>When a wrapped IRC or email client attempts to open a URL, it will usually attempt to launch a browser process, which will run within the same sandbox as the wrapped application. With a well-wrapped application, this will likely not work. The approach used by <a href="../en/Firejail.html" title="Firejail">Firejail</a> is to <a rel="nofollow" class="external text" href="https://github.com/netblue30/firejail/blob/b1479a3730a361221c271226cc56d0724ee109c4/etc/thunderbird.profile#L31-L33">give wrapped applications all the privileges of the browser as well</a>, however this implies a good amount of permission creep.
</p>
<p>A better solution to this problem is to communicate opened URLs to outside the sandbox. This can be done using <code>snapd-xdg-open</code> as follows:
</p>
<ol>
<li>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snapd-xdg-open-git/">snapd-xdg-open-git</a></span><sup><small>AUR</small></sup>
</li>
<li>On your <code>bwrap</code> command line, add:</li>
</ol>
<pre>$ bwrap ... \
  --ro-bind /run/user/$UID/bus /run/user/$UID/bus \
  --ro-bind /usr/lib/snapd-xdg-open/xdg-open /usr/bin/xdg-open \
  --ro-bind /usr/lib/snapd-xdg-open/xdg-open /usr/bin/chromium \
  ...
</pre>
<p>The <code>/usr/bin/chromium</code> bind is only necessary for programs not using XDG conventions, such as Mozilla Thunderbird.
</p>
<h3><span class="mw-headline" id="New_session">New session</span></h3>
<p>There is a security issue with TIOCSTI, (CVE-2017-5226) which allows sandbox escape.
To prevent this, bubblewrap has introduced the new option '--new-session' which calls setsid(). 
However, this causes some behavioural issues that are hard to work with in some cases. 
For instance, it makes shell job control not work for the bwrap command.
</p>
<p>It is recommended to use this if possible, but if not the developers recommend that the issue is neutralized in some other way, for instance using SECCOMP, which is what flatpak does:
<a rel="nofollow" class="external free" href="https://github.com/flatpak/flatpak/commit/902fb713990a8f968ea4350c7c2a27ff46f1a6c4">https://github.com/flatpak/flatpak/commit/902fb713990a8f968ea4350c7c2a27ff46f1a6c4</a>
</p>
<h3><span class="mw-headline" id="Nested_namespaces">Nested namespaces</span></h3>
<p>Certain applications such as <a href="../en/Chromium.html" title="Chromium">Chromium</a> already implement their own sandbox environment using suid helper files. This mechanism will be blocked when they are executed inside a bubblewrap container.
</p>
<p>One solution is to have the application use the namespace created by bubblewrap. This can be achieved through <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zypak/">zypak</a></span><sup><small>AUR</small></sup> which is also used by flatpak to run electron based apps inside an additional namespace. Example code that demonstrates how to use zypak with Chromium/<a href="../en/Electron.html" title="Electron">Electron</a> can be found at <a rel="nofollow" class="external autonumber" href="https://github.com/valoq/bwscripts/blob/master/profiles/signal-desktop">[1]</a>.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://github.com/containers/bubblewrap">GitHub repository</a></li>
<li><a rel="nofollow" class="external text" href="https://docs.kernel.org/userspace-api/seccomp_filter.html">Seccomp BPF (SECure COMPuting with filters)</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/valoq/bwscripts">Additional bubblewrap examples</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Sandboxing.html" title="Category:Sandboxing">Sandboxing</a></li>
<li><a href="../en/Category:Kernel.html" title="Category:Kernel">Kernel</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Bubblewrap&amp;oldid=806422">https://wiki.archlinux.org/index.php?title=Bubblewrap&amp;oldid=806422</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 19 April 2024, at 09:21.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
