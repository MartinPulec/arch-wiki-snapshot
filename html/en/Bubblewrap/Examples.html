<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Bubblewrap/Examples - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Bubblewrap_Examples rootpage-Bubblewrap skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-dhcpcd" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#dhcpcd">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>dhcpcd</div>
		</a>
		
		<ul id="toc-dhcpcd-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Unbound" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Unbound">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Unbound</div>
		</a>
		
		<ul id="toc-Unbound-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-MuPDF" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#MuPDF">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>MuPDF</div>
		</a>
		
		<ul id="toc-MuPDF-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-p7zip" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#p7zip">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>p7zip</div>
		</a>
		
		<ul id="toc-p7zip-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Firefox" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Firefox">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Firefox</div>
		</a>
		
			<button aria-controls="toc-Firefox-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Firefox subsection</span>
			</button>
		
		<ul id="toc-Firefox-sublist" class="vector-toc-list">
			<li id="toc-Enhancing_privacy" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enhancing_privacy">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Enhancing privacy</div>
			</a>
			
			<ul id="toc-Enhancing_privacy-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Chromium" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Chromium">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Chromium</div>
		</a>
		
		<ul id="toc-Chromium-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Skype_for_Linux" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Skype_for_Linux">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Skype for Linux</div>
		</a>
		
		<ul id="toc-Skype_for_Linux-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Steam" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Steam">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>Steam</div>
		</a>
		
		<ul id="toc-Steam-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-NPM,_Node_Version_Manager_(NVM),_Maven_Java" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#NPM,_Node_Version_Manager_(NVM),_Maven_Java">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">9</span>NPM, Node Version Manager (NVM), Maven Java</div>
		</a>
		
		<ul id="toc-NPM,_Node_Version_Manager_(NVM),_Maven_Java-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Bubblewrap/Examples</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Bubblewrap/%E4%BE%8B" title="Bubblewrap/例 – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <a href="../../en/Bubblewrap.html" title="Bubblewrap">Bubblewrap</a>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="dhcpcd">dhcpcd</span></h2>
<p>Create a simple <a href="../../en/Dhcpcd.html" title="Dhcpcd">dhcpcd</a> sandbox:
</p>
<ul><li>Determine available kernel namespaces</li></ul>
<pre>$ ls /proc/self/ns 
cgroup  ipc  mnt  net  pid  uts
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The absence of <code>user</code> indicates that the kernel has been built with <code>CONFIG_USER_NS=n</code> or is user namespace restricted.</div>
<ul>
<li>Bind as read-write the entire host <code>/</code> directory to <code>/</code> in the sandbox</li>
<li>Mount a new devtmpfs filesystem to <code>/dev</code> in the sandbox</li>
<li>Create new <a href="https://en.wikipedia.org/wiki/Inter-process_communication" class="extiw" title="wikipedia:Inter-process communication">IPC</a> and <a href="../../en/Cgroups.html" class="mw-redirect" title="Control group">control group</a> namespaces</li>
<li>Create a new UTS namespace and set <code>dhcpcd</code> as the hostname</li>
</ul>
<pre># /usr/bin/bwrap --bind / / --dev /dev --unshare-ipc --unshare-cgroup --unshare-uts --hostname dhcpcd /usr/bin/dhcpcd -q -b
</pre>
<h2><span class="mw-headline" id="Unbound">Unbound</span></h2>
<p>Create a more granular and complex <a href="../../en/Unbound.html" title="Unbound">Unbound</a> sandbox: 
</p>
<ul>
<li>Bind as read-only the system <code>/usr</code> directory to <code>/usr</code> in the sandbox</li>
<li>Create a symbolic link from the system <code>/usr/lib</code> directory to <code>/lib64</code> in the sandbox</li>
<li>Bind as read-only the system <code>/etc</code> directory to <code>/etc</code> in the sandbox</li>
<li>Create empty <code>/var</code> and <code>/run</code> directories within the sandbox</li>
<li>Mount a new devtmpfs filesystem to <code>/dev</code> in the sandbox</li>
<li>Create new IPC and <a href="https://en.wikipedia.org/wiki/Process_identifier" class="extiw" title="wikipedia:Process identifier">PID</a> and control group namespaces</li>
<li>Create a new UTS namespace and set <code>unbound</code> as the hostname</li>
</ul>
<pre># /usr/bin/bwrap --ro-bind /usr /usr --symlink usr/lib /lib64 --ro-bind /etc /etc --dir /var --dir /run --dev /dev --unshare-ipc --unshare-pid --unshare-cgroup --unshare-uts --hostname unbound /usr/bin/unbound -d
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> See <a href="../../en/Systemd.html#Editing_provided_units" title="Systemd">systemd#Editing provided units</a> to enable the bubblewrapping of systemd unit files including <code>unbound.service</code>
</div>
<h2><span class="mw-headline" id="MuPDF">MuPDF</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Forwarding the X11 socket may lead to a sandbox escape (Discuss in <a rel="nofollow" class="external text" href="../../en/Talk:Bubblewrap/Examples.html">Talk:Bubblewrap/Examples</a>)</div>
</div>
<p>The power and flexibility of <i>bwrap</i> is best revealed when used to create an environment within a shell wrapper:
</p>
<ul>
<li>Bind as read-only the host <code>/usr/bin</code> directory to <code>/usr/bin</code> in the sandbox</li>
<li>Bind as read-only the host <code>/usr/lib</code> directory to <code>/usr/lib</code> in the sandbox</li>
<li>Create a symbolic link from the system <code>/usr/lib</code> directory to <code>/lib64</code> in the sandbox</li>
<li>Create a <a href="../../en/Tmpfs.html" title="Tmpfs">tmpfs</a> filesystem overlaying <code>/usr/lib/gcc</code> in the sandbox
<ul><li>This effectively <a href="https://en.wikipedia.org/wiki/Blacklist_(computing)" class="extiw" title="wikipedia:Blacklist (computing)">blacklists</a> the contents of <code>/usr/lib/gcc</code> from appearing in the sandbox</li></ul>
</li>
<li>Create a new tmpfs filesystem as the <code>$HOME</code> directory in the sandbox</li>
<li>Bind as read-only an <code>.Xauthority</code> file and <i>Documents</i> directory into the sandbox
<ul><li>This effectively whitelists the <code>.Xauthority</code> file and <i>Documents</i> directory with recursion</li></ul>
</li>
<li>Create a new tmpfs filesystem as the <code>/tmp</code> directory in the sandbox</li>
<li>Whitelist the <a href="https://en.wikipedia.org/wiki/X_Window_System" class="extiw" title="wikipedia:X Window System">X11</a> socket by binding it into the sandbox as read-only</li>
<li>Clone and create private containers for all namespaces supported by the running kernel
<ul><li>If the kernel does not support non-privileged user namespaces, skip its creation and continue</li></ul>
</li>
<li>Do not place network components into a private namespace
<ul><li>This allows for network access to follow URI hyperlinks</li></ul>
</li>
</ul>
<pre>#!/bin/sh
#~/bwrap/mupdf.sh
(exec bwrap \
--ro-bind /usr/bin /usr/bin \
--ro-bind /usr/lib /usr/lib \
--symlink usr/lib /lib64 \
--tmpfs /usr/lib/gcc \
--tmpfs $HOME \
--ro-bind $HOME/.Xauthority $HOME/.Xauthority \
--ro-bind $HOME/Documents $HOME/Documents \
--tmpfs /tmp \
--ro-bind /tmp/.X11-unix/X0 /tmp/.X11-unix/X0 \
 --unshare-all \
--share-net \
/usr/bin/mupdf "$@")
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Execute a shell wrapper substituting the existing executable with <i>/usr/bin/sh</i> to debug and verify the contents and filesystem structure of the sandbox.</div>
<pre>$ bwrap \
--ro-bind /usr/bin /usr/bin \
--ro-bind /usr/lib /usr/lib \
--symlink usr/lib /lib64 \
--tmpfs /usr/lib/gcc \
--tmpfs $HOME \
--ro-bind $HOME/.Xauthority $HOME/.Xauthority \
--ro-bind $HOME/Desktop $HOME/Desktop \
--tmpfs /tmp \
--ro-bind /tmp/.X11-unix/X0 /tmp/.X11-unix/X0 \
--unshare-all \
--share-net \
 /usr/bin/sh
bash-4.4$ ls -AF
.Xauthority  Documents/
</pre>
<p>Perhaps the most important rule to consider when building a bubblewrapped filesystem is that <i>commands are executed in the order they appear</i>. From the <a rel="nofollow" class="external text" href="https://mupdf.com/">MuPDF</a> example above:
</p>
<ul><li>A tmpfs system is created followed by the bind mounting of an <code>.Xauthority</code> file and a <i>Documents</i> directory:</li></ul>
<pre>--tmpfs $HOME \
--ro-bind $HOME/.Xauthority $HOME/.Xauthority \
--ro-bind $HOME/Documents $HOME/Documents \
</pre>
<pre>bash-4.4$ ls -a
.  ..  .Xauthority  Desktop
</pre>
<ul><li>A tmpfs filesystem is created after the bind mounting of <code>.Xauthority</code> and overlays it so that only the <i>Documents</i> directory is visible within the sandbox:</li></ul>
<pre>--ro-bind $HOME/.Xauthority $HOME/.Xauthority \
--tmpfs $HOME \
--ro-bind $HOME/Desktop $HOME/Desktop \
</pre>
<pre>bash-4.4$ ls -a
.  ..  Desktop
</pre>
<h2><span class="mw-headline" id="p7zip">p7zip</span></h2>
<p>Applications which have not yet been patched against <a rel="nofollow" class="external text" href="https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2016-9296">known vulnerabilities</a> constitute prime candidates for bubblewrapping:
</p>
<ul>
<li>Bind as read-only the host <code>/usr/bin/7za</code> executable path to the sandbox</li>
<li>Create a symbolic link from the system <code>/usr/lib</code> directory to <code>/lib64</code> in the sandbox</li>
<li>Blacklist the sandboxed contents of <code>/usr/lib/modules</code> and <code>/usr/lib/systemd</code> with tmpfs overlays</li>
<li>Mount a new devtmpfs filesystem to <code>/dev</code> in the sandbox</li>
<li>Bind as read-write the host <code>/sandbox</code> directory to the <code>/sandbox</code> directory in the sandbox
<ul><li>
<i>7za</i> will only run in the host <code>/sandbox</code> directory and/or its subdirectories when called from the shell wrapper</li></ul>
</li>
<li>Create new cgroup/IPC/network/PID/UTS namespaces for the application and its processes
<ul>
<li>If the kernel does not support non-privileged user namespaces, skip its creation and continue</li>
<li>Creation of a new network namespace prevents the sandbox from obtaining network access</li>
</ul>
</li>
<li>Add a custom or an arbitrary <a href="../../en/Network_configuration.html#Set_the_hostname" class="mw-redirect" title="Hostname">hostname</a> to the sandbox such as <code>p7zip</code>
</li>
<li>Unset the <code>XAUTHORITY</code> <a href="../../en/Environment_variables.html" class="mw-redirect" title="Environment variable">environment variable</a> to hide the location of the X11 connection cookie
<ul><li>
<i>7za</i> does not need to connect to an X11 display server to function properly</li></ul>
</li>
<li>Start a new terminal session to prevent keyboard input from escaping the sandbox</li>
</ul>
<pre>#!/bin/sh
#~/bwrap/pz7ip.sh
(exec bwrap \
--ro-bind /usr/bin/7za /usr/bin/7za \
--symlink usr/lib /lib64 \
--tmpfs /usr/lib/modules \
--tmpfs /usr/lib/systemd \
--dev /dev \
--bind /sandbox /sandbox \
--unshare-all \
--hostname p7zip \
--unsetenv XAUTHORITY \
--new-session \
/usr/bin/7za "$@")
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <i>/usr/bin/sh</i> and <i>/usr/bin/ls</i> must reside in the executable path in order to traverse and verify the sandbox filesystem.</div>
<pre>bwrap \
--ro-bind /usr/bin/7za /usr/bin/7za \
<b>--ro-bind /usr/bin/ls /usr/bin/ls \</b>
<b>--ro-bind /usr/bin/sh /usr/bin/sh \</b>
--symlink usr/lib /lib64 \
--tmpfs /usr/lib/modules \
--tmpfs /usr/lib/systemd \
--dev /dev \
--bind /sandbox /sandbox \
--unshare-all \
--hostname p7zip \
--unsetenv XAUTHORITY \
--new-session \
/usr/bin/sh
bash: no job control in this shell
bash-4.4$ ls -AF         
dev/  lib64@  usr/
bash-4.4$ ls -l /usr/lib/modules 
total 0
bash-4.4$ ls -l /usr/lib/systemd
total 0
bash-4.4$ ls -AF /dev
console  full  null  ptmx@  pts/  random  shm/  stderr@  stdin@  stdout@  tty  urandom  zero
bash-4.4$ ls -A /usr/bin
7za  ls  sh
</pre>
<h2><span class="mw-headline" id="Firefox">Firefox</span></h2>
<p>Network facing applications with large surface attack areas are also ideal candidates to be bubblewrapped:
</p>
<ul>
<li>
<a href="../../en/Transmission.html" title="Transmission">Transmission</a> included in the sandbox to launch with magnet and torrent links</li>
<li>Example wrap supports audio (<a href="../../en/PulseAudio.html" title="PulseAudio">PulseAudio</a>) and printing (<a href="../../en/CUPS.html" title="CUPS">CUPS</a>/<a href="../../en/Avahi.html" title="Avahi">Avahi</a>) under <a href="../../en/GNOME.html" title="GNOME">GNOME</a> (<a href="../../en/Wayland.html" title="Wayland">Wayland</a>)
<ul><li>Paths in <code>~/.config/transmission/settings.json</code> should reflect the <code>--setenv HOME</code> variable</li></ul>
</li>
<li>Full paths are used to allow for keyboard bindings in environments which do not support variable expansion.</li>
<li>
<a href="../../en/Firefox.html#Hardware_video_acceleration" title="Firefox">WebRenderer</a> and hardware (accelerated) compositing support included</li>
</ul>
<pre> bwrap \
--symlink usr/lib /lib \
--symlink usr/lib64 /lib64 \
--symlink usr/bin /bin \
--symlink usr/bin /sbin \
--ro-bind /usr/lib /usr/lib \
--ro-bind /usr/lib64 /usr/lib64 \
--ro-bind /usr/bin /usr/bin \
--ro-bind /usr/lib/firefox /usr/lib/firefox \
--ro-bind /usr/share/applications /usr/share/applications \
--ro-bind /usr/share/gtk-3.0 /usr/share/gtk-3.0 \
--ro-bind /usr/share/fontconfig /usr/share/fontconfig \
--ro-bind /usr/share/icu /usr/share/icu \
--ro-bind /usr/share/drirc.d /usr/share/drirc.d \
--ro-bind /usr/share/fonts /usr/share/fonts \
--ro-bind /usr/share/glib-2.0 /usr/share/glib-2.0 \
--ro-bind /usr/share/glvnd /usr/share/glvnd \
--ro-bind /usr/share/icons /usr/share/icons \
--ro-bind /usr/share/libdrm /usr/share/libdrm \
--ro-bind /usr/share/mime /usr/share/mime \
--ro-bind /usr/share/X11/xkb /usr/share/X11/xkb \
--ro-bind /usr/share/icons /usr/share/icons \
--ro-bind /usr/share/mime /usr/share/mime \
--ro-bind /etc/fonts /etc/fonts \
--ro-bind /etc/resolv.conf /etc/resolv.conf \
--ro-bind /usr/share/ca-certificates /usr/share/ca-certificates \
--ro-bind /etc/ssl /etc/ssl \
--ro-bind /etc/ca-certificates /etc/ca-certificates \
--dir "$XDG_RUNTIME_DIR" \
--ro-bind "$XDG_RUNTIME_DIR/pulse" "$XDG_RUNTIME_DIR/pulse" \
--ro-bind "$XDG_RUNTIME_DIR/wayland-1" "$XDG_RUNTIME_DIR/wayland-1" \
--dev /dev \
--dev-bind /dev/dri /dev/dri \
--ro-bind /sys/dev/char /sys/dev/char \
--ro-bind /sys/devices/pci0000:00 /sys/devices/pci0000:00 \
--proc /proc \
--tmpfs /tmp \
--bind /home/example/.mozilla /home/example/.mozilla \
--bind /home/example/.config/transmission /home/example/.config/transmission \
--bind /home/example/Downloads /home/example/Downloads \
--setenv HOME /home/example \
--setenv GTK_THEME Adwaita:dark \
--setenv MOZ_ENABLE_WAYLAND 1 \
--setenv PATH /usr/bin \
--hostname RESTRICTED \
--unshare-all \
--share-net \
--die-with-parent \
--new-session \
/usr/bin/firefox
</pre>
<h3><span class="mw-headline" id="Enhancing_privacy">Enhancing privacy</span></h3>
<ul><li>Further restrictions can be made by removing specific entries
<ul><li>Remove the following entry to remove audio support:</li></ul>
</li></ul>
<pre>--ro-bind "$XDG_RUNTIME_DIR/pulse" "$XDG_RUNTIME_DIR/pulse" \
</pre>
<ul><li>
<code>/sandbox</code> represents an arbitrary location defined by the user to hold desired profile information
<ul><li>This allows for the use of a <a href="../../en/Firefox/Privacy.html#Sanitized_profiles" title="Firefox/Privacy">sanitized profile</a> copied into <code>/sandbox</code> via a script/cron job or manually e.g.</li></ul>
</li></ul>
<pre>$ cp -pR ~/.mozilla /sandbox/
</pre>
<p>The location can be a network share, a USB mount, or a local filesystem or <a href="../../en/Firefox/Profile_on_RAM.html" title="Firefox/Profile on RAM">ramfs/tmpfs location</a>
</p>
<ul>
<li>Set <code>/home/r</code> to obscure the actual <code>/home/example</code>
</li>
<li>Set new user ID and group ID values</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Ensure that the selected UID and GID does not conflict with existing values listed in <code>/etc/passwd</code> and
<code>/etc/groups</code>.</div>
<pre>bwrap \
....
--bind /sandbox/.mozilla /home/r/.mozilla \
--bind /sandbox/Downloads /home/r/Downloads \
...
--setenv HOME /home/r \
...
--uid 200 --gid 400 \
...
/usr/bin/firefox --no-remote --private-window
</pre>
<h2><span class="mw-headline" id="Chromium">Chromium</span></h2>
<p>A simple chromium sandbox on wayland and with pipewire:
</p>
<pre>bwrap \
    --symlink usr/lib /lib \
    --symlink usr/lib64 /lib64 \
    --symlink usr/bin /bin \
    --symlink usr/bin /sbin \
    --ro-bind /usr/lib /usr/lib \
    --ro-bind /usr/lib64 /usr/lib64 \
    --ro-bind /usr/bin /usr/bin \
    --ro-bind /etc /etc \
    --ro-bind /usr/lib/chromium /usr/lib/chromium \
    --ro-bind /usr/share /usr/share \
    --dev /dev \
    --dev-bind /dev/dri /dev/dri \
    --proc /proc \
    --ro-bind /sys/dev/char /sys/dev/char \
    --ro-bind /sys/devices /sys/devices \
    --ro-bind /run/dbus /run/dbus \
    --dir "$XDG_RUNTIME_DIR" \
    --ro-bind "$XDG_RUNTIME_DIR/wayland-1" "$XDG_RUNTIME_DIR/wayland-1" \
    --ro-bind "$XDG_RUNTIME_DIR/pipewire-0" "$XDG_RUNTIME_DIR/pipewire-0" \
    --ro-bind "$XDG_RUNTIME_DIR/pulse" "$XDG_RUNTIME_DIR/pulse" \
    --tmpfs /tmp \
    --dir $HOME/.cache \
    --bind $HOME/.config/chromium $HOME/.config/chromium \
    --bind $HOME/Downloads $HOME/Downloads \
    /usr/bin/chromium --enable-features=UseOzonePlatform --ozone-platform=wayland</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If you are using the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-hardened">linux-hardened</a></span> kernel, you will not be able to use bubblewrap to sandbox chromium due to the <code>kernel.unprivileged_userns_clone</code> <a href="../../en/Sysctl.html" title="Sysctl">sysctl</a> being set to 0. You can set it to 1, however, this is not recommended <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/36969">FS#36969</a>.
<p>One alternative solution is to have chromium use the namespace created by bubblewrap. This can be achieved through  <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zypak/">zypak</a></span><sup><small>AUR</small></sup> which is also used by flatpak to run electron based apps inside an additional namespace. Example code that demonstrates how to use zypak with chromium/electron can be found <a rel="nofollow" class="external text" href="https://github.com/valoq/bwscripts/blob/master/profiles/signal-desktop">here</a>
</p>
</div>
<ul>
<li>
<a href="../../en/PipeWire.html" title="PipeWire">PipeWire</a>: <code>--ro-bind "$XDG_RUNTIME_DIR/pipewire-0" "$XDG_RUNTIME_DIR/pipewire-0" \</code>
<ul><li>If you are not using pipewire, feel free to remove this line</li></ul>
</li>
<li>
<code>--bind $HOME/.config/chromium $HOME/.config/chromium \</code> mounts your chromium configuration directory in the sandbox as readable and writable</li>
<li>
<code>--bind $HOME/Downloads $HOME/Downloads \</code> mounts your ~/Downloads directory in the sandbox as readable and writable</li>
<li>This example can be further improved for more isolation.</li>
</ul>
<h2><span class="mw-headline" id="Skype_for_Linux">Skype for Linux</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Forwarding the X11 and/or DBus sockets may lead to a sandbox escape (Discuss in <a rel="nofollow" class="external text" href="../../en/Talk:Bubblewrap/Examples.html">Talk:Bubblewrap/Examples</a>)</div>
</div>
<p>The following example provides these features:
</p>
<ul>
<li>
<code>env -i</code> ensures that all environment variables are unset.</li>
<li>Network is shared with the host (<code>--share-net</code>), <code>/etc/resolv.conf</code> is bind-mounted.</li>
<li>
<a href="../../en/Xorg.html" title="Xorg">Xorg</a> access: bind the <code>/tmp/.X11-unix/X0</code> socket, set <code>$DISPLAY</code>.</li>
<li>
<a href="../../en/D-Bus.html" title="D-Bus">D-Bus</a>: bind the <code>$XDG_RUNTIME_DIR/bus</code> socket, set <code>$DBUS_SESSION_BUS_ADDRESS</code>.</li>
<li>Audio: bind the <a href="../../en/PulseAudio.html" title="PulseAudio">PulseAudio</a> socket.</li>
<li>Video: dev-bind the <code>/dev/video0</code> device.</li>
</ul>
<p>The directory on the host where you want to keep the Skype profile can be configured with <code>$HOST_PROFILE_PATH</code>.
</p>
<pre>env -i bwrap \
    --ro-bind /usr /usr \
    --dir /home/r \
    --dir /tmp \
    --dir /var \
    --dir "$XDG_RUNTIME_DIR" \
    --proc /proc \
    --dev /dev \
    --symlink usr/lib /lib \
    --symlink usr/lib64 /lib64 \
    --symlink usr/bin /bin \
    --symlink usr/sbin /sbin \
    --symlink ../tmp /var/tmp \
    --bind "$HOST_PROFILE_PATH" /home/r/.config/skypeforlinux \
    --ro-bind /etc/resolv.conf /etc/resolv.conf \
    --ro-bind /tmp/.X11-unix/X0 /tmp/.X11-unix/X0 \
    --ro-bind "$XDG_RUNTIME_DIR/bus" "$XDG_RUNTIME_DIR/bus" \
    --ro-bind "$XDG_RUNTIME_DIR/pulse" "$XDG_RUNTIME_DIR/pulse" \
    --dev-bind /dev/video0 /dev/video0 \
    --chdir / \
    --unshare-all \
    --share-net \
    --hostname RESTRICTED \
    --die-with-parent \
    --new-session \
    --setenv PATH /usr/bin \
    --setenv HOME /home/r \
    --setenv XDG_RUNTIME_DIR "$XDG_RUNTIME_DIR" \
    --setenv DISPLAY "$DISPLAY" \
    --setenv DBUS_SESSION_BUS_ADDRESS "unix:path=$XDG_RUNTIME_DIR/bus" \
    /usr/bin/skypeforlinux</pre>
<h2><span class="mw-headline" id="Steam">Steam</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Forwarding the X11 and/or DBus sockets may lead to a sandbox escape (Discuss in <a rel="nofollow" class="external text" href="../../en/Talk:Bubblewrap/Examples.html">Talk:Bubblewrap/Examples</a>)</div>
</div>
<p>A simple Steam sandbox
</p>
<pre>#!/usr/bin/bash
set -e

STEAM_HOME="$HOME/.local/share/steam_sandbox"
RUN_USER="$XDG_RUNTIME_DIR"

mkdir -p "$STEAM_HOME"

_bind() {
	_bind_arg=$1
	shift
	for _path in "$@"; do
		args+=("$_bind_arg" "$_path" "$_path")
	done
}

bind() {
	_bind --bind-try "$@"
}

robind() {
	_bind --ro-bind-try "$@"
}

devbind() {
	_bind --dev-bind-try "$@"
}

args=(
	--tmpfs /tmp
	--proc /proc
	--dev /dev
	--dir /etc
	--dir /var
	--dir "$RUN_USER"
	--bind "$STEAM_HOME" "$HOME"
	--dir "$HOME"
	--dir "$XDG_CONFIG_HOME"
	--dir "$XDG_CACHE_HOME"
	--dir "$XDG_DATA_HOME"
	--dir "$XDG_STATE_HOME"
	--symlink /usr/lib /lib
	--symlink /usr/lib /lib64
	--symlink /usr/bin /bin
	--symlink /usr/bin /sbin
	--symlink /run /var/run
	--setenv XAUTHORITY "$XAUTHORITY"
)

robind \
	/usr \
	/etc \
	/opt \
	/sys \
	/var/empty \
	/var/lib/alsa \
	/var/lib/dbus \
	"$RUN_USER/systemd/resolve"

devbind \
	/dev/dri \
	/dev/nvidia* \
	/dev/input \
	/dev/uinput

# steam
bind \
	"$XAUTHORITY" \
	"$HOME/.local/bin/proton" \
	"$HOME/.pki" \
	"$HOME/.steam" \
	"$HOME/.steampath" \
	"$HOME/.steampid" \
	"$HOME/Downloads" \
	"$RUN_USER"/.mutter-X* \
	"$RUN_USER"/ICE* \
	"$RUN_USER"/dbus* \
	"$RUN_USER"/gnome* \
	"$RUN_USER"/pipewire* \
	"$RUN_USER"/pulse* \
	"$RUN_USER"/wayland* \
	"$RUN_USER/at-spi" \
	"$RUN_USER/bus" \
	"$RUN_USER/dconf" \
	"$RUN_USER/systemd" \
	"$XDG_CACHE_HOME/mesa_shader_cache" \
	"$XDG_CACHE_HOME/nv" \
	"$XDG_CACHE_HOME/nvidia" \
	"$XDG_CACHE_HOME/radv_builtin_shaders64" \
	"$XDG_CONFIG_HOME/Epic" \
	"$XDG_CONFIG_HOME/Loop_Hero" \
	"$XDG_CONFIG_HOME/MangoHud" \
	"$XDG_CONFIG_HOME/ModTheSpire" \
	"$XDG_CONFIG_HOME/RogueLegacy" \
	"$XDG_CONFIG_HOME/RogueLegacyStorageContainer" \
	"$XDG_CONFIG_HOME/cef_user_data" \
	"$XDG_CONFIG_HOME/proton" \
	"$XDG_CONFIG_HOME/pulse" \
	"$XDG_CONFIG_HOME/unity3d" \
	"$XDG_DATA_HOME/3909/PapersPlease" \
	"$XDG_DATA_HOME/Colossal Order" \
	"$XDG_DATA_HOME/Dredmor" \
	"$XDG_DATA_HOME/FasterThanLight" \
	"$XDG_DATA_HOME/HotlineMiami" \
	"$XDG_DATA_HOME/IntoTheBreach" \
	"$XDG_DATA_HOME/Paradox Interactive" \
	"$XDG_DATA_HOME/PillarsOfEternity" \
	"$XDG_DATA_HOME/RogueLegacy" \
	"$XDG_DATA_HOME/RogueLegacyStorageContainer" \
	"$XDG_DATA_HOME/Steam" \
	"$XDG_DATA_HOME/SuperHexagon" \
	"$XDG_DATA_HOME/Terraria" \
	"$XDG_DATA_HOME/applications" \
	"$XDG_DATA_HOME/aspyr-media" \
	"$XDG_DATA_HOME/bohemiainteractive" \
	"$XDG_DATA_HOME/cdprojektred" \
	"$XDG_DATA_HOME/feral-interactive" \
	"$XDG_DATA_HOME/frictionalgames" \
	"$XDG_DATA_HOME/icons" \
	"$XDG_DATA_HOME/proton" \
	"$XDG_DATA_HOME/vpltd" \
	"$XDG_DATA_HOME/vulkan" \
	"/var/lib/bluetooth" \
	/run/systemd \
	/tmp/.ICE-unix \
	/tmp/.X11-unix 

exec bwrap "${args[@]}" /usr/lib/steam/steam "$@"</pre>
<h2>
<span id="NPM.2C_Node_Version_Manager_.28NVM.29.2C_Maven_Java"></span><span class="mw-headline" id="NPM,_Node_Version_Manager_(NVM),_Maven_Java">NPM, Node Version Manager (NVM), Maven Java</span>
</h2>
<p>In order to be able to run <i>npm</i> in a project root you can use the following command.
</p>
<p>It works in combination with Angular, Cypress and Maven Java. X11 and wayland are on top included because Cypress starts a GUI based on electron.
</p>
<p>It allows full file access to the current directory where it is run from. Assuming you execute <code>npm install</code> in the current project root where <i>npm</i> needs to write to <code>node_modules</code>, <code>package.json</code>, etc. Also access to global <i>npm</i> install directory and <i>nvm</i> is allowed (<code>npm -g install ...</code>). Furthermore X11 with cypress is also able to run and even wayland apps.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The bindings to the directories zsh, maven, etc might differ from your setup.</div>
<pre>bwrap_arguments=(
    # no zombies
    --die-with-parent

    # network required for dependencies
    --unshare-all
    --share-net

    # create environment for a properly running shell
    --tmpfs /
    --tmpfs /run
    --dir /tmp
    --dev /dev
    --proc /proc
    --ro-bind /bin /bin
    --ro-bind /sbin /sbin
    --ro-bind /usr /usr
    --ro-bind /etc /etc
    --ro-bind /lib /lib
    --ro-bind /lib64 /lib64
    --ro-bind /sys /sys
    --ro-bind /var /var

    # systemd-resolve for dns
    --ro-bind /run/systemd/resolve /run/systemd/resolve

    # git is used by npm to init repos, config necessary for email username
    --ro-bind $XDG_CONFIG_HOME/git/config $XDG_CONFIG_HOME/git/config

    # zsh has to look everywhere cool
    --ro-bind $XDG_CONFIG_HOME/zsh/.zshrc $XDG_CONFIG_HOME/zsh/.zshrc
    --ro-bind $XDG_CONFIG_HOME/zsh/.zshenv $XDG_CONFIG_HOME/zsh/.zshenv
    --ro-bind $HOME/.zshenv $HOME/.zshenv

    # Maven
    --ro-bind /opt/maven /opt/maven
    --ro-bind $HOME/.m2 $HOME/.m2

    # NPM
    --bind "$XDG_DATA_HOME/npm" "$XDG_DATA_HOME/npm"

    # cache is needed by many programs like npm, cypress, nvm, maven
    --bind "$XDG_CACHE_HOME" "$XDG_CACHE_HOME"

    # x11, needed for cypress
    --ro-bind "$XAUTHORITY" "$XAUTHORITY"

    # wayland, might be useful
    --ro-bind "$XDG_RUNTIME_DIR/$WAYLAND_DISPLAY" "$XDG_RUNTIME_DIR/$WAYLAND_DISPLAY"

    # current dir is assumed to be project dir and full access is allowed
    --bind "$(pwd)" "$(pwd)"
)

# run bwrap with the arguments specified above and with the command provided by the user: zsh, npm install, etc
$ bwrap "${bwrap_arguments[@]}" "$@"</pre>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../../en/Category:Sandboxing.html" title="Category:Sandboxing">Sandboxing</a></li>
<li><a href="../../en/Category:Kernel.html" title="Category:Kernel">Kernel</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Bubblewrap/Examples&amp;oldid=805314">https://wiki.archlinux.org/index.php?title=Bubblewrap/Examples&amp;oldid=805314</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 5 April 2024, at 00:32.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
