<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Solid state drive - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Solid_state_drive rootpage-Solid_state_drive skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Usage" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Usage">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Usage</div>
		</a>
		
			<button aria-controls="toc-Usage-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Usage subsection</span>
			</button>
		
		<ul id="toc-Usage-sublist" class="vector-toc-list">
			<li id="toc-TRIM" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#TRIM">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>TRIM</div>
			</a>
			
			<ul id="toc-TRIM-sublist" class="vector-toc-list">
				<li id="toc-Periodic_TRIM" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Periodic_TRIM">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1.1</span>Periodic TRIM</div>
			</a>
			
			<ul id="toc-Periodic_TRIM-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Continuous_TRIM" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Continuous_TRIM">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1.2</span>Continuous TRIM</div>
			</a>
			
			<ul id="toc-Continuous_TRIM-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Trim_an_entire_device" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Trim_an_entire_device">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1.3</span>Trim an entire device</div>
			</a>
			
			<ul id="toc-Trim_an_entire_device-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-LVM" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#LVM">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1.4</span>LVM</div>
			</a>
			
			<ul id="toc-LVM-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-dm-crypt" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#dm-crypt">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1.5</span>dm-crypt</div>
			</a>
			
			<ul id="toc-dm-crypt-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Maximizing_performance" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Maximizing_performance">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Maximizing performance</div>
			</a>
			
			<ul id="toc-Maximizing_performance-sublist" class="vector-toc-list">
				<li id="toc-Sector_size" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Sector_size">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2.1</span>Sector size</div>
			</a>
			
			<ul id="toc-Sector_size-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-SSD_memory_cell_clearing" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#SSD_memory_cell_clearing">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2.2</span>SSD memory cell clearing</div>
			</a>
			
			<ul id="toc-SSD_memory_cell_clearing-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Security" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Security">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Security</div>
			</a>
			
			<ul id="toc-Security-sublist" class="vector-toc-list">
				<li id="toc-Frozen_mode" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Frozen_mode">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.1</span>Frozen mode</div>
			</a>
			
			<ul id="toc-Frozen_mode-sublist" class="vector-toc-list">
				<li id="toc-Setting_the_SATA_SSD_state_to_frozen_mode_after_waking_up_from_sleep" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Setting_the_SATA_SSD_state_to_frozen_mode_after_waking_up_from_sleep">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.1.1</span>Setting the SATA SSD state to frozen mode after waking up from sleep</div>
			</a>
			
			<ul id="toc-Setting_the_SATA_SSD_state_to_frozen_mode_after_waking_up_from_sleep-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Hardware_encryption" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Hardware_encryption">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.2</span>Hardware encryption</div>
			</a>
			
			<ul id="toc-Hardware_encryption-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Resolving_NCQ_errors" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Resolving_NCQ_errors">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Resolving NCQ errors</div>
			</a>
			
			<ul id="toc-Resolving_NCQ_errors-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Resolving_SATA_power_management_related_errors" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Resolving_SATA_power_management_related_errors">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Resolving SATA power management related errors</div>
			</a>
			
			<ul id="toc-Resolving_SATA_power_management_related_errors-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-External_SSD_with_TRIM_support" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#External_SSD_with_TRIM_support">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>External SSD with TRIM support</div>
			</a>
			
			<ul id="toc-External_SSD_with_TRIM_support-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Firmware" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Firmware">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Firmware</div>
		</a>
		
			<button aria-controls="toc-Firmware-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Firmware subsection</span>
			</button>
		
		<ul id="toc-Firmware-sublist" class="vector-toc-list">
			<li id="toc-ADATA" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ADATA">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>ADATA</div>
			</a>
			
			<ul id="toc-ADATA-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Crucial" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Crucial">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Crucial</div>
			</a>
			
			<ul id="toc-Crucial-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Intel" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Intel">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Intel</div>
			</a>
			
			<ul id="toc-Intel-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Kingston" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Kingston">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4</span>Kingston</div>
			</a>
			
			<ul id="toc-Kingston-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Mushkin" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Mushkin">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.5</span>Mushkin</div>
			</a>
			
			<ul id="toc-Mushkin-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-OCZ" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#OCZ">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.6</span>OCZ</div>
			</a>
			
			<ul id="toc-OCZ-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Samsung" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Samsung">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.7</span>Samsung</div>
			</a>
			
			<ul id="toc-Samsung-sublist" class="vector-toc-list">
				<li id="toc-Update_under_Linux" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Update_under_Linux">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.7.1</span>Update under Linux</div>
			</a>
			
			<ul id="toc-Update_under_Linux-sublist" class="vector-toc-list">
				<li id="toc-Older_SSDs" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Older_SSDs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.7.1.1</span>Older SSDs</div>
			</a>
			
			<ul id="toc-Older_SSDs-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-SanDisk" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#SanDisk">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.8</span>SanDisk</div>
			</a>
			
			<ul id="toc-SanDisk-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Solid state drive</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 4 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-4" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">4 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/Solid_State_drive.html" title="Solid State drive – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/%E3%82%BD%E3%83%AA%E3%83%83%E3%83%89%E3%82%B9%E3%83%86%E3%83%BC%E3%83%88%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96" title="ソリッドステートドライブ – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Solid_state_drive.html" title="Solid state drive – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Solid_state_drive" title="Solid state drive – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Solid_state_drive/NVMe.html" title="Solid state drive/NVMe">Solid state drive/NVMe</a></li>
<li><a href="../en/Solid_state_drive/Memory_cell_clearing.html" title="Solid state drive/Memory cell clearing">Solid state drive/Memory cell clearing</a></li>
<li><a href="../en/Benchmarking.html" class="mw-redirect" title="Benchmarking/Data storage devices">Benchmarking/Data storage devices</a></li>
<li><a href="../en/Improving_performance.html#Storage_devices" title="Improving performance">Improving performance#Storage devices</a></li>
</ul>
</div>
<p>This article covers special topics for operating <a href="https://en.wikipedia.org/wiki/Solid-state_drive" class="extiw" title="wikipedia:Solid-state drive">solid state drives</a> (SSDs) and other flash-memory based storage devices.
</p>
<p>If you want to partition an SSD for a specific purpose, it may be useful to consider the <a href="https://en.wikipedia.org/wiki/List_of_file_systems#File_systems_optimized_for_flash_memory.2C_solid_state_media" class="extiw" title="wikipedia:List of file systems">List of file systems optimized for flash memory</a>.
</p>
<p>For general usage, simply choose your preferred <a href="../en/File_systems.html" class="mw-redirect" title="Filesystem">filesystem</a> and enable <a href="#TRIM">#TRIM</a>.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<h3><span class="mw-headline" id="TRIM">TRIM</span></h3>
<p>Compared to hard drives, where deleting a file is only handled at the file system level<a rel="nofollow" class="external autonumber" href="https://www.redhat.com/sysadmin/linux-delete-file-rm">[1]</a>, SSDs benefit from informing the disk controller when blocks of memory are free to be reused. Since the flash cells they are made of are worn out a little with each write operation, the disk controllers use algorithms to share the write operations on all the cells: this process is called <a href="https://en.wikipedia.org/wiki/Wear_leveling" class="extiw" title="wikipedia:Wear leveling">wear leveling</a>. Without the NVMe <a href="https://en.wikipedia.org/wiki/Trim_(computing)#NVM_Express" class="extiw" title="wikipedia:Trim (computing)">DEALLOCATE</a>, SAS <a href="https://en.wikipedia.org/wiki/Trim_(computing)#SCSI" class="extiw" title="wikipedia:Trim (computing)">UNMAP</a> or <a href="https://en.wikipedia.org/wiki/ATA_TRIM" class="extiw" title="wikipedia:ATA TRIM">ATA_TRIM</a> command (supported by most SSDs), the disk controller takes more time to do a write operation as soon as there is no empty memory blocks, as it has to shuffle data around to erase a cell before writing to it (see <a href="https://en.wikipedia.org/wiki/Write_amplification" class="extiw" title="wikipedia:Write amplification">Wikipedia:Write amplification</a>): a <a rel="nofollow" class="external text" href="https://www.techspot.com/review/737-ocz-vector-150-ssd/page9.html">TechSpot benchmark</a> shows the performance impact before and after filling an SSD with data.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you want to use TRIM, use <b>either</b> periodic TRIM or continuous TRIM. Continuous TRIM is <b>not</b> the most preferred way to issue TRIM commands among the Linux community. For example, Ubuntu enables periodic TRIM by default <a rel="nofollow" class="external autonumber" href="https://askubuntu.com/questions/1034169/is-trim-enabled-on-my-ubuntu-18-04-installation">[2]</a>, Debian does not recommend using <a href="https://wiki.debian.org/SSDOptimization#Mounting_SSD_filesystems" class="extiw" title="debian:SSDOptimization">continuous TRIM</a> and Red Hat recommends using periodic TRIM over using continuous TRIM if feasible <a rel="nofollow" class="external autonumber" href="https://web.archive.org/web/20160917183831/https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/ch02s04.html">[3]</a>.</div>
<p>As of Linux kernel version 3.8 onwards, support for TRIM was continually added for the different <a href="../en/File_systems.html" class="mw-redirect" title="Filesystems">filesystems</a>. See the following table for an indicative overview:
</p>
<table class="wikitable sortable">
<tbody>
<tr>
<th>File system</th>
<th>Continuous TRIM <br> (<code>discard</code> option)</th>
<th>Periodic TRIM <br> (<i>fstrim</i>)</th>
<th>References<br> and notes
</th>
</tr>
<tr>
<td><a href="../en/Bcachefs.html" title="Bcachefs">Bcachefs</a></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">No</td>
<td>
</td>
</tr>
<tr>
<td><a href="../en/Btrfs.html" title="Btrfs">Btrfs</a></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td>Asynchronous discard is <a href="../en/Btrfs.html#SSD_TRIM" title="Btrfs">enabled</a> by default since kernel 6.2.
</td>
</tr>
<tr>
<td><a href="https://en.wikipedia.org/wiki/exFAT" class="extiw" title="wikipedia:exFAT">exFAT</a></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td>
<i>fstrim</i> is supported since kernel 5.13, <a rel="nofollow" class="external autonumber" href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit?id=654762df2ec7d61b05acc788afbffaba52d658fe">[4]</a>
</td>
</tr>
<tr>
<td><a href="../en/Ext3.html" title="Ext3">ext3</a></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td>
</td>
</tr>
<tr>
<td><a href="../en/Ext4.html" title="Ext4">ext4</a></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td>"discard, nodiscard(*)" in <a rel="nofollow" class="external autonumber" href="https://docs.kernel.org/admin-guide/ext4.html?highlight=discard,%20nodiscard(*)#options">[5]</a>
</td>
</tr>
<tr>
<td><a href="../en/F2FS.html" title="F2FS">F2FS</a></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td>
</td>
</tr>
<tr>
<td><a href="../en/JFS.html" title="JFS">JFS</a></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td>
<a rel="nofollow" class="external autonumber" href="https://www.phoronix.com/scan.php?page=news_item&amp;px=MTE5ODY">[6]</a>
</td>
</tr>
<tr>
<td><a href="https://en.wikipedia.org/wiki/NILFS" class="extiw" title="wikipedia:NILFS">NILFS2</a></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td>
</td>
</tr>
<tr>
<td rowspan="2">
<a href="../en/NTFS.html" title="NTFS">NTFS</a>
</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">No</td>
<td>
<a rel="nofollow" class="external text" href="https://docs.kernel.org/filesystems/ntfs3.html">ntfs3</a> kernel driver only supports continuous TRIM.
</td>
</tr>
<tr>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">No</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td>
<a href="../en/NTFS-3G.html" title="NTFS-3G">NTFS-3G</a> driver only supports periodic TRIM.
</td>
</tr>
<tr>
<td><a href="../en/FAT.html" class="mw-redirect" title="VFAT">VFAT</a></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td>
<i>fstrim</i> is supported since kernel 4.19, <a rel="nofollow" class="external autonumber" href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=f663b5b38fffeb31841f8bfaf0ef87a445b0ffee">[7]</a>
</td>
</tr>
<tr>
<td><a href="../en/XFS.html" title="XFS">XFS</a></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">Yes</td>
<td>
<a rel="nofollow" class="external autonumber" href="https://xfs.org/index.php/FITRIM/discard">[8]</a>
</td>
</tr>
</tbody>
</table>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Users need to be certain that their SSD supports TRIM before attempting to use it. Data loss can occur otherwise!</div>
<p>To verify TRIM support, run:
</p>
<pre>$ lsblk --discard
</pre>
<p>And check the values of DISC-GRAN (discard granularity) and DISC-MAX (discard max bytes) columns. Non-zero values indicate TRIM support.
</p>
<p>For SATA SSDs only, the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=hdparm">hdparm</a></span> package can detect TRIM support via <code>hdparm -I /dev/sda | grep TRIM</code> as the <a href="../en/Users_and_groups.html#Overview" class="mw-redirect" title="Root user">root user</a>. <code>hdparm</code> does however not support NVMe SSDs.
</p>
<h4><span class="mw-headline" id="Periodic_TRIM">Periodic TRIM</span></h4>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=util-linux">util-linux</a></span> package provides <code>fstrim.service</code> and <code>fstrim.timer</code> <a href="../en/Systemd.html" title="Systemd">systemd</a> unit files. <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enabling">Enabling</a> the timer will activate the service weekly. The service executes <span class="plainlinks archwiki-template-man" title="$ man 8 fstrim"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/fstrim.8">fstrim(8)</a></span> on all mounted filesystems on devices that support the <i>discard</i> operation.
</p>
<p>The timer relies on the timestamp of <code>/var/lib/systemd/timers/stamp-fstrim.timer</code> (which it will create upon first invocation) to know whether a week has elapsed since it last ran. Therefore there is no need to worry about too frequent invocations, in an <i>anacron</i>-like fashion.
</p>
<p>To query the units activity and status, see <a href="../en/Systemd/Journal.html" class="mw-redirect" title="Journalctl">journalctl</a>. To change the periodicity of the timer or the command run, <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">edit</a> the provided unit files.
</p>
<h4><span class="mw-headline" id="Continuous_TRIM">Continuous TRIM</span></h4>
<p>Instead of issuing TRIM commands once in a while (by default once a week if using <code>fstrim.timer</code>), it is also possible to issue TRIM commands each time files are deleted instead. The latter is known as the continuous TRIM.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Before <a href="https://en.wikipedia.org/wiki/Serial_ATA#SATA_revision_3.1" class="extiw" title="wikipedia:Serial ATA">SATA 3.1</a> all TRIM commands were non-queued, so continuous trimming would produce frequent system freezes. In this case, applying <a href="#Periodic_TRIM">#Periodic TRIM</a> less often is better alternative. Similar issue holds also for a number of devices, see <code>ata_device_blacklist</code> in <a rel="nofollow" class="external text" href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/ata/libata-core.c">Linux source code</a>, for which queued TRIM command execution was blacklisted due to serious data corruption. In such case, depending on the device, the system may be forced to send non-queued TRIM commands the SSD instead of queued TRIM. See <a href="https://en.wikipedia.org/wiki/Trim_(computing)#Disadvantages" class="extiw" title="wikipedia:Trim (computing)">Wikipedia:Trim_(computing)#Disadvantages</a> for details.</div>
<p>Using the <code>discard</code> option for a mount in <code>/etc/fstab</code> enables continuous TRIM in device operations:
</p>
<pre>/dev/sda1  /           ext4  defaults,<b>discard</b>   0  1
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Specifying the discard mount option in <code>/etc/fstab</code> does not work with an XFS <code>/</code> partition. According to <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=143254">this thread</a>, it has to be set using the <code>rootflags=discard</code> <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a>.</div>
<p>On the ext4 filesystem, the <code>discard</code> flag can also be set as a <a href="../en/Access_Control_Lists.html#Enable_ACL" title="Access Control Lists">default mount option</a> using <i>tune2fs</i>:
</p>
<pre># tune2fs -o discard /dev/sd<b>XY</b>
</pre>
<p>Using the default mount options instead of an entry in <code>/etc/fstab</code> is particularly useful for external drives, because such partition will be mounted with the default options also on other machines. This way, there is no need to edit <code>/etc/fstab</code> on every machine.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The default mount options are not listed in <code>/proc/mounts</code>.</div>
<h4><span class="mw-headline" id="Trim_an_entire_device">Trim an entire device</span></h4>
<p>If you want to trim your entire SSD at once, <i>e.g.</i> for a new install or if you want to sell the drive, you can use the <a href="../en/Solid_state_drive/Memory_cell_clearing.html#Common_method_with_blkdiscard" title="Solid state drive/Memory cell clearing">blkdiscard</a> command.
</p>
<h4><span class="mw-headline" id="LVM">LVM</span></h4>
<p>TRIM requests that get passed from the file system to the logical volume are automatically passed to the physical volume(s). No additional configuration is necessary.
</p>
<p>No <a href="../en/LVM.html" title="LVM">LVM</a> operations (<i>lvremove</i>, <i>lvreduce</i> and all others) issue TRIM requests to physical volume(s) by default. This is done to allow restoring previous volume group configuration with <span class="plainlinks archwiki-template-man" title="$ man 8 vgcfgrestore"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/vgcfgrestore.8">vgcfgrestore(8)</a></span>. The setting <code>issue_discards</code> in <code>/etc/lvm/lvm.conf</code> controls whether discards are sent to a logical volume's underlying physical volumes when the logical volume is no longer using the physical volumes' space.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Carefully read the comment in <code>/etc/lvm/lvm.conf</code> before changing the <code>issue_discards</code> setting. It does not in any way affect TRIM requests that get passed from the file system to the disk (e.g. file deletions inside a file system) nor does it affect space management within a thin pool.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Enabling <code>issue_discards</code> will prevent volume group metadata restoration with <i>vgcfgrestore</i>. There will be no recovery options in case of a mistakenly issued LVM command.</div>
<h4><span class="mw-headline" id="dm-crypt">dm-crypt</span></h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The discard option allows discard requests to be passed through the encrypted block device. This may or may not improve performance on SSD storage <a rel="nofollow" class="external autonumber" href="https://lore.kernel.org/linux-raid/508FA2C6.2050800@hesbynett.no/">[9]</a> but has security implications. See the following for more information:
<ul>
<li><a href="https://wiki.debian.org/SSDOptimization#Mounting_SSD_filesystems" class="extiw" title="debian:SSDOptimization">Debian:SSDOptimization#Mounting SSD filesystems</a></li>
<li><a href="../en/Dm-crypt/Specialties.html#Discard/TRIM_support_for_solid_state_drives_(SSD)" title="Dm-crypt/Specialties">dm-crypt/Specialties#Discard/TRIM support for solid state drives (SSD)</a></li>
</ul>
</div>
<p>Follow the instructions in <a href="../en/Dm-crypt/Specialties.html#Discard/TRIM_support_for_solid_state_drives_(SSD)" title="Dm-crypt/Specialties">dm-crypt/Specialties#Discard/TRIM support for solid state drives (SSD)</a> to enable discard support.
</p>
<h3><span class="mw-headline" id="Maximizing_performance">Maximizing performance</span></h3>
<p>Follow the tips in <a href="../en/Improving_performance.html#Storage_devices" title="Improving performance">Improving performance#Storage devices</a> to maximize the performance of your drives.
</p>
<h4><span class="mw-headline" id="Sector_size">Sector size</span></h4>
<p>See <a href="../en/Advanced_Format.html#NVMe_solid_state_drives" title="Advanced Format">Advanced Format#NVMe solid state drives</a>.
</p>
<h4><span class="mw-headline" id="SSD_memory_cell_clearing">SSD memory cell clearing</span></h4>
<p>On occasion, users may wish to completely reset an SSD's cells to the same virgin state they were at the time the device was installed, thus restoring it to its <a rel="nofollow" class="external text" href="https://www.anandtech.com/show/2738/8">factory default write performance</a>. Write performance is known to degrade over time even on SSDs with native TRIM support: TRIM only safeguards against file deletes, not replacements such as an incremental save.
</p>
<p>The reset can be accomplished by following the appropriate procedure denoted in <a href="../en/Solid_state_drive/Memory_cell_clearing.html" title="Solid state drive/Memory cell clearing">Solid state drive/Memory cell clearing</a>, either for <a href="../en/Solid_state_drive/Memory_cell_clearing.html#SATA_drive" title="Solid state drive/Memory cell clearing">SATA</a> or <a href="../en/Solid_state_drive/Memory_cell_clearing.html#NVMe_drive" title="Solid state drive/Memory cell clearing">NVMe</a> SSDs.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If the reason for the reset is to wipe data, you may not want to rely on the SSD controller to perform it securely, <i>e.g.</i> if you do not trust the manufacturer or are wary of potential bugs. In this case, see <a href="../en/Securely_wipe_disk.html#Flash_memory" title="Securely wipe disk">Securely wipe disk#Flash memory</a> for further information and examples to perform a manual wipe.</div>
<h3><span class="mw-headline" id="Security">Security</span></h3>
<h4><span class="mw-headline" id="Frozen_mode">Frozen mode</span></h4>
<p>Some motherboard firmware issue a ATA SECURITY FREEZE LOCK command to SATA devices on initialization, setting the drive to frozen mode which transitions it to SEC2 state (security disabled, not locked, frozen). Likewise some SSD (and HDD) are set to this state in the factory already. This can be seen in <a href="../en/Hdparm.html" title="Hdparm">hdparm</a> and <a href="../en/S.M.A.R.T..html#smartctl" class="mw-redirect" title="Smartctl">smartctl</a> output:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># hdparm -I /dev/sda</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Security:
 	Master password revision code = 65534
 		supported
 	<b>not	enabled</b>
 	<b>not	locked</b>
 		<b>frozen</b>
 	not	expired: security count
 		supported: enhanced erase
 	4min for SECURITY ERASE UNIT. 2min for ENHANCED SECURITY ERASE UNIT.</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># smartctl -g security /dev/sda</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ATA Security is:  Disabled, frozen [SEC2]
</pre>
<p>Operations like formatting the device or installing operating systems are not affected by the frozen mode.
</p>
<p>The above <i>hdparm</i> output shows the device is <b>not locked</b> by a HDD-password on boot and the <b>frozen</b> state safeguards the device against malwares which may try to lock it by setting a password to it at runtime.
</p>
<p>If you intend to set a password to a "frozen" device yourself, a motherboard BIOS with support for it is required. A lot of notebooks have support, because it is required for <a href="../en/Self-encrypting_drives.html" title="Self-encrypting drives">hardware encryption</a>, but support may not be trivial for a desktop/server board. For the Intel DH67CL/BL motherboard, for example, the motherboard has to be set to "maintenance mode" by a physical jumper to access the settings.<a rel="nofollow" class="external autonumber" href="https://sstahlman.blogspot.in/2014/07/hardware-fde-with-intel-ssd-330-on.html?showComment=1411193181867#c4579383928221016762">[10]</a>
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Do not try to change the above <b>lock</b> security settings with <i>hdparm</i> unless you know exactly what you are doing.</div>
<p>If you intend to erase the SSD, see <a href="../en/Securely_wipe_disk.html#hdparm" title="Securely wipe disk">Securely wipe disk#hdparm</a> and <a href="../en/Solid_state_drive/Memory_cell_clearing.html" title="Solid state drive/Memory cell clearing">/Memory cell clearing</a>.
</p>
<h5><span class="mw-headline" id="Setting_the_SATA_SSD_state_to_frozen_mode_after_waking_up_from_sleep">Setting the SATA SSD state to frozen mode after waking up from sleep</span></h5>
<p>When waking up from S3 sleep, the SATA SSD will most likely have reverted to SEC1 state (security disabled, not locked, not frozen), leaving it vulnerable to ATA SECURITY ERASE UNIT commands like those described in <a href="../en/Solid_state_drive/Memory_cell_clearing.html" title="Solid state drive/Memory cell clearing">/Memory cell clearing</a>.
</p>
<p>In order to prevent this issue, a script can be run <a href="../en/Power_management/Suspend_and_hibernate.html#Hooks_in_/usr/lib/systemd/system-sleep" title="Power management/Suspend and hibernate">after waking up from sleep</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/usr/lib/systemd/system-sleep/ssd-freeze.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
if [ "$1" = 'post' ]; then
	sleep 1
	if hdparm --security-freeze /dev/disk/by-id/<i>ata-name-of-disk</i>; then
		logger "$0: SSD freeze command executed successfully"
	else
		logger "$0: SSD freeze command failed"
	fi	
fi</pre>
<p>If the system has multiple storage devices and/or portable USB-drives, another option is to adapt <a href="../en/Hdparm.html#Persistent_configuration_using_udev_rule" title="Hdparm">Hdparm#Persistent configuration using udev rule</a> to issue a <code>--security-freeze</code> for all drives (incl. HDD).
</p>
<h4><span class="mw-headline" id="Hardware_encryption">Hardware encryption</span></h4>
<p>As noted in <a href="#Frozen_mode">#Frozen mode</a>, setting a password for a storage device (SSD/HDD) in the BIOS may also initialize the hardware encryption of devices supporting it. If the device also conforms to the OPAL standard, this may also be achieved without a respective BIOS feature to set the passphrase. See <a href="../en/Self-encrypting_drives.html" title="Self-encrypting drives">Self-encrypting drives</a>.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<p>It is possible that the issue you are encountering is a firmware bug which is not Linux specific, so before trying to troubleshoot an issue affecting the SSD device, you should first check if updates are available for:
</p>
<ul>
<li>The <a href="#Firmware">SSD's firmware</a>
</li>
<li>The <a href="../en/Flashing_BIOS_from_Linux.html" title="Flashing BIOS from Linux">motherboard's BIOS/UEFI firmware</a>
</li>
</ul>
<p>Even if it is a firmware bug it might be possible to avoid it, so if there are no updates to the firmware or you hesitant on updating firmware then the following might help.
</p>
<h3><span class="mw-headline" id="Resolving_NCQ_errors">Resolving NCQ errors</span></h3>
<p>Some SSDs and SATA chipsets do not work properly with Linux Native Command Queueing (NCQ). The tell-tale errors in the <a href="../en/Systemd/Journal.html" class="mw-redirect" title="Journal">journal</a> look like:
</p>
<pre>ata9: exception Emask 0x0 SAct 0xf SErr 0x0 action 0x10 frozen
ata9.00: failed command: READ FPDMA QUEUED
ata9.00: cmd 60/04:00:d4:82:85/00:00:1f:00:00/40 tag 0 ncq 2048 in
res 40/00:18:d3:82:85/00:00:1f:00:00/40 Emask 0x4 (timeout)
</pre>
<p>To disable NCQ on boot, add <code>libata.force=noncq</code> to the kernel command line in the <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> configuration. To disable NCQ only for disk 0 on port 9 use: <code>libata.force=9.00:noncq</code>
</p>
<p>Alternatively, you may disable NCQ for a specific drive without rebooting via sysfs:
</p>
<pre># echo 1 &gt; /sys/block/sdX/device/queue_depth
</pre>
<p>If this (and also updating the firmware) does not resolve the problem or causes other issues, then <a href="../en/Bug_reporting_guidelines.html" class="mw-redirect" title="Reporting bug guidelines">file a bug report</a>.
</p>
<h3><span class="mw-headline" id="Resolving_SATA_power_management_related_errors">Resolving SATA power management related errors</span></h3>
<p>Some SSDs (e.g. Transcend MTS400 or Crucial M550 SSDs) are failing with certain SATA controllers when <a href="https://en.wikipedia.org/wiki/Aggressive_Link_Power_Management" class="extiw" title="wikipedia:Aggressive Link Power Management">SATA Active Link Power Management (ALPM)</a>, is enabled. 
</p>
<p>ALPM is enabled by default since linux-4.16, or may be enabled at runtime by a power saving daemon (e.g. <a href="../en/TLP.html" title="TLP">TLP</a>, <a href="../en/Laptop_Mode_Tools.html" title="Laptop Mode Tools">Laptop Mode Tools</a>). See <a href="../en/Power_management.html#SATA_Active_Link_Power_Management" title="Power management">Power management#SATA Active Link Power Management</a> for more on this.
</p>
<h3><span class="mw-headline" id="External_SSD_with_TRIM_support">External SSD with TRIM support</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> Several <a href="../en/Help:Style.html" title="Help:Style">style</a> and formatting problems, especially too many explicit commands - see <a href="../en/Help:Style.html#File_editing_requests" title="Help:Style">Help:Style#File editing requests</a>. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Solid_state_drive.html">Talk:Solid state drive</a>)</div>
</div>
<p>Several USB-to-SATA bridge chips (like VL715, VL716 etc.) and also USB-to-PCIe bridge chips (like the <a rel="nofollow" class="external text" href="https://www.jmicron.com/PDF/brief/jms583.pdf">JMicron JMS583</a> used in external NVMe enclosures like <a rel="nofollow" class="external text" href="https://icybox.de/en/product.php?id=71">IB-1817M-C31</a>) support TRIM-like commands that can be sent through the <a href="https://en.wikipedia.org/wiki/USB_Attached_SCSI" class="extiw" title="wikipedia:USB Attached SCSI">USB Attached SCSI</a> driver (named "uas" under Linux).
</p>
<p>But the kernel may not automatically detect this capability, and therefore might not use it.
Assuming your block device in question is /dev/sdX, you can find out whether that is the case by using the command from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sg3_utils">sg3_utils</a></span>:
</p>
<pre># sg_readcap -l /dev/sdX
</pre>
<p>If in its output you find a line stating "Logical block provisioning: lbpme=0" then you know that the kernel assumes the device does not support "<a rel="nofollow" class="external text" href="https://www.seagate.com/files/staticfiles/support/docs/manual/Interface%20manuals/100293068k.pdf#G4.1427908">Logical Block Provisioning Management</a>" because the (LBPME) bit is not set.
</p>
<p>If this is the case, then you should next find out whether the <a rel="nofollow" class="external text" href="https://www.seagate.com/files/staticfiles/support/docs/manual/Interface%20manuals/100293068k.pdf#G4.3076244">"Vital Product Data" (VPD) page on "Logical Block Provisioning"</a> of your device tells of supported mechanisms for unmapping data. You can do this using the command:
</p>
<pre># sg_vpd -a /dev/sdX
</pre>
<p>Look for lines in the output that look like this:
</p>
<pre>Unmap command supported (LBPU): 1
Write same (16) with unmap bit supported (LBPWS): 0
Write same (10) with unmap bit supported (LBPWS10): 0
</pre>
<p>This example would tell you the device supports the "UNMAP" command.
</p>
<p>Have a look at the output of
</p>
<pre>$ cat /sys/block/sdX/device/scsi_disk/*/provisioning_mode
</pre>
<p>If the kernel did not detect the capability of your device to unmap data, then this will likely return "full".
Apart from "full", the kernel SCSI storage driver currently knows the following values for provisioning_mode:
</p>
<pre>unmap
writesame_16
writesame_10
writesame_zero
disabled
</pre>
<p>For the example above, you could now write "unmap" to "provisioning_mode" to ask the kernel to use that:
</p>
<pre># echo "unmap" &gt;/sys/block/sdX/device/scsi_disk/*/provisioning_mode
</pre>
<p>This should immediately enable you to use tools like "blkdiscard" on /dev/sdX or "fstrim" on filesystems mounted on /dev/sdX.
</p>
<p>If you want to enable a "provisioning_mode" automatically when an external device of a certain vendor/product is attached, this can be automated via the "<a href="../en/Udev.html" title="Udev">udev</a>" mechanism. First find the USB Vendor and Product IDs:
</p>
<pre>$ cat /sys/block/sdX/../../../../../../idVendor
$ cat /sys/block/sdX/../../../../../../idProduct
</pre>
<p>Then create or append to a <a href="../en/Udev.html" title="Udev">udev</a> rule file (example here using idVendor 152d and idProduct 0583):
</p>
<pre># echo 'ACTION=="add|change", ATTRS{idVendor}=="152d", ATTRS{idProduct}=="0583", SUBSYSTEM=="scsi_disk", ATTR{provisioning_mode}="unmap"' &gt;&gt;/etc/udev/rules.d/10-uas-discard.rules
</pre>
<p>(You can also use the <code>lsusb</code> command to look for the relevant idVendor/idProduct.)
</p>
<h2><span class="mw-headline" id="Firmware">Firmware</span></h2>
<p>If supported by the device vendor, it is recommended to update firmware using the <a href="../en/Fwupd.html" title="Fwupd">fwupd</a> utility.
</p>
<p>To check your current firmware version:
</p>
<pre># smartctl -i /dev/<i>ssd_device</i>
</pre>
<h3><span class="mw-headline" id="ADATA">ADATA</span></h3>
<p>Updating SSD firmware under Linux is not supported by ADATA. A Windows-only utility called SSD ToolBox is provided by ADATA through their <a rel="nofollow" class="external text" href="https://www.adata.com/en/support/consumer?tab=downloads&amp;download=driver">support page</a> and through their ADATA XPG <a rel="nofollow" class="external text" href="https://www.xpg.com/en/support/xpg?tab=downloads&amp;download=driver">support page</a> to monitor, TRIM, benchmark and update ADATA SSD firmware.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> It is discouraged to attempt to update firmware through <a href="../en/Wine.html" title="Wine">Wine</a> as it is not designed to handle hardware interfaces and an incomplete firmware update can potentially brick your device.</div>
<h3><span class="mw-headline" id="Crucial">Crucial</span></h3>
<p>Crucial provides an option for updating the firmware with an ISO image. These images can be found after selecting the product on their <a rel="nofollow" class="external text" href="https://www.crucial.com/usa/en/support-ssd">SSD support page</a> and downloading the "Manual Boot File."
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> ISO images provided by Crucial do not seem to be hybrid. If you will use just the <code>dd</code> command to copy the image to some device, the <a href="../en/Partitioning.html#Master_Boot_Record" class="mw-redirect" title="MBR">MBR</a> will not be present, making such device unbootable. Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=syslinux">syslinux</a></span> and run <code>isohybrid path/to/image.iso</code>.</div>
<p>Owners of an M4 Crucial model, may check if a firmware upgrade is needed with <code>smartctl</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ smartctl --all /dev/sd<b>X</b></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">==&gt; WARNING: This drive may hang after 5184 hours of power-on time:
<a rel="nofollow" class="external free" href="https://www.tomshardware.com/news/Crucial-m4-Firmware-BSOD,14544.html">https://www.tomshardware.com/news/Crucial-m4-Firmware-BSOD,14544.html</a>
See the following web page for firmware updates:
<a rel="nofollow" class="external free" href="https://www.crucial.com/usa/en/support-ssd">https://www.crucial.com/usa/en/support-ssd</a>
</pre>
<p>Users seeing this warning are advised to backup all sensible data and <b>consider upgrading immediately</b>. Check <a rel="nofollow" class="external text" href="https://www.rojtberg.net/1008/updating-crucial-mx100-firmware-with-ubuntu/">this instructions</a> to update Crucial MX100 firmware by using the ISO image and Grub.
</p>
<h3><span class="mw-headline" id="Intel">Intel</span></h3>
<p>Intel has a Linux live system based <a rel="nofollow" class="external text" href="https://downloadcenter.intel.com/download/18363">Firmware Update Tool</a> for operating systems that are not compatible with its Windows <a rel="nofollow" class="external text" href="https://downloadcenter.intel.com/download/30380/">Intel® Memory and Storage Tool (GUI)</a> software.
</p>
<p>There is also a newer Linux command-line utility that can reflash firmware called the <a rel="nofollow" class="external text" href="https://downloadcenter.intel.com/download/29337/Intel-Memory-and-Storage-Tool-CLI-Command-Line-Interface-?product=83425">Intel Memory and Storage (MAS) Tool</a> available as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/intel-mas-cli-tool/">intel-mas-cli-tool</a></span><sup><small>AUR</small></sup>.  There is a <a rel="nofollow" class="external text" href="https://downloadmirror.intel.com/646992/CLI-Intel-MAS-1.10-User-Guide-Public-342245-011US.pdf">PDF user guide</a><sup title="Last check status: 403">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2024-07-30 ⓘ]</sup> available.
</p>
<p>An example for checking the firmware status is:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># intelmas show -intelssd 0</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">DevicePath : /dev/nvme0n1
DeviceStatus : Healthy
Firmware : 002C
FirmwareUpdateAvailable : The selected Intel SSD contains current firmware as of this tool release.
</pre>
<p><code>-intelssd 0</code> can be omitted if there is only one Intel SSD in the system, or <code>1</code> passed for the second SSD, and so on.
</p>
<p>If an update is available, it is performed by running <code>intelmas load -intelssd 0</code>. The PDF user guide suggests that this procedure needs to be performed twice in Linux, with a power cycle in between. The latest firmware for all devices is distributed as part of the MAS Tool itself, so does not need to be downloaded separately.
</p>
<h3><span class="mw-headline" id="Kingston">Kingston</span></h3>
<p>KFU tool is available for the Sandforce based drives, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/kingston_fw_updater/">kingston_fw_updater</a></span><sup><small>AUR</small></sup>.
</p>
<h3><span class="mw-headline" id="Mushkin">Mushkin</span></h3>
<p>The lesser known Mushkin brand solid state drives also use Sandforce controllers, and have a Linux utility (nearly identical to Kingston's) to update the firmware.
</p>
<h3><span class="mw-headline" id="OCZ">OCZ</span></h3>
<p>OCZ has a <a rel="nofollow" class="external text" href="https://www.ocz.com/us/download/clout">Command Line Online Update Tool (CLOUT)</a> available for Linux. The existing packages are <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ocz-ssd-utility/">ocz-ssd-utility</a></span><sup><small>AUR</small></sup>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/ocztoolbox/">ocztoolbox</a></span><sup><small>AUR</small></sup> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/oczclout/">oczclout</a></span><sup><small>AUR</small></sup>.
</p>
<h3><span class="mw-headline" id="Samsung">Samsung</span></h3>
<p>Although Samsung deems firmware update methods outside of their Magician software as "unsupported", they still <i>can</i> work. The Magician software can create a bootable USB drive containing the firmware update, however Samsung no longer provides the software for consumer SSDs. Samsung also provides pre-made <a rel="nofollow" class="external text" href="https://www.samsung.com/semiconductor/minisite/ssd/download/tools.html">bootable ISO images</a> that can be used to update the firmware. Another option is to use Samsung's <i>magician</i> utility provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/samsung_magician-consumer-ssd/">samsung_magician-consumer-ssd</a></span><sup><small>AUR</small></sup>. Magician only supports Samsung-branded SSDs; those manufactured by Samsung for OEMs (e.g., Lenovo) are not supported.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Samsung does not make it obvious at all that they actually provide these. They seem to have 4 different firmware update pages and each references different ways of doing things.</div>
<p>Users preferring to run the firmware update from a live USB created under Linux (without using Samsung's Magician software under Microsoft Windows) can refer to <a rel="nofollow" class="external autonumber" href="https://web.archive.org/web/20160322230114/fomori.org/blog/?p=933">[11]</a> for more details. Note that this blog post details creating a bootable USB drive with Master Boot Record (<a href="../en/Partitioning.html#Master_Boot_Record" class="mw-redirect" title="MBR">MBR</a>) that some newer motherboards, e.g. <a rel="nofollow" class="external text" href="https://www.intel.com/content/www/us/en/support/articles/000057401/intel-nuc.html">Intel NUC</a> no longer support.
</p>
<h4><span class="mw-headline" id="Update_under_Linux">Update under Linux</span></h4>
<p>The SSD firmware can be updated natively (without making a bootable USB stick) as shown below. First visit the <a rel="nofollow" class="external text" href="https://www.samsung.com/semiconductor/minisite/ssd/download/tools">Samsung downloads page</a>, go to the "Samsung SSD Firmware" section, and download the latest firmware for your SSD—it should be an ISO image.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Some ISO images will lack the <code>initrd</code> Linux image mentioned below. See <a href="#Older_SSDs">#Older SSDs</a> instead.</div>
<p>Extract the <code>initrd</code> Linux image from the ISO image:
</p>
<pre>$ bsdtar xf <i>samsung_ssd_firmware</i>.iso initrd
</pre>
<p>Extract <code>root/fumagician/</code>. This directory contains the firmware update files:
</p>
<pre>$ bsdtar xf initrd root/fumagician
</pre>
<p>Finally, run <code>root/fumagician/fumagician</code> with root privileges and <a href="../en/Systemd.html#Power_management" class="mw-redirect" title="Reboot">reboot</a> your system (if the firmware was successfully updated).
</p>
<p>If after reboot the firmware version does not change, run <code>root/fumagician/fumagician 2&gt; log</code> and search for errors in the log file. For example, if the log shows 'unzip is not available', install unzip or extract it from the initrd.
</p>
<h5><span class="mw-headline" id="Older_SSDs">Older SSDs</span></h5>
<p>Some of the SSD firmware ISO images contain a FreeDOS image instead of an <code>initrd</code> Linux image, so the steps needed to update the SSD firmware differ from above. The following table lists these SSDs (and relevant paths):
</p>
<table class="wikitable">
<tbody>
<tr>
<th>SSD model</th>
<th>FreeDOS image path</th>
<th>Firmware package path
</th>
</tr>
<tr>
<td>470, 830</td>
<td><code>BTDSK.IMG</code></td>
<td>
<code>SSR/</code>
</td>
</tr>
<tr>
<td>840</td>
<td><code>isolinux/btdsk.img</code></td>
<td rowspan="2">
<code>samsung/DSRD/</code>
</td>
</tr>
<tr>
<td>840 EVO (mSATA), Pro</td>
<td>
<code>ISOLINUX/BTDSK.IMG</code>
</td>
</tr>
</tbody>
</table>
<p>First, extract the FreeDOS image from the ISO image:
</p>
<pre>$ bsdtar xf <i>samsung_ssd_firmware</i>.iso <i>freedos_image_path</i>
</pre>
<p>Mount the FreeDOS image to <code>/mnt/</code>:
</p>
<pre># mount <i>freedos_image_path</i> /mnt
</pre>
<p>Get the disk number of the SSD under <i>Disk Number</i> from the Magician SSD management utility:
</p>
<pre># magician --list
</pre>
<p>Update the SSD firmware for the specified disk by providing the firmware package path:
</p>
<pre># magician --disk <i>disk_num</i> --firmware-update --fwpackage-path /mnt/<i>firmware_package_path</i>
</pre>
<p>Finally, verify whether the firmware was successfully updated by checking the version under <i>Firmware</i> from the output of <code>magician --list</code> (with root privileges). Reboot your system if so.
</p>
<h3><span class="mw-headline" id="SanDisk">SanDisk</span></h3>
<p>SanDisk makes ISO firmware images to allow SSD firmware update on operating systems that are unsupported by their SanDisk SSD Toolkit.
</p>
<p>One must choose the firmware for the correct <i>SSD model</i>, <b>and</b> the correct <i>capacity</i> that it has (e.g. 60GB, <b>or</b> 256GB). After burning the ISO firmware image, simply restart the PC to boot with the newly created CD/DVD boot disk (may work from a USB stick).
</p>
<p>The iso images just contain a linux kernel and an initrd. Extract them to <code>/boot</code> partition and boot them with <a href="../en/GRUB.html" title="GRUB">GRUB</a> or <a href="../en/Syslinux.html" title="Syslinux">Syslinux</a> to update the firmware.
</p>
<p>See also:
</p>
<ul>
<li>SanDisk Extreme SSD <a rel="nofollow" class="external text" href="https://forums.sandisk.com/t/sandisk-extreme-ssd-firmware-download-for-mac-and-linux-and-pc/74022">Manual Firmware update version R211</a>
</li>
<li>SanDisk Ultra SSD <a rel="nofollow" class="external text" href="https://forums.sandisk.com/t/sandisk-ultra-ssd-firmware-download-for-mac-and-linux-and-pc/74277">Manual Firmware update version 365A13F0</a>
</li>
<li>SanDisk Ultra+ SSD <a rel="nofollow" class="external text" href="https://forums.sandisk.com/t/sandisk-ultra-ssd-manual-firmware-update-version-x2316rl/74263">Manual Firmware update version X2316RL</a> - use <code>smartctl -i dev/disk/by-id/*SanDisk!(*part*)</code> as root to determine if a "H2" or "HP" model is used.</li>
</ul>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.reddit.com/r/archlinux/comments/rkwjm/what_should_i_keep_in_mind_when_installing_on_ssd/">Discussion on Reddit about installing Arch on an SSD</a></li>
<li><a rel="nofollow" class="external text" href="https://lore.kernel.org/linux-btrfs/20120830215008.GB2879@localhost.localdomain/">Re: Varying Leafsize and Nodesize in Btrfs</a></li>
<li><a rel="nofollow" class="external text" href="https://lore.kernel.org/linux-btrfs/5052700D.4020003@gmail.com/">Re: SSD alignment and Btrfs sector size</a></li>
<li><a rel="nofollow" class="external text" href="https://forums.anandtech.com/threads/erase-block-alignment-misinformation.2266113/">Erase Block (Alignment) Misinformation?</a></li>
<li><a rel="nofollow" class="external text" href="https://superuser.com/questions/492084/is-alignment-to-erase-block-size-needed-for-modern-ssds">Is alignment to erase block size needed for modern SSD's?</a></li>
<li><a rel="nofollow" class="external text" href="https://lore.kernel.org/linux-btrfs/jgui4j$th5$1@dough.gmane.org/">Btrfs support for efficient SSD operation (data blocks alignment)</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Storage.html" title="Category:Storage">Storage</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Solid_state_drive&amp;oldid=813462">https://wiki.archlinux.org/index.php?title=Solid_state_drive&amp;oldid=813462</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 30 July 2024, at 16:31.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
