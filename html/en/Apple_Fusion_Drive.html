<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-zebra-design-disabled vector-feature-custom-font-size-clientpref-disabled vector-feature-client-preferences-disabled vector-feature-typography-survey-disabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Apple Fusion Drive - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.41.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Apple_Fusion_Drive rootpage-Apple_Fusion_Drive skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-main-menu-container">
		</div>
	<input type="checkbox" id="vector-toc-collapsed-checkbox" class="vector-menu-checkbox">
			<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark vector-sticky-pinned-container">
				<div id="vector-toc-pinned-container" class="vector-pinned-container">
				<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Boot_into_recovery" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Boot_into_recovery">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Boot into recovery</div>
		</a>
		
		<ul id="toc-Boot_into_recovery-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Destroy_CoreStorage_and_prepare_new_volumes" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Destroy_CoreStorage_and_prepare_new_volumes">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Destroy CoreStorage and prepare new volumes</div>
		</a>
		
		<ul id="toc-Destroy_CoreStorage_and_prepare_new_volumes-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Install_macOS_on_the_HDD" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Install_macOS_on_the_HDD">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Install macOS on the HDD</div>
		</a>
		
		<ul id="toc-Install_macOS_on_the_HDD-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Proceed_installing_Arch_Linux" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Proceed_installing_Arch_Linux">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Proceed installing Arch Linux</div>
		</a>
		
		<ul id="toc-Proceed_installing_Arch_Linux-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

				</div>
	</nav>
		
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<label id="vector-toc-collapsed-button" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet vector-button-flush-left cdx-button--icon-only" for="vector-toc-collapsed-checkbox" role="button" aria-controls="vector-toc" tabindex="0" title="Table of Contents">
						<span class="vector-icon mw-ui-icon-wikimedia-listBullet"></span>
						<span>Toggle the table of contents</span>
					</label>
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Apple Fusion Drive</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Apple_Fusion_Drive" title="Apple Fusion Drive – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<nav class="vector-page-tools-landmark vector-sticky-pinned-container" aria-label="Page tools">
						<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
			
						</div>
	</nav>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<p>Apple uses a <a href="https://en.wikipedia.org/wiki/RAID" class="extiw" title="wikipedia:RAID">RAID</a> alternative called CoreStorage to merge the SSD and HDD into a single logical volume (sold as Fusion). To reinstall macOS to the HDD without using the SSD, allowing the later to be used for Arch Linux, this volume needs to be removed.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Boot_into_recovery">Boot into recovery</span></h2>
<p>The iMacs that come with Fusion also come with a rescue partition that runs itself from RAM (a virtual disk2). This will allow working on the HDD and SDD without them mounted. Power on your iMac, holding down <code>Command+R</code> to enter the recovery environment. 
</p>
<p>When the recovery has started, start a terminal from the Utilities menu.
</p>
<h2><span class="mw-headline" id="Destroy_CoreStorage_and_prepare_new_volumes">Destroy CoreStorage and prepare new volumes</span></h2>
<p>Find the CoreStorage 'Logical volume group' ID, and take note of the SSD and larger disk (disk0 &amp; 1)
</p>
<pre>diskutil cs list
</pre>
<p>Remove the CoreStorage volume
</p>
<pre>diskutil cs delete <i>volumeid</i>
</pre>
<p>Sometimes you need to unmount a volume or try the above command twice for macOS to actually run it successfuly.
</p>
<p>Zero the SSD (if you specify the correct disk this takes around 5 minutes)
This will remove everything, including the partition table, so macOS does not see the disk and will not try to use it during installation.
</p>
<pre>diskutil zeroDisk disk1
</pre>
<p>Erase the HDD (this is faster then zeroDisk and creates a new HFS+ volume for macOS)
</p>
<pre>diskutil eraseDisk JHFS+ Macintosh disk0
</pre>
<h2><span class="mw-headline" id="Install_macOS_on_the_HDD">Install macOS on the HDD</span></h2>
<p>Quit the terminal and start the macOS installer. <b>Do not use the GUI-based Disk Utility at this point</b>, it will show your disks as errored in red and will want to fix them for you. This will recreate the CoreStorage volume even if you choose not to 'fix' anything, undoing everything we have done so far. The macOS installer should show you 1 disk, which is the Journaled HFS+ volume on the HDD.
</p>
<p>Proceed by installing macOS on the HDD. Optionally, use the <b>Disk Utility</b> on the newly installed OS to resize the macOS partition and allocate some space for Linux to use besides the SSD. Now boot the Arch Linux USB stick by holding <code>Option</code> while booting your iMac. This will show you a boot menu where you can select the USB drive for booting.
</p>
<h2><span class="mw-headline" id="Proceed_installing_Arch_Linux">Proceed installing Arch Linux</span></h2>
<p>Follow the <a href="../en/Installation_guide.html" title="Installation guide">Installation guide</a>, remember to mount the <a href="../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a> (the first partition of the HDD, e.g. <code>/dev/sda1</code>) to <code>/efi</code>.
</p>
<p>When rebooting, hold <code>Option</code> to show the internal bootloader so you can select your new install. To change the default boot option to Arch Linux, you need to "bless" the newly created UEFI file. It is suggested to rename the <code>.efi</code> to <code>EFI/BOOT/BOOTX64.EFI</code>, then run the following command from macOS, after mounting the EFI system partition:
</p>
<pre># bless --device=/dev/disk1s2 --file=/Volumes/EFI/efi/BOOT/BOOTX64.EFI --setBoot
</pre>
<p>Make sure you specify a partition on the SSD as <code>--device</code>! Otherwise macOS will boot EFI from the partition, but your bootloader will not find the SSD (where the actual install is) and you will end up in rescue mode.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a href="../en/IMac_Aluminum.html" class="mw-redirect" title="IMac Aluminium">IMac Aluminium</a></li>
<li><a rel="nofollow" class="external free" href="https://blog.fosketts.net/2011/08/05/undocumented-corestorage-commands/">https://blog.fosketts.net/2011/08/05/undocumented-corestorage-commands/</a></li>
<li><a rel="nofollow" class="external free" href="https://arstechnica.com/apple/2012/11/achieving-fusion-with-a-service-training-doc-ars-tears-open-apples-fusion-drive/2/">https://arstechnica.com/apple/2012/11/achieving-fusion-with-a-service-training-doc-ars-tears-open-apples-fusion-drive/2/</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Apple.html" title="Category:Apple">Apple</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Apple_Fusion_Drive&amp;oldid=769328">https://wiki.archlinux.org/index.php?title=Apple_Fusion_Drive&amp;oldid=769328</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 25 February 2023, at 12:31.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
