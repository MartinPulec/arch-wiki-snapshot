<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>pdnsd - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Pdnsd rootpage-Pdnsd skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Configuration</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-Format" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Format">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Format</div>
			</a>
			
			<ul id="toc-Format-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-DNS_servers" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#DNS_servers">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>DNS servers</div>
			</a>
			
			<ul id="toc-DNS_servers-sublist" class="vector-toc-list">
				<li id="toc-DNS_servers_with_DHCP_connections" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#DNS_servers_with_DHCP_connections">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2.1</span>DNS servers with DHCP connections</div>
			</a>
			
			<ul id="toc-DNS_servers_with_DHCP_connections-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-OpenDNS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#OpenDNS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>OpenDNS</div>
			</a>
			
			<ul id="toc-OpenDNS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Testing" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Testing">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4</span>Testing</div>
			</a>
			
			<ul id="toc-Testing-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-System_setup" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#System_setup">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.5</span>System setup</div>
			</a>
			
			<ul id="toc-System_setup-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Tips and tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Performance_settings_for_home_broadband_users" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Performance_settings_for_home_broadband_users">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Performance settings for home broadband users</div>
			</a>
			
			<ul id="toc-Performance_settings_for_home_broadband_users-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Additional_performance_settings" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Additional_performance_settings">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Additional performance settings</div>
			</a>
			
			<ul id="toc-Additional_performance_settings-sublist" class="vector-toc-list">
				<li id="toc-TTLs_(Time-To-Live)" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#TTLs_(Time-To-Live)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.1</span>TTLs (Time-To-Live)</div>
			</a>
			
			<ul id="toc-TTLs_(Time-To-Live)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Timeouts" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Timeouts">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.2</span>Timeouts</div>
			</a>
			
			<ul id="toc-Timeouts-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Debugging" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Debugging">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.3</span>Debugging</div>
			</a>
			
			<ul id="toc-Debugging-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Cache_size" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Cache_size">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.4</span>Cache size</div>
			</a>
			
			<ul id="toc-Cache_size-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Shared_server_for_your_LAN" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Shared_server_for_your_LAN">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Shared server for your LAN</div>
			</a>
			
			<ul id="toc-Shared_server_for_your_LAN-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Name_blocking" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Name_blocking">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4</span>Name blocking</div>
			</a>
			
			<ul id="toc-Name_blocking-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-pdnsd-ctl" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#pdnsd-ctl">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.5</span>pdnsd-ctl</div>
			</a>
			
			<ul id="toc-pdnsd-ctl-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-DNSCrypt" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#DNSCrypt">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.6</span>DNSCrypt</div>
			</a>
			
			<ul id="toc-DNSCrypt-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-result_of_uptest_for_192.168.x.x:_failed" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#result_of_uptest_for_192.168.x.x:_failed">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>result of uptest for 192.168.x.x: failed</div>
			</a>
			
			<ul id="toc-result_of_uptest_for_192.168.x.x:_failed-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-FAQs" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#FAQs">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>FAQs</div>
		</a>
		
		<ul id="toc-FAQs-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">pdnsd</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Pdnsd" title="Pdnsd – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Domain_name_resolution.html" title="Domain name resolution">Domain name resolution</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="http://members.home.nl/p.a.rombouts/pdnsd/index.html">pdnsd</a> is a DNS server designed for local caching of DNS information. Correctly configured, it can significantly increase browsing speed on a broadband connection. Compared to <a href="../en/BIND.html" title="BIND">BIND</a> or <a href="../en/Dnsmasq.html" title="Dnsmasq">dnsmasq</a> it can remember its cache after a reboot; "p" stands for persistent. See <a href="../en/Domain_name_resolution.html#DNS_servers" title="Domain name resolution">Domain name resolution#DNS servers</a> for comparison with other DNS servers.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=pdnsd">pdnsd</a></span> package.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>The package comes with a sample configuration file at <code>/usr/share/doc/pdnsd/pdnsd.conf</code>. The customized configuration file should be created at <code>/etc/pdnsd.conf</code>.
</p>
<h3><span class="mw-headline" id="Format">Format</span></h3>
<p>The <code>pdnsd.conf</code> file uses a fairly simple format, but it has some differences from most other configuration files you have likely encountered. It has a collection of sections of various types. A section is started with the name of the type of section and an opening curly bracket (<b>{</b>) and is ended by a closing curly bracket (<b>}</b>). Sections cannot be nested.
</p>
<p>Inside each block is a series of options of the following format:
</p>
<pre>option_name=option_value;
</pre>
<p>Notice the semicolon at the end; unlike some formats, it is not optional.
</p>
<p>Comments are started with either <b>#</b> or <b>/*</b>. The former goes to the end of the line, the latter continues until it reaches <b>*/</b>.
</p>
<h3><span class="mw-headline" id="DNS_servers">DNS servers</span></h3>
<p>pdnsd needs to know the address of at least one DNS server to collect DNS information from. This part of the setup differs depending on whether you have a broadband connection or dial-up. Broadband users should use the first server section as a starting point, dial-up users the second, leaving the other server sections commented out.
</p>
<dl>
<dt>label</dt>
<dd>The <code>label</code> option is used to uniquely identify a server section. It is completely arbitrary, but one good choice is the name of your ISP.</dd>
<dt>ip</dt>
<dd>This option, used in the default broadband configuration, tells pdnsd the addresses of DNS servers to use. Multiple addresses should be separated by a single comma, with optional whitespace before or after the comma. You can just copy the addresses from <code>/etc/resolv.conf</code>.</dd>
<dt>file</dt>
<dd>The <code>file</code> option can be used instead of <code>ip</code> to specify a set of DNS server IPs. Its value is the path to a file with servers listed in <code>resolv.conf</code> format. The default dial-up configuration uses it because the PPP client writes <code>/etc/ppp/resolv.conf</code> with the addresses it gets from the PPP server. You should not need to change it unless you want to use a different DNS server than your ISP gives you by default.</dd>
<dt>interface</dt>
<dd>The network interface for the uptest=if option.  This defaults to eth0, which is most likely incorrect.  If the pdnsd service is started but not returning any DNS records, this may be set wrong.</dd>
</dl>
<p>The rest of the server section will work without any more changes. For details on all the available options, see the <a rel="nofollow" class="external text" href="http://members.home.nl/p.a.rombouts/pdnsd/doc.html">pdnsd manual</a>.
</p>
<h4><span class="mw-headline" id="DNS_servers_with_DHCP_connections">DNS servers with DHCP connections</span></h4>
<p>When <a href="../en/Netctl.html" title="Netctl">netctl</a> is installed, pdnsd can be notified of the ip addresses of the name servers by <a href="../en/Openresolv.html" title="Openresolv">openresolv</a> and the notifications become dynamic when you use <a href="../en/Netctl.html#Special_systemd_units" title="Netctl">Automatic switching of profiles</a>.
</p>
<p>To configure this feature, remove the broadband server section and update the dial-up server section with the following changes:
</p>
<pre>   label = resolvconf;
   file = /etc/pdnsd-resolv.conf;
</pre>
<p>Edit <code>/etc/resolvconf.conf</code> to configure <a href="../en/Openresolv.html" title="Openresolv">openresolv</a> with pdnsd as one of its subscribers:
</p>
<pre>name_servers=127.0.0.1
pdnsd_resolv=/etc/pdnsd-resolv.conf
</pre>
<p>And run <code>resolvconf -u</code> to update <code>/etc/pdnsd-resolv.conf</code> with the addresses of the name servers (ignore the error message saying that the pdnsd socket cannot be accessed). This updating is only needed once before starting manually pdnsd.
</p>
<h3><span class="mw-headline" id="OpenDNS">OpenDNS</span></h3>
<p>The <code>pdnsd.conf</code> file comes with OpenDNS settings built in; you can simply remove (or comment out) the dialup and broadband sections above it (being careful not to remove the necessary global setup at the very top of the file), and then uncomment it to use OpenDNS resolution.
</p>
<p>However, OpenDNS does some weird things to Google. You need to deny results from OpenDNS that return one of OpenDNS’s Google-proxy machines if you want to avoid this behaviour (for many people, it can increase Google requests from, say, 15ms, to 75ms+). The exact servers’ IPs change, but you can run a <code>drill www.google.com @208.67.222.222</code> (provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ldns">ldns</a></span>) to find the current IPs. You will know if the query is being proxied, because the server’s name will resolve to something like <code>google.navigation.opendns.com</code>. On one try, these addresses were <code>208.67.216.230</code> and <code>208.67.216.231</code>.
</p>
<p>Once you know the IPs, you can replace the <code>pdnsd.conf</code>’s already-existant <code>rejected</code> IPs inside the OpenDNS <code>server { …</code>} declaration. Make sure you retain the prefixes.
</p>
<p><a rel="nofollow" class="external text" href="https://www.opennic.org">OpenNIC</a> is a reliable alternative to OpenDNS.
</p>
<h3><span class="mw-headline" id="Testing">Testing</span></h3>
<p>You should now have a working <code>pdnsd</code> daemon. Start it.
</p>
<p><a href="../en/Domain_name_resolution.html#Lookup_utilities" title="Domain name resolution">Test</a> that it is now working.
</p>
<p>For the second time you look up any address using <code>127.0.0.1</code>, query time should be under 1 ms.
</p>
<h3><span class="mw-headline" id="System_setup">System setup</span></h3>
<p>Make sure to <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>pdnsd.service</code>.
</p>
<p>It starts right after <code>network.target</code>, as services that use the network rely on a working DNS, i.e. <code>network-online.target</code> (see the <a rel="nofollow" class="external text" href="https://systemd.io/NETWORK_ONLINE">upstream explanation</a>).
</p>
<p>For any PC with two or more NICs to have pdnsd operational for any wired and wireless connection please configure separate profile for each NIC in <code>pdnsd.conf</code> by specifying correct <code>interface</code>.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Performance_settings_for_home_broadband_users">Performance settings for home broadband users</span></h3>
<p>Many users have broadband connections where the DNS server is slow or unreliable, and would like to use <code>pdnsd</code> as a caching server to minimize the number of DNS queries that need to be made.  After doing the setup detailed above, the following settings in the <code>/etc/pdnsd.conf</code> will help improve the performance in this role:
</p>
<p>Under global settings:
</p>
<pre>neg_rrs_pol=on;
par_queries=1;
</pre>
<p>Under server settings:
</p>
<pre>proxy_only=on;
purge_cache=off;
</pre>
<p>The <code>neg_rrs_pol=on;</code> policy means that when a negative response comes back for a query, pdnsd server will still cache the result even if the response is not "authoritative".  This is important since watching DNS queries will reveal that there are many requests for AAAA records (DNS queries for IPv6) which will never return results since many domains are not using IPv6, as well as MX records since not every domain has an MX record.  Without the negative caching, these requests will be sent even after a domain name has been cached, and in this role you do not want the extra DNS requests being made. It is important to use this option in conjunction with the <code>proxy_only=on;</code> option to minimize the number of queries coming out of the system.
</p>
<p>The <code>par_queries=1;</code> option is useful if you specify more than one DNS server in your "server" section below.  It specifies an increment of how many parallel queries will be made at once.  For example, if four DNS servers are listed in the "server" section, and <code>par_queries=2;</code> (the default), then the first 2 servers will be queried simultaneously, and if both of the first two servers fail, <code>pdnsd</code> will move on to the next two and query them simultaneously.   The setting used above means that one DNS server at a time gets queried, so you can list two or more DNS servers in the "server" section, and the second one will only be queried if the first one fails.  This helps minimize traffic, but if the first server fails you will have to wait through the timeout before the second server will be queried.  Tweak this setting for your own preferences, and if you only specify one server in the "server" section then you do not need to worry about it.
</p>
<p>The <code>proxy_only=on;</code> setting is mentioned below in the FAQ and is important for home broadband users since you generally are using only one or two DNS servers instead of trying to do the full-blown hierarchical name resolution that a full DNS server would do. This setting will prevent <code>pdnsd</code> from resolving all the way back to the "authoritative" name server, and instead accept the results of the DNS servers that were already specified in the "server" section. Once again, this reduces the number of DNS queries you need to make, improving performance.
</p>
<p>The <code>purge_cache=off;</code> setting tells <code>pdnsd</code> not to remove cache entries even if they have outlived the DNS record's time-to-live metric.  This can be very useful when your ISP's DNS server goes down and you want to be able to access name lookups for domains you frequently use despite the outage. Records will still be bumped out of the cache based on age once the cache becomes full (see <span class="plainlinks archwiki-template-man" title="$ man 5 pdnsd.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pdnsd.conf.5">pdnsd.conf(5)</a></span> on how to set the size of the cache).
</p>
<h3><span class="mw-headline" id="Additional_performance_settings">Additional performance settings</span></h3>
<h4>
<span id="TTLs_.28Time-To-Live.29"></span><span class="mw-headline" id="TTLs_(Time-To-Live)">TTLs (Time-To-Live)</span>
</h4>
<p>Each DNS resource record returned from a server includes a maximum time-to-live, or TTL.  This tells the recipient how long to store the record and when to do a new lookup on it. Many DNS records have relatively short TTLs, such as 3600 (one hour). This means that after one hour, pdnsd will attempt a new lookup on this entry, regardless of whether it has a cached record for it available. It will improve performance to override this default TTL by setting a global minimum TTL, causing fewer lookups to be performed.  The disadvantage to using a minimum TTL that is too long is that a cached record may be out of date (the IP address of the host may be changed, but your client will not know this because it will receive the cached address).  However, most IP addresses do not change hourly or even daily.
</p>
<p>Times are specified in seconds by default, or you may append an "m", "h", "d", or "w" to the time to specify minutes, hours, days, or weeks.
</p>
<p><code>min_ttl</code> in the global settings sets a minimum TTL for cached records, causing pdnsd to ignore the default TTL in the record received from the server.  On a slow connection or with a slow DNS server, you may want to set this to several hours to reduce the number of lookups (eg <code>min_ttl=6h;</code>).
</p>
<p><code>neg_ttl</code> in the global settings sets a minimum TTL for non-existent domains.  If a server tells pdnsd that a domain does not exist, it will not try to lookup that domain again until this amount of time has elapsed.
</p>
<h4><span class="mw-headline" id="Timeouts">Timeouts</span></h4>
<p>Setting shorter timeouts means that pdnsd will give up on an entire query or a given server query more quickly, resulting in faster performance.  The disadvantage to setting timeouts too short is that pdnsd might return an error on a lookup simply because the server was not given enough time to respond.
</p>
<p><code>timeout</code> in the global settings determines when pdnsd gives up on an entire query and returns an error to your browser or other client. Setting the global timeout option makes it possible to specify quite short timeout intervals in the server sections (see below). This will have the effect that pdnsd will start querying additional servers fairly quickly if the first servers are slow to respond (but will still continue to listen for responses from the first ones). (If you use query_method=tcp_udp it is recommended that you make the global timeout at least twice as large as the largest server timeout, otherwise pdnsd may not have time to try a UDP query if a TCP connection times out.)
</p>
<p><code>tcp_qtimeout</code> in the global settings determines how long a TCP query connection may be left open.
</p>
<p><code>timeout</code> in the server settings determines how long pdnsd will wait for a response from each server.  Setting this to a shorter time means that pdnsd will give up on a non-responsive server more quickly and will move on to the next available server, sometimes resulting in a faster overall response time.  On a fast connection, setting this to 4 or 5 seconds is not unreasonable.
</p>
<h4><span class="mw-headline" id="Debugging">Debugging</span></h4>
<p>To see what servers pdnsd is using for a particular lookup, how timeouts are working, and what default TTLs are being used by domains, turn debug on in the global settings:
</p>
<pre>debug=on;
</pre>
<p>Restart pdnsd and monitor the pdnsd.service for changes with the <a href="../en/Systemd/Journal.html" class="mw-redirect" title="Systemd journal">systemd journal</a>:
</p>
<pre># journalctl -f -u pdnsd.service
</pre>
<p>Be sure to turn debug off for general use as leaving it on may degrade performance.
</p>
<h4><span class="mw-headline" id="Cache_size">Cache size</span></h4>
<p>By default, pdnsd will automatically create authoritative records for all entries in <code>/etc/hosts</code>. If you have a lot of entries, for example if you are using it for ad blocking, the default maximum cache size provided by <code>/etc/pdnsd.conf</code> may not be large enough, resulting in DNS requests not being cached for their expected amount of time. 
</p>
<p>To increase the cache size, edit the <code>perm_cache</code> line in the 'global settings' section of configuration file (size in kB).
</p>
<p>Alternatively, you can prevent pdnsd from preemptively sourcing your hosts file by adding the option <code>authrec=off</code> to the 'source' section. If, for whatever reason, setting authrec to off does not work, an easy workaround is to create a separate hosts file (eg <code>/etc/hosts-pdnsd</code>) with only your system information and point your 'source' section to that instead, while leaving your original hosts file intact. This way, pdnsd will reference <code>/etc/hosts</code> only when performing lookups. So for example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/hosts-pdnsd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#&lt;ip-address&gt;	&lt;hostname.domain.org&gt;	&lt;hostname&gt;
127.0.0.1	localhost.localdomain	my_hostname
::1		localhost.localdomain	localhost</pre>
<h3><span class="mw-headline" id="Shared_server_for_your_LAN">Shared server for your LAN</span></h3>
<p>If you have several computers on your network, you may want to make pdnsd the DNS server for them all. This allows your entire network to share a single DNS cache, making repeated lookups much faster. To allow this, simply set <code>server_ip</code> in the <code>global</code> section to the name of your network interface (usually <code>eth0</code>). If you have set up a firewall, tell it to allow connections to port 53 from any address on your network.
</p>
<p>Now you can configure the other computers on your network to use the computer running pdns as their primary dns server.
</p>
<h3><span class="mw-headline" id="Name_blocking">Name blocking</span></h3>
<p>pdnsd allows you to specify hosts or domains that it should never return results for. This allows you to use it as a primitive ad or content blocker, among other things. Create a new <code>neg</code> section in <code>pdnsd.conf</code>. <code>neg</code> sections have two main options. <code>name</code> is the name of the host or domain you want to block. <code>types</code> can be set to <code>domain</code> to block all hosts in the given domain. The default <code>pdnsd.conf</code> gives an example that blocks all ads from doubleclick.net.
</p>
<p>Since there can only be one domain set per block, this does not scale well for blocking ads, trackers or malicious content directly in <code>pdnsd.conf</code>. You may want to create separate configuration files specifically for these lists, e.g., <code>/etc/pdnsd.d/spam_domains</code> and add an <code>include</code> section in <code>pdnsd.conf</code> like
</p>
<pre>include {file="/etc/pdnsd.d/spam_domains";}
</pre>
<p>Alternatively, it is possible to add a <code>source</code> section (additional to the existing one that loads <code>/etc/hosts</code>), that loads a file in <code>/etc/hosts</code> format that binds domains to the  special IP-Address 0.0.0.0 – but this will not block subdomains since <code>/etc/hosts</code> does not allow wildcards. Doing this is equivalent to adding the rules to <code>/etc/hosts</code> but it avoids having a huge <code>/etc/hosts</code> which can break some applications.
</p>
<h3><span class="mw-headline" id="pdnsd-ctl">pdnsd-ctl</span></h3>
<p>From <span class="plainlinks archwiki-template-man" title="$ man 8 pdnsd-ctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pdnsd-ctl.8#DESCRIPTION">pdnsd-ctl(8) § DESCRIPTION</a></span>:
</p>
<dl><dd>
<b>pdnsd-ctl</b>  controls <b>pdnsd</b>, a proxy dns server with permanent caching. Note that the status control socket must be enabled (by specifying an option on the pdnsd command line or in the configuration file) before you can use <b>pdnsd-ctl</b>.</dd></dl>
<p>To do that, include the option
</p>
<pre>status_ctl = on;
</pre>
<p>in the global section of the <code>/etc/pdnsd.conf</code>.
</p>
<p>If you changed the cache directory in <code>/etc/pdnsd.conf</code>, you will have to run <code>pdnsd-ctl</code> with the <code>-c</code> option:
</p>
<pre># pdnsd-ctl -c <i>path/to/cache</i>
</pre>
<p>A couple of useful commands to get you started...
</p>
<p>View cache:
</p>
<pre># pdnsd-ctl dump
</pre>
<p>Flush cache:
</p>
<pre># pdnsd-ctl empty-cache
</pre>
<h3><span class="mw-headline" id="DNSCrypt">DNSCrypt</span></h3>
<p>pdnsd can be used with <a href="../en/Dnscrypt-proxy.html" class="mw-redirect" title="DNSCrypt">DNSCrypt</a>. DNSCrypt encrypts the domain name lookup. pdnsd then queries DNSCrypt when necessary. An example configuration is found in <a href="../en/Dnscrypt-proxy.html#pdnsd" class="mw-redirect" title="DNSCrypt">DNSCrypt#pdnsd</a>.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="result_of_uptest_for_192.168.x.x:_failed">result of uptest for 192.168.x.x: failed</span></h3>
<p>You can successfully ping your ISP's <a href="https://en.wikipedia.org/wiki/Dynamic_DNS" class="extiw" title="wikipedia:Dynamic DNS">dynamic DNS</a> server, even though the log shows the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># journalctl -f -u pdnsd.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">result of uptest for 192.168.x.x: failed
</pre>
<p>Check the interface configured in <code>/etc/pdnsd.conf</code> global section exists:
</p>
<pre>interface = any;
</pre>
<p>or the one in the server section:
</p>
<pre>interface=enp2s0;
</pre>
<p>The correct name can be found by running: <code>ifconfig</code>.
</p>
<h2><span class="mw-headline" id="FAQs">FAQs</span></h2>
<dl>
<dt>Q) It does not seem much faster to me. Why?</dt>
<dd>
<b>A)</b> The extra speed gained from running a local DNS cache is all in how long it takes to connect to a server. Throughput, what people normally think of as speed, will not be affected. The difference is most noticeable when browsing the web, as that typically involves small downloads from several servers. With slower connections, especially dial-up, throughput is the primary bottleneck, so there will not be as large a difference percentage-wise.</dd>
<dt>Q) Why is it so much slower now than before?</dt>
<dd>
<b>A)</b> You almost certainly have the <code>proxy_only</code> option turned off in one of the server sections of <code>pdnsd.conf</code>. By default, pdnsd frequently asks several DNS servers about a domain to get the most accurate response possible. The <code>proxy_only</code> option disables this feature. It should be turned on if you use the DNS server provided by your ISP.</dd>
</dl>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Domain_Name_System.html" title="Category:Domain Name System">Domain Name System</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Pdnsd&amp;oldid=800805">https://wiki.archlinux.org/index.php?title=Pdnsd&amp;oldid=800805</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 19 February 2024, at 19:44.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
