<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>AWStats - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-AWStats rootpage-AWStats skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Configuration</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-Enable_mod_perl_for_Apache" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enable_mod_perl_for_Apache">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Enable mod_perl for Apache</div>
			</a>
			
			<ul id="toc-Enable_mod_perl_for_Apache-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Configure_Apache_to_log_for_AWStats" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Configure_Apache_to_log_for_AWStats">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Configure Apache to log for AWStats</div>
			</a>
			
			<ul id="toc-Configure_Apache_to_log_for_AWStats-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Including_AWStats_configuration_in_Apache's_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Including_AWStats_configuration_in_Apache's_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Including AWStats configuration in Apache's configuration</div>
			</a>
			
			<ul id="toc-Including_AWStats_configuration_in_Apache's_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-AWStats_Configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#AWStats_Configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4</span>AWStats Configuration</div>
			</a>
			
			<ul id="toc-AWStats_Configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Nginx" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Nginx">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Nginx</div>
		</a>
		
		<ul id="toc-Nginx-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Caddy" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Caddy">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Caddy</div>
		</a>
		
		<ul id="toc-Caddy-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Generating_Statistics" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Generating_Statistics">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Generating Statistics</div>
		</a>
		
			<button aria-controls="toc-Generating_Statistics-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Generating Statistics subsection</span>
			</button>
		
		<ul id="toc-Generating_Statistics-sublist" class="vector-toc-list">
			<li id="toc-systemd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#systemd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>systemd</div>
			</a>
			
			<ul id="toc-systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-cron" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#cron">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>cron</div>
			</a>
			
			<ul id="toc-cron-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-GeoIP_(optional)" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#GeoIP_(optional)">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>GeoIP (optional)</div>
		</a>
		
		<ul id="toc-GeoIP_(optional)-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">AWStats</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Awstats" title="Awstats – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p>From <a rel="nofollow" class="external text" href="https://awstats.sourceforge.net/">AWStats - Free log file analyzer for advanced statistics</a>:
</p>
<dl><dd>AWStats is a free powerful and featureful tool that generates advanced web, streaming, ftp or mail server statistics, graphically. This log analyzer works as a CGI or from command line and shows you all possible information your log contains, in few graphical web pages. It uses a partial information file to be able to process large log files, often and quickly. It can analyze log files from all major server tools like Apache log files (NCSA combined/XLF/ELF log format or common/CLF log format), WebStar, IIS (W3C log format) and a lot of other web, proxy, wap, streaming servers, mail servers and some ftp servers.</dd></dl>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=awstats">awstats</a></span> package. When <a href="../en/Apache_HTTP_Server.html" title="Apache HTTP Server">Apache HTTP Server</a> is used as a web server, the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mod_perl/">mod_perl</a></span><sup><small>AUR</small></sup> package is required as well.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<h3><span class="mw-headline" id="Enable_mod_perl_for_Apache">Enable mod_perl for Apache</span></h3>
<p>To enable <code>mod_perl</code> in Apache, you should add following line to Apache configuration (<code>/etc/httpd/conf/httpd.conf</code>):
</p>
<pre>LoadModule perl_module modules/mod_perl.so
</pre>
<h3><span class="mw-headline" id="Configure_Apache_to_log_for_AWStats">Configure Apache to log for AWStats</span></h3>
<p>By default AWStats requires Apache to record access logs as 'combined'. Unless you want a different behavior, you should set your access log format as 'combined'. To do so, your Apache configuration should look like this:
</p>
<pre>&lt;VirtualHost *:80&gt;
    ServerAdmin zxc@returnfalse.net
    DocumentRoot "/srv/http/xxx"
    ServerName www.returnfalse.net
    ErrorLog "/var/log/httpd/returnfalse-error_log"
    CustomLog "/var/log/httpd/returnfalse-access_log" combined
&lt;/VirtualHost&gt;
</pre>
<p>The important line here is:
</p>
<pre>CustomLog "/var/log/httpd/returnfalse-access_log" combined
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> At this point, if apache has started to log access with different format, AWStats will complain about this because it cannot read. So if you are changing Apache's log format now, you probably should delete old log files not to confuse AWStats.</div>
<h3>
<span id="Including_AWStats_configuration_in_Apache.27s_configuration"></span><span class="mw-headline" id="Including_AWStats_configuration_in_Apache's_configuration">Including AWStats configuration in Apache's configuration</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The Apache HTTPD web server configuration delivered with the AUR package seems to be a bit outdated and does not include the use of the handler for Perl scripts!</div>
<p>If you set the log format, then next step is including AWStats configuration file in Apache. The package in the AUR has a default one, and it is working without any problem, if you enable the following lines in the Apache configuration (<code>/etc/httpd/conf/httpd.conf</code>): 
</p>
<pre>&lt;IfModule !mpm_prefork_module&gt;
    LoadModule cgid_module modules/mod_cgid.so
&lt;/IfModule&gt;
&lt;IfModule mpm_prefork_module&gt;
    LoadModule cgi_module modules/mod_cgi.so
&lt;/IfModule&gt;
</pre>
<p>But in case you want to create your own configuration, you can use this (using mod_perl instead of cgid_module or cgi_module):
</p>
<pre>LoadModule perl_module modules/mod_perl.so

Alias /awstatsclasses "/usr/share/webapps/awstats/classes/"
Alias /awstatscss "/usr/share/webapps/awstats/css/"
Alias /awstatsicons "/usr/share/webapps/awstats/icon/"
ScriptAlias /awstats/ "/usr/share/webapps/awstats/cgi-bin/"

&lt;Directory "/usr/share/webapps/awstats"&gt;
    AddHandler perl-script .pl
    AddHandler perl-script .cgi
    PerlResponseHandler ModPerl::Registry
    PerlOptions +ParseHeaders
    
    Options None
    AllowOverride None
    Require all granted
&lt;/Directory&gt;

DirectoryIndex index.html index.htm awstats.pl
</pre>
<p>Include this file (in AUR case, the path is <code>/etc/httpd/conf/extra/httpd-awstats.conf</code>) to Apache's main configuration:
</p>
<pre>Include conf/extra/httpd-awstats.conf
</pre>
<p>Now if you have done all steps correctly, you should be able to see AWStats running on <a rel="nofollow" class="external free" href="http://localhost/awstats/awstats.pl">http://localhost/awstats/awstats.pl</a> after <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restarting</a> Apache's <code>httpd.service</code> unit.
</p>
<p>One last thing, which is the actual aim, make AWStats read logs and convert them to stats.
</p>
<h3><span class="mw-headline" id="AWStats_Configuration">AWStats Configuration</span></h3>
<p>The package comes with an script to update stats shown on AWStats. This script reads AWStats configuration files in <code>/etc/awstats</code> and updates the stats for the sites that are defined in these configuration files. Instead of creating these configuration files, you can use AWStats' configuration tool. Run:
</p>
<pre># perl /usr/share/awstats/tools/awstats_configure.pl
</pre>
<p>and follow the instructions. If you successfully created a configuration file there is one thing that you should modify manually. Open the configuration file created by <code>awstats_configure.pl</code> with your favorite text editor. Then find the line on which <code>LogFile</code> variable is defined, and set it as the path that Apache logs accesses (which you set to be logged as 'combined' format before):
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Please change DirIcons to DirIcons="/awstatsicons" to display pictures and icons!</div>
<pre># LogFile=/var/log/httpd/returnfalse-access_log
</pre>
<p>Now you can run the script to test the results, e.g. if you have a <code>/etc/awstats/awstats.apache.conf</code> then run
</p>
<pre># /usr/share/awstats/tools/awstats_buildstaticpages.pl config=apache -update -awstatsprog=/usr/share/webapps/awstats/cgi-bin/awstats.pl -dir=/srv/http/awstats
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> With these settings anyone will be able to reach AWStats. Setting a authentication would help keeping these stats private.</div>
<h2><span class="mw-headline" id="Nginx">Nginx</span></h2>
<p>If your web server software is <i>nginx</i>, follow steps below:
</p>
<p>1. Install <i>awstats</i> as described above. It is necessary to get the folders and files owned by user <code>http</code> and group <code>http</code> with the following command:
</p>
<pre># chown -R http:http /usr/share/webapps/awstats/
</pre>
<p>2. Use the <i>awstats</i> configuration tool to generate a site configuration file as described above. Make sure the following lines are set correctly:
</p>
<pre>LogFile="/var/log/nginx/access.log"
LogFormat=1
</pre>
<p>3. To make the Perl scripts of <i>awstats</i> work on <i>nginx</i>, create <code>/etc/nginx/cgi-bin.php</code> with the following code:
</p>
<pre>&lt;?php
$descriptorspec = array(
   0 =&gt; array("pipe", "r"),  // stdin is a pipe that the child will read from
   1 =&gt; array("pipe", "w"),  // stdout is a pipe that the child will write to
   2 =&gt; array("pipe", "w")   // stderr is a file to write to
);
$newenv = $_SERVER;
$newenv["SCRIPT_FILENAME"] = $_SERVER["X_SCRIPT_FILENAME"];
$newenv["SCRIPT_NAME"] = $_SERVER["X_SCRIPT_NAME"];
if (is_executable($_SERVER["X_SCRIPT_FILENAME"])) {
   $process = proc_open($_SERVER["X_SCRIPT_FILENAME"], $descriptorspec, $pipes, NULL, $newenv);
   if (is_resource($process)) {
       fclose($pipes[0]);
       $head = fgets($pipes[1]);
       while (strcmp($head, "\n")) {
           header($head);
           $head = fgets($pipes[1]);
       }
       fpassthru($pipes[1]);
       fclose($pipes[1]);
       fclose($pipes[2]);
       $return_value = proc_close($process);
   } else {
       header("Status: 500 Internal Server Error");
       echo("Internal Server Error");
   }
} else {
   header("Status: 404 Page Not Found");
   echo("Page Not Found");
}
?&gt; 
</pre>
<p>4. Add these directives to the domain <i>nginx</i> configuration file:
</p>
<pre>location ^~ /awstatsicons {
   alias /usr/share/webapps/awstats/icon/;
   access_log off;
}
location ^~ /awstatscss {
   alias /usr/share/webapps/awstats/examples/css/;
   access_log off;
}
location ^~ /awstatsclasses {
   alias /usr/share/webapps/awstats/examples/classes/;
   access_log off;
}
location ~ ^/cgi-bin/.*\.(cgi|pl|py|rb) {
   gzip off;
   fastcgi_pass  unix:/var/run/php-fpm/php-fpm.sock;
   fastcgi_index cgi-bin.php;
   fastcgi_param SCRIPT_FILENAME    /etc/nginx/cgi-bin.php;
   fastcgi_param SCRIPT_NAME        /cgi-bin/cgi-bin.php;
   fastcgi_param X_SCRIPT_FILENAME  /usr/share/webapps/awstats$fastcgi_script_name;
   fastcgi_param X_SCRIPT_NAME      $fastcgi_script_name;
   fastcgi_param QUERY_STRING       $query_string;
   fastcgi_param REQUEST_METHOD     $request_method;
   fastcgi_param CONTENT_TYPE       $content_type;
   fastcgi_param CONTENT_LENGTH     $content_length;
   fastcgi_param GATEWAY_INTERFACE  CGI/1.1;
   fastcgi_param SERVER_SOFTWARE    nginx;
   fastcgi_param REQUEST_URI        $request_uri;
   fastcgi_param DOCUMENT_URI       $document_uri;
   fastcgi_param DOCUMENT_ROOT      $document_root;
   fastcgi_param SERVER_PROTOCOL    $server_protocol;
   fastcgi_param REMOTE_ADDR        $remote_addr;
   fastcgi_param REMOTE_PORT        $remote_port;
   fastcgi_param SERVER_ADDR        $server_addr;
   fastcgi_param SERVER_PORT        $server_port;
   fastcgi_param SERVER_NAME        $server_name;
   fastcgi_param REMOTE_USER        $remote_user;
}
</pre>
<p>5. You can access the <i>awstats</i> page of your site at <b>"http://your_domain.com/cgi-bin/awstats.pl?config=your_domain.com"</b> Optionally, you may want to add this rewrite rule to the <i>nginx</i> site configuration file:
</p>
<pre>location ~ ^/awstats {
   rewrite ^ http://your_domain.com/cgi-bin/awstats.pl?config=your_domain.com;
}
</pre>
<p>With this, you can access your <i>awstats</i> page simply by typing <b>"http://your_domain.com/awstats"</b> in the address bar of your browser.
</p>
<h2><span class="mw-headline" id="Caddy">Caddy</span></h2>
<p>If your web server software is <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=caddy">caddy</a></span>, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fcgiwrap">fcgiwrap</a></span> to get FastCGI working, then change your Caddyfile using the template below as appropriate for your configuration.
</p>
<p>1. Install <i>awstats</i> as described above. It is necessary to get the folders and files owned by user <code>http</code> and group <code>http</code> with the following command:
</p>
<pre># chown -R http:http /usr/share/webapps/awstats/
</pre>
<p>2. Use the <i>awstats</i> configuration tool to generate a site configuration file as described above. Make sure the following lines are set correctly:
</p>
<pre>LogFile="/var/log/caddy/site_combined.log"
LogFormat=1
</pre>
<p>3. Create your Caddyfile <code>/etc/caddy/caddy.conf.d/sitename</code> configuration file with these directives:
</p>
<pre>awstats.hostname.com {
#basicauth /cgi-bin username password
root /usr/share/webapps/awstats
log / /var/log/caddy/site_combined.log "{combined}"
gzip

fastcgi /cgi-bin/ unix:/var/run/fcgiwrap.sock {
env SCRIPT_DIR /usr/share/webapps/awstats/cgi-bin/
env SCRIPT_FILENAME /usr/share/webapps/awstats/cgi-bin/awstats.pl
        }
}
awstats.hostname.com/awstatsclasses {
        root /usr/share/webapps/awstats/classes
}
awstats.hostname.com/awstatscss {
        root /usr/share/webapps/awstats/css
}
awstats.hostname.com/awstatsicons/ {
        root /usr/share/webapps/awstats/icon
}
awstats.hostname.com/js {
	root /usr/share/webapps/awstats/js
}
</pre>
<p>You should now be able to view your site at the following URL:
</p>
<pre>https://awstats.hostname.com/cgi-bin/awstats.pl?config=awstats.hostname.com
</pre>
<h2><span class="mw-headline" id="Generating_Statistics">Generating Statistics</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> The command for running <code>awstats_updateall.pl</code> requires a <a href="../en/Help:Style.html#Command_line_text" title="Help:Style">user prompt</a>. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:AWStats.html">Talk:AWStats</a>)</div>
</div>
<p>You can generate the latest statistics of all your sites manually by issuing the following command:
</p>
<pre>/usr/share/awstats/tools/awstats_updateall.pl now -awstatsprog=/usr/share/webapps/awstats/cgi-bin/awstats.pl
</pre>
<h3><span class="mw-headline" id="systemd">systemd</span></h3>
<p>This process can be automated via an (hourly) systemd timer script. You will first need to create the <code>awstats-aw.service</code> and <code>awstats-aw.timer</code> units:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/awstats-aw.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Update Awstats with all site configurations located in /etc/awstats/

[Service]
Type=oneshot
ExecStart=/usr/share/awstats/tools/awstats_updateall.pl now -awstatsprog=/usr/share/webapps/awstats/cgi-bin/awstats.pl
WorkingDirectory=/usr/share</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/awstats-aw.timer</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Run the awstats-aw.service every hour to update Awstats

[Timer]
OnCalendar=hourly
Persistent=true

[Install]
WantedBy=timers.target</pre>
<p>You can then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> the service and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> the timer.
</p>
<h3><span class="mw-headline" id="cron">cron</span></h3>
<p>This process can be automated by cron. See AWStats cron template: <code>/usr/share/doc/awstats-7.5/cron.hourly</code> However, if you are using logrotate, you have to make sure the cronjob starts right before logrotate runs. Otherwise, statistics will be lost because loratate will change the access log file name to a different name not accessible by awstats. A better way to deal with this is to use web server specific logrotate script normally located in <i>/etc/logrotate.d</i> to trigger the awstats calculation. An example of nginx logrotate script is provided here. Note the addition of a <i>prerotate</i> directive:
</p>
<pre>/var/log/nginx/*log {
 daily
 missingok
 notifempty
 create 640 http log
 compress
 sharedscripts
 prerotate
   # Trigger awstats computation
   /usr/share/awstats/tools/awstats_updateall.pl now -awstatsprog=/usr/share/webapps/awstats/cgi-bin/awstats.pl
 endscript
 postrotate
    test ! -r /run/nginx.pid || kill -USR1 `cat /run/nginx.pid`
 endscript
}
</pre>
<h2>
<span id="GeoIP_.28optional.29"></span><span class="mw-headline" id="GeoIP_(optional)">GeoIP (optional)</span>
</h2>
<p>To add geo ip support, install Geo::IP module using cpan. (See <a href="../en/Perl.html#CPAN.pm" title="Perl">Perl#CPAN.pm</a> for more details.) Alternatively, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/perl-geoip/">perl-geoip</a></span><sup><small>AUR</small></sup>. Add the following line to each of the awstats site configuration files located in <code>/etc/awstats/</code>:
</p>
<pre>LoadPlugin="geoip GEOIP_STANDARD /usr/share/GeoIP/GeoIP.dat"
</pre>
<p>If you install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=geoip-database-extra">geoip-database-extra</a></span> you can also add these to your awstats site configuration:
</p>
<pre>LoadPlugin="geoip_city_maxmind GEOIP_STANDARD /usr/share/GeoIP/GeoIPCity.dat"
LoadPlugin="geoip_asn_maxmind GEOIP_STANDARD /usr/share/GeoIP/GeoIPASNum.dat+http://enc.com.au/itools/autnum.php?asn="
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li>
<a href="../en/Apache_HTTP_Server/mod_perl.html" class="mw-redirect" title="Mod perl">mod_perl</a> Apache + Perl</li>
<li><a rel="nofollow" class="external text" href="https://awstats.sourceforge.io/docs/awstats_contrib.html#CONTRIB">AWStats user-contributed tools</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Web_applications.html" title="Category:Web applications">Web applications</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=AWStats&amp;oldid=812975">https://wiki.archlinux.org/index.php?title=AWStats&amp;oldid=812975</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 29 July 2024, at 06:08.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
