<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Clevis - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.43.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Clevis rootpage-Clevis skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Installation</span>
			</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Bind_some_data" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Bind_some_data">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Bind some data</span>
			</div>
		</a>
		
		<ul id="toc-Bind_some_data-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Bind_a_LUKS_volume" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Bind_a_LUKS_volume">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Bind a LUKS volume</span>
			</div>
		</a>
		
			<button aria-controls="toc-Bind_a_LUKS_volume-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Bind a LUKS volume subsection</span>
			</button>
		
		<ul id="toc-Bind_a_LUKS_volume-sublist" class="vector-toc-list">
			<li id="toc-Mkinitcpio_hook" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Mkinitcpio_hook">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>Mkinitcpio hook</span>
				</div>
			</a>
			
			<ul id="toc-Mkinitcpio_hook-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Booster" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Booster">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>Booster</span>
				</div>
			</a>
			
			<ul id="toc-Booster-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Dracut" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Dracut">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3</span>
					<span>Dracut</span>
				</div>
			</a>
			
			<ul id="toc-Dracut-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Tips and tricks</span>
			</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-YubiKey_binding" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#YubiKey_binding">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>YubiKey binding</span>
				</div>
			</a>
			
			<ul id="toc-YubiKey_binding-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Clevis</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Clevis" title="Clevis – 日本語" lang="ja" hreflang="ja" data-title="Clevis" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Booster.html" title="Booster">Booster</a></li>
<li><a href="../en/Mkinitcpio.html" title="Mkinitcpio">Mkinitcpio</a></li>
<li><a href="../en/Dracut.html" title="Dracut">Dracut</a></li>
<li><a href="../en/Dm-crypt.html" title="Dm-crypt">Dm-crypt</a></li>
<li><a href="../en/YubiKey.html" title="YubiKey">YubiKey</a></li>
<li><a href="../en/Trusted_Platform_Module.html" title="Trusted Platform Module">Trusted Platform Module</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://github.com/latchset/clevis/">Clevis</a> allows binding a LUKS volume to a system by creating a key and encrypting it using the TPM, and sealing the key using PCR values which represent the system state at the time of the Clevis pin creation.
</p>
<p>Passwords manually entered by a user is a traditional and widely used way to unlock encrypted LUKS partitions. But it has a few disadvantages:
</p>
<ul>
<li>It requires manual intervention and thus does not work with setups that require automatic boot (e.g. a large server farm).</li>
<li>An average human brain is capable of remembering relatively simple passwords (~20-30 bits of entropy) that are much weaker than keys used for modern block ciphers (128/256 bits).</li>
</ul>
<p>A solution for it would be encrypting data with a strong key stored securely somewhere else, for example at your <a href="../en/Trusted_Platform_Module.html" class="mw-redirect" title="TPM">TPM</a> chip or <a href="../en/YubiKey.html" title="YubiKey">YubiKey</a> or some network service. Clevis is a framework that implements this idea. It allows to encrypt (in terms of clevis <i>bind</i>) data with a pluggable <i>pin</i>. Currently clevis implements 3 pins:
</p>
<ul>
<li>TPM2 data binding (works only if you have a <a href="../en/Trusted_Platform_Module.html" title="Trusted Platform Module">Trusted Platform Module</a> chip at your computer)</li>
<li>Network service (called <a rel="nofollow" class="external text" href="https://github.com/latchset/tang">Tang</a>) data binding</li>
<li>
<a href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing" class="extiw" title="wikipedia:Shamir's Secret Sharing">Shamir's Secret Sharing</a> that allows you to combine other pins.</li>
<li>YubiKey binding using an <a rel="nofollow" class="external text" href="https://github.com/anatol/clevis.go/blob/main/clevis-encrypt-yubikey">external plugin</a>.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If you use this method on your root volume, this means that, as long as the previously mentioned certain conditions are met, your computer will <b>unlock automatically</b> at boot without needing to enter an encryption password.
<ul>
<li>This means that access to data is not protected in case the hardware gets stolen.</li>
<li>Be aware that this method makes you more vulnerable to <a href="https://en.wikipedia.org/wiki/Cold_boot_attack" class="extiw" title="wikipedia:Cold boot attack">cold boot attacks</a>, because even if your computer has been powered off for a long time (ensuring the memory is completely cleared), an attacker could simply turn it on and wait for the TPM to load the key automatically. This may be a concern for high-value targets.</li>
</ul>
</div>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>To use clevis <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=clevis">clevis</a></span> package.
</p>
<h2><span class="mw-headline" id="Bind_some_data">Bind some data</span></h2>
<p>Here is an example of data binding with TPM2:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ clevis encrypt tpm2 '{}' &lt;&lt;&lt; 'hello, world'</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">eyJhbGciOiJkaXIiLCJjbGV2aXMiOnsicGluIjoidHBtMiIsInRwbTIiOnsiaGFzaCI6InNoYTI1NiIsImp3a19wcml2IjoiQU80QUlJQkxxT3FVenVDU1FmWkprNmdDN2wzMW43V3M2Y2FZd0VZS1BSR3Q0OHJEQUJBV2Z4M3pTUUNUTmtHZE9BM2FZd2RTZk9GcXZWdnVlQ3lPamFsWldCT2R4RlJKSzl5ZVRCM0pkNFktcF9HalhhNmlnLWxxNmtmMHZTWWkzOWMxVEpES1RYRVZTdnlXSlpEbGdxQ0JPMVNxeGJBd2tfSnIyRlRNY3hvNGtpSmNtMEVjbWd5dFdyME00QmcySlg4aVo3MEt1MTVjNzFORU5Ra3RjdGMtREhBVGFQcHJ2VzI2Z3d1YmUxckRfX19aV2tHaG9mX053M0M1OHlOcXF2RUpPZUwzNTZHNXJHNVVtYmUtWWV4Ujl2SEppZWlua3ZaNTJoMFVRYWVNSm9LYjJuNjlVTGZHb2J1NElTN20iLCJqd2tfcHViIjoiQUM0QUNBQUxBQUFFMGdBQUFCQUFJQ2poWDBVeTJKZVpSNU9pRU0ySktSeEtnUElYQ3dGNnRNR09NTDZ0ZnE5aiIsImtleSI6ImVjYyJ9fSwiZW5jIjoiQTI1NkdDTSJ9..1P2Emag_4k-GlhyY.MuQQYPa8QHrysZ74uA.0ddDxfZA3R-cCmaKu5yUZA
</pre>
<p>This long base64-encoded message is our text encrypted with an internal TPM key. It can be decrypted at the current computer only. Trying to decrypt it from another computer (or rather with another TPM chip) will return an error.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ clevis decrypt tpm2 '{}' &lt;&lt;&lt; 'eyJhbGciOiJkaXIiLCJjbGV2aXMiOnsicGluIjoidHBtMiIsInRwbTIiOnsiaGFzaCI6InNoYTI1NiIsImp3a19wcml2IjoiQU80QUlJQkxxT3FVenVDU1FmWkprNmdDN2wzMW43V3M2Y2FZd0VZS1BSR3Q0OHJEQUJBV2Z4M3pTUUNUTmtHZE9BM2FZd2RTZk9GcXZWdnVlQ3lPamFsWldCT2R4RlJKSzl5ZVRCM0pkNFktcF9HalhhNmlnLWxxNmtmMHZTWWkzOWMxVEpES1RYRVZTdnlXSlpEbGdxQ0JPMVNxeGJBd2tfSnIyRlRNY3hvNGtpSmNtMEVjbWd5dFdyME00QmcySlg4aVo3MEt1MTVjNzFORU5Ra3RjdGMtREhBVGFQcHJ2VzI2Z3d1YmUxckRfX19aV2tHaG9mX053M0M1OHlOcXF2RUpPZUwzNTZHNXJHNVVtYmUtWWV4Ujl2SEppZWlua3ZaNTJoMFVRYWVNSm9LYjJuNjlVTGZHb2J1NElTN20iLCJqd2tfcHViIjoiQUM0QUNBQUxBQUFFMGdBQUFCQUFJQ2poWDBVeTJKZVpSNU9pRU0ySktSeEtnUElYQ3dGNnRNR09NTDZ0ZnE5aiIsImtleSI6ImVjYyJ9fSwiZW5jIjoiQTI1NkdDTSJ9..1P2Emag_4k-GlhyY.MuQQYPa8QHrysZ74uA.0ddDxfZA3R-cCmaKu5yUZA'</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">hello, world
</pre>
<h2><span class="mw-headline" id="Bind_a_LUKS_volume">Bind a LUKS volume</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> <span style="color:red;">please use the first argument of the template to provide a brief explanation.</span> (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Clevis.html">Talk:Clevis</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Set a strong backup password in case the TPM unsealing fails, using:
<pre># cryptsetup luksAddKey /dev/sd<i>X</i>
</pre>
</div>
<p>To bind a LUKS volume to the TPM, use:
</p>
<pre># clevis luks bind -d /dev/sd<i>X</i> tpm2 '{}'
</pre>
<p>where <code>'{}'</code> contains the configuration: even with no parameters the drive cannot be decrypted from another computer, unless the attacker knows the backup password.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> To seal the LUKS key against the UEFI settings and the <a href="../en/Unified_Extensible_Firmware_Interface/Secure_Boot.html" class="mw-redirect" title="Secure Boot">Secure Boot</a> policy, use:
<pre>'{"pcr_ids":"1,7"}'
</pre>
<p>If the UEFI or Secure Boot settings are modified, the TPM will compute different PCR values and decryption will fail. This gives protection against <a href="https://en.wikipedia.org/wiki/Evil_maid_attack" class="extiw" title="wikipedia:Evil maid attack">evil maid attacks</a>. 
</p>
<p>For a list of parameters, see <span class="plainlinks archwiki-template-man" title="$ man 1 clevis-encrypt-tpm2"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/clevis-encrypt-tpm2.1#CONFIG">clevis-encrypt-tpm2(1) § CONFIG</a></span>.
</p>
<p>For a simplified explanation of the meaning of PCRs, see <a href="../en/Trusted_Platform_Module.html#Accessing_PCR_registers" title="Trusted Platform Module">Trusted Platform Module#Accessing PCR registers</a>.
</p>
<p>For a full explanation of the meanings of PCRs, see the <a rel="nofollow" class="external text" href="https://trustedcomputinggroup.org/wp-content/uploads/PC-ClientSpecific_Platform_Profile_for_TPM_2p0_Systems_v51.pdf">TCG specification</a> (§ 2.3.4).
</p>
<p>If this fails with <code>ERROR: pcr-input-file filesize does not match pcr set-list</code>, you should specify a different pcr bank:
</p>
<pre>'{"pcr_bank":"sha256","pcr_ids":"1,7"}'
</pre>
<p>As of August 2022 Clevis only supports sha1 (default) and sha256 banks, so naturally the only different option is sha256 - you can look up available and used banks using <code># tpm2_pcrread</code>.
</p>
</div>
<p>To generate a new Clevis pin after changes in system configuration that result in different PCR values, for example updating the UEFI when PCR 0 is used, run
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup luksDump /dev/sd<i>X</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Tokens:
  <i>token slot</i>: clevis
        Keyslot:  <i>keyslot</i>
</pre>
<p>to find the slot used for the Clevis pin, then
</p>
<pre># clevis luks regen -d /dev/sd<i>X</i> -s <i>keyslot</i>
</pre>
<p>To remove the Clevis binding, run:
</p>
<pre># clevis luks unbind -d /dev/sd<i>X</i> -s <i>keyslot</i> 
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Double check you have chosen the right slot, or you might lose access to your volume.</div>
<p>You can unlock a TPM-bound volume using:
</p>
<pre># clevis luks unlock -d /dev/sd<i>X</i>
</pre>
<p>For automated decryption of volumes in <a href="../en/Dm-crypt/System_configuration.html#crypttab" title="Dm-crypt/System configuration">/etc/crypttab</a>, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>clevis-luks-askpass.path</code>.
</p>
<p>For automated decryption of the root volume, we should make some changes to our <a href="../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">Initramfs</a> generators:
</p>
<h3><span class="mw-headline" id="Mkinitcpio_hook">Mkinitcpio hook</span></h3>
<p>Install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/mkinitcpio-clevis-hook/">mkinitcpio-clevis-hook</a></span><sup><small>AUR</small></sup> package. Then enable the clevis hook editing <a href="../en/Mkinitcpio.html#Configuration" class="mw-redirect" title="Mkinitcpio.conf">mkinitcpio.conf</a>: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/mkinitcpio.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Edit the hooks and add clevis before the 'encrypt' hook. Eg:
HOOKS=(.. clevis encrypt ..)</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you are using plymouth, replace the <code>plymouth-encrypt</code> hook with encrypt. <code>plymouth-encrypt</code> is reported to be buggy when the device is already unlocked. <a rel="nofollow" class="external text" href="https://github.com/kishorv06/arch-mkinitcpio-clevis-hook/issues/1">More info.</a>
</div>
<p>At the end <a href="../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">regenerate the initramfs</a>.
</p>
<h3><span class="mw-headline" id="Booster">Booster</span></h3>
<p>Luckily <a href="../en/Booster.html" title="Booster">Booster</a> automatically decrypts LUKS volumes bound using Clevis out of the box!
</p>
<p>Booster is also able to read the LUKS tokens, decode clevis information, reconstruct the password and unlock the partition automatically.
</p>
<p><i>Tang</i> (network binding) pin requires network enabled. Please refer to <a href="../en/Booster.html#Configuration" title="Booster">Booster#Configuration</a> section for more information on network configuration with booster.
</p>
<h3><span class="mw-headline" id="Dracut">Dracut</span></h3>
<p><a href="../en/Dracut.html" title="Dracut">Dracut</a> needs the following extra packages:
</p>
<ul>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libpwquality">libpwquality</a></span></li>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=luksmeta">luksmeta</a></span></li>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nmap">nmap</a></span></li>
</ul>
<p>Followed by an initramfs regeneration:
</p>
<pre># dracut -f
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you intend to use Clevis' tang PIN to unlock your drive(s), <code>curl</code> must be included in the kernel image. Add a file to <code>/etc/dracut.conf.d</code> telling dracut to include it before running <code>dracut -f</code>:
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dracut.conf.d/curl.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">install_items+=" /usr/bin/curl "
</pre>
</div>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="YubiKey_binding">YubiKey binding</span></h3>
<p>Clevis allows binding a LUKS partition using YubiKey's challenge-response mode. To bind a LUKS partition, run
</p>
<pre># clevis luks bind -d /dev/sd<i>X</i> yubikey '{"slot":1}'
</pre>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=yubikey-personalization">yubikey-personalization</a></span>. Edit the configuration file and add following option:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/booster.yaml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">extra_files: ykchalresp
</pre>
<p><a href="../en/Booster.html#Regenerate_booster_images" title="Booster">Regenerate the booster images</a>. Booster will detect this configuration during boot and use the present YubiKey to unlock the drive.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://github.com/latchset/clevis/">Project homepage</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/kishorv06/arch-mkinitcpio-clevis-hook">mkinitcpio-clevis-hook's homepage</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"><div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Clevis&amp;oldid=824671">https://wiki.archlinux.org/index.php?title=Clevis&amp;oldid=824671</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 7 January 2025, at 21:24.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki.svg" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul></ul>
</div>
</body>
</html>
