<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-zebra-design-disabled vector-feature-custom-font-size-clientpref-disabled vector-feature-client-preferences-disabled vector-feature-typography-survey-disabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>OpenSSH - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.41.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-OpenSSH rootpage-OpenSSH skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-main-menu-container">
		</div>
	<input type="checkbox" id="vector-toc-collapsed-checkbox" class="vector-menu-checkbox">
			<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark vector-sticky-pinned-container">
				<div id="vector-toc-pinned-container" class="vector-pinned-container">
				<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Client_usage" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Client_usage">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Client usage</div>
		</a>
		
			<button aria-controls="toc-Client_usage-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Client usage subsection</span>
			</button>
		
		<ul id="toc-Client_usage-sublist" class="vector-toc-list">
			<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Configuration</div>
			</a>
			
			<ul id="toc-Configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Server_usage" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Server_usage">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Server usage</div>
		</a>
		
			<button aria-controls="toc-Server_usage-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Server usage subsection</span>
			</button>
		
		<ul id="toc-Server_usage-sublist" class="vector-toc-list">
			<li id="toc-Configuration_2" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Configuration_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Configuration</div>
			</a>
			
			<ul id="toc-Configuration_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Daemon_management" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Daemon_management">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Daemon management</div>
			</a>
			
			<ul id="toc-Daemon_management-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Protection" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Protection">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Protection</div>
			</a>
			
			<ul id="toc-Protection-sublist" class="vector-toc-list">
				<li id="toc-Force_public_key_authentication" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Force_public_key_authentication">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.1</span>Force public key authentication</div>
			</a>
			
			<ul id="toc-Force_public_key_authentication-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Two-factor_authentication_and_public_keys" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Two-factor_authentication_and_public_keys">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.2</span>Two-factor authentication and public keys</div>
			</a>
			
			<ul id="toc-Two-factor_authentication_and_public_keys-sublist" class="vector-toc-list">
				<li id="toc-Authentication_providers" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Authentication_providers">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.2.1</span>Authentication providers</div>
			</a>
			
			<ul id="toc-Authentication_providers-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-PAM_setup" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#PAM_setup">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.2.2</span>PAM setup</div>
			</a>
			
			<ul id="toc-PAM_setup-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Protecting_against_brute_force_attacks" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Protecting_against_brute_force_attacks">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.3</span>Protecting against brute force attacks</div>
			</a>
			
			<ul id="toc-Protecting_against_brute_force_attacks-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Limit_root_login" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Limit_root_login">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.4</span>Limit root login</div>
			</a>
			
			<ul id="toc-Limit_root_login-sublist" class="vector-toc-list">
				<li id="toc-Deny" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Deny">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.4.1</span>Deny</div>
			</a>
			
			<ul id="toc-Deny-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Restrict" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Restrict">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.4.2</span>Restrict</div>
			</a>
			
			<ul id="toc-Restrict-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Locking_the_authorized_keys_file" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Locking_the_authorized_keys_file">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.5</span>Locking the authorized_keys file</div>
			</a>
			
			<ul id="toc-Locking_the_authorized_keys_file-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-SSH_certificates" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#SSH_certificates">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.6</span>SSH certificates</div>
			</a>
			
			<ul id="toc-SSH_certificates-sublist" class="vector-toc-list">
				<li id="toc-Create_a_host_certificate_authority_key_for_your_infrastructure" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Create_a_host_certificate_authority_key_for_your_infrastructure">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.6.1</span>Create a host certificate authority key for your infrastructure</div>
			</a>
			
			<ul id="toc-Create_a_host_certificate_authority_key_for_your_infrastructure-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Sign_a_server's_public_SSH_host_key" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Sign_a_server's_public_SSH_host_key">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.6.2</span>Sign a server's public SSH host key</div>
			</a>
			
			<ul id="toc-Sign_a_server's_public_SSH_host_key-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Move_the_new_certificate_and_configure_sshd_to_use_it" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Move_the_new_certificate_and_configure_sshd_to_use_it">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.6.3</span>Move the new certificate and configure sshd to use it</div>
			</a>
			
			<ul id="toc-Move_the_new_certificate_and_configure_sshd_to_use_it-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Configure_all_clients_to_trust_the_certificate_authority" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Configure_all_clients_to_trust_the_certificate_authority">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.6.4</span>Configure all clients to trust the certificate authority</div>
			</a>
			
			<ul id="toc-Configure_all_clients_to_trust_the_certificate_authority-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-SSH_user_certificates" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#SSH_user_certificates">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.6.5</span>SSH user certificates</div>
			</a>
			
			<ul id="toc-SSH_user_certificates-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Certificate_deployment_automation" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Certificate_deployment_automation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.6.6</span>Certificate deployment automation</div>
			</a>
			
			<ul id="toc-Certificate_deployment_automation-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-SSHFP_record" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#SSHFP_record">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.7</span>SSHFP record</div>
			</a>
			
			<ul id="toc-SSHFP_record-sublist" class="vector-toc-list">
				<li id="toc-Generate_record_entry" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Generate_record_entry">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.7.1</span>Generate record entry</div>
			</a>
			
			<ul id="toc-Generate_record_entry-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Client_configuration" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Client_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.7.2</span>Client configuration</div>
			</a>
			
			<ul id="toc-Client_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Verify_SSHFP_records_manually" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Verify_SSHFP_records_manually">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.7.3</span>Verify SSHFP records manually</div>
			</a>
			
			<ul id="toc-Verify_SSHFP_records_manually-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Tips and tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Encrypted_SOCKS_tunnel" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Encrypted_SOCKS_tunnel">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Encrypted SOCKS tunnel</div>
			</a>
			
			<ul id="toc-Encrypted_SOCKS_tunnel-sublist" class="vector-toc-list">
				<li id="toc-Step_1:_start_the_connection" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Step_1:_start_the_connection">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.1</span>Step 1: start the connection</div>
			</a>
			
			<ul id="toc-Step_1:_start_the_connection-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Step_2_(Variant_A):_configure_your_browser_(or_other_programs)" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Step_2_(Variant_A):_configure_your_browser_(or_other_programs)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.2</span>Step 2 (Variant A): configure your browser (or other programs)</div>
			</a>
			
			<ul id="toc-Step_2_(Variant_A):_configure_your_browser_(or_other_programs)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Step_2_(Variant_B):_set_up_a_local_TUN_interface" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Step_2_(Variant_B):_set_up_a_local_TUN_interface">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.3</span>Step 2 (Variant B): set up a local TUN interface</div>
			</a>
			
			<ul id="toc-Step_2_(Variant_B):_set_up_a_local_TUN_interface-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-X11_forwarding" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#X11_forwarding">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>X11 forwarding</div>
			</a>
			
			<ul id="toc-X11_forwarding-sublist" class="vector-toc-list">
				<li id="toc-Setup" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Setup">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.1</span>Setup</div>
			</a>
			
			<ul id="toc-Setup-sublist" class="vector-toc-list">
				<li id="toc-Remote" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Remote">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.1.1</span>Remote</div>
			</a>
			
			<ul id="toc-Remote-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Client" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Client">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.1.2</span>Client</div>
			</a>
			
			<ul id="toc-Client-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Usage" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Usage">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2.2</span>Usage</div>
			</a>
			
			<ul id="toc-Usage-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Forwarding_other_ports" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Forwarding_other_ports">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Forwarding other ports</div>
			</a>
			
			<ul id="toc-Forwarding_other_ports-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Jump_hosts" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Jump_hosts">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>Jump hosts</div>
			</a>
			
			<ul id="toc-Jump_hosts-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Reverse_SSH_through_a_relay" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Reverse_SSH_through_a_relay">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.5</span>Reverse SSH through a relay</div>
			</a>
			
			<ul id="toc-Reverse_SSH_through_a_relay-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Multiplexing" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Multiplexing">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.6</span>Multiplexing</div>
			</a>
			
			<ul id="toc-Multiplexing-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Speeding_up_SSH" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Speeding_up_SSH">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.7</span>Speeding up SSH</div>
			</a>
			
			<ul id="toc-Speeding_up_SSH-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Mounting_a_remote_filesystem_with_SSHFS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Mounting_a_remote_filesystem_with_SSHFS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.8</span>Mounting a remote filesystem with SSHFS</div>
			</a>
			
			<ul id="toc-Mounting_a_remote_filesystem_with_SSHFS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Keep_alive" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Keep_alive">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.9</span>Keep alive</div>
			</a>
			
			<ul id="toc-Keep_alive-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Automatically_restart_SSH_tunnels_with_systemd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Automatically_restart_SSH_tunnels_with_systemd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.10</span>Automatically restart SSH tunnels with systemd</div>
			</a>
			
			<ul id="toc-Automatically_restart_SSH_tunnels_with_systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Autossh_-_automatically_restarts_SSH_sessions_and_tunnels" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Autossh_-_automatically_restarts_SSH_sessions_and_tunnels">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.11</span>Autossh - automatically restarts SSH sessions and tunnels</div>
			</a>
			
			<ul id="toc-Autossh_-_automatically_restarts_SSH_sessions_and_tunnels-sublist" class="vector-toc-list">
				<li id="toc-Run_autossh_automatically_at_boot_via_systemd" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Run_autossh_automatically_at_boot_via_systemd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.11.1</span>Run autossh automatically at boot via systemd</div>
			</a>
			
			<ul id="toc-Run_autossh_automatically_at_boot_via_systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Alternative_service_should_SSH_daemon_fail" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Alternative_service_should_SSH_daemon_fail">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.12</span>Alternative service should SSH daemon fail</div>
			</a>
			
			<ul id="toc-Alternative_service_should_SSH_daemon_fail-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Terminal_background_color_based_on_host" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Terminal_background_color_based_on_host">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.13</span>Terminal background color based on host</div>
			</a>
			
			<ul id="toc-Terminal_background_color_based_on_host-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Network_specific_configuration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Network_specific_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.14</span>Network specific configuration</div>
			</a>
			
			<ul id="toc-Network_specific_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Private_networks_hostkeys_verification" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Private_networks_hostkeys_verification">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.15</span>Private networks hostkeys verification</div>
			</a>
			
			<ul id="toc-Private_networks_hostkeys_verification-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Run_command_at_login" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Run_command_at_login">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.16</span>Run command at login</div>
			</a>
			
			<ul id="toc-Run_command_at_login-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Agent_forwarding" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Agent_forwarding">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.17</span>Agent forwarding</div>
			</a>
			
			<ul id="toc-Agent_forwarding-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Generating_new_keys" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Generating_new_keys">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.18</span>Generating new keys</div>
			</a>
			
			<ul id="toc-Generating_new_keys-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Run_sshd_as_non-privileged_user" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Run_sshd_as_non-privileged_user">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.19</span>Run sshd as non-privileged user</div>
			</a>
			
			<ul id="toc-Run_sshd_as_non-privileged_user-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Checklist" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Checklist">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Checklist</div>
			</a>
			
			<ul id="toc-Checklist-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Connection_refused_or_timeout_problem" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connection_refused_or_timeout_problem">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Connection refused or timeout problem</div>
			</a>
			
			<ul id="toc-Connection_refused_or_timeout_problem-sublist" class="vector-toc-list">
				<li id="toc-Port_forwarding" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Port_forwarding">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.1</span>Port forwarding</div>
			</a>
			
			<ul id="toc-Port_forwarding-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Is_SSH_running_and_listening?" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Is_SSH_running_and_listening?">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.2</span>Is SSH running and listening?</div>
			</a>
			
			<ul id="toc-Is_SSH_running_and_listening?-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Are_there_firewall_rules_blocking_the_connection?" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Are_there_firewall_rules_blocking_the_connection?">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.3</span>Are there firewall rules blocking the connection?</div>
			</a>
			
			<ul id="toc-Are_there_firewall_rules_blocking_the_connection?-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Is_the_traffic_even_getting_to_your_computer?" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Is_the_traffic_even_getting_to_your_computer?">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.4</span>Is the traffic even getting to your computer?</div>
			</a>
			
			<ul id="toc-Is_the_traffic_even_getting_to_your_computer?-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Your_ISP_or_a_third_party_blocking_default_port?" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Your_ISP_or_a_third_party_blocking_default_port?">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.5</span>Your ISP or a third party blocking default port?</div>
			</a>
			
			<ul id="toc-Your_ISP_or_a_third_party_blocking_default_port?-sublist" class="vector-toc-list">
				<li id="toc-Diagnosis" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Diagnosis">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.5.1</span>Diagnosis</div>
			</a>
			
			<ul id="toc-Diagnosis-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Possible_solution" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Possible_solution">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.5.2</span>Possible solution</div>
			</a>
			
			<ul id="toc-Possible_solution-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Read_from_socket_failed:_connection_reset_by_peer" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Read_from_socket_failed:_connection_reset_by_peer">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.6</span>Read from socket failed: connection reset by peer</div>
			</a>
			
			<ul id="toc-Read_from_socket_failed:_connection_reset_by_peer-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id='toc-"[your_shell]:_No_such_file_or_directory"_/_ssh_exchange_identification_problem' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#"[your_shell]:_No_such_file_or_directory"_/_ssh_exchange_identification_problem'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>"[your shell]: No such file or directory" / ssh_exchange_identification problem</div>
			</a>
			
			<ul id='toc-"[your_shell]:_No_such_file_or_directory"_/_ssh_exchange_identification_problem-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-"Terminal_unknown"_or_"Error_opening_terminal"_error_message' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#"Terminal_unknown"_or_"Error_opening_terminal"_error_message'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>"Terminal unknown" or  "Error opening terminal" error message</div>
			</a>
			
			<ul id='toc-"Terminal_unknown"_or_"Error_opening_terminal"_error_message-sublist' class="vector-toc-list">
				<li id="toc-TERM_hack" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#TERM_hack">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4.1</span>TERM hack</div>
			</a>
			
			<ul id="toc-TERM_hack-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Connection_closed_by_x.x.x.x_[preauth]" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connection_closed_by_x.x.x.x_[preauth]">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5</span>Connection closed by x.x.x.x [preauth]</div>
			</a>
			
			<ul id="toc-Connection_closed_by_x.x.x.x_[preauth]-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-subsystem_request_failed" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#subsystem_request_failed">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.6</span>subsystem request failed</div>
			</a>
			
			<ul id="toc-subsystem_request_failed-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-id_dsa_refused_by_OpenSSH_7.0" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#id_dsa_refused_by_OpenSSH_7.0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.7</span>id_dsa refused by OpenSSH 7.0</div>
			</a>
			
			<ul id="toc-id_dsa_refused_by_OpenSSH_7.0-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-No_matching_key_exchange_method_found_by_OpenSSH_7.0" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#No_matching_key_exchange_method_found_by_OpenSSH_7.0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.8</span>No matching key exchange method found by OpenSSH 7.0</div>
			</a>
			
			<ul id="toc-No_matching_key_exchange_method_found_by_OpenSSH_7.0-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-tmux/screen_session_killed_when_disconnecting_from_SSH" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#tmux/screen_session_killed_when_disconnecting_from_SSH">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.9</span>tmux/screen session killed when disconnecting from SSH</div>
			</a>
			
			<ul id="toc-tmux/screen_session_killed_when_disconnecting_from_SSH-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-SSH_session_stops_responding" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#SSH_session_stops_responding">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.10</span>SSH session stops responding</div>
			</a>
			
			<ul id="toc-SSH_session_stops_responding-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Broken_pipe" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Broken_pipe">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.11</span>Broken pipe</div>
			</a>
			
			<ul id="toc-Broken_pipe-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Slow_daemon_startup_after_reboot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Slow_daemon_startup_after_reboot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.12</span>Slow daemon startup after reboot</div>
			</a>
			
			<ul id="toc-Slow_daemon_startup_after_reboot-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Terminate_unresponsive_SSH_connection" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Terminate_unresponsive_SSH_connection">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.13</span>Terminate unresponsive SSH connection</div>
			</a>
			
			<ul id="toc-Terminate_unresponsive_SSH_connection-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-WARNING:_REMOTE_HOST_IDENTIFICATION_HAS_CHANGED!" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#WARNING:_REMOTE_HOST_IDENTIFICATION_HAS_CHANGED!">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.14</span>WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!</div>
			</a>
			
			<ul id="toc-WARNING:_REMOTE_HOST_IDENTIFICATION_HAS_CHANGED!-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Connecting_to_a_remote_without_the_appropriate_terminfo_entry" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connecting_to_a_remote_without_the_appropriate_terminfo_entry">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.15</span>Connecting to a remote without the appropriate terminfo entry</div>
			</a>
			
			<ul id="toc-Connecting_to_a_remote_without_the_appropriate_terminfo_entry-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-Connection_through_jump_host_fails_with_"bash:_No_such_file_or_directory"' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#Connection_through_jump_host_fails_with_"bash:_No_such_file_or_directory"'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.16</span>Connection through jump host fails with "bash: No such file or directory"</div>
			</a>
			
			<ul id='toc-Connection_through_jump_host_fails_with_"bash:_No_such_file_or_directory"-sublist' class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

				</div>
	</nav>
		
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<label id="vector-toc-collapsed-button" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet vector-button-flush-left cdx-button--icon-only" for="vector-toc-collapsed-checkbox" role="button" aria-controls="vector-toc" tabindex="0" title="Table of Contents">
						<span class="vector-icon mw-ui-icon-wikimedia-listBullet"></span>
						<span>Toggle the table of contents</span>
					</label>
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">OpenSSH</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 7 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-7" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">7 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-de mw-list-item"><a href="https://wiki.archlinux.de/title/SSH" title="SSH – Deutsch" lang="de" hreflang="de" class="interlanguage-link-target"><span>Deutsch</span></a></li>
<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/OpenSSH.html" title="OpenSSH – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-fr mw-list-item"><a href="../fr/OpenSSH.html" title="OpenSSH – français" lang="fr" hreflang="fr" class="interlanguage-link-target"><span>Français</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/OpenSSH" title="OpenSSH – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/Secure_Shell.html" title="Secure Shell – português" lang="pt" hreflang="pt" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/OpenSSH.html" title="OpenSSH – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/OpenSSH" title="OpenSSH – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<nav class="vector-page-tools-landmark vector-sticky-pinned-container" aria-label="Page tools">
						<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
			
						</div>
	</nav>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/SSH_keys.html" title="SSH keys">SSH keys</a></li>
<li><a href="../en/Pam_abl.html" title="Pam abl">Pam abl</a></li>
<li><a href="../en/Fail2ban.html" title="Fail2ban">fail2ban</a></li>
<li><a href="../en/Sshguard.html" title="Sshguard">sshguard</a></li>
<li><a href="../en/SSHFS.html" class="mw-redirect" title="Sshfs">Sshfs</a></li>
<li><a href="../en/Syslog-ng.html" title="Syslog-ng">Syslog-ng</a></li>
<li><a href="../en/SFTP_chroot.html" title="SFTP chroot">SFTP chroot</a></li>
<li><a href="../en/SCP_and_SFTP.html" title="SCP and SFTP">SCP and SFTP</a></li>
<li><a href="../en/VPN_over_SSH.html" title="VPN over SSH">VPN over SSH</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/OpenSSH" class="extiw" title="wikipedia:OpenSSH">OpenSSH</a> (OpenBSD Secure Shell) is a set of computer programs providing encrypted communication sessions over a computer network using the <a href="../en/Secure_Shell.html" title="Secure Shell">Secure Shell</a> (SSH) protocol. It was created as an open source alternative to the proprietary Secure Shell software suite offered by SSH Communications Security. OpenSSH is developed as part of the OpenBSD project, which is led by Theo de Raadt.
</p>
<p>OpenSSH is occasionally confused with the similarly-named OpenSSL; however, the projects have different purposes and are developed by different teams, the similar name is drawn only from similar goals.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span> package.
</p>
<h2><span class="mw-headline" id="Client_usage">Client usage</span></h2>
<p>To connect to a server, run:
</p>
<pre>$ ssh -p <i>port</i> <i>user</i>@<i>server-address</i>
</pre>
<p>If the server only allows public-key authentication, follow <a href="../en/SSH_keys.html" title="SSH keys">SSH keys</a>.
</p>
<h3><span class="mw-headline" id="Configuration">Configuration</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span> 9.4p1-2 added <code>Include /etc/ssh/ssh_config.d/*.conf</code> to <code>/etc/ssh/ssh_config</code>. The instructions can now be made to use drop-in files. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:OpenSSH.html">Talk:OpenSSH</a>)</div>
</div>
<p>The client can be configured to store common options and hosts. All options can be declared globally or restricted to specific hosts. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.ssh/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># global options
User <i>user</i>

# host-specific options
Host <i>myserver</i>
    Hostname <i>server-address</i>
    Port     <i>port</i>
</pre>
<p>With such a configuration, the following commands are equivalent
</p>
<pre>$ ssh -p <i>port</i> <i>user</i>@<i>server-address</i>
$ ssh <i>myserver</i>
</pre>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 5 ssh_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh_config.5">ssh_config(5)</a></span> for more information.
</p>
<p>Some options do not have command line switch equivalents, but you can specify configuration options on the command line with <code>-o</code>. For example <code>-oKexAlgorithms=+diffie-hellman-group1-sha1</code>.
</p>
<h2><span class="mw-headline" id="Server_usage">Server usage</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span> 9.4p1-2 added <code>Include /etc/ssh/sshd_config.d/*.conf</code> to <code>/etc/ssh/sshd_config</code>. The instructions can now be made to use drop-in files. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:OpenSSH.html">Talk:OpenSSH</a>)</div>
</div>
<p><code>sshd</code> is the OpenSSH server daemon, configured with <code>/etc/ssh/sshd_config</code> and managed by <code>sshd.service</code>. Whenever changing the configuration, use <code>sshd</code> in test mode before restarting the service to ensure it will be able to start cleanly. Valid configurations produce no output.
</p>
<pre># sshd -t
</pre>
<h3><span class="mw-headline" id="Configuration_2">Configuration</span></h3>
<p>To allow access only for some users, add this line:
</p>
<pre>AllowUsers    <i>user1 user2</i>
</pre>
<p>To allow access only for some groups:
</p>
<pre>AllowGroups   <i>group1 group2</i>
</pre>
<p>To add a nice welcome message (e.g. from the <code>/etc/issue</code> file), configure the <code>Banner</code> option:
</p>
<pre>Banner /etc/issue
</pre>
<p>Public and private host keys are automatically generated in <code>/etc/ssh</code> by the <i>sshdgenkeys</i> <a href="#Daemon_management">service</a> and regenerated if missing even if <code>HostKeyAlgorithms</code> option in <code>sshd_config</code> allows only some. Three key pairs are provided based on the algorithms <a href="../en/SSH_keys.html#Choosing_the_authentication_key_type" title="SSH keys">rsa, ecdsa and ed25519</a>. To have sshd use a particular key, specify the following option:
</p>
<pre>HostKey /etc/ssh/ssh_host_rsa_key
</pre>
<p>If the server is to be exposed to the WAN, it is recommended to change the default port from 22 to a random higher one like this:
</p>
<pre>Port 39901
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>To help select an alternative port that is not already assigned to a common service, review the <a href="https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers" class="extiw" title="wikipedia:List of TCP and UDP port numbers">list of TCP and UDP port numbers</a>. You can also find port information locally in <code>/etc/services</code>. A port change from default port 22 will reduce the number of log entries caused by automated authentication attempts but will not eliminate them. See <a href="../en/Port_knocking.html" title="Port knocking">Port knocking</a> for related information.</li>
<li>It is recommended to disable password logins entirely. This will greatly increase security, see <a href="#Force_public_key_authentication">#Force public key authentication</a> for more information. See <a href="#Protection">#Protection</a> for more recommend security methods.</li>
<li>OpenSSH can listen to multiple ports simply by having multiple <code>Port <i>port_number</i></code> lines in the configuration file.</li>
<li>New (or missing) host key pairs can be generated by removing the pair(s) that you want to replace from <code>/etc/ssh</code> and running <code>ssh-keygen -A</code> as root.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Daemon_management">Daemon management</span></h3>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">Start/enable</a> <code>sshd.service</code>. It will keep the SSH daemon permanently active and fork for each incoming connection.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span> 8.0p1-3 removed <code>sshd.socket</code> that used systemd's socket activation due to it being susceptible to denial of service. See <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/62248">FS#62248</a> for details. If <code>sshd.socket</code> is enabled when updating to <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openssh">openssh</a></span> 8.0p1-3, the <code>sshd.socket</code> and <code>sshd@.service</code> units will be copied to <code>/etc/systemd/system/</code> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Reenable">reenabled</a>. This is only done to not break existing setups; users are still advised to migrate to <code>sshd.service</code>.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> If you continue using <code>sshd.socket</code>, be aware of its issues:
<ul>
<li>
<code>sshd.socket</code> unit may fail (e.g. due to out-of-memory situation) and <code>Restart=always</code> cannot be specified on socket units. See <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/11553">systemd issue  11553</a>.</li>
<li>Using socket activation can result in denial of service, as too many connections can cause refusal to further activate the service. See <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/62248">FS#62248</a>.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Using <code>sshd.socket</code> negates the <code>ListenAddress</code> setting, so it will allow connections over any address. To achieve the effect of setting <code>ListenAddress</code>, you must specify the port <i>and</i> IP for <code>ListenStream</code> (e.g. <code>ListenStream=192.168.1.100:22</code>) by <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">editing</a> <code>sshd.socket</code>. You must also add <code>FreeBind=true</code> under <code>[Socket]</code> or else setting the IP address will have the same drawback as setting <code>ListenAddress</code>: the socket will fail to start if the network is not up in time.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> When using socket activation, a transient instance of <code>sshd@.service</code> will be started for each connection (with different instance names). Therefore, neither <code>sshd.socket</code> nor the daemon's regular <code>sshd.service</code> allow to monitor connection attempts in the log. The logs of socket-activated instances of SSH can be seen by running <code>journalctl -u "sshd@*"</code> as root or by running <code>journalctl /usr/bin/sshd</code> as root.</div>
<h3><span class="mw-headline" id="Protection">Protection</span></h3>
<p>Allowing remote log-on through SSH is good for administrative purposes, but can pose a threat to your server's security. Often the target of brute force attacks, SSH access needs to be limited properly to prevent third parties gaining access to your server.
</p>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ssh-audit">ssh-audit</a></span> offers an automated analysis of server and client configuration.  Several other good guides and tools are available on the topic, for example:
</p>
<ul>
<li><a href="https://wiki.mozilla.org/Security/Guidelines/OpenSSH" class="extiw" title="mozillawiki:Security/Guidelines/OpenSSH">Article by Mozilla Infosec Team</a></li>
<li><a rel="nofollow" class="external text" href="https://www.ssh-audit.com/hardening_guides.html">SSH Hardening Guides</a></li>
</ul>
<h4><span class="mw-headline" id="Force_public_key_authentication">Force public key authentication</span></h4>
<p>If a client cannot authenticate through a public key, by default, the SSH server falls back to password authentication, thus allowing a malicious user to attempt to gain access by <a href="#Protecting_against_brute_force_attacks">brute-forcing</a> the password. One of the most effective ways to protect against this attack is to disable password logins entirely, and force the use of <a href="../en/SSH_keys.html" title="SSH keys">SSH keys</a>. This can be accomplished by setting the following options in the daemon configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config.d/20-force_publickey_auth.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PasswordAuthentication no
AuthenticationMethods publickey
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Before adding this to your configuration, make sure that all accounts which require SSH access have public-key authentication set up in the corresponding <code>authorized_keys</code> files. See <a href="../en/SSH_keys.html#Copying_the_public_key_to_the_remote_server" title="SSH keys">SSH keys#Copying the public key to the remote server</a> for more information.</div>
<h4><span class="mw-headline" id="Two-factor_authentication_and_public_keys">Two-factor authentication and public keys</span></h4>
<p>SSH can be set up to require multiple ways of authentication; you can tell which authentication methods are required using the <code>AuthenticationMethods</code> option. This enables you to use public keys as well as a two-factor authorization.
</p>
<h5><span class="mw-headline" id="Authentication_providers">Authentication providers</span></h5>
<p>See <a href="../en/Google_Authenticator.html" title="Google Authenticator">Google Authenticator</a> to set up Google Authenticator.
</p>
<p>For <a rel="nofollow" class="external text" href="https://duo.com/">Duo</a>, <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/duo_unix/">duo_unix</a></span><sup><small>AUR</small></sup> which will supply the <code>pam_duo.so</code> module. Read the <a rel="nofollow" class="external text" href="https://duo.com/docs/duounix">Duo Unix documentation</a> for instructions on how to setup the necessary Duo credentials (Integration Key, Secret Key, API Hostname).
</p>
<h5><span class="mw-headline" id="PAM_setup">PAM setup</span></h5>
<p>To use <a href="../en/PAM.html" title="PAM">PAM</a> with OpenSSH, edit the following files:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config.d/20-pam.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">KbdInteractiveAuthentication yes
AuthenticationMethods publickey keyboard-interactive:pam
</pre>
<p>Then you can log in with either a publickey <b>or</b> the user authentication as required by your PAM setup.
</p>
<p>If, on the other hand, you want to authenticate the user on both a publickey <b>and</b> the user authentication as required by your PAM setup, use a comma instead of a space to separate the AuthenticationMethods:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config.d/20-pam.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">KbdInteractiveAuthentication yes
AuthenticationMethods publickey<b>,</b>keyboard-interactive:pam
</pre>
<p>With required pubkey <b>and</b> pam authentication, you may wish to disable the password requirement:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pam.d/sshd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">auth      required  pam_securetty.so     #disable remote root
#Require google authenticator
auth      required  pam_google_authenticator.so
#But not password
#auth      include   system-remote-login
account   include   system-remote-login
password  include   system-remote-login
session   include   system-remote-login
</pre>
<h4><span class="mw-headline" id="Protecting_against_brute_force_attacks">Protecting against brute force attacks</span></h4>
<p>Brute forcing is a simple concept: one continuously tries to log in to a webpage or server log-in prompt like SSH with a high number of random username and password combinations.
</p>
<p>See <a href="../en/Uncomplicated_Firewall.html#Rate_limiting_with_ufw" class="mw-redirect" title="Ufw">ufw#Rate limiting with ufw</a> or <a href="../en/Simple_stateful_firewall.html#Bruteforce_attacks" title="Simple stateful firewall">Simple stateful firewall#Bruteforce attacks</a> for <a href="../en/Iptables.html" title="Iptables">iptables</a>.
</p>
<p>Alternatively, you can protect yourself from brute force attacks by using an automated script that blocks anybody trying to brute force their way in, for example <a href="../en/Fail2ban.html" title="Fail2ban">fail2ban</a> or <a href="../en/Sshguard.html" title="Sshguard">sshguard</a>.
</p>
<ul>
<li>Only allow incoming SSH connections from trusted locations</li>
<li>Use <a href="../en/Fail2ban.html" title="Fail2ban">fail2ban</a> or <a href="../en/Sshguard.html" title="Sshguard">sshguard</a> to automatically block IP addresses that fail password authentication too many times.</li>
<li>Use <a rel="nofollow" class="external text" href="https://github.com/jtniehof/pam_shield">pam_shield</a> to block IP addresses that perform too many login attempts within a certain period of time. In contrast to <a href="../en/Fail2ban.html" title="Fail2ban">fail2ban</a> or <a href="../en/Sshguard.html" title="Sshguard">sshguard</a>, this program does not take login success or failure into account.</li>
</ul>
<h4><span class="mw-headline" id="Limit_root_login">Limit root login</span></h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> Root login has been disabled by default upstream in the current version.  Unclear to me what parts of this section and subsections are redundant. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:OpenSSH.html">Talk:OpenSSH</a>)</div>
</div>
<p>It is generally considered bad practice to allow the root user to log in without restraint over SSH. There are two methods by which SSH root access can be restricted for increased security.
</p>
<h5><span class="mw-headline" id="Deny">Deny</span></h5>
<p>Sudo selectively provides root rights for actions requiring these without requiring authenticating against the root account. This allows locking the root account against access via SSH and potentially functions as a security measure against brute force attacks, since now an attacker must guess the account name in addition to the password.
</p>
<p>SSH can be configured to deny remote logins with the root user by editing the "Authentication" section in the daemon configuration file. Simply set <code>PermitRootLogin</code> to <code>no</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config.d/20-deny_root.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PermitRootLogin no</pre>
<p>Next, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> the SSH daemon.
</p>
<p>You will now be unable to log in through SSH under root, but will still be able to log in with your normal user and use <a href="../en/Su.html" title="Su">su</a> or <a href="../en/Sudo.html" title="Sudo">sudo</a> to do system administration.
</p>
<h5><span class="mw-headline" id="Restrict">Restrict</span></h5>
<p>Some automated tasks such as remote, full-system backup require full root access. To allow these in a secure way, instead of disabling root login via SSH, it is possible to only allow root logins for selected commands. This can be achieved by editing <code>~root/.ssh/authorized_keys</code>, by prefixing the desired key, e.g. as follows:
</p>
<pre>command="rrsync -ro /" ssh-rsa …
</pre>
<p>This will allow any login with this specific key only to execute the command specified between the quotes.
</p>
<p>The increased attack surface created by exposing the root user name at login can be compensated by adding the following to <code>sshd_config</code>:
</p>
<pre>PermitRootLogin forced-commands-only
</pre>
<p>This setting will not only restrict the commands which root may execute via SSH, but it will also disable the use of passwords, forcing use of public key authentication for the root account.
</p>
<p>A slightly less restrictive alternative will allow any command for root, but makes brute force attacks infeasible by enforcing public key authentication. For this option, set:
</p>
<pre>PermitRootLogin prohibit-password
</pre>
<h4><span class="mw-headline" id="Locking_the_authorized_keys_file">Locking the authorized_keys file</span></h4>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Locking this file only protects against user mistakes and a particular naive in-person attack. It <b>does not</b> provide any protection against malicious programs or breaches. Use multi-factor authentication, firewalling and practice defence in depth to prevent breaches in the first place.</div>
<p>If, for whatever reason, you think that the user in question should not be able to add or change existing keys, you can prevent them from manipulating the file.
</p>
<p>On the server, make the <code>authorized_keys</code> file read-only for the user and deny all other permissions:
</p>
<pre>$ chmod 400 ~/.ssh/authorized_keys
</pre>
<p>To prevent the user from simply changing the permissions back, <a href="../en/File_permissions_and_attributes.html#File_attributes" title="File permissions and attributes">set the immutable bit</a> on the <code>authorized_keys</code> file. To prevent the user from renaming the <code>~/.ssh</code> directory and creating a new <code>~/.ssh</code> directory and <code>authorized_keys</code> file, set the immutable bit on the <code>~/.ssh</code> directory too. To add or remove keys, you will have to remove the immutable bit from <code>authorized_keys</code> and make it writable temporarily.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> It is recommended to log changes to any <code>authorized_keys</code> file via e.g <a href="../en/Audit_framework.html#Audit_files_and_directories_access" title="Audit framework">auditd</a>.</div>
<h4><span class="mw-headline" id="SSH_certificates">SSH certificates</span></h4>
<p>While common SSH keys and manual fingerprint verification may be easy to use with a handful of hosts that are managed by a single administrator, this method of authentication does not scale at all. When a number of servers need to be accessed through SSH by several users, manually verifying ssh public key fingerprints of every host becomes nearly impossible to do securely and reliably. 
</p>
<p>The solution for this is to use SSH certificates that provide automatic verification of public key identities through a chain of trust that scales significantly better than the default trust-on-first-use approach of SSH. SSH certificates are basically nothing else than normal public SSH keys, but with an additional signature from a trusted certificate authority that verifies the key identity.
</p>
<h5><span class="mw-headline" id="Create_a_host_certificate_authority_key_for_your_infrastructure">Create a host certificate authority key for your infrastructure</span></h5>
<pre>$ ssh-keygen -t ed25519 -f ~/.ssh/ca_host_key -C 'Host certificate authority for *.example.com'
</pre>
<p>The private certificate authority key should be stored securely, ideally on a smartcard or hardware token that prevents key extraction like the <a href="../en/Nitrokey.html" title="Nitrokey">Nitrokey</a> or <a href="../en/YubiKey.html" title="YubiKey">YubiKey</a>.
</p>
<h5>
<span id="Sign_a_server.27s_public_SSH_host_key"></span><span class="mw-headline" id="Sign_a_server's_public_SSH_host_key">Sign a server's public SSH host key</span>
</h5>
<p>Copy the public server key to your local system containing the private certificate authority key to sign it:
</p>
<pre>$ ssh-keygen -h -s ~/.ssh/ca_key -I certLabel -n server01.example.com ./ssh_host_ed25519_key.pub
</pre>
<h5><span class="mw-headline" id="Move_the_new_certificate_and_configure_sshd_to_use_it">Move the new certificate and configure sshd to use it</span></h5>
<p>The generated certificate <code>ssh_host_ed25519_key-cert.pub</code> should be copied to the server at <code>/etc/ssh/</code>.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config.d/20-ed25519_key.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">HostCertificate /etc/ssh/ssh_host_ed25519_key-cert.pub
</pre>
<h5><span class="mw-headline" id="Configure_all_clients_to_trust_the_certificate_authority">Configure all clients to trust the certificate authority</span></h5>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.ssh/known_hosts</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">@cert-authority  *.example.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKL8gB/pjuff005YNazwMCqJpgsXAbQ3r4VStd/CRKwU Host certificate authority for *.example.com
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong>  When a server does not provide a certificate for identification, public key authentication is used as fallback by default.</div>
<h5><span class="mw-headline" id="SSH_user_certificates">SSH user certificates</span></h5>
<p>Depending on the number of users and method of deployment, SSH User keys can also be used with Certificates. For organizations with many ssh users, this is strongly advised to manage User key deployment securely. 
</p>
<p>The deployment of user certificates works basically the same as for server identities. More details and instructions can be found at <a href="https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Certificate-based_Authentication" class="extiw" title="wikibooks:OpenSSH/Cookbook/Certificate-based Authentication">Wikibooks:OpenSSH/Cookbook/Certificate-based Authentication</a>.
</p>
<h5><span class="mw-headline" id="Certificate_deployment_automation">Certificate deployment automation</span></h5>
<p>Automated deployment of SSH certificates can be provided by a number of open source tools. Popular examples are:
</p>
<ul>
<li><a rel="nofollow" class="external text" href="https://docs.ansible.com/ansible/latest/collections/community/crypto/openssh_cert_module.html">Ansible - openssh_cert module</a></li>
<li><a rel="nofollow" class="external text" href="https://www.privacyidea.org/">privacyIDEA - authentication server</a></li>
<li><a rel="nofollow" class="external text" href="https://theoapp.readthedocs.io/en/latest/">Theo App - authorized keys manager</a></li>
</ul>
<h4><span class="mw-headline" id="SSHFP_record">SSHFP record</span></h4>
<p>The <a href="https://en.wikipedia.org/wiki/SSHFP_record" class="extiw" title="wikipedia:SSHFP record">Secure Shell fingerprint record (SSHFP)</a> is an optional resource record in the domain name system that associates SSH keys to a host name. It can be used to verify the SSH fingerprint on public servers by using DNSSEC instead of deploying trusted CA certificates, which allows even unmanaged clients to verify the validity of key fingerprints.
</p>
<h5><span class="mw-headline" id="Generate_record_entry">Generate record entry</span></h5>
<p>To generate the required hexadecimal key fingerprint to be stored in the DNS record, create the hash on the target server.
</p>
<pre>$ ssh-keygen -r host.example.com
</pre>
<p>This will read all available SSH keys for the specified domain and output valid SSHFP records that can then be stored in the DNS entries of the affected domain.
</p>
<h5><span class="mw-headline" id="Client_configuration">Client configuration</span></h5>
<p>In order to automatically retrive and trust SSH key fingerprints stored as SSHFP records, add the following to your ssh client configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.ssh/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># global options
Match all
    VerifyHostKeyDNS yes
</pre>
<p>If the target host has a valid SSHFP record and this record is verified with a valid DNSSEC signature, the fingerprint is automatically accepted without prompting the user to verify the hosts identity. In case the DNS record is not verified by DNSSEC, the user will be prompted to verify the fingerprint instead.
</p>
<h5><span class="mw-headline" id="Verify_SSHFP_records_manually">Verify SSHFP records manually</span></h5>
<p>To determine the SSH fingerprint of a specific domain, use ssh-keyscan to retrieve the the DNS record manually. (Note that by default fingerprints for every available key type is provided as both SHA1 and SHA256.)
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ssh-keyscan -D github.com</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">; github.com:22 SSH-2.0-babeld-57ca1323
; github.com:22 SSH-2.0-babeld-57ca1323
github.com IN SSHFP 1 1 6f4c60375018bae0918e37d9162bc15ba40e6365
github.com IN SSHFP 1 2 b8d895ced92c0ac0e171cd2ef5ef01ba3417554a4a6480d331ccc2be3ded0f6b
; github.com:22 SSH-2.0-babeld-57ca1323
github.com IN SSHFP 3 1 3358ab5dd3e306c461c840f7487e93b697e30600
github.com IN SSHFP 3 2 a764003173480b54c96167883adb6b55cf7cfd1d415055aedff2e2c8a8147d03
; github.com:22 SSH-2.0-babeld-57ca1323
github.com IN SSHFP 4 1 e9619e2ed56c2f2a71729db80bacc2ce9ccce8d4
github.com IN SSHFP 4 2 f83898df0bef57a4ee24985ba598ac17fccb0c0d333cc4af1dd92be14bc23aa5
; github.com:22 SSH-2.0-babeld-57ca1323
</pre>
<p>Since the SSHFP record stores the key fingerprints as hexadecimal values while the common output for SSH fingerprints is the base64 encoded SHA256 hash of the public key, it is necessary to convert the record back to the base64 format in order to compare it with values in the known_hosts file or other documentation that commonly stores fingerprints as SHA256.
</p>
<pre>$ echo "SSHFP-fingerprint" | xxd -r -p | base64
</pre>
<p>Example for github.com using the hex value for the sha256 fingerprint of the key type ed25519
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ echo "f83898df0bef57a4ee24985ba598ac17fccb0c0d333cc4af1dd92be14bc23aa5" | xxd -r -p | base64</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">+DiY3wvvV6TuJJhbpZisF/zLDA0zPMSvHdkr4UvCOqU=</pre>
<p>Compare with known_hosts entries:
</p>
<pre>$ ssh-keygen -l -f ~/.ssh/known_hosts
</pre>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Encrypted_SOCKS_tunnel">Encrypted SOCKS tunnel</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> Written like a blog post. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:OpenSSH.html">Talk:OpenSSH</a>)</div>
</div>
<p>This is highly useful for laptop users connected to various unsafe wireless connections. The only thing you need is an SSH server running at a somewhat secure location, like your home or at work. It might be useful to use a dynamic DNS service like <a rel="nofollow" class="external text" href="https://dyn.com/dns/">DynDNS</a> so you do not have to remember your IP-address.
</p>
<h4><span class="mw-headline" id="Step_1:_start_the_connection">Step 1: start the connection</span></h4>
<p>You only have to execute this single command to start the connection:
</p>
<pre>$ ssh -TND 4711 <i>user</i>@<i>host</i>
</pre>
<p>where <code><i>user</i></code> is your username at the SSH server running at the <code><i>host</i></code>. It will ask for your password, and then you are connected. The <code>N</code> flag disables the interactive prompt, and the <code>D</code> flag specifies the local port on which to listen on (you can choose any port number if you want).  The <code>T</code> flag disables pseudo-tty allocation.
</p>
<p>It is nice to add the verbose (<code>-v</code>) flag, because then you can verify that it is actually connected from that output.
</p>
<h4>
<span id="Step_2_.28Variant_A.29:_configure_your_browser_.28or_other_programs.29"></span><span class="mw-headline" id="Step_2_(Variant_A):_configure_your_browser_(or_other_programs)">Step 2 (Variant A): configure your browser (or other programs)</span>
</h4>
<p>The above step is useful only in combination with a web browser or another program that uses this newly created SOCKS tunnel. Since SSH currently supports both SOCKS v4 and SOCKS v5, you can use either of them.
</p>
<ul><li>For Firefox: At <i>Preferences &gt; General</i> navigates to the bottom of the page and click <i>Settings...</i>, which is to the right of the Network Settings title. Next, within the new semi window, check the <i>Manual proxy configuration</i> option and enter <code>localhost</code> in the <i>SOCKS host</i> text field, and the port number in the <i>Port</i> text field (<code>4711</code> in the example above) next to it.</li></ul>
<dl>
<dd>Firefox does not automatically make DNS requests through the socks tunnel. This potential privacy concern can be mitigated by scrolling further down, checking in the <i>Proxy DNS when using SOCKS v5</i>. Obviously, this will only work if you chooses SOCKS v5 rather than v4.</dd>
<dd>Restart Firefox to activate these settings.</dd>
</dl>
<ul><li>For Chromium: You can set the SOCKS settings as environment variables or as command line options. For example, to add one of the following functions to your <code>.bashrc</code>:</li></ul>
<pre>function secure_chromium {
    port=4711
    export SOCKS_SERVER=localhost:$port
    export SOCKS_VERSION=5
    chromium &amp;
    exit
}
</pre>
<p>OR
</p>
<pre>function secure_chromium {
    port=4711
    chromium --proxy-server="socks://localhost:$port" &amp;
    exit
}
</pre>
<p>Now open a terminal and just do:
</p>
<pre>$ secure_chromium
</pre>
<p>Enjoy your secure tunnel!
</p>
<h4>
<span id="Step_2_.28Variant_B.29:_set_up_a_local_TUN_interface"></span><span class="mw-headline" id="Step_2_(Variant_B):_set_up_a_local_TUN_interface">Step 2 (Variant B): set up a local TUN interface</span>
</h4>
<p>This variant is slightly more involved upfront but results in you not having to manually configure every single application one by one to use the SOCKS proxy. It involves setting up a local TUN interface and routing traffic through it.
</p>
<p>See <a href="../en/VPN_over_SSH.html#Set_up_badvpn_and_tunnel_interface" title="VPN over SSH">VPN over SSH#Set up badvpn and tunnel interface</a>.
</p>
<h3><span class="mw-headline" id="X11_forwarding">X11 forwarding</span></h3>
<p>X11 forwarding is a mechanism that allows graphical interfaces of X11 programs running on a remote system to be displayed on a local client machine. For X11 forwarding the remote host does not need to have a full X11 system installed; however, it needs at least to have <i>xauth</i> installed. <i>xauth</i> is a utility that maintains <code>Xauthority</code> configurations used by server and client for authentication of X11 session (<a rel="nofollow" class="external text" href="http://xmodulo.com/2012/11/how-to-enable-x11-forwarding-using-ssh.html">source</a>).
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> X11 forwarding has important security implications which should be at least acknowledged by reading relevant sections of <span class="plainlinks archwiki-template-man" title="$ man 1 ssh"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh.1">ssh(1)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 5 sshd_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sshd_config.5">sshd_config(5)</a></span>, and <span class="plainlinks archwiki-template-man" title="$ man 5 ssh_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh_config.5">ssh_config(5)</a></span> manual pages. See also <a rel="nofollow" class="external text" href="https://security.stackexchange.com/questions/14815/security-concerns-with-x11-forwarding">this StackExchange question.</a>
</div>
<h4><span class="mw-headline" id="Setup">Setup</span></h4>
<h5><span class="mw-headline" id="Remote">Remote</span></h5>
<ul>
<li>
<a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xorg-xauth">xorg-xauth</a></span> packages</li>
<li>in <code>/etc/ssh/ssh<b>d</b>_config</code>:
<ul>
<li>set <code>X11Forwarding</code> to <i>yes</i>
</li>
<li>verify that <code>AllowTcpForwarding</code> and <code>X11UseLocalhost</code> options are set to <i>yes</i>, and that <code>X11DisplayOffset</code> is set to <i>10</i> (those are the default values if nothing has been changed, see <span class="plainlinks archwiki-template-man" title="$ man 5 sshd_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sshd_config.5">sshd_config(5)</a></span>)</li>
</ul>
</li>
<li>then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> the <a href="#Daemon_management"><i>sshd</i> daemon</a>.</li>
</ul>
<h5><span class="mw-headline" id="Client">Client</span></h5>
<ul>
<li>
<a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xorg-xauth">xorg-xauth</a></span> package</li>
<li>enable the <code>ForwardX11</code> option by either specifying the <code>-X</code> switch on the command line for opportunistic connections, or by setting <code>ForwardX11</code> to <i>yes</i> in the <a href="#Configuration">client's configuration</a>.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> You can enable the <code>ForwardX11Trusted</code> option (<code>-Y</code> switch on the command line) if GUI is drawing badly or you receive errors; this will prevent X11 forwardings from being subjected to the <a rel="nofollow" class="external text" href="https://www.x.org/wiki/Development/Documentation/Security/">X11 SECURITY extension</a> controls. Be sure you have read <a href="#X11_forwarding">the warning</a> at the beginning of this section if you do so.</div>
<h4><span class="mw-headline" id="Usage">Usage</span></h4>
<p>Log on to the remote machine normally, specifying the <code>-X</code> switch if <i>ForwardX11</i> was not enabled in the client's configuration file:
</p>
<pre>$ ssh -X <i>user@host</i>
</pre>
<p>If you receive errors trying to run graphical applications, try <i>ForwardX11Trusted</i> instead:
</p>
<pre>$ ssh -Y <i>user@host</i>
</pre>
<p>Given the output <code>X11 forwarding request failed</code>, redo the setup for your remote machine. Once the X11 forwarding request succeeds, you can start any X program on the remote server, and it will be forwarded to your local session:
</p>
<pre>$ xclock
</pre>
<p>Error output containing <code>Can't open display</code> indicates that <code>DISPLAY</code> is improperly set.
</p>
<p>Be careful with some applications as they check for a running instance on the local machine. <a href="../en/Firefox.html" title="Firefox">Firefox</a> is an example: either close the running Firefox instance or use the following start parameter to start a remote instance on the local machine:
</p>
<pre>$ firefox --no-remote
</pre>
<p>If you get "X11 forwarding request failed on channel 0" when you connect (and the server <code>/var/log/errors.log</code> shows "Failed to allocate internet-domain X11 display socket"), make sure package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=xorg-xauth">xorg-xauth</a></span> is installed. If its installation is not working, try to either:
</p>
<ul>
<li>enable the <code>AddressFamily any</code> option in <code>ssh<b>d</b>_config</code> on the <i>server</i>, or</li>
<li>set the <code>AddressFamily</code> option in <code>ssh<b>d</b>_config</code> on the <i>server</i> to inet.</li>
</ul>
<p>Setting it to inet may fix problems with Ubuntu clients on IPv4.
</p>
<p>For running X applications as another user on the SSH server, you need to <code>xauth add</code> the authentication line taken from <code>xauth list</code> of the SSH logged in user.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> <a rel="nofollow" class="external text" href="https://unix.stackexchange.com/a/12772">Here</a> are <a rel="nofollow" class="external text" href="https://unix.stackexchange.com/a/46748">some</a> useful <a rel="nofollow" class="external text" href="https://superuser.com/a/805060">links</a> for troubleshooting <code>X11 Forwarding</code> issues.</div>
<h3><span class="mw-headline" id="Forwarding_other_ports">Forwarding other ports</span></h3>
<p>In addition to SSH's built-in support for X11, it can also be used to securely tunnel any TCP connection, by use of local forwarding or remote forwarding.
</p>
<p>Local forwarding opens a port on the local machine, connections to which will be forwarded to the remote host and from there on to a given destination. Very often, the forwarding destination will be the same as the remote host, thus providing a secure shell and, e.g. a secure <a href="../en/List_of_applications/Internet.html#Remote_desktop" class="mw-redirect" title="VNC">VNC</a> connection, to the same machine. Local forwarding is accomplished by means of the <code>-L</code> switch and it is accompanying forwarding specification in the form of <code>&lt;tunnel port&gt;:&lt;destination address&gt;:&lt;destination port&gt;</code>.
</p>
<p>Thus:
</p>
<pre>$ ssh -L 1000:mail.google.com:25 192.168.0.100
</pre>
<p>will use SSH to login to and open a shell on <code>192.168.0.100</code>, and will also create a tunnel from the local machine's TCP port 1000 to mail.google.com on port 25. Once established, connections to <code>localhost:1000</code> will connect to the Gmail SMTP port. To Google, it will appear that any such connection (though not necessarily the data conveyed over the connection) originated from <code>192.168.0.100</code>, and such data will be secure between the local machine and 192.168.0.100, but not between <code>192.168.0.100</code> and Google, unless other measures are taken.
</p>
<p>Similarly:
</p>
<pre>$ ssh -L 2000:192.168.0.100:6001 192.168.0.100
</pre>
<p>will allow connections to <code>localhost:2000</code> which will be transparently sent to the remote host on port 6001. The preceding example is useful for VNC connections using the vncserver utility--part of the <a href="../en/TigerVNC.html" class="mw-redirect" title="Tightvnc">tightvnc</a> package--which, though very useful, is explicit about its lack of security.
</p>
<p>Remote forwarding allows the remote host to connect to an arbitrary host via the SSH tunnel and the local machine, providing a functional reversal of local forwarding, and is useful for situations where, e.g., the remote host has limited connectivity due to firewalling. It is enabled with the <code>-R</code> switch and a forwarding specification in the form of <code>&lt;tunnel port&gt;:&lt;destination address&gt;:&lt;destination port&gt;</code>.
</p>
<p>Thus:
</p>
<pre>$ ssh -R 3000:irc.libera.chat:6667 192.168.0.200
</pre>
<p>will bring up a shell on <code>192.168.0.200</code>, and connections from <code>192.168.0.200</code> to itself on port 3000 (the remote host's <code>localhost:3000</code>) will be sent over the tunnel to the local machine and then on to irc.libera.chat on port 6667, thus, in this example, allowing the use of IRC programs on the remote host to be used, even if port 6667 would normally be blocked to it.
</p>
<p>Both local and remote forwarding can be used to provide a secure "gateway", allowing other computers to take advantage of an SSH tunnel, without actually running SSH or the SSH daemon by providing a bind-address for the start of the tunnel as part of the forwarding specification, e.g. <code>&lt;tunnel address&gt;:&lt;tunnel port&gt;:&lt;destination address&gt;:&lt;destination port&gt;</code>. The <code>&lt;tunnel address&gt;</code> can be any address on the machine at the start of the tunnel. The address <code>localhost</code> allows connections via the <code>localhost</code> or loopback interface, and an empty address or <code>*</code> allow connections via any interface. By default, forwarding is limited to connections from the machine at the "beginning" of the tunnel, i.e. the <code>&lt;tunnel address&gt;</code> is set to <code>localhost</code>. Local forwarding requires no additional configuration; however, remote forwarding is limited by the remote server's SSH daemon configuration. See the <code>GatewayPorts</code> option in <span class="plainlinks archwiki-template-man" title="$ man 5 sshd_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sshd_config.5">sshd_config(5)</a></span> and <code>-L address</code> option in <span class="plainlinks archwiki-template-man" title="$ man 1 ssh"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh.1">ssh(1)</a></span> for more information about remote forwarding and local forwarding, respectively.
</p>
<h3><span class="mw-headline" id="Jump_hosts">Jump hosts</span></h3>
<p>In certain scenarios, there might not be a direct connection to your target SSH daemon, and the use of a jump server (or <a href="https://en.wikipedia.org/wiki/bastion_host" class="extiw" title="wikipedia:bastion host">bastion server</a>) is required. Thus, we attempt to connect together two or more SSH tunnels, and assuming your local keys are authorized against each server in the chain. This is possible using SSH agent forwarding (<code>-A</code>) and pseudo-terminal allocation (<code>-t</code>) which forwards your local key with the following syntax:
</p>
<pre>$ ssh -A -t -l user1 bastion1 \
  ssh -A -t -l user2 intermediate2 \
  ssh -A -t -l user3 target
</pre>
<p>This can be automated with the ProxyCommand option:
</p>
<pre>$ ssh -o ProxyCommand="ssh -W %h:%p bastion.example.org" targetserver.example.org
</pre>
<p>An easier and more secure way to do this is using the ProxyJump option with the <code>-J</code> flag:
</p>
<pre>$ ssh -J user1@bastion1,user2@intermediate2 user3@target
</pre>
<p>Multiple hosts in the <code>-J</code> directive can be separated with a comma; they will be connected to in the order listed. The <code>user...@</code> part is not required, but can be used. The host specifications for <code>-J</code> use the ssh configuration file, so specific per-host options can be set there, if needed. 
</p>
<p>The main difference between the ProxyCommand and ProxyJump options is that the later does not require a shell on the jumphost. Consequently, this also means that the jumpserver does not require access to the users login credentials or SSH agent forwarding. With the ProxyJump option, the ssh client connects through the jumpserver directly to the target server, establishing an end-to-end encrypted channel between client and target server.
</p>
<p>An equivalent of the <code>-J</code> flag in the configuration file is the <code>ProxyJump</code> option; see <span class="plainlinks archwiki-template-man" title="$ man 5 ssh_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh_config.5">ssh_config(5)</a></span> for details.
</p>
<h3><span class="mw-headline" id="Reverse_SSH_through_a_relay">Reverse SSH through a relay</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> The idea of SSH tunneling is classic, so some references for detailed explanation would be nice. E.g. <a rel="nofollow" class="external autonumber" href="https://unix.stackexchange.com/questions/46235/how-does-reverse-ssh-tunneling-work/118650#118650">[1]</a> which includes other scenarios. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:OpenSSH.html">Talk:OpenSSH</a>)</div>
</div>
<p>The idea is that the client connects to the server via another relay while the server is connected to the same relay using a reverse SSH tunnel. This is useful when the server is behind a NAT, and the relay is a publicly accessible SSH server used as a proxy to which the user has access. Therefore, the prerequisite is that the client's keys are authorized against both the relay and the server, and the server needs to be authorized against the relay as well for the reverse SSH connection.
</p>
<p>The following configuration example assumes that user1 is the user account used on client, user2 on relay and user3 on server. First, assuming we will use port 2222, the server needs to establish the reverse tunnel with:
</p>
<pre>ssh -R 2222:localhost:22 -N <i>user2</i>@<i>relay</i>
</pre>
<p>Which can also be automated with a startup script, systemd service, <a href="#Autossh_-_automatically_restarts_SSH_sessions_and_tunnels">autossh</a> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sidedoor/">sidedoor</a></span><sup><small>AUR</small></sup>.
</p>
<p>At the client side, the connection is established with:
</p>
<pre>ssh -t <i>user2</i>@<i>relay</i> ssh <i>user3</i>@localhost -p 2222
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <code>ssh <i>user3</i>@<i>relay</i> -p 2222</code> would require you to open this port in the firewall of your relay server, as well as to allow connections to this port from other addresses.</div>
<p>The remote command to establish the connection to reverse tunnel can also be defined in relay's <code>~/.ssh/authorized_keys</code> by including the <code>command</code> field as follows:
</p>
<pre>command="ssh <i>user3</i>@localhost -p 2222" <i>ssh-rsa</i> <i>KEY2</i> <i>user1</i>@<i>client</i>
</pre>
<p>In this case the connection is established with:
</p>
<pre>ssh <i>user2</i>@<i>relay</i>
</pre>
<p>Alternatively, you can add an entry to your ssh configuration that specifies both <code>RemoteCommand</code> and <code>RequestTTY</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.ssh/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Host <i>jump-destination</i>
    Hostname <i>relay</i>
    User <i>user2</i>
    RemoteCommand ssh <i>user3</i>@localhost -p 2222
    RequestTTY yes
</pre>
<p>Which will reduce connecting to:
</p>
<pre>ssh <i>jump-destination</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> SCP's autocomplete function in client's terminal will not work and even the SCP transfers themselves are not working under some configurations.</div>
<h3><span class="mw-headline" id="Multiplexing">Multiplexing</span></h3>
<p>The SSH daemon usually listens on port 22. However, it is common practice for many public internet hotspots to block all traffic that is not on the regular HTTP/S ports (80 and 443, respectively), thus effectively blocking SSH connections. The immediate solution for this is to have <code>sshd</code> listen additionally on one of the whitelisted ports:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Port 22
Port 443
</pre>
<p>However, it is likely that port 443 is already in use by a web server serving HTTPS content, in which case it is possible to use a multiplexer, such as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sslh">sslh</a></span>, which listens on the multiplexed port and can intelligently forward packets to many services.
</p>
<h3><span class="mw-headline" id="Speeding_up_SSH">Speeding up SSH</span></h3>
<p>There are several <a href="#Configuration">client configuration</a> options which can speed up connections either globally or for specific hosts. See <span class="plainlinks archwiki-template-man" title="$ man 5 ssh_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh_config.5">ssh_config(5)</a></span> for full descriptions of these options.
</p>
<ul><li>
<i>Use a faster cipher</i>: on modern CPUs with AESNI instructions, <code>aes128-gcm@openssh.com</code> and <code>aes256-gcm@openssh.com</code> should offer significantly better performance over openssh's default preferred cipher, usually <code>chacha20-poly1305@openssh.com</code>. Cipher can be selected with the <code>-c</code> flag. For a permanent effect, put <code>Ciphers</code> option in your <code>~/.ssh/config</code> with ciphers in new preferred order, e.g.:<pre>Ciphers aes128-gcm@openssh.com,aes256-gcm@openssh.com,chacha20-poly1305@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr</pre>
</li></ul>
<ul><li>
<i>Enable or disable compression</i>: compression can increase speed on slow connections; it is enabled with the <code>Compression yes</code> option or the <code>-C</code> flag. However, the compression algorithm used is the relatively slow <span class="plainlinks archwiki-template-man" title="$ man 1 gzip"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/gzip.1">gzip(1)</a></span> which becomes the bottleneck on fast networks. In order to speed up the connection, one should use the <code>Compression no</code> option on local or fast networks.</li></ul>
<ul><li>
<i>Connection sharing</i>: you can make all sessions to the same host share a single connection using these options:<pre>ControlMaster auto
ControlPersist yes
ControlPath ~/.ssh/sockets/socket-%r@%h:%p
</pre>
</li></ul>
<dl><dd>where <code>~/.ssh/sockets</code> can be any directory not writable by other users.</dd></dl>
<ul><li>
<code>ControlPersist</code> specifies how long the master should wait in the background for new clients after the initial client connection has been closed. Possible values are either:
<ul>
<li>
<code>no</code> to close the connection immediately after the last client disconnects,</li>
<li>a time in seconds,</li>
<li>
<code>yes</code> to wait forever, the connection will never be closed automatically.</li>
</ul>
</li></ul>
<ul><li>Login time can be shortened by bypassing IPv6 lookup using the <code>AddressFamily inet</code> option or <code>-4</code> flag.</li></ul>
<ul><li>Last, if you intend to use SSH for SFTP or SCP, <a rel="nofollow" class="external text" href="https://www.psc.edu/index.php/hpn-ssh">High Performance SSH/SCP</a> can significantly increase throughput by dynamically raising the SSH buffer sizes. Install the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/openssh-hpn-git/">openssh-hpn-git</a></span><sup><small>AUR</small></sup><sup>[<a href="../en/Help:Procedures.html#Fix_broken_package_links" title="Help:Procedures">broken link</a>: package not found]</sup> to use a patched version of OpenSSH with this enhancement.</li></ul>
<h3><span class="mw-headline" id="Mounting_a_remote_filesystem_with_SSHFS">Mounting a remote filesystem with SSHFS</span></h3>
<p>Please refer to the <a href="../en/SSHFS.html" title="SSHFS">SSHFS</a> article to mount a SSH-accessible remote system to a local directory, so you will be able to do any operation on the mounted files with any tool (copy, rename, edit with vim, etc.). <i>sshfs</i> is generally preferred over <i>shfs</i>, the latter has not been updated since 2004.
</p>
<h3><span class="mw-headline" id="Keep_alive">Keep alive</span></h3>
<p>By default, the SSH session automatically logs out if it has been idle for a certain time. To keep the session up, the client can send a keep-alive signal to the server if no data has been received for some time, or symmetrically the server can send messages at regular intervals if it has not heard from the client.
</p>
<ul>
<li>On the <b>server</b> side, <code>ClientAliveInterval</code> sets the timeout in seconds after which if no data has been received from the client, <i>sshd</i> will send a request for response. The default is 0, no message is sent. For example to request a response every 60 seconds from the client, set the <code>ClientAliveInterval 60</code> option in your <a href="#Configuration_2">server configuration</a>. See also the <code>ClientAliveCountMax</code> and <code>TCPKeepAlive</code> options.</li>
<li>On the <b>client</b> side, <code>ServerAliveInterval</code> controls the interval between the requests for response sent from the client to the server. For example to request a response every 120 seconds from the server, add the <code>ServerAliveInterval 120</code> option to your <a href="#Configuration">client configuration</a>. See also the <code>ServerAliveCountMax</code> and <code>TCPKeepAlive</code> options.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  To ensure a session is kept alive, only one of either the client or the server needs to send keep alive requests. If ones control both the servers and the clients, a reasonable choice is to only configure the clients that require a persistent session with a positive <code>ServerAliveInterval</code> and leave other clients and servers in their default configuration.</div>
<h3><span class="mw-headline" id="Automatically_restart_SSH_tunnels_with_systemd">Automatically restart SSH tunnels with systemd</span></h3>
<p><a href="../en/Systemd.html" title="Systemd">systemd</a> can automatically start SSH connections on boot/login <i>and</i> restart them when they fail. This makes it a useful tool for maintaining SSH tunnels.
</p>
<p>The following service can start an SSH tunnel on login using the connection settings in your <a href="#Configuration">ssh configuration</a>. If the connection closes for any reason, it waits 10 seconds before restarting it:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.config/systemd/user/tunnel.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=SSH tunnel to myserver

[Service]
Type=simple
Restart=always
RestartSec=10
ExecStart=/usr/bin/ssh -F %h/.ssh/config -N myserver
</pre>
<p>Then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> the <a href="../en/Systemd/User.html" title="Systemd/User">Systemd/User</a> service. See <a href="#Keep_alive">#Keep alive</a> for how to prevent the tunnel from timing out. If you wish to start the tunnel on boot, you might want to <a href="../en/Systemd.html#Writing_unit_files" title="Systemd">rewrite the unit</a> as a system service.
</p>
<h3><span class="mw-headline" id="Autossh_-_automatically_restarts_SSH_sessions_and_tunnels">Autossh - automatically restarts SSH sessions and tunnels</span></h3>
<p>When a session or tunnel cannot be kept alive, for example due to bad network conditions causing client disconnections, you can use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=autossh">autossh</a></span> to automatically restart them.
</p>
<p>Usage examples:
</p>
<pre>$ autossh -M 0 -o "ServerAliveInterval 45" -o "ServerAliveCountMax 2" username@example.com
</pre>
<p>Combined with <a href="../en/SSHFS.html" title="SSHFS">SSHFS</a>:
</p>
<pre>$ sshfs -o reconnect,compression=yes,transform_symlinks,ServerAliveInterval=45,ServerAliveCountMax=2,ssh_command='autossh -M 0' username@example.com: /mnt/example 
</pre>
<p>Connecting through a SOCKS-proxy set by <a href="../en/Proxy_server.html" class="mw-redirect" title="Proxy settings">Proxy settings</a>:
</p>
<pre>$ autossh -M 0 -o "ServerAliveInterval 45" -o "ServerAliveCountMax 2" -NCD 8080 username@example.com 
</pre>
<p>With the <code>-f</code> option autossh can be made to run as a background process. Running it this way however means the passphrase cannot be entered interactively.
</p>
<p>The session will end once you type <code>exit</code> in the session, or the autossh process receives a SIGTERM, SIGINT of SIGKILL signal.
</p>
<h4><span class="mw-headline" id="Run_autossh_automatically_at_boot_via_systemd">Run autossh automatically at boot via systemd</span></h4>
<p>If you want to automatically start autossh, you can create a systemd unit file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/autossh.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=AutoSSH service for port 2222
After=network.target

[Service]
Environment="AUTOSSH_GATETIME=0"
ExecStart=/usr/bin/autossh -M 0 -NL 2222:localhost:2222 -o TCPKeepAlive=yes foo@bar.com

[Install]
WantedBy=multi-user.target</pre>
<p>Here <code>AUTOSSH_GATETIME=0</code> is an environment variable specifying how long ssh must be up before autossh considers it a successful connection, setting it to 0 autossh also ignores the first run failure of ssh. This may be useful when running autossh at boot. Other environment variables are available at <span class="plainlinks archwiki-template-man" title="$ man 1 autossh"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/autossh.1">autossh(1)</a></span>. Of course, you can make this unit more complex if necessary (see the systemd documentation for details), and obviously you can use your own options for autossh, but note that the <code>-f</code> implying <code>AUTOSSH_GATETIME=0</code> does not work with systemd. 
</p>
<p>Remember to <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> and/or <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> the service afterwards.
</p>
<p>You may also need to disable ControlMaster e.g.
</p>
<pre>ExecStart=/usr/bin/autossh -M 0 -o ControlMaster=no -NL 2222:localhost:2222 -o TCPKeepAlive=yes foo@bar.com
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> It is also easy to maintain several autossh processes, to keep several tunnels alive. Just create multiple service files with different names.</div>
<h3><span class="mw-headline" id="Alternative_service_should_SSH_daemon_fail">Alternative service should SSH daemon fail</span></h3>
<p>For remote or headless servers which rely exclusively on SSH, a failure to start the SSH daemon (e.g., after a system upgrade) may prevent administration access. <a href="../en/Systemd.html" title="Systemd">systemd</a> offers a simple solution via <code>OnFailure</code> option.
</p>
<p>Let us suppose the server runs <code>sshd</code> and <a href="../en/Telnet.html" title="Telnet">telnet</a> is the fail-safe alternative of choice. Create a file as follows. Do <b>not</b> <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>telnet.socket</code>!
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/sshd.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
OnFailure=telnet.socket</pre>
<p>That's it. Telnet is not available when <code>sshd</code> is running. Should <code>sshd</code> fail to start, a telnet session can be opened for recovery.
</p>
<h3><span class="mw-headline" id="Terminal_background_color_based_on_host">Terminal background color based on host</span></h3>
<p>To better distinguish when you are on different hosts, you can set a <a rel="nofollow" class="external text" href="https://bryangilbert.com/post/etc/term/dynamic-ssh-terminal-background-colors/">different background color based on the kind of host</a>.
</p>
<p>This solution works, but is not universal (ZSH only).
</p>
<h3><span class="mw-headline" id="Network_specific_configuration">Network specific configuration</span></h3>
<p>You can use host configuration specific to the network you are connected to using a <code>Match exec</code>.
</p>
<p>For example, when using <span class="plainlinks archwiki-template-man" title="$ man 1 nmcli"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/nmcli.1">nmcli(1)</a></span>, and the connection is configured (manually or through DHCP) to use a search-domain:
</p>
<pre>Match exec "nmcli | grep domains: | grep example.com"
  CanonicalDomains example.com
  # Should you use a different username on this network
  #User username
  # Use a different known_hosts file (for private network or synchronisation)
  #UserKnownHostsFile &lt;network&gt;_known_hosts</pre>
<p>Another example for <code>Match host ... exec "..."</code>: Consider that connecting to <code>internal.example.com</code> requires a bastion/proxy (via <code>ProxyJump</code>) unless you are already connected via VPN. The fragment <code>!exec "host internal.example.com"</code> applies only when <code>internal.example.com</code> cannot be looked up via DNS. Various alternatives are discussed at <a rel="nofollow" class="external autonumber" href="https://serverfault.com/q/536043/117525">[2]</a>.
</p>
<pre>Match host internal.example.com !exec "host internal.example.com"
  ProxyJump bastion.example.com
Host internal.example.com
  User foobar</pre>
<h3><span class="mw-headline" id="Private_networks_hostkeys_verification">Private networks hostkeys verification</span></h3>
<p>Because different servers on different networks are likely to share a common private IP address, you might want to handle them differently.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> The best solution would not need a warning to use something else in practice. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:OpenSSH.html">Talk:OpenSSH</a>)</div>
</div>
<p>The best solution is to use the <a href="#Network_specific_configuration">#Network specific configuration</a> to use a different <code>UserKnownHostsFile</code> depending on the network you are on. The second solution, best used as default when you are working on new/prototype networks, would be to simply ignore hostkeys for private networks:
</p>
<pre>Host 10.* 192.168.*.* 172.31.* 172.30.* 172.2?.* 172.1?.*
    # Disable HostKey verification
    # Trust HostKey automatically
    StrictHostKeyChecking no
    # Do not save the HostKey
    UserKnownHostsFile=/dev/null
    # Do not display: "Warning: Permanently Added ..."
    LogLevel Error</pre>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> The <code>known_hosts</code> file records an IP address even when you use hostname to access the server. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:OpenSSH.html">Talk:OpenSSH</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> In a production environment, make sure to either use the hostname to access the host and/or to use network specific known_hosts files.</div>
<h3><span class="mw-headline" id="Run_command_at_login">Run command at login</span></h3>
<p>If you are using an interactive session, there are multiple ways to execute a command on login:
</p>
<ul>
<li>use the <code>authorized_keys</code> file on the remote host (see <span class="plainlinks archwiki-template-man" title="$ man 8 sshd"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sshd.8#AUTHORIZED_KEYS_FILE_FORMAT">sshd(8) § AUTHORIZED_KEYS FILE FORMAT</a></span>)</li>
<li>use <code>~/.ssh/rc</code> on the remote host if the server has enabled the <code>PermitUserRC</code> option</li>
<li>use your shell configuration file on the remote host, e.g. <code>.bashrc</code>
</li>
</ul>
<h3><span class="mw-headline" id="Agent_forwarding">Agent forwarding</span></h3>
<p>SSH agent forwarding allows you to use your local keys when connected to a server. It is <a rel="nofollow" class="external text" href="https://security.stackexchange.com/questions/7480/risks-of-ssh-to-an-untrusted-host#7504">recommended</a> to only enable agent forwarding for selected hosts.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.ssh/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Host <i>myserver.com</i>
    ForwardAgent yes
</pre>
<p>Next, configure an <a href="../en/SSH_keys.html#SSH_agents" class="mw-redirect" title="SSH agent">SSH agent</a> and add your local key with <i>ssh-add</i>.
</p>
<p>If you now connect to a remote server you will be able to connect to other services using your local keys.
</p>
<h3><span class="mw-headline" id="Generating_new_keys">Generating new keys</span></h3>
<p>New server private keys can be generated by:
</p>
<ol>
<li>Deleting all the keys, e.g.: <pre># rm /etc/ssh/ssh_host_*_key*</pre>
</li>
<li>
<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Restarting</a> <code>sshdgenkeys.service</code> or running <code>ssh-keygen -A</code> as root.</li>
</ol>
<h3><span class="mw-headline" id="Run_sshd_as_non-privileged_user">Run sshd as non-privileged user</span></h3>
<p>You may want to run <code>sshd</code> as non-privileged user in containers, or for testing, etc.
</p>
<p>Since non-privileged user cannot read host keys in <code>/etc/ssh</code>, new host keys must be generated:
</p>
<pre>$ ssh-keygen -q -N "" -t rsa -b 4096 -f <i>/path/to/host/keys/ssh_host_rsa_key</i>
$ ssh-keygen -q -N "" -t ecdsa -f <i>/path/to/host/keys/ssh_host_ecdsa_key</i>
$ ssh-keygen -q -N "" -t ed25519 -f <i>/path/to/host/keys/ssh_host_ed25519_key</i>
</pre>
<p>Create an <code>sshd_config</code> file. The example below uses a port higher than 1024, provides a new path to the host keys and disables PAM:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"><i>/path/to/sshd_config</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Port 2022
HostKey <i>/path/to/host/keys/ssh_host_rsa_key</i>
HostKey <i>/path/to/host/keys/ssh_host_ecdsa_key</i>
HostKey <i>/path/to/host/keys/ssh/ssh_host_ed25519_key</i>
UsePAM no
</pre>
<p>Run <i>sshd</i> with the created config. The <code>-D</code> flag disables daemon mode and <code>-e</code> redirects output to stderr to allow easy monitoring.
</p>
<pre>$ sshd -f <i>/path/to/sshd_config</i> -D -e
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Checklist">Checklist</span></h3>
<p>Check these simple issues before you look any further.
</p>
<ol>
<li>The configuration directory <code>~/.ssh</code>, its contents should be accessible only by the user (check this on both the client and the server), and the user's home directory should only be writable by the user: <pre>$ chmod go-w ~
$ chmod 700 ~/.ssh
$ chmod 600 ~/.ssh/*
$ chown -R $USER ~/.ssh
</pre>
</li>
<li>Check that the client's public key (e.g. <code>id_rsa.pub</code>) is in <code>~/.ssh/authorized_keys</code> on the server.</li>
<li>Check that you did not limit SSH access with <code>AllowUsers</code> or <code>AllowGroups</code> in the <a href="#Configuration_2">server config</a>.</li>
<li>Check if the user has set a password. Sometimes new users who have not yet logged in to the server do not have a password.</li>
<li>
<a href="../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Append">Append</a> <code>LogLevel DEBUG</code> to <code>/etc/ssh/sshd_config</code>.</li>
<li>Run <code>journalctl -xe</code> as root for possible (error) messages.</li>
<li>
<a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Restart</a> <code>sshd</code> and logout/login on both client and server.</li>
</ol>
<h3><span class="mw-headline" id="Connection_refused_or_timeout_problem">Connection refused or timeout problem</span></h3>
<h4><span class="mw-headline" id="Port_forwarding">Port forwarding</span></h4>
<p>If you are behind a NAT mode/router (which is likely unless you are on a VPS or publicly addressed host), make sure that your router is forwarding incoming ssh connections to your machine. Find the server's internal IP address with <code>$ ip addr</code> and set up your router to forward TCP on your SSH port to that IP. <a rel="nofollow" class="external text" href="https://portforward.com">portforward.com</a> can help with that.
</p>
<h4>
<span id="Is_SSH_running_and_listening.3F"></span><span class="mw-headline" id="Is_SSH_running_and_listening?">Is SSH running and listening?</span>
</h4>
<p>The <a href="../en/Network_configuration.html#Investigate_sockets" class="mw-redirect" title="Ss">ss</a> utility shows all the processes listening to a TCP port with the following command line:
</p>
<pre>$ ss --tcp --listening
</pre>
<p>If the above command do not show the system is listening to the port <code>ssh</code>, then SSH is not running: check the <a href="../en/Systemd/Journal.html" class="mw-redirect" title="Journal">journal</a> for errors etc.
</p>
<h4>
<span id="Are_there_firewall_rules_blocking_the_connection.3F"></span><span class="mw-headline" id="Are_there_firewall_rules_blocking_the_connection?">Are there firewall rules blocking the connection?</span>
</h4>
<p><a href="../en/Iptables.html" title="Iptables">Iptables</a> may be blocking connections on port <code>22</code>. Check this with:
</p>
<pre># iptables -nvL</pre>
<p>and look for rules that might be dropping packets on the <code>INPUT</code> chain. Then, if necessary, unblock the port with a command like: 
</p>
<pre># iptables -I INPUT 1 -p tcp --dport 22 -j ACCEPT
</pre>
<p>For more help configuring firewalls, see <a href="../en/Category:Firewalls.html" class="mw-redirect" title="Firewalls">firewalls</a>.
</p>
<h4>
<span id="Is_the_traffic_even_getting_to_your_computer.3F"></span><span class="mw-headline" id="Is_the_traffic_even_getting_to_your_computer?">Is the traffic even getting to your computer?</span>
</h4>
<p>Start a traffic dump on the computer you are having problems with:
</p>
<pre># tcpdump -lnn -i any port ssh and tcp-syn
</pre>
<p>This should show some basic information, then wait for any matching traffic to happen before displaying it. Try your connection now. If you do not see any output when you attempt to connect, then something outside of your computer is blocking the traffic (e. g., hardware firewall, NAT router etc.).
</p>
<h4>
<span id="Your_ISP_or_a_third_party_blocking_default_port.3F"></span><span class="mw-headline" id="Your_ISP_or_a_third_party_blocking_default_port?">Your ISP or a third party blocking default port?</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Try this step if you <b>know</b> you are not running any firewalls and you know you have configured the router for DMZ or have forwarded the port to your computer and it still does not work. Here you will find diagnostic steps and a possible solution.</div>
<p>In some cases, your ISP might block the default port (SSH port 22) so whatever you try (opening ports, hardening the stack, defending against flood attacks, et al) ends up useless. To confirm this, create a server on all interfaces (0.0.0.0) and connect remotely. 
</p>
<p>If you get an error message comparable to this:
</p>
<pre>ssh: connect to host www.inet.hr port 22: Connection refused
</pre>
<p>That means the port is <b>not</b> being blocked by the ISP, but the server does not run SSH on that port (See <a href="https://en.wikipedia.org/wiki/Security_through_obscurity" class="extiw" title="wikipedia:Security through obscurity">security through obscurity</a>).
</p>
<p>However, if you get an error message comparable to this:
</p>
<pre>ssh: connect to host 111.222.333.444 port 22: Operation timed out 
</pre>
<p>That means that something is rejecting your TCP traffic on port 22. Basically that port is stealth, either by your firewall or 3rd party intervention (like an ISP blocking and/or rejecting incoming traffic on port 22). If you know you are not running any firewall on your computer, and you know that Gremlins are not growing in your routers and switches, then your ISP is blocking the traffic.
</p>
<p>To double check, you can run Wireshark on your server and listen to traffic on port 22. Since Wireshark is a Layer 2 Packet Sniffing utility, and TCP/UDP are Layer 3 and above (see <a href="https://en.wikipedia.org/wiki/Internet_protocol_suite" class="extiw" title="wikipedia:Internet protocol suite">IP Network stack</a>), if you do not receive anything while connecting remotely, a third party is most likely to be blocking the traffic on that port to your server.
</p>
<h5><span class="mw-headline" id="Diagnosis">Diagnosis</span></h5>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> either <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tcpdump">tcpdump</a></span> or Wireshark with the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=wireshark-cli">wireshark-cli</a></span> package.
</p>
<p>For tcpdump:
</p>
<pre># tcpdump -ni <i>interface</i> "port 22"
</pre>
<p>For Wireshark:
</p>
<pre>$ tshark -f "tcp port 22" -i <i>interface</i>
</pre>
<p>where <code><i>interface</i></code> is the network interface for a WAN connection (see <code>ip a</code> to check). If you are not receiving any packets while trying to connect remotely, you can be very sure that your ISP is blocking the incoming traffic on port 22.
</p>
<h5><span class="mw-headline" id="Possible_solution">Possible solution</span></h5>
<p>The solution is just to use some other port that the ISP is not blocking. Open the <code>/etc/ssh/sshd_config</code> and configure the file to use different ports. For example, add:
</p>
<pre>Port 22
Port 1234
</pre>
<p>Also make sure that other "Port" configuration lines in the file are commented out. Just commenting "Port 22" and putting "Port 1234" will not solve the issue because then sshd will only listen on port 1234. Use both lines to run the SSH server on both ports. 
</p>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Restart</a> the server <code>sshd.service</code> and you are almost done. You still have to configure your client(s) to use the other port instead of the default port. There are numerous solutions to that problem, but let us cover two of them here.
</p>
<h4><span class="mw-headline" id="Read_from_socket_failed:_connection_reset_by_peer">Read from socket failed: connection reset by peer</span></h4>
<p>Recent versions of OpenSSH sometimes fail with the above error message when connecting to older ssh servers. This can be worked around by setting various <a href="#Configuration">client options</a> for that host. See <span class="plainlinks archwiki-template-man" title="$ man 5 ssh_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh_config.5">ssh_config(5)</a></span> for more information about the following options.
</p>
<p>The problem could be the <code>ecdsa-sha2-nistp*-cert-v01@openssh</code> elliptical host key algorithms. These can be disabled by setting <code>HostKeyAlgorithms</code> to a list excluding those algorithms. On the client side, the <code>HostKeyAlgorithms</code> that the client wants to use can also be set by preceding the <code>HostKeyAlgorithms</code> list with a <code>-</code> to remove the specified algorithms (including wildcards) from the default set (see <code>ssh_config(5)</code> man page).  
You can check the actually used host key algorithm with <code>ssh -v server_to_connect_to</code> in the line that contains <code>kex: host key algorithm:</code>.
</p>
<p>If that does not work, it could be that the list of ciphers is too long. Set the <code>Ciphers</code> option to a shorter list (fewer than 80 characters should be enough). Similarly, you can also try shortening the list of <code>MACs</code>.
</p>
<p>See also the <a rel="nofollow" class="external text" href="https://web.archive.org/web/20161201015151/https://www.gossamer-threads.com/lists/openssh/dev/51339">discussion</a> on the OpenSSH bug forum.
</p>
<h3>
<span id=".22.5Byour_shell.5D:_No_such_file_or_directory.22_.2F_ssh_exchange_identification_problem"></span><span class="mw-headline" id='"[your_shell]:_No_such_file_or_directory"_/_ssh_exchange_identification_problem'>"[your shell]: No such file or directory" / ssh_exchange_identification problem</span>
</h3>
<p>One possible cause for this is the need of certain SSH clients to find an absolute path (one returned by <code>whereis -b [your shell]</code>, for instance) in <code>$SHELL</code>, even if the shell's binary is located in one of the <code>$PATH</code> entries.
</p>
<h3>
<span id=".22Terminal_unknown.22_or_.22Error_opening_terminal.22_error_message"></span><span class="mw-headline" id='"Terminal_unknown"_or_"Error_opening_terminal"_error_message'>"Terminal unknown" or  "Error opening terminal" error message</span>
</h3>
<p>If you receive the above errors upon logging in, this means the server does not recognize your terminal. Ncurses applications like nano may fail with the message "Error opening terminal".
</p>
<p>The correct solution is to install the client terminal's terminfo file on the server. This tells console programs on the server how to correctly interact with your terminal. You can get info about current terminfo using <code>$ infocmp</code> and then find out <a href="../en/Pacman.html#Querying_package_databases" title="Pacman">which package owns it</a>.
</p>
<p>If you cannot <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> it normally, you can copy your terminfo to your home directory on the server:
</p>
<pre>$ ssh myserver mkdir -p  ~/.terminfo/${TERM:0:1}
$ scp /usr/share/terminfo/${TERM:0:1}/$TERM myserver:~/.terminfo/${TERM:0:1}/
</pre>
<p>After logging in and out from the server the problem should be fixed.
</p>
<h4><span class="mw-headline" id="TERM_hack">TERM hack</span></h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This should only be used as a last resort.</div>
<p>Alternatively, you can simply set <code>TERM=xterm</code> in your environment on the server (e.g. in <code>.bash_profile</code>). This will silence the error and allow ncurses applications to run again, but you may experience strange behavior and graphical glitches unless your terminal's control sequences exactly match xterm's.
</p>
<h3>
<span id="Connection_closed_by_x.x.x.x_.5Bpreauth.5D"></span><span class="mw-headline" id="Connection_closed_by_x.x.x.x_[preauth]">Connection closed by x.x.x.x [preauth]</span>
</h3>
<p>If you are seeing this error in your sshd logs, make sure you have set a valid HostKey
</p>
<pre>HostKey /etc/ssh/ssh_host_rsa_key
</pre>
<h3><span class="mw-headline" id="subsystem_request_failed">subsystem request failed</span></h3>
<p>Since <i>OpenSSH</i> 8.8, <i>scp</i> uses <i>SFTP</i> as the default protocol for data transfers by requesting the subsystem named <code>sftp</code>. If you run <i>scp</i> in verbose mode, <code>scp -v</code>, you can determine which subsystem your client is using (e.g. <code>Sending subsystem: &lt;subsystem-name&gt;</code>). Errors such as <code>subsystem request failed on channel 0</code> may be fixed by configuring the server's Subsystem settings: <span class="plainlinks archwiki-template-man" title="$ man 5 sshd_config"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sshd_config.5#Subsystem">sshd_config(5) § Subsystem</a></span>. The server configuration should resemble the example below.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/sshd_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Subsystem subsystem-name /path/to/subsystem-executable
...
</pre>
<h3><span class="mw-headline" id="id_dsa_refused_by_OpenSSH_7.0">id_dsa refused by OpenSSH 7.0</span></h3>
<p>OpenSSH 7.0 deprecated DSA public keys for security reasons. If you absolutely must enable them, set the <a href="#Configuration">configuration</a> option <code>PubkeyAcceptedKeyTypes +ssh-dss</code> (<a rel="nofollow" class="external free" href="https://www.openssh.com/legacy.html">https://www.openssh.com/legacy.html</a> does not mention this).
</p>
<h3><span class="mw-headline" id="No_matching_key_exchange_method_found_by_OpenSSH_7.0">No matching key exchange method found by OpenSSH 7.0</span></h3>
<p>OpenSSH 7.0 deprecated the diffie-hellman-group1-sha1 key algorithm because it is weak and within theoretical range of the so-called Logjam attack (see <a rel="nofollow" class="external free" href="https://www.openssh.com/legacy.html">https://www.openssh.com/legacy.html</a>). If the key algorithm is needed for a particular host, ssh will produce an error message like this:
</p>
<pre>Unable to negotiate with 127.0.0.1: no matching key exchange method found.
Their offer: diffie-hellman-group1-sha1
</pre>
<p>The best resolution for these failures is to upgrade/configure the server to not use deprecated algorithms. If that is not possible, you can force the client to reenable the algorithm with the <a href="#Configuration">client option</a> <code>KexAlgorithms +diffie-hellman-group1-sha1</code>.
</p>
<h3>
<span id="tmux.2Fscreen_session_killed_when_disconnecting_from_SSH"></span><span class="mw-headline" id="tmux/screen_session_killed_when_disconnecting_from_SSH">tmux/screen session killed when disconnecting from SSH</span>
</h3>
<p>If your processes get killed at the end of the session, it is possible that you are using socket activation and it gets killed by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=systemd">systemd</a></span> when it notices that the SSH session process exited. In that case there are two solutions. One is to avoid using socket activation by using <code>ssh.service</code> instead of <code>ssh.socket</code>. The other is to set <code>KillMode=process</code> in the Service section of <code>ssh@.service</code>.
</p>
<p>The <code>KillMode=process</code> setting may also be useful with the classic <code>ssh.service</code>, as it avoids killing the SSH session process or the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=screen">screen</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tmux">tmux</a></span> processes when the server gets stopped or restarted.
</p>
<h3><span class="mw-headline" id="SSH_session_stops_responding">SSH session stops responding</span></h3>
<p>SSH responds to <a href="https://en.wikipedia.org/wiki/Software_flow_control" class="extiw" title="wikipedia:Software flow control">flow control commands</a> <code>XON</code> and <code>XOFF</code>. It will freeze/hang/stop responding when you hit <code>Ctrl+s</code>. Use <code>Ctrl+q</code> to resume your session.
</p>
<h3><span class="mw-headline" id="Broken_pipe">Broken pipe</span></h3>
<p>If you attempt to create a connection which results in a <code>Broken pipe</code> response for <code>packet_write_wait</code>, you should reattempt the connection in debug mode and see if the output ends in error:
</p>
<pre>debug3: send packet: type 1
packet_write_wait: Connection to A.B.C.D port 22: Broken pipe</pre>
<p>The <code>send packet</code> line above indicates that the reply packet was never received. So, it follows that this is a <i>QoS</i> issue. To decrease the likely-hood of a packet being dropped, set <code>IPQoS</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ssh/ssh_config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Match all
    IPQoS reliability</pre>
<p>The <code>reliability</code> (<code>0x04</code>) type-of-service should resolve the issue, as well as <code>0x00</code> and <code>throughput</code> (<code>0x08</code>).
</p>
<h3><span class="mw-headline" id="Slow_daemon_startup_after_reboot">Slow daemon startup after reboot</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> No longer true since kernel 5.6 (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:OpenSSH.html">Talk:OpenSSH</a>)</div>
</div>
<p>If you are experiencing excessively long daemon startup times after reboots (e.g. several minutes before the daemon starts accepting connections), especially on headless or virtualized servers, it may be due to a lack of entropy.<a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=241954">[3]</a> This can be remedied by installing either <a href="../en/Rng-tools.html" title="Rng-tools">Rng-tools</a> or <a href="../en/Haveged.html" title="Haveged">Haveged</a>, as appropriate for your system. However, take note of the associated security implications discussed in each package's respective wiki page.
</p>
<h3><span class="mw-headline" id="Terminate_unresponsive_SSH_connection">Terminate unresponsive SSH connection</span></h3>
<p>If a client session is no longer responding and cannot be terminated by instructing the running program (e.g. <a href="../en/Command-line_shell.html" class="mw-redirect" title="Shell">shell</a>), you can still terminate the session by pressing <code>Enter</code>, <code>~</code> and <code>.</code> one after another in that order.
</p>
<p>The <code>~</code> is a pseudo-terminal escape character (see <span class="plainlinks archwiki-template-man" title="$ man 1 ssh"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/ssh.1#ESCAPE_CHARACTERS">ssh(1) § ESCAPE CHARACTERS</a></span>), which can be added multiple times depending on the client session to terminate. For example, if you connected from A to B and then from B to C and the session from B to C freezes, you can terminate it by pressing <code>Enter</code> and typing <code>~~.</code>, which will leave you in a working session on B.
</p>
<h3>
<span id="WARNING:_REMOTE_HOST_IDENTIFICATION_HAS_CHANGED.21"></span><span class="mw-headline" id="WARNING:_REMOTE_HOST_IDENTIFICATION_HAS_CHANGED!">WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!</span>
</h3>
<p>If the client warns that the key of an ssh server has changed, you should verify that the newly offered key really belongs to the server operator via an authenticated (not necessarily encrypted) channel. Then remove the old key from the <code>known_hosts</code> file with <code>ssh-keygen -R $SSH_HOST</code> and accept the new key as if it was a new server.
</p>
<h3><span class="mw-headline" id="Connecting_to_a_remote_without_the_appropriate_terminfo_entry">Connecting to a remote without the appropriate terminfo entry</span></h3>
<p>When connecting to hosts that do not have a terminfo entry for your terminal, for example, when using a terminal emulator whose terminfo entry is not shipped with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=ncurses">ncurses</a></span> (e.g. <a href="../en/Kitty.html" title="Kitty">kitty</a> and <a href="../en/Rxvt-unicode.html" title="Rxvt-unicode">rxvt-unicode</a>), or when connecting to hosts with a limited terminfo database (e.g. systems running <a href="https://en.wikipedia.org/wiki/OpenWrt" class="extiw" title="wikipedia:OpenWrt">OpenWrt</a>), various issues will occur with software that relies on <span class="plainlinks archwiki-template-man" title="$ man 5 terminfo"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/terminfo.5">terminfo(5)</a></span>.
</p>
<p>A proper solution is to place the appropriate terminfo entry on the host. If that is not feasible, an alternative is to set <code>TERM</code> to a value that is both supported by the remote host and compatible with the terminal.
</p>
<p>Since OpenSSH 8.7, a custom <code>TERM</code> environment variable can be passed to remote hosts with a simple configuration snippet:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/.ssh/config</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Host example.com
  SetEnv TERM=xterm-256color</pre>
<h3>
<span id="Connection_through_jump_host_fails_with_.22bash:_No_such_file_or_directory.22"></span><span class="mw-headline" id='Connection_through_jump_host_fails_with_"bash:_No_such_file_or_directory"'>Connection through jump host fails with "bash: No such file or directory"</span>
</h3>
<p>If you do not have the <code>SHELL</code> environment variable set to a full valid path (on the jump server), connection will fail with an error message simmilar to this one:
</p>
<pre>bash: No such file or directory
kex_exchange_identification: Connection closed by remote host
Connection closed by UNKNOWN port 65535
</pre>
<p>You can simply solve this by setting your <code>SHELL</code> to a full path name of a shell that will also be valid on the jump server or by setting a specific <code>SHELL</code> variable for each server in your <code>~/.ssh/config</code> file.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a href="https://en.wikibooks.org/wiki/OpenSSH" class="extiw" title="wikibooks:OpenSSH">Wikibooks:OpenSSH</a></li>
<li><a rel="nofollow" class="external text" href="https://www.la-samhna.de/library/brutessh.html">Defending against brute force ssh attacks</a></li>
<li>OpenSSH key management: <a rel="nofollow" class="external text" href="https://www.ibm.com/developerworks/library/l-keyc/index.html">Part 1</a> on IBM developerWorks, <a href="https://www.funtoo.org/OpenSSH_Key_Management,_Part_2" class="extiw" title="funtoo:OpenSSH Key Management, Part 2">Part 2</a>, <a href="https://www.funtoo.org/OpenSSH_Key_Management,_Part_3" class="extiw" title="funtoo:OpenSSH Key Management, Part 3">Part 3</a> on funtoo.org</li>
<li><a rel="nofollow" class="external text" href="https://stribika.github.io/2015/01/04/secure-secure-shell.html">Secure Secure Shell</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Secure_Shell.html" title="Category:Secure Shell">Secure Shell</a></li>
<li><a href="../en/Category:Servers.html" title="Category:Servers">Servers</a></li>
<li><a href="../en/Category:OpenBSD.html" title="Category:OpenBSD">OpenBSD</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_with_broken_package_links.html" title="Category:Pages with broken package links">Pages with broken package links</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=OpenSSH&amp;oldid=804039">https://wiki.archlinux.org/index.php?title=OpenSSH&amp;oldid=804039</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 21 March 2024, at 09:47.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
