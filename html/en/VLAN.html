<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>VLAN - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.43.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-VLAN rootpage-VLAN skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Instant_Configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Instant_Configuration">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Instant Configuration</span>
			</div>
		</a>
		
			<button aria-controls="toc-Instant_Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Instant Configuration subsection</span>
			</button>
		
		<ul id="toc-Instant_Configuration-sublist" class="vector-toc-list">
			<li id="toc-Create_the_VLAN_device" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Create_the_VLAN_device">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.1</span>
					<span>Create the VLAN device</span>
				</div>
			</a>
			
			<ul id="toc-Create_the_VLAN_device-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Add_an_IP" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Add_an_IP">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.2</span>
					<span>Add an IP</span>
				</div>
			</a>
			
			<ul id="toc-Add_an_IP-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Turning_down_the_device" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Turning_down_the_device">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.3</span>
					<span>Turning down the device</span>
				</div>
			</a>
			
			<ul id="toc-Turning_down_the_device-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Removing_the_device" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Removing_the_device">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.4</span>
					<span>Removing the device</span>
				</div>
			</a>
			
			<ul id="toc-Removing_the_device-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Persistent_Configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Persistent_Configuration">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Persistent Configuration</span>
			</div>
		</a>
		
			<button aria-controls="toc-Persistent_Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Persistent Configuration subsection</span>
			</button>
		
		<ul id="toc-Persistent_Configuration-sublist" class="vector-toc-list">
			<li id="toc-systemd-networkd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#systemd-networkd">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>systemd-networkd</span>
				</div>
			</a>
			
			<ul id="toc-systemd-networkd-sublist" class="vector-toc-list">
				<li id="toc-Single_interface" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Single_interface">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1.1</span>
					<span>Single interface</span>
				</div>
			</a>
			
			<ul id="toc-Single_interface-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Single_interface_with_multiple_VLANs_each_with_its_own_gateway" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Single_interface_with_multiple_VLANs_each_with_its_own_gateway">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1.2</span>
					<span>Single interface with multiple VLANs each with its own gateway</span>
				</div>
			</a>
			
			<ul id="toc-Single_interface_with_multiple_VLANs_each_with_its_own_gateway-sublist" class="vector-toc-list">
				<li id="toc-Checks" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Checks">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1.2.1</span>
					<span>Checks</span>
				</div>
			</a>
			
			<ul id="toc-Checks-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Bonded_interface" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Bonded_interface">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1.3</span>
					<span>Bonded interface</span>
				</div>
			</a>
			
			<ul id="toc-Bonded_interface-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-netctl" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#netctl">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>netctl</span>
				</div>
			</a>
			
			<ul id="toc-netctl-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Setting_bridge_IP" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Setting_bridge_IP">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.3</span>
					<span>Setting bridge IP</span>
				</div>
			</a>
			
			<ul id="toc-Setting_bridge_IP-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Troubleshooting</span>
			</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-udev_renames_the_virtual_devices" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#udev_renames_the_virtual_devices">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>udev renames the virtual devices</span>
				</div>
			</a>
			
			<ul id="toc-udev_renames_the_virtual_devices-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">VLAN</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 2 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-2" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">2 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/VLAN" title="VLAN – 日本語" lang="ja" hreflang="ja" data-title="VLAN" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/VLAN" title="VLAN – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" data-title="VLAN" data-language-autonym="中文（简体）" data-language-local-name="中文（简体）" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Network_configuration.html" title="Network configuration">Network configuration</a></li>
<li><a href="../en/Network_tools.html" title="Network tools">Network tools</a></li>
<li><a href="../en/Netctl.html" title="Netctl">Netctl</a></li>
<li><a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/VLAN" class="extiw" title="wikipedia:VLAN">Virtual LANs</a> give you the ability to subdivide a <a href="https://en.wikipedia.org/wiki/Local_area_network" class="extiw" title="wikipedia:Local area network">LAN</a>. Linux can accept VLAN tagged traffic and presents each VLAN ID as a different network interface (eg: <code>eth0.100</code> for VLAN ID <code>100</code>).
</p>
<p>This article explains how to configure a VLAN using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iproute2">iproute2</a></span> and <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> or <a href="../en/Netctl.html" title="Netctl">netctl</a>.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Instant_Configuration">Instant Configuration</span></h2>
<p>In the following examples, let us assume the <i>interface</i> is <code>eth0</code>, the assigned <i>name</i> is <code>eth0.100</code> and the VLAN ID is <code>100</code>.
</p>
<h3><span class="mw-headline" id="Create_the_VLAN_device">Create the VLAN device</span></h3>
<p>Add the VLAN interface with the following command:
</p>
<pre># ip link add link eth0 name eth0.100 type vlan id 100
</pre>
<p>Run <code>ip link</code> to confirm that it has been created.
</p>
<p>This interface behaves like a normal interface. All traffic routed to it will go through the master interface (in this example, <code>eth0</code>) but with a VLAN tag. Only VLAN-aware devices can accept them if configured correctly, else the traffic is dropped.
</p>
<p>Using a <i>name</i> like <code>eth0.100</code> is just convention and not enforced; you can alternatively use <code>eth0_100</code> or something descriptive like <code>IPTV</code>. To see the VLAN ID on an interface, in case you used an unconventional name:
</p>
<pre># ip -details link show eth0.100
</pre>
<p>The <code>-details</code> (<code>-d</code>) flag shows full details of an interface:
</p>
<pre># ip -details addr show
4: eth0.100@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default 
   link/ether 96:4a:9c:84:36:51 brd ff:ff:ff:ff:ff:ff promiscuity 0 
   <b>vlan protocol 802.1Q id 100 &lt;REORDER_HDR&gt;</b> 
   inet6 fe80::944a:9cff:fe84:3651/64 scope link 
      valid_lft forever preferred_lft forever
</pre>
<h3><span class="mw-headline" id="Add_an_IP">Add an IP</span></h3>
<p>Now add an IPv4 address to the just created VLAN link, and activate the link:
</p>
<pre># ip addr add 192.168.100.1/24 brd 192.168.100.255 dev eth0.100
# ip link set dev eth0.100 up
</pre>
<h3><span class="mw-headline" id="Turning_down_the_device">Turning down the device</span></h3>
<p>To cleanly shut down the setting before you remove the link, you can do:
</p>
<pre># ip link set dev eth0.100 down</pre>
<h3><span class="mw-headline" id="Removing_the_device">Removing the device</span></h3>
<p>Removing a VLAN interface is significantly less convoluted
</p>
<pre># ip link delete eth0.100</pre>
<h2><span class="mw-headline" id="Persistent_Configuration">Persistent Configuration</span></h2>
<h3><span class="mw-headline" id="systemd-networkd">systemd-networkd</span></h3>
<h4><span class="mw-headline" id="Single_interface">Single interface</span></h4>
<p>Use the following number-prefixed configuration files (Remember the file contents are case sensitive and the number-prefix can be changed):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>10-eth0</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=eth0

[Network]
DHCP=ipv4
;these are arbitrary names, but must match the *.netdev and *.network files
VLAN=eth0.100
VLAN=eth0.200
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>20-eth0.100</i>.netdev</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[NetDev]
Name=eth0.100
Kind=vlan

[VLAN]
Id=100
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>21-eth0.200</i>.netdev</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[NetDev]
Name=eth0.200
Kind=vlan

[VLAN]
Id=200
</pre>
<p>You will have to have associated .network files for each .netdev to handle addressing and routing. For example, to set the eth0.100 interface with a static IP and the eth0.200 interface with DHCP (but ignoring the supplied default route), use:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>30-eth0.100</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=eth0.100

[Network]
DHCP=no

[Address]
Address=192.168.0.25/24
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>31-eth0.200</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=eth0.200

[Network]
DHCP=yes

[DHCP]
UseRoutes=false
</pre>
<p>Then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>systemd-networkd.service</code>. See <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> for details.
</p>
<h4><span class="mw-headline" id="Single_interface_with_multiple_VLANs_each_with_its_own_gateway">Single interface with multiple VLANs each with its own gateway</span></h4>
<p>Each vlan gets its own routing table and a RoutingPolicyRule that specifies which source ip addresses this routing applies to.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>10-eth0.network</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=eth0

[Network]
VLAN=eth0.10
VLAN=eth0.11
DNS=192.168.100.101
DNS=192.168.100.102
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>20-eth0.10.netdev</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[NetDev]
Name=eth0.10
Kind=vlan

[VLAN]
Id=10
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>30-eth0.10.network</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=eth0.10

[Network]
Address=192.168.1.14/24
Address=192.168.1.24/24

[Route]
Gateway=192.168.1.1
Table=10

[RoutingPolicyRule]
From=192.168.1.0/24
Table=10
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>21-eth0.11.netdev</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[NetDev]
Name=eth0.11
Kind=vlan

[VLAN]
Id=11
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>31-eth0.11.network</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=eth0.11

[Network]
Address=192.168.100.54/24

[Route]
Gateway=192.168.100.1
Table=11

[RoutingPolicyRule]
From=192.168.100.0/24
Table=11
</pre>
<h5><span class="mw-headline" id="Checks">Checks</span></h5>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># ip rule</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">0:      from all lookup local
0:      from 192.168.1.0/24 lookup 10
0:      from 192.168.100.0/24 lookup 11
32766:  from all lookup main
32767:  from all lookup default
</pre>
<p>Use <code>ip route list table</code>. E.g.:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># ip route list table 10</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">default via 192.168.1.1 dev enp1.10 proto static
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># ip route list table 11</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">default via 192.168.100.1 dev enp1.11 proto static
</pre>
<h4><span class="mw-headline" id="Bonded_interface">Bonded interface</span></h4>
<p>Similar to above, you are just going to stack more of the concepts in place. You will want to ensure that you have got a bond set up in your switch and also make sure its a trunk with tagged vlans corresponding to what you create below. Convention would be to create a bond interface with the name <code>bond0</code>, however there is a known issue where the <code>bonding</code> module, when loaded, creates a bond device of the name <code>bond0</code> which systemd then refuses to configure (as systemd tries to respectfully leave alone any device it did not create). 
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> To prevent the <code>bonding</code> module to create an initial <code>bond0</code> interface, set the <code>max_bonds</code> option of the bonding module to <code>0</code> (default value is <code>1</code>):
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/bonding.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options bonding max_bonds=0</pre>
See <a href="../en/Kernel_module.html#Setting_module_options" class="mw-redirect" title="Kernel modules">Kernel modules#Setting module options</a> and <a rel="nofollow" class="external text" href="https://docs.kernel.org/networking/bonding.html">Linux Ethernet Bonding Driver HOWTO (Kernel Documentation)</a>for details.</div>
<p>For the purposes of this write up, we are going to use <code><i>bondname</i></code> and you can make the choice yourself.
</p>
<p>First, we create the bond device:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>bondname</i>.netdev</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[NetDev]
Name=<i>bondname</i>
Kind=bond

[Bond]
Mode=802.3ad
LACPTransmitRate=fast</pre>
<p>Now create a .network directive that references the vlans and interface carriers. In this case we will use the convention for a dual port fiber module:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>bondname</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=<i>bondname</i>

[Network]
VLAN=vlan10
VLAN=vlan20
VLAN=vlan30
BindCarrier=<i>enp3s0f0 enp3s0f1</i></pre>
<p>We are using the vlan&lt;number&gt; naming convention here, you can use something else but realize that this is a named reference so you will have to have a corresponding set of files with the same name.
</p>
<p>We will now set up the physical network interfaces:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>enp3s0f0</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=<i>enp3s0f0</i>

[Network]
Bond=<i>bondname</i></pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>enp3s0f1</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=<i>enp3s0f1</i>

[Network]
Bond=<i>bondname</i></pre>
<p>At this time you could reboot, and likely should, because the bonded interface is created at boot time. Restarting systemd-networkd will consume changes from these files typically, but device creation seems to occur at startup.
</p>
<p>We will now set up the VLANs. You should be aware that having multiple VLANs can result in a situation where your machine has multiple default routes, so you will need to specify a Destination directive in the network directives to ensure that only one VLAN is being used for a default route. In this case we will use the VLAN with an ID of 10 as our default route.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>vlan10</i>.netdev</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[NetDev]
Name=vlan10
Kind=vlan

[VLAN]
Id=10</pre>
<p>Now create the associated network directive to set an address:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>vlan10</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=vlan10

[Network]
VLAN=vlan10

[Address]
Address=10.10.10.2/24

[Route]
Destination=0.0.0.0/0
Gateway=10.10.10.1</pre>
<p>We will create a similar pair of files for the VLAN with an ID of 20:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>vlan20</i>.netdev</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[NetDev]
Name=vlan20
Kind=vlan

[VLAN]
Id=20</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>vlan20</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=vlan20

[Network]
VLAN=vlan20

[Address]
Address=10.10.20.2/24

[Route]
Destination=10.10.20.0/24
Gateway=10.10.20.1</pre>
<p>And again for the VLAN with an ID of 30:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>vlan30</i>.netdev</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[NetDev]
Name=vlan30
Kind=vlan

[VLAN]
Id=30</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/network/<i>vlan30</i>.network</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Match]
Name=vlan30

[Network]
VLAN=vlan30

[Address]
Address=10.10.30.2/24

[Route]
Destination=10.10.30.0/24
Gateway=10.10.30.1</pre>
<p>Note that the Destination on <code>vlan10</code> is set to <code>0.0.0.0/0</code>, which will match all outbound, becoming the default route.
</p>
<h3><span class="mw-headline" id="netctl">netctl</span></h3>
<p>You can use <a href="../en/Netctl.html" title="Netctl">netctl</a> for this purpose, see the self-explanatory example profiles in <code>/etc/netctl/examples/vlan-{dhcp,static}</code>.
</p>
<h3><span class="mw-headline" id="Setting_bridge_IP">Setting bridge IP</span></h3>
<p>Sometimes you might want to configure the bridge ip on which docker operates, for example when the default ip clashes with other ip addresses in the network. Docker has a <a rel="nofollow" class="external text" href="https://docs.docker.com/network/bridge/">straight forward way</a> of setting the <code>bip</code> (bridge IP) via the <code>/etc/docker/daemon.json</code>. When this file does not exist yet you can create it.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/docker.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
    "bip": "&lt;desired ip range&gt;/24"
}</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="udev_renames_the_virtual_devices">udev renames the virtual devices</span></h3>
<p>An annoyance is that <a href="../en/Udev.html" title="Udev">udev</a> may try to rename virtual devices as they are added, thus ignoring the <code>name</code> configured for them (in this case <code>eth0.100</code>):
</p>
<pre># ip link add link eth0 name eth0.100 type vlan id 100
# ip link show 
</pre>
<p>This could generate the following output: 
</p>
<pre>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000
    link/ether aa:bb:cc:dd:ee:ff brd ff:ff:ff:ff:ff:ff
3: rename1@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state DOWN 
    link/ether aa:bb:cc:dd:ee:ff brd ff:ff:ff:ff:ff:ff
</pre>
<p><i>udev</i> has ignored the configured virtual interface name <code>eth0.100</code> and named it <code>rename1</code>.
</p>
<p>The solution is to edit <code>/etc/udev/rules.d/network_persistent.rules</code> and append <code>DRIVERS=="?*"</code> to the end of the physical interface configuration line.
</p>
<p>For example, for the interface <code>aa:bb:cc:dd:ee:ff</code> (<code>eth0</code>): 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/network_persistent.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">SUBSYSTEM=="net", ATTR{address}=="aa:bb:cc:dd:ee:ff", NAME="eth0", DRIVERS=="?*"
</pre>
<p>A reboot should mean that VLANs configure correctly with the names assigned to them.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Networking.html" title="Category:Networking">Networking</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=VLAN&amp;oldid=814229">https://wiki.archlinux.org/index.php?title=VLAN&amp;oldid=814229</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 9 August 2024, at 15:54.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki.svg" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul></ul>
</div>
</body>
</html>
