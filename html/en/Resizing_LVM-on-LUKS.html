<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Resizing LVM-on-LUKS - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.45.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Resizing_LVM-on-LUKS rootpage-Resizing_LVM-on-LUKS skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Method" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Method">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Method</span>
			</div>
		</a>
		
		<ul id="toc-Method-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Process" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Process">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Process</span>
			</div>
		</a>
		
		<ul id="toc-Process-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Shrink_LVM-on-LUKS" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Shrink_LVM-on-LUKS">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Shrink LVM-on-LUKS</span>
			</div>
		</a>
		
			<button aria-controls="toc-Shrink_LVM-on-LUKS-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Shrink LVM-on-LUKS subsection</span>
			</button>
		
		<ul id="toc-Shrink_LVM-on-LUKS-sublist" class="vector-toc-list">
			<li id="toc-Boot_and_setup" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Boot_and_setup">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>Boot and setup</span>
				</div>
			</a>
			
			<ul id="toc-Boot_and_setup-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Resize_filesystem_and_LVM_logical_volume" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Resize_filesystem_and_LVM_logical_volume">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>Resize filesystem and LVM logical volume</span>
				</div>
			</a>
			
			<ul id="toc-Resize_filesystem_and_LVM_logical_volume-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Resize_LVM_physical_Volume" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Resize_LVM_physical_Volume">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3</span>
					<span>Resize LVM physical Volume</span>
				</div>
			</a>
			
			<ul id="toc-Resize_LVM_physical_Volume-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Resize_LUKS_volume" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Resize_LUKS_volume">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.4</span>
					<span>Resize LUKS volume</span>
				</div>
			</a>
			
			<ul id="toc-Resize_LUKS_volume-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Resize_the_partition" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Resize_the_partition">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.5</span>
					<span>Resize the partition</span>
				</div>
			</a>
			
			<ul id="toc-Resize_the_partition-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Enlarge_LVM_on_LUKS" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Enlarge_LVM_on_LUKS">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Enlarge LVM on LUKS</span>
			</div>
		</a>
		
			<button aria-controls="toc-Enlarge_LVM_on_LUKS-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Enlarge LVM on LUKS subsection</span>
			</button>
		
		<ul id="toc-Enlarge_LVM_on_LUKS-sublist" class="vector-toc-list">
			<li id="toc-Preparation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Preparation">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>Preparation</span>
				</div>
			</a>
			
			<ul id="toc-Preparation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Extending_the_physical_segments_of_the_cryptdevice" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Extending_the_physical_segments_of_the_cryptdevice">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.2</span>
					<span>Extending the physical segments of the cryptdevice</span>
				</div>
			</a>
			
			<ul id="toc-Extending_the_physical_segments_of_the_cryptdevice-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Resizing_the_logical_volume" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Resizing_the_logical_volume">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.3</span>
					<span>Resizing the logical volume</span>
				</div>
			</a>
			
			<ul id="toc-Resizing_the_logical_volume-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Resizing_the_encrypted_volume" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Resizing_the_encrypted_volume">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.4</span>
					<span>Resizing the encrypted volume</span>
				</div>
			</a>
			
			<ul id="toc-Resizing_the_encrypted_volume-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar no-font-mode-scale">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Resizing LVM-on-LUKS</span></h1>
				</header>
				<div class="vector-column-end no-font-mode-scale">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Merge-arrows-2.svg" decoding="async" width="36" height="40" class="mw-file-element"></span></span><b>This article or section is a candidate for merging with <a href="../en/LVM.html#Shrinking" title="LVM">LVM#Shrinking</a>.</b></p>
<div>
<b>Notes:</b> This howto only aggregates information from other articles (thus duplicating it) for a too specific case: if some explanations are clearer here, they should be merged into <a href="../en/LVM.html#Shrinking" title="LVM">LVM#Shrinking</a>, and then the little remaining wrapping part about dm-crypt should be merged into <a href="../en/Dm-crypt/Specialties.html" title="Dm-crypt/Specialties">Dm-crypt/Specialties</a> with a link to <a href="../en/LVM.html#Shrinking" title="LVM">LVM#Shrinking</a> for the LVM resizing. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Resizing_LVM-on-LUKS.html">Talk:Resizing LVM-on-LUKS</a>)</div>
</div>
<p>This article follows the process of resizing an LVM-on-LUKS-on-GPT partition. You can also use <a href="../en/Parted.html" class="mw-redirect" title="GParted">GParted</a> GUI tool to resize LUKS partition, which may be easier and quicker for beginners.
</p>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Method">Method</h2></div>
<p>The filesystem we work on will have the following structure:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># lsblk</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME                MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT
sda                   8:0    0 111.8G  0 disk
├─sda1                8:1    0    99M  0 part  /boot
└─sda2                8:2    0 111.7G  0 part
  └─vgroup          254:0    0 111.7G  0 crypt
    ├─vgroup-lvroot 254:1    0    30G  0 lvm   /
    └─vgroup-lvhome 254:2    0  81.7G  0 lvm   /home
</pre>
<p>The goal is to clear up unused space and create a new partition, <code>sda3</code>, without any data loss. All filesystems are assumed to be <code>ext4</code>.
</p>
<p>The entire process should run from a live USB Arch system to avoid any filesystem corruption.
</p>
<div class="mw-heading mw-heading2"><h2 id="Process">Process</h2></div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> <b>Do not</b> run any of this code by copy-pasting, you need to adapt all these commands to your specific setup.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> It is highly recommended to check your work after each step by checking the filesystem, LVM, and/or LUKS volume integrity.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> It is highly recommended to write out the exact transition plan so that at each step you know exactly which partition size you are going to need.</div>
<div class="mw-heading mw-heading2"><h2 id="Shrink_LVM-on-LUKS">Shrink LVM-on-LUKS</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Boot_and_setup">Boot and setup</h3></div>
<p>Boot into your live <a href="../en/USB_flash_installation_media.html" class="mw-redirect" title="USB flash installation media">USB flash installation media</a>.
</p>
<p>Decrypt the LUKS volume:
</p>
<pre># cryptsetup luksOpen /dev/sda2 cryptdisk
</pre>
<div class="mw-heading mw-heading3"><h3 id="Resize_filesystem_and_LVM_logical_volume">Resize filesystem and LVM logical volume</h3></div>
<p>Follow <a href="../en/LVM.html#Resizing_the_logical_volume_and_file_system_in_one_go" title="LVM">these instructions</a>.
</p>
<p>You can run a <code>fsck</code> just to make sure nothing broke:
</p>
<pre># e2fsck -f /dev/vgroup/lvhome
</pre>
<div class="mw-heading mw-heading3"><h3 id="Resize_LVM_physical_Volume">Resize LVM physical Volume</h3></div>
<p>To calculate the new LVM physical volume size, use a simple formula: <code>NEW_VOLUME_BYTES = PE_SIZE * PE_COUNT + UNUSABLE_SIZE</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">pvdisplay /dev/mapper/cryptdisk</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
PV Size               950.05 GiB / not usable 4.00 MiB
...
PE Size               4.00 MiB
...
Allocated PE          116303
...
</pre>
<p>Using the formula above: <code>(116303 * 4 MiB + 4 MiB) in Bytes = 487814332416</code>.
</p>
<p>Resize the volume. Note the "B" (Bytes) appended to the end of the value for size. This command is safe since it will exit early if the new size would not fit all the existing extents:
</p>
<pre># pvresize --setphysicalvolumesize 487814332416B /dev/mapper/cryptdisk
</pre>
<div class="mw-heading mw-heading3"><h3 id="Resize_LUKS_volume">Resize LUKS volume</h3></div>
<p>To calculate the new LUKS volume size, use a simple formula: <code>NEW_LUKS_SECTOR_COUNT = PV_EXTENT_COUNT * PV_EXTENT_SIZE <b>IN BYTES</b> / LUKS_SECTOR_SIZE</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># pvdisplay /dev/mapper/cryptdisk</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
PV Size               454.31 GiB / not usable 3.00 MiB
...
PE Size               4.00 MiB
Total PE              116303
...
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup status cryptdisk</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
sector size:  512
...
</pre>
<pre>(116303 extents + 1 unusable extent) * 4194304 B/extent / 512 B/sector = 952762368 sectors
</pre>
<p>Resize the LUKS volume:
</p>
<pre># cryptsetup -b $NEW_LUKS_SECTOR_COUNT resize cryptdisk
</pre>
<div class="mw-heading mw-heading3"><h3 id="Resize_the_partition">Resize the partition</h3></div>
<p>To calculate the new partition size, use a simple formula: <code>NEW_PARTITION_SECTOR_END = PARTITION_SECTOR_START + (LUKS_SIZE_SECTORS + LUKS_OFFSET_SECTORS) - 1</code>. The <code>- 1</code> is because parted takes an inclusive sector end parameter.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># cryptsetup status cryptdisk</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
offset:  4096 sectors
size:    952762368 sectors
</pre>
<p>Close the LUKS volume to resize offline. You will probably need to deactivate LVM volumes on the cryptdisk or it will not close.
</p>
<pre># vgchange -a n vgroup
# cryptsetup close cryptdisk
</pre>
<p>Use <code>parted</code> to resize the partition:
</p>
<pre># parted /dev/sda
 (parted) unit
 Unit?  [compact]? s
 (parted) p
 ...
  2      8003584s  2000408575s  1992404992s
</pre>
<p>Using the formula above returns: <code>8003584 + (952762368 + 4096) - 1 = 960770047</code>
</p>
<pre>(parted) resizepart 2 960770047
 Warning: Shrinking a partition can cause data loss, are you sure you want to continue?
 Yes/No? y
 (parted) q
</pre>
<p>At this point you can reopen the LUKS volume and remount partitions. You will need to manually reactive the LVM partitions since if you manually deactivated them above.
</p>
<pre># cryptsetup luksOpen /dev/sda2 cryptdisk
# vgchange -a y vgroup
</pre>
<div class="mw-heading mw-heading2"><h2 id="Enlarge_LVM_on_LUKS">Enlarge LVM on LUKS</h2></div>
<p>Enlarging a LVM-on-LUKS logical partition, for instance after migrating to a larger hard disk, is done in the opposite way - from the outermost to the innermost partition:
</p>
<pre>primary partition(LUKS device{volume group[(logical partition1)(logical partition2--&gt;)]})
</pre>
<div class="mw-heading mw-heading3"><h3 id="Preparation">Preparation</h3></div>
<p>Create a new partition on the new hard disk of wanted size, f.i. by using <a href="../en/GNU_Parted.html" class="mw-redirect" title="GNU Parted">GNU Parted</a>, and clone the old partition <code>sdX1</code>, containing your LUKS container, into the new partition <code>sdY1</code>:
</p>
<pre># dd if=/dev/sdX1 of=/dev/sdY1 bs=4M
</pre>
<div class="mw-heading mw-heading3"><h3 id="Extending_the_physical_segments_of_the_cryptdevice">Extending the physical segments of the cryptdevice</h3></div>
<p>Now, open the cryptdevice <code>CryptDisk</code> on the new hard disk:
</p>
<pre># cryptsetup open /dev/sdY1 CryptDisk
</pre>
<p>Take a look at your current physical volume. In this example, we have a cryptdevice <code>CryptDisk</code> containing a volume group <code>CryptVolumeGroup</code> of two partitions <code>root</code> and <code>home</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># pvdisplay -m</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"> --- Physical volume ---
 PV Name               /dev/mapper/CryptDisk
 VG Name               CryptVolumeGroup
 PV Size               &lt;118.75 GiB / not usable 3.00 MiB
 Allocatable           yes (but full)
 PE Size               4.00 MiB
 Total PE              30399
 Free PE               0
 Allocated PE          30399
 PV UUID               hu0iA9-i8fv-2SC1-C6ys-LQCz-sptQ-RSOUE5

 --- Physical Segments ---
 Physical extent 0 to 6399:
   Logical volume      /dev/CryptVolumeGroup/root
   Logical extents     0 to 6399
 Physical extent 6400 to 30398:
   Logical volume      /dev/CryptVolumeGroup/home
   Logical extents     0 to 23998
</pre>
<p>By taking the total physical extents (PE) times the PE's size, we get the total size of the physical volume (PV), in this case 118.75 GiB. Although pvdisplay does not show the free extents, we can enlarge the PV to use all the available remaining space of the partition:
</p>
<pre># pvresize /dev/mapper/CryptDisk
</pre>
<p>Now we get:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># pvdisplay -m</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
 --- Physical Segments ---
 Physical extent 0 to 6399:
   Logical volume      /dev/CryptVolumeGroup/root
   Logical extents     0 to 6399
 Physical extent 6400 to 30398:
   Logical volume      /dev/CryptVolumeGroup/home
   Logical extents     0 to 23998
 Physical extent 30399 to 60922:
   FREE
</pre>
<p>Note the free extents at the end of the PV. Calculate the size difference by taking the free physical extends times PE size - in that case (60922-30399)*4 MiB = 119.2 GiB.
</p>
<div class="mw-heading mw-heading3"><h3 id="Resizing_the_logical_volume">Resizing the logical volume</h3></div>
<p>Now we are going to resize the second logical volume (LV), in this case containing the /home partition, by the size of the free physical extents minus some safety space:
</p>
<pre># lvresize -L +119G /dev/CryptVolumeGroup/home
</pre>
<p>Note the new size of the second logical volume. Calculate its total size by taking the total logical extends time the PE size - in that case 53438 * 4 MiB = 208.7 GiB:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># pvdisplay -m</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
 --- Physical Segments ---
 Physical extent 0 to 6399:
   Logical volume      /dev/CryptVolumeGroup/root
   Logical extents     0 to 6399
 Physical extent 6400 to 59838:
   Logical volume      /dev/CryptVolumeGroup/home
   Logical extents     0 to 53438
 Physical extent 59839 to 60922:
   FREE
</pre>
<div class="mw-heading mw-heading3"><h3 id="Resizing_the_encrypted_volume">Resizing the encrypted volume</h3></div>
<p>Now we are going to resize the encrypted volume itself. By taking in account the total size of the logical volume minus some safety space:
</p>
<pre># resize2fs -p /dev/CryptVolumeGroup/Home 208G
</pre>
<p>Execute e2fsck, if asked. That's it.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Storage_virtualization.html" title="Category:Storage virtualization">Storage virtualization</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Resizing_LVM-on-LUKS&amp;oldid=807958">https://wiki.archlinux.org/index.php?title=Resizing_LVM-on-LUKS&amp;oldid=807958</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 8 May 2024, at 19:19.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container no-font-mode-scale">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue  vector-search-box-show-thumbnail vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search cdx-typeahead-search--show-thumbnail">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input mw-searchInput" autocomplete="off" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true"><span class="mw-page-title-main">Resizing LVM-on-LUKS</span></div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only reading-lists-bookmark" id="ca-bookmark-sticky-header" tabindex="-1" data-event-name="watch-sticky-bookmark"><span class="vector-icon mw-ui-icon-wikimedia-bookmarkOutline mw-ui-icon-wikimedia-wikimedia-bookmarkOutline"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
