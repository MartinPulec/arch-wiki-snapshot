<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Advanced Format - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.44.2">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Advanced_Format rootpage-Advanced_Format skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Changing_sector_size" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Changing_sector_size">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Changing sector size</span>
			</div>
		</a>
		
			<button aria-controls="toc-Changing_sector_size-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Changing sector size subsection</span>
			</button>
		
		<ul id="toc-Changing_sector_size-sublist" class="vector-toc-list">
			<li id="toc-Advanced_Format_hard_disk_drives" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Advanced_Format_hard_disk_drives">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.1</span>
					<span>Advanced Format hard disk drives</span>
				</div>
			</a>
			
			<ul id="toc-Advanced_Format_hard_disk_drives-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-NVMe_solid_state_drives" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#NVMe_solid_state_drives">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.2</span>
					<span>NVMe solid state drives</span>
				</div>
			</a>
			
			<ul id="toc-NVMe_solid_state_drives-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_manufacturer_specific_programs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_manufacturer_specific_programs">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.3</span>
					<span>Using manufacturer specific programs</span>
				</div>
			</a>
			
			<ul id="toc-Using_manufacturer_specific_programs-sublist" class="vector-toc-list">
				<li id="toc-Intel" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Intel">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.3.1</span>
					<span>Intel</span>
				</div>
			</a>
			
			<ul id="toc-Intel-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Seagate" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Seagate">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">1.3.2</span>
					<span>Seagate</span>
				</div>
			</a>
			
			<ul id="toc-Seagate-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Partition_alignment" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Partition_alignment">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Partition alignment</span>
			</div>
		</a>
		
		<ul id="toc-Partition_alignment-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-dm-crypt" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#dm-crypt">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>dm-crypt</span>
			</div>
		</a>
		
		<ul id="toc-dm-crypt-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-File_systems" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#File_systems">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>File systems</span>
			</div>
		</a>
		
		<ul id="toc-File_systems-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Known_issues" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Known_issues">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Known issues</span>
			</div>
		</a>
		
			<button aria-controls="toc-Known_issues-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Known issues subsection</span>
			</button>
		
		<ul id="toc-Known_issues-sublist" class="vector-toc-list">
			<li id="toc-Syslinux_and_FAT" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Syslinux_and_FAT">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>Syslinux and FAT</span>
				</div>
			</a>
			
			<ul id="toc-Syslinux_and_FAT-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-systemd-homed" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#systemd-homed">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2</span>
					<span>systemd-homed</span>
				</div>
			</a>
			
			<ul id="toc-systemd-homed-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Troubleshooting</span>
			</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-NVMe_drives_fail_to_format" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#NVMe_drives_fail_to_format">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.1</span>
					<span>NVMe drives fail to format</span>
				</div>
			</a>
			
			<ul id="toc-NVMe_drives_fail_to_format-sublist" class="vector-toc-list">
				<li id="toc-Workarounds" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Workarounds">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.1.1</span>
					<span>Workarounds</span>
				</div>
			</a>
			
			<ul id="toc-Workarounds-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Affected_models" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Affected_models">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.1.2</span>
					<span>Affected models</span>
				</div>
			</a>
			
			<ul id="toc-Affected_models-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-References" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#References">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.1.3</span>
					<span>References</span>
				</div>
			</a>
			
			<ul id="toc-References-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">7</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar vector-feature-custom-font-size-clientpref--excluded">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Advanced Format</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 6 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-6" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">6 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/Advanced_Format.html" title="Advanced Format – español" lang="es" hreflang="es" data-title="Advanced Format" data-language-autonym="Español" data-language-local-name="español" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-hu mw-list-item"><a href="../hu/Advanced_Format.html" title="Advanced Format – magyar" lang="hu" hreflang="hu" data-title="Advanced Format" data-language-autonym="Magyar" data-language-local-name="magyar" class="interlanguage-link-target"><span>Magyar</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/%E3%82%A2%E3%83%89%E3%83%90%E3%83%B3%E3%82%B9%E3%83%89%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88" title="アドバンスドフォーマット – 日本語" lang="ja" hreflang="ja" data-title="アドバンスドフォーマット" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Advanced_Format.html" title="Advanced Format – русский" lang="ru" hreflang="ru" data-title="Advanced Format" data-language-autonym="Русский" data-language-local-name="русский" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-tr mw-list-item"><a href="../tr/Advanced_Format.html" title="Advanced Format – Türkçe" lang="tr" hreflang="tr" data-title="Advanced Format" data-language-autonym="Türkçe" data-language-local-name="Türkçe" class="interlanguage-link-target"><span>Türkçe</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/%E5%85%88%E8%BF%9B%E6%A0%BC%E5%BC%8F%E5%8C%96" title="先进格式化 – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" data-title="先进格式化" data-language-autonym="中文（简体）" data-language-local-name="中文（简体）" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end vector-feature-custom-font-size-clientpref--excluded">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-go-next.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is a candidate for moving to <a href="/index.php?title=Storage_layout_and_alignment&amp;action=edit&amp;redlink=1" class="new" title="Storage layout and alignment (page does not exist)">Storage layout and alignment</a>.</b></p>
<div>
<b>Notes:</b> "Advanced Format" is HDD-specific. (Discuss in <a href="../en/Talk:Advanced_Format.html#Rewrite_Advanced_Format_to_a_new_Sector_Sizes_page" title="Talk:Advanced Format">Talk:Advanced Format#Rewrite Advanced Format to a new Sector Sizes page</a>)</div>
</div>
<p>The minimum physical storage unit of a hard disk drive (HDD) is a <a href="https://en.wikipedia.org/wiki/Disk_sector" class="extiw" title="wikipedia:Disk sector">sector</a>. The solid state drive (SSD) equivalent is a page.<a rel="nofollow" class="external autonumber" href="https://www.oo-software.com/en/docs/whitepaper/whitepaper_ssd.pdf">[1]</a> Storage device firmware abstract away their physical sectors into logical sectors that software can operate on. The size of this sector refers to the size of the smallest addressable unit on the disk.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Software and documentation may sometimes refer to "sectors" and "blocks" interchangeably, regardless of the storage type.</div>
<dl>
<dt>Physical sector size</dt>
<dd>This is the smallest unit a physical storage device claims it can write atomically. For HDDs, it is the actual size of sectors in a platter. Traditionally, the physical sector size for HDDs was 512 bytes, meaning that each sector could hold 512 bytes of data. However, with the introduction of <a href="https://en.wikipedia.org/wiki/Advanced_Format#History" class="extiw" title="wikipedia:Advanced Format">Advanced Format</a> HDDs, the physical sector size was increased to 4096 bytes (4 KiB) for increased storage density and improved error correction capabilities. SSDs do not expose their actual NAND flash memory page size, which typically ranges from 4 KiB to 16 KiB, instead their reported physical sector size is the same as their logical sector size. For NVMe SSDs, if it is available, the <a rel="nofollow" class="external text" href="https://www.nvmexpress.org/wp-content/uploads/NVM-Express-1_2a.pdf">Atomic Write Unit Power Fail</a> (AWUPF) parameter value is used.</dd>
<dt>Logical sector size</dt>
<dd>The logical sector size, also known as the operating system sector size, represents the size of the sectors exposed to the operating system and applications. It is the sector size used for reading from and writing to the storage device at the software level. The logical sector size can differ from the physical sector size. For example, an Advanced Format HDD with a physical sector size of 4096 bytes may still present a logical sector size of 512 bytes for compatibility with older systems and applications.</dd>
</dl>
<p>The different "layers", namely the device, stacked block devices, and file systems, should utilize the same sector sizes. If they do not, the mapping process from the firmware's translation layer, although usually transparent, will result in overhead that can be avoided.
</p>
<p>You can check the <i>reported</i> logical and physical sector sizes of storage devices with <a href="../en/Device_file.html#lsblk" class="mw-redirect" title="Lsblk">lsblk</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ lsblk -td</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME    ALIGNMENT MIN-IO OPT-IO PHY-SEC LOG-SEC ROTA SCHED       RQ-SIZE  RA WSAME
sda             0   4096      0    4096    4096    1 mq-deadline      64 128    0B
nvme1n1         0   4096      0    4096    4096    0 none           1023 128    0B
nvme0n1         0   4096      0    4096    4096    0 none           1023 128    0B
</pre>
<ul>
<li>
<code>LOG-SEC</code> is the logical sector size (addressable unit used by the operating system).</li>
<li>
<code>PHY-SEC</code> is the physical sector size as reported by the device.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> On NVMe SSDs, the <code>PHY-SEC</code> value typically mirrors the logical sector size and does not reflect the true physical write granularity (e.g., NAND page size or atomic write unit). Most consumer NVMe drives do not expose this information through standard interfaces. The NVMe 1.2a specification defines AWUPF as indexed by logical block units and warns that AWUPF may be zero, and a zero does not represent physical NAND page size.</div>
<p>Alternatively, <code>sysfs</code> entries can be queried:
</p>
<pre>$ cat /sys/class/block/<i>drive</i>/queue/physical_block_size
$ cat /sys/class/block/<i>drive</i>/queue/logical_block_size
</pre>
<p>Sector sizes can also be seen in <a href="../en/Fdisk.html" title="Fdisk">fdisk</a>, <a href="../en/S.M.A.R.T..html#smartctl" class="mw-redirect" title="Smartctl">smartctl</a> and <a href="../en/Hdparm.html" title="Hdparm">hdparm</a> output.
</p>
<p>These values again reflect what the device reports but may <a rel="nofollow" class="external text" href="https://www.evanjones.ca/durability-nvme.html">not be accurate</a> for SSDs or NVMe drives, which often abstract or omit true physical characteristics.
</p>
<p>For more detailed information on NVMe drives, such as supported LBA formats and atomic write unit granularity (if available), the following NVMe CLI commands may help:
</p>
<pre># nvme id-ns /dev/nvme0n1 | grep -i lbaf
# nvme id-ctrl /dev/nvme0n1 | grep -i awupf
</pre>
<p>However, many drives will show only a single LBA format (e.g., <code>lbads:9</code>, meaning 512-byte logical blocks), and an <code>awupf</code> value of <code>0</code>, indicating no atomic write unit information is provided.
</p>
<p><br>
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> For true NAND write sizes and optimal alignment, refer to the manufacturer’s datasheet if available, as it may not be reported via software tools.</div>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Changing_sector_size">Changing sector size</h2></div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> Changing a drive's sector size will irrevocably erase all the data on the drive.</div>
<p>Some NVMe drives and "enterprise" SATA hard disk drives support changing their reported sector size using standard NVMe (<code>Format NVM</code> from NVM Command Set Specification 1.0 or later) or ATA (<code>SET SECTOR CONFIGURATION EXT</code> from ATA Command Set - 4 or later) commands, respectively. For hard disk drives this changes the logical sector size in order to match the physical sector size for optimal performance. While for NVMe solid state drives, both the logical and physical sector size values get changed.
</p>
<p>SATA solid state drives typically do not support changing their sector size. Exception are certain Intel SATA SSDs that can change the reported physical sector size, but not the logical sector size.<a rel="nofollow" class="external autonumber" href="https://superuser.com/q/982680">[2]</a> Follow <a href="#Intel">#Intel</a> to change their reported physical sector size.
</p>
<p>Changing the sector size of a drive is a complex process that requires low-level formatting. As an alternative, you can manually specify the desired sector size when creating file systems on the drive to get optimal performance. See <a href="#dm-crypt">#dm-crypt</a> and <a href="#File_systems">#File systems</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Advanced_Format_hard_disk_drives">Advanced Format hard disk drives</h3></div>
<p>To determine if the sector size of an Advanced Format hard disk drive can be changed, use the <a href="../en/Hdparm.html" title="Hdparm">hdparm</a> utility:
</p>
<pre># hdparm -I /dev/sd<i>X</i> | grep 'Sector size:'
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> For USB-attached drives, the USB bridge needs to support <a href="https://en.wikipedia.org/wiki/SCSI_/_ATA_Translation" class="extiw" title="wikipedia:SCSI / ATA Translation">SAT aka SCSI/ATA Translation</a> (ANSI INCITS 431-2007).</div>
<p>Advanced Format drives whose Sector Configuration Log lists multiple logical sector sizes will show a list of them:
</p>
<pre>        Logical  Sector size:                   512 bytes [ Supported: 512 4096 ]
        Physical Sector size:                  4096 bytes
</pre>
<p>Hard disk drives which do not support multiple changeable logical sector sizes will simply report the current sector sizes. E.g., an Advanced Format 512e drive:
</p>
<pre>        Logical  Sector size:                   512 bytes
        Physical Sector size:                  4096 bytes
</pre>
<p>For optimal performance on these types of drives, ensure the <a href="#dm-crypt">#dm-crypt</a> sector size or <a href="#File_systems">#File systems</a> block size is at least 4096 bytes and aligns to it.
</p>
<p>An Advanced Format 4Kn drive:
</p>
<pre>        Logical  Sector size:                  4096 bytes
        Physical Sector size:                  4096 bytes
</pre>
<p>4Kn drives already have the optimal configuration out of the box and do not need special considerations when partitioning/formatting. They can be simply used as is.
</p>
<p>If your SATA HDD supports multiple logical sector sizes and the optional ATA command <code>SET SECTOR CONFIGURATION EXT</code> (usually only available in so-called "enterprise" class HDDs), you can use <i>hdparm</i> to change between the supported logical sector sizes. 
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> Even if a USB-attached drive reports support for a different sector size and can pass through commands, it is possible that changing the sector size renders the drive unusable afterwards (to the point where it will not attach and no further commands can be sent), as consumer-grade USB bridges may not support different sector sizes. See for example <a rel="nofollow" class="external autonumber" href="https://forum.level1techs.com/t/psa-dont-change-sector-size-of-external-usb-wd-drives/191317">[3]</a>, which is still actual for Western Digital drives as of November 2025.</div>
<p>To set it to 4096 bytes, i.e. 4Kn, run:
</p>
<pre># hdparm --set-sector-size 4096 --please-destroy-my-drive /dev/sd<i>X</i>
</pre>
<p>Afterwards, <i>hdparm</i> should report the logical sector size as 4096 bytes:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># hdparm -I /dev/sd<i>X</i> | grep 'Sector size:'</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">        Logical  Sector size:                  4096 bytes [ Supported: 512 4096 ]
        Physical Sector size:                  4096 bytes
</pre>
<div class="mw-heading mw-heading3"><h3 id="NVMe_solid_state_drives">NVMe solid state drives</h3></div>
<p>Most <a href="../en/Solid_state_drive.html" title="Solid state drive">solid state drives</a> (SSDs) report their logical block address size as 512 bytes, even though they use larger blocks physically - typically 4 KiB, 8 KiB, or sometimes larger.
</p>
<p>To check the formatted logical block address size (FLBAS) of an <a href="../en/Solid_state_drive/NVMe.html" class="mw-redirect" title="NVMe">NVMe</a> drive,  use the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvme-cli">nvme-cli</a></span> utility in addition with <i>Identify Namespace</i> command:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme id-ns -H /dev/nvme0n1 | grep "Relative Performance"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">LBA Format  0 : Metadata Size: 0   bytes - Data Size: 512 bytes - Relative Performance: 0x2 Good (in use)
LBA Format  1 : Metadata Size: 0   bytes - Data Size: 4096 bytes - Relative Performance: 0x1 Better
</pre>
<ul>
<li>
<code>Metadata Size</code> is the number of extra metadata bytes per logical block address (LBA). As this is not well supported under Linux, it is best to select a format with a value of 0 here.</li>
<li>
<code>Relative Performance</code> indicates which format will provide <i>degraded</i>, <i>good</i>, <i>better</i> or <i>best</i> performance.</li>
</ul>
<p><a href="../en/S.M.A.R.T..html#smartctl" class="mw-redirect" title="Smartctl">smartctl</a> can also display the supported logical block address sizes, but it does not provide user friendly descriptions. E.g.:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># smartctl -c /dev/nvme0n1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Supported LBA Sizes (NSID 0x1)
Id Fmt  Data  Metadt  Rel_Perf
 0 +     512       0         2
 1 -    4096       0         1
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> Some NVMe SSDs report they support 4K sectors but encounter sporadic instability upon enabling them, especially under heavy random read loads.<a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?pid=2238884#p2238884">[4]</a><a rel="nofollow" class="external autonumber" href="https://halestrom.net/darksleep/blog/054_nvme/">[5]</a> Make sure to test the new configuration thoroughly before storing data you cannot afford to lose on it. If encountering this issue, simply revert back to a 512 sector configuration.</div>
<p>To change the logical block address size, use <code>nvme format</code> and specify the preferred value with the <code>--lbaf</code> parameter:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme format --lbaf=1 /dev/nvme0n1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">You are about to format nvme0n1, namespace 0x1.
WARNING: Format may irrevocably delete this device's data.
You have 10 seconds to press Ctrl-C to cancel this operation.

Use the force [--force] option to suppress this warning.
Sending format operation ... 
Success formatting namespace:1</pre>
<p>This should take just a few seconds to proceed.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Make sure to follow <a href="#Partition_alignment">#Partition alignment</a> when partitioning, otherwise any performance benefit will be void.</div>
<div class="mw-heading mw-heading3"><h3 id="Using_manufacturer_specific_programs">Using manufacturer specific programs</h3></div>
<p>If the above generic utilities do not allow changing the sector size, it may still be possible to change it using an utility from the drive's manufacturer.
</p>
<div class="mw-heading mw-heading4"><h4 id="Intel">Intel</h4></div>
<p>For Intel use the <a rel="nofollow" class="external text" href="https://downloadcenter.intel.com/download/29337/Intel-Memory-and-Storage-Tool-CLI-Command-Line-Interface-?product=83425">Intel Memory and Storage (MAS) Tool</a> (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/intel-mas-cli-tool/">intel-mas-cli-tool</a></span><sup><small>AUR</small></sup>) with the <code>-set PhysicalSectorSize=4096</code> option. Notice that only reported physical sector size will be changed, logical sector size will remain the same.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Ever since Intel's SSD business was bought by SK Hynix under the Solidigm brand, Intel MAS cannot be used to manage SSDs, only Optane products. Solidigm provides <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/solidigm-sst-storage-tool-cli/">solidigm-sst-storage-tool-cli</a></span><sup><small>AUR</small></sup> to perform the same functions Intel MAS used to offer; see <a href="../en/Solid_state_drive/NVMe.html#Intel/Solidigm" title="Solid state drive/NVMe">Solid state drive/NVMe#Intel/Solidigm</a>.</div>
<div class="mw-heading mw-heading4"><h4 id="Seagate">Seagate</h4></div>
<p>Seagate provides <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/openseachest/">openseachest</a></span><sup><small>AUR</small></sup>. The utilities can be used on non-Seagate drives too since they use standard ATA and NVMe commands.
</p>
<p>Scan all drives to find the correct one, and print info from the one you found:
</p>
<pre># openSeaChest_Basics --scan
# openSeaChest_Basics -d /dev/sd<i>X</i> -i
</pre>
<p>Should print out information about the drive. Make sure to check the serial number.
</p>
<p>Check the logical block sizes supported by the drive:
</p>
<pre># openSeaChest_Format -d /dev/sd<i>X</i> --showSupportedFormats
</pre>
<p>If 4096 is listed, you can change the logical sector size to it as follows:
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> Seagate warns that any interruption to the operation may render the drive inoperable, and thus recommends minimizing all disk activities for the time (other drives as well, as they might compete for disk controller resources). The safest is to do this from a live USB where there are no extra background processes.</div>
<pre># openSeaChest_Format -d /dev/sd<i>X</i> --setSectorSize=4096 --confirm this-will-erase-data-and-may-render-the-drive-inoperable
</pre>
<p>This will take a couple of minutes, after which your drive now uses a 4 KiB native sector size.
</p>
<div class="mw-heading mw-heading2"><h2 id="Partition_alignment">Partition alignment</h2></div>
<p>Aligning partitions correctly avoids excessive read-modify-write cycles. A typical practice for personal computers is to have each partition's start and size aligned to 1 MiB (1 048 576 bytes) marks. This covers all common page and block size scenarios, as it is divisible by all commonly used sizes—1 MiB, 512 KiB, 128 KiB, 4 KiB, and 512 B.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> Misaligned partitions will prevent being able to use 4096 byte sectors with dm-crypt/LUKS. See <a rel="nofollow" class="external autonumber" href="https://lore.kernel.org/dm-crypt/fe8cd3b4-6d50-66d3-375c-254e278a6443@gmail.com/">[6]</a>.</div>
<ul>
<li>
<a href="../en/Fdisk.html" title="Fdisk">fdisk, cfdisk and sfdisk</a> handle alignment automatically.</li>
<li>
<a href="../en/GPT_fdisk.html" title="GPT fdisk">gdisk and cgdisk</a> handle alignment automatically.
<ul><li>
<i>sgdisk</i> by default only aligns the start of partitions. Use the <code>-I</code>/<code>--align-end</code> option to additionally enable partition size/end alignment.</li></ul>
</li>
<li>
<a href="../en/Parted.html#Alignment" title="Parted">Parted</a> only aligns the start of the partition, but not the size/end. When creating partitions, make sure to specify the partition end in mebibytes or a larger IEC binary unit.</li>
</ul>
<p><a rel="nofollow" class="external text" href="https://github.com/crysman/check-partitions-alignment">checkpartitionsalignment.sh</a> is a bash script that checks for alignment using <a href="../en/Parted.html" title="Parted">Parted</a> and awk.
</p>
<div class="mw-heading mw-heading2"><h2 id="dm-crypt">dm-crypt</h2></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Add example for plain dm-crypt. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Advanced_Format.html">Talk:Advanced Format</a>)</div>
</div>
<p>As of <a href="../en/Dm-crypt/Device_encryption.html#Cryptsetup_usage" class="mw-redirect" title="Cryptsetup">Cryptsetup</a> 2.4.0, <code>luksFormat</code> automatically detects the optimal encryption sector size for LUKS2 format <a rel="nofollow" class="external autonumber" href="https://mirrors.edge.kernel.org/pub/linux/utils/cryptsetup/v2.4/v2.4.0-ReleaseNotes">[7]</a>. 
</p>
<p>However, for this to work, the device needs to report the correct default sector size, see <a href="#Changing_sector_size">#Changing sector size</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> Cryptsetup strongly recommends changing the drive's logical sector size to 4096 bytes for encryption performance.<a rel="nofollow" class="external autonumber" href="https://cdn.kernel.org/pub/linux/utils/cryptsetup/v2.8/v2.8.0-ReleaseNotes">[8]</a>
</div>
<p>After using <code>cryptsetup luksFormat</code>, you can check the sector size used by the LUKS2 volume with
</p>
<pre># cryptsetup luksDump <i>device</i> | grep sector
</pre>
<p>If the default sector size is incorrect, you can force create a LUKS2 container with a 4 KiB sector size and otherwise default options with: 
</p>
<pre># cryptsetup luksFormat --sector-size=4096 <i>device</i>
</pre>
<p>The command will abort on an error if the requested size does not match your device:
</p>
<pre># cryptsetup luksFormat --sector-size 4096 <i>device</i>
(...)
Verify passphrase: 
Device size is not aligned to requested sector size.
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> See <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/-/issues/585">cryptsetup issue 585</a> for why the command may fail while the underlying drive does use 4 KiB physical sectors.</div>
<p>If you encrypted your device with the wrong sector size, the device can be re-encrypted by running:
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> The contained file system must have a block size of 4096 bytes or a multiple of it, otherwise it will break.</div>
<pre># cryptsetup reencrypt --sector-size=4096 <i>device</i>
</pre>
<div class="mw-heading mw-heading2"><h2 id="File_systems">File systems</h2></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Differentiate which <i>mkfs</i> utilities use 4096 explicitly and which use the page size (<code>getconf PAGESIZE</code>). (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Advanced_Format.html">Talk:Advanced Format</a>)</div>
</div>
<p>On 4Kn disks (4096 byte physical sector size and 4096 byte logical sector size) all <i>mkfs</i> utilities will use a block size of 4096 bytes. On 512e (4096 byte physical sector size, 512 byte logical sector size) and 512n (512 byte physical sector size and 512 byte logical sector size) disks, each <i>mkfs</i> utility behaves differently.
</p>
<table class="wikitable">
<caption>File system block size in bytes on non-4Kn disks
</caption>
<tbody>
<tr>
<th>
<i>mkfs</i> utility</th>
<th>512e disk</th>
<th>512n disk
</th>
</tr>
<tr>
<td><i>mkfs.bcachefs</i></td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096</td>
<td class="archwiki-table-cell archwiki-template-o" data-sort-value="2">
<a rel="nofollow" class="external text" href="https://github.com/koverstreet/bcachefs/issues/765">512</a>
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.btrfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.btrfs.8">mkfs.btrfs(8)</a></span></td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096</td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.exfat"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.exfat.8">mkfs.exfat(8)</a></span></td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096</td>
<td class="archwiki-table-cell archwiki-template-o" data-sort-value="2">512
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.ext4"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.ext4.8">mkfs.ext4(8)</a></span></td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096<sup>1</sup>
</td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096<sup>1</sup>
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.fat"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.fat.8">mkfs.fat(8)</a></span></td>
<td class="archwiki-table-cell archwiki-template-r" data-sort-value="1">512</td>
<td class="archwiki-table-cell archwiki-template-o" data-sort-value="2">512
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.f2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.f2fs.8">mkfs.f2fs(8)</a></span></td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096</td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.jfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.jfs.8">mkfs.jfs(8)</a></span></td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096</td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.nilfs2"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.nilfs2.8">mkfs.nilfs2(8)</a></span></td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096</td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.ntfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.ntfs.8">mkfs.ntfs(8)</a></span></td>
<td class="archwiki-table-cell archwiki-template-r" data-sort-value="1"><a rel="nofollow" class="external text" href="https://github.com/tuxera/ntfs-3g/issues/133">512</a></td>
<td class="archwiki-table-cell archwiki-template-o" data-sort-value="2">512
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.reiserfs"><a rel="nofollow" class="external text" href="https://manpages.debian.org/unstable/reiserfsprogs/mkfs.reiserfs.8.en.html">mkfs.reiserfs(8)</a></span></td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096</td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.udf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.udf.8">mkfs.udf(8)</a></span></td>
<td class="archwiki-table-cell archwiki-template-r" data-sort-value="1">512</td>
<td class="archwiki-table-cell archwiki-template-o" data-sort-value="2">512
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.xfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.xfs.8">mkfs.xfs(8)</a></span></td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096</td>
<td class="archwiki-table-cell archwiki-template-o" data-sort-value="2">512
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkswap"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkswap.8">mkswap(8)</a></span></td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096</td>
<td class="archwiki-table-cell archwiki-template-g" data-sort-value="5">4096
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 zpool-create">zpool-create(8)</span></td>
<td class="archwiki-table-cell archwiki-template-r" data-sort-value="1">512</td>
<td class="archwiki-table-cell archwiki-template-o" data-sort-value="2">512
</td>
</tr>
</tbody>
</table>
<ol><li>
<span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.ext4"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.ext4.8">mkfs.ext4(8)</a></span> defaults to 1024 byte sectors for file systems smaller than 512 MiB and 4096 byte sectors for 512 MiB and larger.</li></ol>
<p>If the storage device does not report the correct sector size, you can explicitly format the partitions according to the physical sector size.
</p>
<p>In particular <i>shingled magnetic recording</i> (SMR) drives that are firmware-managed are severely and negatively impacted if using a logical sector size of 512 bytes if their physical sector size is of 4096 bytes. Those drives have different performance writing zones and remapping reallocation occurs while being idle, but during heavy active writes (e.g., RAID resilvering, backups, writing many small files, rsync, etc.), a different file system sector size could drop write speed to single digit megabytes/second, as the higher performance write areas get depleted, and the sector translation layer gets overworked on the shingled areas. 
</p>
<p>Here are some examples to set the 4096-byte sector size explicitly:
</p>
<ul>
<li>
<a href="../en/Bcachefs.html" title="Bcachefs">Bcachefs</a>: <pre># bcachefs format --block_size=4096 /dev/<i>device0</i> /dev/<i>deviceN</i> --replicas=<i>n</i></pre>
</li>
<li>exFAT: <pre># mkfs.exfat -s 4096 /dev/<i>device</i></pre>
</li>
<li>
<a href="../en/Ext4.html" title="Ext4">ext4</a>: <pre># mkfs.ext4 -b 4096 /dev/<i>device</i></pre>
</li>
<li>
<a href="../en/FAT.html" title="FAT">FAT</a>: <pre># mkfs.fat -S 4096 /dev/<i>device</i></pre>
</li>
<li>
<a href="../en/NTFS-3G.html" title="NTFS-3G">NTFS-3G</a>: <pre># mkfs.ntfs -Q -s 4096 /dev/<i>device</i></pre>
</li>
<li>UDF: <pre># mkfs.udf -b 4096 /dev/<i>device</i></pre>
</li>
<li>
<a href="../en/XFS.html" title="XFS">XFS</a>: <pre># mkfs.xfs -s size=4096 /dev/<i>device</i></pre>
</li>
<li>
<a rel="nofollow" class="external text" href="https://openzfs.github.io/openzfs-docs/Project%20and%20Community/FAQ.html#advanced-format-disks">ZFS</a>: <pre># zpool create -o ashift=12 <i>poolname</i> raidz <i>device0</i> … <i>deviceN</i></pre>
</li>
</ul>
<div class="mw-heading mw-heading2"><h2 id="Known_issues">Known issues</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Syslinux_and_FAT">Syslinux and FAT</h3></div>
<p><a href="../en/Syslinux.html" title="Syslinux">Syslinux</a> does not support FAT file systems with a sector size other than 512 bytes.
</p>
<div class="mw-heading mw-heading3"><h3 id="systemd-homed">systemd-homed</h3></div>
<p><a href="../en/Systemd-homed.html" title="Systemd-homed">systemd-homed</a> does not work on 4Kn drives and LUKS with a 4096 byte sector size. See systemd issues <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/30393">30393</a> and <a rel="nofollow" class="external text" href="https://github.com/systemd/systemd/issues/30394">30394</a>.
</p>
<div class="mw-heading mw-heading2"><h2 id="Troubleshooting">Troubleshooting</h2></div>
<div class="mw-heading mw-heading3"><h3 id="NVMe_drives_fail_to_format">NVMe drives fail to format</h3></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> There is no need for subsections. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Advanced_Format.html">Talk:Advanced Format</a>)</div>
</div>
<p>Some NVMe drives do not support the <code>nvme format</code> command, which is required to change the sector size (LBA format). This is still compliant with the NVMe specification. The issue may also present itself as <code>INVALID_OPCODE(2001)</code> or <code>INVALID_FORMAT: The LBA Format specified is not supported. This may be due to various conditions(0x10a)</code>. If this is the case, review the links under References below.
</p>
<p>To check whether your drive supports the Format NVM command:
</p>
<pre># nvme id-ctrl /dev/nvme0 | grep oacs
</pre>
<p>Look at the <code>oacs</code> field (Optional Admin Command Support), which is a <a href="https://en.wikipedia.org/wiki/Mask_(computing)" class="extiw" title="wikipedia:Mask (computing)">bitmask</a>. Format NVM support corresponds to bit 1 (value <code>0x02</code>).
If bit 1 is not set, your controller does not support Format NVM and you will not be able to change the LBA format.
</p>
<p>Example (Format NVM not supported):
</p>
<pre>oacs      : 0x1d
</pre>
<p>Convert <code>0x1d</code> to binary: <code>0001 1101</code>  
→ Bit 1 is not set (second bit from the right is 0)  
→ Format NVM is not supported
</p>
<p>In some cases, formatting still fails even when Format NVM is supported. This is commonly seen on drives using Pyrite but notably not OPAL security, especially on Intel platforms using S0ix (Modern Standby). In other cases, <code>oacs</code> may report Format NVM as unsupported, yet formatting works after a suspend/resume cycle.
</p>
<div class="mw-heading mw-heading4"><h4 id="Workarounds">Workarounds</h4></div>
<ul>
<li>Disable S0ix (Modern Standby) in firmware (set sleep mode to S3 / S2idle)</li>
<li>Add kernel parameter: <code>mem_sleep_default=s2idle</code>
</li>
<li>Suspend/resume the system before formatting</li>
</ul>
<div class="mw-heading mw-heading4"><h4 id="Affected_models">Affected models</h4></div>
<p>Known on Hynix PC601, Lenovo and Dell laptops, Samsung and WD SN750 drives.
</p>
<div class="mw-heading mw-heading4"><h4 id="References">References</h4></div>
<ul>
<li><a rel="nofollow" class="external text" href="https://github.com/linux-nvme/nvme-cli/issues/84">github.com/nvme-cli#84</a></li>
<li><a rel="nofollow" class="external text" href="https://github.com/linux-nvme/nvme-cli/issues/816">github.com/nvme-cli#816</a></li>
<li><a rel="nofollow" class="external text" href="https://forums.sandisk.com/t/sn750-cannot-format-using-the-nvme-command/253702/9">SanDisk Forum: SN750</a></li>
<li><a rel="nofollow" class="external text" href="https://forums.lenovo.com/t5/ThinkPad-T400-T500-and-newer-T-series-Laptops/nvme-format-failing-with-4096-byte-sector-size/m-p/5043069">Lenovo Forum: 4Kn format issue</a></li>
</ul>
<div class="mw-heading mw-heading2"><h2 id="See_also">See also</h2></div>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.anandtech.com/Show/Index/2888">Western Digital’s Advanced Format: The 4K Sector Transition Begins</a></li>
<li><a rel="nofollow" class="external text" href="https://www.wdc.com/wdproducts/library/WhitePapers/ENG/2579-771430.pdf">White paper entitled "Advanced Format Technology."</a></li>
<li>Failure to align one's HDD results in poor read/write performance.  See <a rel="nofollow" class="external autonumber" href="https://linuxconfig.org/linux-wd-ears-advanced-format">[9]</a> for specific examples.</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Storage.html" title="Category:Storage">Storage</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Move.html" title="Category:Pages or sections flagged with Template:Move">Pages or sections flagged with Template:Move</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Advanced_Format&amp;oldid=854871">https://wiki.archlinux.org/index.php?title=Advanced_Format&amp;oldid=854871</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 1 December 2025, at 14:18.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true"><span class="mw-page-title-main">Advanced Format</span></div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
