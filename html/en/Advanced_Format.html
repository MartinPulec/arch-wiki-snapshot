<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Advanced Format - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Advanced_Format rootpage-Advanced_Format skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Changing_sector_size" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Changing_sector_size">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Changing sector size</div>
		</a>
		
			<button aria-controls="toc-Changing_sector_size-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Changing sector size subsection</span>
			</button>
		
		<ul id="toc-Changing_sector_size-sublist" class="vector-toc-list">
			<li id="toc-Advanced_Format_hard_disk_drives" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Advanced_Format_hard_disk_drives">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Advanced Format hard disk drives</div>
			</a>
			
			<ul id="toc-Advanced_Format_hard_disk_drives-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-NVMe_solid_state_drives" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#NVMe_solid_state_drives">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>NVMe solid state drives</div>
			</a>
			
			<ul id="toc-NVMe_solid_state_drives-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_manufacturer_specific_programs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_manufacturer_specific_programs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Using manufacturer specific programs</div>
			</a>
			
			<ul id="toc-Using_manufacturer_specific_programs-sublist" class="vector-toc-list">
				<li id="toc-Intel" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Intel">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.1</span>Intel</div>
			</a>
			
			<ul id="toc-Intel-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Seagate" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Seagate">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3.2</span>Seagate</div>
			</a>
			
			<ul id="toc-Seagate-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Partition_alignment" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Partition_alignment">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Partition alignment</div>
		</a>
		
		<ul id="toc-Partition_alignment-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-dm-crypt" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#dm-crypt">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>dm-crypt</div>
		</a>
		
		<ul id="toc-dm-crypt-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-File_systems" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#File_systems">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>File systems</div>
		</a>
		
		<ul id="toc-File_systems-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Advanced Format</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 5 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-5" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">5 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/Advanced_Format.html" title="Advanced Format – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Advanced_Format" title="Advanced Format – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Advanced_Format.html" title="Advanced Format – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-tr mw-list-item"><a href="../tr/Advanced_Format.html" title="Advanced Format – Türkçe" lang="tr" hreflang="tr" class="interlanguage-link-target"><span>Türkçe</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/%E5%85%88%E8%BF%9B%E6%A0%BC%E5%BC%8F%E5%8C%96" title="先进格式化 – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-go-next.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is a candidate for moving to <a href="/index.php?title=Storage_layout_and_alignment&amp;action=edit&amp;redlink=1" class="new" title="Storage layout and alignment (page does not exist)">Storage layout and alignment</a>.</b></p>
<div>
<b>Notes:</b> "Advanced Format" is HDD-specific. (Discuss in <a href="../en/Talk:Advanced_Format.html#Rewrite_Advanced_Format_to_a_new_Sector_Sizes_page" title="Talk:Advanced Format">Talk:Advanced Format#Rewrite Advanced Format to a new Sector Sizes page</a>)</div>
</div>
<p>The minimum physical storage unit of a hard disk drive (HDD) is a <a href="https://en.wikipedia.org/wiki/Disk_sector" class="extiw" title="wikipedia:Disk sector">sector</a>. The solid state drive (SSD) equivalent is a page.<a rel="nofollow" class="external autonumber" href="https://www.oo-software.com/en/docs/whitepaper/whitepaper_ssd.pdf">[1]</a> Storage device firmware abstract away their physical sectors into logical sectors that software can operate on. The size of this sector refers to the size of the smallest addressable unit on the disk.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Software and documentation may sometimes refer to "sectors" and "blocks" interchangeably, regardless of the storage type.</div>
<dl>
<dt>Physical sector size</dt>
<dd>This is the smallest unit a physical storage device claims it can write atomically. For HDDs, it is the actual size of sectors in a platter. Traditionally, the physical sector size for HDDs was 512 bytes, meaning that each sector could hold 512 bytes of data. However, with the introduction of <a href="https://en.wikipedia.org/wiki/Advanced_Format#History" class="extiw" title="wikipedia:Advanced Format">Advanced Format</a> HDDs, the physical sector size was increased to 4096 bytes (4 KiB) for increased storage density and improved error correction capabilities. SSDs do not expose their actual NAND flash memory page size, which typically ranges from 4 KiB to 16 KiB, instead their reported physical sector size is the same as their logical sector size. For NVMe SSDs, if it is available, the Atomic Write Unit Power Fail (AWUPF) parameter value is used.</dd>
<dt>Logical sector size</dt>
<dd>The logical sector size, also known as the operating system sector size, represents the size of the sectors exposed to the operating system and applications. It is the sector size used for reading from and writing to the storage device at the software level. The logical sector size can differ from the physical sector size. For example, an Advanced Format HDD with a physical sector size of 4096 bytes may still present a logical sector size of 512 bytes for compatibility with older systems and applications.</dd>
</dl>
<p>The different "layers", namely the device, stacked block devices, and file systems, should utilize the same sector sizes. If they do not, the mapping process from the firmware's translation layer, although usually transparent, will result in overhead that can be avoided.
</p>
<p>The current physical and logical sector sizes values can be listed with <a href="../en/Device_file.html#lsblk" class="mw-redirect" title="Lsblk">lsblk</a>:
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Neither of the commands below (<code>lsblk</code> or <code>cat /sys/class...</code>) will accurately provide the physical sector size on NVMe drives (probably all SSDs), and will report the logical sector size instead. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Advanced_Format.html">Talk:Advanced Format</a>)</div>
</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ lsblk -td</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME    ALIGNMENT MIN-IO OPT-IO PHY-SEC LOG-SEC ROTA SCHED       RQ-SIZE  RA WSAME
sda             0   4096      0    4096    4096    1 mq-deadline      64 128    0B
nvme1n1         0   4096      0    4096    4096    0 none           1023 128    0B
nvme0n1         0   4096      0    4096    4096    0 none           1023 128    0B
</pre>
<p>The <code>PHY-SEC</code> shows the physical sector size and <code>LOG-SEC</code>—the logical sector size.
</p>
<p>Alternatively, the values for a specific drive can read from the following sysfs entries: 
</p>
<pre>$ cat /sys/class/block/<i>drive</i>/queue/physical_block_size
$ cat /sys/class/block/<i>drive</i>/queue/logical_block_size
</pre>
<p>Sector sizes can also be seen in <a href="../en/Fdisk.html" title="Fdisk">fdisk</a>, <a href="../en/S.M.A.R.T..html#smartctl" class="mw-redirect" title="Smartctl">smartctl</a> and <a href="../en/Hdparm.html" title="Hdparm">hdparm</a> output.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Changing_sector_size">Changing sector size</span></h2>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Changing a drive's sector size will irrevocably erase all the data on the drive.</div>
<p>Some NVMe drives and "enterprise" SATA hard disk drives support changing their reported sector size using standard NVMe (<code>Format NVM</code> from NVM Command Set Specification 1.0 or later) or ATA (<code>SET SECTOR CONFIGURATION EXT</code> from ATA Command Set - 4 or later) commands, respectively. For hard disk drives this changes the logical sector size in order to match the physical sector size for optimal performance. While for NVMe solid state drives, both the logical and physical sector size values get changed.
</p>
<p>SATA solid state drives typically do not support changing their sector size. Exception are certain Intel SATA SSDs that can change the reported physical sector size, but not the logical sector size.<a rel="nofollow" class="external autonumber" href="https://superuser.com/q/982680">[2]</a> Follow <a href="#Intel">#Intel</a> to change their reported physical sector size.
</p>
<p>Changing the sector size of a drive is a complex process that requires low-level formatting. As an alternative, you can manually specify the desired sector size when creating file systems on the drive to get optimal performance. See <a href="#dm-crypt">#dm-crypt</a> and <a href="#File_systems">#File systems</a>.
</p>
<h3><span class="mw-headline" id="Advanced_Format_hard_disk_drives">Advanced Format hard disk drives</span></h3>
<p>To determine if the sector size of an Advanced Format hard disk drive can be changed, use the <a href="../en/Hdparm.html" title="Hdparm">hdparm</a> utility:
</p>
<pre># hdparm -I /dev/sd<i>X</i> | grep 'Sector size:'
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> For USB-attached drives, the USB bridge needs to support <a href="https://en.wikipedia.org/wiki/SCSI_/_ATA_Translation" class="extiw" title="wikipedia:SCSI / ATA Translation">SAT aka SCSI/ATA Translation</a> (ANSI INCITS 431-2007).</div>
<p>Advanced Format drives whose Sector Configuration Log lists multiple logical sector sizes will show a list of them:
</p>
<pre>        Logical  Sector size:                   512 bytes [ Supported: 512 4096 ]
        Physical Sector size:                  4096 bytes
</pre>
<p>Hard disk drives which do not support multiple changeable logical sector sizes will simply report the current sector sizes. E.g., an Advanced Format 512e drive:
</p>
<pre>        Logical  Sector size:                   512 bytes
        Physical Sector size:                  4096 bytes
</pre>
<p>For optimal performance on these types of drives, ensure the <a href="#dm-crypt">#dm-crypt</a> sector size or <a href="#File_systems">#File systems</a> block size is at least 4096 bytes and aligns to it.
</p>
<p>An Advanced Format 4Kn drive:
</p>
<pre>        Logical  Sector size:                  4096 bytes
        Physical Sector size:                  4096 bytes
</pre>
<p>4Kn drives already have the optimal configuration out of the box and do not need special considerations when partitioning/formatting. They can be simply used as is.
</p>
<p>If your SATA HDD supports multiple logical sector sizes and the optional ATA command <code>SET SECTOR CONFIGURATION EXT</code> (e.g. Seagate drives advertising FastFormat support), you can use <i>hdparm</i> to change between the supported logical sector sizes. To set it to 4096 bytes, i.e. 4Kn, run:
</p>
<pre># hdparm --set-sector-size 4096 --please-destroy-my-drive /dev/sd<i>X</i>
</pre>
<p>Afterwards, <i>hdparm</i> should report the logical sector size as 4096 bytes:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># hdparm -I /dev/sd<i>X</i> | grep 'Sector size:'</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">        Logical  Sector size:                  4096 bytes [ Supported: 512 4096 ]
        Physical Sector size:                  4096 bytes
</pre>
<h3><span class="mw-headline" id="NVMe_solid_state_drives">NVMe solid state drives</span></h3>
<p>Most <a href="../en/Solid_state_drive.html" title="Solid state drive">solid state drives</a> (SSDs) report their logical block address size as 512 bytes, even though they use larger blocks physically - typically 4 KiB, 8 KiB, or sometimes larger.
</p>
<p>To check the formatted logical block address size (FLBAS) of an <a href="../en/Solid_state_drive/NVMe.html" class="mw-redirect" title="NVMe">NVMe</a> drive,  use the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvme-cli">nvme-cli</a></span> utility in addition with <i>Identify Namespace</i> command:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme id-ns -H /dev/nvme0n1 | grep "Relative Performance"</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">LBA Format  0 : Metadata Size: 0   bytes - Data Size: 512 bytes - Relative Performance: 0x2 Good (in use)
LBA Format  1 : Metadata Size: 0   bytes - Data Size: 4096 bytes - Relative Performance: 0x1 Better
</pre>
<ul>
<li>
<code>Metadata Size</code> is the number of extra metadata bytes per logical block address (LBA). As this is not well supported under Linux, it is best to select a format with a value of 0 here.</li>
<li>
<code>Relative Performance</code> indicates which format will provide <i>degraded</i>, <i>good</i>, <i>better</i> or <i>best</i> performance.</li>
</ul>
<p><a href="../en/S.M.A.R.T..html#smartctl" class="mw-redirect" title="Smartctl">smartctl</a> can also display the supported logical block address sizes, but it does not provide user friendly descriptions. E.g.:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># smartctl -c /dev/nvme0n1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
Supported LBA Sizes (NSID 0x1)
Id Fmt  Data  Metadt  Rel_Perf
 0 +     512       0         2
 1 -    4096       0         1
</pre>
<p>To change the logical block address size, use <code>nvme format</code> and specify the preferred value with the <code>--lbaf</code> parameter:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># nvme format --lbaf=1 /dev/nvme0n1</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">You are about to format nvme0n1, namespace 0x1.
WARNING: Format may irrevocably delete this device's data.
You have 10 seconds to press Ctrl-C to cancel this operation.

Use the force [--force] option to suppress this warning.
Sending format operation ... 
Success formatting namespace:1</pre>
<p>This should take just a few seconds to proceed.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Make sure to follow <a href="#Partition_alignment">#Partition alignment</a> when partitioning, otherwise any performance benefit will be void.</div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Before fiddling with power state or UEFI settings, users are encouraged to use native <code>nvme</code> commands to check operation logs, or soft reset the controller with <i>e.g.</i> <code>nvme reset</code>. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Advanced_Format.html">Talk:Advanced Format</a>)</div>
</div>
<p>Drives older than 2020 can block the <code>Format NVM</code> command when used on systems that issue a non-standard "security freeze" at the end of POST.<a rel="nofollow" class="external autonumber" href="https://github.com/linux-nvme/nvme-cli/issues/816">[3]</a><a rel="nofollow" class="external autonumber" href="https://forums.lenovo.com/topic/findpost/1300/5043069/5167342">[4]</a> If <code>nvme format</code> fails, try to <a href="../en/Systemd.html#Power_management" title="Systemd">suspend the system</a> (make sure to <a href="../en/Power_management/Suspend_and_hibernate.html#Changing_suspend_method" title="Power management/Suspend and hibernate">use S3 sleep not S0ix</a>) and then try running <code>nvme format</code> again after waking it.<a rel="nofollow" class="external autonumber" href="https://github.com/linux-nvme/nvme-cli/issues/84">[5]</a><a rel="nofollow" class="external autonumber" href="https://community.wd.com/t/sn750-cannot-format-using-the-nvme-command/254374">[6]</a>
</p>
<h3><span class="mw-headline" id="Using_manufacturer_specific_programs">Using manufacturer specific programs</span></h3>
<p>If the above generic utilities do not allow changing the sector size, it may still be possible to change it using an utility from the drive's manufacturer.
</p>
<h4><span class="mw-headline" id="Intel">Intel</span></h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> Ever since Intel's SSD business was bought by SK Hynix under the Solidigm brand, Intel MAS cannot be used to manage SSDs, only Optane products. Solidigm provides <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/solidigm-sst-storage-tool-cli/">solidigm-sst-storage-tool-cli</a></span><sup><small>AUR</small></sup> to perform the same functions Intel MAS used to offer: see <a href="../en/Solid_state_drive/NVMe.html#Intel/Solidigm" title="Solid state drive/NVMe">Solid_state_drive/NVMe#Intel/Solidigm</a>. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Advanced_Format.html">Talk:Advanced Format</a>)</div>
</div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Intel's tool only changes the reported physical sector size, the logical sector size still remains 512 bytes.<a rel="nofollow" class="external autonumber" href="https://superuser.com/q/982680">[7]</a> (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Advanced_Format.html">Talk:Advanced Format</a>)</div>
</div>
<p>For Intel use the <a rel="nofollow" class="external text" href="https://downloadcenter.intel.com/download/29337/Intel-Memory-and-Storage-Tool-CLI-Command-Line-Interface-?product=83425">Intel Memory and Storage (MAS) Tool</a> (<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/intel-mas-cli-tool/">intel-mas-cli-tool</a></span><sup><small>AUR</small></sup>) with the <code>-set PhysicalSectorSize=4096</code> option.
</p>
<h4><span class="mw-headline" id="Seagate">Seagate</span></h4>
<p>For Seagate use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/openseachest/">openseachest</a></span><sup><small>AUR</small></sup>.
</p>
<p>Scan all drives to find the correct one, and print info from the one you found:
</p>
<pre># openSeaChest_Basics --scan
# openSeaChest_Basics -d /dev/sd<i>X</i> -i
</pre>
<p>Should print out information about the drive. Make sure to check the serial number.
</p>
<p>Check the logical block sizes supported by the drive:
</p>
<pre># openSeaChest_Format -d /dev/sd<i>X</i> --showSupportedFormats
</pre>
<p>If 4096 is listed, you can change the logical sector size to it as follows:
</p>
<pre># openSeaChest_Format -d /dev/sd<i>X</i> --setSectorSize=4096 --confirm this-will-erase-data
</pre>
<p>This will take a couple of minutes, after which your drive now uses a 4 KiB native sector size.
</p>
<h2><span class="mw-headline" id="Partition_alignment">Partition alignment</span></h2>
<p>Aligning partitions correctly avoids excessive read-modify-write cycles. A typical practice for personal computers is to have each partition's start and size aligned to 1 MiB (1 048 576 bytes) marks. This covers all common page and block size scenarios, as it is divisible by all commonly used sizes—1 MiB, 512 KiB, 128 KiB, 4 KiB, and 512 B.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Misaligned partitions will prevent being able to use 4096 byte sectors with dm-crypt/LUKS. See <a rel="nofollow" class="external autonumber" href="https://lore.kernel.org/dm-crypt/fe8cd3b4-6d50-66d3-375c-254e278a6443@gmail.com/">[8]</a>.</div>
<ul>
<li>
<a href="../en/Fdisk.html" title="Fdisk">fdisk, cfdisk and sfdisk</a> handle alignment automatically.</li>
<li>
<a href="../en/GPT_fdisk.html" title="GPT fdisk">gdisk and cgdisk</a> handle alignment automatically.
<ul><li>
<i>sgdisk</i> by default only aligns the start of partitions. Use the <code>-I</code>/<code>--align-end</code> option to additionally enable partition size/end alignment.</li></ul>
</li>
<li>
<a href="../en/Parted.html#Alignment" title="Parted">Parted</a> only aligns the start of the partition, but not the size/end. When creating partitions, make sure to specify the partition end in mebibytes or a larger IEC binary unit.</li>
</ul>
<p><a rel="nofollow" class="external text" href="https://github.com/crysman/check-partitions-alignment">checkpartitionsalignment.sh</a> is a bash script that checks for alignment using <a href="../en/Parted.html" title="Parted">Parted</a> and awk.
</p>
<h2><span class="mw-headline" id="dm-crypt">dm-crypt</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Add example for plain dm-crypt. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Advanced_Format.html">Talk:Advanced Format</a>)</div>
</div>
<p>As of <a href="../en/Dm-crypt/Device_encryption.html#Cryptsetup_usage" class="mw-redirect" title="Cryptsetup">Cryptsetup</a> 2.4.0, <code>luksFormat</code> automatically detects the optimal encryption sector size for LUKS2 format <a rel="nofollow" class="external autonumber" href="https://mirrors.edge.kernel.org/pub/linux/utils/cryptsetup/v2.4/v2.4.0-ReleaseNotes">[9]</a>. 
</p>
<p>However, for this to work, the device needs to report the correct default sector size, see <a href="#Changing_sector_size">#Changing sector size</a>.
</p>
<p>After using <code>cryptsetup luksFormat</code>, you can check the sector size used by the LUKS2 volume with
</p>
<pre># cryptsetup luksDump <i>device</i> | grep sector
</pre>
<p>If the default sector size is incorrect, you can force create a LUKS2 container with a 4 KiB sector size and otherwise default options with: 
</p>
<pre># cryptsetup luksFormat --sector-size=4096 <i>device</i>
</pre>
<p>The command will abort on an error if the requested size does not match your device:
</p>
<pre># cryptsetup luksFormat --sector-size 4096 <i>device</i>
(...)
Verify passphrase: 
Device size is not aligned to requested sector size.
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> See <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/-/issues/585">cryptsetup issue 585</a> for why the command may fail while the underlying drive does use 4 KiB physical sectors.</div>
<p>If you encrypted your device with the wrong sector size, the device can be re-encrypted by running:
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The contained file system must have a block size of 4096 bytes or a multiple of it, otherwise it will break.</div>
<pre># cryptsetup reencrypt --sector-size=4096 <i>device</i>
</pre>
<h2><span class="mw-headline" id="File_systems">File systems</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Differentiate which <i>mkfs</i> utilities use 4096 explicitly and which use the page size (<code>getconf PAGESIZE</code>). (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Advanced_Format.html">Talk:Advanced Format</a>)</div>
</div>
<p>On 4Kn disks (4096 byte physical sector size and 4096 byte logical sector size) all <i>mkfs</i> utilities will use a block size of 4096 bytes. On 512e (4096 byte physical sector size, 512 byte logical sector size) and 512n (512 byte physical sector size and 512 byte logical sector size) disks, each <i>mkfs</i> utility behaves differently.
</p>
<table class="wikitable">
<caption>File system block size in bytes on non-4Kn disks
</caption>
<tbody>
<tr>
<th>
<i>mkfs</i> utility</th>
<th>512e disk</th>
<th>512n disk
</th>
</tr>
<tr>
<td><i>mkfs.bcachefs</i></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">4096</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">512
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.btrfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.btrfs.8">mkfs.btrfs(8)</a></span></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">4096</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">4096
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.exfat"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.exfat.8">mkfs.exfat(8)</a></span></td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">512</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">512
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.ext4"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.ext4.8">mkfs.ext4(8)</a></span></td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">4096<sup>1</sup>
</td>
<td data-sort-value="3" style="background: #ffa; color: inherit; vertical-align: middle; text-align: center;">4096<sup>1</sup>
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.fat"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.fat.8">mkfs.fat(8)</a></span></td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">512</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">512
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.f2fs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.f2fs.8">mkfs.f2fs(8)</a></span></td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">512</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">512
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.jfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.jfs.8">mkfs.jfs(8)</a></span></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">4096</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">4096
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.nilfs2"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.nilfs2.8">mkfs.nilfs2(8)</a></span></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">4096</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">4096
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.ntfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.ntfs.8">mkfs.ntfs(8)</a></span></td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">512</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">512
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.reiserfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.reiserfs.8">mkfs.reiserfs(8)</a></span></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">4096</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">4096
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.udf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.udf.8">mkfs.udf(8)</a></span></td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">512</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">512
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.xfs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.xfs.8">mkfs.xfs(8)</a></span></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">4096</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">512
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 mkswap"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkswap.8">mkswap(8)</a></span></td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">4096</td>
<td data-sort-value="5" style="background: #afa; color: inherit; vertical-align: middle; text-align: center;">4096
</td>
</tr>
<tr>
<td><span class="plainlinks archwiki-template-man" title="$ man 8 zpool-create">zpool-create(8)</span></td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">512</td>
<td data-sort-value="1" style="background: #faa; color: inherit; vertical-align: middle; text-align: center;">512
</td>
</tr>
</tbody>
</table>
<ol><li>
<span class="plainlinks archwiki-template-man" title="$ man 8 mkfs.ext4"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mkfs.ext4.8">mkfs.ext4(8)</a></span> defaults to 1024 byte sectors for file systems smaller than 512 MiB and 4096 byte sectors for 512 MiB and larger.</li></ol>
<p>If the storage device does not report the correct sector size, you can explicitly format the partitions according to the physical sector size.
</p>
<p>In particular <i>shingled magnetic recording</i> (SMR) drives that are firmware-managed are severely and negatively impacted if using a logical sector size of 512 bytes if their physical sector size is of 4096 bytes. Those drives have different performance writing zones and remapping reallocation occurs while being idle, but during heavy active writes (e.g., RAID resilvering, backups, writing many small files, rsync, etc.), a different file system sector size could drop write speed to single digit megabytes/second, as the higher performance write areas get depleted, and the sector translation layer gets overworked on the shingled areas. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> On x86_64 systems Linux cannot mount file systems with a block size larger than 4 KiB. See <a rel="nofollow" class="external text" href="https://kernelnewbies.org/KernelProjects/large-block-size">Large block sizes (LBS)</a> for details and current progress.</div>
<p>Here are some examples to set the 4096-byte sector size explicitly:
</p>
<ul>
<li>
<a href="../en/Bcachefs.html" title="Bcachefs">Bcachefs</a>: <pre># bcachefs format --block_size=4096 /dev/<i>device0</i> /dev/<i>deviceN</i> --replicas=<i>n</i></pre>
</li>
<li>exFAT: <pre># mkfs.exfat -s 4096 /dev/<i>device</i></pre>
</li>
<li>
<a href="../en/Ext4.html" title="Ext4">ext4</a>: <pre># mkfs.ext4 -b 4096 /dev/<i>device</i></pre>
</li>
<li>
<a href="../en/FAT.html" title="FAT">FAT</a>: <pre># mkfs.fat -S 4096 /dev/<i>device</i></pre>
</li>
<li>
<a href="../en/NTFS-3G.html" title="NTFS-3G">NTFS-3G</a>: <pre># mkfs.ntfs -Q -s 4096 /dev/<i>device</i></pre>
</li>
<li>UDF: <pre># mkfs.udf -b 4096 /dev/<i>device</i></pre>
</li>
<li>
<a href="../en/XFS.html" title="XFS">XFS</a>: <pre># mkfs.xfs -s size=4096 /dev/<i>device</i></pre>
</li>
<li>
<a href="../en/ZFS.html#Advanced_Format_disks" title="ZFS">ZFS</a>: <pre># zpool create -o ashift=12 <i>poolname</i> raidz <i>device0</i> … <i>deviceN</i></pre>
</li>
</ul>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.anandtech.com/Show/Index/2888">Western Digital’s Advanced Format: The 4K Sector Transition Begins</a></li>
<li><a rel="nofollow" class="external text" href="https://www.wdc.com/wdproducts/library/WhitePapers/ENG/2579-771430.pdf">White paper entitled "Advanced Format Technology."</a></li>
<li>Failure to align one's HDD results in poor read/write performance.  See <a rel="nofollow" class="external autonumber" href="https://linuxconfig.org/linux-wd-ears-advanced-format">[10]</a> for specific examples.</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Storage.html" title="Category:Storage">Storage</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Move.html" title="Category:Pages or sections flagged with Template:Move">Pages or sections flagged with Template:Move</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Advanced_Format&amp;oldid=811955">https://wiki.archlinux.org/index.php?title=Advanced_Format&amp;oldid=811955</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 5 July 2024, at 09:33.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
