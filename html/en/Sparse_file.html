<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-zebra-design-disabled vector-feature-custom-font-size-clientpref-disabled vector-feature-client-preferences-disabled vector-feature-typography-survey-disabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Sparse file - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.41.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Sparse_file rootpage-Sparse_file skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-main-menu-container">
		</div>
	<input type="checkbox" id="vector-toc-collapsed-checkbox" class="vector-menu-checkbox">
			<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark vector-sticky-pinned-container">
				<div id="vector-toc-pinned-container" class="vector-pinned-container">
				<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Creating_sparse_files" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Creating_sparse_files">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Creating sparse files</div>
		</a>
		
			<button aria-controls="toc-Creating_sparse_files-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Creating sparse files subsection</span>
			</button>
		
		<ul id="toc-Creating_sparse_files-sublist" class="vector-toc-list">
			<li id="toc-Making_existing_files_sparse" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Making_existing_files_sparse">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Making existing files sparse</div>
			</a>
			
			<ul id="toc-Making_existing_files_sparse-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Making_existing_files_non-sparse" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Making_existing_files_non-sparse">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Making existing files non-sparse</div>
			</a>
			
			<ul id="toc-Making_existing_files_non-sparse-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Creating_a_filesystem_in_a_sparse_file" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Creating_a_filesystem_in_a_sparse_file">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Creating a filesystem in a sparse file</div>
			</a>
			
			<ul id="toc-Creating_a_filesystem_in_a_sparse_file-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Mounting_a_file_at_boot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Mounting_a_file_at_boot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.4</span>Mounting a file at boot</div>
			</a>
			
			<ul id="toc-Mounting_a_file_at_boot-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Detecting_sparse_files" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Detecting_sparse_files">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Detecting sparse files</div>
		</a>
		
		<ul id="toc-Detecting_sparse_files-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Copying_a_sparse_file" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Copying_a_sparse_file">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Copying a sparse file</div>
		</a>
		
			<button aria-controls="toc-Copying_a_sparse_file-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Copying a sparse file subsection</span>
			</button>
		
		<ul id="toc-Copying_a_sparse_file-sublist" class="vector-toc-list">
			<li id="toc-Copying_with_cp" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Copying_with_cp">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Copying with cp</div>
			</a>
			
			<ul id="toc-Copying_with_cp-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Archiving_with_tar" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Archiving_with_tar">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Archiving with tar</div>
			</a>
			
			<ul id="toc-Archiving_with_tar-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Resizing_a_sparse_file" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Resizing_a_sparse_file">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Resizing a sparse file</div>
		</a>
		
			<button aria-controls="toc-Resizing_a_sparse_file-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Resizing a sparse file subsection</span>
			</button>
		
		<ul id="toc-Resizing_a_sparse_file-sublist" class="vector-toc-list">
			<li id="toc-Growing_a_file" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Growing_a_file">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Growing a file</div>
			</a>
			
			<ul id="toc-Growing_a_file-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tools" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Tools">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Tools</div>
		</a>
		
		<ul id="toc-Tools-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Sources" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Sources">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Sources</div>
		</a>
		
		<ul id="toc-Sources-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

				</div>
	</nav>
		
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<label id="vector-toc-collapsed-button" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet vector-button-flush-left cdx-button--icon-only" for="vector-toc-collapsed-checkbox" role="button" aria-controls="vector-toc" tabindex="0" title="Table of Contents">
						<span class="vector-icon mw-ui-icon-wikimedia-listBullet"></span>
						<span>Toggle the table of contents</span>
					</label>
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Sparse file</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/%E3%82%B9%E3%83%91%E3%83%BC%E3%82%B9%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB" title="スパースファイル – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<nav class="vector-page-tools-landmark vector-sticky-pinned-container" aria-label="Page tools">
						<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
			
						</div>
	</nav>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr">
<div class="mw-parser-output">
<p>According to <a href="https://en.wikipedia.org/wiki/Sparse_file" class="extiw" title="wikipedia:Sparse file">Wikipedia</a>, in computer science, a sparse file is a type of computer file that attempts to use file system space more efficiently when blocks allocated to a file are mostly empty. This is achieved by writing brief information (metadata) representing the empty blocks to disk instead of the actual "empty" space which makes up the block, using less disk space. The full block size is written to disk as the actual size only when the block contains "real" (non-empty) data.
</p>
<p>When reading sparse files, the file system transparently converts metadata representing empty blocks into "real" blocks filled with zero bytes at runtime. The application is unaware of this conversion.
</p>
<p>Most modern file systems support sparse files, including most Unix variants and NTFS, but notably not Apple's HFS+. Sparse files are commonly used for <a href="https://en.wikipedia.org/wiki/Disk_image" class="extiw" title="wikipedia:Disk image">disk images</a> (not to be confused with <a href="https://en.wikipedia.org/wiki/Sparse_image" class="extiw" title="wikipedia:Sparse image">sparse images</a>), database snapshots, log files and in scientific applications.
</p>
<p>The advantage of sparse files is that storage is only allocated when actually needed: disk space is saved, and large files can be created even if there is insufficient free space on the file system.
</p>
<p>Disadvantages are that sparse files may become fragmented; file system free space reports may be misleading; filling up file systems containing sparse files can have unexpected effects; and copying a sparse file with a program that does not explicitly support them may copy the entire file, including the empty blocks which are not on explicitly stored on the disk, which wastes the benefits of the sparse property of a file.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Creating_sparse_files">Creating sparse files</span></h2>
<p>The <i>truncate</i> utility can create sparse files. This command creates a 512 MiB sparse file:
</p>
<pre>$ truncate -s 512M file.img
</pre>
<p>The <a href="../en/Dd.html" title="Dd">dd</a> utility can also be used, for example:
</p>
<pre>$ dd if=/dev/zero of=file.img bs=1 count=0 seek=512M
</pre>
<p>Sparse files have different <i>apparent file sizes</i> (the maximum size to which they may expand) and <i>actual file sizes</i> (how much space is allocated for data on disk).  To check a file's <i>apparent size</i>, just run:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ du -h --apparent-size file.img</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">512M    file.img
</pre>
<p>and, to check the <i>actual size</i> of a file on disk:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ du -h file.img</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">0       file.img
</pre>
<p>As you can see, although the apparent size of the file is 512 MiB, its "actual" size is really zero—that's because due to the nature and beauty of sparse files, it will "expand" arbitrarily to minimize the space required to store its contents.
</p>
<h3><span class="mw-headline" id="Making_existing_files_sparse">Making existing files sparse</span></h3>
<p>The <i>fallocate</i> utility can make existing files sparse on supported file systems:
</p>
<pre>$ fallocate -d copy.img
$ du -h copy.img
0       copy.img
</pre>
<h3><span class="mw-headline" id="Making_existing_files_non-sparse">Making existing files non-sparse</span></h3>
<p>The following command creates a non-sparse copy of a (sparse) file:
</p>
<pre>$ cp file.img copy.img --sparse=never
$ du -h copy.img 
512M    copy.img
</pre>
<h3><span class="mw-headline" id="Creating_a_filesystem_in_a_sparse_file">Creating a filesystem in a sparse file</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> Sparse files do not have to contain a file system, the purpose should be explained. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Sparse_file.html">Talk:Sparse file</a>)</div>
</div>
<p>Now that we have created a sparse file, it is time to format it with a filesystem; for example ReiserFS:
</p>
<pre>$ mkfs.reiserfs -f -q file.img
</pre>
<p>We can now check its size to see how a filesystem has affected it:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ du -h --apparent-size file.img</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">512M    file.img
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ du -h file.img</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">33M     file.img
</pre>
<p>As you may have expected, formatting it with a filesystem has increased its actual size, but left its apparent size the same.  Now we can create a directory which we will use to mount our file:
</p>
<pre># mount --mkdir -o loop file.img <i>mountpoint</i>
</pre>
<p>Tada! We now have both a file and a folder into which we may store <i>almost</i> 512 MiB worth of information!
</p>
<h3><span class="mw-headline" id="Mounting_a_file_at_boot">Mounting a file at boot</span></h3>
<p>To mount a sparse image automatically at boot, add an entry to your <a href="../en/Fstab.html" title="Fstab">fstab</a>:
</p>
<pre><i>/path/to/file.img</i>  <i>/path/to/mountpoint</i>  reiserfs  loop,defaults  0  0
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Be sure to include the <code>loop</code> option, otherwise it will not mount.</div>
<h2><span class="mw-headline" id="Detecting_sparse_files">Detecting sparse files</span></h2>
<p>Since sparse files occupy less blocks than the apparent file size would require, they can be detected by comparing the two sizes. This is not a bulletproof method if the filesystem uses compression, extended attributes take up the difference in space, file is internally fragmented, has indirect blocks, and similar. Still, the standard way to check is:
</p>
<pre>$ ls -ls sparse-file.bin
</pre>
<p>If a file size is greater than the allocated size in the first column a file is sparse. The same can be achieved with <code>du</code> by comparing:
</p>
<pre>$ du sparse-file.bin
$ du --apparent-size sparse-file.bin
</pre>
<p>A step further is to print <i>sparsiness</i> value with <a href="../en/Core_utilities.html#Essentials" class="mw-redirect" title="Find">find</a>:
</p>
<pre>$ find sparse-file.bin -printf '%S\t%p\n'
</pre>
<p>A sparse file has a <i>sparsiness</i> value of less than one whereas normal files have exactly one or just slightly above. The above command can be easily extended to list sparse files in a desired path:
</p>
<pre>$ find path/ -type f -printf '%S\t%p\n' | gawk '$1 &lt; 1.0 {print}' | cut -f '2-'
</pre>
<h2><span class="mw-headline" id="Copying_a_sparse_file">Copying a sparse file</span></h2>
<h3><span class="mw-headline" id="Copying_with_cp">Copying with cp</span></h3>
<p>Normally, <a href="../en/Core_utilities.html" class="mw-redirect" title="Cp">cp</a> is good at detecting whether a file is sparse, so it suffices to run:
</p>
<pre>$ cp <i>file.img</i> <i>new_file.img</i>
</pre>
<p>Then <code><i>new_file.img</i></code> will be sparse. However, <i>cp</i> does have a <code>--sparse=<i>when</i></code> option. This is especially useful if a sparse file has somehow become non sparse (i.e. the empty blocks have been written out to disk in full). Disk space can be recovered by:
</p>
<pre>$ cp --sparse=always <i>new_file.img</i> <i>recovered_file.img</i>
</pre>
<h3><span class="mw-headline" id="Archiving_with_tar">Archiving with tar</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> Informal writing, see <a href="../en/Help:Style.html#Language_register" title="Help:Style">Help:Style#Language register</a>. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Sparse_file.html">Talk:Sparse file</a>)</div>
</div>
<p>One day, you may decide to back up your well-loved sparse file, and choose the <a href="../en/Archiving_and_compression.html" class="mw-redirect" title="Tar">tar</a> utility for that very purpose; however, you soon realize you have a problem:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ du -h file.img</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">33M     file.img
</pre>
<pre>$ tar -cf file.tar file.img
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ du -h file.tar</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">513M    file.tar
</pre>
<p>Apparently, even though the current size of the sparse file is only 33 MB, archiving it with tar created an archive of the <b>ENTIRE SIZE OF THE FILE!</b>  Luckily for you, though, tar has a `--sparse' (`-S') flag, that when used in conjunction with the `--create' (`-c') operation, tests all files for sparseness while archiving. If tar finds a file to be sparse, it uses a sparse representation of the file in the archive.  This is useful when archiving files, such as dbm files, likely to contain many nulls, and dramatically decreases the amount of space needed to store such an archive.
</p>
<pre>$ tar -Scf file.tar file.img
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ du -h file.tar</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">12K     file.tar
</pre>
<h2><span class="mw-headline" id="Resizing_a_sparse_file">Resizing a sparse file</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> Dependence on <a href="#Creating_a_filesystem_in_a_sparse_file">#Creating a filesystem in a sparse file</a> is not apparent, not every sparse file contains a file system. Also too informal writing, see <a href="../en/Help:Style.html#Language_register" title="Help:Style">Help:Style#Language register</a>. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Sparse_file.html">Talk:Sparse file</a>)</div>
</div>
<p>Before we resize a sparse file, let us populate it with a couple small files for testing purposes:
</p>
<pre>$ for f in {1..5}; do touch folder/file${f}; done
</pre>
<pre>$ ls folder/
file1  file2  file3  file4  file5
</pre>
<p>Now, let us add some content to one of the files:
</p>
<pre>$ echo "This is a test to see if it works..." &gt;&gt; folder/file1
</pre>
<pre>$ cat folder/file1
This is a test to see if it works...
</pre>
<h3><span class="mw-headline" id="Growing_a_file">Growing a file</span></h3>
<p>Should you ever need to grow a file, you may do the following:
</p>
<pre># umount folder

# dd if=/dev/zero of=file.img bs=1 count=0 seek=1G
0+0 records in
0+0 records out
0 bytes (0 B) copied, 2.2978e-05 s, 0.0 kB/s
</pre>
<p>This will increase its size to 1 Gb, and leave its information intact.  Next, we need to increase the size of its filesystem:
</p>
<pre># resize_reiserfs file.img
resize_reiserfs 3.6.21 (2009 www.namesys.com)

ReiserFS report:
blocksize             4096
block count           262144 (131072)
free blocks           253925 (122857)
bitmap block count    8 (4)

Syncing..done


resize_reiserfs: Resizing finished successfully.
</pre>
<p>...and, remount it:
</p>
<pre># mount -o loop file.img folder
</pre>
<p>Checking its size gives us:
</p>
<pre># du -h --apparent-size file.img
1.0G    file.img

# du -h file.img
33M     file.img
</pre>
<p>...and to check for consistency:
</p>
<pre># df -h folder
Filesystem            Size  Used Avail Use% Mounted on
/tmp/file.img         1.0G   33M  992M   4% /tmp/folder
</pre>
<pre># ls folder
file1  file2  file3  file4  file5

# cat folder/file1
This is a test to see if it works...
</pre>
<h2><span class="mw-headline" id="Tools">Tools</span></h2>
<ul><li>
<b>sparse-fio</b> — <a href="../en/Dd.html" title="Dd">dd</a>-like program to work with files that are sparsely filled with non-zero data</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/anyc/sparse-fio">https://github.com/anyc/sparse-fio</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sparse-fio-git/">sparse-fio-git</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>sparseutils</b> — utilities to work with sparsely-populated files, provides <code>mksparse.py</code> and <code>sparsemap.py</code>, can be installed with <a href="../en/Python.html#Package_management" class="mw-redirect" title="Pip">pip</a>
</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://pypi.org/project/sparseutils/">https://pypi.org/project/sparseutils/</a> || <small>not packaged? <a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/">search in AUR</a></small>
</dd></dl>
<h2><span class="mw-headline" id="Sources">Sources</span></h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Sparse_file" class="extiw" title="wikipedia:Sparse file">wikipedia:Sparse_file</a></li>
<li><a rel="nofollow" class="external free" href="https://web.archive.org/web/20121026035748/http://www.apl.jhu.edu/Misc/Unix-info/tar/tar_85.html">https://web.archive.org/web/20121026035748/http://www.apl.jhu.edu/Misc/Unix-info/tar/tar_85.html</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:File_systems.html" title="Category:File systems">File systems</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li>
<li><a href="../en/Category:Pages_with_missing_package_links.html" title="Category:Pages with missing package links">Pages with missing package links</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Sparse_file&amp;oldid=752459">https://wiki.archlinux.org/index.php?title=Sparse_file&amp;oldid=752459</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 12 October 2022, at 09:01.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
