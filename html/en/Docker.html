<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Docker - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Docker rootpage-Docker skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
			<button aria-controls="toc-Installation-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Installation subsection</span>
			</button>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
			<li id="toc-Docker_Compose" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Docker_Compose">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Docker Compose</div>
			</a>
			
			<ul id="toc-Docker_Compose-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Docker_Desktop" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Docker_Desktop">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Docker Desktop</div>
			</a>
			
			<ul id="toc-Docker_Desktop-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Usage" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Usage">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Usage</div>
		</a>
		
		<ul id="toc-Usage-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Configuration</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-Storage_driver" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Storage_driver">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Storage driver</div>
			</a>
			
			<ul id="toc-Storage_driver-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Daemon_socket" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Daemon_socket">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Daemon socket</div>
			</a>
			
			<ul id="toc-Daemon_socket-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-HTTP_Proxies" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#HTTP_Proxies">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>HTTP Proxies</div>
			</a>
			
			<ul id="toc-HTTP_Proxies-sublist" class="vector-toc-list">
				<li id="toc-Docker_daemon_proxy_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Docker_daemon_proxy_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.1</span>Docker daemon proxy configuration</div>
			</a>
			
			<ul id="toc-Docker_daemon_proxy_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Docker_container_proxy_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Docker_container_proxy_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.2</span>Docker container proxy configuration</div>
			</a>
			
			<ul id="toc-Docker_container_proxy_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Configuring_DNS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Configuring_DNS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4</span>Configuring DNS</div>
			</a>
			
			<ul id="toc-Configuring_DNS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Images_location" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Images_location">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.5</span>Images location</div>
			</a>
			
			<ul id="toc-Images_location-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Insecure_registries" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Insecure_registries">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.6</span>Insecure registries</div>
			</a>
			
			<ul id="toc-Insecure_registries-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-IPv6" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#IPv6">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.7</span>IPv6</div>
			</a>
			
			<ul id="toc-IPv6-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-User_namespace_isolation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#User_namespace_isolation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.8</span>User namespace isolation</div>
			</a>
			
			<ul id="toc-User_namespace_isolation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Rootless_Docker_daemon" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Rootless_Docker_daemon">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.9</span>Rootless Docker daemon</div>
			</a>
			
			<ul id="toc-Rootless_Docker_daemon-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enable_native_overlay_diff_engine" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enable_native_overlay_diff_engine">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.10</span>Enable native overlay diff engine</div>
			</a>
			
			<ul id="toc-Enable_native_overlay_diff_engine-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Images" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Images">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Images</div>
		</a>
		
			<button aria-controls="toc-Images-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Images subsection</span>
			</button>
		
		<ul id="toc-Images-sublist" class="vector-toc-list">
			<li id="toc-Arch_Linux" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Arch_Linux">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Arch Linux</div>
			</a>
			
			<ul id="toc-Arch_Linux-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Alpine_Linux" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Alpine_Linux">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Alpine Linux</div>
			</a>
			
			<ul id="toc-Alpine_Linux-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Debian" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Debian">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Debian</div>
			</a>
			
			<ul id="toc-Debian-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Distroless" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Distroless">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.4</span>Distroless</div>
			</a>
			
			<ul id="toc-Distroless-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Tips and tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Get_the_IP_address_of_a_running_container" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Get_the_IP_address_of_a_running_container">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Get the IP address of a running container</div>
			</a>
			
			<ul id="toc-Get_the_IP_address_of_a_running_container-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Run_graphical_programs_inside_a_container" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Run_graphical_programs_inside_a_container">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Run graphical programs inside a container</div>
			</a>
			
			<ul id="toc-Run_graphical_programs_inside_a_container-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Start_Docker_Compose_projects_on_boot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Start_Docker_Compose_projects_on_boot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>Start Docker Compose projects on boot</div>
			</a>
			
			<ul id="toc-Start_Docker_Compose_projects_on_boot-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_buildx_for_cross-compiling" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_buildx_for_cross-compiling">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.4</span>Using buildx for cross-compiling</div>
			</a>
			
			<ul id="toc-Using_buildx_for_cross-compiling-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Run_GPU_accelerated_Docker_containers_with_NVIDIA_GPUs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Run_GPU_accelerated_Docker_containers_with_NVIDIA_GPUs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5</span>Run GPU accelerated Docker containers with NVIDIA GPUs</div>
			</a>
			
			<ul id="toc-Run_GPU_accelerated_Docker_containers_with_NVIDIA_GPUs-sublist" class="vector-toc-list">
				<li id="toc-With_the_--gpus_option_(recommended)" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#With_the_--gpus_option_(recommended)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.1</span>With the --gpus option (recommended)</div>
			</a>
			
			<ul id="toc-With_the_--gpus_option_(recommended)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-With_NVIDIA_container_runtime" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#With_NVIDIA_container_runtime">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.2</span>With NVIDIA container runtime</div>
			</a>
			
			<ul id="toc-With_NVIDIA_container_runtime-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Arch_Linux_image_with_CUDA" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Arch_Linux_image_with_CUDA">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.5.3</span>Arch Linux image with CUDA</div>
			</a>
			
			<ul id="toc-Arch_Linux_image_with_CUDA-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Remove_Docker_and_images" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Remove_Docker_and_images">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Remove Docker and images</div>
		</a>
		
		<ul id="toc-Remove_Docker_and_images-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-docker0_Bridge_gets_no_IP_/_no_internet_access_in_containers_when_using_systemd-networkd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#docker0_Bridge_gets_no_IP_/_no_internet_access_in_containers_when_using_systemd-networkd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1</span>docker0 Bridge gets no IP / no internet access in containers when using systemd-networkd</div>
			</a>
			
			<ul id="toc-docker0_Bridge_gets_no_IP_/_no_internet_access_in_containers_when_using_systemd-networkd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Default_number_of_allowed_processes/threads_too_low" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Default_number_of_allowed_processes/threads_too_low">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2</span>Default number of allowed processes/threads too low</div>
			</a>
			
			<ul id="toc-Default_number_of_allowed_processes/threads_too_low-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Error_initializing_graphdriver:_devmapper" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Error_initializing_graphdriver:_devmapper">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.3</span>Error initializing graphdriver: devmapper</div>
			</a>
			
			<ul id="toc-Error_initializing_graphdriver:_devmapper-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Failed_to_create_some/path/to/file:_No_space_left_on_device" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Failed_to_create_some/path/to/file:_No_space_left_on_device">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.4</span>Failed to create some/path/to/file: No space left on device</div>
			</a>
			
			<ul id="toc-Failed_to_create_some/path/to/file:_No_space_left_on_device-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Docker-machine_fails_to_create_virtual_machines_using_the_virtualbox_driver" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Docker-machine_fails_to_create_virtual_machines_using_the_virtualbox_driver">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.5</span>Docker-machine fails to create virtual machines using the virtualbox driver</div>
			</a>
			
			<ul id="toc-Docker-machine_fails_to_create_virtual_machines_using_the_virtualbox_driver-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Starting_Docker_breaks_KVM_bridged_networking" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Starting_Docker_breaks_KVM_bridged_networking">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.6</span>Starting Docker breaks KVM bridged networking</div>
			</a>
			
			<ul id="toc-Starting_Docker_breaks_KVM_bridged_networking-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Image_pulls_from_Docker_Hub_are_rate_limited" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Image_pulls_from_Docker_Hub_are_rate_limited">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.7</span>Image pulls from Docker Hub are rate limited</div>
			</a>
			
			<ul id="toc-Image_pulls_from_Docker_Hub_are_rate_limited-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-iptables_(legacy):_unknown_option_"--dport"' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#iptables_(legacy):_unknown_option_"--dport"'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.8</span>iptables (legacy): unknown option "--dport"</div>
			</a>
			
			<ul id='toc-iptables_(legacy):_unknown_option_"--dport"-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-"Your_password_will_be_stored_unencrypted"_when_running_docker_login' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#"Your_password_will_be_stored_unencrypted"_when_running_docker_login'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.9</span>"Your password will be stored unencrypted" when running docker login</div>
			</a>
			
			<ul id='toc-"Your_password_will_be_stored_unencrypted"_when_running_docker_login-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-"Could_not_find_an_available,_non-overlapping_IPv4_address_pool_among_the_defaults_to_assign_to_the_network"' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#"Could_not_find_an_available,_non-overlapping_IPv4_address_pool_among_the_defaults_to_assign_to_the_network"'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.10</span>"Could not find an available, non-overlapping IPv4 address pool among the defaults to assign to the network"</div>
			</a>
			
			<ul id='toc-"Could_not_find_an_available,_non-overlapping_IPv4_address_pool_among_the_defaults_to_assign_to_the_network"-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Slow_golang_compilation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Slow_golang_compilation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.11</span>Slow golang compilation</div>
			</a>
			
			<ul id="toc-Slow_golang_compilation-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Docker</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Docker" title="Docker – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Docker.html" title="Docker – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Docker" title="Docker – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Systemd-nspawn.html" title="Systemd-nspawn">systemd-nspawn</a></li>
<li><a href="../en/Linux_Containers.html" title="Linux Containers">Linux Containers</a></li>
<li><a href="../en/Vagrant.html" title="Vagrant">Vagrant</a></li>
<li><a href="../en/Podman.html" title="Podman">Podman</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/Docker_(software)" class="extiw" title="wikipedia:Docker (software)">Docker</a> is a utility to pack, ship and run any application as a lightweight container.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p>To pull Docker images and run Docker containers, you need the Docker Engine. The Docker Engine includes a daemon to manage the containers, as well as the <code>docker</code> CLI frontend. <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=docker">docker</a></span> package or, for the development version, the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/docker-git/">docker-git</a></span><sup><small>AUR</small></sup> package. Next <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable/start">enable/start</a> <code>docker.service</code> or <code>docker.socket</code>. Note that <code>docker.service</code> starts the service on boot, whereas <code>docker.socket</code> starts docker on first usage <a rel="nofollow" class="external text" href="https://github.com/moby/moby/issues/38373#issuecomment-447393517">which can decrease boot times</a>. Then verify docker's status:
</p>
<pre># docker info
</pre>
<p>Note that starting the docker service may fail if you have an active VPN connection due to IP conflicts between the VPN and Docker's bridge and overlay networks. If this is the case, try disconnecting the VPN before starting the docker service. You may reconnect the VPN immediately afterwards. You can also try to deconflict the networks (see solutions <a rel="nofollow" class="external autonumber" href="https://stackoverflow.com/questions/45692255/how-make-openvpn-work-with-docker">[1]</a> or <a rel="nofollow" class="external autonumber" href="https://github.com/docker/compose/issues/4336#issuecomment-457326123">[2]</a>).
</p>
<p>Next, verify that you can run containers. The following command downloads the latest <a href="#Arch_Linux">Arch Linux image</a> and uses it to run a Hello World program within a container:
</p>
<pre># docker run -it --rm archlinux bash -c "echo hello world"
</pre>
<p>If you want to be able to run the <code>docker</code> CLI command as a non-root user, add your user to the <code>docker</code> <a href="../en/Users_and_groups.html#Group_management" class="mw-redirect" title="User group">user group</a>, re-login and restart <code>docker.service</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Anyone added to the <code>docker</code> group is root equivalent because they can use the <code>docker run --privileged</code> command to start containers with root privileges. For more information see <a rel="nofollow" class="external autonumber" href="https://github.com/docker/docker/issues/9976">[3]</a> and <a rel="nofollow" class="external autonumber" href="https://docs.docker.com/engine/security/security/">[4]</a>.</div>
<h3><span class="mw-headline" id="Docker_Compose">Docker Compose</span></h3>
<p><a rel="nofollow" class="external text" href="https://docs.docker.com/compose/">Docker Compose</a> is an alternate CLI frontend for the Docker Engine, which specifies properties of containers using a <code>compose.yaml</code> <a href="https://en.wikipedia.org/wiki/YAML" class="extiw" title="wikipedia:YAML">YAML</a> file rather than, for example, a script with <code>docker run</code> options. This is useful for setting up reoccuring services that are use often and/or have complex configurations. To use it, <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=docker-compose">docker-compose</a></span>.
</p>
<h3><span class="mw-headline" id="Docker_Desktop">Docker Desktop</span></h3>
<p><a rel="nofollow" class="external text" href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a> is a proprietary desktop application that runs the Docker Engine inside a Linux virtual machine. Additional features such as a Kubernetes cluster and a vulnerability scanner are included. This application is useful for software development teams who develop Docker containers using macOS and Windows. The Linux port of the application is relatively new, and complements Docker's CLI frontends <a rel="nofollow" class="external autonumber" href="https://www.docker.com/blog/the-magic-of-docker-desktop-is-now-available-on-linux/">[5]</a>.
</p>
<p>An experimental package for Arch is provided directly by Docker; see <a rel="nofollow" class="external text" href="https://docs.docker.com/desktop/linux/install/archlinux/">the manual</a> for more information. Unfortunately, it contains files which conflict with the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=docker-compose">docker-compose</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=docker-buildx">docker-buildx</a></span> packages, so you will first need to remove them if installed. Alternatively, you can install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/docker-desktop/">docker-desktop</a></span><sup><small>AUR</small></sup> package that does not conflict with existing packages.
</p>
<p>Also, to run <a rel="nofollow" class="external text" href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a> you will need to ensure the <a rel="nofollow" class="external text" href="https://docs.docker.com/desktop/install/linux-install/">Linux system requirements</a>, including  virtualization support via <a href="../en/KVM.html" title="KVM">KVM</a>. To see a tray icon under Gnome, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnome-shell-extension-appindicator">gnome-shell-extension-appindicator</a></span> will be needed.
</p>
<p>Finally, file sharing support requires mapping user and group ids via <code>/etc/subuid</code> and <code>/etc/subgid</code>. See the <a rel="nofollow" class="external text" href="https://docs.docker.com/desktop/faqs/linuxfaqs/#how-do-i-enable-file-sharing">Docker Desktop For Linux File Sharing instructions</a> for more details.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Docker Desktop on Linux runs a Virtual Machine (VM) which creates and uses a custom docker context, desktop-linux, on startup. This means images and containers deployed on the Linux Docker Engine (before installation) are not available in Docker Desktop for Linux.<a rel="nofollow" class="external autonumber" href="https://docs.docker.com/desktop/install/linux-install/">[6]</a>
<p>For more information see <a rel="nofollow" class="external text" href="https://docs.docker.com/desktop/faqs/linuxfaqs/#what-is-the-difference-between-docker-desktop-for-linux-and-docker-engine">What is the difference between Docker Desktop for Linux and Docker Engine</a>.
</p>
</div>
<p>Furthermore, expect degraded performance and higher cpu usage when using Docker Desktop on Linux.
</p>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>Docker consists of multiple parts:
</p>
<ul>
<li>The Docker daemon (sometimes also called the Docker Engine), which is a process which runs as <code>docker.service</code>. It serves the Docker API and manages Docker containers.</li>
<li>The <code>docker</code> CLI command, which allows users to interact with the Docker API via the command line and control the Docker daemon.</li>
<li>Docker containers, which are namespaced processes that are started and managed by the Docker daemon as requested through the Docker API.</li>
</ul>
<p>Typically, users use Docker by running <code>docker</code> CLI commands, which in turn request the Docker daemon to perform actions which in turn result in management of Docker containers. Understanding the relationship between the client (<code>docker</code>), server (<code>docker.service</code>) and containers is important to successfully administering Docker.
</p>
<p>Note that if the Docker daemon stops or restarts, all currently running Docker containers are also stopped or restarted.
</p>
<p>Also note that it is possible to send requests to the Docker API and control the Docker daemon without the use of the <code>docker</code> CLI command. See <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/api/">the Docker API developer documentation</a> for more information.
</p>
<p>See <a rel="nofollow" class="external text" href="https://docs.docker.com/get-started/">the Docker Getting Started guide</a> for more usage documentation.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>The Docker daemon can be configured either through a configuration file at <code>/etc/docker/daemon.json</code> or by adding command line flags to the <code>docker.service</code> systemd unit. According to the <a rel="nofollow" class="external text" href="https://docs.docker.com/config/daemon/#configure-the-docker-daemon">Docker official documentation</a>, the configuration file approach is preferred. If you wish to use the command line flags instead, use <a href="../en/Systemd.html#Drop-in_files" title="Systemd">systemd drop-in files</a> to override the <code>ExecStart</code> directive in <code>docker.service</code>.
</p>
<p>For more information about options in <code>daemon.json</code> see <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file">dockerd documentation</a>.
</p>
<h3><span class="mw-headline" id="Storage_driver">Storage driver</span></h3>
<p>The <a rel="nofollow" class="external text" href="https://docs.docker.com/storage/storagedriver/select-storage-driver/">storage driver</a> controls how images and containers are stored and managed on your Docker host. The default <code>overlay2</code> driver has good performance for most use cases.
</p>
<p>Users of <a href="../en/Btrfs.html" title="Btrfs">btrfs</a> or <a href="../en/ZFS.html" title="ZFS">ZFS</a> may use the <code>btrfs</code> or <code>zfs</code> drivers, each of which take advantage of the unique features of these filesystems. See the <a rel="nofollow" class="external text" href="https://docs.docker.com/storage/storagedriver/btrfs-driver/">btrfs driver</a> and <a rel="nofollow" class="external text" href="https://docs.docker.com/storage/storagedriver/zfs-driver/">zfs driver</a> documentation for more information and step-by-step instructions.
</p>
<h3><span class="mw-headline" id="Daemon_socket">Daemon socket</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/deprecated/#unauthenticated-tcp-connections">Unauthenticated TCP connections were deprecated in Docker 26 and are scheduled for removal in Docker 27.</a> (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Docker.html">Talk:Docker</a>)</div>
</div>
<p>By default, the Docker daemon serves the Docker API using a <a href="https://en.wikipedia.org/wiki/Unix_domain_socket" class="extiw" title="wikipedia:Unix domain socket">Unix socket</a> at <code>/var/run/docker.sock</code>. This is an appropriate option for most use cases.
</p>
<p>It is possible to configure the Daemon to additionally listen on a TCP socket, which can allow remote Docker API access from other computers. <a rel="nofollow" class="external autonumber" href="https://docs.docker.com/engine/install/linux-postinstall/#allow-access-to-the-remote-api-through-a-firewall">[7]</a> This can be useful for allowing <code>docker</code> commands on a host machine to access the Docker daemon on a Linux virtual machine, such as an Arch virtual machine on a Windows or macOS system.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The Docker API is unencrypted and unauthenticated by default. Remote TCP access to the Docker daemon is equivalent to unsecured remote root access unless <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/security/protect-access/">additional production using SSH or TLS is also enabled</a>.</div>
<p>Note that the default <code>docker.service</code> file sets the <code>-H</code> flag by default, and Docker will not start if an option is present in both the flags and <code>/etc/docker/daemon.json</code> file. Therefore, the simplest way to change the socket settings is with a drop-in file, such as the following which adds a TCP socket on port 2376:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/docker.service.d/docker.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/dockerd -H unix:///var/run/docker.sock -H tcp://0.0.0.0:2376</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Reload">Reload</a> the systemd daemon and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>docker.service</code> to apply changes.
</p>
<h3><span class="mw-headline" id="HTTP_Proxies">HTTP Proxies</span></h3>
<p>There are two parts to configuring Docker to use an HTTP proxy: Configuring the Docker daemon and configuring Docker containers.
</p>
<h4><span class="mw-headline" id="Docker_daemon_proxy_configuration">Docker daemon proxy configuration</span></h4>
<p>See <a rel="nofollow" class="external text" href="https://docs.docker.com/config/daemon/systemd/#httphttps-proxy">Docker documentation on configuring Docker daemon to use HTTP proxies</a>.
</p>
<h4><span class="mw-headline" id="Docker_container_proxy_configuration">Docker container proxy configuration</span></h4>
<p>See <a rel="nofollow" class="external text" href="https://docs.docker.com/network/proxy/#configure-the-docker-client">Docker documentation on configuring proxies</a> for information on how to automatically configure proxies for all containers created using the <code>docker</code> CLI.
</p>
<h3><span class="mw-headline" id="Configuring_DNS">Configuring DNS</span></h3>
<p>See <a rel="nofollow" class="external text" href="https://docs.docker.com/config/containers/container-networking/#dns-services">Docker's DNS documentation</a> for the documented behavior of DNS within Docker containers and information on customizing DNS configuration. In most cases, the resolvers configured on the host are also configured in the container.
</p>
<p>Most DNS resolvers hosted on <code>127.0.0.0/8</code> are <a rel="nofollow" class="external text" href="https://github.com/moby/moby/issues/6388#issuecomment-76124221">not supported</a> due to conflicts between the container and host network namespaces. Such resolvers are <a rel="nofollow" class="external text" href="https://github.com/moby/libnetwork/blob/master/resolvconf/resolvconf.go">removed from the container's /etc/resolv.conf</a>. If this would result in an empty <code>/etc/resolv.conf</code>, Google DNS is used instead.
</p>
<p>Additionally, a special case is handled if <code>127.0.0.53</code> is the only configured nameserver. In this case, Docker assumes the resolver is <a href="../en/Systemd-resolved.html" title="Systemd-resolved">systemd-resolved</a> and uses the upstream DNS resolvers from <code>/run/systemd/resolve/resolv.conf</code>.
</p>
<p>If you are using a service such as <a href="../en/Dnsmasq.html" title="Dnsmasq">dnsmasq</a> to provide a local resolver, consider adding a virtual interface with a link local IP address in the <code>169.254.0.0/16</code> block for dnsmasq to bind to instead of <code>127.0.0.1</code> to avoid the network namespace conflict.
</p>
<h3><span class="mw-headline" id="Images_location">Images location</span></h3>
<p>By default, docker images are located at <code>/var/lib/docker</code>. They can be moved to other partitions, e.g. if you wish to use a dedicated partition or disk for your images. In this example, we will move the images to <code>/mnt/docker</code>.
</p>
<p>First, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Stop">stop</a> <code>docker.service</code>, which will also stop all currently running containers and unmount any running images. You may then move the images from <code>/var/lib/docker</code> to the target destination, e.g. <code>cp -r /var/lib/docker /mnt/docker</code>.
</p>
<p>Configure <code>data-root</code> in <code>/etc/docker/daemon.json</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "data-root": "/mnt/docker"
}</pre>
<p>Restart <code>docker.service</code> to apply changes.
</p>
<h3><span class="mw-headline" id="Insecure_registries">Insecure registries</span></h3>
<p>If you decide to use a self signed certificate for your private registries, Docker will refuse to use it until you declare that you trust it. For example, to allow images from a registry hosted at <code>myregistry.example.com:8443</code>, configure <code>insecure-registries</code> in the <code>/etc/docker/daemon.json</code> file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "insecure-registries": [
    "my.registry.example.com:8443"
  ]
}</pre>
<p>Restart <code>docker.service</code> to apply changes.
</p>
<h3><span class="mw-headline" id="IPv6">IPv6</span></h3>
<p>In order to enable IPv6 support in Docker, you will need to do a few things. See <a rel="nofollow" class="external autonumber" href="https://github.com/docker/docker.github.io/blob/c0eb65aabe4de94d56bbc20249179f626df5e8c3/engine/userguide/networking/default_network/ipv6.md">[8]</a> and <a rel="nofollow" class="external autonumber" href="https://github.com/moby/moby/issues/36954">[9]</a> for details.
</p>
<p>Firstly, enable the <code>ipv6</code> setting in <code>/etc/docker/daemon.json</code> and set a specific IPv6 subnet. In this case, we will use the private <code>fd00::/80</code> subnet. Make sure to use a subnet at least 80 bits as this allows a container's IPv6 to end with the container's MAC address which allows you to mitigate NDP neighbor cache invalidation issues.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "ipv6": true,
  "fixed-cidr-v6": "fd00::/80"
}
</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Restart</a> <code>docker.service</code> to apply changes. 
</p>
<p>Finally, to let containers access the host network, you need to resolve routing issues arising from the usage of a private IPv6 subnet. Add the IPv6 NAT in order to actually get some traffic:
</p>
<pre># ip6tables -t nat -A POSTROUTING -s fd00::/80 ! -o docker0 -j MASQUERADE
</pre>
<p>Now Docker should be properly IPv6 enabled. To test it, you can run:
</p>
<pre># docker run curlimages/curl curl -v -6 archlinux.org
</pre>
<p>If you use <a href="../en/Firewalld.html" title="Firewalld">firewalld</a>, you can add the rule like this:
</p>
<pre># firewall-cmd --zone=public --add-rich-rule='rule family="ipv6" destination not address="fd00::1/80" source address="fd00::/80" masquerade'
</pre>
<p>If you use <a href="../en/Uncomplicated_Firewall.html" class="mw-redirect" title="Ufw">ufw</a>, you need to first enable ipv6 forwarding following <a href="../en/Uncomplicated_Firewall.html#Forward_policy" title="Uncomplicated Firewall">Uncomplicated Firewall#Forward policy</a>. Next you need to edit <code>/etc/default/ufw</code> and uncomment the following lines
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ufw/sysctl.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">net/ipv6/conf/default/forwarding=1
net/ipv6/conf/all/forwarding=1</pre>
<p>Then you can add the iptables rule:
</p>
<pre># ip6tables -t nat -A POSTROUTING -s fd00::/80 ! -o docker0 -j MASQUERADE
</pre>
<p>It should be noted that, for docker containers created with <i>docker-compose</i>, you may need to set <code>enable_ipv6: true</code> in the <code>networks</code> part for the corresponding network. Besides, you may need to configure the IPv6 subnet. See <a rel="nofollow" class="external autonumber" href="https://docs.docker.com/compose/compose-file/compose-file-v2/#ipv4_address-ipv6_address">[10]</a> for details.
</p>
<h3><span class="mw-headline" id="User_namespace_isolation">User namespace isolation</span></h3>
<p>By default, processes in Docker containers run within the same user namespace as the main <code>dockerd</code> daemon, i.e. containers are not isolated by the <span class="plainlinks archwiki-template-man" title="$ man 7 user_namespaces"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/user_namespaces.7">user_namespaces(7)</a></span> feature. This allows the process within the container to access configured resources on the host according to <a href="../en/Users_and_groups.html#Permissions_and_ownership" title="Users and groups">Users and groups#Permissions and ownership</a>. This maximizes compatibility, but poses a security risk if a container privilege escalation or breakout vulnerability is discovered that allows the container to access unintended resources on the host. (One such vulnerability was <a rel="nofollow" class="external text" href="https://seclists.org/oss-sec/2019/q1/119">published and patched in February 2019</a>.)
</p>
<p>The impact of such a vulnerability can be reduced by enabling <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/security/userns-remap/">user namespace isolation</a>. This runs each container in a separate user namespace and maps the UIDs and GIDs inside that user namespace to a different (typically unprivileged) UID/GID range on the host.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>The main <code>dockerd</code> daemon still runs as <code>root</code> on the host. Running Docker in <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/security/rootless/">rootless mode</a> is a different feature.</li>
<li>Processes in the container are started as the user defined in the <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/reference/builder/#user">USER</a> directive in the Dockerfile used to build the image of the container.</li>
<li>All containers are mapped into the same UID/GID range. This preserves the ability to share volumes between containers.</li>
<li>Enabling user namespace isolation has <a rel="nofollow" class="external text" href="https://docs.docker.com/engine/security/userns-remap/#user-namespace-known-limitations">several limitations</a>.</li>
<li>Enabling user namespace isolation effectively masks existing image and container layers, as well as other Docker objects in <code>/var/lib/docker/</code>, because Docker needs to adjust the ownership of these resources. The upstream documentation recommends to enable this feature on a new Docker installation rather than an existing one.</li>
</ul>
</div>
<p>Configure <code>userns-remap</code> in <code>/etc/docker/daemon.json</code>. <code>default</code> is a special value that will automatically create a user and group named <code>dockremap</code> for use with remapping.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "userns-remap": "default"
}</pre>
<p>Configure <code>/etc/subuid</code> and <code>/etc/subgid</code> with a username/group name, starting UID/GID and UID/GID range size to allocate  to the remap user and group. This example allocates a range of 65536 UIDs and GIDs starting at 165536 to the <code>dockremap</code> user and group. 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/subuid</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dockremap:165536:65536</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/subgid</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dockremap:165536:65536</pre>
<p>Restart <code>docker.service</code> to apply changes.
</p>
<p>After applying this change, all containers will run in an isolated user namespace by default. The remapping may be partially disabled on specific containers passing the <code>--userns=host</code> flag to the <code>docker</code> command. See <a rel="nofollow" class="external autonumber" href="https://docs.docker.com/engine/security/userns-remap/#disable-namespace-remapping-for-a-container">[11]</a> for details.
</p>
<h3><span class="mw-headline" id="Rootless_Docker_daemon">Rootless Docker daemon</span></h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Docker rootless relies on the unprivileged user namespaces (<code>CONFIG_USER_NS_UNPRIVILEGED</code>). This is enabled by default in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux">linux</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-lts">linux-lts</a></span>, and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=linux-zen">linux-zen</a></span> kernels. Users of other kernels may need to enable it. This has some security implications, see <a href="../en/Security.html#Sandboxing_applications" title="Security">Security#Sandboxing applications</a> for details.</div>
<p>To run the Docker daemon itself as a regular user, <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/docker-rootless-extras/">docker-rootless-extras</a></span><sup><small>AUR</small></sup> package.
</p>
<p>Configure <code>/etc/subuid</code> and <code>/etc/subgid</code> with a username/group name, starting UID/GID and UID/GID range size to allocate  to the remap user and group.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/subuid</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">your_username:165536:65536</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/subgid</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">your_username:165536:65536</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">Enable</a> the <code>docker.socket</code> <a href="../en/Systemd/User.html" class="mw-redirect" title="User unit">user unit</a>: this will result in docker being started using systemd's socket activation.
</p>
<p>Finally set docker socket <a href="../en/Environment_variables.html" class="mw-redirect" title="Environment variable">environment variable</a>:
</p>
<pre>$ export DOCKER_HOST=unix://$XDG_RUNTIME_DIR/docker.sock
</pre>
<h3><span class="mw-headline" id="Enable_native_overlay_diff_engine">Enable native overlay diff engine</span></h3>
<p>By default, Docker cannot use the native overlay diff engine on Arch Linux, which makes building Docker images slow. If you frequently build images, configure the native diff engine as described in <a rel="nofollow" class="external autonumber" href="https://mikeshade.com/posts/docker-native-overlay-diff/">[12]</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/disable-overlay-redirect-dir.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options overlay metacopy=off redirect_dir=off</pre>
<p>Then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Stop">stop</a> <code>docker.service</code>, reload the <code>overlay</code> module as follows: 
</p>
<pre># modprobe -r overlay
# modprobe overlay
</pre>
<p>You can then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> <code>docker.service</code> again. 
</p>
<p>To verify, run <code>docker info</code> and check that <code>Native Overlay Diff</code> is <code>true</code>.
</p>
<h2><span class="mw-headline" id="Images">Images</span></h2>
<h3><span class="mw-headline" id="Arch_Linux">Arch Linux</span></h3>
<p>The following command pulls the <a rel="nofollow" class="external text" href="https://hub.docker.com/_/archlinux/">archlinux</a> x86_64 image. This is a stripped down version of Arch core without network, etc.
</p>
<pre># docker pull archlinux
</pre>
<p>See also <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/archlinux-docker/blob/master/README.md">README.md</a>.
</p>
<p>For a full Arch base, clone the repository from above and build your own image.
</p>
<pre>$ git clone <a rel="nofollow" class="external free" href="https://gitlab.archlinux.org/archlinux/archlinux-docker.git">https://gitlab.archlinux.org/archlinux/archlinux-docker.git</a>
</pre>
<p>Make sure that the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=devtools">devtools</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fakechroot">fakechroot</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=fakeroot">fakeroot</a></span> packages are installed.
</p>
<p>To build the base image: 
</p>
<pre>$ make image-base
</pre>
<h3><span class="mw-headline" id="Alpine_Linux">Alpine Linux</span></h3>
<p><a rel="nofollow" class="external text" href="https://www.alpinelinux.org/">Alpine Linux</a> is a popular choice for small container images, especially for software compiled as static binaries. The following command pulls the latest Alpine Linux image:
</p>
<pre># docker pull alpine
</pre>
<p>Alpine Linux uses the <a rel="nofollow" class="external text" href="https://musl.libc.org/">musl</a> libc implementation instead of the <a rel="nofollow" class="external text" href="https://www.gnu.org/software/libc/">glibc</a> libc implementation used by most Linux distributions. Because Arch Linux uses glibc, there are a number of functional differences between an Arch Linux host and an Alpine Linux container that can impact the performance and correctness of software. A list of these differences is documented <a rel="nofollow" class="external text" href="https://wiki.musl-libc.org/functional-differences-from-glibc.html">here</a>.
</p>
<p>Note that dynamically linked software built on Arch Linux (or any other system using glibc) may have bugs and performance problems when run on Alpine Linux (or any other system using a different libc). See <a rel="nofollow" class="external autonumber" href="https://bugs.python.org/issue32307">[13]</a>, <a rel="nofollow" class="external autonumber" href="https://superuser.com/questions/1219609/why-is-the-alpine-docker-image-over-50-slower-than-the-ubuntu-image">[14]</a> and <a rel="nofollow" class="external autonumber" href="https://pythonspeed.com/articles/alpine-docker-python">[15]</a> for examples.
</p>
<h3><span class="mw-headline" id="Debian">Debian</span></h3>
<p>The following command pulls the latest <a rel="nofollow" class="external text" href="https://hub.docker.com/_/debian">debian</a> image:
</p>
<pre># docker pull debian
</pre>
<p>See the Docker Hub page for a full list of available tags, including both standard and slim versions for each Debian release.
</p>
<h3><span class="mw-headline" id="Distroless">Distroless</span></h3>
<p>Google maintains <a rel="nofollow" class="external text" href="https://github.com/GoogleContainerTools/distroless">distroless images</a> which are minimal images without OS components such as package managers or shells, resulting in very small images for packaging software.
</p>
<p>See the GitHub README for a list of images and instructions on their use with various programming languages.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Get_the_IP_address_of_a_running_container">Get the IP address of a running container</span></h3>
<p>To grab the IP address of a running container:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ docker inspect --format='{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' &lt;container-name OR id&gt; </pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">172.17.0.37</pre>
<p>For each running container, the name and corresponding IP address can be listed for use in <code>/etc/hosts</code>:
</p>
<pre>#!/usr/bin/env sh
for ID in $(docker ps -q | awk '{print $1}'); do
    IP=$(docker inspect --format="{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}" "$ID")
    NAME=$(docker ps | grep "$ID" | awk '{print $NF}')
    printf "%s %s\n" "$IP" "$NAME"
done</pre>
<h3><span class="mw-headline" id="Run_graphical_programs_inside_a_container">Run graphical programs inside a container</span></h3>
<p>This section describes the necessary steps to allow graphical programs (including those that rely on OpenGL or Vulkan) to run on the host's X server.
</p>
<p>First, the correct drivers, compatible with the <b>host's</b> graphics hardware, need to be installed inside the container. The installation procedure depends on the type of the container, but for containers based on Arch Linux images, refer to <a href="../en/OpenGL.html#Installation" title="OpenGL">OpenGL#Installation</a> and <a href="../en/Vulkan.html#Installation" title="Vulkan">Vulkan#Installation</a> for packages specific to your hardware.
</p>
<p>Next, the container must be granted access to the host's X server. In a single-user environment, this can easily be done by running <a href="../en/Xhost.html" title="Xhost">Xhost</a> on the host system, which adds non-network local connections to the access control list:
</p>
<pre>$ xhost +local:
</pre>
<p>Lastly, the following parameters need to be passed to <code>docker run</code>:
</p>
<ul>
<li>
<code>-e "DISPLAY=$DISPLAY"</code> sets the environment variable <code>DISPLAY</code> within the container to the host's display;</li>
<li>
<code>--mount type=bind,src=/tmp/.X11-unix,dst=/tmp/.X11-unix</code> mounts the host's X server sockets inside the container under the same path;</li>
<li>
<code>--device=/dev/dri:/dev/dri</code> gives the container access to <a href="https://en.wikipedia.org/wiki/Direct_Rendering_Infrastructure" class="extiw" title="wikipedia:Direct Rendering Infrastructure">Direct Rendering Infrastructure</a> devices on the host.</li>
</ul>
<p>To confirm that everything is set up correctly, run <code>glxgears</code> from the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mesa-utils">mesa-utils</a></span>, or <code>vkcube</code> from the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=vulkan-tools">vulkan-tools</a></span> in the container.
</p>
<h3><span class="mw-headline" id="Start_Docker_Compose_projects_on_boot">Start Docker Compose projects on boot</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> This is not necessary with <code>restart: always</code> in the <code>compose.yml</code>. <a rel="nofollow" class="external autonumber" href="https://docs.docker.com/compose/compose-file/compose-file-v3/#restart">[16]</a> (Discuss in <a href='../en/Talk:Docker.html#"Start_Docker_Compose_projects_on_boot"_Spurious?' title="Talk:Docker">Talk:Docker#"Start Docker Compose projects on boot" Spurious?</a>)</div>
</div>
<p>First, create a template <a href="../en/Systemd.html#Writing_unit_files" title="Systemd">unit</a> for Docker Compose which is parameterized by the name of the service (see <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.service"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.service.5#SERVICE_TEMPLATES">systemd.service(5) § SERVICE TEMPLATES</a></span>):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/docker-compose@.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=%i service with docker compose
Requires=docker.service
After=docker.service

[Service]
WorkingDirectory=/opt/%i
ExecStartPre=-/usr/bin/docker compose pull
ExecStart=/usr/bin/docker compose up --remove-orphans
ExecStop=/usr/bin/docker compose down
ExecReload=/usr/bin/docker compose pull
ExecReload=/usr/bin/docker compose up --remove-orphans

[Install]
WantedBy=multi-user.target</pre>
<p>Then, for each service you would like to run, set up a directory with the Compose file and any other required files (such as <code>.env</code> files) at <code>/opt/<i>project_name</i></code>. <a rel="nofollow" class="external autonumber" href="https://refspecs.linuxfoundation.org/FHS_3.0/fhs/ch03s13.html">[17]</a>
</p>
<p>Then, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable/start">enable/start</a> <code>docker-compose@<i>project_name</i>.service</code>.
</p>
<h3><span class="mw-headline" id="Using_buildx_for_cross-compiling">Using buildx for cross-compiling</span></h3>
<p>The <a rel="nofollow" class="external text" href="https://docs.docker.com/build/architecture/#buildx">buildx CLI plugin</a> makes use of the new <a rel="nofollow" class="external text" href="https://docs.docker.com/build/buildkit/">BuildKit building toolkit</a>. <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=docker-buildx">docker-buildx</a></span> package. The buildx interface supports building multi-platform images, including architectures other than that of the host.
</p>
<p>QEMU is required to cross-compile images. To setup the static build of QEMU within Docker, see the usage information for the <a rel="nofollow" class="external text" href="https://github.com/multiarch/qemu-user-static">multiarch/qemu-user-static</a> image. Otherwise, to setup QEMU on the host system for use with Docker, see <a href="../en/QEMU.html#Chrooting_into_arm/arm64_environment_from_x86_64" title="QEMU">QEMU#Chrooting into arm/arm64 environment from x86_64</a>. In either case, your system will be configured for user-mode emulation of the guest architecture.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ docker buildx ls</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME/NODE DRIVER/ENDPOINT STATUS  PLATFORMS
default * docker                  
  default default         running linux/amd64, linux/386, linux/arm64, linux/riscv64, linux/s390x, linux/arm/v7, linux/arm/v6
</pre>
<h3><span class="mw-headline" id="Run_GPU_accelerated_Docker_containers_with_NVIDIA_GPUs">Run GPU accelerated Docker containers with NVIDIA GPUs</span></h3>
<p>Starting from Docker version 19.03, NVIDIA GPUs are <a rel="nofollow" class="external text" href="https://docs.docker.com/config/containers/resource_constraints/">natively supported as Docker devices</a>. <a rel="nofollow" class="external text" href="https://github.com/NVIDIA/nvidia-container-toolkit">NVIDIA Container Toolkit</a> is the recommended way of running containers that leverage NVIDIA GPUs.
</p>
<p>Install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvidia-container-toolkit">nvidia-container-toolkit</a></span> package and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> docker. You can now run containers that make use of NVIDIA GPUs using the <code>--gpus</code> option or by registering the NVIDIA container runtime.
</p>
<h4>
<span id="With_the_--gpus_option_.28recommended.29"></span><span class="mw-headline" id="With_the_--gpus_option_(recommended)">With the --gpus option (recommended)</span>
</h4>
<pre># docker run --gpus all nvidia/cuda:12.1.1-runtime-ubuntu22.04 nvidia-smi
</pre>
<p>Specify how many GPUs are enabled inside a container:
</p>
<pre># docker run --gpus 2 nvidia/cuda:12.1.1-runtime-ubuntu22.04 nvidia-smi
</pre>
<p>Specify which GPUs to use:
</p>
<pre># docker run --gpus '"device=1,2"' nvidia/cuda:12.1.1-runtime-ubuntu22.04 nvidia-smi
</pre>
<p>or
</p>
<pre># docker run --gpus '"device=UUID-ABCDEF,1"' nvidia/cuda:12.1.1-runtime-ubuntu22.04 nvidia-smi
</pre>
<p>For more information see <a rel="nofollow" class="external text" href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/index.html">the documentation</a> and <a rel="nofollow" class="external text" href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html">install guide</a>.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> More information on when the following error happens is needed. It should work, see <a rel="nofollow" class="external autonumber" href="https://aur.archlinux.org/cgit/aur.git/tree/nvidia-container-toolkit.install?h=nvidia-container-toolkit">[18]</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2023-04-23 ⓘ]</sup>. (Discuss in <a href="../en/Talk:Docker.html#GPU_accelerated_Docker_Nvidia" title="Talk:Docker">Talk:Docker#GPU accelerated Docker Nvidia</a>)</div>
</div>
<p>If, when using the above commands, you receive an error such as <code>Failed to initialize NVML: Unknown Error</code>, you can try being more specific in specifying the GPU:
</p>
<pre># docker run --gpus all --device /dev/nvidiactl:/dev/nvidiactl --device /dev/nvidia-uvm:/dev/nvidia-uvm --device /dev/nvidia0:/dev/nvidia0 nvidia/cuda:12.1.1-runtime-ubuntu22.04 nvidia-smi
</pre>
<p>Specify a capability (graphics, compute, ...) for the container (though this is rarely if ever used this way):
</p>
<pre># docker run --gpus all,capabilities=utility nvidia/cuda:12.1.1-runtime-ubuntu22.04 nvidia-smi
</pre>
<h4><span class="mw-headline" id="With_NVIDIA_container_runtime">With NVIDIA container runtime</span></h4>
<p>Register the NVIDIA runtime by editing <code>/etc/docker/daemon.json</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "runtimes": {
    "nvidia": {
      "path": "/usr/bin/nvidia-container-runtime",
      "runtimeArgs": []
    }
  }
}</pre>
<p>and then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> docker.
</p>
<p>The runtime can also be registered via a command line option to <i>dockerd</i>:
</p>
<pre># /usr/bin/dockerd --add-runtime=nvidia=/usr/bin/nvidia-container-runtime
</pre>
<p>Afterwards GPU accelerated containers can be started with
</p>
<pre># docker run --runtime=nvidia nvidia/cuda:9.0-base nvidia-smi
</pre>
<p>See also <a rel="nofollow" class="external text" href="https://github.com/NVIDIA/nvidia-container-toolkit/tree/main/cmd/nvidia-container-runtime">README.md</a>.
</p>
<h4><span class="mw-headline" id="Arch_Linux_image_with_CUDA">Arch Linux image with CUDA</span></h4>
<p>You can use the following <code>Dockerfile</code> to build a custom Arch Linux image with CUDA. It uses the <a rel="nofollow" class="external text" href="https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/syntax.md">Dockerfile frontend syntax 1.2</a> to cache pacman packages on the host. The <code>DOCKER_BUILDKIT=1</code> <a href="../en/Environment_variables.html" class="mw-redirect" title="Environment variable">environment variable</a> must be set on the client before building the Docker image.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">Dockerfile</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># syntax = docker/dockerfile:1.2

FROM archlinux

# install packages
RUN --mount=type=cache,sharing=locked,target=/var/cache/pacman \
    pacman -Syu --noconfirm --needed base base-devel cuda

# configure nvidia container runtime
# https://github.com/NVIDIA/nvidia-container-runtime#environment-variables-oci-spec
ENV NVIDIA_VISIBLE_DEVICES all
ENV NVIDIA_DRIVER_CAPABILITIES compute,utility
</pre>
<h2><span class="mw-headline" id="Remove_Docker_and_images">Remove Docker and images</span></h2>
<p>In case you want to remove Docker entirely you can do this by following  the steps below:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Do not just copy paste those commands without making sure you know what you are doing.</div>
<p>Check for running containers:
</p>
<pre># docker ps
</pre>
<p>List all containers running on the host for deletion:
</p>
<pre># docker ps -a
</pre>
<p>Stop a running container:
</p>
<pre># docker stop &lt;CONTAINER ID&gt;
</pre>
<p>Killing still running containers:
</p>
<pre># docker kill &lt;CONTAINER ID&gt;
</pre>
<p>Delete containers listed by ID:
</p>
<pre># docker rm &lt;CONTAINER ID&gt;
</pre>
<p>List all Docker images:
</p>
<pre># docker images
</pre>
<p>Delete images by ID:
</p>
<pre># docker rmi &lt;IMAGE ID&gt;
</pre>
<p>Delete all images, containers, volumes, and networks that are not associated with a container (dangling):
</p>
<pre># docker system prune
</pre>
<p>To additionally remove any stopped containers and all unused images (not just dangling ones), add the -a flag to the command:
</p>
<pre># docker system prune -a
</pre>
<p>Delete all Docker data (purge directory):
</p>
<pre># rm -R /var/lib/docker
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3>
<span id="docker0_Bridge_gets_no_IP_.2F_no_internet_access_in_containers_when_using_systemd-networkd"></span><span class="mw-headline" id="docker0_Bridge_gets_no_IP_/_no_internet_access_in_containers_when_using_systemd-networkd">docker0 Bridge gets no IP / no internet access in containers when using systemd-networkd</span>
</h3>
<p>Docker attempts to enable IP forwarding globally, but by default <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> overrides the global sysctl setting for each defined network profile. Set <code>IPForward=yes</code> in the network profile. See <a href="../en/Internet_sharing.html#Enable_packet_forwarding" title="Internet sharing">Internet sharing#Enable packet forwarding</a> for details.
</p>
<p>When <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> tries to manage the network interfaces created by Docker, e.g. when you configured <code>Name=*</code> or <code>Type=ether</code> in the <code>Match</code> section, this can lead to connectivity issues. The problem should be solved by matching interfaces more specifically, i.e. avoid using <code>Name=*</code> or <code>Type=ether</code> or other wildcard that matches an interface managed by Docker. Verify that <code>networkctl list</code> reports <code>unmanaged</code> in the SETUP column for all networks created by Docker.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>You may need to <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>docker.service</code> each time you <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>systemd-networkd.service</code> or <code>iptables.service</code>.</li>
<li>Also be aware that <a href="../en/Nftables.html" title="Nftables">nftables</a> may block docker connections by default. Use <code>nft list ruleset</code> to check for blocking rules. <code>nft flush chain inet filter forward</code> removes all forwarding rules temporarily. Edit <code>/etc/nftables.conf</code> to make changes permanent. Remember to <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>nftables.service</code> to reload rules from the configuration file. See <a rel="nofollow" class="external autonumber" href="https://github.com/moby/moby/issues/26824">[19]</a> for details about nftables support in Docker.</li>
</ul>
</div>
<h3>
<span id="Default_number_of_allowed_processes.2Fthreads_too_low"></span><span class="mw-headline" id="Default_number_of_allowed_processes/threads_too_low">Default number of allowed processes/threads too low</span>
</h3>
<p>If you run into error messages like
</p>
<pre># e.g. Java
java.lang.OutOfMemoryError: unable to create new native thread
# e.g. C, bash, ...
fork failed: Resource temporarily unavailable
</pre>
<p>then you might need to adjust the number of processes allowed by systemd. <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">Edit</a> the <code>docker.service</code> with the following snippet:
</p>
<pre>[Service]
TasksMax=infinity
</pre>
<p>For more background, look for <code>DefaultLimitNPROC</code> at <span class="plainlinks archwiki-template-man" title="$ man 5 systemd-system.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-system.conf.5#OPTIONS">systemd-system.conf(5) § OPTIONS</a></span>. And for <code>TasksMax</code> at <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.resource-control"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.resource-control.5#OPTIONS">systemd.resource-control(5) § OPTIONS</a></span>.
</p>
<h3><span class="mw-headline" id="Error_initializing_graphdriver:_devmapper">Error initializing graphdriver: devmapper</span></h3>
<p>If <i>systemctl</i> fails to start docker and provides an error:
</p>
<pre>Error starting daemon: error initializing graphdriver: devmapper: Device docker-8:2-915035-pool is not a thin pool
</pre>
<p>Then, try the following steps to resolve the error. Stop the service, back up <code>/var/lib/docker/</code> (if desired), remove the contents of <code>/var/lib/docker/</code>, and try to start the service. See the open <a rel="nofollow" class="external text" href="https://github.com/docker/docker/issues/21304">GitHub issue</a> for details.
</p>
<h3>
<span id="Failed_to_create_some.2Fpath.2Fto.2Ffile:_No_space_left_on_device"></span><span class="mw-headline" id="Failed_to_create_some/path/to/file:_No_space_left_on_device">Failed to create some/path/to/file: No space left on device</span>
</h3>
<p>If you are getting an error message like this:
</p>
<pre>ERROR: Failed to create some/path/to/file: No space left on device
</pre>
<p>when building or running a Docker image, even though you do have enough disk space available, make sure:
</p>
<ul>
<li>
<a href="../en/Tmpfs.html" title="Tmpfs">Tmpfs</a> is disabled or has enough memory allocation. Docker might be trying to write files into <code>/tmp</code> but fails due to restrictions in memory usage and not disk space.</li>
<li>If you are using <a href="../en/XFS.html" title="XFS">XFS</a>, you might want to remove the <code>noquota</code> mount option from the relevant entries in <code>/etc/fstab</code> (usually where <code>/tmp</code> and/or <code>/var/lib/docker</code> reside). Refer to <a href="../en/Disk_quota.html" title="Disk quota">Disk quota</a> for more information, especially if you plan on using and resizing <code>overlay2</code> Docker storage driver.</li>
<li>XFS quota mount options (<code>uquota</code>, <code>gquota</code>, <code>prjquota</code>, etc.) fail during re-mount of the file system. To enable quota for root file system, the mount option must be passed to initramfs as a <a href="../en/Kernel_parameters.html" class="mw-redirect" title="Kernel parameter">kernel parameter</a> <code>rootflags=</code>. Subsequently, it should not be listed among mount options in <code>/etc/fstab</code> for the root (<code>/</code>) filesystem.</li>
</ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> There are some differences of XFS Quota compared to standard Linux <a href="../en/Disk_quota.html" title="Disk quota">Disk quota</a>, <a rel="nofollow" class="external autonumber" href="https://inai.de/linux/adm_quota">[20]</a> may be worth reading.</div>
<h3><span class="mw-headline" id="Docker-machine_fails_to_create_virtual_machines_using_the_virtualbox_driver">Docker-machine fails to create virtual machines using the virtualbox driver</span></h3>
<p>In case docker-machine fails to create the VM's using the virtualbox driver, with the following:
</p>
<pre>VBoxManage: error: VBoxNetAdpCtl: Error while adding new interface: failed to open /dev/vboxnetctl: No such file or directory
</pre>
<p>Simply reload the virtualbox via CLI with <code>vboxreload</code>.
</p>
<h3><span class="mw-headline" id="Starting_Docker_breaks_KVM_bridged_networking">Starting Docker breaks KVM bridged networking</span></h3>
<p>The issue is that Docker's scripts add some iptables rules to block forwarding on other interfaces other than its own. This is a <a rel="nofollow" class="external text" href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=865975">known issue</a>.
</p>
<p>Adjust the solutions below to replace br0 with your own bridge name.
</p>
<p>Quickest fix (but turns off all Docker's iptables self-added adjustments, which you may not want):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "iptables": false
}</pre>
<p>If there is already a network bridge configured for KVM, this may be fixable by telling docker about it.  See <a rel="nofollow" class="external autonumber" href="https://muthii.com/blog/?p=540">[21]</a> where docker configuration is modified as:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "bridge": "br0"
}</pre>
<p>If the above does not work, or you prefer to solve the issue through iptables directly, or through a manager like UFW, add this:
</p>
<pre>iptables -I FORWARD -i br0 -o br0 -j ACCEPT</pre>
<p>Even more detailed solutions are <a rel="nofollow" class="external text" href="https://serverfault.com/questions/963759/docker-breaks-libvirt-bridge-network">here</a>.
</p>
<h3><span class="mw-headline" id="Image_pulls_from_Docker_Hub_are_rate_limited">Image pulls from Docker Hub are rate limited</span></h3>
<p>Beginning on November 1st 2020, rate limiting is enabled for downloads from Docker Hub from anonymous and free accounts. See the <a rel="nofollow" class="external text" href="https://docs.docker.com/docker-hub/download-rate-limit/">rate limit documentation</a> for more information.
</p>
<p>Unauthenticated rate limits are tracked by source IP. Authenticated rate limits are tracked by account.
</p>
<p>If you need to exceed the rate limits, you can either <a rel="nofollow" class="external text" href="https://www.docker.com/pricing">sign up for a paid plan</a> or mirror the images you need to a different image registry. You can <a rel="nofollow" class="external text" href="https://docs.docker.com/registry/">host your own registry</a> or use a cloud hosted registry such as <a rel="nofollow" class="external text" href="https://aws.amazon.com/ecr/">Amazon ECR</a>, <a rel="nofollow" class="external text" href="https://cloud.google.com/container-registry/">Google Container Registry</a>, <a rel="nofollow" class="external text" href="https://azure.microsoft.com/en-us/services/container-registry/">Azure Container Registry</a> or <a rel="nofollow" class="external text" href="https://quay.io/">Quay Container Registry</a>.
</p>
<p>To mirror an image, use the <code>pull</code>, <code>tag</code> and <code>push</code> subcommands of the Docker CLI. For example, to mirror the <code>1.19.3</code> tag of the <a href="../en/Nginx.html" title="Nginx">Nginx</a> image to a registry hosted at <code>cr.example.com</code>:
</p>
<pre>$ docker pull nginx:1.19.3
$ docker tag nginx:1.19.3 cr.example.com/nginx:1.19.3
$ docker push cr.example.com/nginx:1.19.3
</pre>
<p>You can then pull or run the image from the mirror:
</p>
<pre>$ docker pull cr.example.com/nginx:1.19.3
$ docker run cr.example.com/nginx:1.19.3
</pre>
<h3>
<span id="iptables_.28legacy.29:_unknown_option_.22--dport.22"></span><span class="mw-headline" id='iptables_(legacy):_unknown_option_"--dport"'>iptables (legacy): unknown option "--dport"</span>
</h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> <a href="../en/Nftables.html#Working_with_Docker" title="Nftables">Nftables#Working with Docker</a> advises to not use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iptables-nft">iptables-nft</a></span>. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Docker.html">Talk:Docker</a>)</div>
</div>
<p>If you see this error when running a container, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iptables-nft">iptables-nft</a></span> instead of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=iptables">iptables</a></span> (legacy) and reboot<a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=256709">[22]</a>.
</p>
<h3>
<span id=".22Your_password_will_be_stored_unencrypted.22_when_running_docker_login"></span><span class="mw-headline" id='"Your_password_will_be_stored_unencrypted"_when_running_docker_login'>"Your password will be stored unencrypted" when running docker login</span>
</h3>
<p><a rel="nofollow" class="external text" href="https://docs.docker.com/engine/reference/commandline/login/#credentials-store">By default</a> Docker will try to use the <code>pass</code> or <code>secretservice</code> binaries to store your registry passwords. If they are not found, it will store them in plain text (base64-encoded) in <code>$HOME/.docker/config.json</code> and print the following message after successfully logging in:
</p>
<pre>$ WARNING! Your password will be stored unencrypted in /home/<i>username</i>/.docker/config.json.
</pre>
<p>If you are using a password manager that implements the <a rel="nofollow" class="external text" href="https://specifications.freedesktop.org/secret-service/latest/">Secret Service Freedesktop DBUS API</a>, like KDE's <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=kwallet">kwallet</a></span> or GNOME's <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnome-keyring">gnome-keyring</a></span>, you can install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/docker-credential-secretservice/">docker-credential-secretservice</a></span><sup><small>AUR</small></sup> package to store your passwords in them.
</p>
<h3>
<span id=".22Could_not_find_an_available.2C_non-overlapping_IPv4_address_pool_among_the_defaults_to_assign_to_the_network.22"></span><span class="mw-headline" id='"Could_not_find_an_available,_non-overlapping_IPv4_address_pool_among_the_defaults_to_assign_to_the_network"'>"Could not find an available, non-overlapping IPv4 address pool among the defaults to assign to the network"</span>
</h3>
<p>Sometimes if you use a lot of Docker projects (ex. using docker-compose) it can happens that you run out of available IPs for Docker containers triggering the error:
</p>
<pre>Could not find an available, non-overlapping IPv4 address pool among the defaults to assign to the network
</pre>
<p>As found on <a rel="nofollow" class="external text" href="https://github.com/docker/docs/issues/8663">this Docker issue</a>, the defaults are:
</p>
<table class="wikitable">
<tbody>
<tr>
<th>Type</th>
<th>Default Size</th>
<th>Default Pool
</th>
</tr>
<tr>
<td>local</td>
<td>/16</td>
<td>172.17.0.0/12
</td>
</tr>
<tr>
<td>local*</td>
<td>/20</td>
<td>192.168.0.0/16
</td>
</tr>
</tbody>
</table>
<p>This can be easily fixed increasing the Docker IP space by configuring <code>default-address-pools</code> in <code>/etc/docker/daemon.json</code> increasing the size value from 16 to 24 on the first IP range, keeping the second one unaltered to avoid ip collision on the local network:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  ...
  "default-address-pools" : [
    {
      "base" : "172.17.0.0/12",
      "size" : 24
    },
    {
      "base" : "192.168.0.0/16",
      "size" : 24
    }
  ]
}</pre>
<p>Restart <code>docker.service</code> to apply changes.
</p>
<p>More details and technical explanations can be found on the following excellent article: <a rel="nofollow" class="external text" href="https://straz.to/2021-09-08-docker-address-pools/">The definitive guide to docker's default-address-pools option</a>.
</p>
<h3><span class="mw-headline" id="Slow_golang_compilation">Slow golang compilation</span></h3>
<p>Due to a ulimit configuration, building a docker image and its dependances with makepkg is very slow (stuck at "Entering fakeroot environment..." step).
</p>
<p>It is related to <a rel="nofollow" class="external autonumber" href="https://github.com/moby/moby/issues/45436">[23]</a> and <a rel="nofollow" class="external autonumber" href="https://github.com/containerd/containerd/pull/7566">[24]</a>.
</p>
<p>You can add <code>--ulimit "nofile=1024:524288"</code> to your docker build option or create/edit:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/docker/daemon.json</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">{
  "default-ulimits": {
    "nofile": {
      "Name": "nofile",
      "Soft": 1024,
      "Hard": 524288
    }
  }
}
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.docker.com">Official website</a></li>
<li><a rel="nofollow" class="external text" href="https://docs.docker.com/engine/installation/linux/archlinux/">Arch Linux on docs.docker.com</a></li>
<li>
<a rel="nofollow" class="external text" href="https://opensource.com/business/14/7/docker-security-selinux">Are Docker containers really secure?</a> — opensource.com</li>
<li>
<a rel="nofollow" class="external text" href="https://awesome-docker.netlify.com/">Awesome Docker</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2024-07-30 ⓘ]</sup>
</li>
<li><a rel="nofollow" class="external text" href="https://www.trendmicro.com/en_us/research/19/l/why-running-a-privileged-container-in-docker-is-a-bad-idea.html">Why A Privileged Container in Docker Is a Bad Idea</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Virtualization.html" title="Category:Virtualization">Virtualization</a></li>
<li><a href="../en/Category:Sandboxing.html" title="Category:Sandboxing">Sandboxing</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Docker&amp;oldid=813307">https://wiki.archlinux.org/index.php?title=Docker&amp;oldid=813307</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 30 July 2024, at 11:45.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
