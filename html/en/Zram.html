<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>zram - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Zram rootpage-Zram skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Usage_as_swap" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Usage_as_swap">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Usage as swap</div>
		</a>
		
			<button aria-controls="toc-Usage_as_swap-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Usage as swap subsection</span>
			</button>
		
		<ul id="toc-Usage_as_swap-sublist" class="vector-toc-list">
			<li id="toc-Manually" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Manually">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Manually</div>
			</a>
			
			<ul id="toc-Manually-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_a_udev_rule" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_a_udev_rule">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Using a udev rule</div>
			</a>
			
			<ul id="toc-Using_a_udev_rule-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_zram-generator" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_zram-generator">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Using zram-generator</div>
			</a>
			
			<ul id="toc-Using_zram-generator-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_zramswap" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_zramswap">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.4</span>Using zramswap</div>
			</a>
			
			<ul id="toc-Using_zramswap-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_zramd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_zramd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.5</span>Using zramd</div>
			</a>
			
			<ul id="toc-Using_zramd-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Tips and tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Checking_zram_statistics" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Checking_zram_statistics">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Checking zram statistics</div>
			</a>
			
			<ul id="toc-Checking_zram_statistics-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Multiple_zram_devices" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Multiple_zram_devices">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Multiple zram devices</div>
			</a>
			
			<ul id="toc-Multiple_zram_devices-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Optimizing_swap_on_zram" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Optimizing_swap_on_zram">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Optimizing swap on zram</div>
			</a>
			
			<ul id="toc-Optimizing_swap_on_zram-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enabling_a_backing_device_for_a_zram_block" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enabling_a_backing_device_for_a_zram_block">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4</span>Enabling a backing device for a zram block</div>
			</a>
			
			<ul id="toc-Enabling_a_backing_device_for_a_zram_block-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_zram_for_non-swap_purposes" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_zram_for_non-swap_purposes">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.5</span>Using zram for non-swap purposes</div>
			</a>
			
			<ul id="toc-Using_zram_for_non-swap_purposes-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">zram</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/zram" title="zram – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Zram.html" title="Zram – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Zram" title="Zram – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Swap.html" title="Swap">Swap</a></li>
<li><a href="../en/Zswap.html" title="Zswap">zswap</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/blockdev/zram.html">zram</a>, formerly called compcache, is a Linux kernel module for creating a compressed block device in RAM, i.e. a RAM disk with on-the-fly disk compression. The block device created with zram can then be used for swap or as a general-purpose RAM disk. The two most common uses for zram are for the storage of temporary files (<code>/tmp</code>) and as a swap device. Initially, zram had only the former function, hence the original name "compcache" ("compressed cache").
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Usage_as_swap">Usage as swap</span></h2>
<p>Initially the created zram block device does not reserve or use any RAM. Only as files need or want to be swapped out, they will be compressed and moved into the zram block device. The zram block device will then dynamically grow or shrink as required. 
</p>
<p>Even when assuming that zstd only achieves a conservative 1:2 compression ratio (real world data shows a common ratio of 1:3), zram will offer the advantage of being able to store more content in RAM than without memory compression. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>When configuring zram, the size of the zram device controls the maximum uncompressed amount of data it can store, <i>not</i> the maximum compressed size. You can configure the zram's size to be equal to or even greater than your system's physical RAM capacity, as long as the compressed size on physical RAM will not exceed your system's physical RAM capacity.</li>
<li>If the related <a href="../en/Zswap.html" title="Zswap">zswap</a> kernel feature remains enabled, it will prevent zram from being used effectively. This is because zswap functions as a swap cache in front of zram, intercepting and compressing evicted memory pages before they can reach zram. Despite the output of <span class="plainlinks archwiki-template-man" title="$ man 8 zramctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/zramctl.8">zramctl(8)</a></span>, most of zswap is unused in this circumstance. Therefore, it's recommended to permanently <a href="../en/Zswap.html#Toggling_zswap" title="Zswap">disable zswap</a> using the kernel parameter or sysfs setting before starting.</li>
<li>Hibernating to swap on zram is not supported, even when zram is configured with a backing device on permanent storage. <i>logind</i> will protect against trying to hibernate to a swap space on zram.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> You can specify the maximum amount of memory ZRAM can use to store the compressed data with the <code>mem_limit</code> parameter.</div>
<p>A simple size to start with is half of the total system memory.
</p>
<h3><span class="mw-headline" id="Manually">Manually</span></h3>
<p>To set up one zstd compressed zram device with half the system memory capacity and a higher-than-normal priority (only for the current session):
</p>
<pre># modprobe zram
# zramctl /dev/zram0 --algorithm zstd --size "$(($(grep MemTotal /proc/meminfo | tr -dc '0-9')/2))KiB"
# mkswap -U clear /dev/zram0
# swapon --priority 100 /dev/zram0
</pre>
<p>To disable it again, either reboot or run:
</p>
<pre># swapoff /dev/zram0
# modprobe -r zram
# echo 1 &gt; /sys/module/zswap/parameters/enabled
</pre>
<p>A detailed explanation of all steps, options and potential problems is provided in the <a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/blockdev/zram.html">official documentation of the zram module</a>.
</p>
<p>For a permanent solution, use a method from one of the following sections.
</p>
<h3><span class="mw-headline" id="Using_a_udev_rule">Using a udev rule</span></h3>
<p>The example below describes how to set up swap on zram automatically at boot with a single udev rule. No extra package should be needed to make this work.
</p>
<p>Explicitly <a href="../en/Kernel_module.html#Automatic_module_loading" class="mw-redirect" title="Load the module at boot">load the module at boot</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modules-load.d/zram.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">zram
</pre>
<p>Create the following <a href="../en/Udev.html#About_udev_rules" class="mw-redirect" title="Udev rule">udev rule</a> adjusting the <code>disksize</code> attribute as necessary: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/udev/rules.d/99-zram.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">ACTION=="add", KERNEL=="zram0", ATTR{comp_algorithm}="zstd", ATTR{disksize}="4G", RUN="/usr/bin/mkswap -U clear /dev/%k", TAG+="systemd"</pre>
<p>Add <code>/dev/zram</code> to your <a href="../en/Fstab.html" title="Fstab">fstab</a> with a higher than default priority:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/zram0 none swap defaults,pri=100 0 0</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The swap space on zram cannot be referred to by its LABEL or UUID in fstab since <a href="../en/Udev.html" title="Udev">udev</a> does not create <code>/dev/disk/by-label/*</code> and <code>/dev/disk/by-uuid/*</code> symlinks for zram devices.</div>
<h3><span class="mw-headline" id="Using_zram-generator">Using zram-generator</span></h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=zram-generator">zram-generator</a></span> provides a <code>systemd-zram-setup@.service</code> unit to automatically initialize zram devices without users needing to <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable/start">enable/start</a> the template or its instances. See <span class="plainlinks archwiki-template-man" title="$ man 8 zram-generator"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/zram-generator.8">zram-generator(8)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 5 zram-generator.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/zram-generator.conf.5">zram-generator.conf(5)</a></span>.
</p>
<p>To create a zram swap device using <code>zstd</code> and half of the entire available RAM, <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=zram-generator">zram-generator</a></span>, then create <code>/etc/systemd/zram-generator.conf</code> with the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/zram-generator.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[zram0]
zram-size = ram / 2
compression-algorithm = zstd</pre>
<p>Run <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Daemon-reload">daemon-reload</a>, then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> your configured <code>systemd-zram-setup@zram<i>N</i>.service</code> instance(s).
</p>
<p>You can <a href="../en/Swap.html#Swap_space" title="Swap">check the swap status</a> of your configured <code>/dev/zram<i>N</i></code> devices by reading the <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Unit status">unit status</a> of your <code>systemd-zram-setup@zram<i>N</i>.service</code> instance(s), or by using <span class="plainlinks archwiki-template-man" title="$ man 8 zramctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/zramctl.8">zramctl(8)</a></span>.
</p>
<h3><span class="mw-headline" id="Using_zramswap">Using zramswap</span></h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zramswap/">zramswap</a></span><sup><small>AUR</small></sup> provides an automated script for setting up a swap with a higher priority and a default size of 20% of the RAM size of your system. To do this automatically on every boot, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>zramswap.service</code>.
</p>
<h3><span class="mw-headline" id="Using_zramd">Using zramd</span></h3>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zramd/">zramd</a></span><sup><small>AUR</small></sup> allows to setup zram automatically using zstd compression by default, its configuration can be changed at <code>/etc/default/zramd</code>. It can be started at boot by enabling the <code>zramd.service</code> unit.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Checking_zram_statistics">Checking zram statistics</span></h3>
<p>Use <span class="plainlinks archwiki-template-man" title="$ man 8 zramctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/zramctl.8">zramctl(8)</a></span>. Example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ zramctl</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME       ALGORITHM DISKSIZE  DATA  COMPR  TOTAL STREAMS MOUNTPOINT
/dev/zram0 zstd           32G  1.9G 318.6M 424.9M      16 [SWAP]
</pre>
<ul>
<li>DISKSIZE = 32G: this zram device will store up to 32 GiB of uncompressed data.</li>
<li>DATA = 1.9G: currently, 1.9 GiB (uncompressed) of data is being stored in this zram device</li>
<li>COMPR = 318.6M: the 1.9 GiB uncompressed data was compressed to 318.6 MiB</li>
<li>TOTAL = 424.9M: including metadata, the 1.9 GiB of uncompressed data is using up 424.9 MiB of physical RAM</li>
</ul>
<h3><span class="mw-headline" id="Multiple_zram_devices">Multiple zram devices</span></h3>
<p>By default, loading the <code>zram</code> module creates a single <code>/dev/zram0</code> device.
</p>
<p>If you need more than one <code>/dev/zram</code> device, specify the amount using the <code>num_devices</code> <a href="../en/Kernel_module.html#Setting_module_options" class="mw-redirect" title="Kernel module parameter">kernel module parameter</a> or <a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/blockdev/zram.html#add-remove-zram-devices">add them as needed afterwards</a>.
</p>
<h3><span class="mw-headline" id="Optimizing_swap_on_zram">Optimizing swap on zram</span></h3>
<p>Since zram behaves differently than disk swap, we can configure the system's swap to take full potential of the zram advantages:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sysctl.d/99-vm-zram-parameters.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">vm.swappiness = 180
vm.watermark_boost_factor = 0
vm.watermark_scale_factor = 125
vm.page-cluster = 0</pre>
<p>Explanation of the configuration:
</p>
<p>These values are <a rel="nofollow" class="external text" href="https://github.com/pop-os/default-settings/pull/163">what Pop!_OS uses</a>. That Pop!_OS GitHub pull request also links to <a rel="nofollow" class="external text" href="https://old.reddit.com/r/Fedora/comments/mzun99/new_zram_tuning_benchmarks/">some testing done by users on r/Fedora</a>, which determined that <code>vm.page-cluster = 0</code> is ideal. They also found a high swappiness value to be ideal, which matches what is suggested by <a rel="nofollow" class="external text" href="https://docs.kernel.org/admin-guide/sysctl/vm.html">the kernel docs</a>:
</p>
<dl>
<dd>The default value is 60.</dd>
<dd>For in-memory swap, like zram or zswap, as well as hybrid setups that have swap on faster devices than the filesystem, values beyond 100 can be considered. For example, if the random IO against the swap device is on average 2x faster than IO from the filesystem, swappiness should be 133 (x + 2x = 200, 2x = 133.33).</dd>
</dl>
<p>On a system with a hard drive, random I/O against the zswap device would be orders of magnitude faster than I/O against the filesystem, so swappiness should be ~200. Even on a system with a fast SSD, a high swappiness value may be ideal.
</p>
<h3><span class="mw-headline" id="Enabling_a_backing_device_for_a_zram_block">Enabling a backing device for a zram block</span></h3>
<p>zram can be configured to push incompressible pages to a specified block device when under memory pressure.
</p>
<p>To add a backing device manually:
</p>
<pre># echo /dev/<i>sdX</i> &gt; /sys/block/zram0/backing_dev
</pre>
<p>To add a backing device to your zram block device using <i>zram-generator</i>, update <code>/etc/systemd/zram-generator.conf</code> with the following under your <code>[zram<i>X</i>]</code> device you want the backing device added to:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/zram-generator.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">writeback-device=/dev/disk/by-partuuid/<i>XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX</i></pre>
<h3><span class="mw-headline" id="Using_zram_for_non-swap_purposes">Using zram for non-swap purposes</span></h3>
<p>zram can also be used as a generic RAM-backed block device, e.g. a <code>/dev/ram</code> with less physical memory usage, but slightly lower performance. However there are some caveats:
</p>
<ul>
<li>There is no partition table support (no automatic creation of <code>/dev/zram<i>x</i>p<i>y</i></code>).</li>
<li>The block size is fixed to 4 kiB.</li>
</ul>
<p>The obvious way around this is to stack a loop device on-top the zram, using <i>losetup</i>, specifying the desired block size using the <code>-b</code> option and the <code>-P</code> option to process partition tables and automatic creation of the partition loop devices.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># zramctl -f -s <i>N</i>G</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/zram<i>x</i></pre>
<p>Copy the disk image to the new <code>/dev/zram</code>:
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Why is the following block size set to 512? (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Zram.html">Talk:Zram</a>)</div>
</div>
<pre># losetup -f -b 512 -P /dev/zram<i>x</i>
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># ls /dev/loop*</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">/dev/loop0 /dev/loop0p1 /dev/loop0p2</pre>
<pre># mount /dev/loop0p1 /mnt/boot
# mount /dev/loop0p2 /mnt/root
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>The zram device numbering depends on pre-existing zram devices and its size should be enough to hold the disk image.</li>
<li>The output from <code>ls /dev/loop*</code> depends on the contents of the disk image.</li>
</ul>
</div>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/zram" class="extiw" title="wikipedia:zram">Wikipedia:zram</a></li>
<li><a rel="nofollow" class="external free" href="https://github.com/pop-os/default-settings/pull/163">https://github.com/pop-os/default-settings/pull/163</a></li>
<li><a rel="nofollow" class="external free" href="https://www.reddit.com/r/pop_os/comments/znh9n6/help_test_a_zram_optimization_for_pop_os/">https://www.reddit.com/r/pop_os/comments/znh9n6/help_test_a_zram_optimization_for_pop_os/</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Kernel.html" title="Category:Kernel">Kernel</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Zram&amp;oldid=812554">https://wiki.archlinux.org/index.php?title=Zram&amp;oldid=812554</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 17 July 2024, at 04:45.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
