<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Kernel module - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Kernel_module rootpage-Kernel_module skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Obtaining_information" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Obtaining_information">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Obtaining information</div>
		</a>
		
		<ul id="toc-Obtaining_information-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Automatic_module_loading" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Automatic_module_loading">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Automatic module loading</div>
		</a>
		
			<button aria-controls="toc-Automatic_module_loading-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Automatic module loading subsection</span>
			</button>
		
		<ul id="toc-Automatic_module_loading-sublist" class="vector-toc-list">
			<li id="toc-systemd" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#systemd">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>systemd</div>
			</a>
			
			<ul id="toc-systemd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Early_module_loading" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Early_module_loading">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Early module loading</div>
			</a>
			
			<ul id="toc-Early_module_loading-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Manual_module_handling" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Manual_module_handling">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Manual module handling</div>
		</a>
		
		<ul id="toc-Manual_module_handling-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Setting_module_options" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Setting_module_options">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Setting module options</div>
		</a>
		
			<button aria-controls="toc-Setting_module_options-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Setting module options subsection</span>
			</button>
		
		<ul id="toc-Setting_module_options-sublist" class="vector-toc-list">
			<li id="toc-Manually_at_load_time_using_modprobe" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Manually_at_load_time_using_modprobe">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Manually at load time using modprobe</div>
			</a>
			
			<ul id="toc-Manually_at_load_time_using_modprobe-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_files_in_/etc/modprobe.d/" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_files_in_/etc/modprobe.d/">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Using files in /etc/modprobe.d/</div>
			</a>
			
			<ul id="toc-Using_files_in_/etc/modprobe.d/-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_kernel_command_line" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_kernel_command_line">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.3</span>Using kernel command line</div>
			</a>
			
			<ul id="toc-Using_kernel_command_line-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Aliasing" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Aliasing">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Aliasing</div>
		</a>
		
		<ul id="toc-Aliasing-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Blacklisting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Blacklisting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Blacklisting</div>
		</a>
		
			<button aria-controls="toc-Blacklisting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Blacklisting subsection</span>
			</button>
		
		<ul id="toc-Blacklisting-sublist" class="vector-toc-list">
			<li id="toc-Using_files_in_/etc/modprobe.d/_2" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_files_in_/etc/modprobe.d/_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>Using files in /etc/modprobe.d/</div>
			</a>
			
			<ul id="toc-Using_files_in_/etc/modprobe.d/_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_kernel_command_line_2" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_kernel_command_line_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2</span>Using kernel command line</div>
			</a>
			
			<ul id="toc-Using_kernel_command_line_2-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Modules_do_not_load" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Modules_do_not_load">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1</span>Modules do not load</div>
			</a>
			
			<ul id="toc-Modules_do_not_load-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Kernel module</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 8 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-8" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">8 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-bs mw-list-item"><a href="../bs/Kernel_module.html" title="Kernel module – bosanski" lang="bs" hreflang="bs" class="interlanguage-link-target"><span>Bosanski</span></a></li>
<li class="interlanguage-link interwiki-de mw-list-item"><a href="https://wiki.archlinux.de/title/Kernelmodule" title="Kernelmodule – Deutsch" lang="de" hreflang="de" class="interlanguage-link-target"><span>Deutsch</span></a></li>
<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/Kernel_module.html" title="Kernel module – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-fr mw-list-item"><a href="../fr/Kernel_module.html" title="Kernel module – français" lang="fr" hreflang="fr" class="interlanguage-link-target"><span>Français</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB" title="カーネルモジュール – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/Kernel_module.html" title="Kernel module – português" lang="pt" hreflang="pt" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Kernel_module.html" title="Kernel module – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Kernel_module" title="Kernel module – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/General_troubleshooting.html#Boot_problems" class="mw-redirect" title="Boot debugging">Boot debugging</a></li>
<li><a href="../en/Kernel.html" title="Kernel">Kernel</a></li>
<li><a href="../en/Kernel_parameters.html" title="Kernel parameters">Kernel parameters</a></li>
<li><a href="../en/Compile_kernel_module.html" title="Compile kernel module">Compile kernel module</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/Loadable_kernel_module" class="extiw" title="wikipedia:Loadable kernel module">Kernel modules</a> are pieces of code that can be loaded and unloaded into the kernel upon demand. They extend the functionality of the kernel without the need to reboot the system. 
</p>
<p>To create a kernel module, you can read <a rel="nofollow" class="external text" href="https://sysprog21.github.io/lkmpg/">The Linux Kernel Module Programming Guide</a>. A module can be configured as built-in or loadable. To dynamically load or remove a module, it has to be configured as a loadable module in the kernel configuration (the line related to the module will therefore display the letter <code>M</code>).
</p>
<p>To rebuild a kernel module automatically when a new kernel is installed, see <a href="../en/Dynamic_Kernel_Module_Support.html" title="Dynamic Kernel Module Support">Dynamic Kernel Module Support</a> (DKMS).
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Obtaining_information">Obtaining information</span></h2>
<p>Modules are stored in <code>/usr/lib/modules/<i>kernel_release</i></code>. You can use the command <code>uname -r</code> to get your current kernel release version.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Module names often use underscores (<code>_</code>) or dashes (<code>-</code>); however, those symbols are interchangeable when using the <code>modprobe</code> command and in configuration files in <code>/etc/modprobe.d/</code>.</div>
<p>To show what kernel modules are currently loaded:
</p>
<pre>$ lsmod
</pre>
<p>To show information about a module:
</p>
<pre>$ modinfo <i>module_name</i>
</pre>
<p>To list the options that are set for a loaded module use <span class="plainlinks archwiki-template-man" title="$ man 1 systool"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systool.1">systool(1)</a></span> from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sysfsutils">sysfsutils</a></span>:
</p>
<pre>$ systool -v -m <i>module_name</i>
</pre>
<p>To display the comprehensive configuration of all the modules:
</p>
<pre>$ modprobe -c | less
</pre>
<p>To display the configuration of a particular module:
</p>
<pre>$ modprobe -c | grep <i>module_name</i>
</pre>
<p>List the dependencies of a module (or alias), including the module itself:
</p>
<pre>$ modprobe --show-depends <i>module_name</i>
</pre>
<h2><span class="mw-headline" id="Automatic_module_loading">Automatic module loading</span></h2>
<p>Today, all necessary modules loading is handled automatically by <a href="../en/Udev.html" title="Udev">udev</a>, so if you do not need to use any out-of-tree kernel modules, there is no need to put modules that should be loaded at boot in any configuration file. However, there are cases where you might want to load an extra module during the boot process, or blacklist another one for your computer to function properly.
</p>
<h3><span class="mw-headline" id="systemd">systemd</span></h3>
<p>Kernel modules can be explicitly listed in files under <code>/etc/modules-load.d/</code> for systemd to load them during boot. Each configuration file is named in the style of <code>/etc/modules-load.d/<i>program</i>.conf</code>. Configuration files simply contain a list of kernel modules names to load, separated by newlines. Empty lines and lines whose first non-whitespace character is <code>#</code> or <code>;</code> are ignored.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modules-load.d/virtio-net.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Load virtio_net.ko at boot
virtio_net
</pre>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 5 modules-load.d"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/modules-load.d.5">modules-load.d(5)</a></span> for more details.
</p>
<h3><span class="mw-headline" id="Early_module_loading">Early module loading</span></h3>
<p>The <a href="../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">initramfs</a> image may not contain the kernel modules asked for in <code>/etc/modules-load.d/</code>, it also may lack the files that have been set in that folder. Early module loading depends on the initramfs generator used:
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio">mkinitcpio</a></span>: see <a href="../en/Mkinitcpio.html#MODULES" title="Mkinitcpio">Mkinitcpio#MODULES</a>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dracut">dracut</a></span>: see <a href="../en/Dracut.html#Early_kernel_module_loading" title="Dracut">Dracut#Early kernel module loading</a>
</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=booster">booster</a></span>: see <a href="../en/Booster.html#Early_module_loading" title="Booster">Booster#Early module loading</a>
</li>
</ul>
<h2><span class="mw-headline" id="Manual_module_handling">Manual module handling</span></h2>
<p>Kernel modules are handled by tools provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=kmod">kmod</a></span> package. You can use these tools manually.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you have upgraded your kernel but have not yet rebooted, <i>modprobe</i> will fail with no error message and exit with code 1, because the path <code>/usr/lib/modules/$(uname -r)/</code> no longer exists. Check manually if this path exists when <i>modprobe</i> failed to determine if this is the case.</div>
<p>To load a module:
</p>
<pre># modprobe <i>module_name</i>
</pre>
<p>To load a module by filename (i.e. one that is not installed in <code>/usr/lib/modules/$(uname -r)/</code>):
</p>
<pre># insmod filename [args]
</pre>
<p>To unload a module:
</p>
<pre># modprobe -r <i>module_name</i>
</pre>
<p>Or, alternatively:
</p>
<pre># rmmod <i>module_name</i>
</pre>
<h2><span class="mw-headline" id="Setting_module_options">Setting module options</span></h2>
<p>To pass a parameter to a kernel module, you can pass them manually with modprobe or assure certain parameters are always applied using a modprobe configuration file or by using the kernel command line. If the module is built into the kernel, the kernel command line must be used and other methods will not work.
</p>
<h3><span class="mw-headline" id="Manually_at_load_time_using_modprobe">Manually at load time using modprobe</span></h3>
<p>The basic way to pass parameters to a module is using the <i>modprobe</i> command. Parameters are specified on command line using simple <code><i>key=value</i></code> assignments:
</p>
<pre># modprobe <i>module_name parameter_name=parameter_value</i>
</pre>
<h3>
<span id="Using_files_in_.2Fetc.2Fmodprobe.d.2F"></span><span class="mw-headline" id="Using_files_in_/etc/modprobe.d/">Using files in /etc/modprobe.d/</span>
</h3>
<p>Files in <code>/etc/modprobe.d/</code> directory can be used to pass module settings to <a href="../en/Udev.html" title="Udev">udev</a>, which will use <code>modprobe</code> to manage the loading of the modules during system boot. Configuration files in this directory can have any name, given that they end with the <i>.conf</i> extension. The syntax is:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/myfilename.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options <i>module_name parameter_name=parameter_value</i></pre>
<p>Multiple module parameters are separated by spaces, in turn a parameter can receive a list of values which is separated by commas:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/myfilename.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options <i>module_name param1=value1 param2=value2a,value2b …</i></pre>
<p>For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/thinkfan.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># On ThinkPads, this lets the 'thinkfan' daemon control fan speed
options thinkpad_acpi fan_control=1</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If any of the affected modules is loaded from the initramfs, then you will need to add the appropriate <i>.conf</i> file to <code>FILES</code> in <a href="../en/Mkinitcpio.html#Configuration" class="mw-redirect" title="Mkinitcpio.conf">mkinitcpio.conf</a> or use the <code>modconf</code> <a href="../en/Mkinitcpio.html#HOOKS" class="mw-redirect" title="Mkinitcpio.conf">hook</a>, then <a href="../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">regenerate the initramfs</a> to include the <i>.conf</i> file. To see the contents of the default initramfs use <a href="../en/Mkinitcpio.html#Extracting_the_image" title="Mkinitcpio">lsinitcpio</a>.</div>
<h3><span class="mw-headline" id="Using_kernel_command_line">Using kernel command line</span></h3>
<p>You can also pass options to the module using the kernel command line. This is the only working option for modules built into the kernel. For all common boot loaders, the following syntax is correct:
</p>
<pre><i>module_name.parameter_name=parameter_value</i>
</pre>
<p>For example:
</p>
<pre>thinkpad_acpi.fan_control=1
</pre>
<p>Simply add this to your boot loader's kernel-line, as described in <a href="../en/Kernel_parameters.html" title="Kernel parameters">Kernel parameters</a>.
</p>
<h2><span class="mw-headline" id="Aliasing">Aliasing</span></h2>
<p>Aliases are alternate names for a module. For example: <code>alias my-mod really_long_modulename</code> means you can use <code>modprobe my-mod</code> instead of <code>modprobe really_long_modulename</code>. You can also use shell-style wildcards, so <code>alias my-mod* really_long_modulename</code> means that <code>modprobe my-mod-something</code> has the same effect. Create an alias:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/myalias.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">alias mymod really_long_module_name
</pre>
<p>Some modules have aliases which are used to automatically load them when they are needed by an application. Disabling these aliases can prevent automatic loading but will still allow the modules to be manually loaded.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/modprobe.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Prevent Bluetooth autoload
alias net-pf-31 off
</pre>
<h2><span class="mw-headline" id="Blacklisting">Blacklisting</span></h2>
<p>Blacklisting, in the context of kernel modules, is a mechanism to prevent the kernel module from loading. This could be useful if, for example, the associated hardware is not needed, or if loading that module causes problems: for instance there may be two kernel modules that try to control the same piece of hardware, and loading them together would result in a conflict.
</p>
<p>Some modules are loaded as part of the <a href="../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">initramfs</a>. <code>mkinitcpio -M</code> will print out all automatically detected modules: to prevent the initramfs from loading some of those modules, blacklist them in a <i>.conf</i> file under <code>/etc/modprobe.d</code> and it shall be added in by the <code>modconf</code> hook during image generation. Running <code>mkinitcpio -v</code> will list all modules pulled in by the various hooks (e.g. <code>filesystems</code> hook, <code>block</code> hook, etc.). Remember to add that <i>.conf</i> file to the <code>FILES</code> array in <code>/etc/mkinitcpio.conf</code> if you do not have the <code>modconf</code> hook in your <code>HOOKS</code> array (e.g. you have deviated from the default configuration), and once you have blacklisted the modules <a href="../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">regenerate the initramfs</a>, and reboot afterwards.
</p>
<h3>
<span id="Using_files_in_.2Fetc.2Fmodprobe.d.2F_2"></span><span class="mw-headline" id="Using_files_in_/etc/modprobe.d/_2">Using files in /etc/modprobe.d/</span>
</h3>
<p>Create a <i>.conf</i> file inside <code>/etc/modprobe.d/</code> and append a line for each module you want to blacklist, using the <code>blacklist</code> keyword. If for example you want to prevent the <code>pcspkr</code> module from loading to avoid sounds through the <a href="../en/PC_speaker.html" title="PC speaker">PC speaker</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/nobeep.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Do not load the 'pcspkr' module on boot.
blacklist pcspkr
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <code>blacklist</code> command will blacklist a module so that it will not be loaded automatically, but the module may be loaded if another non-blacklisted module depends on it or if it is loaded manually.
<p>However, there is a workaround for this behaviour; the <code>install</code> command instructs modprobe to run a custom command instead of inserting the module in the kernel as normal, so you can force the module to always fail loading with:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/blacklist.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
install <i>module_name</i> /bin/true
...
</pre>
<p>This will effectively blacklist that module and any other that depends on it.
</p>
</div>
<h3><span class="mw-headline" id="Using_kernel_command_line_2">Using kernel command line</span></h3>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> This can be very useful if a broken module makes it impossible to boot your system.</div>
<p>You can also blacklist modules from the bootloader.
</p>
<p>Simply add <code>module_blacklist=modname1,modname2,modname3</code> to your bootloader's kernel line, as described in <a href="../en/Kernel_parameters.html" title="Kernel parameters">Kernel parameters</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>When you are blacklisting more than one module, note that they are separated by commas only. Spaces or anything else might presumably break the syntax.</li>
<li>
<code>module_blacklist</code> will make the kernel completely refuse to load the module. If you only want to prevent implicit loading, but maybe load the module manually later, the correct parameter is <code>modprobe.blacklist=modname1,modname2,modname3</code>. This will however not prevent explicit loads during the boot, e.g. by <a href="#systemd">systemd</a> or other modules.</li>
</ul>
</div>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Modules_do_not_load">Modules do not load</span></h3>
<p>In case a specific module does not load and the boot log (accessible by running <code>journalctl -b</code> as root) says that the module is blacklisted, but the directory <code>/etc/modprobe.d/</code> does not show a corresponding entry, check another modprobe source directory at <code>/usr/lib/modprobe.d/</code> for blacklisting entries.
</p>
<p>A module will not be loaded if the "vermagic" string contained within the kernel module does not match the value of the currently running kernel. If it is known that the module is compatible with the current running kernel the "vermagic" check can be ignored with <code>modprobe --force-vermagic</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Ignoring the version checks for a kernel module can cause a kernel to crash or a system to exhibit undefined behavior due to incompatibility. Use <code>--force-vermagic</code> only with the utmost caution.</div>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a href="../en/PC_speaker.html#Disabling_the_PC_speaker" class="mw-redirect" title="Disable PC speaker beep">Disable PC speaker beep</a></li>
<li>
<a rel="nofollow" class="external text" href="https://lwn.net/Articles/391230/">Writing a WMI driver</a> - an LWM introduction</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Kernel.html" title="Category:Kernel">Kernel</a></li>
<li><a href="../en/Category:Hardware_detection_and_troubleshooting.html" title="Category:Hardware detection and troubleshooting">Hardware detection and troubleshooting</a></li>
<li><a href="../en/Category:Boot_process.html" title="Category:Boot process">Boot process</a></li>
</ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Kernel_module&amp;oldid=803682">https://wiki.archlinux.org/index.php?title=Kernel_module&amp;oldid=803682</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 17 March 2024, at 01:56.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
