<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>CMake package guidelines - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.45.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-CMake_package_guidelines rootpage-CMake_package_guidelines skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Typical_usage" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Typical_usage">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Typical usage</span>
			</div>
		</a>
		
		<ul id="toc-Typical_usage-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-CMake_undesired_behaviors" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#CMake_undesired_behaviors">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>CMake undesired behaviors</span>
			</div>
		</a>
		
			<button aria-controls="toc-CMake_undesired_behaviors-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle CMake undesired behaviors subsection</span>
			</button>
		
		<ul id="toc-CMake_undesired_behaviors-sublist" class="vector-toc-list">
			<li id="toc-CMake_can_automatically_override_the_default_compiler_optimization_flag" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#CMake_can_automatically_override_the_default_compiler_optimization_flag">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1</span>
					<span>CMake can automatically override the default compiler optimization flag</span>
				</div>
			</a>
			
			<ul id="toc-CMake_can_automatically_override_the_default_compiler_optimization_flag-sublist" class="vector-toc-list">
				<li id="toc-Notes_about_-O3" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Notes_about_-O3">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1.1</span>
					<span>Notes about -O3</span>
				</div>
			</a>
			
			<ul id="toc-Notes_about_-O3-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Fixing_the_automatic_optimization_flag_override" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Fixing_the_automatic_optimization_flag_override">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.1.2</span>
					<span>Fixing the automatic optimization flag override</span>
				</div>
			</a>
			
			<ul id="toc-Fixing_the_automatic_optimization_flag_override-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Verifying_the_fixes" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Verifying_the_fixes">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">2.2</span>
					<span>Verifying the fixes</span>
				</div>
			</a>
			
			<ul id="toc-Verifying_the_fixes-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Prefix_and_library_install_directories" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Prefix_and_library_install_directories">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Prefix and library install directories</span>
			</div>
		</a>
		
		<ul id="toc-Prefix_and_library_install_directories-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Tips and tricks</span>
			</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Specifying_directories" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Specifying_directories">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>Specifying directories</span>
				</div>
			</a>
			
			<ul id="toc-Specifying_directories-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Reducing_possible_unneeded_output" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Reducing_possible_unneeded_output">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.2</span>
					<span>Reducing possible unneeded output</span>
				</div>
			</a>
			
			<ul id="toc-Reducing_possible_unneeded_output-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Removing_insecure_RPATH_references_from_binaries" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Removing_insecure_RPATH_references_from_binaries">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.3</span>
					<span>Removing insecure RPATH references from binaries</span>
				</div>
			</a>
			
			<ul id="toc-Removing_insecure_RPATH_references_from_binaries-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Getting_all_available_CMake_options" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Getting_all_available_CMake_options">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.4</span>
					<span>Getting all available CMake options</span>
				</div>
			</a>
			
			<ul id="toc-Getting_all_available_CMake_options-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Avoiding_FetchContent_downloads_during_the_build" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Avoiding_FetchContent_downloads_during_the_build">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.5</span>
					<span>Avoiding FetchContent downloads during the build</span>
				</div>
			</a>
			
			<ul id="toc-Avoiding_FetchContent_downloads_during_the_build-sublist" class="vector-toc-list">
				<li id="toc-Example" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Example">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.5.1</span>
					<span>Example</span>
				</div>
			</a>
			
			<ul id="toc-Example-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Template" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Template">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Template</span>
			</div>
		</a>
		
		<ul id="toc-Template-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Example_packages" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Example_packages">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Example packages</span>
			</div>
		</a>
		
		<ul id="toc-Example_packages-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">7</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar no-font-mode-scale">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">CMake package guidelines</span></h1>
							
</header>
				<div class="vector-column-end no-font-mode-scale">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-navigation">
<b><a href="../en/Arch_package_guidelines.html" title="Arch package guidelines">Arch package guidelines</a></b>
<hr>
<p><a href="../en/32-bit_package_guidelines.html" title="32-bit package guidelines">32-bit</a> – <a href="../en/CLR_package_guidelines.html" title="CLR package guidelines">CLR</a> – <a class="mw-selflink selflink">CMake</a> – <a href="../en/Cross-compiling_tools_package_guidelines.html" title="Cross-compiling tools package guidelines">Cross</a> – <a href="../en/DKMS_package_guidelines.html" title="DKMS package guidelines">DKMS</a> – <a href="../en/Eclipse_plugin_package_guidelines.html" title="Eclipse plugin package guidelines">Eclipse</a> – <a href="../en/Electron_package_guidelines.html" title="Electron package guidelines">Electron</a> – <a href="../en/Font_package_guidelines.html" title="Font package guidelines">Font</a> – <a href="../en/Free_Pascal_package_guidelines.html" title="Free Pascal package guidelines">Free Pascal</a> – <a href="../en/GNOME_package_guidelines.html" title="GNOME package guidelines">GNOME</a> – <a href="../en/Go_package_guidelines.html" title="Go package guidelines">Go</a> – <a href="../en/Haskell_package_guidelines.html" title="Haskell package guidelines">Haskell</a> – <a href="../en/Java_package_guidelines.html" title="Java package guidelines">Java</a> – <a href="../en/KDE_package_guidelines.html" title="KDE package guidelines">KDE</a> – <a href="../en/Kernel_module_package_guidelines.html" title="Kernel module package guidelines">Kernel modules</a> – <a href="../en/Lisp_package_guidelines.html" title="Lisp package guidelines">Lisp</a> – <a href="../en/Meson_package_guidelines.html" title="Meson package guidelines">Meson</a> – <a href="../en/MinGW_package_guidelines.html" title="MinGW package guidelines">MinGW</a> – <a href="../en/Node.js_package_guidelines.html" title="Node.js package guidelines">Node.js</a> – <a href="../en/Nonfree_applications_package_guidelines.html" title="Nonfree applications package guidelines">Nonfree</a> – <a href="../en/OCaml_package_guidelines.html" title="OCaml package guidelines">OCaml</a> – <a href="../en/Perl_package_guidelines.html" title="Perl package guidelines">Perl</a> – <a href="../en/PHP_package_guidelines.html" title="PHP package guidelines">PHP</a> – <a href="../en/Python_package_guidelines.html" title="Python package guidelines">Python</a> – <a href="../en/R_package_guidelines.html" title="R package guidelines">R</a> – <a href="../en/Ruby_package_guidelines.html" title="Ruby package guidelines">Ruby</a> – <a href="../en/Rust_package_guidelines.html" title="Rust package guidelines">Rust</a> - <a href="../en/Arch_package_guidelines/Security.html" title="Arch package guidelines/Security">Security</a> – <a href="../en/Shell_package_guidelines.html" title="Shell package guidelines">Shell</a> – <a href="../en/VCS_package_guidelines.html" title="VCS package guidelines">VCS</a> – <a href="../en/Web_application_package_guidelines.html" title="Web application package guidelines">Web</a> – <a href="../en/Wine_package_guidelines.html" title="Wine package guidelines">Wine</a>
</p>
</div>
<p>This document covers standards and guidelines on writing <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILDs</a> for software that uses <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cmake">cmake</a></span>.
</p>
<p>From the <a rel="nofollow" class="external text" href="https://cmake.org">CMake web page</a>:
</p>
<dl><dd>CMake is an open-source, cross-platform family of tools designed to build, test and package software. CMake is used to control the software compilation process using simple platform and compiler independent configuration files, and generate native makefiles and workspaces that can be used in the compiler environment of your choice.</dd></dl>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Typical_usage">Typical usage</h2></div>
<p>The typical usage consists of running the <code>cmake</code> command and after that execute the building command. The <code>cmake</code> command usually sets some parameters, checks for the needed dependencies and creates the build files, letting the software ready to be built by other tools like <code>make</code> and <code>ninja</code>.
</p>
<div class="mw-heading mw-heading2"><h2 id="CMake_undesired_behaviors">CMake undesired behaviors</h2></div>
<p>Due to its own internal characteristics for generating the build files, sometimes CMake can behave in undesired ways. Being such, some steps should be noted when writing <a href="../en/PKGBUILD.html" title="PKGBUILD">PKGBUILDs</a> for CMake-based software.
</p>
<div class="mw-heading mw-heading3"><h3 id="CMake_can_automatically_override_the_default_compiler_optimization_flag">CMake can automatically override the default compiler optimization flag</h3></div>
<p>It is very common to see people running CMake with the <code>-DCMAKE_BUILD_TYPE=Release</code> option. Some upstream projects even inadvertently include this option in their building instructions, but this produces an undesired behavior.
</p>
<p>Each build type causes CMake to automatically append a set of flags to <code>CFLAGS</code> and <code>CXXFLAGS</code>. When using the common <code>Release</code> build type, it automatically appends the <code>-O3</code><a rel="nofollow" class="external autonumber" href="https://github.com/Kitware/CMake/blob/v3.17.0/Modules/Compiler/GNU.cmake#L58">[1]</a> compiler optimization flag, and this overrides the default Arch Linux flag which currently is <code>-O2</code> (defined in the <a href="../en/Makepkg.html#Configuration" title="Makepkg">makepkg configuration file</a>). This is undesired, as it deviates from the Arch Linux targeted optimization level.
</p>
<div class="mw-heading mw-heading4"><h4 id="Notes_about_-O3">Notes about -O3</h4></div>
<p>Using <code>-O3</code> does not guarantee that the software will perform better, and sometimes it can even slow down the program. It can also break software in some situations. There is a good reason why the Arch Linux developers choose <code>-O2</code> as the target optimization level and we should stick with it. Unless you know exactly what you are doing, or if upstream explicitly tells or implies that <code>-O3</code> is needed, we should avoid using it in our packages.
</p>
<div class="mw-heading mw-heading4"><h4 id="Fixing_the_automatic_optimization_flag_override">Fixing the automatic optimization flag override</h4></div>
<p>Fixing this in a 100% guaranteed way is not a simple question due to CMake flexibility. Please note that there is no standard solution that can be applied to all cases. This section will discuss possible solutions and some points that should be observed.
</p>
<p>The default CMake build type is <code>None</code> and it does not append any flags to <code>CFLAGS</code> and <code>CXXFLAGS</code> by default, so simply omitting the usage of the <code>CMAKE_BUILD_TYPE</code> option can work as it will default to <code>None</code>. But note that omitting this option is not guaranteed to fix the problem, as many software projects automatically set the build type to <code>Release</code> (or other type) in the CMake files if <code>CMAKE_BUILD_TYPE</code> is not set at command line. Also be aware of possible references to source files in the resulting package and the corresponding <a href="../en/Makepkg.html" title="Makepkg">makepkg</a>'s <code>WARNING: Package contains reference to $srcdir</code> caused by a missing <code>NDEBUG</code> definition in the <code>None</code> build type.
</p>
<p>Since the default <code>None</code> build type does not append any flags to <code>CFLAGS</code> and <code>CXXFLAGS</code> by default, using the <code>-DCMAKE_BUILD_TYPE=None</code> option can also work. Generally speaking, using the <code>-DCMAKE_BUILD_TYPE=None</code> option is better than omitting the usage of <code>CMAKE_BUILD_TYPE</code>. It will cover the case when upstream automatically sets the build type to <code>Release</code> when <code>CMAKE_BUILD_TYPE</code> is omitted, it will not append any flags by default and it is uncommon to see software setting undesired flags for the <code>None</code> build type.
</p>
<p>But unfortunately, things are not that simple like only using <code>-DCMAKE_BUILD_TYPE=None</code> to fix this. When using the <code>None</code> build type to fix the <code>-O3</code> issue, one may fall into another problem. It is a common practice for many software projects to define some required compiler flags for the <code>Release</code> build type in the CMake files (for example, like setting the <code>CMAKE_C_FLAGS_RELEASE</code> and <code>CMAKE_CXX_FLAGS_RELEASE</code> CMake variables). Such software may break or misbehave when compiled without these upstream defined flags if you use the <code>None</code> build type. In order to determine if you are missing some flags you will need to look at the CMake files, or you can compare the output of <code>make VERBOSE=1</code> for the <code>None</code> and <code>Release</code> build types. What to do if the <code>None</code> build type causes some upstream defined flags to be missed? In this case you may be at the middle of two problematic situations, because if you use the <code>Release</code> build type you may be using the undesired <code>-O3</code> flag, and if you use the <code>None</code> build type you will miss some required upstream defined flags. There is no standard way of solving this situation and it should be analyzed on a case-by-case basis. If upstream defines <code>-O2</code> for the <code>Release</code> build type, you can use <code>-DCMAKE_BUILD_TYPE=Release</code> (see below). Otherwise, patching the CMake files may be a solution.
</p>
<p>Some few software projects hardcode <code>-O2</code> for the <code>Release</code> build type in their CMake files, and thus <code>-DCMAKE_BUILD_TYPE=Release</code> can be safely set in this case if you are sure that <code>-O2</code> is the optimization level being used.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning</strong> 
<ul>
<li>Some software may break when using the <code>None</code> build type. Test the software when using the <code>None</code> build type to check if it will break or lose functionality.</li>
<li>Some software may work only with the <code>Release</code> build type. You will need to experiment and test the software.</li>
</ul>
</div>
<div class="mw-heading mw-heading3"><h3 id="Verifying_the_fixes">Verifying the fixes</h3></div>
<p>You can verify if the fixes are being correctly used by CMake by enabling the verbose mode of the build tool. For example, when using <code>make</code> (which is the CMake default), this can be done by adding <code>VERBOSE=1</code> to it (like <code>make VERBOSE=1</code>). This will enable <code>make</code> to output the compiler commands that are being executed. You can then run <a href="../en/Makepkg.html" title="Makepkg">makepkg</a> and examine the output to see if the compiler is using the <code>-D_FORTIFY_SOURCE=2</code> and <code>-O2</code> flags. If multiple optimization flags are being displayed in each command line, the last flag in the line will be the one used by the compiler (it means that <code>-O2</code> needs to be the last optimization flag in order to be effective).
</p>
<div class="mw-heading mw-heading2"><h2 id="Prefix_and_library_install_directories">Prefix and library install directories</h2></div>
<p>The standard Arch Linux <code>/usr</code> prefix can be specified by the <code>-DCMAKE_INSTALL_PREFIX=/usr</code> CMake option. This is usually needed because a lot of software defaults to install files into the <code>/usr/local</code> prefix.
</p>
<p>Some upstream projects set their CMake files to install libraries into the <code>/usr/lib64</code> directory. If this is the case, you can correctly set the library installation directory to <code>/usr/lib</code> by using the <code>-DCMAKE_INSTALL_LIBDIR=lib</code> CMake option.
</p>
<div class="mw-heading mw-heading2"><h2 id="Tips_and_tricks">Tips and tricks</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Specifying_directories">Specifying directories</h3></div>
<p>Since CMake version 3.13, there is a <code>-B</code> option that automatically creates the build directory. This avoids the creation of the build directory by a separated <code>mkdir</code> (or <code>install</code>) command. The <code>-S</code> option specifies the source directory (where to search for a <code>CMakeLists.txt</code> file) and avoids the need of <code>cd</code>'ing into the source tree before executing <code>cmake</code>. Combined together, these two options are a convenient way to specify the build and the source directories.
</p>
<p>Since building a typical CMake project requires many options, it is convenient to specify them in a local array in the build function. This avoids the need to use backslashes to split the long command to multiple lines and allows to include comments for each option separately.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">PKGBUILD</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">build() {
  local cmake_options=(
    -B build
    -S $pkgname-$pkgver
    # Any other options required to build a project may follow
    <i>[other_cmake_options]</i>
  )
  cmake "${cmake_options[@]}"
  cmake --build build
}</pre>
<div class="mw-heading mw-heading3"><h3 id="Reducing_possible_unneeded_output">Reducing possible unneeded output</h3></div>
<p>The <code>-Wno-dev</code> CMake option will suppress the output of some warnings that are meant only for the upstream project developers who write the <code>CMakeLists.txt</code> files. Removing these warnings makes the CMake output smoother and reduces the burden on examining it. As a general rule, these warnings usually can be safely ignored by packagers.
</p>
<div class="mw-heading mw-heading3"><h3 id="Removing_insecure_RPATH_references_from_binaries">Removing insecure RPATH references from binaries</h3></div>
<p>Sometimes the resulting binaries can contain insecure references in <code>RPATH</code>. This can be verified by running <a href="../en/Namcap.html" title="Namcap">Namcap</a> on the built package and consists in a security issue that should be fixed. There is a good chance to fix this by using the <code>CMAKE_SKIP_INSTALL_RPATH=YES</code> <b>or</b> <code>CMAKE_SKIP_RPATH=YES</code> CMake options. You need to experiment with both and see what will work in the software in question (using both options is not needed).
</p>
<div class="mw-heading mw-heading3"><h3 id="Getting_all_available_CMake_options">Getting all available CMake options</h3></div>
<p>For getting all "visible" CMake options that are available for a software project, execute <code>cmake -LAH</code> in the source tree (where the main <code>CMakeLists.txt</code> file is located).
</p>
<p>If you want to save the output for later reference, you can redirect it to a file:
</p>
<pre>$ cmake -LAH &gt;options.txt 2&gt;&amp;1
</pre>
<div class="mw-heading mw-heading3"><h3 id="Avoiding_FetchContent_downloads_during_the_build">Avoiding FetchContent downloads during the build</h3></div>
<p>CMake provides the <a rel="nofollow" class="external text" href="https://cmake.org/cmake/help/latest/module/FetchContent.html">FetchContent</a> module that allows fetching additional resources or subprojects at build-time. However, ideally all sources should be fetched by <a href="../en/Makepkg.html" title="Makepkg">makepkg</a> prior to the build, as they are specified in the <code>sources</code> array. This can be accomplished via the option <a rel="nofollow" class="external text" href="https://cmake.org/cmake/help/latest/module/FetchContent.html#variable:FETCHCONTENT_SOURCE_DIR_%3CuppercaseName%3E">FETCHCONTENT_SOURCE_DIR_&lt;uppercaseName&gt;</a>, which allows specifying the path to the files that would otherwise be fetched. Additionally, <a rel="nofollow" class="external text" href="https://cmake.org/cmake/help/latest/module/FetchContent.html#variable:FETCHCONTENT_FULLY_DISCONNECTED">FETCHCONTENT_FULLY_DISCONNECTED=ON</a> can be used to skip all downloads during the build, even if you missed any <code>FetchContent</code> declarations.
</p>
<div class="mw-heading mw-heading4"><h4 id="Example">Example</h4></div>
<p>Assume a project fetches the resource <code>foo</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">CMakeLists.txt</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">FetchContent_Declare(
    foo
    URL https://example.com/foo.tar.gz
    URL_HASH SHA256=cf051bf611a94884ba5e4c2d03932d14e83875c5b77f0fdf55c404cad0e4a6e6
)
FetchContent_MakeAvailable(foo)
</pre>
<p>Then, instead of downloading it during the build, this resource can be added to the <code>sources</code> array and declared when generating the build files:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">PKGBUILD</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">sources=(
    ...
    "https://example.com/foo.tar.gz"
)

sha256sums=(
    ...
    "cf051bf611a94884ba5e4c2d03932d14e83875c5b77f0fdf55c404cad0e4a6e6"
)
</pre>
<pre>$ cmake -B build -S "$pkgname-$pkgver" -DFETCHCONTENT_FULLY_DISCONNECTED=ON -DFETCHCONTENT_SOURCE_DIR_FOO="$srcdir/foo"
</pre>
<div class="mw-heading mw-heading2"><h2 id="Template">Template</h2></div>
<p>Here is a general template for the <code>build()</code> function that serves as a starting point for CMake-based packages. Supposing the package is C and C++ based and that it does not define any required compiler flags for the <code>Release</code> build type in the CMake files.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> The check function will only work if projects use <code>enable_testing()</code> and/or <code>add_test()</code> functionality in <code>CMakeLists.txt</code>.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">PKGBUILD</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">build() {
  local cmake_options=(
    -B build
    -S $pkgname-$pkgver
    -W no-dev
    -D CMAKE_BUILD_TYPE=None
    -D CMAKE_INSTALL_PREFIX=/usr
  )
  cmake "${cmake_options[@]}"
  cmake --build build
}

check() {
  local excluded_tests=""
  local ctest_flags=(
    --test-dir build
    # show the stdout and stderr when the test fails
    --output-on-failure
    # execute tests in parallel
    --parallel $(nproc)
    # exclude problematic tests
    --exclude-regex "$excluded_tests"
  )
  ctest "${ctest_flags[@]}"
}

package() {
  DESTDIR="$pkgdir" cmake --install build
}</pre>
<p>Do not forget to place <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=cmake">cmake</a></span> in <a href="../en/PKGBUILD.html#makedepends" class="mw-redirect" title="Makedepends">makedepends</a>.
</p>
<div class="mw-heading mw-heading2"><h2 id="Example_packages">Example packages</h2></div>
<ul>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=i2pd">i2pd</a></span></li>
<li><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libmysofa">libmysofa</a></span></li>
</ul>
<div class="mw-heading mw-heading2"><h2 id="See_also">See also</h2></div>
<ul>
<li><a rel="nofollow" class="external text" href="https://cmake.org/documentation/">CMake documentation</a></li>
<li><a rel="nofollow" class="external text" href="https://cmake.org/cmake/help/latest/">Documentation reference for the latest version</a></li>
<li><a href="https://en.wikipedia.org/wiki/CMake" class="extiw" title="wikipedia:CMake">Wikipedia article</a></li>
<li><span class="plainlinks archwiki-template-man" title="$ man 1 cmake"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cmake.1">cmake(1)</a></span></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Arch_package_guidelines.html" title="Category:Arch package guidelines">Arch package guidelines</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=CMake_package_guidelines&amp;oldid=823701">https://wiki.archlinux.org/index.php?title=CMake_package_guidelines&amp;oldid=823701</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 23 December 2024, at 08:14.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container no-font-mode-scale">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue  vector-search-box-show-thumbnail vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search cdx-typeahead-search--show-thumbnail">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input mw-searchInput" autocomplete="off" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true"><span class="mw-page-title-main">CMake package guidelines</span></div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only reading-lists-bookmark" id="ca-bookmark-sticky-header" tabindex="-1" data-event-name="watch-sticky-bookmark"><span class="vector-icon mw-ui-icon-wikimedia-bookmarkOutline mw-ui-icon-wikimedia-wikimedia-bookmarkOutline"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
