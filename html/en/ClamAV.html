<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>ClamAV - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-ClamAV rootpage-ClamAV skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Updating_database" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Updating_database">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Updating database</div>
		</a>
		
		<ul id="toc-Updating_database-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Starting_the_daemon" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Starting_the_daemon">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Starting the daemon</div>
		</a>
		
		<ul id="toc-Starting_the_daemon-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Testing_the_software" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Testing_the_software">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Testing the software</div>
		</a>
		
		<ul id="toc-Testing_the_software-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Adding_more_databases/signatures_repositories" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Adding_more_databases/signatures_repositories">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Adding more databases/signatures repositories</div>
		</a>
		
			<button aria-controls="toc-Adding_more_databases/signatures_repositories-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Adding more databases/signatures repositories subsection</span>
			</button>
		
		<ul id="toc-Adding_more_databases/signatures_repositories-sublist" class="vector-toc-list">
			<li id="toc-Option_#1:_Set_up_Fangfrisch" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Option_#1:_Set_up_Fangfrisch">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Option #1: Set up Fangfrisch</div>
			</a>
			
			<ul id="toc-Option_#1:_Set_up_Fangfrisch-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Option_#2:_Set_up_clamav-unofficial-sigs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Option_#2:_Set_up_clamav-unofficial-sigs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Option #2: Set up clamav-unofficial-sigs</div>
			</a>
			
			<ul id="toc-Option_#2:_Set_up_clamav-unofficial-sigs-sublist" class="vector-toc-list">
				<li id="toc-MalwarePatrol_database" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#MalwarePatrol_database">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.1</span>MalwarePatrol database</div>
			</a>
			
			<ul id="toc-MalwarePatrol_database-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Scan_for_viruses" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Scan_for_viruses">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Scan for viruses</div>
		</a>
		
			<button aria-controls="toc-Scan_for_viruses-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Scan for viruses subsection</span>
			</button>
		
		<ul id="toc-Scan_for_viruses-sublist" class="vector-toc-list">
			<li id="toc-using_the_stand-alone_scanner" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#using_the_stand-alone_scanner">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>using the stand-alone scanner</div>
			</a>
			
			<ul id="toc-using_the_stand-alone_scanner-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-using_the_daemon" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#using_the_daemon">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2</span>using the daemon</div>
			</a>
			
			<ul id="toc-using_the_daemon-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Using_the_milter" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Using_the_milter">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Using the milter</div>
		</a>
		
		<ul id="toc-Using_the_milter-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-OnAccessScan" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#OnAccessScan">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>OnAccessScan</div>
		</a>
		
		<ul id="toc-OnAccessScan-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">9</span>Tips and tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Run_in_multiple_threads" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Run_in_multiple_threads">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.1</span>Run in multiple threads</div>
			</a>
			
			<ul id="toc-Run_in_multiple_threads-sublist" class="vector-toc-list">
				<li id="toc-Using_clamscan" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Using_clamscan">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.1.1</span>Using clamscan</div>
			</a>
			
			<ul id="toc-Using_clamscan-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_clamdscan" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Using_clamdscan">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.1.2</span>Using clamdscan</div>
			</a>
			
			<ul id="toc-Using_clamdscan-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Enable_TCPSocket" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Enable_TCPSocket">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">9.1.3</span>Enable TCPSocket</div>
			</a>
			
			<ul id="toc-Enable_TCPSocket-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">10</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Error:_Clamd_was_NOT_notified" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Error:_Clamd_was_NOT_notified">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">10.1</span>Error: Clamd was NOT notified</div>
			</a>
			
			<ul id="toc-Error:_Clamd_was_NOT_notified-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Error:_No_supported_database_files_found" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Error:_No_supported_database_files_found">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">10.2</span>Error: No supported database files found</div>
			</a>
			
			<ul id="toc-Error:_No_supported_database_files_found-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Error:_Can't_create_temporary_directory" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Error:_Can't_create_temporary_directory">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">10.3</span>Error: Can't create temporary directory</div>
			</a>
			
			<ul id="toc-Error:_Can't_create_temporary_directory-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">11</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">ClamAV</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 7 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-7" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">7 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-de mw-list-item"><a href="https://wiki.archlinux.de/title/ClamAV" title="ClamAV – Deutsch" lang="de" hreflang="de" class="interlanguage-link-target"><span>Deutsch</span></a></li>
<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/ClamAV.html" title="ClamAV – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-fr mw-list-item"><a href="../fr/ClamAV.html" title="ClamAV – français" lang="fr" hreflang="fr" class="interlanguage-link-target"><span>Français</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/ClamAV" title="ClamAV – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ko mw-list-item"><a href="../ko/ClamAV.html" title="ClamAV – 한국어" lang="ko" hreflang="ko" class="interlanguage-link-target"><span>한국어</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/ClamAV.html" title="ClamAV – português" lang="pt" hreflang="pt" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/ClamAV.html" title="ClamAV – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><a rel="nofollow" class="external text" href="https://www.clamav.net">Clam AntiVirus</a> is an open source (GPL) anti-virus toolkit for UNIX.  It provides a number of utilities including a flexible and scalable multi-threaded daemon, a command line scanner and advanced tool for automatic database updates. Because ClamAV's main use is on file/mail servers for Windows desktops, it primarily detects Windows viruses and malware with its built-in signatures.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=clamav">clamav</a></span> package.
</p>
<h2><span class="mw-headline" id="Updating_database">Updating database</span></h2>
<p>Update the virus definitions with:
</p>
<pre># freshclam
</pre>
<p>If you are behind a proxy, edit <code>/etc/clamav/freshclam.conf</code> and update HTTPProxyServer, HTTPProxyPort, HTTPProxyUsername and HTTPProxyPassword.
</p>
<p>The database files are saved in:
</p>
<pre>/var/lib/clamav/daily.cld
/var/lib/clamav/main.cld
/var/lib/clamav/bytecode.cvd
</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">Start/enable</a> <code>clamav-freshclam.service</code> or <code>clamav-freshclam-once.timer</code> so that the virus definitions are kept recent.
</p>
<p>The <code>clamav-freshclam.service</code> launches <code>freshclam</code> in daemon mode, defaulting to 12 checks per day (every 2 hours). The frequency can be changed in <code>/etc/clamav/freshclam.conf</code>.
</p>
<p>The <code>clamav-freshclam-once.timer</code> launches the <code>freshclam</code> check once per day. The frequency can be changed in <code>/usr/lib/systemd/system/clamav-freshclam-once.timer</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>Freshclam in daemon mode checks on every (service) start.</li>
<li>Over 1 check per hour results in being blocked by the CDN for 24 hours.</li>
<li>The <code>.timer</code> unit follows the set schedule, regardless of reboots or service restarts.</li>
</ul>
</div>
<h2><span class="mw-headline" id="Starting_the_daemon">Starting the daemon</span></h2>
<p>This will load all virus signatures in RAM. As of February 2024 these signatures require at least 1.6GB of free RAM. Twice that amount of RAM is used shortly, during the periodic update of the signatures.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>You will need to run <code>freshclam</code> before starting the service for the first time or you will run into trouble/errors which will prevent ClamAV from starting correctly.</li>
<li>The daemon is not needed if you only want to perform stand-alone scans. See <a href="#Scan_for_viruses">Scan for viruses</a> below.</li>
</ul>
</div>
<p>The service is called <code>clamav-daemon.service</code>. <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> it and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> it to start at boot.
</p>
<h2><span class="mw-headline" id="Testing_the_software">Testing the software</span></h2>
<p>In order to make sure ClamAV and the definitions are installed correctly, scan the <a rel="nofollow" class="external text" href="https://www.eicar.org/download-anti-malware-testfile/">EICAR test file</a> (a harmless signature with no virus code) with <i>clamscan</i>.
</p>
<pre>$ curl <a rel="nofollow" class="external free" href="https://secure.eicar.org/eicar.com.txt">https://secure.eicar.org/eicar.com.txt</a> | clamscan -
</pre>
<p>The output <b>must</b> include:
</p>
<pre>stdin: Win.Test.EICAR_HDB-1 FOUND
</pre>
<p>Otherwise; read the Troubleshooting part or ask for help in the <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/">Arch Forums</a>.
</p>
<h2>
<span id="Adding_more_databases.2Fsignatures_repositories"></span><span class="mw-headline" id="Adding_more_databases/signatures_repositories">Adding more databases/signatures repositories</span>
</h2>
<p>ClamAV can use databases/signature from other repositories or security vendors. 
</p>
<p>To add the most important ones in a single step, install either <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/clamav-unofficial-sigs/">clamav-unofficial-sigs</a></span><sup><small>AUR</small></sup> (see <a rel="nofollow" class="external text" href="https://github.com/extremeshok/clamav-unofficial-sigs#description">GitHub description</a>) or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/python-fangfrisch/">python-fangfrisch</a></span><sup><small>AUR</small></sup> (see <a rel="nofollow" class="external text" href="https://rseichter.github.io/fangfrisch/">online documentation</a>). Both will add signatures/databases from popular providers, e.g. MalwarePatrol, SecuriteInfo, Yara, Linux Malware Detect, etc.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> You still must have the <code>clamav-freshclam.service</code> <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Started">started</a> in order to have official signature updates from ClamAV mirrors.</div>
<h3>
<span id="Option_.231:_Set_up_Fangfrisch"></span><span class="mw-headline" id="Option_#1:_Set_up_Fangfrisch">Option #1: Set up Fangfrisch</span>
</h3>
<p><a rel="nofollow" class="external text" href="https://rseichter.github.io/fangfrisch/">Fangfrisch</a> was designed as a more secure, flexible and convenient replacement for clamav-unofficial-sigs, and requires <a rel="nofollow" class="external text" href="https://rseichter.github.io/fangfrisch/#_configuration">very little configuration</a> (<code>/etc/fangfrisch/fangfrisch.conf</code>).
</p>
<p>Most importantly, Fangfrisch never needs to be run with root permissions, unlike clamav-unofficial-sigs.
</p>
<p>Create database structure by running:
</p>
<pre># sudo -u clamav /usr/bin/fangfrisch --conf /etc/fangfrisch/fangfrisch.conf initdb
</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">Enable</a> the <code>fangfrisch.timer</code> (system-level).
</p>
<h3>
<span id="Option_.232:_Set_up_clamav-unofficial-sigs"></span><span class="mw-headline" id="Option_#2:_Set_up_clamav-unofficial-sigs">Option #2: Set up clamav-unofficial-sigs</span>
</h3>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">Enable</a> the <code>clamav-unofficial-sigs.timer</code>.
</p>
<p>This will regularly update the unofficial signatures based on the configuration files in the directory <code>/etc/clamav-unofficial-sigs</code>.
</p>
<p>To update signatures manually, run the following:
</p>
<pre># clamav-unofficial-sigs.sh
</pre>
<p>To change any default settings, refer and modify <code>/etc/clamav-unofficial-sigs/user.conf</code>.
</p>
<h4><span class="mw-headline" id="MalwarePatrol_database">MalwarePatrol database</span></h4>
<p>If you would like to use the MalwarePatrol database, sign up for an account at <a rel="nofollow" class="external free" href="https://malwareblocklist.org/">https://malwareblocklist.org/</a> (for a fee).
</p>
<p>In <code>/etc/clamav-unofficial-sigs/user.conf</code>, change the following to enable this functionality:
</p>
<pre>malwarepatrol_receipt_code="YOUR-RECEIPT-NUMBER" # enter your receipt number here
malwarepatrol_product_code="8" # Use 8 if you have a Free account or 15 if you are a Premium customer.
malwarepatrol_list="clamav_basic" # clamav_basic or clamav_ext
malwarepatrol_free="yes" # Set to yes if you have a Free account or no if you are a Premium customer.
</pre>
<p>Source: <a rel="nofollow" class="external free" href="https://www.malwarepatrol.net/clamav-configuration-guide/">https://www.malwarepatrol.net/clamav-configuration-guide/</a>
</p>
<h2><span class="mw-headline" id="Scan_for_viruses">Scan for viruses</span></h2>
<p>There are two options for on-demand scanning:
</p>
<h3><span class="mw-headline" id="using_the_stand-alone_scanner">using the stand-alone scanner</span></h3>
<p><code>clamscan</code> can be used to scan certain files, home directories, or an entire system:
</p>
<pre>$ clamscan myfile
$ clamscan --recursive --infected /home/archie
# clamscan --recursive --infected --exclude-dir='^/sys|^/dev' /
</pre>
<p>If you would like <code>clamscan</code> to remove the infected file add to the command the <code>--remove</code> option, or you can use <code>--move=/dir</code> to quarantine them.
</p>
<p>You may also want <code>clamscan</code> to scan larger files. In this case, append the options <code>--max-filesize=4000M</code> and <code>--max-scansize=4000M</code> to the command. '4000M' is the largest possible value, and may be lowered as necessary.
</p>
<p>Using the <code>-l /path/to/file</code> option will print the <code>clamscan</code> logs to a text file for locating reported infections.
</p>
<h3><span class="mw-headline" id="using_the_daemon">using the daemon</span></h3>
<p><code>clamdscan</code> is similar to the above but utilizes the daemon, which must be running for the command to work. Most options are ignored since the daemon reads the settings specified in <code>/etc/clamav/clamd.conf</code>.
</p>
<h2><span class="mw-headline" id="Using_the_milter">Using the milter</span></h2>
<p>Milter will scan your sendmail server for email containing virus. Adjust <code>/etc/clamav/clamav-milter.conf</code> to your needs. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/clamav/clamav-milter.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">MilterSocket /tmp/clamav-milter.socket
MilterSocketMode 660
FixStaleSocket yes
User clamav
MilterSocketGroup clamav
PidFile /run/clamav/clamav-milter.pid
TemporaryDirectory /tmp
ClamdSocket unix:/run/clamav/clamd.ctl
LogSyslog yes
LogInfected Basic</pre>
<p>Create <code>/etc/systemd/system/clamav-milter.service</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/clamav-milter.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description='ClamAV Milter'
After=clamav-daemon.service

[Service]
Type=forking
ExecStart=/usr/bin/clamav-milter --config-file /etc/clamav/clamav-milter.conf

[Install]
WantedBy=multi-user.target</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">Enable</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> <code>clamav-milter.service</code>.
</p>
<p>For <a href="../en/Postfix.html" title="Postfix">Postfix</a> add the following lines to <code>/etc/postfix/main.cf</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/postfix/main.cf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">smtpd_milters = unix:/tmp/clamav-milter.socket
milter_default_action = tempfail</pre>
<p>Check <a href="../en/Systemd/Journal.html" class="mw-redirect" title="Journalctl">journalctl</a> if the permission to access <code>clamav-milter.socket</code> for postfix is set accordingly, if not, add user postfix to group <code>clamav</code>.
</p>
<h2><span class="mw-headline" id="OnAccessScan">OnAccessScan</span></h2>
<dl><dd><i>(Original source: <a rel="nofollow" class="external free" href="https://blog.clamav.net/2016/03/configuring-on-access-scanning-in-clamav.html">https://blog.clamav.net/2016/03/configuring-on-access-scanning-in-clamav.html</a>)</i></dd></dl>
<p>On-access scanning will scan the file while reading, writing or executing it.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong>  At this point (November 2021), on-access scanning in ClamAV is still immature, you might see unexplained <i>clamd</i> crashes, and containerized processes do not get the protection. Therefore, it is debatable whether it is a security improvement or not. Do not enable it unless regulations, contracts, or your own curiosity force you to do so.</div>
<p>On-access scanning requires the kernel to be compiled with the <i>fanotify</i> kernel module (kernel &gt;= 3.8), which is true for official Arch Linux kernel packages. Check if <i>fanotify</i> has been enabled before enabling on-access scanning.
</p>
<pre>$ zgrep FANOTIFY /proc/config.gz
</pre>
<p>First, edit the <code>/etc/clamav/clamd.conf</code> configuration file by adding the following to the end of the file (you can also change the individual options). 
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Please note the following warning about clamd port security if changing other parts of the file.  Generally use an local unix socket but note that this port is not authenticated or protected. See <a rel="nofollow" class="external free" href="https://docs.clamav.net/manual/Usage/Scanning.html#clamd-v0101">https://docs.clamav.net/manual/Usage/Scanning.html#clamd-v0101</a> for more details in the Daemon and then ClamD section.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/clamav/clamd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Set the mount point where to recursively perform the scan,
# this could be every path or multiple path (one line for path)
OnAccessMountPath /
OnAccessExcludePath /proc
OnAccessExcludePath /run
OnAccessExcludePath /sys

# Alternatively, add some directories instead of mount points
# OnAccessIncludePath /home

# Prevention doesn't work with OnAccessMountPath.
# It works with OnAccessIncludePath, as long as /usr and /etc are not included.
# Including /var while activating prevention is also not recommended, because
# this would slow down package installation by a factor of 1000.
OnAccessPrevention false

# Perform scans on newly created, moved, or renamed files
OnAccessExtraScanning true

# Exclude the UID of the scanner itself from checking, to prevent loops
OnAccessExcludeUname clamav

# Optionally, also exclude root-owned processes
# OnAccessExcludeRootUID true

# Specify an action to perform when clamav detects a malicious file
# it is possible to specify an inline command too
VirusEvent /etc/clamav/virus-event.bash

# WARNING: for security reasons, clamd should NEVER run as root.
# Previous instructions in this wiki included this line, remove it:
# User root    # REMOVE THIS
# Add this instead:
User clamav
</pre>
<p>Next, allow the <i>clamav</i> user to run <i>notify-send</i> as any user with custom environment variables via <a href="../en/Sudo.html" title="Sudo">sudo</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sudoers.d/clamav</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">clamav ALL = (ALL) NOPASSWD: SETENV: /usr/bin/notify-send</pre>
<p>Next, create the file <code>/etc/clamav/virus-event.bash</code>, make it <a href="../en/Help:Reading.html#Make_executable" class="mw-redirect" title="Executable">executable</a> and add the following: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/clamav/virus-event.bash</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/bash
PATH=/usr/bin
ALERT="Signature detected by clamav: $CLAM_VIRUSEVENT_VIRUSNAME in $CLAM_VIRUSEVENT_FILENAME"

# Send an alert to all graphical users.
for ADDRESS in /run/user/*; do
    USERID=${ADDRESS#/run/user/}
    /usr/bin/sudo -u "#$USERID" DBUS_SESSION_BUS_ADDRESS="unix:path=$ADDRESS/bus" PATH=${PATH} \
        /usr/bin/notify-send -i dialog-warning "Virus found!" "$ALERT"
done
</pre>
<p>This allows you to change/specify the message when a virus has been detected by clamd's on-access scanning service. 
</p>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Restart</a> the <code>clamav-daemon.service</code>.
</p>
<p>By default, <i>clamonacc</i> passes <i>clamav</i> the names of just-accessed files for scanning. This is a problem, because files inaccessible to the <i>clamav</i> user cannot be scanned this way. Instead, it is possible to instruct <i>clamonacc</i> (which always runs as <i>root</i>) to use file descriptor passing. <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">Edit</a> <code>clamav-clamonacc.service</code> with the following: 
</p>
<pre>[Service]
ExecStart=
ExecStart=/usr/sbin/clamonacc -F <b>--fdpass</b> --log=/var/log/clamav/clamonacc.log
</pre>
<p>Lastly, you will need to <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">start/enable</a> the <code>clamav-clamonacc.service</code>.
</p>
<p>If you get <a href="../en/AppArmor.html" title="AppArmor">AppArmor</a> denials about <i>clamd</i>, set the profile to a complain-only mode:
</p>
<pre># aa-complain clamd
</pre>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Run_in_multiple_threads">Run in multiple threads</span></h3>
<h4><span class="mw-headline" id="Using_clamscan">Using clamscan</span></h4>
<p>When scanning a file or directory from command line using <code>clamscan</code> only single CPU thread is used. This may be ok in cases when timing is not critical or you do not want computer to become sluggish. If there is a need to scan large directory or USB drive quickly you may want to use all available CPUs to speed up the process.
</p>
<p><code>clamscan</code> is designed to be single-threaded, so <code>xargs</code> can be used to run the scan in parallel:
</p>
<pre>$ find /home/archie -type f -print0 | xargs -0 -P $(nproc) clamscan
</pre>
<p>In this example the <code>-P</code> parameter for <code>xargs</code> runs <code>clamscan</code> in as many processes as there are CPUs (reported by <code>nproc</code>) at the same time. <code>--max-lines</code> and <code>--max-args</code> options will allow even finer control of batching the workload across the threads.
</p>
<p>This will consume loads of RAM as all processes are individual and will load the signature files. A single thread will consume around 1G (or more) of RAM, and may hang your computer unless OOM is clever enough. You may want to consider using clamdscan instead.
</p>
<h4><span class="mw-headline" id="Using_clamdscan">Using clamdscan</span></h4>
<p>If you already have <code>clamd</code> daemon running <code>clamdscan</code> can be used instead (see <a href="#Starting_the_daemon">#Starting the daemon</a>):
</p>
<pre>$ clamdscan --multiscan --fdpass /home/archie
</pre>
<p>Here the <code>--multiscan</code> parameter enables <code>clamd</code> to scan the contents of the directory in parallel using available threads. <code>--fdpass</code> parameter is required to pass the file descriptor permissions to <code>clamd</code> as the daemon is running under <code>clamav</code> user and group. 
</p>
<p>The number of available threads for <code>clamdscan</code> is determined in <code>/etc/clamav/clamd.conf</code> via <code>MaxThreads</code> parameter <span class="plainlinks archwiki-template-man" title="$ man 5 clamd.conf"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/clamd.conf.5">clamd.conf(5)</a></span>. Even though you may see that the number of <code>MaxThreads</code> specified is more than one (current default is 10), when you start the scan using <code>clamdscan</code> from command line and do not specify <code>--multiscan</code> option, only one effective CPU thread will be used for scanning.
</p>
<h4><span class="mw-headline" id="Enable_TCPSocket">Enable TCPSocket</span></h4>
<p>If you enable TCPSocket in <code>/etc/clamav/clamd.conf</code>, you must <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">edit</a> <code>clamav-daemon.socket</code> too (see <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/57669">FS#57669</a>). The <a href="../en/Systemd.html" title="Systemd">systemd</a> socket file needs to be configured with a matching port and IP address: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/clamav-daemon.socket.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Socket]
ListenStream=
ListenStream=/run/clamav/clamd.ctl
ListenStream=127.0.0.1:3310</pre>
<p>And finally <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>clamav-daemon.socket</code> to see a Clamd binding at TCP port 3310:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># ss -tulpn | grep clamd</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">tcp   LISTEN 0      4096       127.0.0.1:3310      0.0.0.0:*    users:(("clamd",pid=599,fd=4),("systemd",pid=1,fd=44))</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  Make sure the user from which you are running <code>clamscan</code> has read permissions for the database files (<code>/var/lib/clamav/*.c?d</code>)
</div>
<h3><span class="mw-headline" id="Error:_Clamd_was_NOT_notified">Error: Clamd was NOT notified</span></h3>
<p>If you get the following messages after running freshclam:
</p>
<pre>WARNING: Clamd was NOT notified: Cannot connect to clamd through 
/var/lib/clamav/clamd.sock connect(): No such file or directory
</pre>
<p>Add a sock file for ClamAV  
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong>  See the warning in <a href="#OnAccessScan">#OnAccessScan</a> about clamd port security:</div>
<pre># touch /run/clamav/clamd.ctl
# chown clamav:clamav /run/clamav/clamd.ctl
</pre>
<p>Then, edit <code>/etc/clamav/clamd.conf</code> - uncomment this line:
</p>
<pre>LocalSocket /run/clamav/clamd.ctl
</pre>
<p>Save the file and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> <code>clamav-daemon.service</code>.
</p>
<h3><span class="mw-headline" id="Error:_No_supported_database_files_found">Error: No supported database files found</span></h3>
<p>If you get the next error when starting the daemon:
</p>
<pre>LibClamAV Error: cli_loaddb(): No supported database files found
in /var/lib/clamav ERROR: Not supported data format
</pre>
<p>This happens because of mismatch between <code>/etc/clamav/freshclam.conf</code> setting <code>DatabaseDirectory</code> and <code>/etc/clamav/clamd.conf</code> setting <code>DatabaseDirectory</code>. <code>/etc/clamav/freshclam.conf</code> pointing to <code>/var/lib/clamav</code>, but <code>/etc/clamav/clamd.conf</code> (default directory) pointing to <code>/usr/share/clamav</code>, or other directory. Edit in <code>/etc/clamav/clamd.conf</code> and replace with the same <code>DatabaseDirectory</code> as in <code>/etc/clamav/freshclam.conf</code>. After that <i>clamav</i> will start up successfully.
</p>
<h3>
<span id="Error:_Can.27t_create_temporary_directory"></span><span class="mw-headline" id="Error:_Can't_create_temporary_directory">Error: Can't create temporary directory</span>
</h3>
<p>If you get the following error, along with a 'HINT' containing a UID and a GID number:
</p>
<pre># can't create temporary directory
</pre>
<p>Correct permissions:
</p>
<pre># chown UID:GID /var/lib/clamav &amp;&amp; chmod 755 /var/lib/clamav
</pre>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul><li><a href="https://en.wikipedia.org/wiki/ClamAV" class="extiw" title="wikipedia:ClamAV">Wikipedia:ClamAV</a></li></ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Security.html" title="Category:Security">Security</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=ClamAV&amp;oldid=811917">https://wiki.archlinux.org/index.php?title=ClamAV&amp;oldid=811917</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 4 July 2024, at 13:34.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
