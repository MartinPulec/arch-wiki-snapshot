<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>dm-crypt/Drive preparation - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.3">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Dm-crypt_Drive_preparation rootpage-Dm-crypt skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Secure_erasure_of_the_drive" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Secure_erasure_of_the_drive">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Secure erasure of the drive</div>
		</a>
		
			<button aria-controls="toc-Secure_erasure_of_the_drive-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Secure erasure of the drive subsection</span>
			</button>
		
		<ul id="toc-Secure_erasure_of_the_drive-sublist" class="vector-toc-list">
			<li id="toc-Generic_methods" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Generic_methods">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Generic methods</div>
			</a>
			
			<ul id="toc-Generic_methods-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-dm-crypt_specific_methods" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#dm-crypt_specific_methods">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>dm-crypt specific methods</div>
			</a>
			
			<ul id="toc-dm-crypt_specific_methods-sublist" class="vector-toc-list">
				<li id="toc-dm-crypt_wipe_on_an_empty_device_or_partition" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#dm-crypt_wipe_on_an_empty_device_or_partition">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2.1</span>dm-crypt wipe on an empty device or partition</div>
			</a>
			
			<ul id="toc-dm-crypt_wipe_on_an_empty_device_or_partition-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-dm-crypt_wipe_free_space_after_installation" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#dm-crypt_wipe_free_space_after_installation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2.2</span>dm-crypt wipe free space after installation</div>
			</a>
			
			<ul id="toc-dm-crypt_wipe_free_space_after_installation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-dm-crypt_wipe_free_space_after_installation_(via_re-encryption)" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#dm-crypt_wipe_free_space_after_installation_(via_re-encryption)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2.3</span>dm-crypt wipe free space after installation (via re-encryption)</div>
			</a>
			
			<ul id="toc-dm-crypt_wipe_free_space_after_installation_(via_re-encryption)-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Wipe_LUKS_header" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Wipe_LUKS_header">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Wipe LUKS header</div>
			</a>
			
			<ul id="toc-Wipe_LUKS_header-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Partitioning" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Partitioning">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Partitioning</div>
		</a>
		
			<button aria-controls="toc-Partitioning-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Partitioning subsection</span>
			</button>
		
		<ul id="toc-Partitioning-sublist" class="vector-toc-list">
			<li id="toc-Physical_partitions" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Physical_partitions">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Physical partitions</div>
			</a>
			
			<ul id="toc-Physical_partitions-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Stacked_block_devices" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Stacked_block_devices">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Stacked block devices</div>
			</a>
			
			<ul id="toc-Stacked_block_devices-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Btrfs_subvolumes" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Btrfs_subvolumes">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Btrfs subvolumes</div>
			</a>
			
			<ul id="toc-Btrfs_subvolumes-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Boot_partition_(GRUB)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Boot_partition_(GRUB)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4</span>Boot partition (GRUB)</div>
			</a>
			
			<ul id="toc-Boot_partition_(GRUB)-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">dm-crypt/Drive preparation</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 5 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-5" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">5 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-es mw-list-item"><a href="../../es/Dm-crypt/Drive_preparation.html" title="Dm-crypt (Español)/Drive preparation – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Dm-crypt/%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96%E3%81%AE%E6%BA%96%E5%82%99" title="Dm-crypt/ドライブの準備 – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pl mw-list-item"><a href="../../pl/Dm-crypt/Drive_preparation.html" title="Dm-crypt (Polski)/Drive preparation – polski" lang="pl" hreflang="pl" class="interlanguage-link-target"><span>Polski</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../../pt/Dm-crypt/Drive_preparation.html" title="Dm-crypt (Português)/Drive preparation – português" lang="pt" hreflang="pt" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Dm-crypt/Drive_preparation" title="Dm-crypt/Drive preparation – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <a href="../../en/Dm-crypt.html" title="Dm-crypt">Dm-crypt</a>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../../en/Data-at-rest_encryption.html#Preparing_the_disk" title="Data-at-rest encryption">Data-at-rest encryption#Preparing the disk</a></li>
<li><a href="../../en/Securely_wipe_disk.html" title="Securely wipe disk">Securely wipe disk</a></li>
</ul>
</div>
<p>Before encrypting a drive, it is recommended to perform a secure erase by overwriting the entire device with random data. To prevent cryptographic attacks or unwanted <a href="../../en/File_recovery.html" title="File recovery">file recovery</a>, this data is ideally indistinguishable from data later written by dm-crypt. For a more comprehensive discussion see <a href="../../en/Data-at-rest_encryption.html#Preparing_the_disk" title="Data-at-rest encryption">Data-at-rest encryption#Preparing the disk</a>.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Secure_erasure_of_the_drive">Secure erasure of the drive</span></h2>
<p>In deciding which method to use for secure erasure of a drive, remember that this needs only to be performed once for as long as the drive is continuously used as an encrypted device.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> 
<ul>
<li>Make appropriate backups of valuable data prior to starting!</li>
<li>Do not overwrite an <a href="../../en/Solid_state_drive.html" class="mw-redirect" title="SSD">SSD</a> with random data if you plan to <a href="../../en/Dm-crypt/Specialties.html#Discard/TRIM_support_for_solid_state_drives_(SSD)" title="Dm-crypt/Specialties">use TRIM</a>. Unused blocks will be marked as empty after the first TRIM and eventually erased thus undoing your performed actions.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> When wiping large amount of data, the process will take several hours to several days to complete.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>Check that your Advanced Format drives are using the <a href="../../en/Advanced_Format.html" title="Advanced Format">optimal logical sector size</a> before proceeding.</li>
<li>The process of filling an encrypted drive can take over a day to complete on a multi-terabyte device. In order not to leave the machine unusable during the operation, it may be worth to do it from a system already installed on another drive, rather than from the live Arch installation system.</li>
<li>For <a href="../../en/Solid_state_drive.html" class="mw-redirect" title="SSD">SSDs</a>, as a best effort to minimize <a href="../../en/Securely_wipe_disk.html#Flash_memory" title="Securely wipe disk">flash memory</a> cache artifacts, consider performing a <a href="../../en/Solid_state_drive/Memory_cell_clearing.html" class="mw-redirect" title="SSD memory cell clearing">SSD memory cell clearing</a> <i>prior</i> to instructions below.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Generic_methods">Generic methods</span></h3>
<p>For detailed instructions on how to erase and prepare a drive consult <a href="../../en/Securely_wipe_disk.html" title="Securely wipe disk">Securely wipe disk</a>.
</p>
<h3><span class="mw-headline" id="dm-crypt_specific_methods">dm-crypt specific methods</span></h3>
<p>The following two methods are specific for dm-crypt and are mentioned because they are very fast and can be performed after a partition setup too. 
</p>
<p>The <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions#2-setup">cryptsetup FAQ</a> (item 2.19 "<i>How can I wipe a device with crypto-grade randomness?</i>") mentions a very simple procedure to use an existing dm-crypt-volume to wipe all free space accessible on the underlying block device with random data by acting as a simple pseudorandom number generator. It is also claimed to protect against disclosure of usage patterns. That is because encrypted data is practically indistinguishable from random.
</p>
<h4><span class="mw-headline" id="dm-crypt_wipe_on_an_empty_device_or_partition">dm-crypt wipe on an empty device or partition</span></h4>
<p>First, create a temporary encrypted container on the partition (using the form <code>sdXY</code>) or complete device (using the form <code>sdX</code>) to be encrypted:
</p>
<pre># cryptsetup open --type plain --key-file /dev/urandom --sector-size 4096 /dev/<i>block-device</i> to_be_wiped
</pre>
<p>You can verify that it exists:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># lsblk</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">NAME          MAJ:MIN RM  SIZE RO TYPE  MOUNTPOINT
sda             8:0    0  1.8T  0 disk
└─to_be_wiped 252:0    0  1.8T  0 crypt
</pre>
<p>Wipe the container with zeros. A use of <code>if=/dev/urandom</code> is not required as the encryption cipher is used for randomness.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># dd if=/dev/zero of=/dev/mapper/to_be_wiped status=progress bs=1M</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dd: writing to ‘/dev/mapper/to_be_wiped’: No space left on device</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> To perform a check of the operation, zero the partition before creating the wipe container. After the wipe command <code>blockdev --getsize64 <i>/dev/mapper/container</i></code> can be used to get the exact container size as root. After the container has been closed <i>od</i> can be used to spotcheck whether the wipe overwrote the zeroed sectors. For example, <code># od -j $((<i>containersize - blocksize</i>)) /dev/nvme0n1</code> to view the wipe completed to the end.</div> 
<p>Finally, close the temporary container:
</p>
<pre># cryptsetup close to_be_wiped
</pre>
<p>When encrypting an entire system, the next step is <a href="#Partitioning">#Partitioning</a>. If just encrypting a partition, continue <a href="../../en/Dm-crypt/Encrypting_a_non-root_file_system.html#Partition" title="Dm-crypt/Encrypting a non-root file system">dm-crypt/Encrypting a non-root file system#Partition</a>.
</p>
<h4><span class="mw-headline" id="dm-crypt_wipe_free_space_after_installation">dm-crypt wipe free space after installation</span></h4>
<p>Users who did not have time for the wipe procedure before <a href="../../en/Dm-crypt/Encrypting_an_entire_system.html" title="Dm-crypt/Encrypting an entire system">installation</a>, can achieve a similar effect once the encrypted system is booted and the filesystems are mounted. However, consider if the concerned filesystem may have set up reserved space, e.g. for the root user, or another <a href="../../en/Disk_quota.html" title="Disk quota">disk quota</a> mechanism, that that may limit the wipe even when performed by the root user: some parts of the underlying block device might not get written to at all.
</p>
<p>To execute the wipe, temporarily fill the remaining free space of the partition by writing to a file inside the encrypted container:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># dd if=/dev/zero of=/file/in/container status=progress</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dd: writing to ‘/file/in/container’: No space left on device</pre>
<p>Sync the cache to disk and then delete the file to reclaim the free space.
</p>
<pre># sync
# rm /file/in/container
</pre>
<p>The above process has to be repeated for every partition blockdevice created and filesystem in it. For example, setting-up <a href="../../en/Dm-crypt/Encrypting_an_entire_system.html#LVM_on_LUKS" title="Dm-crypt/Encrypting an entire system">LVM on LUKS</a>, the process has to be performed for every logical volume.
</p>
<h4>
<span id="dm-crypt_wipe_free_space_after_installation_.28via_re-encryption.29"></span><span class="mw-headline" id="dm-crypt_wipe_free_space_after_installation_(via_re-encryption)">dm-crypt wipe free space after installation (via re-encryption)</span>
</h4>
<p>Alternatively, for users who want to completely wipe free space without re-installation, this can be achieved by <a href="../../en/Dm-crypt/Device_encryption.html#Re-encrypting_devices" title="Dm-crypt/Device encryption">re-encrypting LUKS devices</a>. It needs to be performed once per LUKS device. But please note that this process can be slower (e.g ~50MB/s on a desktop HDD).
</p>
<h3><span class="mw-headline" id="Wipe_LUKS_header">Wipe LUKS header</span></h3>
<p>A partition using LUKS consists of two parts: the header and the encrypted data. The header contains keys and cryptographic parameters without which it is practically impossible to recover the data. If creating a new partition or decommissioning the drive it <i>may</i> be sufficient to remove that part instead of wiping the whole device. For caveats see the paragraph at the end of this subsection.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The operation is irreversible, so be careful.</div>
<p>To erase all keys use the following command:
</p>
<pre># cryptsetup erase <i>device</i>
</pre>
<p>Make sure there is no active slots left by invoking:
</p>
<pre># cryptsetup luksDump <i>device</i>
</pre>
<p>Additionally the LUKS header itself may be removed to prevent <code>cryptsetup</code> from detecting it in the future, by invoking <a href="../../en/Device_file.html#wipefs" class="mw-redirect" title="Wipefs">wipefs</a> after the keys are erased:
</p>
<pre># wipefs -a <i>device</i>
</pre>
<p>The encrypted data remains in place. As of 2020 there is no known practical way of decrypting the data, but that may change in the future. It is up to the user to weight security and privacy against the time needed to perform a proper wiping of the entire drive.
</p>
<p>On some storage media, in particular flash-based, it may be impossible to reliably overwrite data. The LUKS header with keys may remain stored in a location inaccessible to the operating system (e.g. a drive-cache). If that is a concern, <a href="../../en/Securely_wipe_disk.html#hdparm" class="mw-redirect" title="Securely Wipe HDD">ATA Secure Erase</a> must be used. The operation is supposed to erase all blocks on the device, including those not visible to software. See <a rel="nofollow" class="external text" href="https://gitlab.com/cryptsetup/cryptsetup/wikis/FrequentlyAskedQuestions#5-security-aspects">cryptsetup FAQ 5.19</a> for details.
</p>
<h2><span class="mw-headline" id="Partitioning">Partitioning</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you plan to use <a href="../../en/Self-encrypting_drives.html#Using_cryptsetup" title="Self-encrypting drives">OPAL hardware encryption</a> and have not previously set an OPAL admin password for the drive, you will need to erase all data on the drive with <span class="plainlinks archwiki-template-man" title="$ man 8 cryptsetup-erase"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/cryptsetup-erase.8">cryptsetup-erase(8)</a></span> to be able to create a new OPAL admin password. Follow the instructions in <a href="../../en/Self-encrypting_drives.html#Secure_disk_erasure" title="Self-encrypting drives">Self-encrypting drives#Secure disk erasure</a> to perform the erase before partitioning.</div>
<p>This section only applies when encrypting an entire system. After the drive(s) has/have been securely overwritten, a proper partitioning scheme will have to be accurately chosen, taking into account the requirements of dm-crypt, and the effects that the various choices will have on the management of the resulting system.
</p>
<p>It is important to note from now that in <a href="#Boot_partition_(GRUB)">almost</a> every case there has to be a separate partition for <code>/boot</code> that must remain unencrypted, because the bootloader needs to access the <code>/boot</code> directory where it will load the initramfs/encryption modules needed to load the rest of the system (see <a href="../../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a> for details). If this raises security concerns, see <a href="../../en/Dm-crypt/Specialties.html#Securing_the_unencrypted_boot_partition" title="Dm-crypt/Specialties">dm-crypt/Specialties#Securing the unencrypted boot partition</a>.
</p>
<p>Another important factor to take into account is how the swap area and system suspension will be handled, see <a href="../../en/Dm-crypt/Swap_encryption.html" title="Dm-crypt/Swap encryption">dm-crypt/Swap encryption</a>.
</p>
<h3><span class="mw-headline" id="Physical_partitions">Physical partitions</span></h3>
<p>In the simplest case, the encrypted layers can be based directly on the physical partitions; see <a href="../../en/Partitioning.html" title="Partitioning">Partitioning</a> for the methods to create them. Just like in an unencrypted system, a root partition is sufficient, besides another for <code>/boot</code> as noted above. This method allows deciding which partitions to encrypt and which to leave unencrypted, and works the same regardless of the number of disks involved. It will also be possible to add or remove partitions in the future, but resizing a partition will be limited by the size of the disk that is hosting it. Finally note that separate passphrases or keys are required to open each encrypted partition, even though this can be automated during boot using the <code>crypttab</code> file, see <a href="../../en/Dm-crypt/System_configuration.html#crypttab" title="Dm-crypt/System configuration">Dm-crypt/System configuration#crypttab</a>.
</p>
<h3><span class="mw-headline" id="Stacked_block_devices">Stacked block devices</span></h3>
<p>If more flexibility is needed, though, dm-crypt can coexist with other stacked block devices like <a href="../../en/LVM.html" title="LVM">LVM</a> and <a href="../../en/RAID.html" title="RAID">RAID</a>. The encrypted containers can either reside below or on top of other stacked block devices:
</p>
<ul>
<li>If the LVM/RAID devices are created on top of the encrypted layer, it will be possible to add, remove and resize the file systems of the same encrypted partition liberally, and only one key or passphrase will be required for all of them. Since the encrypted layer resides on a physical partition, though, it will not be possible to exploit the ability of LVM and RAID to span multiple disks.</li>
<li>If the encrypted layer is created on top of LVM/RAID devices, it will still be possible to reorganize the file systems in the future, but with added complexity, since the encryption layers will have to be adjusted accordingly. Moreover, separate passphrases or keys will be required to open each encrypted device. This, however, is the only choice for systems that need encrypted file systems to span multiple disks.</li>
</ul>
<h3><span class="mw-headline" id="Btrfs_subvolumes">Btrfs subvolumes</span></h3>
<p><a href="../../en/Btrfs.html" title="Btrfs">Btrfs</a>'s built-in <a href="../../en/Btrfs.html#Subvolumes" title="Btrfs">subvolumes feature</a> can be used with dm-crypt, fully replacing the need for LVM if no other file systems are required.
</p>
<h3>
<span id="Boot_partition_.28GRUB.29"></span><span class="mw-headline" id="Boot_partition_(GRUB)">Boot partition (GRUB)</span>
</h3>
<p>See <a href="../../en/Dm-crypt/Encrypting_an_entire_system.html#Encrypted_boot_partition_(GRUB)" title="Dm-crypt/Encrypting an entire system">dm-crypt/Encrypting an entire system#Encrypted boot partition (GRUB)</a>.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../en/Category:Data-at-rest_encryption.html" title="Category:Data-at-rest encryption">Data-at-rest encryption</a></li></ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Dm-crypt/Drive_preparation&amp;oldid=817810">https://wiki.archlinux.org/index.php?title=Dm-crypt/Drive_preparation&amp;oldid=817810</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 5 October 2024, at 09:15.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
