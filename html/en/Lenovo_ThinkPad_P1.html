<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Lenovo ThinkPad P1 - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.4">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Lenovo_ThinkPad_P1 rootpage-Lenovo_ThinkPad_P1 skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
			<button aria-controls="toc-Installation-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Installation subsection</span>
			</button>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
			<li id='toc-Do_not_change_to_"Discrete_Graphics"_with_BIOS_v1.15' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#Do_not_change_to_"Discrete_Graphics"_with_BIOS_v1.15'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Do not change to "Discrete Graphics" with BIOS v1.15</div>
			</a>
			
			<ul id='toc-Do_not_change_to_"Discrete_Graphics"_with_BIOS_v1.15-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Firmware_update" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Firmware_update">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Firmware update</div>
			</a>
			
			<ul id="toc-Firmware_update-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Installation_with_hybrid_graphics" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Installation_with_hybrid_graphics">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.3</span>Installation with hybrid graphics</div>
			</a>
			
			<ul id="toc-Installation_with_hybrid_graphics-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-HiDPI_screen" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#HiDPI_screen">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.4</span>HiDPI screen</div>
			</a>
			
			<ul id="toc-HiDPI_screen-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Graphics" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Graphics">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Graphics</div>
		</a>
		
			<button aria-controls="toc-Graphics-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Graphics subsection</span>
			</button>
		
		<ul id="toc-Graphics-sublist" class="vector-toc-list">
			<li id="toc-Discrete_only" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Discrete_only">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Discrete only</div>
			</a>
			
			<ul id="toc-Discrete_only-sublist" class="vector-toc-list">
				<li id="toc-Black_screen_after_X_starts_with_NVIDIA_drivers" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Black_screen_after_X_starts_with_NVIDIA_drivers">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1.1</span>Black screen after X starts with NVIDIA drivers</div>
			</a>
			
			<ul id="toc-Black_screen_after_X_starts_with_NVIDIA_drivers-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Hybrid_graphics_with_Reverse_PRIME" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Hybrid_graphics_with_Reverse_PRIME">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Hybrid graphics with Reverse PRIME</div>
			</a>
			
			<ul id="toc-Hybrid_graphics_with_Reverse_PRIME-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Hybrid_graphics_with_Bumblebee" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Hybrid_graphics_with_Bumblebee">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Hybrid graphics with Bumblebee</div>
			</a>
			
			<ul id="toc-Hybrid_graphics_with_Bumblebee-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Hybrid_graphics_with_bbswitch_only" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Hybrid_graphics_with_bbswitch_only">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.4</span>Hybrid graphics with bbswitch only</div>
			</a>
			
			<ul id="toc-Hybrid_graphics_with_bbswitch_only-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-xbacklight_not_adjusting_screen_brightness" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#xbacklight_not_adjusting_screen_brightness">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>xbacklight not adjusting screen brightness</div>
			</a>
			
			<ul id="toc-xbacklight_not_adjusting_screen_brightness-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-System_hangs_on_startup/shutdown" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#System_hangs_on_startup/shutdown">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>System hangs on startup/shutdown</div>
			</a>
			
			<ul id="toc-System_hangs_on_startup/shutdown-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Lenovo ThinkPad P1</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Lenovo_ThinkPad_P1" title="Lenovo ThinkPad P1 – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section does not follow the <a href="../en/Help:Laptop_page_guidelines.html" title="Help:Laptop page guidelines">Laptop page guidelines</a>.</b></p>
<div>
<b>Reason:</b> Stub (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Lenovo_ThinkPad_P1.html">Talk:Lenovo ThinkPad P1</a>)</div>
</div>
<p>Lenovo ThinkPad P1 was released in 2018 and has up to Intel Core i7-8850H or Xeon E-2176M 6-core processor, up to 64 GB DDR4 RAM, and up to NVIDIA Quadro P2000 graphics.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The ThinkPad X1 Extreme is a consumer version of the same laptop which uses extremely similar hardware. Most of the information from <a href="../en/Lenovo_ThinkPad_X1_Extreme.html" title="Lenovo ThinkPad X1 Extreme">Lenovo ThinkPad X1 Extreme</a> should be applicable to P1 models as well.</div>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<h3>
<span id="Do_not_change_to_.22Discrete_Graphics.22_with_BIOS_v1.15"></span><span class="mw-headline" id='Do_not_change_to_"Discrete_Graphics"_with_BIOS_v1.15'>Do not change to "Discrete Graphics" with BIOS v1.15</span>
</h3>
<p><a rel="nofollow" class="external free" href="https://www.reddit.com/r/thinkpad/comments/a2g0k4/warning_do_not_change_from_hybrid_graphics_to/">https://www.reddit.com/r/thinkpad/comments/a2g0k4/warning_do_not_change_from_hybrid_graphics_to/</a>
</p>
<p>This might potentially brick your device and require Lenovo to replace your motherboard.
Apparently verified on BIOS v1.15 and still not resolved.
</p>
<p>You will want to use BIOS v1.18 or newer.  BIOS v1.17 (released Dec 24, 2018) originally fixed the issue for the mass majority; however, this version has been removed due to additional bricking issues that happen occasionally related to the Hybrid graphics options when changed.
</p>
<h3><span class="mw-headline" id="Firmware_update">Firmware update</span></h3>
<p>Before installation, it is recommended that you boot into Windows 10 and use the preinstalled Lenovo Vantage software to install any necessary firmware updates, particularly <a rel="nofollow" class="external text" href="https://pcsupport.lenovo.com/us/en/products/LAPTOPS-AND-NETBOOKS/THINKPAD-P-SERIES-LAPTOPS/THINKPAD-P1-TYPE-20MD-20ME/downloads/DS504958">this one</a>.
</p>
<h3><span class="mw-headline" id="Installation_with_hybrid_graphics">Installation with hybrid graphics</span></h3>
<p>Currently the live CD might not boot normally if your BIOS is configured to enable hybrid graphics. See <a href="../en/NVIDIA_Optimus.html" title="NVIDIA Optimus">NVIDIA Optimus</a> for details. Two options are possible:
</p>
<ul>
<li>Disable hybrid graphics by changing your BIOS settings to "Discrete only" (Be careful, this might brick your latpop: <a href='#Do_not_change_to_"Discrete_Graphics"_with_BIOS_v1.15'>#Do not change to "Discrete Graphics" with BIOS v1.15</a>)</li>
<li>Alternatively, before booting into live CD, press <code>e</code> and add <code>modprobe.blacklist=nouveau</code> to your kernel parameters.</li>
</ul>
<p>If you choose to use the second option, you might also want to include <code>modprobe.blacklist=nouveau</code> in your <code>/boot/loader/entries/arch.conf</code>.
</p>
<h3><span class="mw-headline" id="HiDPI_screen">HiDPI screen</span></h3>
<p>Some configurations of ThinkPad P1 comes with a HiDPI screen. See <a href="../en/HiDPI.html#Linux_console_(tty)" title="HiDPI">HiDPI#Linux console (tty)</a> for more details.
</p>
<h2><span class="mw-headline" id="Graphics">Graphics</span></h2>
<p>There are two difficulties with configuring graphics on ThinkPad P1: there is no "integrated graphics only" option in the BIOS, and the external display ports (HDMI, etc.) are wired into the NVIDIA chip. Depending on your needs, you might choose from the following options:
</p>
<h3><span class="mw-headline" id="Discrete_only">Discrete only</span></h3>
<p>As the P1 is an hybrid device with both an integrated and discrete video card, the NVIDIA drivers have to be setup to use Optimus in order to properly work with external outputs and the integrated laptop screen. Setup NVIDIA Optimus as instructed in <a href="../en/NVIDIA_Optimus.html#Use_NVIDIA_graphics_only" title="NVIDIA Optimus">NVIDIA Optimus#Use NVIDIA graphics only</a>.
Note that this method will keep your NVIDIA graphics card always on, which might dramatically shorten your battery life.
</p>
<h4><span class="mw-headline" id="Black_screen_after_X_starts_with_NVIDIA_drivers">Black screen after X starts with NVIDIA drivers</span></h4>
<p>Even if using Optimus, the driver might anyway fail to detect the laptop screen using the auto-generated <code>xorg.conf</code> file and you might experience a black screen after X has been started. See <a href="../en/NVIDIA_Optimus.html#No_screens_found_on_a_laptop/NVIDIA_Optimus" title="NVIDIA Optimus">NVIDIA Optimus#No screens found on a laptop/NVIDIA Optimus</a> for more details.
</p>
<p>If you are able to connect an external monitor and verify it works, you can inspect the <code>xrandr -q</code> output to verify only HDMI and Display Port outputs are actually detected. The <code></code> tool should as well display only external video output connections.
</p>
<p>In order to instruct the driver about the integrated laptop screen, the <code>xorg.conf</code> file has to be modified to add a <code>"ConnectedMonitor" Option</code> to the <code>Section "Device"</code> (see <a href="../en/NVIDIA/Troubleshooting.html#Screen(s)_found,_but_none_have_a_usable_configuration" title="NVIDIA/Troubleshooting">NVIDIA/Troubleshooting#Screen(s) found, but none have a usable configuration</a>)
</p>
<p>Use the following as <code>xorg.conf</code> <code>Section "Device"</code> 
</p>
<pre>  Section "Device"
      Identifier      "nvidia"
      Driver         "nvidia"
      VendorName     "NVIDIA Corporation"
      BusId          "1:0:0"
      Option         "AllowEmptyInitialConfiguration"
      Option	      "ConnectedMonitor" "eDP"
      Option	      "CustomEDID" "eDP:/sys/class/drm/card0-eDP-1/edid"
      Option	      "IgnoreEDID" "false"
      Option	      "UseEDID" "true" 
  EndSection
</pre>
<p>After re-starting X, the integrated screen output <code></code> should show be now detected and properly usable.
</p>
<p>If the laptop screen gets detected but <code>xrandr</code> fails to properly detect the available resolutions, remove the <code>HorizSync</code> and <code>Vertrefresh</code> options from <code>Section "Monitor"</code> and restart X
</p>
<h3><span class="mw-headline" id="Hybrid_graphics_with_Reverse_PRIME">Hybrid graphics with Reverse PRIME</span></h3>
<p>Set up <a href="../en/PRIME.html#Reverse_PRIME" title="PRIME">Reverse PRIME</a> to do the main rendering on the Intel chip, while still being able to use the external display outputs wired to the NVIDIA chip. Battery life should remain decent with this option.
</p>
<h3><span class="mw-headline" id="Hybrid_graphics_with_Bumblebee">Hybrid graphics with Bumblebee</span></h3>
<p>See <a href="../en/Bumblebee.html" title="Bumblebee">Bumblebee</a> for detailed instructions. If Xorg refuses to start after setting up Bumblebee, try generating an Xorg configuration by running <code>Xorg -configure</code> and copy it to <code>/etc/X11/xorg.conf</code>.
</p>
<p>Because Bumblebee normally disables the NVIDIA card, display outputs such as HDMI might not show up in <code>xrandr -q</code>. You may want to refer to <a rel="nofollow" class="external text" href="https://github.com/Bumblebee-Project/Bumblebee/wiki/Multi-monitor-setup">Bumblebee's multi-monitor setup page</a>.
</p>
<h3><span class="mw-headline" id="Hybrid_graphics_with_bbswitch_only">Hybrid graphics with bbswitch only</span></h3>
<p>This method requires manual switching between integrated and discrete graphics mode. Switching between them requires restarting all Xorg instances, although it does not require a restart.
</p>
<p>Install the appropriate <a href="../en/NVIDIA.html" title="NVIDIA">NVIDIA</a> graphics drivers and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=bbswitch">bbswitch</a></span>. Generate an Xorg configuration by running <code>Xorg -configure</code> and copy it to <code>/etc/X11/xorg.conf.intel</code>. You may also create <code>/etc/X11/xorg.conf.nvidia</code>, though it should not be necessary.
</p>
<p>After loading the module with
</p>
<pre># modprobe bbswitch
</pre>
<p>you can switch to discrete graphics with the following Bash function:
</p>
<pre>discrete() {
    killall Xorg
    modprobe nvidia_drm
    modprobe nvidia_modeset
    modprobe nvidia
    tee /proc/acpi/bbswitch &lt;&lt;&lt;ON
    cp /etc/X11/xorg.conf.nvidia /etc/X11/xorg.conf
}
</pre>
<p>After this, <code>xrandr -q</code> should correctly show <code>HDMI-0</code> as one of the outputs. Running <code>xrandr --auto</code> will mirror the display on an external monitor. If you want to extend your display with a different DPI, adapt the following command to your needs:
</p>
<pre>$ xrandr --output HDMI-0 --scale 2x2 --right-of eDP-1-1
</pre>
<p>Conversely, you can switch to integrated graphics this way:
</p>
<pre>integrated() {
    killall Xorg
    rmmod nvidia_drm
    rmmod nvidia_modeset
    rmmod nvidia
    tee /proc/acpi/bbswitch &lt;&lt;&lt;OFF
    cp /etc/X11/xorg.conf.intel /etc/X11/xorg.conf
}
</pre>
<p>You need to manually start your X session after switching.
</p>
<p>If you are also running <a href="../en/TLP.html" title="TLP">TLP</a>, to prevent TLP from blocking system startup or shutdown, you should tell it to leave NVIDIA card alone by uncommenting the following line:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/default/tlp</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">RUNTIME_PM_DRIVER_DENYLIST="amdgpu nouveau nvidia radeon"</pre>
<p>You may also want to refer to <a href="../en/Nvidia-xrun.html" title="Nvidia-xrun">nvidia-xrun</a>, which allows for running a separate X session with NVIDIA graphics.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="xbacklight_not_adjusting_screen_brightness">xbacklight not adjusting screen brightness</span></h3>
<p>Installing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/light/">light</a></span><sup><small>AUR</small></sup> should help.
</p>
<h3>
<span id="System_hangs_on_startup.2Fshutdown"></span><span class="mw-headline" id="System_hangs_on_startup/shutdown">System hangs on startup/shutdown</span>
</h3>
<p>If you are using hybrid graphics, ensure that your TLP is correctly blacklisting NVIDIA drivers by uncommenting this line:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/default/tlp</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">RUNTIME_PM_DRIVER_DENYLIST="amdgpu nouveau nvidia radeon"</pre>
<p>Also make sure that the NVIDIA card is turned on before shutdown by running:
</p>
<pre># modprobe nvidia
</pre>
<p>You can install systemd services to manage this automatically as as follows: 
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/nvidia-enable-power-off.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Enable NVIDIA card at shutdown
DefaultDependencies=no

[Service]
Type=oneshot
ExecStart=/bin/sh -c "awk '{print $2}' /proc/acpi/bbswitch &gt; /tmp/gpu_state &amp;&amp; echo ON &gt; /proc/acpi/bbswitch"
#ExecStart=/usr/bin/modprobe nvidia

[Install]
WantedBy=shutdown.target
WantedBy=reboot.target
WantedBy=hibernate.target
WantedBy=suspend-then-hibernate.target
WantedBy=sleep.target
WantedBy=suspend.target
</pre>
<p>And a service to disable the card again at resume if it was originally off:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/nvidia-disable-resume.service</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Unit]
Description=Disable NVIDIA card at system resume
DefaultDependencies=no
After=sleep.target
After=suspend.target
After=suspend-then-hibernate.target
After=hibernate.target

[Service]
Type=oneshot
ExecStart=/bin/sh -c 'cat /tmp/gpu_state &gt; /proc/acpi/bbswitch || echo OFF &gt; /proc/acpi/bbswitch'
#ExecStart=/usr/bin/rmmod nvidia

[Install]
#WantedBy=shutdown.target
#WantedBy=reboot.target
WantedBy=sleep.target
WantedBy=suspend.target
WantedBy=suspend-then-hibernate.target
WantedBy=hibernate.target
</pre>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Lenovo.html" title="Category:Lenovo">Lenovo</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Laptop_style.html" title="Category:Pages or sections flagged with Template:Laptop style">Pages or sections flagged with Template:Laptop style</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Lenovo_ThinkPad_P1&amp;oldid=805362">https://wiki.archlinux.org/index.php?title=Lenovo_ThinkPad_P1&amp;oldid=805362</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 5 April 2024, at 15:35.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
