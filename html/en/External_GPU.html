<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>External GPU - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-External_GPU rootpage-External_GPU skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
			<button aria-controls="toc-Installation-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Installation subsection</span>
			</button>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
			<li id="toc-Thunderbolt" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Thunderbolt">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Thunderbolt</div>
			</a>
			
			<ul id="toc-Thunderbolt-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Drivers" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Drivers">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>Drivers</div>
			</a>
			
			<ul id="toc-Drivers-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Compute-only_workloads" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Compute-only_workloads">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Compute-only workloads</div>
		</a>
		
		<ul id="toc-Compute-only_workloads-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Xorg" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Xorg">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Xorg</div>
		</a>
		
			<button aria-controls="toc-Xorg-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Xorg subsection</span>
			</button>
		
		<ul id="toc-Xorg-sublist" class="vector-toc-list">
			<li id="toc-Xorg_rendered_on_eGPU,_PRIME_display_offload_to_iGPU" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Xorg_rendered_on_eGPU,_PRIME_display_offload_to_iGPU">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Xorg rendered on eGPU, PRIME display offload to iGPU</div>
			</a>
			
			<ul id="toc-Xorg_rendered_on_eGPU,_PRIME_display_offload_to_iGPU-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Xorg_rendered_on_iGPU,_PRIME_render_offload_to_eGPU" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Xorg_rendered_on_iGPU,_PRIME_render_offload_to_eGPU">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Xorg rendered on iGPU, PRIME render offload to eGPU</div>
			</a>
			
			<ul id="toc-Xorg_rendered_on_iGPU,_PRIME_render_offload_to_eGPU-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Separate_Xorg_instance_for_eGPU" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Separate_Xorg_instance_for_eGPU">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Separate Xorg instance for eGPU</div>
			</a>
			
			<ul id="toc-Separate_Xorg_instance_for_eGPU-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Known_issues_with_eGPUs_on_Xorg" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Known_issues_with_eGPUs_on_Xorg">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4</span>Known issues with eGPUs on Xorg</div>
			</a>
			
			<ul id="toc-Known_issues_with_eGPUs_on_Xorg-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Wayland" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Wayland">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Wayland</div>
		</a>
		
			<button aria-controls="toc-Wayland-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Wayland subsection</span>
			</button>
		
		<ul id="toc-Wayland-sublist" class="vector-toc-list">
			<li id="toc-Hotpluging_Nvidia_eGPU" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Hotpluging_Nvidia_eGPU">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>Hotpluging Nvidia eGPU</div>
			</a>
			
			<ul id="toc-Hotpluging_Nvidia_eGPU-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Hotpluging_Nvidia_eGPU_and_temporarily_disabling_Nvidia_dGPU" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Hotpluging_Nvidia_eGPU_and_temporarily_disabling_Nvidia_dGPU">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>Hotpluging Nvidia eGPU and temporarily disabling Nvidia dGPU</div>
			</a>
			
			<ul id="toc-Hotpluging_Nvidia_eGPU_and_temporarily_disabling_Nvidia_dGPU-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">External GPU</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 2 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-2" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">2 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/%E5%A4%96%E4%BB%98%E3%81%91_GPU" title="外付け GPU – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/%E5%A4%96%E6%8E%A5%E6%98%BE%E5%8D%A1" title="外接显卡 – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Xorg.html" title="Xorg">Xorg</a></li>
<li><a href="../en/PRIME.html" title="PRIME">PRIME</a></li>
<li><a href="../en/Thunderbolt.html" title="Thunderbolt">Thunderbolt</a></li>
<li><a href="../en/NVIDIA_Optimus.html" title="NVIDIA Optimus">NVIDIA Optimus</a></li>
<li><a href="../en/NVIDIA/Tips_and_tricks.html" title="NVIDIA/Tips and tricks">NVIDIA/Tips and tricks</a></li>
<li><a href="../en/Docking.html" title="Docking">Docking</a></li>
</ul>
</div>
<p>On computers equipped with <a href="https://en.wikipedia.org/wiki/Thunderbolt_(interface)#Thunderbolt_3" class="extiw" title="wikipedia:Thunderbolt (interface)">Thunderbolt 3+</a> or <a href="https://en.wikipedia.org/wiki/USB4" class="extiw" title="wikipedia:USB4">USB4</a>, it is possible to attach a desktop-grade external graphics card (eGPU) using a GPU enclosure. <a rel="nofollow" class="external text" href="https://egpu.io/">eGPU.io</a> is a good resource with buyer's guide and a community forum. While some manual configuration (shown below) is needed for most modes of operation, Linux support for eGPUs is generally good.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> For USB4 laptops the data rate is specified to be at minimum 20 Gbit/s and optionally superior (40, 80, or more ). When using a Thunderbolt enclosure it is a good idea to ensure the laptop USB4 implementation supports the same data rate.</div>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<h3><span class="mw-headline" id="Thunderbolt">Thunderbolt</span></h3>
<p>The eGPU enclosure Thunderbolt device may need to be authorized first after plugging in (based on your BIOS/UEFI Firmware configuration). Follow <a href="../en/Thunderbolt.html#User_device_authorization" title="Thunderbolt">Thunderbolt#User device authorization</a>. If successful, the external graphics card should show up in <code>lspci</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ lspci | grep -E 'VGA|3D'</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">00:02.0 VGA compatible controller: Intel Corporation UHD Graphics 620 (rev 07)             # internal GPU
1a:10.3 VGA compatible controller: NVIDIA Corporation GP107 [GeForce GTX 1050] (rev a1)    # external GPU
</pre>
<p>Depending on your computer, its firmware and enclosure firmware, Thunderbolt will limit host &lt;-&gt; eGPU bandwidth to some extent due to <a rel="nofollow" class="external text" href="https://egpu.io/best-laptops-external-gpu/#pcie">the number of PCIe lanes and OPI Mode</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># dmesg | grep PCIe</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[19888.928225] pci 0000:1a:10.3: 8.000 Gb/s available PCIe bandwidth, limited by 2.5 GT/s PCIe x4 link at 0000:05:01.0 (capable of 126.016 Gb/s with 8.0 GT/s PCIe x16 link)
</pre>
<h3><span class="mw-headline" id="Drivers">Drivers</span></h3>
<p>A driver compatible with your GPU model should be installed:
</p>
<ul>
<li><a href="../en/AMDGPU.html" title="AMDGPU">AMDGPU</a></li>
<li>
<a href="../en/NVIDIA.html" title="NVIDIA">NVIDIA</a> proprietary Nvidia drivers</li>
<li>
<a href="../en/Nouveau.html" title="Nouveau">Nouveau</a> open-source Nvidia drivers</li>
</ul>
<p>If installed successfully, <code>lspci -k</code> should show that a driver has been associated with your card:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ lspci -k</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">1a:10.3 VGA compatible controller: NVIDIA Corporation GP107 [GeForce GTX 1050] (rev a1)
        Subsystem: NVIDIA Corporation GP107 [GeForce GTX 1050]
        Kernel driver in use: nvidia
        Kernel modules: nouveau, nvidia_drm, nvidia
</pre>
<p>Note that the AMDGPU driver (with either Thunderbolt or USB4) might in some cases set the wrong <i>pcie_gen_cap</i> option and fall back to PCIe gen 1.1 speed, with possibly serious performance issues.
In this case the proper value can be set as module option (see <a href="../en/Kernel_module.html#Using_files_in_/etc/modprobe.d/" title="Kernel module">Kernel module#Using files in /etc/modprobe.d/</a>) or even passed as <a href="../en/Kernel_parameters.html" title="Kernel parameters">Kernel parameters</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/modprobe.d/amd-egpu-pcie-speed.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">options amdgpu pcie_gen_cap=0x40000
</pre>
<p>This will set PCIe gen 3 speed. A full list of options can be found in <a rel="nofollow" class="external text" href="https://github.com/torvalds/linux/blob/master/drivers/gpu/drm/amd/include/amd_pcie.h#L26">amd_pcie.h</a>.
</p>
<h2><span class="mw-headline" id="Compute-only_workloads">Compute-only workloads</span></h2>
<p>Right after completing <a href="#Installation">installation steps</a>, compute-only workloads like <a href="../en/GPGPU.html#CUDA" title="GPGPU">GPGPU#CUDA</a> that do not need to display anything should work without any extra configuration. The <i>nvidia-smi</i> utility (provided by the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nvidia-utils">nvidia-utils</a></span> package) should work with the proprietary NVIDIA driver. Proprietary <a href="https://en.wikipedia.org/wiki/Nvidia_NVENC" class="extiw" title="wikipedia:Nvidia NVENC">Nvidia NVENC/NVDEC</a> should work (without OpenGL interop).
</p>
<p>This use-case should also support full hotplug. Hot-unplug should be also possible (probably depending on drivers used). On Nvidia, active <code>nvidia-persistenced</code> is expected to prevent clean hot-unplug.
</p>
<h2><span class="mw-headline" id="Xorg">Xorg</span></h2>
<p>Multiple setups combining internal (iGPU) and external (eGPU) cards are possible, each with own advantages and disadvantages.
</p>
<h3>
<span id="Xorg_rendered_on_eGPU.2C_PRIME_display_offload_to_iGPU"></span><span class="mw-headline" id="Xorg_rendered_on_eGPU,_PRIME_display_offload_to_iGPU">Xorg rendered on eGPU, PRIME display offload to iGPU</span>
</h3>
<ul>
<li>Most programs that make use of GPU run out-of-the-box on eGPU: <code>glxinfo</code>/<code>glxgears</code>, <code>eglinfo</code>/<code>eglgears_x11</code>, <code>NVENC</code>/<code>NVDEC</code> (including OpenGL interop).</li>
<li>Xorg only starts with the eGPU plugged in.</li>
<li>Monitors attached to eGPU work out-of-the-box, PRIME <i>display</i> offload can be used for monitors attached to iGPU (i.e. internal laptop screen).</li>
</ul>
<p>Main articles are <a href="../en/PRIME.html#Discrete_card_as_primary_GPU" title="PRIME">PRIME#Discrete card as primary GPU</a> and <a href="../en/PRIME.html#Reverse_PRIME" title="PRIME">PRIME#Reverse PRIME</a>. Also documented in NVIDIA driver docs <a rel="nofollow" class="external text" href="http://us.download.nvidia.com/XFree86/Linux-x86_64/465.27/README/randr14.html">Chapter 33. Offloading Graphics Display with RandR 1.4</a>.
</p>
<p>Use Xorg configuration snippet like this one:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/X11/xorg.conf.d/80-egpu-primary-igpu-offload.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Section "Device"
    Identifier "Device0"
    Driver     "nvidia"
    BusID      "PCI:26:16:3"                 # Edit according to lspci, translate from hex to decimal.
    Option     "AllowExternalGpus" "True"    # Required for proprietary NVIDIA driver.
EndSection

Section "Module"
    # Load modesetting module for the iGPU, which should show up in XrandR 1.4 as a provider.
    Load "modesetting"
EndSection
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Xorg uses decimal bus IDs, while most other tools use hexadecimal. We had to convert <code>1a:10.3</code> to <code>26:16:3</code> for <code>xorg.conf</code> snippet.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> With modern Xorg, it is not needed to specify <code>ServerLayout</code> and <code>Screen</code> sections, as these are inferred automatically. First <code>Device</code> defined will be considered primary.</div>
<p>To <b>validate</b> this setup, use <code>xrandr --listproviders</code>, which should display
</p>
<pre>Providers: number : 2
Provider 0: id: 0x1b8 cap: 0x1, Source Output crtcs: 4 outputs: 4 associated providers: 0 name:NVIDIA-0
Provider 1: id: 0x1f3 cap: 0xf, Source Output, Sink Output, Source Offload, Sink Offload crtcs: 3 outputs: 5 associated providers: 0 name:modesetting
</pre>
<p>To <b>output to internal laptop screen and/or other monitors attached to iGPU</b>, RandR 1.4 PRIME <i>display</i> offload can be used, using names from above <code>xrandr --listproviders</code> output:
</p>
<pre>xrandr --setprovideroutputsource modesetting NVIDIA-0 &amp;&amp; xrandr --auto</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The <code>xrandr --auto</code> is optional and may be substituted by any RandR-based display configuration tool. Its presence prevents all-screens-black situation.</div>
<p>You may want to run this command before a display manager shows login propmt or before desktop environment starts, see <a href="../en/Xrandr.html#Configuration" title="Xrandr">Xrandr#Configuration</a> and <a href="../en/Xinit.html" title="Xinit">Xinit</a>.
</p>
<p><a href="../en/Vulkan.html" title="Vulkan">Vulkan</a> may enumerate GPUs independently of Xorg, so in order to run for example <code>vkcube</code> in this setup, one may need to pass <code>--gpu_number 1</code> option. Alternatively, a layer to reorder GPUs during enumeration can be activated with the same effect: <code>__NV_PRIME_RENDER_OFFLOAD=1 vkcube</code> or equivalently <code>prime-run vkcube</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If using <i>optimus-manager</i> on a laptop, you can render on eGPU by adding the <code>BusId</code> of the eGPU in the appropriate file for your mode and graphics card in <code>/etc/optimus-manager/xorg/</code>.</div>
<h3>
<span id="Xorg_rendered_on_iGPU.2C_PRIME_render_offload_to_eGPU"></span><span class="mw-headline" id="Xorg_rendered_on_iGPU,_PRIME_render_offload_to_eGPU">Xorg rendered on iGPU, PRIME render offload to eGPU</span>
</h3>
<ul>
<li>Programs are rendered on iGPU by default, but PRIME <i>render</i> offload can be used to render them on eGPU.</li>
<li>Xorg starts even with eGPU disconnected, but render/display offload will not work until it is restarted.</li>
<li>Monitors attached to iGPU (i.e. internal laptop screen) work out-of-the-box, PRIME <i>display</i> offload can be used for monitors attached to eGPU.</li>
</ul>
<p>Main article is <a href="../en/PRIME.html#PRIME_GPU_offloading" title="PRIME">PRIME#PRIME GPU offloading</a>. Also documented in NVIDIA driver docs <a rel="nofollow" class="external text" href="http://us.download.nvidia.com/XFree86/Linux-x86_64/465.27/README/primerenderoffload.html">Chapter 34. PRIME Render Offload</a>.
</p>
<p>With many discrete GPU drivers, this mode should be the default without any manual Xorg configuration. If that does not work, or if you use proprietary NVIDIA drivers, use the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/X11/xorg.conf.d/80-igpu-primary-egpu-offload.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Section "Device"
    Identifier "Device0"
    Driver     "modesetting"
EndSection

Section "Device"
    Identifier "Device1"
    Driver     "nvidia"
    BusID      "PCI:26:16:3"                 # Edit according to lspci, translate from hex to decimal.
    Option     "AllowExternalGpus" "True"    # Required for proprietary NVIDIA driver.
EndSection
</pre>
<p>To <b>validate</b> this setup, use <code>xrandr --listproviders</code>, which should display
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ xrandr --listproviders</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Providers: number : 2
Provider 0: id: 0x47 cap: 0xf, Source Output, Sink Output, Source Offload, Sink Offload crtcs: 3 outputs: 5 associated providers: 0 name:modesetting
Provider 1: id: 0x24a cap: 0x2, Sink Output crtcs: 4 outputs: 4 associated providers: 0 name:NVIDIA-G0
</pre>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Merge-arrows-2.svg" decoding="async" width="36" height="40" class="mw-file-element"></span></span><b>This article or section is a candidate for merging with <a href="../en/PRIME.html#Configure_applications_to_render_using_GPU" title="PRIME">PRIME#Configure applications to render using GPU</a>.</b></p>
<div>
<b>Notes:</b> We should link to the dedicated page for these variables instead of duplicating them here. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:External_GPU.html">Talk:External GPU</a>)</div>
</div>
<p>To <b>render</b> <code><i>some_program</i></code> <b>on the eGPU</b>, PRIME <i>render</i> offload can be used:
</p>
<ul>
<li>for proprietary NVIDIA drivers: <pre>$ __NV_PRIME_RENDER_OFFLOAD=1 __VK_LAYER_NV_optimus=NVIDIA_only __GLX_VENDOR_LIBRARY_NAME=nvidia <i>some_program</i></pre>
</li>
<li>for proprietary NVIDIA drivers (convenience wrapper): <pre>$ prime-run <i>some_program</i></pre>
</li>
<li>for open-source drivers: <pre>$ DRI_PRIME=1 <i>some_program</i></pre>
</li>
</ul>
<p>To <b>output to monitors connected to eGPU</b>, RandR 1.4 PRIME <i>display</i> offload can be again used:
</p>
<pre>$ xrandr --setprovideroutputsource NVIDIA-G0 modesetting &amp;&amp; xrandr --auto
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The order of providers is different, and the Nvidia the has a slightly different name this time.</div>
<p>NVIDIA drivers 460.27.04+ <a rel="nofollow" class="external text" href="https://forums.developer.nvidia.com/t/linux-solaris-and-freebsd-driver-460-27-04-beta/163730">implement an optimization for a special case of combined render and display offloads</a>: 
</p>
<dl><dd>Added support for “Reverse PRIME Bypass”, an optimization that bypasses the bandwidth overhead of PRIME Render Offload and PRIME Display Offload in conditions where a render offload application is fullscreen, unredirected, and visible only on a given NVIDIA-driven PRIME Display Offload output. Use of the optimization is reported in the X log when verbose logging is enabled in the X server.</dd></dl>
<h3><span class="mw-headline" id="Separate_Xorg_instance_for_eGPU">Separate Xorg instance for eGPU</span></h3>
<p>Main article is <a href="../en/Nvidia-xrun.html#External_GPU_setup" title="Nvidia-xrun">Nvidia-xrun#External GPU setup</a>.
</p>
<h3><span class="mw-headline" id="Known_issues_with_eGPUs_on_Xorg">Known issues with eGPUs on Xorg</span></h3>
<ul>
<li>hotplug is not supported with most discrete GPU Xorg drivers: the eGPU needs to be plugged in when Xorg starts. Logging out and in again should suffice to restart Xorg.</li>
<li>hot-unplug is not supported at all: doing so leads to system instability or outright freezes (as acknowledged in the <a rel="nofollow" class="external text" href="https://us.download.nvidia.com/XFree86/Linux-x86_64/465.27/README/egpu.html">Nvidia docs</a>).</li>
</ul>
<h2><span class="mw-headline" id="Wayland">Wayland</span></h2>
<p>Wayland support for eGPUs (or multiple GPUs in general) is much less tested, but should work with even less manual configuration.
</p>
<p>Note that there need to be explicit GPU hotplug support by the Wayland compositor, but most already have some level of support:
</p>
<ul>
<li>KDE's kwin: <a rel="nofollow" class="external free" href="https://invent.kde.org/plasma/kwin/-/merge_requests/811">https://invent.kde.org/plasma/kwin/-/merge_requests/811</a>
</li>
<li>GNOME's Mutter: <a rel="nofollow" class="external free" href="https://gitlab.gnome.org/GNOME/mutter/-/issues/17">https://gitlab.gnome.org/GNOME/mutter/-/issues/17</a>, <a rel="nofollow" class="external free" href="https://gitlab.gnome.org/GNOME/mutter/-/merge_requests/1562">https://gitlab.gnome.org/GNOME/mutter/-/merge_requests/1562</a>
</li>
<li>wl-roots: <a rel="nofollow" class="external free" href="https://gitlab.freedesktop.org/wlroots/wlroots/-/issues/1278">https://gitlab.freedesktop.org/wlroots/wlroots/-/issues/1278</a>
</li>
</ul>
<p>For open-source drivers, DRI offloading works fine:
</p>
<pre>$ DRI_PRIME=1 <i>some_program</i>
</pre>
<p>Some projects, such as <a rel="nofollow" class="external text" href="https://github.com/ewagner12/all-ways-egpu/wiki">all-ways-egpu</a>, are trying to provide more efficient methods for GPU selection under Wayland.
</p>
<h3><span class="mw-headline" id="Hotpluging_Nvidia_eGPU">Hotpluging Nvidia eGPU</span></h3>
<p>It is possible to hotplug eGPU when using Wayland, and use PRIME feature. Nvidia already has great implementation of PRIME for dGPUs, and it is working same way for eGPU.
</p>
<p>First you need to make sure that no program uses Nvidia modules. EGL programs tend to use 1MB dGPU memory per program, even if they run on iGPU, and it can be seen in <code>nvidia-smi</code>. To avoid this, add <code>__EGL_VENDOR_LIBRARY_FILENAMES=/usr/share/glvnd/egl_vendor.d/50_mesa.json</code> as <a href="../en/Environment_variables.html" class="mw-redirect" title="Environment variable">environment variable</a>. Best place for that is <code>/etc/environment.d/50_mesa.conf</code>.
</p>
<p>Then you unload Nvidia modules:
</p>
<pre># rmmod nvidia_uvm
# rmmod nvidia_drm
# rmmod nvidia_modeset
# rmmod nvidia
</pre>
<p>When Nvidia modules is no longer loaded, you can connect external GPU. When GPU is initialized, load Nvidia modules again with <code>modprobe nvidia-drm</code> command or <code>modprobe nvidia-current-drm</code>. Naming depends on source of modules, either it is drivers from Nvidia website or from package manager. In some cases (for example, for GIGABYTE AORUS GAMING BOX) eGPU does not work with proprietary modules, so you might need to load open-source ones: <code>modprobe nvidia-current-open-drm</code>.
</p>
<p>When modules successfully loaded, prime feature will work, but since we set <code>__EGL_VENDOR_LIBRARY_FILENAMES</code> variable to use MESA, we need to add <code>__EGL_VENDOR_LIBRARY_FILENAMES=/usr/share/glvnd/egl_vendor.d/10_nvidia.json</code> before starting program. Full string will look like:
</p>
<pre>__GLX_VENDOR_LIBRARY_NAME=nvidia __NV_PRIME_RENDER_OFFLOAD=1 __VK_LAYER_NV_optimus=NVIDIA_only __EGL_VENDOR_LIBRARY_FILENAMES=/usr/share/glvnd/egl_vendor.d/10_nvidia.json %command%
</pre>
<p>For Gnome users, you might need to patch <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=switcheroo-control">switcheroo-control</a></span> to include <code>__EGL_VENDOR_LIBRARY_FILENAMES</code> into list of environment variables. This will allow programs to run on eGPU naturally with right click and "Launch using Dedicated Graphics Card". But this is beyond scope of this article.
</p>
<h3><span class="mw-headline" id="Hotpluging_Nvidia_eGPU_and_temporarily_disabling_Nvidia_dGPU">Hotpluging Nvidia eGPU and temporarily disabling Nvidia dGPU</span></h3>
<p>In case you have iGPU, Nvidia dGPU and want to connect Nvidia eGPU, you will encounter a conflict, where graphics renders only on dGPU, no matter what you do. To solve this, you need to temporarily disable dGPU, so Nvidia driver will not notice it. Best way to do that is to override its driver.
</p>
<p>First, you need to unload Nvidia driver:
</p>
<pre># rmmod nvidia_uvm
# rmmod nvidia_drm
# rmmod nvidia_modeset
# rmmod nvidia
</pre>
<p>Then, you need to override dGPU driver with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/driverctl/">driverctl</a></span><sup><small>AUR</small></sup> utility. In this example, 0000:01:00.0 is address of dGPU. It can be found with <code>lspci</code> utility.
</p>
<pre># driverctl --nosave set-override 0000:01:00.0 vfio-pci
</pre>
<p>It is important to use <code>--nosave</code> parameter, to prevent driverctl to override driver on boot. It is useful in case something goes wrong, simple reboot cleans everything.
</p>
<p>When dGPU is disabled, you can load kernel modules with <code>modprobe nvidia-drm</code> and then check if <code>nvidia-smi</code> shows 1 or 2 GPUs.
</p>
<p>Bringing dGPU back is tricky, because it is unintuitive. First, unload Nvidia modules, unplug eGPU and then run this series of commands:
</p>
<pre># modprobe nvidia-current
# driverctl --nosave unset-override 0000:01:00.0
# modprobe nvidia-current
# driverctl --nosave unset-override 0000:01:00.0
# modprobe nvidia-current-modeset
# modprobe nvidia-current-drm
</pre>
<p>It is strange that we need to run first 2 commands twice, but otherwise it will not bring back dGPU. Command will error once, but it is not critical.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Graphics.html" title="Category:Graphics">Graphics</a></li>
<li><a href="../en/Category:X_server.html" title="Category:X server">X server</a></li>
</ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Merge.html" title="Category:Pages or sections flagged with Template:Merge">Pages or sections flagged with Template:Merge</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=External_GPU&amp;oldid=812654">https://wiki.archlinux.org/index.php?title=External_GPU&amp;oldid=812654</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 20 July 2024, at 07:33.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
