<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-os vector-sticky-header-enabled vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Snapper - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.44.2">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Snapper rootpage-Snapper skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Installation</span>
			</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Creating_a_new_configuration" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Creating_a_new_configuration">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Creating a new configuration</span>
			</div>
		</a>
		
		<ul id="toc-Creating_a_new_configuration-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Taking_snapshots" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Taking_snapshots">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Taking snapshots</span>
			</div>
		</a>
		
			<button aria-controls="toc-Taking_snapshots-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Taking snapshots subsection</span>
			</button>
		
		<ul id="toc-Taking_snapshots-sublist" class="vector-toc-list">
			<li id="toc-Automatic_timeline_snapshots" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Automatic_timeline_snapshots">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>Automatic timeline snapshots</span>
				</div>
			</a>
			
			<ul id="toc-Automatic_timeline_snapshots-sublist" class="vector-toc-list">
				<li id="toc-Enable/disable" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Enable/disable">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.1</span>
					<span>Enable/disable</span>
				</div>
			</a>
			
			<ul id="toc-Enable/disable-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Set_snapshot_limits" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Set_snapshot_limits">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.2</span>
					<span>Set snapshot limits</span>
				</div>
			</a>
			
			<ul id="toc-Set_snapshot_limits-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Change_snapshot_and_cleanup_frequencies" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Change_snapshot_and_cleanup_frequencies">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.3</span>
					<span>Change snapshot and cleanup frequencies</span>
				</div>
			</a>
			
			<ul id="toc-Change_snapshot_and_cleanup_frequencies-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Manual_snapshots" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Manual_snapshots">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2</span>
					<span>Manual snapshots</span>
				</div>
			</a>
			
			<ul id="toc-Manual_snapshots-sublist" class="vector-toc-list">
				<li id="toc-Single_snapshots" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Single_snapshots">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2.1</span>
					<span>Single snapshots</span>
				</div>
			</a>
			
			<ul id="toc-Single_snapshots-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Pre/post_snapshots" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Pre/post_snapshots">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.2.2</span>
					<span>Pre/post snapshots</span>
				</div>
			</a>
			
			<ul id="toc-Pre/post_snapshots-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Snapshots_on_boot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Snapshots_on_boot">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.3</span>
					<span>Snapshots on boot</span>
				</div>
			</a>
			
			<ul id="toc-Snapshots_on_boot-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Managing_snapshots" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Managing_snapshots">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Managing snapshots</span>
			</div>
		</a>
		
			<button aria-controls="toc-Managing_snapshots-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Managing snapshots subsection</span>
			</button>
		
		<ul id="toc-Managing_snapshots-sublist" class="vector-toc-list">
			<li id="toc-List_configurations" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#List_configurations">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.1</span>
					<span>List configurations</span>
				</div>
			</a>
			
			<ul id="toc-List_configurations-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-List_snapshots" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#List_snapshots">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.2</span>
					<span>List snapshots</span>
				</div>
			</a>
			
			<ul id="toc-List_snapshots-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Restore_snapshot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Restore_snapshot">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.3</span>
					<span>Restore snapshot</span>
				</div>
			</a>
			
			<ul id="toc-Restore_snapshot-sublist" class="vector-toc-list">
				<li id="toc-Filter_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Filter_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.3.1</span>
					<span>Filter configuration</span>
				</div>
			</a>
			
			<ul id="toc-Filter_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Restore_using_the_default_layout" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Restore_using_the_default_layout">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.3.2</span>
					<span>Restore using the default layout</span>
				</div>
			</a>
			
			<ul id="toc-Restore_using_the_default_layout-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Delete_a_snapshot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Delete_a_snapshot">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.4</span>
					<span>Delete a snapshot</span>
				</div>
			</a>
			
			<ul id="toc-Delete_a_snapshot-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Access_for_non-root_users" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Access_for_non-root_users">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">4.5</span>
					<span>Access for non-root users</span>
				</div>
			</a>
			
			<ul id="toc-Access_for_non-root_users-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>Tips and tricks</span>
			</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Using_Snapper_as_regular_user" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_Snapper_as_regular_user">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>Using Snapper as regular user</span>
				</div>
			</a>
			
			<ul id="toc-Using_Snapper_as_regular_user-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Wrapping_pacman_transactions_in_snapshots" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Wrapping_pacman_transactions_in_snapshots">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2</span>
					<span>Wrapping pacman transactions in snapshots</span>
				</div>
			</a>
			
			<ul id="toc-Wrapping_pacman_transactions_in_snapshots-sublist" class="vector-toc-list">
				<li id="toc-Booting_into_read-only_snapshots" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Booting_into_read-only_snapshots">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2.1</span>
					<span>Booting into read-only snapshots</span>
				</div>
			</a>
			
			<ul id="toc-Booting_into_read-only_snapshots-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Backup_non-Btrfs_boot_partition_on_pacman_transactions" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Backup_non-Btrfs_boot_partition_on_pacman_transactions">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2.2</span>
					<span>Backup non-Btrfs boot partition on pacman transactions</span>
				</div>
			</a>
			
			<ul id="toc-Backup_non-Btrfs_boot_partition_on_pacman_transactions-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Incremental_backup_to_external_drive" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Incremental_backup_to_external_drive">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.3</span>
					<span>Incremental backup to external drive</span>
				</div>
			</a>
			
			<ul id="toc-Incremental_backup_to_external_drive-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Suggested_filesystem_layout" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Suggested_filesystem_layout">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.4</span>
					<span>Suggested filesystem layout</span>
				</div>
			</a>
			
			<ul id="toc-Suggested_filesystem_layout-sublist" class="vector-toc-list">
				<li id="toc-Configuration_of_snapper_and_mount_point" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Configuration_of_snapper_and_mount_point">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.4.1</span>
					<span>Configuration of snapper and mount point</span>
				</div>
			</a>
			
			<ul id="toc-Configuration_of_snapper_and_mount_point-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Restoring_/_to_its_previous_snapshot" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Restoring_/_to_its_previous_snapshot">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.4.2</span>
					<span>Restoring / to its previous snapshot</span>
				</div>
			</a>
			
			<ul id="toc-Restoring_/_to_its_previous_snapshot-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Restoring_other_subvolumes_to_their_previous_snapshot" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Restoring_other_subvolumes_to_their_previous_snapshot">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.4.3</span>
					<span>Restoring other subvolumes to their previous snapshot</span>
				</div>
			</a>
			
			<ul id="toc-Restoring_other_subvolumes_to_their_previous_snapshot-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Deleting_files_from_snapshots" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Deleting_files_from_snapshots">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.5</span>
					<span>Deleting files from snapshots</span>
				</div>
			</a>
			
			<ul id="toc-Deleting_files_from_snapshots-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Preventing_slowdowns" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Preventing_slowdowns">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.6</span>
					<span>Preventing slowdowns</span>
				</div>
			</a>
			
			<ul id="toc-Preventing_slowdowns-sublist" class="vector-toc-list">
				<li id="toc-updatedb" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#updatedb">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.6.1</span>
					<span>updatedb</span>
				</div>
			</a>
			
			<ul id="toc-updatedb-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Disable_quota_groups" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Disable_quota_groups">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.6.2</span>
					<span>Disable quota groups</span>
				</div>
			</a>
			
			<ul id="toc-Disable_quota_groups-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Count_the_number_of_snapshots" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Count_the_number_of_snapshots">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.6.3</span>
					<span>Count the number of snapshots</span>
				</div>
			</a>
			
			<ul id="toc-Count_the_number_of_snapshots-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Create_subvolumes_for_user_data_and_logs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Create_subvolumes_for_user_data_and_logs">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.7</span>
					<span>Create subvolumes for user data and logs</span>
				</div>
			</a>
			
			<ul id="toc-Create_subvolumes_for_user_data_and_logs-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Cleanup_based_on_disk_usage" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Cleanup_based_on_disk_usage">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.8</span>
					<span>Cleanup based on disk usage</span>
				</div>
			</a>
			
			<ul id="toc-Cleanup_based_on_disk_usage-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Troubleshooting</span>
			</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Snapper_logs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Snapper_logs">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.1</span>
					<span>Snapper logs</span>
				</div>
			</a>
			
			<ul id="toc-Snapper_logs-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-IO_error" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#IO_error">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.2</span>
					<span>IO error</span>
				</div>
			</a>
			
			<ul id="toc-IO_error-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Orphaned_snapshots_causing_wasted_disk_space" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Orphaned_snapshots_causing_wasted_disk_space">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.3</span>
					<span>Orphaned snapshots causing wasted disk space</span>
				</div>
			</a>
			
			<ul id="toc-Orphaned_snapshots_causing_wasted_disk_space-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">7</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar vector-feature-custom-font-size-clientpref--excluded">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left" title="Table of Contents">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Snapper</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 3 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-3" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">3 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Snapper" title="Snapper – 日本語" lang="ja" hreflang="ja" data-title="Snapper" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/Snapper.html" title="Snapper – português" lang="pt" hreflang="pt" data-title="Snapper" data-language-autonym="Português" data-language-local-name="português" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Snapper" title="Snapper – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" data-title="Snapper" data-language-autonym="中文（简体）" data-language-local-name="中文（简体）" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end vector-feature-custom-font-size-clientpref--excluded">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Yabsnap.html" title="Yabsnap">Yabsnap</a></li>
<li><a href="../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="http://snapper.io">Snapper</a> is a tool created by openSUSE's Arvin Schnell that helps with managing snapshots of <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a> subvolumes, thin-provisioned <a href="../en/LVM.html" title="LVM">LVM</a> volumes, and (<a rel="nofollow" class="external text" href="https://github.com/openSUSE/snapper/issues/858">experimentally</a>) <a href="../en/Bcachefs.html" title="Bcachefs">Bcachefs</a> subvolumes. It can create and compare snapshots, revert between snapshots, and supports automatic snapshots timelines.
</p>
<meta property="mw:PageProp/toc">
<div class="mw-heading mw-heading2"><h2 id="Installation">Installation</h2></div>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=snapper">snapper</a></span> package.
</p>
<p>Additionally, GUIs are available with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=btrfs-assistant">btrfs-assistant</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snapper-gui-git/">snapper-gui-git</a></span><sup><small>AUR</small></sup>, and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snapper-tools/">snapper-tools</a></span><sup><small>AUR</small></sup>.
</p>
<div class="mw-heading mw-heading2"><h2 id="Creating_a_new_configuration">Creating a new configuration</h2></div>
<p>Before creating a snapper configuration for a Btrfs subvolume, the subvolume must already exist. If it does not, you should <a href="../en/Btrfs.html#Creating_a_subvolume" title="Btrfs">create</a> it before generating a snapper configuration.
</p>
<p>To create a new snapper configuration named <code><i>config</i></code> for the Btrfs subvolume at <code><i>/path/to/subvolume</i></code>, run:
</p>
<pre># snapper -c <i>config</i> create-config <i>/path/to/subvolume</i>
</pre>
<p>This will:
</p>
<ul>
<li>Create a configuration file at <code>/etc/snapper/configs/<i>config</i></code> based on the default template from <code>/usr/share/snapper/config-templates</code>.</li>
<li>Create a subvolume at <code><i>/path/to/subvolume</i>/.snapshots</code> where future snapshots for this configuration will be stored. A snapshot's path is <code><i>/path/to/subvolume</i>/.snapshots/<i>#</i>/snapshot</code>, where <code><i>#</i></code> is the snapshot number.</li>
<li>Add <code><i>config</i></code> to <code>SNAPPER_CONFIGS</code> in <code>/etc/conf.d/snapper</code>.</li>
</ul>
<p>For example, to create a configuration file for the subvolume mounted at <code>/</code>, run:
</p>
<pre># snapper -c root create-config /
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> If you installed Arch using the suggested <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a> partition layout from <a href="../en/Archinstall.html" title="Archinstall">archinstall</a> version older than 3.0.5 <a rel="nofollow" class="external autonumber" href="https://github.com/archlinux/archinstall/releases/tag/3.0.5">[1]</a> then the <code>@.snapshots</code> subvolume will already be mounted to <code>/.snapshots</code>, and the <code>snapper create-config</code> command will fail <a rel="nofollow" class="external autonumber" href="https://github.com/archlinux/archinstall/issues/1808">[2]</a>. To use the <code>@.snapshots</code> subvolume for Snapper backups, do the following:
<ul>
<li>Unmount the <code>@.snapshots</code> subvolume and delete the existing mountpoint.</li>
<li>Create the Snapper config.</li>
<li>Delete the subvolume created by Snapper.</li>
<li>Re-create the <code>/.snapshots</code> mount point and re-mount the <code>@.snapshots</code> subvolume.</li>
</ul>
<p>This procedure is not needed for the suggested <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a> partition layout from <a href="../en/Archinstall.html" title="Archinstall">archinstall</a> version 3.0.5 or newer. 
</p>
</div>
<p>At this point, the configuration is active. If your <a href="../en/Cron.html" title="Cron">cron</a> daemon is running, snapper will take <a href="#Automatic_timeline_snapshots">#Automatic timeline snapshots</a>. If you do not use a <a href="../en/Cron.html" title="Cron">cron</a> daemon, you will need to use the systemd service and timer. See <a href="#Enable/disable">#Enable/disable</a>.
</p>
<p>See also <span class="plainlinks archwiki-template-man" title="$ man 5 snapper-configs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/snapper-configs.5">snapper-configs(5)</a></span>.
</p>
<div class="mw-heading mw-heading2"><h2 id="Taking_snapshots">Taking snapshots</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Automatic_timeline_snapshots">Automatic timeline snapshots</h3></div>
<p>A snapshot timeline can be created with a configurable number of hourly, daily, weekly, monthly, and yearly snapshots kept. When the timeline is enabled, by default a snapshot gets created once an hour. Once a day the snapshots get cleaned up by the timeline cleanup algorithm. Refer to the <code>TIMELINE_*</code> variables in <span class="plainlinks archwiki-template-man" title="$ man 5 snapper-configs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/snapper-configs.5">snapper-configs(5)</a></span> for details.
</p>
<div class="mw-heading mw-heading4"><h4 id="Enable/disable">
<span id="Enable.2Fdisable"></span>Enable/disable</h4></div>
<p>If you have a <a href="../en/Cron.html" title="Cron">cron</a> daemon, this feature should start automatically. To disable it, edit the configuration file corresponding with the subvolume you do not want to have this feature and set:
</p>
<pre>TIMELINE_CREATE="no"
</pre>
<p>If you do not have a <a href="../en/Cron.html" title="Cron">cron</a> daemon, you can use the provided systemd units. <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>snapper-timeline.timer</code> to start the automatic snapshot timeline. Additionally, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>snapper-cleanup.timer</code> to periodically clean up older snapshots.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> If you have a cron daemon and also enable the systemd units, this may result in duplicate snapshots being created. If you wish to disable cron integration while using the systemd units, one possible solution is not to install the snapper package's cron files via pacman's <a href="../en/Pacman.html#Skip_files_from_being_installed_to_system" class="mw-redirect" title="NoExtract">NoExtract</a> configuration option. See <a rel="nofollow" class="external autonumber" href="https://unix.stackexchange.com/questions/425570/snapper-has-recently-started-performing-duplicate-snapshots-each-hour">[3]</a>.</div>
<div class="mw-heading mw-heading4"><h4 id="Set_snapshot_limits">Set snapshot limits</h4></div>
<p>The default settings will keep 10 hourly, 10 daily, 10 monthly and 10 yearly snapshots. You may want to change this in the configuration, especially on busy subvolumes like <code>/</code>. See <a href="#Preventing_slowdowns">#Preventing slowdowns</a>.
</p>
<p>Here is an example section of a configuration named <code><i>config</i></code> with only 5 hourly snapshots, 7 daily ones, no monthly and no yearly ones:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/snapper/configs/<i>config</i></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">TIMELINE_MIN_AGE="1800"
TIMELINE_LIMIT_HOURLY="5"
TIMELINE_LIMIT_DAILY="7"
TIMELINE_LIMIT_WEEKLY="0"
TIMELINE_LIMIT_MONTHLY="0"
TIMELINE_LIMIT_YEARLY="0"</pre>
<div class="mw-heading mw-heading4"><h4 id="Change_snapshot_and_cleanup_frequencies">Change snapshot and cleanup frequencies</h4></div>
<p>If you are using the provided systemd timers, you can <a href="../en/Systemd.html#Editing_provided_units" class="mw-redirect" title="Edit">edit</a> them to change the snapshot and cleanup frequency.
</p>
<p>For example, when editing the <code>snapper-timeline.timer</code>, add the following to make the frequency every five minutes, instead of hourly:
</p>
<pre>[Timer]
OnCalendar=
OnCalendar=*:0/5
</pre>
<p>When editing <code>snapper-cleanup.timer</code>, you need to change <code>OnUnitActiveSec</code>. To make cleanups occur every hour instead of every day, add:
</p>
<pre>[Timer]
OnUnitActiveSec=1h
</pre>
<p>See <a href="../en/Systemd/Timers.html" title="Systemd/Timers">systemd/Timers</a> and <a href="../en/Systemd.html#Drop-in_files" title="Systemd">systemd#Drop-in files</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Manual_snapshots">Manual snapshots</h3></div>
<div class="mw-heading mw-heading4"><h4 id="Single_snapshots">Single snapshots</h4></div>
<p>By default snapper takes snapshots that are of the <i>single</i> type, having no special relationship to other snapshots.
</p>
<p>To take a snapshot of a subvolume manually, do:
</p>
<pre># snapper -c <i>config</i> create --description <i>desc</i>
</pre>
<p>The above command does not use any cleanup algorithm, so the snapshot is stored permanently or until <a href="#Delete_a_snapshot">deleted</a>.
</p>
<p>To set a cleanup algorithm, use the <code>-c</code> flag after <code>create</code> and choose either <code>number</code>, <code>timeline</code>, <code>pre</code>, or <code>post</code>. <code>number</code> sets snapper to periodically remove snapshots that have exceeded a set number in the configuration file. For example, to create a snaphot that uses the <code>number</code> algorithm for cleanup do:
</p>
<pre># snapper -c <i>config</i> create -c number
</pre>
<p>See <a href="#Automatic_timeline_snapshots">#Automatic timeline snapshots</a> for how <code>timeline</code> snapshots work and see <a href="#Pre/post_snapshots">#Pre/post snapshots</a> on how <code>pre</code> and <code>post</code> work.
</p>
<div class="mw-heading mw-heading4"><h4 id="Pre/post_snapshots">
<span id="Pre.2Fpost_snapshots"></span>Pre/post snapshots</h4></div>
<p>The other type of snapshots - <i>pre/post</i> snapshots - are intended to be created as a pair, one before and one after a significant change (such as a system update).
</p>
<p>If the significant change is/can be invoked by a single command, then <code>snapper create --command</code> can be used to invoke the command and automatically create <i>pre/post</i> snapshots:
</p>
<pre># snapper -c <i>config</i> create --command <i>cmd</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> To wrap any shell command around <i>pre/post</i> snapshots, one may also consider using the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snp/">snp</a></span><sup><small>AUR</small></sup> shell script, which provides better output redirection than the native <code>--command</code> option of snapper.</div>
<p>Alternatively, the <i>pre/post</i> snapshots can be created manually.
</p>
<p>First create a <i>pre</i> snapshot:
</p>
<pre># snapper -c <i>config</i> create -t pre -p
</pre>
<p>Note the number of the new snapshot (it is required to create the <i>post</i> snapshot).
</p>
<p>Now perform the actions that will modify the filesystem (*e.g.*, install a new program, upgrade, etc.).
</p>
<p>Finally, create the <i>post</i> snapshot, replacing <code><i>N</i></code> with the number of the <i>pre</i> snapshot:
</p>
<pre># snapper -c <i>config</i> create -t post --pre-number <i>N</i>
</pre>
<p>See also <a href="#Wrapping_pacman_transactions_in_snapshots">#Wrapping pacman transactions in snapshots</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Snapshots_on_boot">Snapshots on boot</h3></div>
<p>To have snapper take a snapshot of the <code>root</code> configuration, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>snapper-boot.timer</code>. (These snapshots are of type <i>single</i>.)
</p>
<div class="mw-heading mw-heading2"><h2 id="Managing_snapshots">Managing snapshots</h2></div>
<div class="mw-heading mw-heading3"><h3 id="List_configurations">List configurations</h3></div>
<p>To list all <a href="#Creating_a_new_configuration">configurations</a> that have been created do:
</p>
<pre># snapper list-configs
</pre>
<div class="mw-heading mw-heading3"><h3 id="List_snapshots">List snapshots</h3></div>
<p>To list snapshots taken for a given configuration <i>config</i> do:
</p>
<pre># snapper -c <i>config</i> list
</pre>
<div class="mw-heading mw-heading3"><h3 id="Restore_snapshot">Restore snapshot</h3></div>
<p>A file may be kept as is when restoring a snapshot, either because was not included in the snapshot (e.g. it resides on another subvolume), or because a filter configuration excluded the file.
</p>
<div class="mw-heading mw-heading4"><h4 id="Filter_configuration">Filter configuration</h4></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> <code>/etc/mtab</code> is a symlink to <code>/proc/self/mounts</code>, so reverting it has no effect on the system. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Snapper.html">Talk:Snapper</a>)</div>
</div>
<p>Some files keep state information of the system, e.g. <code>/etc/mtab</code>. Such files should never be reverted. The default configuration in arch linux ensures this. To help users, snapper allows one to ignore these files. Each line in all files <code>/etc/snapper/filters/*.txt</code> and <code>/usr/share/snapper/filters/*.txt</code> specifies a pattern. When snapper computes the difference between two snapshots it ignores all files and directories matching any of those patterns. Note that filters do not exclude files or directories from being snapshotted. For that, use subvolumes or mount points.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> How is the list from SLES documentation relevant for Arch Linux? (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Snapper.html">Talk:Snapper</a>)</div>
</div>
<p>See also the <a rel="nofollow" class="external text" href="https://documentation.suse.com/sles/12-SP5/html/SLES-all/cha-snapper.html#snapper-dir-excludes">Directories That Are Excluded from Snapshots</a> in the SLES 12 SP5 documentation.
</p>
<div class="mw-heading mw-heading4"><h4 id="Restore_using_the_default_layout">Restore using the default layout</h4></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> What is the "default layout"? What is the alternative? (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Snapper.html">Talk:Snapper</a>)</div>
</div>
<p>If you are using the default layout of snapper, each snapshot is sub-subvolume in the <code>.snapshots</code> directory of a subvolume, e.g. <code>@home</code>.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> Subvolumes that are not used for <code>/</code> can be restored from the system itself. Just log in as root, make sure that the subvolume is not used, and unmount it. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Snapper.html">Talk:Snapper</a>)</div>
</div>
<p>To restore <code>/home</code> using one of snapper's snapshots, first boot into a live Arch Linux USB/CD.
</p>
<p>Mount btrfs root-volume into <code>/mnt</code> using the <a href="../en/Persistent_block_device_naming.html#by-uuid" class="mw-redirect" title="UUID">UUID</a>:
</p>
<pre># mount -t btrfs -o subvol=/ /dev/disk/by-uuid/<i>UUID_of_root_volume</i> /mnt
# cd /mnt
</pre>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> This was written for the live Arch Linux USB/CD where no snapper service can be running. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Snapper.html">Talk:Snapper</a>)</div>
</div>
<p>If the snapper service is running on a running system, stop it. Check if any <code>snapper-<i>unit</i>.timers</code> <a href="../en/Systemd/Timers.html#Management" title="Systemd/Timers">are running</a>, then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Stop">stop</a> them.
</p>
<p>Move a broken/old subvolume out of the way e.g. <code>@home</code> to <code>@home-backup</code>:
</p>
<pre># mv @home @home-backup
</pre>
<p>Find the number of the snapshot that you want to recover (there is one line for each snapshot, so you can easily match up number and date of each snapshot):
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># grep -r '&lt;date&gt;'  /mnt/@home-backup/.snapshots/*/info.xml</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
/mnt/@home-backup/.snapshots/<i>number</i>/info.xml:  &lt;date&gt;2021-07-26 22:00:00&lt;/date&gt;
...
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> The time zone for the date and time recorded in <code>info.xml</code> is <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time" class="extiw" title="wikipedia:Coordinated Universal Time">UTC</a>, so the time difference from local time must be taken into account.</div>
<p>Remember the <code><i>number</i></code>.
</p>
<p>Create a new snapshot <code>@home</code> from snapshot number <code><i>number</i></code> to be restored.
</p>
<pre># btrfs subvolume snapshot @home-backup/.snapshots/<i>number</i>/snapshot @home
</pre>
<p>Get the directory <code>.snapshots</code> back to the healthy subvolume, e.g. <code>@home</code>
</p>
<pre># mv @home-backup/.snapshots @home/
</pre>
<p>If subvolid was used for the <code>/home</code> mount entry option in <a href="../en/Fstab.html" title="Fstab">fstab</a>, instead of <code>/path/to/subvolume</code>, change subvolid in the <code>/mnt/@/etc/fstab</code> file (assuming that <code>@</code> is the subvolume that is mounted as <code>/</code> in the system) to the new subvolid that can be found with <code>btrfs subvolume list /mnt | grep @home$</code>.
</p>
<p>Reboot.
</p>
<p>Check if your system is working as intended, the delete the old/broken snapshot (e.g. <code>@home-backup</code>) if desired. You should check if it contains useful data that you can get back.
</p>
<div class="mw-heading mw-heading3"><h3 id="Delete_a_snapshot">Delete a snapshot</h3></div>
<p>To delete a snapshot number <code><i>N</i></code> do:
</p>
<pre># snapper -c <i>config</i> delete <i>N</i>
</pre>
<p>Multiple snapshots can be deleted at one time. For example, to delete snapshots 65 and 70 of the root configuration do:
</p>
<pre># snapper -c root delete 65 70
</pre>
<p>To delete a range of snapshots, in this example between snapshots 65 and 70 of the root configuration do:
</p>
<pre># snapper -c root delete 65-70
</pre>
<p>To free the space used by the snapshot(s) immediately, use <code>--sync</code>:
</p>
<pre># snapper -c root delete --sync 65
</pre>
<p>To delete all snapshots, the <code>.snapshots</code> subvol and the snapper configuration files for a configuration:
</p>
<pre># snapper -c <i>config</i> delete-config 
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> When deleting a pre snapshot, you should always delete its corresponding post snapshot and vice versa.</div>
<div class="mw-heading mw-heading3"><h3 id="Access_for_non-root_users">Access for non-root users</h3></div>
<p>Each config is created with the root user, and by default, only root can see and access it.
</p>
<p>To be able to list the snapshots for a given config for a specific user, simply change the value of <code>ALLOW_USERS</code> in your <code>/etc/snapper/configs/<i>config</i></code> file. You should now be able to run <code>snapper -c <i>config</i> list</code> as a normal user.
</p>
<p>Eventually, you want to be able to browse the <code>.snapshots</code> directory with a user, but the owner of this directory must stay root. Therefore, you should change the group owner by a group containing the user you are interested in, such as <code>users</code> for example:
</p>
<pre># chmod a+rx .snapshots
# chown :users .snapshots
</pre>
<div class="mw-heading mw-heading2"><h2 id="Tips_and_tricks">Tips and tricks</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Using_Snapper_as_regular_user">Using Snapper as regular user</h3></div>
<p>To enable a regular user to use snapper (e.g. for <code>/home</code> snapshots), you can use the <code>SYNC_ACL</code> option.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Make sure Access Control Lists are <a href="../en/Access_Control_Lists.html#Enable_ACL" title="Access Control Lists">enabled</a>.</div>
<pre># snapper -c home_<i>user</i> create-config /home/<i>user</i>
# snapper -c home_<i>user</i> set-config "ALLOW_USERS=<i>user</i>" SYNC_ACL="yes"
</pre>
<p>See <a rel="nofollow" class="external autonumber" href="https://documentation.suse.com/sles/html/SLES-all/cha-snapper.html#sec-snapper-config-user">[4]</a>
</p>
<div class="mw-heading mw-heading3"><h3 id="Wrapping_pacman_transactions_in_snapshots">Wrapping pacman transactions in snapshots</h3></div>
<p>There are a couple of packages used for automatically creating snapshots upon a pacman transaction:
</p>
<ul><li>
<b>snap-pac</b> — Makes pacman automatically use snapper to create <a href="#Pre/post_snapshots">pre/post snapshots</a> like openSUSE's YaST. Uses <a href="../en/Pacman.html#Hooks" class="mw-redirect" title="Pacman hooks">pacman hooks</a>.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/wesbarnett/snap-pac">https://github.com/wesbarnett/snap-pac</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=snap-pac">snap-pac</a></span>
</dd></dl>
<ul><li>
<b>grub-btrfs</b> — Includes a daemon (<i>grub-btrfsd</i>) that can be enabled via <i>systemctl</i> to look for new snapshots and automatically includes them in the <a href="../en/GRUB.html" title="GRUB">GRUB</a> menu. For that daemon to work you need to install the optional dependency <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=inotify-tools">inotify-tools</a></span>
</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/Antynea/grub-btrfs">https://github.com/Antynea/grub-btrfs</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub-btrfs">grub-btrfs</a></span>
</dd></dl>
<ul><li>
<b>snap-pac-grub</b> — Additionally updates <a href="../en/GRUB.html" title="GRUB">GRUB</a> entries for <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub-btrfs">grub-btrfs</a></span> after <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=snap-pac">snap-pac</a></span> made the snapshots. Also uses <a href="../en/Pacman.html#Hooks" class="mw-redirect" title="Pacman hooks">pacman hooks</a>.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/maximbaz/snap-pac-grub">https://github.com/maximbaz/snap-pac-grub</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snap-pac-grub/">snap-pac-grub</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>refind-btrfs</b> — Adds entries to <a href="../en/REFInd.html" title="REFInd">rEFInd</a> after <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=snap-pac">snap-pac</a></span> made the snapshots.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://github.com/Venom1991/refind-btrfs">https://github.com/Venom1991/refind-btrfs</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/refind-btrfs/">refind-btrfs</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>snp</b> — Wraps any shell command in a snapper pre-post snapshot (e.g. <code>snp pacman -Syu</code>), with better output than the native <code>--command</code> option of snapper (see <a href="#Pre/post_snapshots">#Pre/post snapshots</a>).</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://gist.github.com/erikw/5229436">https://gist.github.com/erikw/5229436</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snp/">snp</a></span><sup><small>AUR</small></sup>
</dd></dl>
<ul><li>
<b>limine-snapper-sync</b> — Adds snapper entries to <a href="../en/Limine.html" title="Limine">Limine</a> <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> after <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=snap-pac">snap-pac</a></span> made the snapshots.</li></ul>
<dl><dd>
<a rel="nofollow" class="external free" href="https://gitlab.com/Zesko/limine-snapper-sync">https://gitlab.com/Zesko/limine-snapper-sync</a> || <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/limine-snapper-sync/">limine-snapper-sync</a></span><sup><small>AUR</small></sup> (See <a href="../en/Limine.html#Snapper_snapshot_integration_for_Btrfs" title="Limine">Limine#Snapper snapshot integration for Btrfs</a> for details.)</dd></dl>
<div class="mw-heading mw-heading4"><h4 id="Booting_into_read-only_snapshots">Booting into read-only snapshots</h4></div>
<p>Users who rely on <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub-btrfs">grub-btrfs</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snap-pac-grub/">snap-pac-grub</a></span><sup><small>AUR</small></sup> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/limine-snapper-sync/">limine-snapper-sync</a></span><sup><small>AUR</small></sup> should note that by default, Snapper's snapshots are read-only, and there are some inherent difficulties booting into read-only snapshots. Many services, such as a desktop manager, require a writable <code>/var</code> directory, and will fail to start when booted from a read-only snapshot.
</p>
<p>To work around this, you can either make the snapshots writable, or use the developer-approved method of booting the snapshots with <a href="../en/Overlay_filesystem.html" title="Overlay filesystem">overlay filesystem</a>, causing the snapshot to behave similar to a live CD environment.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong>  Any changes you make to files within this snapshot will not be saved, as the filesystem only exists within RAM.</div>
<p>To boot snapshots with overlayfs:
</p>
<ul>
<li>Ensure <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=grub-btrfs">grub-btrfs</a></span> is installed on your system.</li>
<li>Add <code>grub-btrfs-overlayfs</code> to the end of the <code>HOOKS</code> array in <code>/etc/mkinitcpio.conf</code>. For example: <pre>HOOKS=(base udev autodetect microcode modconf kms keyboard keymap consolefont block filesystems fsck grub-btrfs-overlayfs)</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> Because <i>grub-btrfs-overlayfs</i> only provides a <a href="../en/Mkinitcpio.html#Runtime_hooks" title="Mkinitcpio">runtime hook</a> and no systemd unit, it is <b>not</b> compatible with a systemd based initramfs. Make sure you use a <a href="../en/Mkinitcpio.html#Common_hooks" title="Mkinitcpio">Busybox based initramfs</a> instead. See <a rel="nofollow" class="external text" href="https://github.com/Antynea/grub-btrfs/issues/199">this GitHub issue</a> for more details.</div>
</li>
<li>
<a href="../en/Mkinitcpio.html#Image_creation_and_activation" class="mw-redirect" title="Regenerate the initramfs">Regenerate the initramfs</a>.</li>
</ul>
<p>Further reading:
</p>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://github.com/Antynea/grub-btrfs/blob/master/initramfs/readme.md">grub-btrfs README</a> (includes instructions for those who use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dracut">dracut</a></span> instead of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mkinitcpio">mkinitcpio</a></span>)</li>
<li><a rel="nofollow" class="external text" href="https://github.com/Antynea/grub-btrfs/issues/92">Discussion on Github</a></li>
</ul>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> Alternatively, you can boot into snapshots with the <a href="../en/Limine.html" title="Limine">Limine</a> boot loader. The integration between Snapper and Limine is provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/limine-snapper-sync/">limine-snapper-sync</a></span><sup><small>AUR</small></sup>, see <a href="../en/Limine.html#Snapper_snapshot_integration_for_Btrfs" title="Limine">Limine#Snapper snapshot integration for Btrfs</a> for details.</div>
<div class="mw-heading mw-heading4"><h4 id="Backup_non-Btrfs_boot_partition_on_pacman_transactions">Backup non-Btrfs boot partition on pacman transactions</h4></div>
<p>If your <code>/boot</code> partition is on a non Btrfs filesystem (e.g. an <a href="../en/EFI_system_partition.html" class="mw-redirect" title="ESP">ESP</a>) you are not able to do snapper backups with it. See <a href="../en/System_backup.html#Snapshots_and_/boot_partition" title="System backup">System backup#Snapshots and /boot partition</a> to copy the boot partition automatically on a kernel update to your Btrfs root with a hook. This also plays nice together with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=snap-pac">snap-pac</a></span>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Incremental_backup_to_external_drive">Incremental backup to external drive</h3></div>
<p>Some tools can use snapper to automate backups. See <a href="../en/Btrfs.html#Incremental_backup_to_external_drive" title="Btrfs">Btrfs#Incremental backup to external drive</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Suggested_filesystem_layout">Suggested filesystem layout</h3></div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> The following layout is intended <i>not</i> to be used with <code>snapper rollback</code>, but is intended to alleviate the inherent problems of <a href="#Restoring_/_to_its_previous_snapshot">#Restoring / to its previous snapshot</a>. See this <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=194491">this forum thread</a>.</div>
<p>Here is a suggested file system layout for easily restoring the subvolume <code>@</code> that is mounted at root to a previous snapshot:
</p>
<table class="wikitable">
<caption>Filesystem layout
</caption>
<tbody>
<tr>
<th>Subvolume</th>
<th>Mountpoint
</th>
</tr>
<tr>
<td>@</td>
<td>/
</td>
</tr>
<tr>
<td>@home</td>
<td>/home
</td>
</tr>
<tr>
<td>@snapshots</td>
<td>/.snapshots
</td>
</tr>
<tr>
<td>@var_log</td>
<td>/var/log
</td>
</tr>
</tbody>
</table>
<pre>subvolid=5
  |
  ├── @ -|
  |     contained directories:
  |       ├── /usr
  |       ├── /bin
  |       ├── /.snapshots
  |       ├── ...
  |
  ├── @home
  ├── @snapshots
  ├── @var_log
  └── @...
</pre>
<p>The subvolumes <code>@...</code> are mounted to any other directory that should have its own subvolume. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> 
<ul>
<li>When taking a snapshot of <code>@</code> (mounted at the root <code>/</code>), other subvolumes are not included in the snapshot. Even if a subvolume is nested below <code>@</code>, a snapshot of <code>@</code> will <i>not</i> include it. Create snapper configurations for additional subvolumes besides <code>@</code> of which you want to keep snapshots.</li>
<li>Due to a <a href="../en/Btrfs.html#Swap_file" title="Btrfs">Btrfs limitation</a>, snapshotted volumes cannot contain <a href="../en/Swap.html#Swap_file" title="Swap">swap files</a>. Either put the swap file on another subvolume or create a <a href="../en/Swap.html#Swap_partition" title="Swap">swap partition</a>.</li>
</ul>
</div>
<p>If you were to restore your system to a previous snapshots of <code>@</code>, these other subvolumes will remain unaffected. For example, this allows you to restore <code>@</code> to a previous snapshot while keeping your <code>/home</code> unchanged, because of the subvolume that is mounted at <code>/home</code>.
</p>
<p>This layout allows the snapper utility to take regular snapshots of <code>/</code>, while at the same time making it easy to restore <code>/</code> from an Arch Live CD if it becomes unbootable.
</p>
<p>In this scenario, after the initial setup, snapper needs no changes, and will work as expected.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> 
<ul>
<li>Consider creating subvolumes for other directories that contain data you do not want to include in snapshots and rollbacks of the <code>@</code> subvolume, such as <code>/var/cache</code>, <code>/var/spool</code>, <code>/var/tmp</code>, <code>/var/lib/machines</code> (<a href="../en/Systemd-nspawn.html" title="Systemd-nspawn">systemd-nspawn</a>), <code>/var/lib/docker</code> (<a href="../en/Docker.html" title="Docker">Docker</a>), <code>/var/lib/postgres</code> (<a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a>), and other data directories under <code>/var/lib/</code>. It is up to you if you want to follow the <i>flat</i> layout or create nested subvolumes. On the other hand, the pacman database in <code>/var/lib/pacman</code> must stay on the root subvolume (<code>@</code>).</li>
<li>You can run Snapper on <code>@home</code> and any other subvolume to have separate snapshot and rollback capabilities for data.</li>
</ul>
</div>
<div class="mw-heading mw-heading4"><h4 id="Configuration_of_snapper_and_mount_point">Configuration of snapper and mount point</h4></div>
<p>It is assumed that the subvolume <code>@</code> is mounted at root <code>/</code>. It is also assumed that <code>/.snapshots</code> is <i>not</i> mounted and does <i>not</i> exist as folder, this can be ensured by the commands:
</p>
<pre># umount /.snapshots
# rm -r /.snapshots
</pre>
<p>Then <a href="#Creating_a_new_configuration">create a new configuration</a> for <code>/</code>. Snapper create-config automatically creates a subvolume <code>.snapshots</code> with the root subvolume <code>@</code> as its parent, that is not needed for the suggested filesystem layout, and can be deleted.
</p>
<pre># btrfs subvolume delete /.snapshots
</pre>
<p>After deleting the subvolume, recreate the directory <code>/.snapshots</code>.
</p>
<pre># mkdir /.snapshots
</pre>
<p>Now <a href="../en/File_systems.html#Mount_a_file_system" class="mw-redirect" title="Mount">mount</a> <code>@snapshots</code> to <code>/.snapshots</code>. For example, for a file system located on <code>/dev/sda1</code>:
</p>
<pre># mount -o subvol=@snapshots /dev/sda1 /.snapshots
</pre>
<p>To make this mount permanent, add an entry to your <a href="../en/Fstab.html" title="Fstab">fstab</a>.
</p>
<p>Or if you have an existing fstab entry remount the snapshot subvolume:
</p>
<pre># mount -a
</pre>
<p>Give the folder <code>750</code> <a href="../en/File_permissions_and_attributes.html#Numeric_method" class="mw-redirect" title="Permissions">permissions</a>.
</p>
<p>This will make all snapshots that snapper creates be stored outside of the <code>@</code> subvolume, so that <code>@</code> can easily be replaced anytime without losing the snapper snapshots.
</p>
<div class="mw-heading mw-heading4"><h4 id="Restoring_/_to_its_previous_snapshot">
<span id="Restoring_.2F_to_its_previous_snapshot"></span>Restoring / to its previous snapshot</h4></div>
<p>To restore <code>/</code> using one of snapper's snapshots, first boot into a live Arch Linux USB/CD.
</p>
<p><a href="../en/File_systems.html#Mount_a_file_system" class="mw-redirect" title="Mount">Mount</a> the toplevel subvolume (subvolid=5). That is, omit any <code>subvolid</code> or <code>subvol</code> mount flags.
</p>
<p>Find the number of the snapshot that you want to recover:
</p>
<pre># grep -r '&lt;date&gt;' /mnt/@snapshots/*/info.xml
</pre>
<p>The output should look like so, there is one line for each snapshot, so you can easily match up number and date of each snapshot.
</p>
<pre>/mnt/@snapshots/<i>number</i>/info.xml:  &lt;date&gt;2021-07-26 22:00:00&lt;/date&gt;
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note</strong> The time zone for the date and time recorded in <code>info.xml</code> is <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time" class="extiw" title="wikipedia:Coordinated Universal Time">UTC</a>, so the time difference from local time must be taken into account.</div>
<p>Remember the <code><i>number</i></code>.
</p>
<p>Now, move <code>@</code> to another location (<i>e.g.</i> <code>/@.broken</code>) to save a copy of the current system. Alternatively, simply delete <code>@</code> using <code>btrfs subvolume delete /mnt/@</code>.
</p>
<p>Create a read-write snapshot of the read-only snapshot snapper took:
</p>
<pre># btrfs subvolume snapshot /mnt/@snapshots/<i>number</i>/snapshot /mnt/@
</pre>
<p>Where <code><i>number</i></code> is the number of the snapper snapshot you wish to restore.
</p>
<p>If subvolid was used for the <code>/</code> mount entry option in <a href="../en/Fstab.html" title="Fstab">fstab</a>, instead of <code>/path/to/subvolume</code>, change subvolid in the <code>/mnt/@/etc/fstab</code> file to the new subvolid that can be found with <code>btrfs subvolume list /mnt | grep @$</code>. Also change the boot loader configuration such as <code>refind_linux.conf</code>, if it contains the subvolid.
</p>
<p>Finally, unmount the top-level subvolume (ID=5), then <a href="../en/Btrfs.html#Mounting_subvolumes" title="Btrfs">mount</a> <code>@</code> to <code>/mnt</code> and your <a href="../en/EFI_system_partition.html" class="mw-redirect" title="ESP">ESP</a> or boot partition to the appropriate mount point. <a href="../en/Chroot.html" class="mw-redirect" title="Change root">Change root</a> to your restored snapshot in order to <a href="../en/Mkinitcpio.html#Manual_generation" title="Mkinitcpio">regenerate your initramfs image</a>.
</p>
<p>Your <code>/</code> has now been restored to the previous snapshot. Now just simply reboot.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip</strong> You can also use the automatic rollback tool made for this layout: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snapper-rollback/">snapper-rollback</a></span><sup><small>AUR</small></sup>. Edit the config file at <code>/etc/snapper-rollback.conf</code> to match your system.</div>
<div class="mw-heading mw-heading4"><h4 id="Restoring_other_subvolumes_to_their_previous_snapshot">Restoring other subvolumes to their previous snapshot</h4></div>
<p>See <a href="#Restore_snapshot">#Restore snapshot</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Deleting_files_from_snapshots">Deleting files from snapshots</h3></div>
<p>If you want to delete a specific file or folder from past snapshots without deleting the snapshots themselves, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/snappers/">snappers</a></span><sup><small>AUR</small></sup> is a script that adds this functionality to Snapper. This script can also be used to manipulate past snapshots in a number of other ways that Snapper does not currently support.
</p>
<p>If you want to remove a file without using an extra script, you just need to <a rel="nofollow" class="external text" href="https://unix.stackexchange.com/a/149933">make your snapshot subvolume read-write</a>, which you can do with:
</p>
<pre># btrfs property set /path/to/.snapshots/&lt;snapshot_num&gt;/snapshot ro false
</pre>
<p>Verify that <code>ro=false</code>:
</p>
<pre># btrfs property get /path/to/.snapshots/&lt;snapshot_num&gt;/snapshot
ro=false
</pre>
<p>You can now modify files in <code>/path/to/.snapshots/&lt;snapshot_num&gt;/snapshot</code> like normal.  You can use a shell loop to work on your snapshots in bulk.
</p>
<div class="mw-heading mw-heading3"><h3 id="Preventing_slowdowns">Preventing slowdowns</h3></div>
<p>Keeping many snapshots for a large timeframe on a busy filesystem like <code>/</code>, where many system updates happen over time, can cause serious slowdowns. You can prevent it by:
</p>
<ul>
<li>
<a href="../en/Btrfs.html#Creating_a_subvolume" title="Btrfs">Creating</a> subvolumes for things that are not worth being snapshotted, like <code>/var/cache/pacman/pkg</code>, <code>/var/abs</code>, <code>/var/tmp</code>, and <code>/srv</code>.</li>
<li>Editing the default settings for hourly/daily/monthly/yearly snapshots when using <a href="#Automatic_timeline_snapshots">#Automatic timeline snapshots</a>.</li>
</ul>
<div class="mw-heading mw-heading4"><h4 id="updatedb">updatedb</h4></div>
<p>By default, <code>updatedb</code> (see <a href="../en/Locate.html" title="Locate">locate</a>) will also index the <code>.snapshots</code> directory created by snapper, which can cause serious slowdown and excessive memory usage if you have many snapshots. You can prevent <code>updatedb</code> from indexing over it by editing:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/updatedb.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">PRUNENAMES = ".snapshots"</pre>
<div class="mw-heading mw-heading4"><h4 id="Disable_quota_groups">Disable quota groups</h4></div>
<p>There are reports of significant slow downs being caused by quota groups, if for instance <code>snapper ls</code> takes many minutes to return a result this could be the cause. See <a rel="nofollow" class="external autonumber" href="https://www.reddit.com/r/btrfs/comments/fmucrq/btrfs_snapshots_make_entire_system_lag_cpu_usage/">[5]</a>.
</p>
<p>To determine whether or not quota groups are enabled use the following command:
</p>
<pre># btrfs qgroup show /
</pre>
<p>Quota groups can then be disabled with:
</p>
<pre># btrfs quota disable /
</pre>
<div class="mw-heading mw-heading4"><h4 id="Count_the_number_of_snapshots">Count the number of snapshots</h4></div>
<p>If disabling quota groups did not help with slow down, it may be helpful to count the number of snapshots, this can be done with:
</p>
<pre># btrfs subvolume list -s / | wc -l
</pre>
<div class="mw-heading mw-heading3"><h3 id="Create_subvolumes_for_user_data_and_logs">Create subvolumes for user data and logs</h3></div>
<p>It is recommended to store directories on their own subvolume, rather than the root subvolume <code>/</code>, if they contain user data e.g. emails, or logs. That way if a snapshot of <code>/</code> is restored, user data and logs  will not also be reverted to the previous state. A separate timeline of snapshots can be maintained for user data. It is not recommended to create snapshots of logs in <code>/var/log</code>. This makes it easier to troubleshoot.
</p>
<p>Directories can also be skipped during a restore using <a href="#Filter_configuration">#Filter configuration</a>. See the <a rel="nofollow" class="external text" href="https://documentation.suse.com/sles/12-SP5/html/SLES-all/cha-snapper.html#snapper-dir-excludes">SLES documentation for examples and reasons to skip certain paths</a>.
</p>
<div class="mw-heading mw-heading3"><h3 id="Cleanup_based_on_disk_usage">Cleanup based on disk usage</h3></div>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> See <a rel="nofollow" class="external autonumber" href="http://snapper.io/2016/05/18/space-aware-cleanup.html">[6]</a> for ideas. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Snapper.html">Talk:Snapper</a>)</div>
</div>
<div class="mw-heading mw-heading2"><h2 id="Troubleshooting">Troubleshooting</h2></div>
<div class="mw-heading mw-heading3"><h3 id="Snapper_logs">Snapper logs</h3></div>
<p>Snapper writes all activity to <code>/var/log/snapper.log</code> - check this file first if you think something goes wrong.
</p>
<p>If you have issues with hourly/daily/weekly snapshots, the most common cause for this so far has been that the cronie service (or whatever cron daemon you are using) was not running.
</p>
<div class="mw-heading mw-heading3"><h3 id="IO_error">IO error</h3></div>
<p>If you get an 'IO Error' when trying to create a snapshot please make sure that the <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?id=164404">.snapshots</a> directory associated to the subvolume you are trying to snapshot is a subvolume by itself.
</p>
<p>Another possible cause is that .snapshots directory does not have root as an owner (You will find <code>Btrfs.cc(openInfosDir):219 - .snapshots must have owner root</code> in the <code>/var/log/snapper.log</code>).
</p>
<div class="mw-heading mw-heading3"><h3 id="Orphaned_snapshots_causing_wasted_disk_space">Orphaned snapshots causing wasted disk space</h3></div>
<p>It is possible for snapshots to get 'lost', where they still exist on disk but are not tracked by snapper. This can result in a large amount of wasted, unaccounted-for disk space. To check for this, compare the output of 
</p>
<pre># snapper -c &lt;config&gt; list
</pre>
<p>to 
</p>
<pre># btrfs subvolume list -o &lt;parent subvolume&gt;/.snapshots 
</pre>
<p>Any subvolume in the second list which is not present in the first is an orphan and can be <a href="../en/Btrfs.html#Deleting_a_subvolume" title="Btrfs">deleted</a> manually.
</p>
<div class="mw-heading mw-heading2"><h2 id="See_also">See also</h2></div>
<ul>
<li><a rel="nofollow" class="external text" href="http://snapper.io/">Snapper homepage</a></li>
<li><a rel="nofollow" class="external text" href="https://en.opensuse.org/Portal:Snapper">openSUSE Snapper portal</a></li>
<li><a rel="nofollow" class="external text" href="https://btrfs.wiki.kernel.org/index.php/Main_Page">Btrfs homepage</a></li>
<li><a rel="nofollow" class="external text" href="https://web.archive.org/web/20160327174528/https://www.linux.com/news/enterprise/systems-management/878490-snapper-suses-ultimate-btrfs-snapshot-manager/">Linux.com: Snapper: SUSE's Ultimate Btrfs Snapshot Manager</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:File_systems.html" title="Category:File systems">File systems</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Snapper&amp;oldid=847969">https://wiki.archlinux.org/index.php?title=Snapper&amp;oldid=847969</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 2 October 2025, at 13:52.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><picture><source media="(min-width: 500px)" srcset="/resources/assets/poweredby_mediawiki.svg" width="88" height="31"><img src="/resources/assets/mediawiki_compact.svg" width="25" height="25" loading="lazy"></picture></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-header-container vector-sticky-header-container">
	<div id="vector-sticky-header" class="vector-sticky-header">
		<div class="vector-sticky-header-start">
			<div class="vector-sticky-header-icon-start vector-button-flush-left vector-button-flush-right" aria-hidden="true">
				<button class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-sticky-header-search-toggle" tabindex="-1" data-event-name="ui.vector-sticky-search-form.icon"><span class="vector-icon mw-ui-icon-search mw-ui-icon-wikimedia-search"></span>

<span>Search</span>
			</button>
		</div>
			
		<div role="search" class="vector-search-box-vue vector-search-box">
			<div class="vector-typeahead-search-container">
				<div class="cdx-typeahead-search">
					<form action="/index.php" id="vector-sticky-search-form" class="cdx-search-input cdx-search-input--has-end-button">
						<div class="cdx-search-input__input-wrapper" data-search-loc="header-moved">
							<div class="cdx-text-input cdx-text-input--has-start-icon">
								<input class="cdx-text-input__input" type="search" name="search" placeholder="Search ArchWiki">
								<span class="cdx-text-input__icon cdx-text-input__start-icon"></span>
							</div>
							<input type="hidden" name="title" value="Special:Search">
						</div>
						<button class="cdx-button cdx-search-input__end-button">Search</button>
					</form>
				</div>
			</div>
		</div>
		<div class="vector-sticky-header-context-bar">
				<nav aria-label="Contents" class="vector-toc-landmark">
						
					<div id="vector-sticky-header-toc" class="vector-dropdown mw-portlet mw-portlet-sticky-header-toc vector-sticky-header-toc vector-button-flush-left">
						<input type="checkbox" id="vector-sticky-header-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-sticky-header-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
						<label id="vector-sticky-header-toc-label" for="vector-sticky-header-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
						</label>
						<div class="vector-dropdown-content">
					
						<div id="vector-sticky-header-toc-unpinned-container" class="vector-unpinned-container">
						</div>
					
						</div>
					</div>
			</nav>
				<div class="vector-sticky-header-context-bar-primary" aria-hidden="true"><span class="mw-page-title-main">Snapper</span></div>
			</div>
		</div>
		<div class="vector-sticky-header-end" aria-hidden="true">
			<div class="vector-sticky-header-icons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-talk-sticky-header" tabindex="-1" data-event-name="talk-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbles mw-ui-icon-wikimedia-speechBubbles"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-subject-sticky-header" tabindex="-1" data-event-name="subject-sticky-header"><span class="vector-icon mw-ui-icon-article mw-ui-icon-wikimedia-article"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-history-sticky-header" tabindex="-1" data-event-name="history-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-history mw-ui-icon-wikimedia-wikimedia-history"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only mw-watchlink" id="ca-watchstar-sticky-header" tabindex="-1" data-event-name="watch-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-star mw-ui-icon-wikimedia-wikimedia-star"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-edit-sticky-header" tabindex="-1" data-event-name="wikitext-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-wikiText mw-ui-icon-wikimedia-wikimedia-wikiText"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-ve-edit-sticky-header" tabindex="-1" data-event-name="ve-edit-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-edit mw-ui-icon-wikimedia-wikimedia-edit"></span>

<span></span>
			</a>
			<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only" id="ca-viewsource-sticky-header" tabindex="-1" data-event-name="ve-edit-protected-sticky-header"><span class="vector-icon mw-ui-icon-wikimedia-editLock mw-ui-icon-wikimedia-wikimedia-editLock"></span>

<span></span>
			</a>
		</div>
			<div class="vector-sticky-header-buttons">
				<a href="#" class="cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive" id="ca-addsection-sticky-header" tabindex="-1" data-event-name="addsection-sticky-header"><span class="vector-icon mw-ui-icon-speechBubbleAdd-progressive mw-ui-icon-wikimedia-speechBubbleAdd-progressive"></span>

<span>Add topic</span>
			</a>
		</div>
			<div class="vector-sticky-header-icon-end">
				<div class="vector-user-links">
				</div>
			</div>
		</div>
	</div>
</div>
<div class="mw-portlet mw-portlet-dock-bottom emptyPortlet" id="p-dock-bottom">
	<ul>
		
	</ul>
</div>
</body>
</html>
