<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Install Arch Linux from existing Linux - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Install_Arch_Linux_from_existing_Linux rootpage-Install_Arch_Linux_from_existing_Linux skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Backup_and_preparation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Backup_and_preparation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Backup and preparation</div>
		</a>
		
		<ul id="toc-Backup_and_preparation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-From_a_host_running_Arch_Linux" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#From_a_host_running_Arch_Linux">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>From a host running Arch Linux</div>
		</a>
		
			<button aria-controls="toc-From_a_host_running_Arch_Linux-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle From a host running Arch Linux subsection</span>
			</button>
		
		<ul id="toc-From_a_host_running_Arch_Linux-sublist" class="vector-toc-list">
			<li id="toc-Create_a_new_Arch_installation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Create_a_new_Arch_installation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Create a new Arch installation</div>
			</a>
			
			<ul id="toc-Create_a_new_Arch_installation-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Create_a_copy_of_an_existing_Arch_installation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Create_a_copy_of_an_existing_Arch_installation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Create a copy of an existing Arch installation</div>
			</a>
			
			<ul id="toc-Create_a_copy_of_an_existing_Arch_installation-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-From_a_host_running_another_Linux_distribution" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#From_a_host_running_another_Linux_distribution">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>From a host running another Linux distribution</div>
		</a>
		
			<button aria-controls="toc-From_a_host_running_another_Linux_distribution-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle From a host running another Linux distribution subsection</span>
			</button>
		
		<ul id="toc-From_a_host_running_another_Linux_distribution-sublist" class="vector-toc-list">
			<li id="toc-Using_pacman_from_the_host_system" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_pacman_from_the_host_system">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Using pacman from the host system</div>
			</a>
			
			<ul id="toc-Using_pacman_from_the_host_system-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Creating_a_chroot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Creating_a_chroot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Creating a chroot</div>
			</a>
			
			<ul id="toc-Creating_a_chroot-sublist" class="vector-toc-list">
				<li id="toc-Method_A:_Using_the_bootstrap_tarball_(recommended)" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Method_A:_Using_the_bootstrap_tarball_(recommended)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.1</span>Method A: Using the bootstrap tarball (recommended)</div>
			</a>
			
			<ul id="toc-Method_A:_Using_the_bootstrap_tarball_(recommended)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Method_B:_Using_the_LiveCD_image" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Method_B:_Using_the_LiveCD_image">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.2</span>Method B: Using the LiveCD image</div>
			</a>
			
			<ul id="toc-Method_B:_Using_the_LiveCD_image-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Using_a_chroot_environment" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_a_chroot_environment">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>Using a chroot environment</div>
			</a>
			
			<ul id="toc-Using_a_chroot_environment-sublist" class="vector-toc-list">
				<li id="toc-Initializing_pacman_keyring" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Initializing_pacman_keyring">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.1</span>Initializing pacman keyring</div>
			</a>
			
			<ul id="toc-Initializing_pacman_keyring-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Downloading_basic_tools" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Downloading_basic_tools">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3.2</span>Downloading basic tools</div>
			</a>
			
			<ul id="toc-Downloading_basic_tools-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Installation_tips" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Installation_tips">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4</span>Installation tips</div>
			</a>
			
			<ul id="toc-Installation_tips-sublist" class="vector-toc-list">
				<li id="toc-Debian-based_host" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Debian-based_host">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4.1</span>Debian-based host</div>
			</a>
			
			<ul id="toc-Debian-based_host-sublist" class="vector-toc-list">
				<li id="toc-/dev/shm" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#/dev/shm">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4.1.1</span>/dev/shm</div>
			</a>
			
			<ul id="toc-/dev/shm-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-/dev/pts" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#/dev/pts">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4.1.2</span>/dev/pts</div>
			</a>
			
			<ul id="toc-/dev/pts-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Fedora-based_host" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Fedora-based_host">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.4.2</span>Fedora-based host</div>
			</a>
			
			<ul id="toc-Fedora-based_host-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Things_to_check_before_you_reboot" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Things_to_check_before_you_reboot">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Things to check before you reboot</div>
		</a>
		
		<ul id="toc-Things_to_check_before_you_reboot-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Replacing_the_existing_system_without_a_LiveCD" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Replacing_the_existing_system_without_a_LiveCD">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Replacing the existing system without a LiveCD</div>
		</a>
		
			<button aria-controls="toc-Replacing_the_existing_system_without_a_LiveCD-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Replacing the existing system without a LiveCD subsection</span>
			</button>
		
		<ul id="toc-Replacing_the_existing_system_without_a_LiveCD-sublist" class="vector-toc-list">
			<li id="toc-Set_old_swap_partition_as_new_root_partition" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Set_old_swap_partition_as_new_root_partition">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>Set old swap partition as new root partition</div>
			</a>
			
			<ul id="toc-Set_old_swap_partition_as_new_root_partition-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Installation">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Installation</div>
			</a>
			
			<ul id="toc-Installation-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Install Arch Linux from existing Linux</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 7 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-7" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">7 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-de mw-list-item"><a href="https://wiki.archlinux.de/title/Arch_Linux_auf_einem_Root-Server" title="Arch Linux auf einem Root-Server – Deutsch" lang="de" hreflang="de" class="interlanguage-link-target"><span>Deutsch</span></a></li>
<li class="interlanguage-link interwiki-es mw-list-item"><a href="../es/Install_Arch_Linux_from_existing_Linux.html" title="Install Arch Linux from existing Linux – español" lang="es" hreflang="es" class="interlanguage-link-target"><span>Español</span></a></li>
<li class="interlanguage-link interwiki-fr mw-list-item"><a href="../fr/Install_Arch_Linux_from_existing_Linux.html" title="Install Arch Linux from existing Linux – français" lang="fr" hreflang="fr" class="interlanguage-link-target"><span>Français</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/%E6%97%A2%E5%AD%98%E3%81%AE_Linux_%E3%81%8B%E3%82%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" title="既存の Linux からインストール – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-pt mw-list-item"><a href="../pt/Install_Arch_Linux_from_existing_Linux.html" title="Install Arch Linux from existing Linux – português" lang="pt" hreflang="pt" class="interlanguage-link-target"><span>Português</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Install_Arch_Linux_from_existing_Linux.html" title="Install Arch Linux from existing Linux – русский" lang="ru" hreflang="ru" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Install_Arch_Linux_from_existing_Linux" title="Install Arch Linux from existing Linux – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Install_Arch_Linux_via_SSH.html" title="Install Arch Linux via SSH">Install Arch Linux via SSH</a></li>
</ul>
</div>
<p>This document describes the bootstrapping process required to install Arch Linux from a running Linux host system.
After bootstrapping, the installation proceeds as described in the <a href="../en/Installation_guide.html" title="Installation guide">Installation guide</a>.
</p>
<p>Installing Arch Linux from a running Linux is useful for:
</p>
<ul>
<li>remotely installing Arch Linux, e.g. a (virtual) root server</li>
<li>replacing an existing Linux without a LiveCD (see <a href="#Replacing_the_existing_system_without_a_LiveCD">#Replacing the existing system without a LiveCD</a>)</li>
<li>creating a new Linux distribution or <a href="../en/Arch-based_distributions.html" title="Arch-based distributions">LiveMedia based on Arch Linux</a>
</li>
<li>creating an Arch Linux chroot environment, e.g. for a Docker base container</li>
<li><a href="../en/Diskless_system.html" class="mw-redirect" title="Diskless network boot NFS root">rootfs-over-NFS for diskless machines</a></li>
</ul>
<p>The goal of the bootstrapping procedure is to setup an environment from which the scripts from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=arch-install-scripts">arch-install-scripts</a></span> (such as <code>pacstrap</code> and <code>arch-chroot</code>) can be run.
</p>
<p>If the host system runs Arch Linux, this can be achieved by simply installing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=arch-install-scripts">arch-install-scripts</a></span>. If the host system runs another Linux distribution, you will first need to set up an Arch Linux-based chroot.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This guide requires that the existing host system be able to execute the new target Arch Linux architecture programs. This means it has to be an x86_64 host.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Please make sure you understand each step before proceeding. It is easy to destroy your system or to lose data!</div>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Backup_and_preparation">Backup and preparation</span></h2>
<p>Backup all your data including mails, webservers, etc. Have all information at your fingertips. Preserve all your server configurations, hostnames, etc.
</p>
<p>Here is a list of data you will likely need:
</p>
<ul>
<li>IP address</li>
<li>hostname(s), (note: rootserver are mostly also part of the providers domain, check or save your <code>/etc/hosts</code> before you delete)</li>
<li>DNS server (check <code>/etc/resolv.conf</code>)</li>
<li>SSH keys (if other people work on your server, they will have to accept new keys otherwise. This includes keys from your Apache, your mail servers, your SSH server and others.)</li>
<li>Hardware info (network card, etc. Refer to your pre-installed <code>/etc/modules.conf</code> )</li>
<li>Grub configuration files.</li>
</ul>
<p>In general, it is a good idea to have a local copy of your original <code>/etc</code> directory on your local hard drive.
</p>
<h2><span class="mw-headline" id="From_a_host_running_Arch_Linux">From a host running Arch Linux</span></h2>
<p>Install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=arch-install-scripts">arch-install-scripts</a></span> package.
</p>
<p>Follow <a href="../en/Installation_guide.html#Mount_the_file_systems" title="Installation guide">Installation guide#Mount the file systems</a> to mount the filesystem that will be used for the root directory as well as all the other needed mount points. If you already use the <code>/mnt</code> directory for something else, just create another directory such as <code>/mnt/install</code> and use it as the mount point base for the rest of the installation.
</p>
<p>At this stage, Arch Linux can either be installed from scratch or it can mirror the host installation. The two options are described thereafter.
</p>
<h3><span class="mw-headline" id="Create_a_new_Arch_installation">Create a new Arch installation</span></h3>
<p>Follow <a href="../en/Installation_guide.html#Installation" title="Installation guide">Installation guide#Installation</a>.
</p>
<p>In the procedure, the first step, <a href="../en/Installation_guide.html#Select_the_mirrors" title="Installation guide">Installation guide#Select the mirrors</a>, can be skipped since the host should already have a correct mirrorlist.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>In order to avoid redownloading all the packages, consider following <a href="../en/Pacman/Tips_and_tricks.html#Network_shared_pacman_cache" title="Pacman/Tips and tricks">Pacman/Tips and tricks#Network shared pacman cache</a>, or use <i>pacstrap</i>'s <code>-c</code> option to use your host machine's package cache.</li>
<li>When the grub boot-loader is used, the <code>grub-mkconfig</code> may detect devices incorrectly. This will result in <code>Error:no such device</code> when trying to boot from the stick. To solve this problem, from the host running Arch Linux, mount the newly installed partitions, <i>arch-chroot</i> to the new partition, then install and configure grub. The last step may require disabling <i>lvmetad</i> from <code>/etc/lvm/lvm.conf</code> by setting <code>use_lvmetad=0</code>.</li>
</ul>
</div>
<h3><span class="mw-headline" id="Create_a_copy_of_an_existing_Arch_installation">Create a copy of an existing Arch installation</span></h3>
<p>It is possible to replicate an existing Arch Linux installation by copying the host filesystem to the new partition and make some adjustments to it to make it bootable and unique.
</p>
<p>The first step is to copy the host files into the mounted new partition, for this, consider using the approach exhibited in <a href="../en/Rsync.html#Full_system_backup" title="Rsync">rsync#Full system backup</a>.
</p>
<p>Then, follow the procedure described in <a href="../en/Installation_guide.html#Configure_the_system" title="Installation guide">Installation guide#Configure the system</a> with some caveats and additional steps:
</p>
<ul>
<li>
<a href="../en/Installation_guide.html#Time" title="Installation guide">Installation guide#Time</a>, <a href="../en/Installation_guide.html#Localization" title="Installation guide">Installation guide#Localization</a> and <a href="../en/Installation_guide.html#Root_password" title="Installation guide">Installation guide#Root password</a> can be skipped</li>
<li>
<a href="../en/Installation_guide.html#Initramfs" title="Installation guide">Installation guide#Initramfs</a> may be required in particular if changing filesystem, for example from <a href="../en/Ext4.html" title="Ext4">ext4</a> to <a href="../en/Btrfs.html" title="Btrfs">Btrfs</a>
</li>
<li>Regarding <a href="../en/Installation_guide.html#Boot_loader" title="Installation guide">Installation guide#Boot loader</a>, it is necessary to reinstall the bootloader</li>
<li>Delete <code>/etc/machine-id</code> and create a new one with <code>systemd-machine-id-setup</code>
</li>
</ul>
<p>If the mirrored Arch installation may be used within a different configuration or with another hardware, consider the following additional operations:
</p>
<ul>
<li>Use the CPU <a href="../en/Microcode.html" title="Microcode">microcode</a> update adapted to the target system during the step <a href="../en/Installation_guide.html#Boot_loader" title="Installation guide">Installation guide#Boot loader</a>
</li>
<li>If any specific <a href="../en/Xorg.html#Configuration" title="Xorg">Xorg#Configuration</a> was present on the host and may be incompatible with the target system, follow <a href="../en/Moving_an_existing_install_into_(or_out_of)_a_virtual_machine.html#Disable_any_Xorg-related_files" title="Moving an existing install into (or out of) a virtual machine">Moving an existing install into (or out of) a virtual machine#Disable any Xorg-related files</a>
</li>
<li>Make any other adjustment appropriate to the target system, like reconfiguring the network or the audio.</li>
</ul>
<h2><span class="mw-headline" id="From_a_host_running_another_Linux_distribution">From a host running another Linux distribution</span></h2>
<p>There are multiple tools which automate a large part of the steps described in the following subsections. See their respective homepages for detailed instructions.
</p>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://github.com/wick3dr0se/archstrap">archstrap</a> (Bash)</li>
<li>
<a rel="nofollow" class="external text" href="https://github.com/gh2o/digitalocean-debian-to-arch">digitalocean-debian-to-arch</a> (repartition disk, DigitalOcean specific)</li>
<li>
<a rel="nofollow" class="external text" href="https://github.com/hartwork/image-bootstrap">image-bootstrap</a> (Python)</li>
<li>
<a rel="nofollow" class="external text" href="https://gitlab.com/drizzt/vps2arch">vps2arch</a> (Bash)</li>
</ul>
<p>The manual way is presented in the following subsections. The idea is to either get <a href="../en/Pacman.html" title="Pacman">pacman</a> working directly on the host system, or to run an Arch system inside the host system, with the actual installation being executed from the Arch system. The nested system is contained inside a chroot.
</p>
<h3><span class="mw-headline" id="Using_pacman_from_the_host_system">Using pacman from the host system</span></h3>
<p><a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/pacman/pacman">Pacman</a> can be compiled on most Linux distributions, and used directly on the host system to bootstrap Arch Linux. The <a rel="nofollow" class="external text" href="https://gitlab.archlinux.org/archlinux/arch-install-scripts">arch-install-scripts</a> should run without issues directly from the downloaded sources on any recent distribution.
</p>
<p>Some distributions provide a package for <i>pacman</i> and/or <i>arch-install-scripts</i> in their official repositories which can be used for this purpose. As of July 2020, Void Linux is known to provide the <i>pacman</i> package, and Alpine Linux and Fedora are known to provide both <i>pacman</i> and <i>arch-install-scripts</i>.
</p>
<h3><span class="mw-headline" id="Creating_a_chroot">Creating a chroot</span></h3>
<p>Two methods to setup and enter the chroot are presented below, from the easiest to the most complicated. Select only one of the two methods. Then, continue at <a href="#Using_a_chroot_environment">#Using a chroot environment</a>.
</p>
<h4>
<span id="Method_A:_Using_the_bootstrap_tarball_.28recommended.29"></span><span class="mw-headline" id="Method_A:_Using_the_bootstrap_tarball_(recommended)">Method A: Using the bootstrap tarball (recommended)</span>
</h4>
<p>Download the bootstrap tarball from a <a rel="nofollow" class="external text" href="https://archlinux.org/download">mirror</a> into <code>/tmp/</code>.
</p>
<p>Download the bootstrap tarball signature from <a rel="nofollow" class="external text" href="https://archlinux.org/download/#checksums">the download page</a> and place it in the same directory. Do not download it from a mirror.
</p>
<p><a href="../en/GnuPG.html#Verify_a_signature" title="GnuPG">Verify the signature with GnuPG</a>.
</p>
<p>Extract the tarball:
</p>
<pre># tar xf <i>/path-to-bootstrap-image</i>/archlinux-bootstrap-x86_64.tar.zst --numeric-owner
</pre>
<p>Take note of the final <code>--numeric-owner</code> option, which is important for preserving correct UID and GID numbers of extracted files in case your existing Linux system uses different numbers than Arch Linux.
</p>
<p>Select a repository server by editing <code>/tmp/root.x86_64/etc/pacman.d/mirrorlist</code>.
</p>
<p>Enter the chroot:
</p>
<ul>
<li>If bash 4 or later is installed, and <i>unshare</i> supports the <code>--fork</code> and <code>--pid</code> options: <pre># /tmp/root.x86_64/bin/arch-chroot /tmp/root.x86_64/</pre>
</li>
<li>Otherwise, run the following commands:</li>
</ul>
<dl><dd><pre># mount --bind /tmp/root.x86_64 /tmp/root.x86_64
# cd /tmp/root.x86_64
# cp /etc/resolv.conf etc
# mount -t proc /proc proc
# mount --make-rslave --rbind /sys sys
# mount --make-rslave --rbind /dev dev
# mount --make-rslave --rbind /run run    # (assuming /run exists on the system)
# chroot /tmp/root.x86_64 /bin/bash
</pre></dd></dl>
<h4><span class="mw-headline" id="Method_B:_Using_the_LiveCD_image">Method B: Using the LiveCD image</span></h4>
<p>It is possible to mount the root image of the latest Arch Linux installation media and then chroot into it.  This method has the advantage of providing a working Arch Linux installation right within the host system without the need to prepare it by installing specific packages.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Before proceeding, make sure the latest version of <a rel="nofollow" class="external text" href="https://squashfs.sourceforge.net/">squashfs</a> is installed on the host system. Otherwise, errors like the following are to be expected: <code>FATAL ERROR aborting: uncompress_inode_table: failed to read block</code>.</div>
<p>The root image can be found on one of the <a rel="nofollow" class="external text" href="https://archlinux.org/download">mirrors</a> under <code>iso/latest/arch/x86_64/</code>. The squashfs format is not editable, so we unsquash the root image and mount it.
</p>
<p>To unsquash the root image, run
</p>
<pre># unsquashfs airootfs.sfs
</pre>
<p>Select a repository server by editing <code>squashfs-root/etc/pacman.d/mirrorlist</code>.
</p>
<p>Before <a href="../en/Chroot.html" class="mw-redirect" title="Change root">chrooting</a> to the unsquashed root image, we need to set up some mount points and copy the <code>resolv.conf</code> for networking.
</p>
<pre># mount --bind squashfs-root squashfs-root
# mount -t proc none squashfs-root/proc
# mount -t sysfs none squashfs-root/sys
# mount -o bind /dev squashfs-root/dev
# mount -o bind /dev/pts squashfs-root/dev/pts  ## important for pacman (for signature check)
# cp -L /etc/resolv.conf squashfs-root/etc  ## this is needed to use networking within the chroot
</pre>
<p>Now, everything is prepared to chroot into the newly installed Arch environment:
</p>
<pre># chroot squashfs-root bash
</pre>
<h3><span class="mw-headline" id="Using_a_chroot_environment">Using a chroot environment</span></h3>
<p>The bootstrap environment is really barebones (no <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nano">nano</a></span> or <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=lvm2">lvm2</a></span>). Therefore, we need to set up pacman in order to download other necessary packages.
</p>
<h4><span class="mw-headline" id="Initializing_pacman_keyring">Initializing pacman keyring</span></h4>
<p>Before starting the installation, pacman keys need to be setup. Run the following commands:
</p>
<pre># pacman-key --init
# pacman-key --populate
</pre>
<p>See <a href="../en/Pacman/Package_signing.html#Initializing_the_keyring" title="Pacman/Package signing">pacman/Package signing#Initializing the keyring</a> for details.
</p>
<h4><span class="mw-headline" id="Downloading_basic_tools">Downloading basic tools</span></h4>
<p><a href="../en/Mirrors.html#Force_pacman_to_refresh_the_package_lists" title="Mirrors">Refresh the package lists</a> and <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> what you need: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=base-devel">base-devel</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=parted">parted</a></span> etc.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-clear.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs language, wiki syntax or style improvements. See <a href="../en/Help:Style.html" title="Help:Style">Help:Style</a> for reference.</b></p>
<div>
<b>Reason:</b> This error is explained within <span class="plainlinks archwiki-template-man" title="$ man 8 arch-chroot"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/arch-chroot.8#DESCRIPTION">arch-chroot(8) § DESCRIPTION</a></span>, it should be linked there. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Install_Arch_Linux_from_existing_Linux.html">Talk:Install Arch Linux from existing Linux</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> When you try to install packages with pacman, you might get <code><i>error: could not determine cachedir mount point /var/cache/pacman/pkg</i></code>. To workaround it, run <pre># mount --bind <i>directory-to-livecd-or-bootstrap</i> <i>directory-to-livecd-or-bootstrap</i></pre> before chrooting. See <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/46169">FS#46169</a>.</div>
<h3><span class="mw-headline" id="Installation_tips">Installation tips</span></h3>
<p>You can now proceed to <a href="../en/Installation_guide.html#Mount_the_file_systems" title="Installation guide">Installation guide#Mount the file systems</a> and follow the rest of the <a href="../en/Installation_guide.html" title="Installation guide">Installation guide</a>.
</p>
<p>Some host systems or configurations may require certain extra steps. See the sections below for tips.
</p>
<h4><span class="mw-headline" id="Debian-based_host">Debian-based host</span></h4>
<h5>
<span id=".2Fdev.2Fshm"></span><span class="mw-headline" id="/dev/shm">/dev/shm</span>
</h5>
<p>On some Debian-based host systems, <i>pacstrap</i> may produce the following error:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># pacstrap -K /mnt base</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">==&gt; Creating install root at /mnt
mount: mount point /mnt/dev/shm is a symbolic link to nowhere
==&gt; ERROR: failed to setup API filesystems in new root
</pre>
<p>This is because in some versions of Debian, <code>/dev/shm</code> points to <code>/run/shm</code> while in the Arch-based chroot, <code>/run/shm</code> does not exist and the link is broken. To correct this error, create a directory <code>/run/shm</code>:
</p>
<pre># mkdir /run/shm
</pre>
<h5>
<span id=".2Fdev.2Fpts"></span><span class="mw-headline" id="/dev/pts">/dev/pts</span>
</h5>
<p>While installing <code>archlinux-2015.07.01-x86_64</code> from a Debian 7 host, the following error prevented both <span class="plainlinks archwiki-template-man" title="$ man 8 pacstrap"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/pacstrap.8">pacstrap(8)</a></span> and <a href="../en/Chroot.html#Using_arch-chroot" class="mw-redirect" title="Change root">arch-chroot</a> from working:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># pacstrap -K -i /mnt</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">mount: mount point /mnt/dev/pts does not exist
==&gt; ERROR: failed to setup chroot /mnt
</pre>
<p>Apparently, this is because these two scripts use a common function. <code>chroot_setup()</code><a rel="nofollow" class="external autonumber" href="https://github.com/archlinux/arch-install-scripts/tree/master/common#L76">[1]</a> relies on newer features of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=util-linux">util-linux</a></span>, which are incompatible with Debian 7 userland (see <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/45737">FS#45737</a>).
</p>
<p>The solution for <i>pacstrap</i> is to manually execute its <a rel="nofollow" class="external text" href="https://github.com/archlinux/arch-install-scripts/tree/master/pacstrap.in#L77">various tasks</a>, but use the <a href="../en/Chroot.html#Using_chroot" class="mw-redirect" title="Change root">regular procedure</a> to mount the kernel filesystems on the target directory (<code>"$newroot"</code>):
</p>
<pre># newroot=/mnt
# mkdir -m 0755 -p "$newroot"/var/{cache/pacman/pkg,lib/pacman,log} "$newroot"/{dev,run,etc}
# mkdir -m 1777 -p "$newroot"/tmp
# mkdir -m 0555 -p "$newroot"/{sys,proc}
# mount --bind "$newroot" "$newroot"
# mount -t proc /proc "$newroot/proc"
# mount --rbind /sys "$newroot/sys"
# mount --rbind /run "$newroot/run"
# mount --rbind /dev "$newroot/dev"
# pacman -r "$newroot" --cachedir="$newroot/var/cache/pacman/pkg" -Sy base base-devel ... ## add the packages you want
# cp -a /etc/pacman.d/gnupg "$newroot/etc/pacman.d/"       ## copy keyring
# cp -a /etc/pacman.d/mirrorlist "$newroot/etc/pacman.d/"  ## copy mirrorlist
</pre>
<p>Instead of using <i>arch-chroot</i> for <a href="../en/Installation_guide.html#Chroot" title="Installation guide">Installation guide#Chroot</a>, simply use:
</p>
<pre># chroot "$newroot"
</pre>
<h4><span class="mw-headline" id="Fedora-based_host">Fedora-based host</span></h4>
<p>On Fedora based hosts and live USBs you may encounter problems when using <i>genfstab</i> to generate your <a href="../en/Fstab.html" title="Fstab">fstab</a>. Remove duplicate entries and the "seclabel" option where it appears, as this is Fedora-specific and will keep your system from booting normally.
</p>
<h2><span class="mw-headline" id="Things_to_check_before_you_reboot">Things to check before you reboot</span></h2>
<p>Before rebooting, doublecheck a few details in your installation to achieve a successful installation. To do so, first chroot into the newly-installed system, and then:
</p>
<ul>
<li>
<a href="../en/Users_and_groups.html#User_management" title="Users and groups">create a user with password</a>, so you can login via <i>ssh</i>. This is critical since root login is disabled by default since OpenSSH-7.1p2.</li>
<li>
<a href="../en/Users_and_groups.html#User_management" title="Users and groups">set a root password</a> so that you can switch to root via <i>su</i> later</li>
<li>
<a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> a <a href="../en/Secure_Shell.html" class="mw-redirect" title="Ssh">ssh</a> solution and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> its server instance to start automatically at boot.</li>
<li>set up your <a href="../en/Network_configuration.html" title="Network configuration">network configuration</a>  in order to have a connection started automatically at boot.</li>
<li>set up a <a href="../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> and configure it to use the swap partition you appropriated earlier as the root partition. You might want to configure your bootloader to be able to boot into your old system; it is helpful to re-use the server's existing <code>/boot</code> partition in the new system for this purpose.</li>
</ul>
<h2><span class="mw-headline" id="Replacing_the_existing_system_without_a_LiveCD">Replacing the existing system without a LiveCD</span></h2>
<p>Find ~700 MB of free space somewhere on the disk, e.g. by partitioning a swap partition. You can disable the swap partition and set up your system there.
</p>
<h3><span class="mw-headline" id="Set_old_swap_partition_as_new_root_partition">Set old swap partition as new root partition</span></h3>
<p>Check <code>cfdisk</code>, <code>/proc/swaps</code> or <code>/etc/fstab</code> to find your swap partition. Assuming your hard drive is located on <code>sda<i>X</i></code> (<code><i>X</i></code> will be a number). 
</p>
<p>Do the following:
</p>
<p>Disable the swap space:
</p>
<pre># swapoff /dev/sda<i>X</i>
</pre>
<p>Create a filesystem on it
</p>
<pre># fdisk /dev/sda
(set /dev/sda<i>X</i> ID field to "Linux" - Hex 83)
# mke2fs -j /dev/sda<i>X</i>
</pre>
<p>Create a directory to mount it in
</p>
<pre># mkdir /mnt/newsys
</pre>
<p>Finally, mount the new directory for installing the intermediate system.
</p>
<pre># mount -t ext4 /dev/sda<i>X</i> /mnt/newsys
</pre>
<h3><span class="mw-headline" id="Installation">Installation</span></h3>
<p><a href="../en/Installation_guide.html#Install_essential_packages" title="Installation guide">Install essentials packages</a> and any other package required to get a system with internet connection up and running in the temporary partition, being careful with the limit of ~700 MB space. When specifying packages to be installed with <i>pacstrap</i>, consider adding the <code>-c</code> flag to avoid filling up valuable space by downloading packages to the host system.
</p>
<p>Once the new Arch Linux system is installed, fix the bootloader configuration, then reboot into the newly created system, and <a href="../en/Rsync.html#Full_system_backup" title="Rsync">rsync the entire system</a> to the primary partition.
</p>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Installation_process.html" title="Category:Installation process">Installation process</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden category: <ul><li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Style.html" title="Category:Pages or sections flagged with Template:Style">Pages or sections flagged with Template:Style</a></li></ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Install_Arch_Linux_from_existing_Linux&amp;oldid=813053">https://wiki.archlinux.org/index.php?title=Install_Arch_Linux_from_existing_Linux&amp;oldid=813053</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 29 July 2024, at 06:17.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
