<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Unified Extensible Firmware Interface/Secure Boot - ArchWiki</title>
<link rel="stylesheet" href="../../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Unified_Extensible_Firmware_Interface_Secure_Boot rootpage-Unified_Extensible_Firmware_Interface skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Checking_Secure_Boot_status" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Checking_Secure_Boot_status">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Checking Secure Boot status</div>
		</a>
		
			<button aria-controls="toc-Checking_Secure_Boot_status-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Checking Secure Boot status subsection</span>
			</button>
		
		<ul id="toc-Checking_Secure_Boot_status-sublist" class="vector-toc-list">
			<li id="toc-Before_booting_the_OS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Before_booting_the_OS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.1</span>Before booting the OS</div>
			</a>
			
			<ul id="toc-Before_booting_the_OS-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-After_booting_the_OS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#After_booting_the_OS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">1.2</span>After booting the OS</div>
			</a>
			
			<ul id="toc-After_booting_the_OS-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Booting_an_installation_medium" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Booting_an_installation_medium">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Booting an installation medium</div>
		</a>
		
			<button aria-controls="toc-Booting_an_installation_medium-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Booting an installation medium subsection</span>
			</button>
		
		<ul id="toc-Booting_an_installation_medium-sublist" class="vector-toc-list">
			<li id="toc-Disabling_Secure_Boot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Disabling_Secure_Boot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Disabling Secure Boot</div>
			</a>
			
			<ul id="toc-Disabling_Secure_Boot-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Repacking_the_installation_image" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Repacking_the_installation_image">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Repacking the installation image</div>
			</a>
			
			<ul id="toc-Repacking_the_installation_image-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Editing_the_installation_medium" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Editing_the_installation_medium">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Editing the installation medium</div>
			</a>
			
			<ul id="toc-Editing_the_installation_medium-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Implementing_Secure_Boot" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Implementing_Secure_Boot">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Implementing Secure Boot</div>
		</a>
		
			<button aria-controls="toc-Implementing_Secure_Boot-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Implementing Secure Boot subsection</span>
			</button>
		
		<ul id="toc-Implementing_Secure_Boot-sublist" class="vector-toc-list">
			<li id="toc-Using_your_own_keys" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_your_own_keys">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>Using your own keys</div>
			</a>
			
			<ul id="toc-Using_your_own_keys-sublist" class="vector-toc-list">
				<li id="toc-Backing_up_current_variables" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Backing_up_current_variables">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.1</span>Backing up current variables</div>
			</a>
			
			<ul id="toc-Backing_up_current_variables-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-Putting_firmware_in_"Setup_Mode"' class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href='#Putting_firmware_in_"Setup_Mode"'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.2</span>Putting firmware in "Setup Mode"</div>
			</a>
			
			<ul id='toc-Putting_firmware_in_"Setup_Mode"-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Assisted_process_with_sbctl" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Assisted_process_with_sbctl">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.3</span>Assisted process with sbctl</div>
			</a>
			
			<ul id="toc-Assisted_process_with_sbctl-sublist" class="vector-toc-list">
				<li id="toc-Creating_and_enrolling_keys" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Creating_and_enrolling_keys">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.3.1</span>Creating and enrolling keys</div>
			</a>
			
			<ul id="toc-Creating_and_enrolling_keys-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Signing" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Signing">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.3.2</span>Signing</div>
			</a>
			
			<ul id="toc-Signing-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Automatic_signing_with_the_pacman_hook" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Automatic_signing_with_the_pacman_hook">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.3.3</span>Automatic signing with the pacman hook</div>
			</a>
			
			<ul id="toc-Automatic_signing_with_the_pacman_hook-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Manual_process" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Manual_process">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4</span>Manual process</div>
			</a>
			
			<ul id="toc-Manual_process-sublist" class="vector-toc-list">
				<li id="toc-Install_efitools" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Install_efitools">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4.1</span>Install efitools</div>
			</a>
			
			<ul id="toc-Install_efitools-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Creating_keys" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Creating_keys">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4.2</span>Creating keys</div>
			</a>
			
			<ul id="toc-Creating_keys-sublist" class="vector-toc-list">
				<li id="toc-Helper_script" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Helper_script">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4.2.1</span>Helper script</div>
			</a>
			
			<ul id="toc-Helper_script-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Enrolling_keys_in_firmware" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Enrolling_keys_in_firmware">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4.3</span>Enrolling keys in firmware</div>
			</a>
			
			<ul id="toc-Enrolling_keys_in_firmware-sublist" class="vector-toc-list">
				<li id="toc-Using_sbkeysync" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Using_sbkeysync">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4.3.1</span>Using sbkeysync</div>
			</a>
			
			<ul id="toc-Using_sbkeysync-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_firmware_setup_utility" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Using_firmware_setup_utility">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4.3.2</span>Using firmware setup utility</div>
			</a>
			
			<ul id="toc-Using_firmware_setup_utility-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_KeyTool" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Using_KeyTool">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4.3.3</span>Using KeyTool</div>
			</a>
			
			<ul id="toc-Using_KeyTool-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_systemd-boot" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Using_systemd-boot">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4.3.4</span>Using systemd-boot</div>
			</a>
			
			<ul id="toc-Using_systemd-boot-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Signing_EFI_binaries" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Signing_EFI_binaries">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4.4</span>Signing EFI binaries</div>
			</a>
			
			<ul id="toc-Signing_EFI_binaries-sublist" class="vector-toc-list">
				<li id="toc-With_sbsigntools" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#With_sbsigntools">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4.4.1</span>With sbsigntools</div>
			</a>
			
			<ul id="toc-With_sbsigntools-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Signing_the_kernel_with_a_mkinitcpio_post_hook" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Signing_the_kernel_with_a_mkinitcpio_post_hook">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4.4.2</span>Signing the kernel with a mkinitcpio post hook</div>
			</a>
			
			<ul id="toc-Signing_the_kernel_with_a_mkinitcpio_post_hook-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Signing_unified_kernel_images_with_a_mkinitcpio_post_hook" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Signing_unified_kernel_images_with_a_mkinitcpio_post_hook">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4.4.3</span>Signing unified kernel images with a mkinitcpio post hook</div>
			</a>
			
			<ul id="toc-Signing_unified_kernel_images_with_a_mkinitcpio_post_hook-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Fully_automated_unified_kernel_generation_and_signing_with_sbupdate" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Fully_automated_unified_kernel_generation_and_signing_with_sbupdate">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.4.5</span>Fully automated unified kernel generation and signing with sbupdate</div>
			</a>
			
			<ul id="toc-Fully_automated_unified_kernel_generation_and_signing_with_sbupdate-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Updating_keys" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Updating_keys">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.5</span>Updating keys</div>
			</a>
			
			<ul id="toc-Updating_keys-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Dual_booting_with_other_operating_systems" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Dual_booting_with_other_operating_systems">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.6</span>Dual booting with other operating systems</div>
			</a>
			
			<ul id="toc-Dual_booting_with_other_operating_systems-sublist" class="vector-toc-list">
				<li id="toc-Microsoft_Windows" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Microsoft_Windows">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1.6.1</span>Microsoft Windows</div>
			</a>
			
			<ul id="toc-Microsoft_Windows-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Using_a_signed_boot_loader" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_a_signed_boot_loader">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Using a signed boot loader</div>
			</a>
			
			<ul id="toc-Using_a_signed_boot_loader-sublist" class="vector-toc-list">
				<li id="toc-PreLoader" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#PreLoader">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.1</span>PreLoader</div>
			</a>
			
			<ul id="toc-PreLoader-sublist" class="vector-toc-list">
				<li id="toc-Set_up_PreLoader" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Set_up_PreLoader">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.1.1</span>Set up PreLoader</div>
			</a>
			
			<ul id="toc-Set_up_PreLoader-sublist" class="vector-toc-list">
				<li id="toc-Fallback" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Fallback">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.1.1.1</span>Fallback</div>
			</a>
			
			<ul id="toc-Fallback-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-How_to_use_while_booting?" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#How_to_use_while_booting?">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.1.2</span>How to use while booting?</div>
			</a>
			
			<ul id="toc-How_to_use_while_booting?-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Remove_PreLoader" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Remove_PreLoader">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.1.3</span>Remove PreLoader</div>
			</a>
			
			<ul id="toc-Remove_PreLoader-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Delete_enrolled_hash" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Delete_enrolled_hash">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.1.4</span>Delete enrolled hash</div>
			</a>
			
			<ul id="toc-Delete_enrolled_hash-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-shim" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#shim">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.2</span>shim</div>
			</a>
			
			<ul id="toc-shim-sublist" class="vector-toc-list">
				<li id="toc-Set_up_shim" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Set_up_shim">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.2.1</span>Set up shim</div>
			</a>
			
			<ul id="toc-Set_up_shim-sublist" class="vector-toc-list">
				<li id="toc-shim_with_hash" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#shim_with_hash">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.2.1.1</span>shim with hash</div>
			</a>
			
			<ul id="toc-shim_with_hash-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-shim_with_key" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#shim_with_key">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.2.1.2</span>shim with key</div>
			</a>
			
			<ul id="toc-shim_with_key-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-shim_with_key_and_GRUB" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#shim_with_key_and_GRUB">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.2.1.3</span>shim with key and GRUB</div>
			</a>
			
			<ul id="toc-shim_with_key_and_GRUB-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Delete_enrolled_hash/key" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Delete_enrolled_hash/key">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.2.2</span>Delete enrolled hash/key</div>
			</a>
			
			<ul id="toc-Delete_enrolled_hash/key-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Remove_shim" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Remove_shim">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2.2.3</span>Remove shim</div>
			</a>
			
			<ul id="toc-Remove_shim-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Protecting_Secure_Boot" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Protecting_Secure_Boot">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Protecting Secure Boot</div>
		</a>
		
		<ul id="toc-Protecting_Secure_Boot-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Tips and tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-ISO_repacking" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#ISO_repacking">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>ISO repacking</div>
			</a>
			
			<ul id="toc-ISO_repacking-sublist" class="vector-toc-list">
				<li id="toc-Sign_the_official_ISO_with_custom_keys" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Sign_the_official_ISO_with_custom_keys">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.1</span>Sign the official ISO with custom keys</div>
			</a>
			
			<ul id="toc-Sign_the_official_ISO_with_custom_keys-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Replacing_the_boot_loader_with_PreLoader" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Replacing_the_boot_loader_with_PreLoader">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.2</span>Replacing the boot loader with PreLoader</div>
			</a>
			
			<ul id="toc-Replacing_the_boot_loader_with_PreLoader-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Sign_the_official_ISO_with_a_Machine_Owner_Key_for_shim" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Sign_the_official_ISO_with_a_Machine_Owner_Key_for_shim">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.3</span>Sign the official ISO with a Machine Owner Key for shim</div>
			</a>
			
			<ul id="toc-Sign_the_official_ISO_with_a_Machine_Owner_Key_for_shim-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Enrolling_Option_ROM_digests" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Enrolling_Option_ROM_digests">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>Enrolling Option ROM digests</div>
			</a>
			
			<ul id="toc-Enrolling_Option_ROM_digests-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Unified Extensible Firmware Interface/Secure Boot</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 2 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-2" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">2 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Unified_Extensible_Firmware_Interface/%E3%82%BB%E3%82%AD%E3%83%A5%E3%82%A2%E3%83%96%E3%83%BC%E3%83%88" title="Unified Extensible Firmware Interface/セキュアブート – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Unified_Extensible_Firmware_Interface/Secure_Boot" title="Unified Extensible Firmware Interface/Secure Boot – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"><div class="subpages">&lt; <a href="../../en/Unified_Extensible_Firmware_Interface.html" title="Unified Extensible Firmware Interface">Unified Extensible Firmware Interface</a>
</div></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../../en/Arch_boot_process.html" title="Arch boot process">Arch boot process</a></li>
<li><a href="../../en/Unified_Extensible_Firmware_Interface.html" title="Unified Extensible Firmware Interface">Unified Extensible Firmware Interface</a></li>
<li><a href="../../en/Security.html" title="Security">Security</a></li>
</ul>
</div>
<p><a href="https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface#Secure_Boot" class="extiw" title="wikipedia:Unified Extensible Firmware Interface">Secure Boot</a> is a security feature found in the <a href="../../en/Unified_Extensible_Firmware_Interface.html" class="mw-redirect" title="UEFI">UEFI</a> standard, designed to add a layer of protection to the <a href="../../en/Arch_boot_process.html" title="Arch boot process">pre-boot process</a>: by maintaining a cryptographically signed list of binaries authorized or forbidden to run at boot, it helps in improving the confidence that the machine core boot components (boot manager, kernel, initramfs) have not been tampered with.
</p>
<p>As such it can be seen as a continuation or complement to the efforts in <a href="../../en/Security.html" title="Security">securing</a> one's computing environment, reducing the attack surface that other software security solutions such as <a href="../../en/Dm-crypt/Encrypting_an_entire_system.html" title="Dm-crypt/Encrypting an entire system">system encryption</a> cannot easily <a href="../../en/Dm-crypt/Encrypting_an_entire_system.html#Encrypted_boot_partition_(GRUB)" title="Dm-crypt/Encrypting an entire system">cover</a>, while being totally distinct and not dependent on them. Secure Boot just stands on its own as a component of current security practices, with its own set of pros and <a href="https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface#Secure_Boot_2" class="extiw" title="wikipedia:Unified Extensible Firmware Interface">cons</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> For a deeper overview about Secure Boot in Linux, see <a rel="nofollow" class="external text" href="https://www.rodsbooks.com/efi-bootloaders/secureboot.html">Rodsbooks' Secure Boot</a> article and <a href="#See_also">other online resources</a>. This article focuses on how to set up Secure Boot in Arch Linux.</div>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Checking_Secure_Boot_status">Checking Secure Boot status</span></h2>
<h3><span class="mw-headline" id="Before_booting_the_OS">Before booting the OS</span></h3>
<p>At this point, one has to look at the firmware setup. If the machine was booted and is running, in most cases it will have to be rebooted.
</p>
<p>You may access the firmware configuration by pressing a special key during the boot process. The key to use depends on the firmware. It is usually one of <code>Esc</code>, <code>F2</code>, <code>Del</code> or possibly another <code>F<i>n</i></code> key. Sometimes the right key is displayed for a short while at the beginning of the boot process. The motherboard manual usually records it. You might want to press the key, and keep pressing it, immediately following powering on the machine, even before the screen actually displays anything.
</p>
<p>After entering the firmware setup, be careful not to change any settings without prior intention. Usually there are navigation instructions, and short help for the settings, at the bottom of each setup screen. The setup itself might be composed of several pages. You will have to navigate to the correct place. The interesting setting might be simply denoted by secure boot, which can be set on or off.
</p>
<h3><span class="mw-headline" id="After_booting_the_OS">After booting the OS</span></h3>
<p>An easy way to check Secure Boot status on systems using <a href="../../en/Systemd.html" title="Systemd">systemd</a> is to use <a href="../../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a>:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> There is no need to be using systemd-boot as your boot manager for this command to work, it is more akin to the others *ctl systemd utilities (localectl, timedatectl...) and will not touch your configuration.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ bootctl</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">System:
      Firmware: UEFI 2.80 (American Megatrends 5.26)
 Firmware Arch: x64
   Secure Boot: enabled (user)
  TPM2 Support: yes
  Measured UKI: yes
  Boot into FW: supported
...
</pre>
<p>Here we see that Secure Boot is enabled and enforced (in user mode); other values are <code>disabled (setup)</code> for Setup Mode, <code>disabled (disabled)</code> if Secure Boot is disabled and <code>disabled (unsupported)</code> if the firmware does not feature Secure Boot.
</p>
<p>Another way to check whether the machine was booted with Secure Boot is to use this command:
</p>
<pre>$ od --address-radix=n --format=u1 /sys/firmware/efi/efivars/SecureBoot-8be4df61-93ca-11d2-aa0d-00e098032b8c
</pre>
<p>If Secure Boot is enabled, this command returns <code>1</code> as the final integer in a list of five, for example:
</p>
<pre>6  0  0  0  1
</pre>
<p>Note, however, that the kernel may be unaware of Secure Boot (even if it is enabled in the firmware) if an insufficiently capable boot loader is used. This can be verified by checking the kernel messages shortly after the system starts up:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># dmesg | grep -i secure</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[    0.013442] Secure boot disabled
[    0.013442] Secure boot could not be determined
</pre>
<p>The kernel messages will otherwise read <code>Secure boot enabled</code>.
</p>
<h2><span class="mw-headline" id="Booting_an_installation_medium">Booting an installation medium</span></h2>
<p>The official installation image does not support Secure Boot (<a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/53864">FS#53864</a>). Secure Boot support was initially added in <code>archlinux-2013.07.01-dual.iso</code> and later removed in <code>archlinux-2016.06.01-dual.iso</code>. At that time <i>prebootloader</i> was replaced with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=efitools">efitools</a></span>, even though the latter uses unsigned EFI binaries. There has been no support for Secure Boot in the official installation medium ever since.
</p>
<p>In order to boot an installation medium in a Secure Boot system, you will need to either disable Secure Boot or modify the image in order to add a signed boot loader.
</p>
<p><a rel="nofollow" class="external text" href="https://archboot.com">Archboot</a> images provide a way to use secure boot on installation media.
</p>
<h3><span class="mw-headline" id="Disabling_Secure_Boot">Disabling Secure Boot</span></h3>
<p>The Secure Boot feature can be disabled via the UEFI firmware interface. How to access the firmware configuration is described in <a href="#Before_booting_the_OS">#Before booting the OS</a>.
</p>
<p>If using a hotkey did not work and you can boot Windows, you can force a reboot into the firmware configuration in the following way (for Windows 10): <i>Settings &gt; Update &amp; Security &gt; Recovery &gt; Advanced startup (Restart now) &gt; Troubleshoot &gt; Advanced options &gt; UEFI Firmware settings &gt; restart</i>.
</p>
<p>Note that some motherboards (this is the case in a Packard Bell laptop and recent Xiaomi laptops) only allow to disable secure boot if you have set an administrator password (that can be removed afterwards). See also <a rel="nofollow" class="external text" href="https://www.rodsbooks.com/efi-bootloaders/secureboot.html#disable">Rod Smith's Disabling Secure Boot</a>.
</p>
<h3><span class="mw-headline" id="Repacking_the_installation_image">Repacking the installation image</span></h3>
<p>See <a href="#ISO_repacking">#ISO repacking</a>.
</p>
<h3><span class="mw-headline" id="Editing_the_installation_medium">Editing the installation medium</span></h3>
<p>If you are using a <a href="../../en/USB_flash_installation_medium.html" title="USB flash installation medium">USB flash installation medium</a>, then it is possible to manually edit the <a href="../../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a> on the medium to add support for Secure Boot.
</p>
<p>Plug in the USB drive, then <a href="../../en/File_systems.html#Mount_a_file_system" class="mw-redirect" title="Mount">mount</a> the partition:
</p>
<pre># mount /dev/disk/by-label/ARCHISO_EFI /mnt
</pre>
<p>Then follow the instructions in <a href="#Using_a_signed_boot_loader">#Using a signed boot loader</a> to install any signed boot loader. For example, to install <a href="#PreLoader">#PreLoader</a>:
</p>
<pre># mv /mnt/EFI/BOOT/BOOTx64.EFI /mnt/EFI/BOOT/loader.efi
# cp /usr/share/preloader-signed/PreLoader.efi /mnt/EFI/BOOT/BOOTx64.EFI
# cp /usr/share/preloader-signed/HashTool.efi /mnt/EFI/BOOT/HashTool.efi
</pre>
<h2><span class="mw-headline" id="Implementing_Secure_Boot">Implementing Secure Boot</span></h2>
<p>There are certain conditions making for an ideal setup of <i>Secure boot</i>:
</p>
<ol>
<li>UEFI considered mostly trusted (despite having some well known <a href="https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface#Criticism" class="extiw" title="wikipedia:Unified Extensible Firmware Interface">criticisms</a> and vulnerabilities<a rel="nofollow" class="external autonumber" href="https://www.uefi.org/sites/default/files/resources/UEFI%20Firmware%20-%20Security%20Concerns%20and%20Best%20Practices.pdf">[1]</a>) and necessarily <a href="#Protecting_Secure_Boot">protected by a strong password</a>
</li>
<li>Default manufacturer/third party keys are not in use, as they have been shown to weaken the security model of Secure Boot by a great margin<a rel="nofollow" class="external autonumber" href="https://habr.com/ru/post/446238/">[2]</a>
</li>
<li>UEFI directly loads a user-signed <a href="../../en/EFISTUB.html" title="EFISTUB">EFISTUB</a>-compatible <a href="../../en/Unified_kernel_image.html" title="Unified kernel image">unified kernel image</a> (no boot manager), including microcode (if applicable) and initramfs so as to maintain throughout the boot process the chain of trust established by Secure Boot and reduce the attack surface</li>
<li>Use of <a href="../../en/Dm-crypt/Encrypting_an_entire_system.html" title="Dm-crypt/Encrypting an entire system">full drive encryption</a>, so that the tools and files involved in the kernel image creation and signing process cannot be accessed and tampered with by someone having physical access to the machine.</li>
<li>Some further improvements may be obtained by using a <a href="../../en/Trusted_Platform_Module.html" class="mw-redirect" title="TPM">TPM</a>, although tooling and support makes this harder to implement.</li>
</ol>
<p>A simple and fully self-reliant setup is described in <a href="#Using_your_own_keys">#Using your own keys</a>, while <a href="#Using_a_signed_boot_loader">#Using a signed boot loader</a> makes use of intermediate tools signed by a third-party.
</p>
<p>Using the <a href="../../en/GRUB.html" title="GRUB">GRUB</a> bootloader requires extra steps before enabling secure boot, see <a href="../../en/GRUB.html#Secure_Boot_support" title="GRUB">GRUB#Secure Boot support</a> for details.
</p>
<h3><span class="mw-headline" id="Using_your_own_keys">Using your own keys</span></h3>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Replacing the platform keys with your own can end up bricking hardware on some machines, including laptops, making it impossible to get into the firmware settings to rectify the situation. This is due to the fact that some device (e.g GPU) firmware (<a href="https://en.wikipedia.org/wiki/OpROM" class="extiw" title="wikipedia:OpROM">OpROMs</a>), that get executed during boot, <a href="#Microsoft_Windows">are signed using Microsoft 3rd Party UEFI CA certificate</a>.</div>
<p>Secure Boot implementations use these keys:
</p>
<dl>
<dt>Platform Key (PK)</dt>
<dd>Top-level key.</dd>
<dt>Key Exchange Key (KEK)</dt>
<dd>Keys used to sign Signatures Database and Forbidden Signatures Database updates.</dd>
<dt>Signature Database (db)</dt>
<dd>Contains keys and/or hashes of allowed EFI binaries.</dd>
<dt>Forbidden Signatures Database (dbx)</dt>
<dd>Contains keys and/or hashes of denylisted EFI binaries.</dd>
</dl>
<p>See <a rel="nofollow" class="external text" href="https://blog.hansenpartnership.com/the-meaning-of-all-the-uefi-keys/">The Meaning of all the UEFI Keys</a> for a more detailed explanation.
</p>
<p>To use Secure Boot you need at least <b>PK</b>, <b>KEK</b> and <b>db</b> keys. While you can add multiple KEK, db and dbx certificates, only one Platform Key is allowed.
</p>
<p>Once Secure Boot is in "User Mode" keys can only be updated by signing the update (using <i>sign-efi-sig-list</i>) with a higher level key. Platform key can be signed by itself.
</p>
<h4><span class="mw-headline" id="Backing_up_current_variables">Backing up current variables</span></h4>
<p>Before creating new keys and modifying EFI variables, it is advisable to backup the current variables, so that they may be restored in case of error.
</p>
<p><a href="../../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=efitools">efitools</a></span> package, then run the following commands to backup all four of the principal Secure Boot variables:
</p>
<pre>$ for var in PK KEK db dbx ; do efi-readvar -v $var -o old_${var}.esl ; done
</pre>
<p>If you perform this command on a new computer or motherboard, the variables you extract will most likely be the ones provided by Microsoft.
</p>
<h4>
<span id="Putting_firmware_in_.22Setup_Mode.22"></span><span class="mw-headline" id='Putting_firmware_in_"Setup_Mode"'>Putting firmware in "Setup Mode"</span>
</h4>
<p>Secure Boot is in Setup Mode when the Platform Key is removed. To put firmware in Setup Mode, enter firmware setup utility and find an option to delete or clear certificates. How to enter the setup utility is described in <a href="#Before_booting_the_OS">#Before booting the OS</a>.
</p>
<h4><span class="mw-headline" id="Assisted_process_with_sbctl">Assisted process with sbctl</span></h4>
<p><a rel="nofollow" class="external text" href="https://github.com/Foxboron/sbctl">sbctl</a> is a user-friendly way of setting up secure boot and signing files.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> sbctl does not work with all hardware. How well it will work depends on the manufacturer.</div>
<p>To use it, <a href="../../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sbctl">sbctl</a></span>. See also the <a rel="nofollow" class="external text" href="https://github.com/Foxboron/sbctl#sbctl---secure-boot-manager">upstream README</a> and <span class="plainlinks archwiki-template-man" title="$ man 8 sbctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sbctl.8">sbctl(8)</a></span>.
</p>
<h5><span class="mw-headline" id="Creating_and_enrolling_keys">Creating and enrolling keys</span></h5>
<p>Before starting, go to your firmware settings and set secure boot mode to <a href='#Putting_firmware_in_"Setup_Mode"'>Setup mode</a>. This is different for each device: see <span class="plainlinks archwiki-template-man" title="$ man 8 sbctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sbctl.8#USAGE">sbctl(8) § USAGE</a></span>.
</p>
<p>Once you log back in, check the secure boot status:
</p>
<pre>$ sbctl status
</pre>
<p>You should see that sbctl is not installed and secure boot is disabled.
</p>
<p>Then create your custom secure boot keys:
</p>
<pre># sbctl create-keys
</pre>
<p>Enroll your keys, with Microsoft's keys, to the UEFI:
</p>
<pre># sbctl enroll-keys -m
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Some firmware is signed and verified with Microsoft's keys when secure boot is enabled. Not validating devices could brick them. To enroll your keys without enrolling Microsoft's, run: <code>sbctl enroll-keys</code>. Only do this if you know what you are doing.</div>
<p>Check the secure boot status again:
</p>
<pre>$ sbctl status
</pre>
<p>sbctl should be installed now, but secure boot will not work until the boot files have been signed with the keys you just created.
</p>
<h5><span class="mw-headline" id="Signing">Signing</span></h5>
<p>Check what files need to be signed for secure boot to work:
</p>
<pre># sbctl verify
</pre>
<p>Now sign all the unsigned files. Usually the <a href="../../en/Kernel.html" title="Kernel">kernel</a> and the <a href="../../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> need to be signed. For example:
</p>
<pre># sbctl sign -s /boot/vmlinuz-linux
# sbctl sign -s /boot/EFI/BOOT/BOOTX64.EFI
</pre>
<p>The files that need to be signed will depend on your system's layout, kernel and boot loader.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> Especially if you are dual-booting with Windows, there may be a lot of files that need to be signed. The process of signing all needed files using sbctl can be done with <a href="../../en/Core_utilities.html#Essentials" class="mw-redirect" title="Sed">sed</a>:
<pre># sbctl verify | sed 's/✗ /sbctl sign -s /e'
</pre>
<p>This example assumes that the outputted file paths are relative to <code>/boot</code>.
</p>
</div>
<p>Now you are done! Reboot your system and turn secure boot back on in the firmware settings. If the boot loader and OS load, secure boot should be working. Check with:
</p>
<pre>$ sbctl status
</pre>
<h5><span class="mw-headline" id="Automatic_signing_with_the_pacman_hook">Automatic signing with the pacman hook</span></h5>
<p>sbctl comes with a <a href="../../en/Pacman.html#Hooks" class="mw-redirect" title="Pacman hook">pacman hook</a> that automatically signs all new files whenever the <a href="../../en/Kernel.html" class="mw-redirect" title="Linux kernel">Linux kernel</a>, <a href="../../en/Systemd.html" title="Systemd">systemd</a> or the <a href="../../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> is updated.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If you use <a href="../../en/Systemd-boot.html" title="Systemd-boot">Systemd-boot</a> and <code>systemd-boot-update.service</code>, the <a href="../../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> is only updated after a reboot, and the sbctl <a href="../../en/Pacman.html#Hooks" class="mw-redirect" title="Pacman hook">pacman hook</a> will therefore not sign the new file. As a workaround, it can be useful to sign the <a href="../../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> directly in <code>/usr/lib/</code>, as <code>bootctl install</code> and <code>update</code> will automatically recognize and copy <i>.efi.signed</i> files to the <a href="../../en/EFI_system_partition.html" class="mw-redirect" title="ESP">ESP</a> if present, instead of the normal <i>.efi</i> file. See <span class="plainlinks archwiki-template-man" title="$ man 1 bootctl"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/bootctl.1">bootctl(1)</a></span>.
<pre># sbctl sign -s -o /usr/lib/systemd/boot/efi/systemd-bootx64.efi.signed /usr/lib/systemd/boot/efi/systemd-bootx64.efi
</pre>
</div>
<h4><span class="mw-headline" id="Manual_process">Manual process</span></h4>
<h5><span class="mw-headline" id="Install_efitools">Install efitools</span></h5>
<p>Nearly all of the following sections require you to <a href="../../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=efitools">efitools</a></span> package.
</p>
<h5><span class="mw-headline" id="Creating_keys">Creating keys</span></h5>
<p>To generate keys, perform the following steps.
</p>
<p>You will need private keys and certificates in multiple formats:
</p>
<dl>
<dt><i>.key</i></dt>
<dd>PEM format <b>private</b> keys for EFI binary and EFI signature list signing.</dd>
<dt><i>.crt</i></dt>
<dd>PEM format certificates for <span class="plainlinks archwiki-template-man" title="$ man 1 sbsign"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sbsign.1">sbsign(1)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 1 sbvarsign"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sbvarsign.1">sbvarsign(1)</a></span> and <span class="plainlinks archwiki-template-man" title="$ man 1 sign-efi-sig-list"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sign-efi-sig-list.1">sign-efi-sig-list(1)</a></span>.</dd>
<dt><i>.cer</i></dt>
<dd>DER format certificates for firmware.</dd>
<dt><i>.esl</i></dt>
<dd>Certificates in an EFI Signature List for <span class="plainlinks archwiki-template-man" title="$ man 1 sbvarsign"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sbvarsign.1">sbvarsign(1)</a></span>, <span class="plainlinks archwiki-template-man" title="$ man 1 efi-updatevar"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/efi-updatevar.1">efi-updatevar(1)</a></span>, <i>KeyTool</i> and firmware.</dd>
<dt><i>.auth</i></dt>
<dd>Certificates in an EFI Signature List with an authentication header (i.e. a signed certificate update file) for <span class="plainlinks archwiki-template-man" title="$ man 1 efi-updatevar"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/efi-updatevar.1">efi-updatevar(1)</a></span>, <i>sbkeysync</i>, <i>KeyTool</i> and firmware.</dd>
</dl>
<p>Create a <a href="https://en.wikipedia.org/wiki/Globally_unique_identifier" class="extiw" title="wikipedia:Globally unique identifier">GUID</a> for owner identification:
</p>
<pre>$ uuidgen --random &gt; GUID.txt
</pre>
<p>Platform key:
</p>
<pre>$ openssl req -newkey rsa:4096 -nodes -keyout PK.key -new -x509 -sha256 -days <i>3650</i> -subj "/CN=<i>my Platform Key</i>/" -out PK.crt
$ openssl x509 -outform DER -in PK.crt -out PK.cer
$ cert-to-efi-sig-list -g "$(&lt; GUID.txt)" PK.crt PK.esl
$ sign-efi-sig-list -g "$(&lt; GUID.txt)" -k PK.key -c PK.crt PK PK.esl PK.auth
</pre>
<p>Sign an empty file to allow removing Platform Key when in "User Mode":
</p>
<pre>$ sign-efi-sig-list -g "$(&lt; GUID.txt)" -c PK.crt -k PK.key PK /dev/null noPK.auth
</pre>
<p>Key Exchange Key:
</p>
<pre>$ openssl req -newkey rsa:4096 -nodes -keyout KEK.key -new -x509 -sha256 -days <i>3650</i> -subj "/CN=<i>my Key Exchange Key</i>/" -out KEK.crt
$ openssl x509 -outform DER -in KEK.crt -out KEK.cer
$ cert-to-efi-sig-list -g "$(&lt; GUID.txt)" KEK.crt KEK.esl
$ sign-efi-sig-list -g "$(&lt; GUID.txt)" -k PK.key -c PK.crt KEK KEK.esl KEK.auth
</pre>
<p>Signature Database key:
</p>
<pre>$ openssl req -newkey rsa:4096 -nodes -keyout db.key -new -x509 -sha256 -days <i>3650</i> -subj "/CN=<i>my Signature Database key</i>/" -out db.crt
$ openssl x509 -outform DER -in db.crt -out db.cer
$ cert-to-efi-sig-list -g "$(&lt; GUID.txt)" db.crt db.esl
$ sign-efi-sig-list -g "$(&lt; GUID.txt)" -k KEK.key -c KEK.crt db db.esl db.auth
</pre>
<h6><span class="mw-headline" id="Helper_script">Helper script</span></h6>
<p>A helper/convenience script is offered by the author of the reference page on this topic<a rel="nofollow" class="external autonumber" href="https://www.rodsbooks.com/efi-bootloaders/controlling-sb.html#creatingkeys">[3]</a> (requires <a href="../../en/Python.html" title="Python">python</a>). A mildly edited version is also packaged as <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sbkeys/">sbkeys</a></span><sup><small>AUR</small></sup>.
</p>
<p>In order to use it, simply create a folder in a secure location (e.g. <code>/etc/efi-keys/</code> if later use of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sbupdate-git/">sbupdate-git</a></span><sup><small>AUR</small></sup> to automate unified kernel image creation and signing is planned) and run it:
</p>
<pre># mkdir /etc/efi-keys
# cd !$
# curl -L -O <a rel="nofollow" class="external free" href="https://www.rodsbooks.com/efi-bootloaders/mkkeys.sh">https://www.rodsbooks.com/efi-bootloaders/mkkeys.sh</a>
# chmod +x mkkeys.sh
# ./mkkeys.sh
<i>Enter a Common Name to embed in the keys, e.g. "Secure Boot"</i>
</pre>
<p>This will produce the required files in different formats.
</p>
<h5><span class="mw-headline" id="Enrolling_keys_in_firmware">Enrolling keys in firmware</span></h5>
<p>Use one of the following methods to enroll <b>db</b>, <b>KEK</b> and <b>PK</b> certificates.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> As the <b>dbx</b> (forbidden signatures db) is empty, it can be safely left out in the following instructions.</div>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Enrolling Platform Key sets Secure Boot in "User Mode", leaving "Setup Mode", so it should be enrolled last in sequence.</div>
<h6><span class="mw-headline" id="Using_sbkeysync">Using sbkeysync</span></h6>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sbsigntools">sbsigntools</a></span>. Create a directory <code>/etc/secureboot/keys</code> with the following directory structure -
</p>
<pre>/etc/secureboot/keys
├── db
├── dbx
├── KEK
└── PK
</pre>
<p>For example using:
</p>
<pre># mkdir -p /etc/secureboot/keys/{db,dbx,KEK,PK}
</pre>
<p>Then copy each of the <i>.auth</i> files that were generated earlier into their respective locations (for example, <code>PK.auth</code> into <code>/etc/secureboot/keys/PK</code> and so on).
</p>
<p>If you want to verify the changes <code>sbkeysync</code> will make to the system's UEFI keystore, use:
</p>
<pre># sbkeysync --keystore /etc/secureboot/keys --pk --dry-run --verbose
</pre>
<p>Finally, use <code>sbkeysync</code> to enroll your keys.
</p>
<pre># sbkeysync --keystore /etc/secureboot/keys --verbose
# sbkeysync --keystore /etc/secureboot/keys --verbose --pk
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>If <code>sbkeysync</code> returns write errors, first run <code>chattr -i /sys/firmware/efi/efivars/{PK,KEK,db}*</code> prior to issuing commands with <code>sbkeysync</code> to temporarily change file attributes, enabling writing of the EFI keys within the <code>efivars</code> directory. See <span class="plainlinks archwiki-template-man" title="$ man 1 chattr"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/chattr.1">chattr(1)</a></span>.</li>
<li>If you get a <code>permission denied</code> error for <code>PK.auth</code>, you can enroll it with command <code>efi-updatevar -f /etc/secureboot/keys/PK/PK.auth PK</code>.</li>
<li>If this fails, it might be due to the firmware locking BIOS settings. On Dell &amp; Lenovo systems, you may need to reset the BIOS password: <a rel="nofollow" class="external text" href="https://www.kernel.org/doc/Documentation/ABI/testing/sysfs-class-firmware-attributes">Sysfs Firmware Authentication Documentation</a>
</li>
</ul>
<p>On Lenovo systems:
</p>
<pre># cat &gt; /sys/class/firmware-attributes/thinklmi/authentication/Admin/current_password 
my-super-secret-password
<span style="color:#ebf1f5; background-color:#222222;">^D</span>
</pre>
<p>On Dell systems:
</p>
<pre># cat &gt; /sys/class/firmware-attributes/dell-wmi-sysman/authentication/Admin/current_password 
my-super-secret-password
<span style="color:#ebf1f5; background-color:#222222;">^D</span>
</pre>
and try again.</div>
<p>On next boot the UEFI should be back in User Mode and enforcing Secure Boot policy.
</p>
<h6><span class="mw-headline" id="Using_firmware_setup_utility">Using firmware setup utility</span></h6>
<p>Copy all <code>*.cer</code>, <code>*.esl</code>, <code>*.auth</code> files (<b>except</b> the <code>noPK.auth</code> file!) to a <a href="../../en/FAT.html" title="FAT">FAT</a> formatted file system (you can use <a href="../../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a>).
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> <b>Do not</b> copy the <code>noPK.auth</code> file to the <a href="../../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a> (ESP) of your PC! If you do this, and someone e.g. steals your PC, this person can delete the personal Platform Key in the UEFI Secure Boot firmware again, turn on "Setup Mode" on your PC again and replace your Secure Boot Keys (PK, KEK, db, dbx) with their own Platform Key, thereby defeating the whole purpose of UEFI Secure Boot. Only you should be able to replace the Platform Key, so only you should have access to the <code>noPK.auth</code> file. Therefore keep the <code>noPK.auth</code> file in a secret, safe place where only you have access to. A safe place for the noPK.auth file are:
<ul>
<li>an external USB stick with an <a href="../../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a> when using <code>KeyTool</code>. Unfortunately, <code>KeyTool</code> can only read files from unencrypted storage.</li>
<li>
<a href="../../en/Data-at-rest_encryption.html" title="Data-at-rest encryption">encrypted storage on your PC</a> when using <code>sbkeysync</code>.</li>
</ul>
<p>The <a href="../../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a> of your PC must not be encrypted according to the UEFI specifications and can be mounted and read on another PC (if your PC is stolen and if the hard drive is taken out and connected to another PC). Copying the <code>noPK.auth</code> file to the ESP of your PC and deleting it afterwards is also not advisable, because deleted files on the FAT32 <a href="../../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a> <a href="../../en/File_recovery.html#TestDisk_and_PhotoRec" title="File recovery">can be recovered with tools like PhotoRec</a>.
</p>
</div>
<p>Launch firmware setup utility and enroll <b>db</b>, <b>KEK</b> and <b>PK</b> certificates.
Firmwares have various different interfaces, see <a rel="nofollow" class="external text" href="https://www.rodsbooks.com/efi-bootloaders/controlling-sb.html#setuputil">Replacing Keys Using Your Firmware's Setup Utility</a> for example how to enroll keys.
</p>
<p>If the used tool supports it prefer using <i>.auth</i> and <i>.esl</i> over <i>.cer</i>.
</p>
<h6><span class="mw-headline" id="Using_KeyTool">Using KeyTool</span></h6>
<p><code>KeyTool.efi</code> is in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=efitools">efitools</a></span> package, copy it to ESP. To use it after enrolling keys, sign it with <code>sbsign</code>.
</p>
<pre># sbsign --key db.key --cert db.crt --output <i>esp</i>/KeyTool-signed.efi /usr/share/efitools/efi/KeyTool.efi
</pre>
<p>Launch <code>KeyTool-signed.efi</code> using firmware setup utility, boot loader or <a href="../../en/Unified_Extensible_Firmware_Interface.html#UEFI_Shell" title="Unified Extensible Firmware Interface">UEFI Shell</a> and enroll keys.
</p>
<p>See <a rel="nofollow" class="external text" href="https://www.rodsbooks.com/efi-bootloaders/controlling-sb.html#keytool">Replacing Keys Using KeyTool</a> for explanation of KeyTool menu options.
</p>
<h6><span class="mw-headline" id="Using_systemd-boot">Using systemd-boot</span></h6>
<p>Since systemd version 252, <a href="../../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a> can be used to enroll keys. To enroll keys, copy the <code>db.auth</code>, <code>KEK.auth</code> and <code>PK.auth</code> to the special folder on the ESP:
</p>
<pre># cp db.auth KEK.auth PK.auth <i>esp</i>/loader/keys/<i>NAME</i>/
</pre>
<p>Where <i>NAME</i> can be any unique name you assign, such as <code>MYKEYS</code>.
</p>
<p>After copying the keys and enabling the secure boot setup mode a new entry would appear in the boot menu that would read <code>Enroll Secure Boot keys: MYKEYS</code>. Activating this entry would enroll the secure boot keys.
</p>
<h5><span class="mw-headline" id="Signing_EFI_binaries">Signing EFI binaries</span></h5>
<p>When <i>Secure Boot</i> is active (i.e. in "User Mode"), only signed EFI binaries (e.g. applications, <a href="../../en/Unified_Extensible_Firmware_Interface.html#UEFI_drivers" title="Unified Extensible Firmware Interface">drivers</a>, <a href="../../en/Unified_kernel_image.html" title="Unified kernel image">unified kernel images</a>) can be launched.
</p>
<h6><span class="mw-headline" id="With_sbsigntools">With sbsigntools</span></h6>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sbsigntools">sbsigntools</a></span> to sign EFI binaries with <span class="plainlinks archwiki-template-man" title="$ man 1 sbsign"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sbsign.1">sbsign(1)</a></span>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> 
<ul>
<li>To check if a binary is signed and list its signatures use <code>sbverify --list <i>/path/to/binary</i></code>.</li>
<li>The <a href="../../en/REFInd.html" title="REFInd">rEFInd</a> boot manager's <code>refind-install</code> script can sign rEFInd EFI binaries and copy them together with the db certificates to the ESP. See <a href="../../en/REFInd.html#Using_your_own_keys" title="REFInd">rEFInd#Using your own keys</a> for instructions.</li>
</ul>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If running <i>sbsign</i> without <code>--output</code> the resulting file will be <code><i>filename</i>.signed</code>. See <span class="plainlinks archwiki-template-man" title="$ man 1 sbsign"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sbsign.1">sbsign(1)</a></span> for more information.</div>
<p>To sign your kernel and boot manager use <i>sbsign</i>, e.g.:
</p>
<pre># sbsign --key db.key --cert db.crt --output /boot/vmlinuz-linux /boot/vmlinuz-linux
# sbsign --key db.key --cert db.crt --output <i>esp</i>/EFI/BOOT/BOOTx64.EFI <i>esp</i>/EFI/BOOT/BOOTx64.EFI
</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Signing kernel only will not protect the initramfs from tampering. See <a href="../../en/Unified_kernel_image.html" title="Unified kernel image">Unified kernel image</a> to know how to produce a combined image that you can then manually sign with <i>sbsign</i>.</div>
<h6><span class="mw-headline" id="Signing_the_kernel_with_a_mkinitcpio_post_hook">Signing the kernel with a mkinitcpio post hook</span></h6>
<p>You can also use a <a href="../../en/Mkinitcpio.html#Post_hooks" title="Mkinitcpio">mkinitcpio post hook</a> to sign the kernel when the initramfs gets generated.
</p>
<p><a href="../../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Create">Create</a> the following file an make it <a href="../../en/Help:Reading.html#Make_executable" class="mw-redirect" title="Executable">executable</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/post/kernel-sbsign</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/env bash

kernel="$1"
[[ -n "$kernel" ]] || exit 0

# use already installed kernel if it exists
[[ ! -f "$KERNELDESTINATION" ]] || kernel="$KERNELDESTINATION"

keypairs=(<i>/path/to/</i>db.key <i>/path/to/</i>db.crt)

for (( i=0; i&lt;${#keypairs[@]}; i+=2 )); do
    key="${keypairs[$i]}" cert="${keypairs[(( i + 1 ))]}"
    if ! sbverify --cert "$cert" "$kernel" &amp;&gt;/dev/null; then
        sbsign --key "$key" --cert "$cert" --output "$kernel" "$kernel"
    fi
done</pre>
<p>Replace <code><i>/path/to/</i>db.key</code> and <code><i>/path/to/</i>db.crt</code> with the paths to the key pair you want to use for signing the kernel.
</p>
<p>If you are using systemd-boot, there is a <a href="../../en/Systemd-boot.html#Automatic_update" title="Systemd-boot">dedicated pacman hook</a> doing this task semi-automatically.
</p>
<h6><span class="mw-headline" id="Signing_unified_kernel_images_with_a_mkinitcpio_post_hook">Signing unified kernel images with a mkinitcpio post hook</span></h6>
<p>See <a href="../../en/Unified_kernel_image.html#Signing_the_UKIs_for_Secure_Boot" title="Unified kernel image">Unified kernel image#Signing the UKIs for Secure Boot</a>.
</p>
<h5><span class="mw-headline" id="Fully_automated_unified_kernel_generation_and_signing_with_sbupdate">Fully automated unified kernel generation and signing with sbupdate</span></h5>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> <i>sbupdate</i> <a rel="nofollow" class="external text" href="https://github.com/andreyv/sbupdat">upstream repository</a><sup title="Last check status: 404">[<a href="https://en.wikipedia.org/wiki/Wikipedia:Link_rot" class="extiw" title="wikipedia:Wikipedia:Link rot">dead link</a> 2024-07-30 ⓘ]</sup> has been archived as of August 2023. Moreover, it was created long before <a href="../../en/Mkinitcpio.html" title="Mkinitcpio">mkinitcpio</a> and other <a href="../../en/Arch_boot_process.html#initramfs" class="mw-redirect" title="Initramfs">initramfs</a> generators acquired the ability to generate <a href="../../en/Unified_kernel_image.html" title="Unified kernel image">unified kernel images</a>, providing much appreciated ease to this formerly cumbersome process. Nowadays, consider using instead the <a href="#Assisted_process_with_sbctl">#Assisted process with sbctl</a>. (Discuss in <a rel="nofollow" class="external text" href="../../en/Talk:Unified_Extensible_Firmware_Interface/Secure_Boot.html">Talk:Unified Extensible Firmware Interface/Secure Boot</a>)</div>
</div>
<p><a rel="nofollow" class="external text" href="https://github.com/andreyv/sbupdate">sbupdate</a> is a tool made specifically to automate unified kernel image generation and signing on Arch Linux. It handles installation, removal and updates of kernels through <a href="../../en/Pacman.html#Hooks" class="mw-redirect" title="Pacman hooks">pacman hooks</a>.
</p>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/sbupdate-git/">sbupdate-git</a></span><sup><small>AUR</small></sup> and configure it following the instructions given on the project's homepage.<a rel="nofollow" class="external autonumber" href="https://github.com/andreyv/sbupdate#sbupdate">[4]</a>
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If using <a href="../../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a>, set <code>OUT_DIR="EFI/Linux"</code> to get your signed kernel images directly recognized without needing configuration. See <span class="plainlinks archwiki-template-man" title="$ man 7 systemd-boot"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd-boot.7#FILES">systemd-boot(7) § FILES</a></span> and <a href="../../en/Systemd-boot.html#Adding_loaders" title="Systemd-boot">systemd-boot#Adding loaders</a>.</div>
<p>Once configured, simply run <code>sbupdate</code> as root for first-time image generation.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <i>sbupdate</i> output often contains errors such as <code>warning: data remaining[26413568 vs 26423180]: gaps between PE/COFF sections?</code>. Those are harmless and can be safely ignored.<a rel="nofollow" class="external autonumber" href="https://github.com/andreyv/sbupdate/issues/30">[5]</a>
</div>
<h4><span class="mw-headline" id="Updating_keys">Updating keys</span></h4>
<p>Once Secure Boot is in "User Mode" any changes to KEK, db and dbx need to be signed with a higher level key.
</p>
<p>For example, if you wanted to replace your db key with a new one:
</p>
<ol>
<li>
<a href="#Creating_keys">Create the new key</a>,</li>
<li>Convert it to EFI Signature List,</li>
<li>Sign the EFI Signature List,</li>
<li>Enroll the signed certificate update file.</li>
</ol>
<pre>$ cert-to-efi-sig-list -g "$(&lt; GUID.txt)" <i>new_db</i>.crt <i>new_db</i>.esl
$ sign-efi-sig-list -g "$(&lt; GUID.txt)" -k KEK.key -c KEK.crt db <i>new_db</i>.esl <i>new_db</i>.auth
</pre>
<p>If instead of replacing your db key, you want to <b>add</b> another one to the Signature Database, you need to use the option <code>-a</code> (see <span class="plainlinks archwiki-template-man" title="$ man 1 sign-efi-sig-list"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/sign-efi-sig-list.1">sign-efi-sig-list(1)</a></span>):
</p>
<pre>$ sign-efi-sig-list <b>-a</b> -g "$(&lt; GUID.txt)" -k KEK.key -c KEK.crt db <i>new_db</i>.esl <i>new_db</i>.auth
</pre>
<p>When <code><i>new_db</i>.auth</code> is created, <a href="#Enrolling_keys_in_firmware">enroll it</a>.
</p>
<h4><span class="mw-headline" id="Dual_booting_with_other_operating_systems">Dual booting with other operating systems</span></h4>
<h5><span class="mw-headline" id="Microsoft_Windows">Microsoft Windows</span></h5>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Is it possible to boot Windows by signing its bootloader with a <a href="#Creating_keys">custom key</a>? (Discuss in <a href="../../en/Talk:Unified_Extensible_Firmware_Interface/Secure_Boot.html#Booting_Windows_with_custom_bootloader_signature" title="Talk:Unified Extensible Firmware Interface/Secure Boot">Talk:Unified Extensible Firmware Interface/Secure Boot#Booting Windows with custom bootloader signature</a>)</div>
</div>
<p>It is usually <b>not</b> possible to boot Windows by signing its bootloader (<code>EFI/Microsoft/Boot/bootmgfw.efi</code>) with a <a href="#Creating_keys">custom, personal key</a> with Secure Boot Mode enabled, without enrolling the "Microsoft Windows Production PCA 2011" key in the UEFI Secure Boot variables:
</p>
<ul>
<li>if <code>bootmgfw.efi</code> contains a signature <b>both</b> from the "Microsoft Windows Production PCA 2011" <b>and</b> from your own Secure Boot db key (so <b>two signatures</b>), then UEFI firmware implementations like  <i>INSYDE Corp. 4096.01 (UEFI Version 2.31, Version F.70, Release Date: 07/18/2016, BIOS Revision 15.112, Firmware Revision: 29.66)</i> will not launch <code>bootmgfw.efi</code> and will throw a security violation error (<b><code>Selected boot image did not authenticate. Press ENTER to continue.</code></b>): UEFI firmware implementation like this can probably only read the <b>first</b> signature - not the <b>second</b> one. Only the certificate for the second signature is enrolled in the UEFI Secure Boot variables, so the Secure Boot verification fails.</li>
<li>if the "Microsoft Windows Production PCA 2011" signature from the <code>bootmgfw.efi</code> file is stripped/removed, and only a signature from your own Secure Boot db key is added to the file, then UEFI will launch the file - but Windows will launch a recovery/repair environment: Windows complains that the Windows installation is broken (because the "Microsoft Windows Production PCA 2011" signature on <code>bootmgfw.efi</code> file is missing).</li>
</ul>
<p>So to <a href="../../en/Dual_boot_with_Windows.html" title="Dual boot with Windows">dual boot with Windows</a>,
</p>
<ul>
<li>you either have to add the hash of <code>bootmgfw.efi</code> to the list of allowed hashes in the <code>db</code> variable; and you have to update the <code>db</code> variable every time a Windows Update changes <code>bootmgfw.efi</code>. This is very tedious, error-prone and not supported by Microsoft; and for example BitLocker will not work properly anymore with this setup (BitLocker will ask for your recovery password every time to decrypt your Windows partition).</li>
<li>or you have to add Microsoft's certificates to the UEFI Secure Boot variables <a rel="nofollow" class="external text" href="https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/windows-secure-boot-key-creation-and-management-guidance#14-signature-databases-db-and-dbx">Microsoft has four db certificates and two KEK certificates</a>:
<ul>
<li>The <a rel="nofollow" class="external text" href="https://www.microsoft.com/pkiops/certs/MicWinProPCA2011_2011-10-19.crt">Microsoft Windows Production PCA 2011 certificate</a> and <a rel="nofollow" class="external text" href="https://www.microsoft.com/pkiops/certs/windows%20uefi%20ca%202023.crt">Windows UEFI CA 2023</a> must be included in the <code>db</code> variable in order to allow the Windows Operating System to load.</li>
<li>The <a rel="nofollow" class="external text" href="https://www.microsoft.com/pkiops/certs/MicCorUEFCA2011_2011-06-27.crt">Microsoft Corporation UEFI CA 2011 certificate</a> and <a rel="nofollow" class="external text" href="https://www.microsoft.com/pkiops/certs/microsoft%20uefi%20ca%202023.crt">Microsoft UEFI CA 2023</a> aka the Microsoft 3rd Party UEFI CA certificates should be included in the <code>db</code> variable in order to use third-party binaries like UEFI drivers, option ROMs, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=shim">shim</a></span>,  etc.</li>
<li>The <a rel="nofollow" class="external text" href="https://www.microsoft.com/pkiops/certs/MicCorKEKCA2011_2011-06-24.crt">Microsoft Corporation KEK CA 2011 certificate</a> and <a rel="nofollow" class="external text" href="https://www.microsoft.com/pkiops/certs/microsoft%20corporation%20kek%202k%20ca%202023.crt">Microsoft Corporation KEK 2K CA 2023</a> should be included in the <code>KEK</code> variable, in order to "enable revocation of bad images by updating the <code>dbx</code> and potentially for updating <code>db</code> to prepare for newer Windows signed images". However, Windows will also boot without them.</li>
</ul>
</li>
</ul>
<p>Create EFI Signature Lists from Microsoft's DER format <code>db</code> certificates using Microsoft's GUID (<code>77fa9abd-0359-4d32-bd60-28f4e78f784b</code>) and combine them in one file for simplicity:
</p>
<pre>$ sbsiglist --owner 77fa9abd-0359-4d32-bd60-28f4e78f784b --type x509 --output MS_Win_db_2011.esl MicWinProPCA2011_2011-10-19.crt
$ sbsiglist --owner 77fa9abd-0359-4d32-bd60-28f4e78f784b --type x509 --output MS_Win_db_2023.esl 'windows uefi ca 2023.crt'
$ sbsiglist --owner 77fa9abd-0359-4d32-bd60-28f4e78f784b --type x509 --output MS_UEFI_db_2011.esl MicCorUEFCA2011_2011-06-27.crt
$ sbsiglist --owner 77fa9abd-0359-4d32-bd60-28f4e78f784b --type x509 --output MS_UEFI_db_2023.esl 'microsoft uefi ca 2023.crt'
$ cat MS_Win_db_2011.esl MS_Win_db_2023.esl MS_UEFI_db_2011.esl MS_UEFI_db_2023.esl &gt; MS_db.esl
</pre>
<p>Optional (for strict conformity with Microsoft UEFI Secure Boot requirements): Create an EFI Signature List from Microsoft's DER format <code>KEK</code> certificates using Microsoft's GUID (<code>77fa9abd-0359-4d32-bd60-28f4e78f784b</code>):
</p>
<pre>$ sbsiglist --owner 77fa9abd-0359-4d32-bd60-28f4e78f784b --type x509 --output MS_Win_KEK_2011.esl MicCorKEKCA2011_2011-06-24.crt
$ sbsiglist --owner 77fa9abd-0359-4d32-bd60-28f4e78f784b --type x509 --output MS_Win_KEK_2023.esl 'microsoft corporation kek 2k ca 2023.crt'
$ cat MS_Win_KEK_2011.esl MS_Win_KEK_2023.esl &gt; MS_Win_KEK.esl
</pre>
<p>Sign a <code>db</code> variable update with your <code>KEK</code>. Use <code>sign-efi-sig-list</code> with option <code>-a</code> to <b>add</b> not replace a <code>db</code> certificate:
</p>
<pre>$ sign-efi-sig-list -a -g 77fa9abd-0359-4d32-bd60-28f4e78f784b -k KEK.key -c KEK.crt db MS_db.esl add_MS_db.auth
</pre>
<p>Optional (for strict conformity with Microsoft UEFI Secure Boot requirements): Sign a <code>KEK</code> variable update with your <code>PK</code>. Use <code>sign-efi-sig-list</code> with option <code>-a</code> to <b>add</b> not replace a <code>KEK</code> certificate:
</p>
<pre>$ sign-efi-sig-list -a -g 77fa9abd-0359-4d32-bd60-28f4e78f784b -k PK.key -c PK.crt KEK MS_Win_KEK.esl add_MS_Win_KEK.auth
</pre>
<p>Follow <a href="#Enrolling_keys_in_firmware">#Enrolling keys in firmware</a> to enroll <code>add_MS_db.auth</code> and for strict conformity with Microsoft UEFI Secure Boot requirements <code>add_MS_Win_KEK.auth</code> into the UEFI Secure Boot Database variables.
</p>
<h3><span class="mw-headline" id="Using_a_signed_boot_loader">Using a signed boot loader</span></h3>
<p>Using a signed boot loader means using a boot loader signed with Microsoft's key. There are two known signed boot loaders: PreLoader and shim. Their purpose is to chainload other EFI binaries (usually <a href="../../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loaders</a>). Since Microsoft would never sign a boot loader that automatically launches any unsigned binary, PreLoader and shim use an allowlist called Machine Owner Key list, abbreviated MokList. If the SHA256 hash of the binary (Preloader and shim) or key the binary is signed with (shim) is in the MokList they execute it, if not they launch a key management utility which allows enrolling the hash or key.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> What Microsoft calls "Secured-core PCs" do not ship with Microsoft 3rd Party UEFI CA certificate (Microsoft Corporation UEFI CA 2011 or Microsoft UEFI CA 2023) enrolled.<a rel="nofollow" class="external autonumber" href="https://docs.microsoft.com/en-us/windows/security/information-protection/secure-the-windows-10-boot-process#secure-boot">[6]</a>. The only enrolled DB certificate is the Microsoft Windows Production PCA 2011 certificate which is exclusively used to sign the Windows boot loader.
<p>The enrollment of the Microsoft 3rd Party UEFI CA certificate needs to be enabled in firmware settings to launch EFI binaries and OpROMs signed with this certificate.
</p>
</div>
<h4><span class="mw-headline" id="PreLoader">PreLoader</span></h4>
<p>When run, PreLoader tries to launch <code>loader.efi</code>. If the hash of <code>loader.efi</code> is not in MokList, PreLoader will launch <code>HashTool.efi</code>. In HashTool you must enroll the hash of the EFI binaries you want to launch, that means your <a href="../../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> (<code>loader.efi</code>) and kernel.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Each time you update any of the binaries (e.g. boot loader or kernel) you will need to enroll their new hash.</div>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The <a href="../../en/REFInd.html" title="REFInd">rEFInd</a> boot manager's <code>refind-install</code> script can copy the rEFInd and PreLoader EFI binaries to the ESP. See <a href="../../en/REFInd.html#Using_PreLoader" title="REFInd">rEFInd#Using PreLoader</a> for instructions.</div>
<h5><span class="mw-headline" id="Set_up_PreLoader">Set up PreLoader</span></h5>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> <code>PreLoader.efi</code> and <code>HashTool.efi</code> in <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=efitools">efitools</a></span> package are not signed, so their usefulness is limited. You can get a signed <code>PreLoader.efi</code> and <code>HashTool.efi</code> from <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/preloader-signed/">preloader-signed</a></span><sup><small>AUR</small></sup> or <a rel="nofollow" class="external text" href="https://blog.hansenpartnership.com/linux-foundation-secure-boot-system-released/">download them manually</a>.</div>
<p><a href="../../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/preloader-signed/">preloader-signed</a></span><sup><small>AUR</small></sup> and copy <code>PreLoader.efi</code> and <code>HashTool.efi</code> to the <a href="../../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> directory; for <a href="../../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a> use:
</p>
<pre># cp /usr/share/preloader-signed/{PreLoader,HashTool}.efi <i>esp</i>/EFI/systemd
</pre>
<p>Now copy over the boot loader binary and rename it to <code>loader.efi</code>; for <a href="../../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a> use:
</p>
<pre># cp <i>esp</i>/EFI/systemd/systemd-bootx64.efi <i>esp</i>/EFI/systemd/loader.efi
</pre>
<p>Finally, create a new NVRAM entry to boot <code>PreLoader.efi</code>:
</p>
<pre># efibootmgr --unicode --disk /dev/sd<i><b>X</b></i> --part <i><b>Y</b></i> --create --label "PreLoader" --loader /EFI/systemd/PreLoader.efi
</pre>
<p>Replace <code><i>X</i></code> with the drive letter and replace <code><i>Y</i></code> with the partition number of the <a href="../../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a>.
</p>
<p>This entry should be added to the list as the first to boot; check with the <code>efibootmgr</code> command and adjust the boot-order if necessary.
</p>
<h6><span class="mw-headline" id="Fallback">Fallback</span></h6>
<p>If there are problems booting the custom NVRAM entry, copy <code>HashTool.efi</code> and <code>loader.efi</code> to the default loader location booted automatically by UEFI systems:
</p>
<pre># cp /usr/share/preloader-signed/HashTool.efi <i>esp</i>/EFI/BOOT/
# cp <i>esp</i>/EFI/systemd/systemd-bootx64.efi <i>esp</i>/EFI/BOOT/loader.efi
</pre>
<p>Copy over <code>PreLoader.efi</code> and rename it:
</p>
<pre># cp /usr/share/preloader-signed/PreLoader.efi <i>esp</i>/EFI/BOOT/BOOTx64.EFI
</pre>
<p>For particularly intransigent UEFI implementations, copy <code>PreLoader.efi</code> to the default loader location used by Windows systems:
</p>
<pre># mkdir -p <i>esp</i>/EFI/Microsoft/Boot
# cp /usr/share/preloader-signed/PreLoader.efi <i>esp</i>/EFI/Microsoft/Boot/bootmgfw.efi
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If dual-booting with Windows, backup the original <code>bootmgfw.efi</code> first as replacing it may cause problems with Windows updates.</div>
<p>As before, copy <code>HashTool.efi</code> and <code>loader.efi</code> to <code><i>esp</i>/EFI/Microsoft/Boot/</code>.
</p>
<p>When the system starts with Secure Boot enabled, follow the steps above to enroll <code>loader.efi</code> and <code>/vmlinuz-linux</code> (or whichever kernel image is being used).
</p>
<h5>
<span id="How_to_use_while_booting.3F"></span><span class="mw-headline" id="How_to_use_while_booting?">How to use while booting?</span>
</h5>
<p>A message will show up that says <code>Failed to Start loader... I will now execute HashTool.</code> To use HashTool for enrolling the hash of <code>loader.efi</code> and <code>vmlinuz.efi</code>, follow these steps. These steps assume titles for a remastered archiso installation media. The exact titles you will get depends on your boot loader setup.
</p>
<ul>
<li>Select <i>OK</i>
</li>
<li>In the HashTool main menu, select <i>Enroll Hash</i>, choose <code>\loader.efi</code> and confirm with <i>Yes</i>. Again, select <i>Enroll Hash</i> and <code>archiso</code> to enter the archiso directory, then select <code>vmlinuz.efi</code> and confirm with <i>Yes</i>. Then choose <i>Exit</i> to return to the boot device selection menu.</li>
<li>In the boot device selection menu choose <i>Arch Linux archiso x86_64 UEFI CD</i>
</li>
</ul>
<h5><span class="mw-headline" id="Remove_PreLoader">Remove PreLoader</span></h5>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Since you are going to remove stuff, is a good idea to backup it.</div>
<p><a href="../../en/Pacman.html#Removing_packages" class="mw-redirect" title="Uninstall">Uninstall</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/preloader-signed/">preloader-signed</a></span><sup><small>AUR</small></sup> and simply remove the copied files and revert configuration; for <a href="../../en/Systemd-boot.html" title="Systemd-boot">systemd-boot</a> use:
</p>
<pre># rm <i>esp</i>/EFI/systemd/{PreLoader,HashTool}.efi
# rm <i>esp</i>/EFI/systemd/loader.efi
# efibootmgr --unicode --bootnum <i>N</i> --delete-bootnum
# bootctl update
</pre>
<p>Where <code><i>N</i></code> is the NVRAM boot entry created for booting <code>PreLoader.efi</code>.
Check with the <i>efibootmgr</i> command and adjust the boot-order if necessary.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The above commands cover the easiest case; if you have created, copied, renamed or edited further files probably you have to handle with them, too. If PreLoader was your operational boot entry, you obviously also need to <a href="#Disabling_Secure_Boot">#Disabling Secure Boot</a>.</div>
<h5><span class="mw-headline" id="Delete_enrolled_hash">Delete enrolled hash</span></h5>
<p>Every entry of hashes enrolled in the MOK database eats up a little piece of space of NVRAM. You may want to delete useless hashes to free the space and to prevent outdated programs from booting.
</p>
<p><a href="../../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=efitools">efitools</a></span> and copy <code>KeyTool.efi</code>:
</p>
<pre># cp /usr/share/efitools/efi/KeyTool.efi <i>esp</i>/EFI/systemd/KeyTool.efi
</pre>
<p>Manage to boot to Preloader and you will see the KeyTool entry. You can then edit hashes in the MOK database.
</p>
<h4><span class="mw-headline" id="shim">shim</span></h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Testing needed. (Discuss in <a href="../../en/Talk:Unified_Extensible_Firmware_Interface/Secure_Boot.html#shim" title="Talk:Unified Extensible Firmware Interface/Secure Boot">Talk:Unified Extensible Firmware Interface/Secure Boot#shim</a>)</div>
</div>
<p>When run, shim tries to launch <code>grubx64.efi</code>. If MokList does not contain the hash of <code>grubx64.efi</code> or the key it is signed with, shim will launch MokManager (<code>mmx64.efi</code>). In MokManager you must enroll the hash of the EFI binaries you want to launch (your <a href="../../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> (<code>grubx64.efi</code>) and kernel) or enroll the key they are signed with.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> 
<ul>
<li>If you use <a href="#shim_with_hash">#shim with hash</a>, each time you update any of the binaries (e.g. boot loader or kernel) you will need to enroll their new hash.</li>
<li>Since version 15.3, shim will not launch EFI binaries without a valid <code>.sbat</code> section. Run <code>objdump -j .sbat -s <i>/path/to/binary.efi</i></code> to verify if an EFI binary has it. See the <a rel="nofollow" class="external text" href="https://github.com/rhboot/shim/blob/main/SBAT.md">SBAT documentation</a> for details.</li>
<li>If you are not actually interested in the security brought by Secure Boot and are only enabling it to meet the requirements posed by Windows 11, you may want to consider disabling the validation process in shim with <code>mokutil --disable-validation</code>. In that case you will not need to sign grub (sbat probably still needed) or the kernel images and at the same time be able to boot Windows with <code>chainloader</code> in grub.</li>
</ul>
</div>
<h5><span class="mw-headline" id="Set_up_shim">Set up shim</span></h5>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The <a href="../../en/REFInd.html" title="REFInd">rEFInd</a> boot manager's <code>refind-install</code> script can sign rEFInd EFI binaries and copy them along with shim and the MOK certificates to the ESP. See <a href="../../en/REFInd.html#Using_shim" title="REFInd">rEFInd#Using shim</a> for instructions.</div>
<p><a href="../../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/shim-signed/">shim-signed</a></span><sup><small>AUR</small></sup>.
</p>
<p>Rename your current <a href="../../en/Arch_boot_process.html#Boot_loader" class="mw-redirect" title="Boot loader">boot loader</a> to <code>grubx64.efi</code>
</p>
<pre># mv <i>esp</i>/EFI/BOOT/BOOTx64.EFI <i>esp</i>/EFI/BOOT/grubx64.efi
</pre>
<p>Copy <i>shim</i> and <i>MokManager</i> to your boot loader directory on ESP; use previous filename of your boot loader as as the filename for <code>shimx64.efi</code>:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Make sure you do <b>not</b> copy <code>fbx64.efi</code> (which is under the same directory) unless you actually have a valid <code>bootx64.csv</code> to use. Otherwise shim will <b>not</b> execute <code>grubx64.efi</code> but will appear to fail to work and just reset the machine.</div>
<pre># cp /usr/share/shim-signed/shimx64.efi <i>esp</i>/EFI/BOOT/BOOTx64.EFI
# cp /usr/share/shim-signed/mmx64.efi <i>esp</i>/EFI/BOOT/
</pre>
<p>Finally, create a new NVRAM entry to boot <code>BOOTx64.EFI</code>:
</p>
<pre># efibootmgr --unicode --disk /dev/sd<i><b>X</b></i> --part <i><b>Y</b></i> --create --label "Shim" --loader /EFI/BOOT/BOOTx64.EFI
</pre>
<p><i>shim</i> can authenticate binaries by Machine Owner Key or hash stored in MokList.
</p>
<dl>
<dt>Machine Owner Key (MOK)</dt>
<dd>A key that a user generates and uses to sign EFI binaries.</dd>
<dt>hash</dt>
<dd>A SHA256 hash of an EFI binary.</dd>
</dl>
<p>Using hash is simpler, but each time you update your boot loader or kernel you will need to add their hashes in MokManager. With MOK you only need to add the key once, but you will have to sign the boot loader and kernel each time it updates.
</p>
<h6><span class="mw-headline" id="shim_with_hash">shim with hash</span></h6>
<p>If <i>shim</i> does not find the SHA256 hash of <code>grubx64.efi</code> in MokList it will launch MokManager (<code>mmx64.efi</code>).
</p>
<p>In <i>MokManager</i> select <i>Enroll hash from disk</i>, find <code>grubx64.efi</code> and add it to MokList. Repeat the steps and add your kernel <code>vmlinuz-linux</code>. When done select <i>Continue boot</i> and your boot loader will launch and it will be capable launching the kernel.
</p>
<h6><span class="mw-headline" id="shim_with_key">shim with key</span></h6>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sbsigntools">sbsigntools</a></span>.
</p>
<p>You will need:
</p>
<dl>
<dt><i>.key</i></dt>
<dd>PEM format <b>private</b> key for EFI binary signing.</dd>
<dt><i>.crt</i></dt>
<dd>PEM format certificate for <i>sbsign</i>.</dd>
<dt><i>.cer</i></dt>
<dd>DER format certificate for <i>MokManager</i>.</dd>
</dl>
<p>Create a Machine Owner Key:
</p>
<pre>$ openssl req -newkey rsa:2048 -nodes -keyout MOK.key -new -x509 -sha256 -days <i>3650</i> -subj "/CN=<i>my Machine Owner Key</i>/" -out MOK.crt
$ openssl x509 -outform DER -in MOK.crt -out MOK.cer
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> It seems that shim will not support adding a 4096 RSA key to the MokList (it might freeze when loading and verifying the <code>grubx64.efi</code> binary), so make sure you use a 2048 key for now. See <a href="https://wiki.debian.org/SecureBoot#Generating_a_new_key" class="extiw" title="debian:SecureBoot">Debian:SecureBoot#Generating a new key</a>.</div>
<p>Sign your boot loader (named <code>grubx64.efi</code>) and kernel:
</p>
<pre># sbsign --key MOK.key --cert MOK.crt --output /boot/vmlinuz-linux /boot/vmlinuz-linux
# sbsign --key MOK.key --cert MOK.crt --output <i>esp</i>/EFI/BOOT/grubx64.efi <i>esp</i>/EFI/BOOT/grubx64.efi
</pre>
<p>You will need to do this each time they are updated. You can automate the kernel signing with a <a href="../../en/Mkinitcpio.html#Post_hooks" title="Mkinitcpio">mkinitcpio post hook</a>. <a href="../../en/Help:Reading.html#Append,_add,_create,_edit" class="mw-redirect" title="Create">Create</a> the following file and make it <a href="../../en/Help:Reading.html#Make_executable" class="mw-redirect" title="Executable">executable</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/initcpio/post/kernel-sbsign</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/usr/bin/env bash

kernel="$1"
[[ -n "$kernel" ]] || exit 0

# use already installed kernel if it exists
[[ ! -f "$KERNELDESTINATION" ]] || kernel="$KERNELDESTINATION"

keypairs=(<i>/path/to/</i>MOK.key <i>/path/to/</i>MOK.crt)

for (( i=0; i&lt;${#keypairs[@]}; i+=2 )); do
    key="${keypairs[$i]}" cert="${keypairs[(( i + 1 ))]}"
    if ! sbverify --cert "$cert" "$kernel" &amp;&gt;/dev/null; then
        sbsign --key "$key" --cert "$cert" --output "$kernel" "$kernel"
    fi
done</pre>
<p>Copy <code>MOK.cer</code> to a <a href="../../en/FAT.html" title="FAT">FAT</a> formatted file system (you can use <a href="../../en/EFI_system_partition.html" title="EFI system partition">EFI system partition</a>).
</p>
<p>Reboot and enable Secure Boot. If <i>shim</i> does not find the certificate <code>grubx64.efi</code> is signed with in MokList it will launch MokManager (<code>mmx64.efi</code>).
</p>
<p>In <i>MokManager</i> select <i>Enroll key from disk</i>, find <code>MOK.cer</code> and add it to MokList. When done select <i>Continue boot</i> and your boot loader will launch and it will be capable launching any binary signed with your Machine Owner Key.
</p>
<h6><span class="mw-headline" id="shim_with_key_and_GRUB">shim with key and GRUB</span></h6>
<p>See <a href="../../en/GRUB.html#Shim-lock" title="GRUB">GRUB#Shim-lock</a> for instructions.
</p>
<h5>
<span id="Delete_enrolled_hash.2Fkey"></span><span class="mw-headline" id="Delete_enrolled_hash/key">Delete enrolled hash/key</span>
</h5>
<p>Every entry of hash/key enrolled in the MOK database eats up a little piece of space of NVRAM. You may want to delete useless hash/key to free the space and to prevent outdated programs from booting.
</p>
<p>MOK database can be managed with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mokutil">mokutil</a></span>
</p>
<p>List enrolled keys &amp; hashes
</p>
<pre># mokutil --list-enrolled
</pre>
<p>Remove hash from database.
The password entered here will be asked for confirmation to delete in MOK manager.
</p>
<pre># mokutil --delete-hash &lt;hash to remove from above command&gt;
Input password:
</pre>
<p>Remove key from database
</p>
<pre># mokutil --delete MOK.cer
</pre>
<p>List hashes/keys to be deleted on next reboot
</p>
<pre># mokutil --list-delete
</pre>
<p>On next reboot, MOK manager will be initiated with option to Enroll/Delete hashes/keys.
More details <span class="plainlinks archwiki-template-man" title="$ man 1 mokutil"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/mokutil.1">mokutil(1)</a></span>
</p>
<h5><span class="mw-headline" id="Remove_shim">Remove shim</span></h5>
<p><a href="../../en/Pacman.html#Removing_packages" class="mw-redirect" title="Uninstall">Uninstall</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/shim-signed/">shim-signed</a></span><sup><small>AUR</small></sup>, remove the copied <i>shim</i> and <i>MokManager</i> files and rename back your boot loader.
</p>
<h2><span class="mw-headline" id="Protecting_Secure_Boot">Protecting Secure Boot</span></h2>
<p>The only way to prevent anyone with physical access from disabling Secure Boot is to protect the firmware settings with a password. Most UEFI firmwares provide such a feature, usually listed under the "Security" section in the firmware settings.
</p>
<p>Consider enabling <a href="../../en/Security.html#Kernel_lockdown_mode" title="Security">kernel lockdown mode</a>. See <a rel="nofollow" class="external autonumber" href="https://stackoverflow.com/a/60104165">[7]</a>.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="ISO_repacking">ISO repacking</span></h3>
<p>It is possible to unpack and repack the official installation image using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=libisoburn">libisoburn</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mtools">mtools</a></span>. This way, you can create an image that supports Secure Boot, either with custom keys or with a signed boot loader.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Add instructions for repacking the ISO to include shim. (Discuss in <a rel="nofollow" class="external text" href="../../en/Talk:Unified_Extensible_Firmware_Interface/Secure_Boot.html">Talk:Unified Extensible Firmware Interface/Secure Boot</a>)</div>
</div>
<h4><span class="mw-headline" id="Sign_the_official_ISO_with_custom_keys">Sign the official ISO with custom keys</span></h4>
<p>Support for Secure Boot using custom keys can be added to the official ISO by simply extracting the boot loader (<code>BOOTx64.EFI</code> and <code>BOOTIA32.EFI</code>), kernel, UEFI shell, signing them and then repacking the ISO with the signed files.
</p>
<p>First extract the relevant files and El Torito boot images:
</p>
<pre>$ osirrox -indev archlinux-<i>YYYY.MM.DD</i>-x86_64.iso \
	-extract_boot_images ./ \
	-cpx /arch/boot/x86_64/vmlinuz-linux \
	/EFI/BOOT/BOOTx64.EFI \
	/EFI/BOOT/BOOTIA32.EFI \
	/shellx64.efi \
	/shellia32.efi ./
</pre>
<p><span class="plainlinks archwiki-template-man" title="$ man 1 xorrisofs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/xorrisofs.1">xorrisofs(1)</a></span> option <code>-rational-rock</code> as used by <i>mkarchiso</i> makes the files on ISO 9660 read-only which persists after extracting them. Make the files writable so that they can be modified:
</p>
<pre>$ chmod +w BOOTx64.EFI BOOTIA32.EFI shellx64.efi shellia32.efi vmlinuz-linux
</pre>
<p>Sign the files. To do so with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=sbsigntools">sbsigntools</a></span>, for example:
</p>
<pre>$ sbsign --key db.key --cert db.crt --output BOOTx64.EFI BOOTx64.EFI
$ sbsign --key db.key --cert db.crt --output BOOTIA32.EFI BOOTIA32.EFI
$ sbsign --key db.key --cert db.crt --output shellx64.efi shellx64.efi
$ sbsign --key db.key --cert db.crt --output shellia32.efi shellia32.efi
$ sbsign --key db.key --cert db.crt --output vmlinuz-linux vmlinuz-linux
</pre>
<p>Copy the signed EFI binaries to <code>eltorito_img2_uefi.img</code>. It will be used as the EFI system partition and will be listed as an El Torito UEFI boot image. The size of <code>eltorito_img2_uefi.img</code> is fixed, but there are 8 MiB free space added by <i>mkarchiso</i> (for the purposes of rounding/alignment, to account for reserved sectors, etc.), so the size increase from the signatures should not be an issue.
</p>
<pre>$ mcopy -D oO -i eltorito_img2_uefi.img vmlinuz-linux ::/arch/boot/x86_64/vmlinuz-linux
$ mcopy -D oO -i eltorito_img2_uefi.img BOOTx64.EFI BOOTIA32.EFI ::/EFI/BOOT/
$ mcopy -D oO -i eltorito_img2_uefi.img shellx64.efi shellia32.efi ::/
</pre>
<p>Repack the ISO using the modified El Torito UEFI boot image and add the signed EFI binaries to ISO 9660:
</p>
<pre>$ xorriso -indev archlinux-<i>YYYY.MM.DD</i>-x86_64.iso \
	-outdev archlinux-<i>YYYY.MM.DD</i>-x86_64-Secure_Boot.iso \
	-map vmlinuz-linux /arch/boot/x86_64/vmlinuz-linux \
	-map_l ./ /EFI/BOOT/ BOOTx64.EFI BOOTIA32.EFI -- \
	-map_l ./ / shellx64.efi shellia32.efi -- \
	-boot_image any replay \
	-append_partition 2 0xef eltorito_img2_uefi.img
</pre>
<p>Boot the resulting <code>archlinux-<i>YYYY.MM.DD</i>-x86_64-Secure_Boot.iso</code>.
</p>
<h4><span class="mw-headline" id="Replacing_the_boot_loader_with_PreLoader">Replacing the boot loader with PreLoader</span></h4>
<p>Another way to add Secure Boot support to the official ISO is by extracting the boot loader and replacing it with <a href="#PreLoader">#PreLoader</a>.
</p>
<p>First, extract the boot loader and the El Torito boot image:
</p>
<pre>$ osirrox -indev archlinux-<i>YYYY.MM.DD</i>-x86_64.iso \
	-extract_boot_images ./ \
	-extract /EFI/BOOT/BOOTx64.EFI loader.efi
</pre>
<p>Replace the <code>BOOTx64.efi</code> file with PreLoader:
</p>
<pre>$ cp /usr/share/preloader-signed/PreLoader.efi BOOTx64.EFI
$ cp /usr/share/preloader-signed/HashTool.efi HashTool.efi
</pre>
<p>Add the new files to the boot image:
</p>
<pre>$ mcopy -D oO -i eltorito_img2_uefi.img BOOTx64.EFI loader.efi HashTool.efi ::/EFI/BOOT/
</pre>
<p>Finally, repack the ISO using the modified boot image and the new boot loader files:
</p>
<pre>$ xorriso -indev archlinux-<i>YYYY.MM.DD</i>-x86_64.iso \
	-outdev archlinux-<i>YYYY.MM.DD</i>-x86_64-Secure_Boot.iso \
	-map_l ./ /EFI/BOOT/ BOOTx64.EFI loader.efi HashTool.efi -- \
	-boot_image any replay \
	-append_partition 2 0xef eltorito_img2_uefi.img
</pre>
<h4><span class="mw-headline" id="Sign_the_official_ISO_with_a_Machine_Owner_Key_for_shim">Sign the official ISO with a Machine Owner Key for shim</span></h4>
<p>Support for Secure Boot using shim with a Machine Owner Key (MOK) can be added to the official ISO by extracting the boot loader, kernel and UEFI shell, signing them and then repacking the ISO with the signed files and shim.
</p>
<p>First extract the relevant files and El Torito boot images. The boot loader file name will need to be <code>grubx64.efi</code> so that shim can find it.
</p>
<pre>$ osirrox -indev archlinux-<i>YYYY.MM.DD</i>-x86_64.iso \
	-extract_boot_images ./ \
	-extract /EFI/BOOT/BOOTx64.EFI grubx64.efi \
	-extract /shellx64.efi shellx64.efi \
	-extract /arch/boot/x86_64/vmlinuz-linux vmlinuz-linux
</pre>
<p><span class="plainlinks archwiki-template-man" title="$ man 1 xorrisofs"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/xorrisofs.1">xorrisofs(1)</a></span> option <code>-rational-rock</code> as used by <i>mkarchiso</i> makes the files on ISO 9660 read-only which persists after extracting them. Make the files writable so that they can be modified:
</p>
<pre>$ chmod +w grubx64.efi shellx64.efi vmlinuz-linux
</pre>
<p>Sign the files with your MOK:
</p>
<pre>$ sbsign --key MOK.key --cert MOK.crt --output grubx64.efi grubx64.efi
$ sbsign --key MOK.key --cert MOK.crt --output shellx64.efi shellx64.efi
$ sbsign --key MOK.key --cert MOK.crt --output vmlinuz-linux vmlinuz-linux
</pre>
<p>Acquire pre-signed shim EFI binaries, e.g. by installing <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/shim-signed/">shim-signed</a></span><sup><small>AUR</small></sup>. Place shim and MokManager in the current directory and change the shim EFI binary's file name to <code>BOOTx64.EFI</code>:
</p>
<pre>$ cp /usr/share/shim-signed/shimx64.efi BOOTx64.EFI
$ cp /usr/share/shim-signed/mmx64.efi ./
</pre>
<p>Copy shim, MokManager, the signed EFI binaries and the DER format MOK to <code>eltorito_img2_uefi.img</code>. It will be used as the EFI system partition and will be listed as an El Torito UEFI boot image. The size of <code>eltorito_img2_uefi.img</code> is fixed, but there are 8 MiB free space added by mkarchiso (for the purposes of rounding/alignment, to account for reserved sectors, etc.), so the size increase from the added files should not be an issue.
</p>
<pre>$ mcopy -D oO -i eltorito_img2_uefi.img vmlinuz-linux ::/arch/boot/x86_64/vmlinuz-linux
$ mcopy -D oO -i eltorito_img2_uefi.img MOK.cer shellx64.efi ::/
$ mcopy -D oO -i eltorito_img2_uefi.img BOOTx64.EFI grubx64.efi mmx64.efi ::/EFI/BOOT/
</pre>
<p>Repack the ISO using the modified El Torito UEFI boot image and add shim, MokManager, the signed EFI binaries and the DER format MOK to ISO 9660:
</p>
<pre>$ xorriso -indev archlinux-<i>YYYY.MM.DD</i>-x86_64.iso \
	-outdev archlinux-<i>YYYY.MM.DD</i>-x86_64-Secure_Boot.iso \
	-map vmlinuz-linux /arch/boot/x86_64/vmlinuz-linux \
	-map_l ./ / shellx64.efi MOK.cer -- \
	-map_l ./ /EFI/BOOT/ BOOTx64.EFI grubx64.efi mmx64.efi -- \
	-boot_image any replay \
	-append_partition 2 0xef eltorito_img2_uefi.img
</pre>
<p>Boot the resulting <code>archlinux-<i>YYYY.MM.DD</i>-x86_64-Secure_Boot.iso</code>. When MokManager launches, select <i>Enroll key from disk</i> &gt; <i>ARCHISO_EFI</i> &gt; <i>MOK.cer</i>. After enrolling the key, reboot and at the next boot, the live environment will successfully boot.
</p>
<h3><span class="mw-headline" id="Enrolling_Option_ROM_digests">Enrolling Option ROM digests</span></h3>
<p><a href="https://en.wikipedia.org/wiki/Option_ROM" class="extiw" title="wikipedia:Option ROM">Option ROMs</a> (OpROMs), i.e. device firmware that is executed during boot, must be signed for Secure Boot otherwise the devices will not be initialized. Typically OpROMs are signed with the Microsoft 3rd Party UEFI CA certificate which may prevent implementing Secure Boot with only your own keys. To solve this, the SHA256 digests of OpROMs can be enrolled instead.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Preventing essential devices from initializing by removing the Microsoft 3rd Party UEFI CA certificate can end up bricking hardware on some machines, including laptops, making it impossible to get into the firmware settings to rectify the situation.</div>
<p>On systems with a <a href="../../en/Trusted_Platform_Module.html" class="mw-redirect" title="TPM">TPM</a>, it is possible to acquire Option ROM SHA256 digests from the <a rel="nofollow" class="external text" href="https://docs.kernel.org/security/tpm/tpm_event_log.html">TPM event log</a>.
</p>
<p><a href="../../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tpm2-tools">tpm2-tools</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/digest-to-efi-sig-list/">digest-to-efi-sig-list</a></span><sup><small>AUR</small></sup>.
</p>
<p>Use <span class="plainlinks archwiki-template-man" title="$ man 1 tpm2_eventlog"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/tpm2_eventlog.1">tpm2_eventlog(1)</a></span> to read <code>/sys/kernel/security/tpm0/binary_bios_measurements</code> and look for the digests of <code>BOOT_SERVICES_DRIVER</code>.<a rel="nofollow" class="external autonumber" href="https://github.com/Foxboron/sbctl/wiki/FAQ#option-rom">[8]</a>
</p>
<p>For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># tpm2_eventlog /sys/kernel/security/tpm0/binary_bios_measurements</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
- EventNum: 9
  PCRIndex: 2
  EventType: EV_EFI_BOOT_SERVICES_DRIVER
  DigestCount: 1
  Digests:
  - AlgorithmId: sha256
    Digest: "<i><b>0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef</b></i>"
...
- EventNum: 10
  PCRIndex: 2
  EventType: EV_EFI_BOOT_SERVICES_DRIVER
  DigestCount: 1
  Digests:
  - AlgorithmId: sha256
    Digest: "<i><b>fedcba9876543210fedcba9876543210fedcba9876543210fedcba9876543210</b></i>"
...
</pre>
<p>Use <i>digest-to-efi-sig-list</i> to create an EFI signature list for each OpROM digest you find:
</p>
<pre>$ digest-to-efi-sig-list <i>0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef</i> OpROM1.esl
$ digest-to-efi-sig-list <i>fedcba9876543210fedcba9876543210fedcba9876543210fedcba9876543210</i> OpROM2.esl
</pre>
<p>In case you have multiple OpROMs, combine their EFI signature lists into one so that it could be signed as a single file:
</p>
<pre>$ cat OpROM1.esl OpROM2.esl &gt; OpROM.esl
</pre>
<p>Sign the EFI signature list for appending to the Signature Database:
</p>
<pre>$ sign-efi-sig-list -a -g "$(&lt; GUID.txt)" -k KEK.key -c KEK.crt db OpROM.esl OpROM.auth
</pre>
<p><a href="#Enrolling_keys_in_firmware">Enroll it</a>.
</p>
<p>The final and most dangerous step is to remove Microsoft 3rd Party UEFI CA certificate from the Signature Database and see if the system still boots and all devices still work.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://edk2-docs.gitbook.io/understanding-the-uefi-secure-boot-chain/">Understanding the UEFI Secure Boot Chain</a> by tianocore</li>
<li><a href="https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface#Secure_Boot" class="extiw" title="wikipedia:Unified Extensible Firmware Interface">Wikipedia:Unified Extensible Firmware Interface#Secure Boot</a></li>
<li>
<a rel="nofollow" class="external text" href="https://www.rodsbooks.com/efi-bootloaders/secureboot.html">Dealing with Secure Boot</a> by Rod Smith</li>
<li>
<a rel="nofollow" class="external text" href="https://www.rodsbooks.com/efi-bootloaders/controlling-sb.html">Controlling Secure Boot</a> by Rod Smith</li>
<li>
<a rel="nofollow" class="external text" href="https://mjg59.dreamwidth.org/5850.html">UEFI secure booting (part 2)</a> by Matthew Garrett</li>
<li>
<a rel="nofollow" class="external text" href="https://blog.hansenpartnership.com/uefi-secure-boot/">UEFI Secure Boot</a> by James Bottomley</li>
<li><a rel="nofollow" class="external text" href="https://git.kernel.org/cgit/linux/kernel/git/jejb/efitools.git/tree/README">efitools README</a></li>
<li>
<a rel="nofollow" class="external text" href="https://www.fsf.org/campaigns/secure-boot-vs-restricted-boot">Will your computer's "Secure Boot" turn out to be "Restricted Boot"?</a> — Free Software Foundation</li>
<li><a rel="nofollow" class="external text" href="https://www.fsf.org/campaigns/secure-boot-vs-restricted-boot/statement/campaigns/secure-boot-vs-restricted-boot/whitepaper-web">Free Software Foundation recommendations for free operating system distributions considering Secure Boot</a></li>
<li><a rel="nofollow" class="external text" href="https://web.archive.org/web/20150928202110/https://firmware.intel.com/messages/219">Intel's UEFI Secure Boot Tutorial</a></li>
<li><a rel="nofollow" class="external text" href="https://web.archive.org/web/20200205044007/http://dreamhack.it/linux/2015/12/03/secure-boot-signed-modules-and-signed-elf-binaries.html">Secure Boot, Signed Modules and Signed ELF Binaries</a></li>
<li>National Security Agency docs: <a rel="nofollow" class="external text" href="https://www.nsa.gov/Portals/70/documents/what-we-do/cybersecurity/professional-resources/ctr-uefi-defensive-practices-guidance.pdf">UEFI Defensive Practices Guidance</a> and unclassified <a rel="nofollow" class="external text" href="https://media.defense.gov/2020/Sep/15/2002497594/-1/-1/0/CTR-UEFI-SECURE-BOOT-CUSTOMIZATION-20200915.PDF/CTR-UEFI-SECURE-BOOT-CUSTOMIZATION-20200915.PDF">UEFI Secure Boot customization</a>
</li>
<li>
<a rel="nofollow" class="external text" href="http://jk.ozlabs.org/docs/sbkeysync-maintaing-uefi-key-databases/">sbkeysync &amp; maintaining uefi key databases</a> by Jeremy Kerr</li>
<li>
<a rel="nofollow" class="external text" href="https://nwildner.com/posts/2020-07-04-secure-your-boot-process/">Secure your boot process: UEFI + Secureboot + EFISTUB + Luks2 + lvm + Arch Linux</a> (2020-07)</li>
<li>
<a rel="nofollow" class="external text" href="https://security.stackexchange.com/questions/29122/how-is-hibernation-supported-on-machines-with-uefi-secure-boot">How is hibernation supported, on machines with UEFI Secure Boot?</a> (Security StackExchange)</li>
<li>
<a rel="nofollow" class="external text" href="https://0pointer.net/blog/authenticated-boot-and-disk-encryption-on-linux.html">Authenticated Boot and Disk Encryption on Linux</a> by Lennart Poettering (2021-09-23)</li>
<li>The tool <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/cryptboot/">cryptboot</a></span><sup><small>AUR</small></sup> simplifies the whole process and is easy to use</li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../../en/Category:Boot_process.html" title="Category:Boot process">Boot process</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../../en/Category:Pages_with_dead_links.html" title="Category:Pages with dead links">Pages with dead links</a></li>
<li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Unified_Extensible_Firmware_Interface/Secure_Boot&amp;oldid=813481">https://wiki.archlinux.org/index.php?title=Unified_Extensible_Firmware_Interface/Secure_Boot&amp;oldid=813481</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 30 July 2024, at 20:47.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
