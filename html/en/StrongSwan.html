<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>strongSwan - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-StrongSwan rootpage-StrongSwan skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Certificates" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Certificates">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Certificates</div>
		</a>
		
			<button aria-controls="toc-Certificates-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Certificates subsection</span>
			</button>
		
		<ul id="toc-Certificates-sublist" class="vector-toc-list">
			<li id="toc-Certificate_Authority" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Certificate_Authority">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.1</span>Certificate Authority</div>
			</a>
			
			<ul id="toc-Certificate_Authority-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Host_Certificate" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Host_Certificate">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.2</span>Host Certificate</div>
			</a>
			
			<ul id="toc-Host_Certificate-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Client_Certificate" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Client_Certificate">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">2.3</span>Client Certificate</div>
			</a>
			
			<ul id="toc-Client_Certificate-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-VPN_Variants" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#VPN_Variants">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>VPN Variants</div>
		</a>
		
			<button aria-controls="toc-VPN_Variants-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle VPN Variants subsection</span>
			</button>
		
		<ul id="toc-VPN_Variants-sublist" class="vector-toc-list">
			<li id="toc-IPSec_in_tunnel_mode" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#IPSec_in_tunnel_mode">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>IPSec in tunnel mode</div>
			</a>
			
			<ul id="toc-IPSec_in_tunnel_mode-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-IPSec_in_transport_mode" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#IPSec_in_transport_mode">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>IPSec in transport mode</div>
			</a>
			
			<ul id="toc-IPSec_in_transport_mode-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-IPSec/L2TP" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#IPSec/L2TP">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>IPSec/L2TP</div>
			</a>
			
			<ul id="toc-IPSec/L2TP-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Secrets" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Secrets">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Secrets</div>
		</a>
		
		<ul id="toc-Secrets-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Networking" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Networking">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Networking</div>
		</a>
		
		<ul id="toc-Networking-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Starting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Starting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Starting</div>
		</a>
		
			<button aria-controls="toc-Starting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Starting subsection</span>
			</button>
		
		<ul id="toc-Starting-sublist" class="vector-toc-list">
			<li id="toc-Running_Strongswan_in_a_Container" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Running_Strongswan_in_a_Container">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>Running Strongswan in a Container</div>
			</a>
			
			<ul id="toc-Running_Strongswan_in_a_Container-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Routing_issues" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Routing_issues">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1</span>Routing issues</div>
			</a>
			
			<ul id="toc-Routing_issues-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-SSL_Handshake_Timeouts" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#SSL_Handshake_Timeouts">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2</span>SSL Handshake Timeouts</div>
			</a>
			
			<ul id="toc-SSL_Handshake_Timeouts-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Connection_established_but_no_traffic" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Connection_established_but_no_traffic">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.3</span>Connection established but no traffic</div>
			</a>
			
			<ul id="toc-Connection_established_but_no_traffic-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading">strongSwan</h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 2 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-2" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">2 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/StrongSwan" title="StrongSwan – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/StrongSwan" title="StrongSwan – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><span>
</span>
</p>
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Openswan_L2TP/IPsec_VPN_client_setup.html" title="Openswan L2TP/IPsec VPN client setup">Openswan L2TP/IPsec VPN client setup</a></li>
</ul>
</div>
<p>IPSec is an encryption and authentication standard that can be used to build secure Virtual Private Networks (VPNs).
</p>
<p>It is natively supported by the Linux kernel, but configuration of encryption keys is left to the user. The <a href="https://en.wikipedia.org/wiki/Internet_Key_Exchange" class="extiw" title="wikipedia:Internet Key Exchange">IKE</a> protocols are therefore used in IPSec VPNs to automatically negotiate key exchanges securely using a variety of means, including certificates, pre-shared keys or both.
</p>
<p>They are typically implemented in userspace daemons on the server side. <a rel="nofollow" class="external text" href="https://strongswan.org/">strongSwan</a> is an IKE daemon with full support for
IKEv1 and IKEv2. It is natively supported by most modern clients, including Linux, Windows 7, Apple iOS, Mac OSX, FreeBSD and BlackBerry OS.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=strongswan">strongswan</a></span> package.
</p>
<h2><span class="mw-headline" id="Certificates">Certificates</span></h2>
<p>The first step is to generate the X.509 certificates, including a certificate
authority (CA), a server certificate, and at least one client certificate.
</p>
<h3><span class="mw-headline" id="Certificate_Authority">Certificate Authority</span></h3>
<p>Let us start by creating a self-signed root CA certificate:
</p>
<pre>$ cd /etc/ipsec.d/
$ ipsec pki --gen --type rsa --size 4096 --outform pem &gt; private/strongswanKey.pem
$ chmod 600 private/strongswanKey.pem
$ ipsec pki --self --ca --lifetime 3650 --outform pem \
            --in private/strongswanKey.pem --type rsa \
            --dn "C=CH, O=strongSwan, CN=strongSwan Root CA" \
      &gt; cacerts/strongswanCert.pem
</pre>
<p>The result is a 4096 bit RSA private key <code>strongswanKey.pem</code> (line 2) and
a self-signed CA certificate <code>strongswanCert.pem</code> (line 7) with a
validity of 10 years (3650 days). The files are stored in PEM encoded format.
</p>
<p>You can change the Distinguished Name (DN) to more relevant values for country
(C), organization (O), and common name (CN), but you do not have to.
</p>
<p>To list the properties of your newly generated certificate, type in the
following command:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ipsec pki --print --in cacerts/strongswanCert.pem</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">cert:      X509
subject:  "C=CH, O=strongSwan, CN=strongSwan Root CA"
issuer:   "C=CH, O=strongSwan, CN=strongSwan Root CA"
validity:  not before Nov 22 11:55:41 2013, ok
           not after  Nov 20 11:55:41 2023, ok (expires in 3649 days)
serial:    65:39:93:df:a0:f8:40:03
flags:     CA CRLSign self-signed
authkeyId: 45:30:11:da:a4:0e:0b:0a:a3:41:a5:81:41:ab:d8:04:7a:40:6c:c0
subjkeyId: 45:30:11:da:a4:0e:0b:0a:a3:41:a5:81:41:ab:d8:04:7a:40:6c:c0
pubkey:    RSA 4096 bits
keyid:     dc:15:91:95:04:07:a5:13:69:5f:77:65:26:d7:02:3f:60:ec:73:c8
subjkey:   45:30:11:da:a4:0e:0b:0a:a3:41:a5:81:41:ab:d8:04:7a:40:6c:c0</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The private key <code>/etc/ipsec.d/private/strongswanKey.pem</code> of the CA should be moved somewhere safe, possibly to a special signing host without access to the Internet. Theft of this master signing key would completely compromise your public key infrastructure.</div>
<h3><span class="mw-headline" id="Host_Certificate">Host Certificate</span></h3>
<p>This certificate will be used to authenticate the VPN server. Run the following
commands:
</p>
<pre>$ cd /etc/ipsec.d/
$ ipsec pki --gen --type rsa --size 2048 --outform pem &gt; private/vpnHostKey.pem
$ chmod 600 private/vpnHostKey.pem
$ ipsec pki --pub --in private/vpnHostKey.pem --type rsa | \
      ipsec pki --issue --lifetime 730 --outform pem \
                --cacert cacerts/strongswanCert.pem \
                --cakey private/strongswanKey.pem \
                --dn "C=CH, O=strongSwan, CN=<b>vpn.example.com</b>" \
                --san <b>vpn.example.com</b> \
                --flag serverAuth --flag ikeIntermediate \
          &gt; certs/vpnHostCert.pem
</pre>
<p>The result is a 2048 bit RSA private key <code>vpnHostKey.pem</code> (line 2). In
line 4 we extract its public key and pipe it over to issue
<code>vpnHostCert.pem</code> (line 11), a host certificate signed by your CA. The
certificate has a validity of two years (730 days). It identifies the VPN host
by its Fully Qualified Domain Name (FQDN) (here: <code>vpn.example.com</code>).
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> The domain name or IP address of your VPN server, which is later entered in the client's connection properties, MUST be contained either in the subject Distinguished Name (<code>CN=</code>) and/or in a subject Alternative Name (<code>--san</code>), but preferably in both. Make sure both times to replace <code><b>vpn.example.com</b></code> with your VPN's hostname – or else the connection between client and server will fail!</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you are going to use the built-in VPN client of Windows 7, you <a rel="nofollow" class="external text" href="https://wiki.strongswan.org/projects/strongswan/wiki/Win7CertReq">MUST</a> add the <code>serverAuth</code> extended key usage flag to your host certificate as shown above, or the client will refuse to connect.
<p>In addition, OS X 10.7.3 or older requires the <code>ikeIntermediate</code> flag, which we also added here.
</p>
Since the addition of these two flags probably will not hurt anyone, you should make sure you keep them there.</div>
<p>Let us take a look at the properties of our newly generated certificate.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ ipsec pki --print --in certs/vpnHostCert.pem</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">cert:      X509
subject:  "C=CH, O=strongSwan, CN=vpn.example.com"
issuer:   "C=CH, O=strongSwan, CN=strongSwan Root CA"
validity:  not before Nov 22 21:16:51 2013, ok
           not after  Nov 22 21:16:51 2015, ok (expires in 729 days)
serial:    0c:05:d7:d5:57:0e:d9:48
altNames:  vpn.example.com
flags:     serverAuth iKEIntermediate 
authkeyId: 9b:57:35:fb:cd:9e:2d:20:37:1d:61:4c:e7:c4:5b:5e:dc:64:ad:fc
subjkeyId: 5f:12:c2:06:ee:2b:1e:cc:5f:78:54:ff:f0:f3:7b:a0:2b:c0:b4:d6
pubkey:    RSA 2048 bits
keyid:     6f:a7:99:60:27:27:09:96:02:c1:b9:d9:7d:c1:b0:10:e3:e1:d5:45
subjkey:   5f:12:c2:06:ee:2b:1e:cc:5f:78:54:ff:f0:f3:7b:a0:2b:c0:b4:d6</pre>
<h3><span class="mw-headline" id="Client_Certificate">Client Certificate</span></h3>
<p>Any client will require a personal certificate in order to use the VPN. The
process is analogous to generating a host certificate, except that we identify
a client certificate by the client's e-mail address rather than a hostname.
</p>
<pre>$ cd /etc/ipsec.d/
$ ipsec pki --gen --type rsa --size 2048 --outform pem &gt; private/ClientKey.pem
$ chmod 600 private/ClientKey.pem
$ ipsec pki --pub --in private/ClientKey.pem --type rsa | \
      ipsec pki --issue --lifetime 730 --outform pem \
                --cacert cacerts/strongswanCert.pem \
                --cakey private/strongswanKey.pem \
                --dn "C=CH, O=strongSwan, CN=myself@example.com" \
                --san myself@example.com \
          &gt; certs/ClientCert.pem
</pre>
<p>The result is a 2048 bit RSA private key <code>ClientKey.pem</code> (line 2).
In line 6 we extract its public key and pipe it over to issue <code>ClientCert.pem</code> (line 10), the first client certificate signed by your CA.
The certificate has a validity of two years (730 days) and identifies the client by its e-mail address (here: <code>myself@example.com</code>).
</p>
<p>Finally we will bundle all needed certificates and keys into a PKCS#12 file with a passphrase, which is the most convenient format for clients.
</p>
<pre>$ openssl pkcs12 -export -name "My own VPN client certificate" \
                 -inkey private/ClientKey.pem \
                 -in certs/ClientCert.pem  \
                 -certfile cacerts/strongswanCert.pem \
                 -caname "strongSwan Root CA" \
                 -out Client.p12
</pre>
<h2><span class="mw-headline" id="VPN_Variants">VPN Variants</span></h2>
<p>The easiest configuration to get running with is IPSec in tunnel mode, described below.
</p>
<h3><span class="mw-headline" id="IPSec_in_tunnel_mode">IPSec in tunnel mode</span></h3>
<p>VPN configuration can be found in <code>/etc/ipsec.conf</code>. The following
contains the necessary options to build a basic, functional VPN server:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ipsec.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># ipsec.conf - strongSwan IPsec configuration file
config setup

  # By default only one client can connect at the same time with an identical
  # certificate and/or password combination. Enable this option to disable
  # this behavior.
  # uniqueids=never

  # Slightly more verbose logging. Very useful for debugging.
  charondebug="cfg 2, dmn 2, ike 2, net 2"

# Default configuration options, used below if an option is not specified.
# See: https://wiki.strongswan.org/projects/strongswan/wiki/ConnSection
conn %default

  # Use IKEv2 by default
  keyexchange=ikev2

  # Prefer modern cipher suites that allow PFS (Perfect Forward Secrecy)
  ike=aes128-sha256-ecp256,aes256-sha384-ecp384,aes128-sha256-modp2048,aes128-sha1-modp2048,aes256-sha384-modp4096,aes256-sha256-modp4096,aes256-sha1-modp4096,aes128-sha256-modp1536,aes128-sha1-modp1536,aes256-sha384-modp2048,aes256-sha256-modp2048,aes256-sha1-modp2048,aes128-sha256-modp1024,aes128-sha1-modp1024,aes256-sha384-modp1536,aes256-sha256-modp1536,aes256-sha1-modp1536,aes256-sha384-modp1024,aes256-sha256-modp1024,aes256-sha1-modp1024!
  esp=aes128gcm16-ecp256,aes256gcm16-ecp384,aes128-sha256-ecp256,aes256-sha384-ecp384,aes128-sha256-modp2048,aes128-sha1-modp2048,aes256-sha384-modp4096,aes256-sha256-modp4096,aes256-sha1-modp4096,aes128-sha256-modp1536,aes128-sha1-modp1536,aes256-sha384-modp2048,aes256-sha256-modp2048,aes256-sha1-modp2048,aes128-sha256-modp1024,aes128-sha1-modp1024,aes256-sha384-modp1536,aes256-sha256-modp1536,aes256-sha1-modp1536,aes256-sha384-modp1024,aes256-sha256-modp1024,aes256-sha1-modp1024,aes128gcm16,aes256gcm16,aes128-sha256,aes128-sha1,aes256-sha384,aes256-sha256,aes256-sha1!

  # Dead Peer Discovery
  dpdaction=clear
  dpddelay=300s

  # Do not renegotiate a connection if it is about to expire
  rekey=no

  # Server side
  left=%any
  leftsubnet=0.0.0.0/0
  leftcert=vpnHostCert.pem

  # Client side
  right=%any
  rightdns=8.8.8.8,8.8.4.4
  rightsourceip=%dhcp

# IKEv2: Newer version of the IKE protocol
conn IPSec-IKEv2
  keyexchange=ikev2
  auto=add

# IKEv2-EAP
conn IPSec-IKEv2-EAP
  also="IPSec-IKEv2"
  rightauth=eap-mschapv2
  rightsendcert=never
  eap_identity=%any

# IKEv1 (Cisco-compatible version)
conn CiscoIPSec
  keyexchange=ikev1
  # forceencaps=yes
  rightauth=pubkey
  rightauth2=xauth
  auto=add
</pre>
<h3><span class="mw-headline" id="IPSec_in_transport_mode">IPSec in transport mode</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Need to better explain the differences, advantages and inconvenients, then write a tutorial. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:StrongSwan.html">Talk:StrongSwan</a>)</div>
</div>
<p>Compared to tunnel mode, transport mode does not encrypt the original IP header from its point of view.  This is useful if something else (i.e. GRE) has already encapsulated the original packet to be transported through a tunnel, before IPSec gets it.  From the point of view of IPSec, the IP header it thinks is the original is actually the IP header already setup for the tunneling, and it will encrypt what is truly the original IP header as just part of the encapsulated packet payload, without realizing it is doing it.
</p>
<h3>
<span id="IPSec.2FL2TP"></span><span class="mw-headline" id="IPSec/L2TP">IPSec/L2TP</span>
</h3>
<p>The <a href="../en/Openswan_L2TP/IPsec_VPN_client_setup.html" class="mw-redirect" title="L2TP/IPsec VPN client setup">L2TP/IPsec VPN client setup</a> page describes how to setup a client to connect to an IPSec/L2TP server. This variant of an IPSec VPN has the advantage of allowing to tunnel non-IP packets, contrary to pure IPSec, but at the expense of having to run an additional L2TP daemon.
</p>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Need to better explain the differences, advantages and inconvenients, then write a tutorial. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:StrongSwan.html">Talk:StrongSwan</a>)</div>
</div>
<h2><span class="mw-headline" id="Secrets">Secrets</span></h2>
<p>The server's private key needs to be configured in <code>/etc/ipsec.secrets</code>, like the following example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/ipsec.secrets</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># RSA private key for this host
: RSA vpnHostKey.pem
</pre>
<p>Whenever you edit <code>/etc/ipsec.secrets</code> while strongSwan is running, you must
reload the file:
</p>
<pre>$ ipsec rereadsecrets
</pre>
<h2><span class="mw-headline" id="Networking">Networking</span></h2>
<p>You’re almost done setting up your server. There are a few things left to make
your VPN server properly route the VPN tunnel:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/sysctl.d/10-net-forward.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># VPN
net.ipv4.ip_forward = 1
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.all.send_redirects = 0
</pre>
<p>The VPN configuration above automatically assigns an IP address to the client
using DHCP, so you need to have a working DHCP server. If the server is running
on the same host as strongSwan, you may need to edit
<code>/etc/strongswan.d/charon/dhcp.conf</code> like this:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/strongswan.d/charon/dhcp.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">dhcp {
 force_server_address = yes
 server = 192.168.0.255
}
</pre>
<p>You may also need to allow the following protocols in your firewall:
</p>
<ul>
<li>ESP (Encrypted Secure Payload): Standard IPSec traffic</li>
<li>UDP 4500: IPSec traffic in "NAT Traversal" mode</li>
<li>UDP 500: Key exchanges (IKE)</li>
</ul>
<h2><span class="mw-headline" id="Starting">Starting</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> The systemd unit file name was changed in version 5.8.0. (Discuss in <a href="../en/Talk:StrongSwan.html#Starting_the_service:_replace_legacy_with_new_starter?" title="Talk:StrongSwan">Talk:StrongSwan#Starting the service: replace legacy with new starter?</a>)</div>
</div>
<p>Finally, you can <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>strongswan-starter.service</code>.
</p>
<h3><span class="mw-headline" id="Running_Strongswan_in_a_Container">Running Strongswan in a Container</span></h3>
<p>For running <code>strongswan</code> in a container like <a href="../en/Systemd-nspawn.html" title="Systemd-nspawn">systemd-nspawn</a> you need the following service file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/systemd-nspawn@.service.d/override.conf}</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/systemd-nspawn --quiet --keep-unit --boot --link-journal=try-guest --settings=override --machine=%I --capability=CAP_NET_ADMIN --network-veth 
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> Need to explain at least ip xfrm and common issues (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:StrongSwan.html">Talk:StrongSwan</a>)</div>
</div>
<h3><span class="mw-headline" id="Routing_issues">Routing issues</span></h3>
<p>If you are having troubles with routing traffic from client (road warrior) to the remote network, try disabling the <code>bypass-lan</code> plugin on the server. This plugin is enabled by default in the official Arch package since version 5.6.0. See the associated <a rel="nofollow" class="external text" href="https://wiki.strongswan.org/issues/2462">issue</a> in strongswan bugtracker.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/strongswan.d/charon/bypass-lan.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># Whether to load the plugin. Can also be an integer to increase the
# priority of this plugin.
load = no</pre>
<h3><span class="mw-headline" id="SSL_Handshake_Timeouts">SSL Handshake Timeouts</span></h3>
<p>Some users have had intermittent SSL handshake timeouts, such as:
</p>
<ul>
<li>
<code>curl -v https://example.com</code> getting stuck at "TLSv1.3 (OUT), TLS handshake, Client hello (1):"</li>
<li>Firefox stalling loading a page, showing "Performing a TLS handshake to www.example.com"</li>
</ul>
<p>Some users have fixed (or worked around?) this problem by decreasing their network interface mtu to be in the 1422-1438 range, even if they do not need to do so without a VPN or when using OpenVPN. <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=244606">[1]</a> <a rel="nofollow" class="external autonumber" href="https://wiki.strongswan.org/projects/strongswan/wiki/ForwardingAndSplitTunneling#MTUMSS-issues">[2]</a>
</p>
<p>Lowering mtu could potentially cause other problems, so your mileage may vary.  This fix/workaround will likely somewhat decrease internet and internal network performance.  (But, SSL handshakes will stop stalling.)  If you are using jumbo frames, this may significantly decrease internal network performance.
</p>
<p>Check your interface's mtu: (The one being used to connect to the VPN)
</p>
<pre>$ ip link
</pre>
<p>Consider this default (probably 1500) bad.
</p>
<p>You can efficiently try to find a mtu that prevents an SSL timeout by repeating this process, perhaps starting with a really low <i><b>trial-mtu</b></i> like 1300, or lower if that still fails: (<i><b>interface</b></i> is the name shown above by <code>ip link</code>, not a full path like <code>/dev/device</code>)
</p>
<pre># ip link set dev <i><b>interface</b></i> mtu <i><b>trial-mtu</b></i>
$ while(curl -v https://example.com); do
&gt; sleep 2
&gt; done
</pre>
<p>If it succeeds enough times for you to be confident an intermittent failure should have happened, consider this mtu as good, and hit <code>CTRL+C</code>.  Re-run the above commands with a <i><b>trial-mtu</b></i> halfway between this one and your closest known bad mtu.
</p>
<p>If it gets stuck on a TLS handshake, consider this as bad, and hit <code>CTRL+C</code>.  Re-run the above with halfway between this one and your closest known good mtu.
</p>
<h3><span class="mw-headline" id="Connection_established_but_no_traffic">Connection established but no traffic</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> <a href="../en/NetworkManager.html#Use_openresolv" title="NetworkManager">NetworkManager needs to be configured to use openresolv</a>. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:StrongSwan.html">Talk:StrongSwan</a>)</div>
</div>
<p>In certain setups, like KDE, you might get a established connection using <code>ipsec up</code> but you cannot reach any outside machine. This could be due to the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=openresolv">openresolv</a></span> package not being installed. It is an optional dependency, but it might be required for your situation.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://www.zeitgeist.se/2013/11/22/strongswan-howto-create-your-own-vpn/">strongSwan 5: How to create your own VPN</a> — The source used to write the initial revision of this article, with permission from the original author.</li>
<li><a rel="nofollow" class="external text" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-an-ikev2-vpn-server-with-strongswan-on-ubuntu-16-04">How to Set Up an IKEv2 VPN Server with StrongSwan on Ubuntu 16.04</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Virtual_Private_Network.html" title="Category:Virtual Private Network">Virtual Private Network</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=StrongSwan&amp;oldid=723905">https://wiki.archlinux.org/index.php?title=StrongSwan&amp;oldid=723905</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 21 March 2022, at 19:10.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
