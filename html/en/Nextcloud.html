<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Nextcloud - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Nextcloud rootpage-Nextcloud skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Setup_overview" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Setup_overview">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Setup overview</div>
		</a>
		
		<ul id="toc-Setup_overview-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Configuration</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-PHP" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#PHP">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.1</span>PHP</div>
			</a>
			
			<ul id="toc-PHP-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Nextcloud" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Nextcloud">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.2</span>Nextcloud</div>
			</a>
			
			<ul id="toc-Nextcloud-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-System_and_environment" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#System_and_environment">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">3.3</span>System and environment</div>
			</a>
			
			<ul id="toc-System_and_environment-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Database" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Database">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Database</div>
		</a>
		
			<button aria-controls="toc-Database-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Database subsection</span>
			</button>
		
		<ul id="toc-Database-sublist" class="vector-toc-list">
			<li id="toc-MariaDB_/_MySQL" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#MariaDB_/_MySQL">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>MariaDB / MySQL</div>
			</a>
			
			<ul id="toc-MariaDB_/_MySQL-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-PostgreSQL" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#PostgreSQL">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.2</span>PostgreSQL</div>
			</a>
			
			<ul id="toc-PostgreSQL-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Application_server" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Application_server">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Application server</div>
		</a>
		
			<button aria-controls="toc-Application_server-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Application server subsection</span>
			</button>
		
		<ul id="toc-Application_server-sublist" class="vector-toc-list">
			<li id="toc-uWSGI" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#uWSGI">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>uWSGI</div>
			</a>
			
			<ul id="toc-uWSGI-sublist" class="vector-toc-list">
				<li id="toc-nextcloud.ini" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#nextcloud.ini">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.1</span>nextcloud.ini</div>
			</a>
			
			<ul id="toc-nextcloud.ini-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-uWSGI_service" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#uWSGI_service">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1.2</span>uWSGI service</div>
			</a>
			
			<ul id="toc-uWSGI_service-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-FPM" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#FPM">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>FPM</div>
			</a>
			
			<ul id="toc-FPM-sublist" class="vector-toc-list">
				<li id="toc-php-fpm.ini" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#php-fpm.ini">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.1</span>php-fpm.ini</div>
			</a>
			
			<ul id="toc-php-fpm.ini-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-nextcloud.conf" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#nextcloud.conf">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.2</span>nextcloud.conf</div>
			</a>
			
			<ul id="toc-nextcloud.conf-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Systemd_service" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Systemd_service">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.3</span>Systemd service</div>
			</a>
			
			<ul id="toc-Systemd_service-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Keep_/etc_tidy" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Keep_/etc_tidy">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2.4</span>Keep /etc tidy</div>
			</a>
			
			<ul id="toc-Keep_/etc_tidy-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Web_server" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Web_server">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Web server</div>
		</a>
		
			<button aria-controls="toc-Web_server-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Web server subsection</span>
			</button>
		
		<ul id="toc-Web_server-sublist" class="vector-toc-list">
			<li id="toc-nginx" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#nginx">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>nginx</div>
			</a>
			
			<ul id="toc-nginx-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Apache_HTTP_server" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Apache_HTTP_server">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.2</span>Apache HTTP server</div>
			</a>
			
			<ul id="toc-Apache_HTTP_server-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Background_jobs" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Background_jobs">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Background jobs</div>
		</a>
		
		<ul id="toc-Background_jobs-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-In-memory_caching" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#In-memory_caching">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">8</span>In-memory caching</div>
		</a>
		
			<button aria-controls="toc-In-memory_caching-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle In-memory caching subsection</span>
			</button>
		
		<ul id="toc-In-memory_caching-sublist" class="vector-toc-list">
			<li id="toc-APCu" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#APCu">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.1</span>APCu</div>
			</a>
			
			<ul id="toc-APCu-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Redis" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Redis">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">8.2</span>Redis</div>
			</a>
			
			<ul id="toc-Redis-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Security_Hardening" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Security_Hardening">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">9</span>Security Hardening</div>
		</a>
		
		<ul id="toc-Security_Hardening-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Synchronization" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Synchronization">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">10</span>Synchronization</div>
		</a>
		
			<button aria-controls="toc-Synchronization-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Synchronization subsection</span>
			</button>
		
		<ul id="toc-Synchronization-sublist" class="vector-toc-list">
			<li id="toc-Desktop" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Desktop">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">10.1</span>Desktop</div>
			</a>
			
			<ul id="toc-Desktop-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Thunderbird" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Thunderbird">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">10.2</span>Thunderbird</div>
			</a>
			
			<ul id="toc-Thunderbird-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Mounting_files_with_davfs2" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Mounting_files_with_davfs2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">10.3</span>Mounting files with davfs2</div>
			</a>
			
			<ul id="toc-Mounting_files_with_davfs2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Mounting_files_in_GNOME_Files_(Nautilus)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Mounting_files_in_GNOME_Files_(Nautilus)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">10.4</span>Mounting files in GNOME Files (Nautilus)</div>
			</a>
			
			<ul id="toc-Mounting_files_in_GNOME_Files_(Nautilus)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Android" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Android">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">10.5</span>Android</div>
			</a>
			
			<ul id="toc-Android-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-iOS" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#iOS">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">10.6</span>iOS</div>
			</a>
			
			<ul id="toc-iOS-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">11</span>Tips and tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id='toc-Using_the_"occ"_command_line_tool' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#Using_the_"occ"_command_line_tool'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">11.1</span>Using the "occ" command line tool</div>
			</a>
			
			<ul id='toc-Using_the_"occ"_command_line_tool-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Pacman_hook" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Pacman_hook">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">11.2</span>Pacman hook</div>
			</a>
			
			<ul id="toc-Pacman_hook-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Running_Nextcloud_in_a_subdirectory" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Running_Nextcloud_in_a_subdirectory">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">11.3</span>Running Nextcloud in a subdirectory</div>
			</a>
			
			<ul id="toc-Running_Nextcloud_in_a_subdirectory-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Docker" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Docker">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">11.4</span>Docker</div>
			</a>
			
			<ul id="toc-Docker-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Office_integration" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Office_integration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">11.5</span>Office integration</div>
			</a>
			
			<ul id="toc-Office_integration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Disabling_app_recommendations" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Disabling_app_recommendations">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">11.6</span>Disabling app recommendations</div>
			</a>
			
			<ul id="toc-Disabling_app_recommendations-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Backup_calendars_and_address_books_with_calcardbackup" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Backup_calendars_and_address_books_with_calcardbackup">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">11.7</span>Backup calendars and address books with calcardbackup</div>
			</a>
			
			<ul id="toc-Backup_calendars_and_address_books_with_calcardbackup-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">12</span>Troubleshooting</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Reading_the_log" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Reading_the_log">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.1</span>Reading the log</div>
			</a>
			
			<ul id="toc-Reading_the_log-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-Work_around_"is_file():_open_basedir_restriction_in_effect"' class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href='#Work_around_"is_file():_open_basedir_restriction_in_effect"'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.2</span>Work around "is_file(): open_basedir restriction in effect"</div>
			</a>
			
			<ul id='toc-Work_around_"is_file():_open_basedir_restriction_in_effect"-sublist' class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Upgrading_v27_to_v28" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Upgrading_v27_to_v28">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.3</span>Upgrading v27 to v28</div>
			</a>
			
			<ul id="toc-Upgrading_v27_to_v28-sublist" class="vector-toc-list">
				<li id="toc-Install_and_enable_extension_sodium" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Install_and_enable_extension_sodium">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.3.1</span>Install and enable extension sodium</div>
			</a>
			
			<ul id="toc-Install_and_enable_extension_sodium-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Add_maintenance_window_start_to_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Add_maintenance_window_start_to_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.3.2</span>Add maintenance_window_start to configuration</div>
			</a>
			
			<ul id="toc-Add_maintenance_window_start_to_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id='toc-Work_around_"ResourceLocator_can_not_find_a_web_root"' class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href='#Work_around_"ResourceLocator_can_not_find_a_web_root"'>
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.3.3</span>Work around "ResourceLocator can not find a web root"</div>
			</a>
			
			<ul id='toc-Work_around_"ResourceLocator_can_not_find_a_web_root"-sublist' class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Migrating_to_php-legacy" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Migrating_to_php-legacy">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.4</span>Migrating to php-legacy</div>
			</a>
			
			<ul id="toc-Migrating_to_php-legacy-sublist" class="vector-toc-list">
				<li id="toc-PHP_extensions" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#PHP_extensions">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.4.1</span>PHP extensions</div>
			</a>
			
			<ul id="toc-PHP_extensions-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Nextcloud_specific_copy_of_php.ini" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Nextcloud_specific_copy_of_php.ini">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.4.2</span>Nextcloud specific copy of php.ini</div>
			</a>
			
			<ul id="toc-Nextcloud_specific_copy_of_php.ini-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-FPM_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#FPM_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.4.3</span>FPM configuration</div>
			</a>
			
			<ul id="toc-FPM_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-uWSGI_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#uWSGI_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.4.4</span>uWSGI configuration</div>
			</a>
			
			<ul id="toc-uWSGI_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Nginx_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Nginx_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.4.5</span>Nginx configuration</div>
			</a>
			
			<ul id="toc-Nginx_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Apache_HTTP_server_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Apache_HTTP_server_configuration">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.4.6</span>Apache HTTP server configuration</div>
			</a>
			
			<ul id="toc-Apache_HTTP_server_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Background_jobs_2" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Background_jobs_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.4.7</span>Background jobs</div>
			</a>
			
			<ul id="toc-Background_jobs_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Pacman_hook_2" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Pacman_hook_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.4.8</span>Pacman hook</div>
			</a>
			
			<ul id="toc-Pacman_hook_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Cleanup" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Cleanup">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.4.9</span>Cleanup</div>
			</a>
			
			<ul id="toc-Cleanup-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Weird_behavior_of_one_or_more_apps" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Weird_behavior_of_one_or_more_apps">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.5</span>Weird behavior of one or more apps</div>
			</a>
			
			<ul id="toc-Weird_behavior_of_one_or_more_apps-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-InnoDB_refuses_to_write_tables_with_ROW_FORMAT=COMPRESSED" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#InnoDB_refuses_to_write_tables_with_ROW_FORMAT=COMPRESSED">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.6</span>InnoDB refuses to write tables with ROW_FORMAT=COMPRESSED</div>
			</a>
			
			<ul id="toc-InnoDB_refuses_to_write_tables_with_ROW_FORMAT=COMPRESSED-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Issues_with_permissions_and_setup_after_upgrade_to_&gt;=_21.0.0" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Issues_with_permissions_and_setup_after_upgrade_to_&gt;=_21.0.0">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.7</span>Issues with permissions and setup after upgrade to &gt;= 21.0.0</div>
			</a>
			
			<ul id="toc-Issues_with_permissions_and_setup_after_upgrade_to_&gt;=_21.0.0-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Login_loop_without_any_clue_in_access.log,_error.log,_nor_nextcloud.log" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Login_loop_without_any_clue_in_access.log,_error.log,_nor_nextcloud.log">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.8</span>Login loop without any clue in access.log, error.log, nor nextcloud.log</div>
			</a>
			
			<ul id="toc-Login_loop_without_any_clue_in_access.log,_error.log,_nor_nextcloud.log-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Environment_variables_not_available" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Environment_variables_not_available">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.9</span>Environment variables not available</div>
			</a>
			
			<ul id="toc-Environment_variables_not_available-sublist" class="vector-toc-list">
				<li id="toc-FPM_2" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#FPM_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.9.1</span>FPM</div>
			</a>
			
			<ul id="toc-FPM_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-uWSGI_2" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#uWSGI_2">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.9.2</span>uWSGI</div>
			</a>
			
			<ul id="toc-uWSGI_2-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-You_are_accessing_your_instance_over_a_secure_connection,_however_your_instance_is_generating_insecure_URLs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#You_are_accessing_your_instance_over_a_secure_connection,_however_your_instance_is_generating_insecure_URLs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.10</span>You are accessing your instance over a secure connection, however your instance is generating insecure URLs</div>
			</a>
			
			<ul id="toc-You_are_accessing_your_instance_over_a_secure_connection,_however_your_instance_is_generating_insecure_URLs-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Nextcloud_reports_corrupted_index_(MariaDB)" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Nextcloud_reports_corrupted_index_(MariaDB)">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.11</span>Nextcloud reports corrupted index (MariaDB)</div>
			</a>
			
			<ul id="toc-Nextcloud_reports_corrupted_index_(MariaDB)-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Failed_to_fetch_the_Collabora_capabilities_endpoint" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Failed_to_fetch_the_Collabora_capabilities_endpoint">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">12.12</span>Failed to fetch the Collabora capabilities endpoint</div>
			</a>
			
			<ul id="toc-Failed_to_fetch_the_Collabora_capabilities_endpoint-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">13</span>See also</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Nextcloud</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 2 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-2" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">2 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Nextcloud" title="Nextcloud – 日本語" lang="ja" hreflang="ja" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Nextcloud" title="Nextcloud – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/Apache_HTTP_Server.html" title="Apache HTTP Server">Apache HTTP Server</a></li>
<li><a href="../en/Nginx.html" title="Nginx">Nginx</a></li>
<li><a href="../en/UWSGI.html" title="UWSGI">UWSGI</a></li>
<li><a href="../en/OpenSSL.html" title="OpenSSL">OpenSSL</a></li>
<li><a href="../en/WebDAV.html" title="WebDAV">WebDAV</a></li>
</ul>
</div>
<p><a rel="nofollow" class="external text" href="https://nextcloud.com/">Nextcloud</a> is a suite of client-server-software that (by means of so-called <a rel="nofollow" class="external text" href="https://apps.nextcloud.com/">apps</a>) allows all kinds of sharing, collaboration and communication, e.g.:
</p>
<ul>
<li>file sharing</li>
<li>personal information manager (<a rel="nofollow" class="external text" href="https://apps.nextcloud.com/apps/contacts">contacts</a>, <a rel="nofollow" class="external text" href="https://apps.nextcloud.com/apps/calendar">calendar</a>, <a rel="nofollow" class="external text" href="https://apps.nextcloud.com/apps/tasks">tasks</a>)</li>
<li>messaging (<a rel="nofollow" class="external text" href="https://apps.nextcloud.com/apps/mail">mail</a>, <a rel="nofollow" class="external text" href="https://apps.nextcloud.com/apps/spreed">chat, video conferencing</a>)</li>
<li>collaborative editing of documents (<a rel="nofollow" class="external text" href="https://github.com/nextcloud/text">text</a>, <a href="#Office_integration">Office integration</a>)</li>
</ul>
<p>Nextcloud is open source and based on open standards. Data sovereignty is a big plus, i.e. with your own instance of Nextcloud, you break free from proprietary (and potentially untrustworthy) services like Dropbox, Office 365, or Google Drive.
</p>
<p>Depending on your needs Nextcloud can be deployed from single-board computers (like e.g. a Raspberry Pi) all the way up to full scale data centers serving millions of users. With an elaborated authorization scheme and the option for federation (connecting discrete instances) Nextcloud is well suited for use in enterprise environments.
</p>
<p>Nextcloud is a fork of <a rel="nofollow" class="external text" href="https://owncloud.com/">ownCloud</a>. See Wikipedia for the <a href="https://en.wikipedia.org/wiki/Nextcloud#History" class="extiw" title="wikipedia:Nextcloud">history</a>.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Setup_overview">Setup overview</span></h2>
<p>A complete installation of Nextcloud comprises (at least) the following components:
</p>
<p>A <b>web server</b> paired with an <b>application server</b> on which runs <b>Nextcloud</b> (i.e. the PHP code) using a <b>database</b>. 
</p>
<p>This article will cover <a href="../en/MariaDB.html" title="MariaDB">MariaDB</a>/MySQL and <a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a> as databases and the following combinations of web server and application server:
</p>
<ul>
<li>nginx → uWSGI (plus uwsgi-plugin-php)</li>
<li>nginx → FPM,</li>
<li>Apache HTTP server (using mod_proxy_uwsgi) → uWSGI (plus uwsgi-plugin-php)</li>
<li>Apache HTTP server (using mod_proxy_fcgi) → FPM</li>
</ul>
<p>The Nextcloud package complies with the <a href="../en/Web_application_package_guidelines.html" title="Web application package guidelines">web application package guidelines</a>. Among other things this mandates that the web application be run with a dedicated user - in this case <code>nextcloud</code>. This is one of the reasons why the application server comes into play here. For the very same reason it is not possible anymore to execute Nextcloud's PHP code directly in the Apache process by means of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-apache">php-apache</a></span>.
</p>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud">nextcloud</a></span> (by means of a dependency on meta package <i>php-interpreter</i>) offers the choice to build an installation of Nextcloud on top of either <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php">php</a></span> or on top of package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy">php-legacy</a></span>. It is highly recommended to choose <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy">php-legacy</a></span> to be on the safe side (and for your peace of mind). See <a href="#Migrating_to_php-legacy">Migrating to php-legacy</a> for details. For the remainder of this article we assume an installation using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy">php-legacy</a></span>.</div>
<p>Install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud">nextcloud</a></span> package. When asked choose <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy">php-legacy</a></span> as your PHP version. This will pull in quite a few dependent packages. Most of the <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/stable/admin_manual/installation/php_configuration.html">required PHP extensions</a> will be taken care of this way. Additionally, you have to install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy-gd">php-legacy-gd</a></span> (preferrably as dependent package with pacman option <code>--asdeps</code>).
</p>
<p>It is recommended to also install the packages
</p>
<ul>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy-sodium">php-legacy-sodium</a></span> for the argon2 hashing algorithm and</li>
<li>
<span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy-imagick">php-legacy-imagick</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=librsvg">librsvg</a></span> for preview generation</li>
</ul>
<p>(also with  <code>--asdeps</code>). Other optional dependencies will be covered later depending on your concrete setup (e.g. what database you choose).
</p>
<p>Mind that some modules (namely <i>bcmath</i>, <i>exif</i>, <i>gmp</i>, <i>intl</i> and <i>sysvsem</i>) come with <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy">php-legacy</a></span>. So no explicit installation is required for those.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<h3><span class="mw-headline" id="PHP">PHP</span></h3>
<p>This guide does not tamper with PHP's central configuration file <code>/etc/php-legacy/php.ini</code> but instead puts Nextcloud specific PHP configuration in places where it does not potentially interfere with settings for other PHP based applications. These places are:
</p>
<ul><li>A dedicated copy of <code>php.ini</code> in <code>/etc/webapps/nextcloud</code> (for the <code>occ</code> command line tool and the background job). This is literally a copy of the original <code>php.ini</code> as provided by the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy">php-legacy</a></span> package with some Nextcloud specific additions / modifications.</li></ul>
<ul><li>Corresponding settings in the configuration of the application server. These will be covered in the section about application servers.</li></ul>
<p>Make a copy of <code>/etc/php-legacy/php.ini</code> to <code>/etc/webapps/nextcloud</code> (or even better, extract <code>php.ini</code> from the <i>php-legacy</i> package tarball below <code>/var/cache/pacman/pkg</code>). Although not strictly necessary, change ownership of the copy:
</p>
<pre># cp /etc/php-legacy/php.ini /etc/webapps/nextcloud
# chown nextcloud:nextcloud /etc/webapps/nextcloud/php.ini</pre>
<p>Most of the required PHP modules listed in <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/stable/admin_manual/installation/php_configuration.html">Nextcloud's documentation</a> are already enabled in the just copied bare PHP installation configuration file. Additionally enable the following extensions:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">extension=exif
extension=gd
extension=iconv
extension=intl
extension=sysvsem
; bcmath and gmp for passwordless login
extension=bcmath
extension=gmp
; sodium for the argon2 hashing algorithm
extension=sodium
; in case you installed php-legacy-imagick (as recommended)
extension=imagick</pre>
<p>Depending on the database you are going to use enable the corresponding <code>pdo_xxxx</code> module. See <a href="#Database">Database</a> below.
</p>
<p>Set <code>date.timezone</code> to your preferred timezone, e.g.:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">date.timezone = Europe/Berlin</pre>
<p>Raise PHP's memory limit to at least 512MiB:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">memory_limit = 512M</pre>
<p>Optional: For additional security configure <code>open_basedir</code>. This limits the locations where Nextcloud's PHP code can read and write files. Proven settings are
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">open_basedir=/var/lib/nextcloud:/tmp:/usr/share/webapps/nextcloud:/etc/webapps/nextcloud:/dev/urandom:/usr/lib/php-legacy/modules:/var/log/nextcloud:/proc/meminfo:/proc/cpuinfo</pre>
<p>Depending on what additional extensions you configure you may need to extend this list, e.g. <code>/run/redis</code> in case you opt for <a href="../en/Redis.html" title="Redis">Redis</a>.
</p>
<p>It is not necessary to configure <i>opcache</i> here as this <code>php.ini</code> is only used by the <code>occ</code> command line tool and the background job, i.e. by short running PHP processes.
</p>
<h3><span class="mw-headline" id="Nextcloud">Nextcloud</span></h3>
<p>Add the following entries to Nextcloud's configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/config/config.php</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">'trusted_domains' =&gt;
  array (
    0 =&gt; 'localhost',
    1 =&gt; '<i>cloud.mysite.com</i>',
  ),    
'overwrite.cli.url' =&gt; 'https://<i>cloud.mysite.com</i>/',
'htaccess.RewriteBase' =&gt; '/',</pre>
<p>Adapt the given example hostname <code><i>cloud.mysite.com</i></code>. In case your Nextcloud installation will be reachable via a subfolder (e.g. <code>https://www.mysite.com/nextcloud</code>) <code>overwrite.cli.url</code> and <code>htaccess.RewriteBase</code> have to be modified accordingly.
</p>
<h3><span class="mw-headline" id="System_and_environment">System and environment</span></h3>
<p>To make sure the Nextcloud specific <code>php.ini</code> is used by the <code>occ</code> tool set the environment variable <code>NEXTCLOUD_PHP_CONFIG</code>:
</p>
<pre>$ export NEXTCLOUD_PHP_CONFIG=/etc/webapps/nextcloud/php.ini</pre>
<p>Also add this line to your <code>.bashrc</code> (or <code>.bash_profile</code> ) to make this setting permanent.
</p>
<p>As a privacy and security precaution create the dedicated directory for session data:
</p>
<pre># install --owner=nextcloud --group=nextcloud --mode=700 -d /var/lib/nextcloud/sessions</pre>
<h2><span class="mw-headline" id="Database">Database</span></h2>
<p><a href="../en/MariaDB.html" title="MariaDB">MariaDB</a>/MySQL is the canonical choice for Nextcloud.
</p>
<dl><dd>The MySQL or MariaDB databases are the recommended database engines.<a rel="nofollow" class="external autonumber" href="https://docs.nextcloud.com/server/stable/admin_manual/configuration_database/linux_database_configuration.html">[1]</a>
</dd></dl>
<p>Most information concerning databases with Nextcloud deals with MariaDB/MySQL. The Nextcloud developers admit to have <a rel="nofollow" class="external text" href="https://github.com/nextcloud/server/issues/5912#issuecomment-318568370%7C">less detailed expertise</a> with other databases. 
</p>
<p><a href="../en/PostgreSQL.html" title="PostgreSQL">PostgreSQL</a> is said to deliver better performance and overall has fewer quirks compared to MariaDB/MySQL. <a href="../en/SQLite.html" title="SQLite">SQLite</a> is mainly supported for test / development installations and not recommended for production. The <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/stable/admin_manual/configuration_database/linux_database_configuration.html">list of supported databases</a> also contains Oracle database. This product will not be covered here.
</p>
<h3>
<span id="MariaDB_.2F_MySQL"></span><span class="mw-headline" id="MariaDB_/_MySQL">MariaDB / MySQL</span>
</h3>
<p>Since <a href="../en/MariaDB.html" title="MariaDB">MariaDB</a> has been the default MySQL implementation in Arch Linux since 2013<a rel="nofollow" class="external autonumber" href="https://archlinux.org/news/mariadb-replaces-mysql-in-repositories/">[2]</a> this text only mentions MariaDB.
</p>
<p>In case you want to run your database on the same host as Nextcloud install, <a href="../en/MariaDB.html#Configuration" title="MariaDB">configure</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=mariadb">mariadb</a></span> (if you have not done so already). See the corresponding <a href="../en/MariaDB.html" title="MariaDB">article</a> for details. Do not forget to initialize MariaDB with <code>mariadb-install-db</code>. It is recommended for additional security to configure MariaDB to <a href="../en/MariaDB.html#Enable_access_locally_only_via_Unix_sockets" title="MariaDB">only listen on a local Unix socket</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/my.cnf.d/server.cnf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[mysqld]
skip_networking</pre>
<p>Nextcloud's own documentation <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/stable/admin_manual/configuration_database/linux_database_configuration.html#database-read-committed-transaction-isolation-level">recommends</a> to set the transaction isolation level to READ-COMMITTED. This is especially important when you expect high load with many concurrent transactions.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/my.cnf.d/server.cnf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[mysqld]
transaction_isolation=READ-COMMITTED</pre>
<p>The other recommendation to set <code>binlog_format=ROW</code> is obsolete. The default <code>MIXED</code> in recent MariaDB versions is at least as good as the recommended <code>ROW</code>. In any case the setting is only relevant when replication is applied.
</p>
<p>Start the CLI tool <code>mysql</code> with database user root. (Default password is empty, but hopefully you change it as soon as possible.)
</p>
<pre>$ mysql -u root -p</pre>
<p>Create the user and database for Nextcloud with 
</p>
<pre>CREATE USER 'nextcloud'@'localhost' IDENTIFIED BY '<i>db-password</i>';
CREATE DATABASE IF NOT EXISTS nextcloud CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
GRANT ALL PRIVILEGES on nextcloud.* to 'nextcloud'@'localhost';
FLUSH privileges;</pre>
<p>(<code><i>db-password</i></code> is a placeholder for the actual password of DB user <i>nextcloud</i> you must choose.) Quit the tool with <code>\q</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> MariaDB has a flawed understanding of what UTF8 means resulting in the inability to store any characters with codepoints 0x10000 and above (e.g. emojis). They 'fixed' this issue with version 5.5 by introducing a new encoding called <i>utf8mb4</i>. Bottom line: Never ever use MariaDB's <i>utf8</i>, always use <i>utf8mb4</i>. In case you need to migrate see <a rel="nofollow" class="external autonumber" href="https://docs.nextcloud.com/server/stable/admin_manual/configuration_database/mysql_4byte_support.html">[3]</a>.</div>
<p>So that you have decided to use MariaDB as the database of your Nextcloud installation you have to enable the corresponding PHP extension:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">extension=pdo_mysql</pre>
<p>Further configuration (related to MariaDB) is not required (contrary to the information given in Nextcloud's <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/stable/admin_manual/configuration_database/linux_database_configuration.html#configuring-a-mysql-or-mariadb-database">admin manual</a>).
</p>
<p>Now setup Nextcloud's database schema with:
</p>
<pre>$ occ maintenance:install \
    --database=mysql \
    --database-name=nextcloud \
    --database-host=localhost:/run/mysqld/mysqld.sock \
    --database-user=nextcloud \
    --database-pass=<i>db-password</i> \
    --admin-pass=<i>admin-password</i> \
    --admin-email=<i>admin-email</i> \
    --data-dir=/var/lib/nextcloud/data</pre>
<p>Mind the placeholders (e.g. <code><i>db-password</i></code>) and replace them with appropriate values. This command assumes that you run your database on the same host as Nextcloud. Enter <code>occ help maintenance:install </code> and see Nextcloud's <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/occ_command.html#command-line-installation">documentation</a> for other options. See <a href='#Using_the_"occ"_command_line_tool'>Using the "occ" command line tool</a> for Arch-specific details about this tool.
</p>
<h3><span class="mw-headline" id="PostgreSQL">PostgreSQL</span></h3>
<p>Consult the corresponding <a href="../en/PostgreSQL.html" title="PostgreSQL">article</a> for detailed information about PostgreSQL. In case you want to run your database on the same host as Nextcloud install, <a href="../en/PostgreSQL.html#Initial_configuration" title="PostgreSQL">configure</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=postgresql">postgresql</a></span> (if you have not done so already). For additional security in this scenario it is recommended to configure PostgreSQL to <a href="../en/PostgreSQL.html#Configure_PostgreSQL_to_be_accessible_exclusively_through_UNIX_Sockets" title="PostgreSQL">only listen on a local UNIX socket</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/var/lib/postgres/data/postgresql.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">listen_addresses = ''</pre>
<p>Especially do not forget to initialize your database with <code>initdb</code>. After having done so start PostgreSQL's CLI tool <i>psql</i> and create the database user <code>nextcloud</code> and the database of the same name
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">[postgres]$ psql</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">CREATE USER nextcloud WITH PASSWORD '<i>db-password</i>';
CREATE DATABASE nextcloud TEMPLATE template0 ENCODING 'UNICODE';
ALTER DATABASE nextcloud OWNER TO nextcloud;
GRANT ALL PRIVILEGES ON DATABASE nextcloud TO nextcloud;
\q</pre>
<p>(<code><i>db-password</i></code> is a placeholder for the password of database user <i>nextcloud</i> that you have to choose.)
</p>
<p>Install the additional package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy-pgsql">php-legacy-pgsql</a></span> as dependency (pacman option <code>--asdeps</code>) and enable the corresponding PHP extension in <code>/etc/webapps/nextcloud/php.ini</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">extension=pdo_pgsql</pre>
<p>Now setup Nextcloud's database schema with:
</p>
<pre>$ occ maintenance:install \
    --database=pgsql \
    --database-name=nextcloud \
    --database-host=/run/postgresql \
    --database-user=nextcloud \
    --database-pass=<i>db-password</i> \
    --admin-pass=<i>admin-password</i> \
    --admin-email=<i>admin-email</i> \
    --data-dir=/var/lib/nextcloud/data</pre>
<p>Mind the placeholders (e.g. <code><i>db-password</i></code>) and replace them with appropriate values. This command assumes that you run your database on the same host as Nextcloud. Enter <code>occ help maintenance:install </code> and see Nextcloud's <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/occ_command.html#command-line-installation">documentation</a> for other options. See <a href='#Using_the_"occ"_command_line_tool'>Using the "occ" command line tool</a> for Arch-specific details about this tool.
</p>
<h2><span class="mw-headline" id="Application_server">Application server</span></h2>
<p>There are two prevalent application servers that can be used to process PHP code: <a href="../en/UWSGI.html" title="UWSGI">uWSGI</a> or <a rel="nofollow" class="external text" href="https://cwiki.apache.org/confluence/display/HTTPD/PHP-FPM">FPM</a>. <i>FPM</i> is specialized on PHP. The protocol used between the web server and <i>FPM</i> is <i>fastcgi</i>. The tool's <a rel="nofollow" class="external text" href="https://www.php.net/manual/en/install.fpm.php">documentation</a> leaves room for improvement. <i>uWSGI</i> on the other hand can serve code written in a <a rel="nofollow" class="external text" href="https://uwsgi-docs.readthedocs.io/en/latest/LanguagesAndPlatforms.html">handful of languages</a> by means of language specific plugins. The protocol used is <i>uwsgi</i> (lowercase). The tool is <a rel="nofollow" class="external text" href="https://uwsgi-docs.readthedocs.io/en/latest/index.html">extensively documented</a> - albeit the sheer amount of documentation can become confusing and unwieldy.
</p>
<h3><span class="mw-headline" id="uWSGI">uWSGI</span></h3>
<p>uWSGI has its own <a href="../en/UWSGI.html" title="UWSGI">article</a>. A lot of useful information can be found there. Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=uwsgi">uwsgi</a></span> and the plugin <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=uwsgi-plugin-php-legacy">uwsgi-plugin-php-legacy</a></span> - preferrably as dependencies, i.e. with <code>--asdeps</code>. To run Nextcloud's code with (or in) uWSGI you have to configure one uWSGI specific configuration file (<code>nextcloud.ini</code>) and define one systemd service.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> It has to be mentioned that maintenance of uWSGI and especially of its PHP plugin has been sparse lately<a rel="nofollow" class="external autonumber" href="https://github.com/unbit/uwsgi/issues/2287">[4]</a>. This has already caused <a rel="nofollow" class="external text" href="https://bugs.archlinux.org/task/73470">issues</a> that could only be solved by patching uWSGI code by the maintainers of Arch Linux packages, i.e. not upstream.</div>
<h4><span class="mw-headline" id="nextcloud.ini">nextcloud.ini</span></h4>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud">nextcloud</a></span> package includes a sample configuration file already in the right place <code>/etc/uwsgi/nextcloud.ini</code>. In almost any case you will have to adapt this file to your requirements and setup. Find a <a rel="nofollow" class="external text" href="https://gist.githubusercontent.com/wolegis/fc0c01882b694777a6565aa1d0a4da47">version with lots of commented changes</a> (compared to the package's version). It assumes a no-frills Nextcloud installation for private use (i.e. with moderate load).
</p>
<p>In general keep the enabled extensions, extension specific settings and <code>open_basedir</code> in sync with <code>/etc/webapps/nextcloud/php.ini</code> (with the exception of opcache).
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The changes to <code>/etc/uwsgi/nextcloud.ini</code> can become extensive. A file named <code>nextcloud.ini.pacnew</code> will be created during package update in case there are changes in the original file provided by the package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud">nextcloud</a></span>. In order to better track changes in this latter file and apply them to <code>/etc/uwsgi/nextcloud.ini</code> the following approach can be applied:
<ul>
<li>Make a copy of the file as provided by the package (e.g. by extracting from the package) and store it as <code>nextcloud.ini.package</code>.</li>
<li>In case an update of package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud">nextcloud</a></span> produces a <code>nextcloud.ini.pacnew</code> you can identify the changes with <code>diff nextcloud.ini.package nextcloud.ini.pacnew</code>.</li>
<li>Selectively apply the changes to your <code>nextcloud.ini</code> depending on whether they make sense with your version or not.</li>
<li>Move <code>nextcloud.ini.pacnew</code> over <code>nextcloud.ini.package</code>.</li>
</ul>
</div>
<h4><span class="mw-headline" id="uWSGI_service">uWSGI service</span></h4>
<p>The package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=uwsgi">uwsgi</a></span> provides a template unit file (<code>uwsgi@.service</code>). The instance ID (here <i>nextcloud</i>) is used to pick up the right configuration file. <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">Enable</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> <code>uwsgi@nextcloud.service</code>. 
</p>
<p>In case you have more than a few (e.g. 2) services started like this and get the impression this is a waste of resource you might consider using <a rel="nofollow" class="external text" href="https://uwsgi-docs.readthedocs.io/en/latest/Emperor.html">emperor mode</a>.
</p>
<h3><span class="mw-headline" id="FPM">FPM</span></h3>
<p>In case you opt to use <i>FPM</i> as your application server install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy-fpm">php-legacy-fpm</a></span> - preferrably as a dependent package (<code>--asdeps</code>).
</p>
<p>Configuration consists of a copy of <code>php.ini</code> relevant for all applications served by <i>FPM</i> and a so-called pool file specific for the application (here Nextcloud). Finally you have to tweak the systemd service file.
</p>
<h4><span class="mw-headline" id="php-fpm.ini">php-fpm.ini</span></h4>
<p>As stated earlier this article avoids modifications of PHP's central configuration in <code>/etc/php-legacy/php.ini</code>. Instead create a <i>FPM</i> specific copy.
</p>
<pre># cp /etc/php-legacy/php.ini /etc/php-legacy/php-fpm.ini
</pre>
<p>Make sure it is owned and only writeable by root (<code>-rw-r--r-- 1 root root ... php-fpm.ini</code>). Enable the op-cache, i.e. uncomment the line
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/php-legacy/php-fpm.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">zend_extension=opcache</pre>
<p>and put the following parameters below the existing line <code>[opcache]</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/php-legacy/php-fpm.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">opcache.enable = 1
opcache.interned_strings_buffer = 16
opcache.max_accelerated_files = 10000
opcache.memory_consumption = 128
opcache.save_comments = 1
opcache.revalidate_freq = 1</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Do not try to put these settings in the pool file by means of <code>php_value[...]</code> and <code>php_flag[...]</code>. Your <i>FPM</i> processes will consistently crash with the very first request.</div>
<h4><span class="mw-headline" id="nextcloud.conf">nextcloud.conf</span></h4>
<p>Next you have to create a so called pool file for <i>FPM</i>. It is responsible for spawning dedicated <i>FPM</i> processes for the Nextcloud application. Create a file <code>/etc/php-legacy/php-fpm.d/nextcloud.conf</code> - you may use this <a rel="nofollow" class="external text" href="https://gist.githubusercontent.com/wolegis/0d9c83acd0c8bf83bcfb3983931bc364">functional version</a> as a starting point.
</p>
<p>Again make sure this pool file is owned and only writeable by root (i.e. <code>-rw-r--r-- 1 root root ... nextcloud.conf</code>). Depending on whether access log is configured (it is with above sample <code>nextcloud.conf</code>) you may need to create the corresponding directory (here <code>/var/log/php-fpm-legacy/access</code>). Adapt or add settings (especially <code>pm...</code>, <code>php_value[...]</code> and <code>php_flag[...]</code>) to your liking. The settings <code>php_value[...]</code> and <code>php_flag[..]</code> must be consistent with the corresponding settings in <code>/etc/webapps/nextcloud/php.ini</code> (but not <code>/etc/php-legacy/php-fpm.ini</code>).
</p>
<p>The settings done by means of <code>php_value[...]</code> and <code>php_flag[...]</code> could instead be specified in <code>php-fpm.ini</code>. But mind that settings in <code>php-fpm.ini</code> apply for all applications served by <i>FPM</i>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> The package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy-fpm">php-legacy-fpm</a></span> comes with its own pool file <code>www.conf</code> that is of little use here. A good approach to get rid of it is to rename it to <code>www.conf.package</code> and create a file <code>www.conf</code> with only comment lines (lines starting with a semicolon). This way <code>www.conf</code> becomes a no-op. It is also not overwritten during installation of a new version of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy-fpm">php-legacy-fpm</a></span>. Instead a file <code>www.conf.pacnew</code> is created. You can compare this against <code>www.conf.package</code> to see if anything significant has changed in the pool file that you may have to reproduce in <code>nextcloud.conf</code>. Do not forget to rename <code>www.conf.pacnew</code> to <code>www.conf.package</code> at the end of this procedure.</div>
<h4><span class="mw-headline" id="Systemd_service">Systemd service</span></h4>
<p><i>FPM</i> is run as a systemd service. You have to modify the service configuration to be able to run Nextcloud. This is best achieved by means of a <a href="../en/Systemd.html#Drop-in_files" class="mw-redirect" title="Drop-in file">drop-in file</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/php-fpm-legacy.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/php-fpm-legacy --nodaemonize --fpm-config /etc/php-legacy/php-fpm.conf --php-ini /etc/php-legacy/php-fpm.ini
ReadWritePaths=/var/lib/nextcloud
ReadWritePaths=/etc/webapps/nextcloud/config</pre>
<ul>
<li>It replaces the <code>ExecStart</code> line by a start command that uses the <code>php-fpm.ini</code> covered in the previous section.</li>
<li>The directories <code>/var/lib/nextcloud</code> and <code>/etc/webapps/nextcloud/config</code> (and everything below) are made writable. The <code>ProtectSystem=full</code> in the original service definition causes <code>/usr</code>, <code>/boot</code> and <code>/etc</code> to be mounted read-only for the <i>FPM</i> processes.</li>
</ul>
<p>Do not forget to <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> the service <i>php-fpm-legacy</i>.
</p>
<h4>
<span id="Keep_.2Fetc_tidy"></span><span class="mw-headline" id="Keep_/etc_tidy">Keep /etc tidy</span>
</h4>
<p>The Nextcloud package unconditionally creates the uWSGI configuration file <code>/etc/uwsgi/nextcloud.ini</code>. Of course it is of no use when you run <i>FPM</i> instead of <i>uWSGI</i> (and it does no harm whatsoever). In case you nevertheless want to get rid of it just add the following lines to <code>/etc/pacman.conf</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># uWSGI configuration that comes with Nextcloud is not needed
NoExtract = etc/uwsgi/nextcloud.ini</pre>
<h2><span class="mw-headline" id="Web_server">Web server</span></h2>
<p>There is an abundance of web servers you can choose from. Whatever option you finally pick you have to keep in mind that the Nextcloud application needs to be run with its own system user <i>nextcloud</i>. So you will need to forward your requests to one of the above mentioned application servers.
</p>
<h3><span class="mw-headline" id="nginx">nginx</span></h3>
<p>Configuration of <i>nginx</i> is way beyond the scope of this article. See the relevant <a href="../en/Nginx.html" title="Nginx">article</a> for further information. Also consult <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/installation/nginx.html">Nextcloud's documentation</a> for an elaborated configuration. It is up to you how to include this snippet into your nginx' configuration. One common approach is to use directories <code>/etc/nginx/sites-available</code> and <code>/etc/nginx/sites-enabled</code> to separate configurations for various servers (aka virtual hosts). See <a href="../en/Nginx.html#Managing_server_entries" title="Nginx">Nginx#Managing server entries</a> for details. 
</p>
<p>If using the example <i>nginx</i> config from the Nextcloud documentation linked above, the root directory should be changed to:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"><i>cloud.mysite.com</i>.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">  root /usr/share/webapps/nextcloud;</pre>
<p>The usage of the block <code>upstream php-handler { ... } </code> is not necessary. Just specify <code>fastcgi_pass unix:/run/php-fpm-legacy/nextcloud.sock;</code> in the <code>location</code> block that deals with forwarding request with PHP URIs to the application server. When using <i>uWSGI</i> instead of <i>FPM</i> replace this <code>location</code> block with:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"><i>cloud.mysite.com</i>.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">location ~ \.php(?:$|/) {
    include uwsgi_params;
    uwsgi_modifier1 14;
    # Avoid duplicate headers confusing OC checks
    uwsgi_hide_header X-Frame-Options;
    uwsgi_hide_header X-XSS-Protection;
    uwsgi_hide_header X-Content-Type-Options;
    uwsgi_hide_header X-Robots-Tag;
    uwsgi_hide_header X-Download-Options;
    uwsgi_hide_header X-Permitted-Cross-Domain-Policies;
    uwsgi_pass unix:/run/uwsgi/nextcloud.sock;
}
</pre>
<p>Things you might have to adapt (not exhaustive):
</p>
<ul>
<li>Your server name (<code>server_name</code> clauses 2x), i.e. the server part of the URL your Nextcloud installation will be reachable with.</li>
<li>The name of the certificate and key you use for SSL / TLS.</li>
<li>If and where you want an access log written to.</li>
<li>The location where <a href="../en/Certbot.html" title="Certbot">Certbot</a> (or any other ACME client) will put the domain verification challenges. Usage of <code>alias</code> instead of <code>try_files</code> is probably more adequate here.</li>
<li>The path used to reach your Nextcloud installation. (The part right to the server name &amp; port section in the URL.)</li>
<li>What application server (uWSGI or FPM) you are using, i.e. how and where nginx will pass requests that need to trigger some PHP code. (See above.)</li>
<li>Configure <a href="https://en.wikipedia.org/wiki/OCSP_stapling" class="extiw" title="wikipedia:OCSP stapling">OCSP stapling</a>.</li>
</ul>
<p>There is no need to install any additional modules since nginx natively supports both protocols FastCGI and uwsgi.
</p>
<h3><span class="mw-headline" id="Apache_HTTP_server">Apache HTTP server</span></h3>
<p>Find lots of useful information in the article about the <a href="../en/Apache_HTTP_Server.html" title="Apache HTTP Server">Apache HTTP Server</a>. Nextcloud's documentation has some <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/installation/source_installation.html#apache-web-server-configuration">sample configuration</a> that can also be found in <code>/usr/share/doc/nextcloud/apache.example.conf</code>. Both implicitly rely on <i>mod_php</i> that cannot be used anymore. <i>mod_proxy_fcgi</i> or <i>mod_proxy_uwsgi</i> need to be applied.
</p>
<p>Information about how to <a href="../en/Apache_HTTP_Server.html#Using_php-fpm_and_mod_proxy_fcgi" title="Apache HTTP Server">integrate Apache with FPM</a> can be found here in this wiki. uWSGI's documentation has some information about how to <a rel="nofollow" class="external text" href="https://uwsgi-docs.readthedocs.io/en/latest/Apache.html">integrate Apache with PHP by means of uWSGI and mod_proxy_uwsgi</a>. Mind that the Apache package comes with both modules <i>mod_proxy_fcgi</i> and <i>mod_proxy_uwsgi</i>. They need to be loaded as required.
</p>
<p>The following Apache modules are required to run Nextcloud:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/httpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># these are already loaded in a standard Apache installation
LoadModule headers_module modules/mod_headers.so
LoadModule env_module modules/mod_env.so
LoadModule dir_module modules/mod_dir.so
LoadModule mime_module modules/mod_mime.so
LoadModule setenvif_module modules/mod_setenvif.so

# these need to be uncommented explicitly
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule ssl_module modules/mod_ssl.so
LoadModule socache_shmcb_module modules/mod_socache_shmcb.so
LoadModule proxy_module modules/mod_proxy.so

# either this one in case you use FPM
LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so
# or this one in case you opt for uWSGI
LoadModule proxy_uwsgi_module modules/mod_proxy_uwsgi.so
</pre>
<p>Also uncomment the following directive to pull in TLS configuration parameters:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/httpd/conf/httpd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Include conf/extra/httpd-ssl.conf</pre>
<p>Consult <a rel="nofollow" class="external text" href="https://ssl-config.mozilla.org/#server=apache&amp;config=intermediate">Mozilla's SSL configurator</a> for details about how to optimize your TLS configuration.
</p>
<p>Refer to the following two sample configuration files depending on how you want to access your Nextcloud installation:
</p>
<ul><li>In case your Nextcloud installation is accessed via a dedicated host name (e.g. <code>https://cloud.mysite.com/</code>) put <a rel="nofollow" class="external text" href="https://gist.github.com/wolegis/1659786ded9128935f638ee2bf228906">this</a> fragment into <code>/etc/httpd/conf/extra/httpd-vhosts.conf</code>.</li></ul>
<ul><li>In case your Nextcloud installation is located in a subfolder of your web site (e.g. <code>https://www.mysite.com/nextcloud/</code>) put <a rel="nofollow" class="external text" href="https://gist.github.com/wolegis/002e198c2db7980a84fd8d160c2bdb9a">this</a> fragment in your <code>/etc/httpd/conf/httpd.conf</code>.</li></ul>
<p>Of course you must adapt these sample configuration files to your concrete setup. Replace the <code>SetHandler</code> directive by <code>SetHandler "proxy:unix:/run/uwsgi/nextcloud.sock|uwsgi://nextcloud/"</code> when you use <i>uWSGI</i>.
</p>
<p>The Nextcloud package comes with a <code>.htaccess</code> that already takes care of a lot of rewriting and header stuff. Run <code>occ maintenance:update:htaccess</code> to adapt this file. Parameter <code>htaccess.RewriteBase</code> in <code>/etc/webapps/nextcloud/config/config.php</code> is vital for this.
</p>
<h2><span class="mw-headline" id="Background_jobs">Background jobs</span></h2>
<p>Nextcloud requires certain tasks to be run on a scheduled basis. See Nextcloud's <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/background_jobs_configuration.html">documentation</a> for some details. The easiest (and most reliable) way to set up these background jobs is to use the systemd service and timer units that are already installed by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud">nextcloud</a></span>. The service unit needs some tweaking so that the job uses the correct PHP ini-file (and not the global <code>php.ini</code>). Create a <a href="../en/Systemd.html#Drop-in_files" class="mw-redirect" title="Drop-in file">drop-in file</a> and add:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/nextcloud-cron.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/php-legacy -c /etc/webapps/nextcloud/php.ini -f /usr/share/webapps/nextcloud/cron.php</pre>
<p>After that <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> <code>nextcloud-cron.timer</code> (not the service).
</p>
<p>As recommended by the <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/background_jobs_configuration.html#maintenance-window-start">documentation</a> add the parameter
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/config/config.php</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">....
'maintenance_window_start' =&gt; 0,
....</pre>
<p>to Nextcloud's configuration file. The value is the hour of the day in UTC defining the start of a 4 hours window. Time consuming jobs that need to be run only once a day will be scheduled in this time frame, i.e. outside working hours. 
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Do not try to install and use <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nextcloud-systemd-timers/">nextcloud-systemd-timers</a></span><sup><small>AUR</small></sup>. It is outdated and unmaintained.</div>
<h2><span class="mw-headline" id="In-memory_caching">In-memory caching</span></h2>
<p>Nextcloud's <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/caching_configuration.html">documentation</a> recommends to apply some kind of in-memory object cache to significantly improve performance. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Mind that <a rel="nofollow" class="external text" href="https://github.com/nextcloud/notify_push">push notify</a> (the Nextcloud service that replaces client polling by notification by the server thus drastically reducing sync latency) depends on <i>Redis</i>.</div>
<h3><span class="mw-headline" id="APCu">APCu</span></h3>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy-apcu">php-legacy-apcu</a></span> (as dependency <code>--asdeps</code>). Enable the extension in the relevant configuration files. These are
</p>
<ul>
<li>
<code>/etc/webapps/nextcloud/php.ini</code> used by the <code>occ</code> command and the background jobs and</li>
<li>depending on the application server you use either
<ul>
<li>
<code>/etc/uwsgi/nextcloud.ini</code> in case of <i>uWSGI</i> or</li>
<li>
<code>/etc/php-legacy/php-fpm.d/nextcloud.conf</code> in case of <i>FPM</i>.</li>
</ul>
</li>
</ul>
<p>In <code>/etc/webapps/nextcloud/php.ini</code> add the lines
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">extension=apcu
apc.ttl=7200
apc.enable_cli = 1</pre>
<p>(preferably somewhere below <code>Module Settings</code>).
</p>
<p>For the other two files the setting to activate <i>APCu</i> is already in place and only needs to be uncommented. Two other configuration parameters related to <i>APCu</i> are also already there. No need to touch <code>/etc/php-legacy/php.ini</code> or <code>/etc/php-legacy/conf.d/apcu.ini</code>.
</p>
<p>Restart your application server (not the web server as Nextcloud's documentation claims). Add the following line to your Nextcloud configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/config/config.php</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">'memcache.local' =&gt; '\OC\Memcache\APCu',</pre>
<h3><span class="mw-headline" id="Redis">Redis</span></h3>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy-igbinary">php-legacy-igbinary</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy-redis">php-legacy-redis</a></span> (as dependency <code>--asdeps</code>) in case you run this component locally (i.e. on the same host as <i>Nextcloud</i>). Alternatively the <i>Redis</i> server can be run on a different machine. For more information see <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/caching_configuration.html#id2">Nextcloud's documentation</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Using <i>Redis</i> does not exclude using <i>APCu</i> in parallel as a local cache. In fact, Nextcloud's documentation recommends this setup.</div>
<p>Enable the required extensions <code>igbinary</code> and <code>redis</code> in the relevant configuration files. These are:
</p>
<ul>
<li>
<code>/etc/webapps/nextcloud/php.ini</code> used by the <code>occ</code> command and the background jobs and</li>
<li>depending on the application server you use either
<ul>
<li>
<code>/etc/uwsgi/nextcloud.ini</code> in case of <i>uWSGI</i> or</li>
<li>
<code>/etc/php-legacy/php-fpm.d/nextcloud.conf</code> in case of <i>FPM</i>.</li>
</ul>
</li>
</ul>
<p>Locate the existing sections where other extensions are enabled and add two additional lines corresponding to <code>igbinary</code> and <code>redis</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> It is important to load <code>extension=igbinary</code> before <code>extension=redis</code>. Otherwise <code>occ</code> will report an error (<i>/usr/lib/php-legacy/modules/redis.so: undefined symbol: igbinary_serialize</i>).</div>
<p>In case you have specified the <code>open_basedir</code> option in the above configuration files and use <i>Redis</i> locally with a local Unix socket, you have to extend the list of directories where PHP is allowed to read and write files. Locate the relevant lines in the files specified above and add  the directory containing the local Unix socket created by <i>Redis</i>, e.g. <code>/run/redis</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The sample configuration files <a rel="nofollow" class="external text" href="https://gist.githubusercontent.com/wolegis/fc0c01882b694777a6565aa1d0a4da47">nextcloud.ini</a> and <a rel="nofollow" class="external text" href="https://gist.githubusercontent.com/wolegis/0d9c83acd0c8bf83bcfb3983931bc364">nextcloud.conf</a> mentionend in the <a href="#Application_server">#Application server</a> section already have <code>open_basedir</code> enabled. So in case you use a copy of one of these files you have to adapt it.</div>
<p>Extend your Nextcloud configuration as follows:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/config/config.php</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">'memcache.local' =&gt; '\OC\Memcache\APCu',
'memcache.distributed' =&gt; '\OC\Memcache\Redis',
'memcache.locking' =&gt; '\OC\Memcache\Redis',
'redis' =&gt; [
     'host'     =&gt; '/run/redis/redis.sock',
     'port'     =&gt; 0,
     'dbindex'  =&gt; 0,
     'password' =&gt; '<wbr></wbr>',
     'timeout'  =&gt; 1.5,
],</pre>
<p>Again, adapt <code>/run/redis/redis.sock</code> as required. <code>dbindex</code>, <code>password</code> and <code>timeout</code> are optional.
</p>
<p>In case <i>Redis</i> runs on a different machine:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/config/config.php</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">'memcache.local' =&gt; '\OC\Memcache\APCu',
'memcache.distributed' =&gt; '\OC\Memcache\Redis',
'memcache.locking' =&gt; '\OC\Memcache\Redis',
'redis' =&gt; [
     'host' =&gt; '<i>redis-host.mysite.com</i>',
     'port' =&gt; 6379,
],</pre>
<p><code><i>redis-host.mysite.com</i></code> is just a placeholder. Adapt to your actual setup.
</p>
<h2><span class="mw-headline" id="Security_Hardening">Security Hardening</span></h2>
<p>See the <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/installation/harden_server.html">Nextcloud documentation</a> and <a href="../en/Security.html" title="Security">Security</a>. Nextcloud additionally provides a <a rel="nofollow" class="external text" href="https://scan.nextcloud.com/">Security scanner</a>.
</p>
<h2><span class="mw-headline" id="Synchronization">Synchronization</span></h2>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> It is recommended not to use your personal password but so-called app tokens for all software automatically authenticating against your Nextcloud server. This way in case you suspect credentials in one of the programs may have leaked you just need to revoke this one affected app token - instead of having to change your personal password and propagating this change to all places where it has been stored. You can generate a new app token in Nextcloud's web GUI in <i>Settings &gt; Security</i> in the <i>Devices &amp; Sessions</i> section.</div>
<h3><span class="mw-headline" id="Desktop">Desktop</span></h3>
<p>The official client can be installed with the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud-client">nextcloud-client</a></span> package. Alternative versions are available in the <a href="../en/Arch_User_Repository.html" class="mw-redirect" title="AUR">AUR</a>: <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/nextcloud-client-git/">nextcloud-client-git</a></span><sup><small>AUR</small></sup>. Please keep in mind that using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=owncloud-client">owncloud-client</a></span> with Nextcloud is not supported.
</p>
<p>The desktop client basically syncs one or more directories of your desktop computer with corresponding folders in your Nextcloud's file service. It integrates nicely with your desktop's file manager (Dolphin in KDE Plasma, Nautilus in Gnome) displaying overlays representing synchronization and share status. The context menu of each file gets an additional entry <i>Nextcloud</i> to manage sharing of this file and getting the public or internal share link. Nextcloud's documentation has a <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/desktop/latest/">volume</a> exclusively about the desktop client.
</p>
<p>In case the integration does not work as described consult the optional dependencies of package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud-client">nextcloud-client</a></span> (<code>pacman -Qi nextcloud-client</code>). E.g. Nautilus (Gnome) requires <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=python-nautilus">python-nautilus</a></span>. Install as dependent package with <code>pacman -S --asdeps</code>).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The desktop client provides a system tray icon that indicates sync status<a rel="nofollow" class="external autonumber" href="https://docs.nextcloud.com/desktop/latest/visualtour.html">[5]</a>, but GNOME does not provide a system tray icon API out-of-the-box<a rel="nofollow" class="external autonumber" href="https://gitlab.archlinux.org/archlinux/packaging/packages/nextcloud-client/-/issues/5#note_180692">[6]</a>. If this is a desired feature, one possible solution is to install and enable <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnome-shell-extension-appindicator">gnome-shell-extension-appindicator</a></span>. See <a href="../en/GNOME.html#Extensions" title="GNOME">GNOME#Extensions</a> for more info.</div>
<h3><span class="mw-headline" id="Thunderbird">Thunderbird</span></h3>
<p>Since version 102 <a href="../en/Thunderbird.html" title="Thunderbird">Thunderbird</a> fully supports CalDAV and CardDAV - even with auto detection (i.e. you do not have to provide long URLs to access your calendars and address books). See Nextcloud's <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/user_manual/en/groupware/sync_thunderbird.html">documentation</a> for details.
</p>
<h3><span class="mw-headline" id="Mounting_files_with_davfs2">Mounting files with davfs2</span></h3>
<p>If you want to mount your Nextcloud using WebDAV, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/davfs2/">davfs2</a></span><sup><small>AUR</small></sup> (as described in <a href="../en/Davfs2.html" title="Davfs2">davfs2</a>).
</p>
<p>To mount your Nextcloud, use:
</p>
<pre># mount -t davfs https://<i>cloud.mysite.com</i>/remote.php/dav/files/<i>username</i>/ <i>/path/to/mount</i>
</pre>
<p>You can also create an entry for this in <code>/etc/fstab</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/fstab</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">https://<i>cloud.mysite.com</i>/remote.php/dav/files/<i>username</i>/ <i>/path/to/mount</i> davfs rw,user,noauto 0 0
</pre>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> In order to allow automount you can also store your username (and password if you like) in a file as described in <a href="../en/Davfs2.html#Storing_credentials" title="Davfs2">davfs2#Storing credentials</a>.</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If creating/copying files is not possible, while the same operations work on directories, see <a href="../en/Davfs2.html#Creating/copying_files_not_possible_and/or_freezes" title="Davfs2">davfs2#Creating/copying files not possible and/or freezes</a>.</div>
<h3>
<span id="Mounting_files_in_GNOME_Files_.28Nautilus.29"></span><span class="mw-headline" id="Mounting_files_in_GNOME_Files_(Nautilus)">Mounting files in GNOME Files (Nautilus)</span>
</h3>
<p>You can access the files directly in Nautilus ('+ Other Locations') via the WebDAV protocol. Use the link as shown in your Nextcloud installation Web GUI (e.g. <code>https://cloud.mysite.com/remote.php/webdav/</code>) but replace the protocol name <code>https</code> by <code>davs</code>. Nautilus will ask for user name and password when trying to connect.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Make sure you have installed <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gvfs-dnssd">gvfs-dnssd</a></span>, otherwise you may get an error 'Location is not mountable'.</div>
<h3><span class="mw-headline" id="Android">Android</span></h3>
<p>Download the official Nextcloud app from <a rel="nofollow" class="external text" href="https://play.google.com/store/apps/details?id=com.nextcloud.client">Google Play</a> or <a rel="nofollow" class="external text" href="https://f-droid.org/packages/com.nextcloud.client/">F-Droid</a>.
</p>
<p>To enable contacts and calendar sync (Android 4+):
</p>
<ol>
<li>Download <a rel="nofollow" class="external text" href="https://www.davx5.com/">DAVx<sup>5</sup></a> (<a rel="nofollow" class="external text" href="https://play.google.com/store/apps/details?id=at.bitfire.davdroid">Play Store</a>, <a rel="nofollow" class="external text" href="https://f-droid.org/app/at.bitfire.davdroid">F-Droid</a>).</li>
<li>Create a new DAVdroid account in the <i>Account</i> settings and specify your server URL (e.g. <code>https://cloud.mysite.com</code>) and login / password pair.</li>
</ol>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> There is no need for the <code>/remote.php/{carddav,webdav}</code> part if you configured your web server with the proper redirections, as illustrated in the above section <a href="#Web_server">Web server</a>. <i>DAVdroid</i> will find itself the right URLs.</div>
<h3><span class="mw-headline" id="iOS">iOS</span></h3>
<p>Download the official Nextcloud app from the <a rel="nofollow" class="external text" href="https://itunes.apple.com/us/app/nextcloud/id1125420102">App Store</a>.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3>
<span id="Using_the_.22occ.22_command_line_tool"></span><span class="mw-headline" id='Using_the_"occ"_command_line_tool'>Using the "occ" command line tool</span>
</h3>
<p>A useful tool for server administration is <code>occ</code>. Refer to Nextcloud's documentation for <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/occ_command.html">details</a>. You can perform many common server operations with <code>occ</code>, such as managing users and configuring apps.
</p>
<p>A convenience wrapper around the original <code>/usr/share/webapps/nextcloud/occ</code> is provided with <code>/usr/bin/occ</code> which automatically runs as the default user (<i>nextcloud</i>), using the default PHP executable and PHP configuration file. The environment variables <code>NEXTCLOUD_USER</code>, <code>NEXTCLOUD_PHP</code> and <code>NEXTCLOUD_PHP_CONFIG</code> can be used to specify a non-default user, PHP executable and PHP configuration file (respectively). Especially the latter (using <code>NEXTCLOUD_PHP_CONFIG</code>) is necessary when Nextcloud was setup in a way as described in the sections <a href="#Configuration">Configuration</a> and <a href="#Application_server">Application server</a>, i.e. using a PHP configuration specific to Nextcloud. In this case put <code>export NEXTCLOUD_PHP_CONFIG=/etc/webapps/nextcloud/php.ini</code> in your <code>.bashrc</code>.
</p>
<p>When using package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php">php</a></span> instead of the recommended package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy">php-legacy</a></span> you also have to set <code>NEXTCLOUD_PHP</code>, i.e. <code>export NEXTCLOUD_PHP=/usr/bin/php</code>.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong>  When using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy-apcu">php-legacy-apcu</a></span> for caching, make sure to set <code>apc.enable_cli=1</code> in <code>/etc/webapps/nextcloud/php.ini</code>. Otherwise the <code>occ</code> command will complain about APCu not being configured properly.</div>
<h3><span class="mw-headline" id="Pacman_hook">Pacman hook</span></h3>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud">nextcloud</a></span> package comes with a <a href="../en/Pacman.html#Hooks" class="mw-redirect" title="Pacman hook">pacman hook</a> that takes care of automatically upgrading the Nextcloud database after the package has been updated. Take a look <code>/usr/share/doc/nextcloud/nextcloud.hook</code>.
</p>
<p>Unfortunately, this hook unconditionally uses the global <code>php.ini</code> when running <code>occ upgrade</code>, i.e. it does not take into account the value of environment variable <code>NEXTCLOUD_PHP_CONFIG</code> as mentioned above in <a href='#Using_the_"occ"_command_line_tool'>Using the "occ" command line tool</a>.
</p>
<p>As a possible workaround make a copy of the delivered hook file in the appropriate location:
</p>
<pre># mkdir -vp /etc/pacman.d/hooks
# cp -a /usr/share/doc/nextcloud/nextcloud.hook /etc/pacman.d/hooks/10-nextcloud.hook
</pre>
<p>and change the line starting with <code>Exec</code> to:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/10-nextcloud.hook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Exec = /usr/bin/runuser -u nextcloud -- /usr/bin/php-legacy --php-ini /etc/webapps/nextcloud/php.ini /usr/share/webapps/nextcloud/occ upgrade</pre>
<h3><span class="mw-headline" id="Running_Nextcloud_in_a_subdirectory">Running Nextcloud in a subdirectory</span></h3>
<p>The instructions in section <a href="#Web_server">Web server</a> will result in a setup where your Nextcloud installation is reachable via a dedicated server name, e.g. <code>cloud.mysite.com</code>. If you would like to have Nextcloud located in a subdirectory. e.g. <code>www.mysite.com/nextcloud</code>, then:
</p>
<ul><li>For nginx refer to the section in Nextcloud's documentation that explicitly covers this <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/installation/nginx.html#nextcloud-in-a-subdir-of-the-nginx-webroot">topic</a>.</li></ul>
<ul><li>For apache edit the <code>/etc/httpd/conf/extra/nextcloud.conf</code> you included and comment out the <code>&lt;VirtualHost *:80&gt; ... &lt;/VirtualHost&gt;</code> part of the include file.</li></ul>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  Do not forget to configure the <code>.well-known</code> URLs for service discovery. For more information please see <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/issues/general_troubleshooting.html#service-discovery">Service discovery</a> in Nextcloud's documentation.</div>
<h3><span class="mw-headline" id="Docker">Docker</span></h3>
<p>See the <a rel="nofollow" class="external text" href="https://hub.docker.com/_/nextcloud">Nextcloud</a> repository on Docker Hub for running Nextcloud in <a href="../en/Docker.html" title="Docker">Docker</a>.
</p>
<h3><span class="mw-headline" id="Office_integration">Office integration</span></h3>
<p>There are currently three different solutions for office integration:
</p>
<ul>
<li><a rel="nofollow" class="external text" href="https://www.collaboraoffice.com/collabora-online/">Collabora Online</a></li>
<li><a rel="nofollow" class="external text" href="https://www.onlyoffice.com/">ONLYOFFICE</a></li>
<li><a rel="nofollow" class="external text" href="https://docs.microsoft.com/en-us/officeonlineserver/office-online-server-overview">MS Office Online Server</a></li>
</ul>
<p>All three have in common that a dedicated server is required and your web server needs to be adapted to forward certain requests to the office service. The actual integration with Nextcloud is then accomplished by means of a Nextcloud app specific for one of the above products.
</p>
<p>Mind that all three products are aimed at businesses, i.e. you will have to pay for the office service. Only Collabora offers a developers plan (<a rel="nofollow" class="external text" href="https://www.collaboraoffice.com/code/">CODE</a>) for free. ONLYOFFICE offers a <a rel="nofollow" class="external text" href="https://www.onlyoffice.com/en/docs-enterprise-prices.aspx">Home Server</a> plan for a reasonable price.
</p>
<p>For installation, setup instructions and integration with Nextcloud consult:
</p>
<ul>
<li>
<a rel="nofollow" class="external text" href="https://nextcloud.com/collaboraonline/">Collabora online</a>, <a rel="nofollow" class="external text" href="https://apps.nextcloud.com/apps/richdocuments">app</a>
</li>
<li>
<a rel="nofollow" class="external text" href="https://api.onlyoffice.com/editors/nextcloud">ONLYOFFICE</a>, <a rel="nofollow" class="external text" href="https://apps.nextcloud.com/apps/onlyoffice">app</a>
</li>
<li>
<a rel="nofollow" class="external text" href="https://github.com/nextcloud/officeonline">MS Office Online Server</a>, <a rel="nofollow" class="external text" href="https://apps.nextcloud.com/apps/officeonline">app</a>
</li>
</ul>
<h3><span class="mw-headline" id="Disabling_app_recommendations">Disabling app recommendations</span></h3>
<p>By default, Nextcloud recommends apps to new clients, which can result in a lot of notifications. To disable this, disable the recommendations app using <code>occ app:disable recommendations</code>.
</p>
<h3><span class="mw-headline" id="Backup_calendars_and_address_books_with_calcardbackup">Backup calendars and address books with calcardbackup</span></h3>
<p>The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/calcardbackup/">calcardbackup</a></span><sup><small>AUR</small></sup> package can be installed and configured to provide regular backups of the calendar and/or address book databases. Edit <code>/etc/calcardbackup/calcardbackup.conf</code> to your liking and then <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">enable</a> <code>calcardbackup.timer</code>.
</p>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Reading_the_log">Reading the log</span></h3>
<p>By default, the logs of the web application are available in <code>/var/log/nextcloud/nextcloud.log</code>. The entries (lines) are in JSON format and can be very long. Readability can be greatly improved by using <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=jq">jq</a></span>:
</p>
<pre># jq . &lt;/var/log/nextcloud/nextcloud.log | less</pre>
<h3>
<span id="Work_around_.22is_file.28.29:_open_basedir_restriction_in_effect.22"></span><span class="mw-headline" id='Work_around_"is_file():_open_basedir_restriction_in_effect"'>Work around "is_file(): open_basedir restriction in effect"</span>
</h3>
<p>With Nextcloud v28.0.4 a regression was introduced that manifests in error messages containing
</p>
<pre>is_file(): open_basedir restriction in effect
</pre>
<p>in the log file <code>/var/log/nextcloud/nextcloud.log</code>. The file path given after this messages is missing one slash at one position, whereas at another position there is one too many, e.g.
</p>
<pre>File (/usr/share/webapps/nextcloudapps//dav/l10n/de.js)
</pre>
<p>This is a known <a rel="nofollow" class="external text" href="https://github.com/nextcloud/server/issues/44358">bug</a> that has already been <a rel="nofollow" class="external text" href="https://github.com/nextcloud/server/pull/44408">fixed</a> and <a rel="nofollow" class="external text" href="https://github.com/nextcloud/server/pull/44413">backported to v28.0.5</a>. For v28.0.4 you may apply the following work-around:
</p>
<ul><li>Add a symbolic link <code>/usr/share/webapps/nextcloudapps</code> pointing to <code>/usr/share/webapps/nextcloud/apps</code>
</li></ul>
<pre># cd /usr/share/webapps
# ln -sf nextcloud/apps nextcloudapps
</pre>
<ul><li>Add the path of this symbolic link to the <code>open_basedir</code> settings relevant for your Nextcloud installation. These are:</li></ul>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">open_basedir=...:/usr/share/webapps/nextcloudapps:...</pre>
<p>and depending on the application server you use either (FPM)
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/php-legacy/php-fpm.d/nextcloud.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">php_value[open_basedir] = ...:/usr/share/webapps/nextcloudapps:...</pre>
<p>or (uWSGI)
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/uwsgi/nextcloud.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">php-set = open_basedir=...:/usr/share/webapps/nextcloudapps:...</pre>
<p>With v28.0.5 you should be able to roll back this work-around again.
</p>
<h3><span class="mw-headline" id="Upgrading_v27_to_v28">Upgrading v27 to v28</span></h3>
<p>Upgrading a version 27 installation to version 28 requires the following steps:
</p>
<h4><span class="mw-headline" id="Install_and_enable_extension_sodium">Install and enable extension sodium</span></h4>
<p>With version 28 it is recommended to install and enable PHP extension <i>sodium</i> that provides the argon2 hashing algorithm. Install the corresponding package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy-sodium">php-legacy-sodium</a></span> as a dependency (i.e. with <code>--asdeps</code>) and  enable it in two places:
</p>
<ul>
<li>
<code>/etc/webapps/nextcloud/php.ini</code> used by the <code>occ</code> command and the background jobs and</li>
<li>depending on the application server you use either
<ul>
<li>
<code>/etc/uwsgi/nextcloud.ini</code> in case of <i>uWSGI</i> or</li>
<li>
<code>/etc/php-legacy/php-fpm.d/nextcloud.conf</code> in case of <i>FPM</i>.</li>
</ul>
</li>
</ul>
<p>Just look for the existing sections where other extensions are enabled and add an additional line corresponding to <code>sodium</code>.
</p>
<h4><span class="mw-headline" id="Add_maintenance_window_start_to_configuration">Add maintenance_window_start to configuration</span></h4>
<p>It is recommended to add parameter <code>maintenance_window_start</code> to Nextcloud's configuration file <code>/etc/webapps/nextcloud/config/config.php</code>. See section <a href="#Background_jobs">#Background jobs</a> and Nextcloud's <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/background_jobs_configuration.html#maintenance-window-start">documentation</a> for details.
</p>
<h4>
<span id="Work_around_.22ResourceLocator_can_not_find_a_web_root.22"></span><span class="mw-headline" id='Work_around_"ResourceLocator_can_not_find_a_web_root"'>Work around "ResourceLocator can not find a web root"</span>
</h4>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This issue has been resolved with version v28.0.4.</div>
<p>Up until version 28.0.3 Nextcloud suffers a regression that manifests in the log <code>/var/log/nextcloud/nextcloud.log</code> being flooded with messages like
</p>
<dl><dd>ResourceLocator can not find a web root</dd></dl>
<p>See the corresponding <a rel="nofollow" class="external text" href="https://github.com/nextcloud/server/issues/42493">GitHub ticket</a>. Fortunately, the issue has no impact on Nextcloud's functionality, but real problems may become burried in this log noise. The work-around is to change Nextcloud's configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/config/config.php</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">'apps_paths' =&gt; 
  array (
    0 =&gt; 
    array (
      'path' =&gt; '/usr/share/webapps/nextcloud/apps',
      'url' =&gt; '/apps',
      'writable' =&gt; false,
    ),
    1 =&gt; 
    array (
      'path' =&gt; '<b>/usr/share/webapps/nextcloud/wapps</b>',
      'url' =&gt; '/wapps',
      'writable' =&gt; true,
    ),
  ),</pre>
<p><code>/usr/share/webapps/nextcloud/wapps</code> is a symlink to <code>/var/lib/nextcloud/apps</code>. It is part of the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud">nextcloud</a></span> package - so usually is already present. If it does not exist for whatever reason create it with:
</p>
<pre># ln -sf /var/lib/nextcloud/apps /usr/share/webapps/nextcloud/wapps</pre>
<p>When the issue has been resolved the <code>path</code> can be changed back to <code>/var/lib/nextcloud/apps</code>.
</p>
<h3><span class="mw-headline" id="Migrating_to_php-legacy">Migrating to php-legacy</span></h3>
<p>In the past it had happened several times that the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php">php</a></span> package was updated to the latest PHP version in a timely manner (in line with Arch Linux' rolling release philosophy) but Nextcloud not being compatible with this brand new version - breaking existing installations and causing lots of efforts for maintainers and users of package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud">nextcloud</a></span>. When package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php">php</a></span> switched from version 8.1 to version 8.2 this was about to happen once again.
</p>
<p>To avoid this frequent hassle a new <a rel="nofollow" class="external text" href="https://archlinux.org/packages/?q=php-legacy">set of php-legacy</a> packages has been <a rel="nofollow" class="external text" href="https://archlinux.org/news/php-82-update-and-introduction-of-legacy-branch/">introduced</a> by that time. These will follow the oldest but still <a rel="nofollow" class="external text" href="https://www.php.net/supported-versions.php">actively supported PHP</a> branch. Package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud">nextcloud</a></span> has been modified to depend on meta package <i>php-interpreter</i> which is provided by <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php">php</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy">php-legacy</a></span>. This way users of package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud">nextcloud</a></span> have the choice to build their Nextcloud installation either on top of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php">php</a></span> or on top of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy">php-legacy</a></span>.
</p>
<p>It is highly recommended to go for <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy">php-legacy</a></span>. With this only slightly aged version of PHP it will be very unlikely that a system upgrade renders an existing Nextcloud installation unusable.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Users choosing the latest and greatest version of PHP (i.e. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php">php</a></span>) have to be prepared for troubles when package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php">php</a></span> switches major or even minor versions. These troubles will mainly manifest in package <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud">nextcloud</a></span> suddenly not offering <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php">php</a></span> as dependency (because its version not being supported by Nextcloud at that point in time). This effectively will force users going for <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php">php</a></span> to occasionally migrate to <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy">php-legacy</a></span> temporarily, i.e. some time later they will have to migrate back to <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php">php</a></span>.</div>
<p>Migrating to <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy">php-legacy</a></span> requires some manual actions. Depending on your actual setup a subset of the following tasks must be applied:
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The following list of actions assumes that your Nextcloud installation has been set up according to this wiki article. In case your setup deviates from this approach please be extra careful and adapt the steps appropriately.</div>
<h4><span class="mw-headline" id="PHP_extensions">PHP extensions</span></h4>
<p>Replace <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php">php</a></span> extensions by their corresponding <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy">php-legacy</a></span> counterparts. For example
</p>
<pre>$ pacman -R php-apcu php-fpm php-gd php-imagick php-pgsql
$ pacman -S --asdeps php-legacy-apcu php-legacy-gd php-legacy-fpm php-legacy-imagick php-legacy-pgsql
</pre>
<p>The former extension <i>php-intl</i> is an exception as it has become an integral part of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php">php</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy">php-legacy</a></span>. So there is no need to explicitly take care of this package here.
</p>
<p>The actual set of PHP extensions is subject to the database, the in-memory object cache, the application server and other factors. Of course, in case another application depends on the most recent PHP version the non-legacy module may still be needed. Same applies for <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php">php</a></span> itself.
</p>
<h4><span class="mw-headline" id="Nextcloud_specific_copy_of_php.ini">Nextcloud specific copy of <code>php.ini</code></span></h4>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/php.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">open_basedir=...:/usr/lib/php-legacy/modules:...
extension_dir = "/usr/lib/php-legacy/modules/"
;extension=imap                                            &lt;= to be deleted</pre>
<h4><span class="mw-headline" id="FPM_configuration">FPM configuration</span></h4>
<p>(This only applies if the application server <i>FPM</i> is used.)
</p>
<pre>$ mv /etc/php/php-fpm.ini /etc/php-legacy/php-fpm.ini
$ mv /etc/php/php-fpm.d/nextcloud.conf /etc/php-legacy/php-fpm.d/nextcloud.conf
</pre>
<p>Modify <code>/etc/php-legacy/php-fpm.ini</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/php-legacy/php-fpm.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">extension_dir = "/usr/lib/php-legacy/modules/"
;extension=imap                                            &lt;= to be deleted</pre>
<p>Modify <code>/etc/php-legacy/php-fpm.d/nextcloud.conf</code>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/php-legacy/php-fpm.d/nextcloud.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">listen = /run/php-fpm-legacy/nextcloud.sock
;       It's available in: /usr/share/php-legacy/fpm/status.html
access.log = /var/log/php-fpm-legacy/access/$pool.log
; uncomment if php-imap is installed and used              &lt;= to be deleted
; php_value[extension] = imap                              &lt;= to be deleted</pre>
<p>Optional, but recommended: Make <code>www.conf</code> a no-op while still being able to track modifications of this file that might come in with future updates of <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=php-legacy-fpm">php-legacy-fpm</a></span>
</p>
<pre>$ mv /etc/php-legacy/php-fpm.d/www.conf /etc/php-legacy/php-fpm.d/www.conf.package
$ echo "; just a no-op" &gt; /etc/php-legacy/php-fpm.d/www.conf</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Stop">Stop</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Disable">disable</a> the systemd service <i>php-fpm.service</i>. Create a <a href="../en/Systemd.html#Drop-in_files" class="mw-redirect" title="Drop-in file">drop-in file</a> for <i>php-fpm-legacy.service</i>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/php-fpm-legacy.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/php-fpm-legacy --nodaemonize --fpm-config /etc/php-legacy/php-fpm.conf --php-ini /etc/php-legacy/php-fpm.ini
ReadWritePaths=/var/lib/nextcloud
ReadWritePaths=/etc/webapps/nextcloud/config</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Enable">Enable</a> and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">start</a> the systemd service <i>php-fpm-legacy.service</i>.
</p>
<h4><span class="mw-headline" id="uWSGI_configuration">uWSGI configuration</span></h4>
<p>(This only applies if the application server <i>uWSGI</i> is used.)
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/uwsgi/nextcloud.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">php-set = open_basedir=...:/usr/lib/php-legacy/modules...
# uncomment if php-imap is installed and used               &lt;= to be deleted
# php-set = extension=imap                                  &lt;= to be deleted</pre>
<h4><span class="mw-headline" id="Nginx_configuration">Nginx configuration</span></h4>
<p>Modify the file where the forwarding of certain requests to the application server is configured. In case of <i>FPM</i> e.g.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"><i>cloud.mysite.com</i>.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">fastcgi_pass unix:/run/php-fpm-legacy/nextcloud.sock;</pre>
<p>In case of <i>uWSGI</i> no adaptation is required.
</p>
<h4><span class="mw-headline" id="Apache_HTTP_server_configuration">Apache HTTP server configuration</span></h4>
<p>In case you use Apache's HTTP server and <i>FPM</i> as application server adapt this line in your configuration
</p>
<pre>SetHandler "proxy:unix:/run/php-fpm-legacy/nextcloud.sock|fcgi://nextcloud/"</pre>
<p>In case of <i>uWSGI</i> no adaptation is required.
</p>
<h4><span class="mw-headline" id="Background_jobs_2">Background jobs</span></h4>
<p>Update the <a href="../en/Systemd.html#Drop-in_files" class="mw-redirect" title="Drop-in file">drop-in file</a> for Nextcloud's scheduled background job:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/nextcloud-cron.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
ExecStart=
ExecStart=/usr/bin/php-legacy -c /etc/webapps/nextcloud/php.ini -f /usr/share/webapps/nextcloud/cron.php</pre>
<h4><span class="mw-headline" id="Pacman_hook_2">Pacman hook</span></h4>
<p>The pacman hook <code>/etc/pacman.d/hooks/10-nextcloud.hook</code> needs to be adapted as well. Change the line starting with <code>Exec</code> to:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.d/hooks/10-nextcloud.hook</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">Exec = /usr/bin/runuser -u nextcloud -- /usr/bin/php-legacy --php-ini /etc/webapps/nextcloud/php.ini /usr/share/webapps/nextcloud/occ upgrade</pre>
<p>Otherwise during the next upgrade of Nextcloud pacman will complain about <code>/usr/bin/php</code> not being found.
</p>
<h4><span class="mw-headline" id="Cleanup">Cleanup</span></h4>
<p>Do not forget to cleanup files and directories that may have become obsolete. Potential candidates are:
</p>
<pre>/usr/lib/php
/etc/php
</pre>
<h3><span class="mw-headline" id="Weird_behavior_of_one_or_more_apps">Weird behavior of one or more apps</span></h3>
<p>There are two locations where folders with files of Nextcloud's apps can be found:
</p>
<ul><li>
<code>/usr/share/webapps/nextcloud/apps</code> (aka read-only apps directory). This is where the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud">nextcloud</a></span> package and the app packages (e.g. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nextcloud-app-contacts">nextcloud-app-contacts</a></span>) put the folders with files comprising Nextcloud apps.</li></ul>
<ul><li>
<code>/var/lib/nextcloud/apps</code> (aka writeable apps directory). This is where you find folders with files of apps installed via GUI or via the <code>occ app:install</code> command.</li></ul>
<p>When files of an app can be found in both directories (especially in different versions) all kind of strange things can happen. In a concrete <a rel="nofollow" class="external text" href="https://github.com/nextcloud/contacts/issues/2867">case</a> the <i>contacts</i> app could be found in both the read-only apps directory and the writeable apps directory. As a result the page with contacts in the GUI did not display. It remained blank white. The browser's Javascript console showed an error message:
</p>
<pre>Uncaught Error: Could not find initial state contactsinteraction of contacts</pre>
<p>Check for apps to be found in both locations. To find out whether to delete the app folder in the read-only directory or in the writeable directory determine whether the app is part of a package. Run
</p>
<pre># cd /usr/share/webapps/nextcloud/apps
# pacman -Qo * &gt;/dev/null
</pre>
<p>All folders reported with
</p>
<pre>error: No package owns ....
</pre>
<p>(and that can also be found in the writeable apps directory) can be safely deleted from <code>/usr/share/webapps/nextcloud/apps</code>. Other double installed apps (i.e. those belonging to a package) should be removed from <code>/var/lib/nextcloud/apps</code>.
</p>
<h3>
<span id="InnoDB_refuses_to_write_tables_with_ROW_FORMAT.3DCOMPRESSED"></span><span class="mw-headline" id="InnoDB_refuses_to_write_tables_with_ROW_FORMAT=COMPRESSED">InnoDB refuses to write tables with ROW_FORMAT=COMPRESSED</span>
</h3>
<p>MariaDB versions &gt;= 10.6 and &lt; 10.6.6 were not compatible with Nextcloud as the database enforced <a rel="nofollow" class="external text" href="https://mariadb.com/kb/en/innodb-compressed-row-format/#read-only">read-only for compressed InnoDB tables</a> and Nextcloud has been (and still is) using these kind of tables:
</p>
<dl>
<dd>From MariaDB 10.6.0 until MariaDB 10.6.5, tables that are of the COMPRESSED row format are read-only by default. This was intended to be the first step towards removing write support and deprecating the feature.</dd>
<dd></dd>
<dd>This plan has been scrapped, and from MariaDB 10.6.6, COMPRESSED tables are no longer read-only by default.</dd>
</dl>
<p>Additionally the issue has already been <a rel="nofollow" class="external text" href="https://github.com/nextcloud/server/pull/30129">addressed</a> by Nextcloud. Starting with Nextcloud v24 new installations of Nextcloud do not use row format COMPRESSED anymore. It has to be noted that existing (pre v24) installations are not migrated away from row format COMPRESSED automatically.
</p>
<p>Bottom line: Probably you are not affected since Arch Linux has been shipping MariaDB v10.6.6 or later since 2022-02-10.
</p>
<p>In the unlikely case that you are affected by this issue there are several possible remedies:
</p>
<ul><li>Adapt your MariaDB configuration:</li></ul>
  <pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/my.cnf.d/server.cnf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[mariadb-10.6]
  innodb_read_only_compressed=OFF</pre>
<ul><li>Migrate your MariaDB tables from row format COMPRESSED to DYNAMIC as suggested by <a rel="nofollow" class="external text" href="https://github.com/nextcloud/server/issues/25436#issuecomment-1016785831">some</a> <a rel="nofollow" class="external text" href="https://github.com/nextcloud/server/issues/25436#issuecomment-1017462542">comments</a> for the corresponding <a rel="nofollow" class="external text" href="https://github.com/nextcloud/server/issues/25436">Nextcloud issue</a>. Mind that as long as you stay with Nextcloud &lt; v24 new tables will again use row format COMPRESSED - so will need to be migrated in the same way.</li></ul>
<ul><li>Replace MariaDB by PostgreSQL and migrate the data of your Nextcloud instance with <code>occ db:convert-type</code>. See Nextcloud's <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_database/db_conversion.html">documentation</a> for details.</li></ul>
<h3>
<span id="Issues_with_permissions_and_setup_after_upgrade_to_.3E.3D_21.0.0"></span><span class="mw-headline" id="Issues_with_permissions_and_setup_after_upgrade_to_&gt;=_21.0.0">Issues with permissions and setup after upgrade to &gt;= 21.0.0</span>
</h3>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  Before nextcloud 21.0.0, the web application was run using the <code>http</code> user. This is a security concern in regards to cross-application access of this user (it has access to all data of all web applications).</div>
<p>Since version 21.0.0 nextcloud more closely follows the <a href="../en/Web_application_package_guidelines.html" title="Web application package guidelines">web application package guidelines</a>. This introduces the separate user <code>nextcloud</code>, as which the web application is run.
</p>
<p>After an upgrade from nextcloud &lt; 21.0.0 make sure that
</p>
<ul>
<li>the data directory is located at <code>/var/lib/nextcloud/data</code>
</li>
<li>the writable apps directory is located at <code>/var/lib/nextcloud/apps</code>
</li>
<li>both the data directory and the writable apps directory, alongside all files beneath them are writable and owned by the <code>nextcloud</code> user</li>
<li>the web application configuration file resides in <code>/etc/webapps/nextcloud/config/</code> and that that directory and its contents are writable and owned by the <code>nextcloud</code> user</li>
<li>an application server, such as <a href="#FPM">FPM</a> or <a href="#uWSGI">uWSGI</a> is configured to run the web application as the <code>nextcloud</code> user and not the <code>http</code> user</li>
<li>update the cron job/systemd timer to run with the new user</li>
<li>Finally allow read access to the nextcloud installation <code>/usr/share/webapps/nextcloud</code> to your web-server user <code>http</code> by doing:</li>
</ul>
<pre> # chown -R nextcloud:http /usr/share/webapps/nextcloud
</pre>
<h3>
<span id="Login_loop_without_any_clue_in_access.log.2C_error.log.2C_nor_nextcloud.log"></span><span class="mw-headline" id="Login_loop_without_any_clue_in_access.log,_error.log,_nor_nextcloud.log">Login loop without any clue in access.log, error.log, nor nextcloud.log</span>
</h3>
<p>As mentioned in a <a rel="nofollow" class="external text" href="https://bbs.archlinux.org/viewtopic.php?pid=1967719#p1967719">post in the forum</a>, this issue can be fixed by setting correct permissions on the <i>sessions</i> directory. (See <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/stable/admin_manual/installation/nginx.html#login-loop-without-any-clue-in-access-log-error-log-nor-nextcloud-log">Nextcloud's documentation</a> for details.) It is also possible that the <i>sessions</i> directory is missing altogether. The creation of this directory is documented in <a href="#System_and_environment">System and environment</a>.
</p>
<p><code>/var/lib/nextcloud</code> should look like this:
</p>
<pre>drwxr-xr-x  6 nextcloud nextcloud 4096 17. Apr 00:56 ./
drwxr-xr-x 21 root      root      4096 17. Apr 00:53 ../
drwxr-xr-x  2 nextcloud nextcloud 4096 16. Feb 00:21 apps/
drwxrwx--- 10 nextcloud nextcloud 4096 16. Apr 13:46 data/
drwx------  2 nextcloud nextcloud 4096 17. Apr 01:04 sessions/
</pre>
<p>Also, this can be caused by a full system-partition caused by an extensive size of nextcloud.log because of <a rel="nofollow" class="external text" href="https://github.com/nextcloud/server/issues/44573">this bug</a>. In this case, truncating the log-file and disabling the preview-generator or setting the log-level to 4 in config.php and restarting Nextcloud helps.
</p>
<h3><span class="mw-headline" id="Environment_variables_not_available">Environment variables not available</span></h3>
<p>Depending on what application server you use custom environment variables can be provided to Nextcloud's PHP code.
</p>
<h4><span class="mw-headline" id="FPM_2">FPM</span></h4>
<p>Add one or more lines in <code>/etc/php-legacy/php-fpm.d/nextcloud.conf</code> as per <a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/installation/source_installation.html#php-fpm-tips-label">Nextcloud's documentation</a>, e.g.:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/php-legacy/php-fpm.d/nextcloud.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">env[PATH] = /usr/local/bin:/usr/bin:/bin</pre>
<h4><span class="mw-headline" id="uWSGI_2">uWSGI</span></h4>
<p>Add one or more lines in <code>/etc/uwsgi/nextcloud.ini</code>, e.g.:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/uwsgi/nextcloud.ini</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">env = PATH=/usr/local/bin:/usr/bin:/bin</pre>
<p>Mind there must not be any blanks around the second <code>=</code>.
</p>
<h3>
<span id="You_are_accessing_your_instance_over_a_secure_connection.2C_however_your_instance_is_generating_insecure_URLs"></span><span class="mw-headline" id="You_are_accessing_your_instance_over_a_secure_connection,_however_your_instance_is_generating_insecure_URLs">You are accessing your instance over a secure connection, however your instance is generating insecure URLs</span>
</h3>
<p>If you get the following message in your administration settings:
</p>
<dl><dd>You are accessing your instance over a secure connection, however your instance is generating insecure URLs. This most likely means that you are behind a reverse proxy and the overwrite config variables are not set correctly. Please read the documentation page about this.</dd></dl>
<p>Add the following in your configuration file: <a rel="nofollow" class="external autonumber" href="https://help.nextcloud.com/t/instance-over-a-secure-connection-however-your-instance-is-generating-insecure-urls/134108">[7]</a>
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/webapps/nextcloud/config/config.php</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">'trusted_proxies' =&gt; ['192.168.1.0'],
'overwriteprotocol' =&gt; 'https',</pre>
<p>Replace <code>192.168.1.0</code> with your public IP.
</p>
<h3>
<span id="Nextcloud_reports_corrupted_index_.28MariaDB.29"></span><span class="mw-headline" id="Nextcloud_reports_corrupted_index_(MariaDB)">Nextcloud reports corrupted index (MariaDB)</span>
</h3>
<p>If Nextcloud reports corrupted indices (e.g. during <code>occ db:</code> commands or in <i>Administration &gt; Logging</i>) you can repair your database by executing:
</p>
<pre>$ mysqlcheck --check --auto-repair nextcloud -u nextcloud -p
</pre>
<p>If the command fails, it still will point out the table <code>TABLE</code> containing a corrupted index. Repair it by logging into mariadb:
</p>
<pre>$ mysql -u nextcloud -p
mysql&gt; use nextcloud;
mysql&gt; check table <i>TABLE</i>;
mysql&gt; optimize table <i>TABLE</i>;
mysql&gt; exit;
</pre>
<p>Replace <code><i>TABLE</i></code> to match your findings.
</p>
<h3><span class="mw-headline" id="Failed_to_fetch_the_Collabora_capabilities_endpoint">Failed to fetch the Collabora capabilities endpoint</span></h3>
<p>In case you get responses with: 
</p>
<dl><dd>Failed to fetch the Collabora capabilities endpoint: Client error: `GET http://localhost/wapps/richdocumentscode/proxy.php?req=/hosting/capabilities` resulted in a `404 Not Found` response</dd></dl>
<p>double-check your <code>config.php</code> that entry <code>overwrite.cli.url</code> has been set as described in section <a href="#Nextcloud">Configuration / Nextcloud</a>.
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://docs.nextcloud.com/">Nextcloud Documentation Overview</a></li>
<li><a rel="nofollow" class="external text" href="https://docs.nextcloud.com/server/latest/admin_manual/">Nextcloud Admin Manual</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:File_sharing.html" title="Category:File sharing">File sharing</a></li>
<li><a href="../en/Category:Web_applications.html" title="Category:Web applications">Web applications</a></li>
</ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Nextcloud&amp;oldid=812581">https://wiki.archlinux.org/index.php?title=Nextcloud&amp;oldid=812581</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 17 July 2024, at 11:37.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
