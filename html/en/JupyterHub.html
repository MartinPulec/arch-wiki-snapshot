<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-client-preferences-disabled vector-feature-client-prefs-pinned-disabled vector-feature-night-mode-disabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>JupyterHub - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.42.1">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="icon" href="/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-JupyterHub rootpage-JupyterHub skin-vector-2022 action-view skin--responsive">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" role="navigation" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">1</span>Installation</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Running" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Running">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">2</span>Running</div>
		</a>
		
		<ul id="toc-Running-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">3</span>Configuration</div>
		</a>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Authenticators" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Authenticators">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">4</span>Authenticators</div>
		</a>
		
			<button aria-controls="toc-Authenticators-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Authenticators subsection</span>
			</button>
		
		<ul id="toc-Authenticators-sublist" class="vector-toc-list">
			<li id="toc-PAM_Authenticator" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#PAM_Authenticator">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1</span>PAM Authenticator</div>
			</a>
			
			<ul id="toc-PAM_Authenticator-sublist" class="vector-toc-list">
				<li id="toc-PAM_authentication_as_non-root_user" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#PAM_authentication_as_non-root_user">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">4.1.1</span>PAM authentication as non-root user</div>
			</a>
			
			<ul id="toc-PAM_authentication_as_non-root_user-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Spawners" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Spawners">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">5</span>Spawners</div>
		</a>
		
			<button aria-controls="toc-Spawners-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Spawners subsection</span>
			</button>
		
		<ul id="toc-Spawners-sublist" class="vector-toc-list">
			<li id="toc-LocalProcessSpawner" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#LocalProcessSpawner">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.1</span>LocalProcessSpawner</div>
			</a>
			
			<ul id="toc-LocalProcessSpawner-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-SudoSpawner" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#SudoSpawner">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.2</span>SudoSpawner</div>
			</a>
			
			<ul id="toc-SudoSpawner-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-systemdspawner" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#systemdspawner">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">5.3</span>systemdspawner</div>
			</a>
			
			<ul id="toc-systemdspawner-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Services" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Services">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">6</span>Services</div>
		</a>
		
			<button aria-controls="toc-Services-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Services subsection</span>
			</button>
		
		<ul id="toc-Services-sublist" class="vector-toc-list">
			<li id="toc-Idle_culler" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Idle_culler">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">6.1</span>Idle culler</div>
			</a>
			
			<ul id="toc-Idle_culler-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tips_and_Tricks" class="vector-toc-list-item vector-toc-level-1 vector-toc-list-item-expanded">
		<a class="vector-toc-link" href="#Tips_and_Tricks">
			<div class="vector-toc-text">
			<span class="vector-toc-numb">7</span>Tips and Tricks</div>
		</a>
		
			<button aria-controls="toc-Tips_and_Tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon vector-icon--x-small mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and Tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_Tricks-sublist" class="vector-toc-list">
			<li id="toc-Running_as_non-root_user" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Running_as_non-root_user">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.1</span>Running as non-root user</div>
			</a>
			
			<ul id="toc-Running_as_non-root_user-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_a_reverse_proxy" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_a_reverse_proxy">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.2</span>Using a reverse proxy</div>
			</a>
			
			<ul id="toc-Using_a_reverse_proxy-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Proxy_other_web_services" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Proxy_other_web_services">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.3</span>Proxy other web services</div>
			</a>
			
			<ul id="toc-Proxy_other_web_services-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Access_to_GPUs" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Access_to_GPUs">
				<div class="vector-toc-text">
				<span class="vector-toc-numb">7.4</span>Access to GPUs</div>
			</a>
			
			<ul id="toc-Access_to_GPUs-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" role="main" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav role="navigation" aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">JupyterHub</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 1 language">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-1" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">1 language</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/JupyterHub" title="JupyterHub – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-client-prefs-landmark" aria-label="Appearance">
						</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<p><a rel="nofollow" class="external text" href="https://jupyterhub.readthedocs.io/">JupyterHub</a> is a multi-user web server for <a href="../en/Jupyter.html" title="Jupyter">Jupyter</a> notebooks. It consists of four subsystems:
</p>
<ol>
<li>The main hub process.</li>
<li>
<a href="#Authenticators">Authenticators</a> which authenticate users.</li>
<li>
<a href="#Spawners">Spawners</a> which start and monitor a single-user server for each connected user.</li>
<li>An HTTP proxy which receives incoming requests and routes them to either the hub or the appropriate single-user server.</li>
</ol>
<p>See the <a rel="nofollow" class="external text" href="https://jupyterhub.readthedocs.io/en/stable/reference/technical-overview.html">technical overview</a> in the JupyterHub documentation for more details.
</p>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/jupyterhub/">jupyterhub</a></span><sup><small>AUR</small></sup> package. In most cases you will also need to install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=jupyter-notebook">jupyter-notebook</a></span> package (some more advanced <a href="#Spawners">spawners</a> may not require it). The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=jupyterlab">jupyterlab</a></span> package can also be installed to make the <a rel="nofollow" class="external text" href="https://jupyterlab.readthedocs.io/">JupyterLab</a> interface available.
</p>
<h2><span class="mw-headline" id="Running">Running</span></h2>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">Start/enable</a> <code>jupyterhub.service</code>. With the default configuration you can access the hub by going to 127.0.0.1:8000 in your browser.
</p>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>The JupyterHub configuration file is located at <code>/etc/jupyterhub/jupyterhub_config.py</code>. This is a Python script which modifies the configuration object <code>c</code>. The configuration file provided by the package shows the available configuration options and their default values.
</p>
<p>Any relative paths in the configuration are resolved from the working directory that the hub is run from. The systemd service provided by the package uses <code>/etc/jupyterhub</code> as the working directory. This means, for example, that the default database URL <code>c.JupyterHub.db_url = 'sqlite:///jupyterhub.sqlite'</code> corresponds to the file <code>/etc/jupyterhub/jupyterhub.sqlite</code>.
</p>
<p>All configuration options can be overridden on the command line. For example, the configuration file setting <code>c.Application.show_config = True</code> could instead be set with the command line flag <code>--Application.show_config=True</code>. Note that the provided systemd service uses the command line to explicitly set the <code>c.JupyterHub.pid_file</code> and <code>c.ConfigurableHTTPProxy.pid_file</code> values to a suitable runtime directory so any values for them in the configuration file will be ignored.
</p>
<h2><span class="mw-headline" id="Authenticators">Authenticators</span></h2>
<p>Authenticators control access to the hub and the single-user servers. The <a rel="nofollow" class="external text" href="https://jupyterhub.readthedocs.io/en/stable/reference/authenticators.html">authenticators section</a> of the documentation contains details about how authenticators work and how to write a custom authenticator. The <a rel="nofollow" class="external text" href="https://github.com/jupyterhub/jupyterhub/wiki/Authenticators">authenticators wiki page</a> has a list of authenticators; some of these are packaged and are described below.
</p>
<p>Note that user status is stored in cookies, encrypted by the <a rel="nofollow" class="external text" href="https://jupyterhub.readthedocs.io/en/stable/tutorial/getting-started/security-basics.html#cookie-secret">cookie secret</a>. If you switch to a different authenticator, or modify the settings of your chosen authenticator so that the list of allowed users might change, you should change the cookie secret. This logs out all current users and forces them to re-authenticate with your new settings. This can be performed by deleting the cookie secret file and restarting the hub which will automatically generate a new secret. With the default configuration, the cookie secret is stored at <code>/etc/jupyterhub/jupyterhub_cookie_secret</code>.
</p>
<h3><span class="mw-headline" id="PAM_Authenticator">PAM Authenticator</span></h3>
<p>The PAM authenticator uses <a href="../en/PAM.html" title="PAM">PAM</a> to allow local users to log in to the hub. It is included with JupyterHub and is the default authenticator. Using it requires the hub to have read permissions to <code>/etc/shadow</code> (which contains hashed versions of user passwords) in order to authenticate users. By default <code>/etc/shadow</code> is owned by root and has <a href="../en/Users_and_groups.html#Permissions_and_ownership" title="Users and groups">file permissions</a> of <code>-rw------</code>, so running the hub as root will meet this requirement. <a href="https://fedoraproject.org/wiki/Features/LowerProcessCapabilities" class="extiw" title="fedora:Features/LowerProcessCapabilities">Some sources</a> advocate removing all permissions from <code>/etc/shadow</code> so it cannot be read by compromised daemons, and granting processes which require access the <code>DAC_OVERRIDE</code> <a href="../en/Capabilities.html" title="Capabilities">capability</a>. If your <code>/etc/shadow</code> is set up like this, create a <a href="../en/Systemd.html#Drop-in_files" class="mw-redirect" title="Drop-in file">drop-in file</a> for the service to grant this capability to JupyterHub:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/jupyterhub.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
CapabilityBoundingSet=CAP_DAC_OVERRIDE</pre>
<p>The PAM authenticator relies on the Python package <a rel="nofollow" class="external text" href="https://github.com/minrk/pamela">pamela</a>. For basic troubleshooting this can be tested on the commandline. To attempt authentication as user <code>testuser</code>, run the following command:
</p>
<pre># python -m pamela -a testuser
</pre>
<p>(If you run JupyterHub as a non-root user, run the command as that user instead of root). If the authentication succeeds, no output will be printed. If it failed an error message will be printed.
</p>
<h4><span class="mw-headline" id="PAM_authentication_as_non-root_user">PAM authentication as non-root user</span></h4>
<p>If you run JupyterHub as a non-root user, you will need to give that user read permissions to the shadow file. The <a rel="nofollow" class="external text" href="https://jupyterhub.readthedocs.io/en/stable/reference/config-sudo.html#enable-pam-for-non-root">method recommended by the JupyterHub documentation</a> is to create a <code>shadow</code> group, make the shadow file readable by this group, and add the JupyterHub user to this group.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> This allows read-only access to the hashed passwords in <code>/etc/shadow</code> to anybody running code as the JupyterHub user. Note that each single-user server is run under their own account and so code executed in those servers will not have access. Also note that a security exploit in JupyterHub would allow the same access to the hashed passwords if JupyterHub was being run as root.</div>
<p>Creating the group, modifying the shadow file permissions and adding the user <code>jupyterhub</code> to the group can be accomplished with the following four commands:
</p>
<pre># groupadd shadow
# chgrp shadow /etc/shadow
# chmod g+r /etc/shadow
# usermod -aG shadow jupyterhub</pre>
<h2><span class="mw-headline" id="Spawners">Spawners</span></h2>
<p>Spawners are responsible for starting and monitoring each user's notebook server. The <a rel="nofollow" class="external text" href="https://jupyterhub.readthedocs.io/en/stable/reference/spawners.html">spawners section of the documentation</a> contains more details about how they work and how to write a custom spawner. The <a rel="nofollow" class="external text" href="https://github.com/jupyterhub/jupyterhub/wiki/Spawners">spawners wiki page</a> has a list of spawners; some of these are packaged and are described below.
</p>
<h3><span class="mw-headline" id="LocalProcessSpawner">LocalProcessSpawner</span></h3>
<p>This is the default spawner included with JupyterHub. It runs each single-user server in a separate local process under their <a href="../en/Users_and_groups.html" class="mw-redirect" title="User account">user account</a> (this means each JupyterHub user must correspond to a local user account). It also requires JupyterHub to be run as root so it can spawn the processes under the different user accounts. The <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=jupyter-notebook">jupyter-notebook</a></span> package must be installed for this spawner to work.
</p>
<h3><span class="mw-headline" id="SudoSpawner">SudoSpawner</span></h3>
<p>The <a rel="nofollow" class="external text" href="https://github.com/jupyterhub/sudospawner">SudoSpawner</a> uses an intermediate process created with <a href="../en/Sudo.html" title="Sudo">sudo</a> to spawn the single-user servers. This allows the JupyterHub process to be <a href="#Running_as_non-root_user">run as a non-root user</a>. To use it install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/jupyterhub-sudospawner/">jupyterhub-sudospawner</a></span><sup><small>AUR</small></sup> package.
</p>
<p>To use it, <a href="../en/Users_and_groups.html" title="Users and groups">create a system user account</a> (the following assumes the account is named <code>jupyterhub</code>) and a group whose membership will define which users can access the hub (here assumed to be called <code>jupyterhub-users</code>). First, we have to configure sudo to allow the <code>jupyterhub</code> user to spawn a server without a password. Create a <a href="../en/Sudo.html#Configure_sudo_using_drop-in_files_in_/etc/sudoers.d" title="Sudo">drop-in sudo configuration file</a> with <a href="../en/Sudo.html#Using_visudo" class="mw-redirect" title="Visudo">visudo</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;"># visudo -f /etc/sudoers.d/jupyterhub-sudospawner</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;"># The command the hub is allowed to run.
Cmnd_Alias SUDOSPAWNER_CMD = /usr/bin/sudospawner

# Allow the jupyterhub user to run this command on behalf of anybody
# in the jupyterhub-users group.
jupyterhub ALL=(%jupyterhub-users) NOPASSWD:SUDOSPAWNER_CMD</pre>
<p>The default service file runs the hub as root. It also applies a number of hardening options to the service to restrict its capabilities. This hardening prevents sudo from working; to allow it, the <code>NoNewPrivileges</code> service option (plus any other options which implicitly set it, see <span class="plainlinks archwiki-template-man" title="$ man 5 systemd.exec"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/systemd.exec.5">systemd.exec(5)</a></span> for a list of service options) needs to be off. Create a <a href="../en/Systemd.html#Drop-in_files" class="mw-redirect" title="Drop-in file">drop-in file</a> to run the hub using the <code>jupyterhub</code> user instead:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/jupyterhub.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
User=jupyterhub
Group=jupyterhub

# Required for sudo.
NoNewPrivileges=false

# Setting the following would implicitly set NoNewPrivileges.
PrivateDevices=false
ProtectKernelTunables=false
ProtectKernelModules=false
LockPersonality=false
RestrictRealtime=false
RestrictSUIDGID=false
SystemCallFilter=
SystemCallArchitectures=</pre>
<p>If you have previously run the hub as the root user, you will need to <a href="../en/File_permissions_and_attributes.html#Changing_ownership" title="File permissions and attributes">change the ownership</a> of the user database and <a rel="nofollow" class="external text" href="https://jupyterhub.readthedocs.io/en/stable/tutorial/getting-started/security-basics.html#cookie-secret">cookie secret</a> files:
</p>
<pre># chown jupyterhub:jupyterhub /etc/jupyterhub/{jupyterhub_cookie_secret,jupyterhub.sqlite}
</pre>
<p>If you are using the PAMAuthenticator, you will need to <a href="#PAM_authentication_as_non-root_user">configure your system to allow it to work as a non-root user</a>.
</p>
<p>Finally, edit the JupyterHub configuration and change the spawner class to SudoSpawner:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/jupyterhub/jupyterhub_config.py</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">c.JupyterHub.spawner_class='sudospawner.SudoSpawner'</pre>
<p>To give a user access to the hub, add them to the <code>jupyterhub-users</code> group:
</p>
<pre># usermod -aG jupyterhub-users &lt;username&gt;
</pre>
<h3><span class="mw-headline" id="systemdspawner">systemdspawner</span></h3>
<p>The <a rel="nofollow" class="external text" href="https://github.com/jupyterhub/systemdspawner">systemdspawner</a> uses <a href="../en/Systemd.html" title="Systemd">systemd</a> to manage each user's notebook which allows configuring resource limitations, better process isolation and sandboxing, and dynamically allocated users. To use it install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/jupyterhub-systemdspawner/">jupyterhub-systemdspawner</a></span><sup><small>AUR</small></sup> package and set the spawner class in the configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/jupyterhub/jupyterhub_config.py</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">c.JupyterHub.spawner_class = 'systemdspawner.SystemdSpawner'</pre>
<p>Note that as per <a rel="nofollow" class="external text" href="https://github.com/jupyterhub/systemdspawner/blob/master/README.md#root-access">systemdspawner's readme</a> using it currently requires JupyterHub to be run as root.
</p>
<h2><span class="mw-headline" id="Services">Services</span></h2>
<p>A <a rel="nofollow" class="external text" href="https://jupyterhub.readthedocs.io/en/stable/getting-started/services-basics.html">JupyterHub service</a> is defined as a process which interacts with the Hub through its API. Services can either be run by the hub or as standalone processes.
</p>
<h3><span class="mw-headline" id="Idle_culler">Idle culler</span></h3>
<p>The <a rel="nofollow" class="external text" href="https://github.com/jupyterhub/jupyterhub-idle-culler">idle culler</a> service can be used to automatically shut down idle single-user servers. To use it, install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/jupyterhub-idle-culler/">jupyterhub-idle-culler</a></span><sup><small>AUR</small></sup> package. To run the service through the hub, add a service description to the <code>c.JupyterHub.services</code> configuration variable:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/jupyterhub/jupyterhub_config.py</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">import sys
c.JupyterHub.services = [
    {
        'name': 'idle-culler',
        'admin': True,
        'command': [
            sys.executable,
            '-m', 'jupyterhub_idle_culler',
            '--timeout=3600'
        ],
    }
]</pre>
<p>See the service documentation or the output of <code>python -m jupyterhub_idle_culler --help</code> for a description of command-line options and details of how to run the service as a standalone process.
</p>
<h2><span class="mw-headline" id="Tips_and_Tricks">Tips and Tricks</span></h2>
<h3><span class="mw-headline" id="Running_as_non-root_user">Running as non-root user</span></h3>
<p>By default, the main hub process is run as the root user (the individual user servers are run under the corresponding local user as set by the spawner). To run as a non-root user, you need to use the <a href="#SudoSpawner">SudoSpawner</a> (the other spawners listed above require running as root). If you are using the PAM authenticator, you will also need to <a href="#PAM_authentication_as_non-root_user">configure it for a non-root user</a>.
</p>
<h3><span class="mw-headline" id="Using_a_reverse_proxy">Using a reverse proxy</span></h3>
<p>A reverse proxy can be used to redirect external requests to the JupyterHub instance. This can be useful if you want to serve multiple sites from one machine, or use an existing server to handle <a href="../en/Transport_Layer_Security.html" class="mw-redirect" title="SSL">SSL</a>. The <a rel="nofollow" class="external text" href="https://jupyterhub.readthedocs.io/en/stable/reference/config-proxy.html">using a reverse proxy</a> section of the JupyterHub documentation has example configuration for using either <a href="../en/Nginx.html" title="Nginx">nginx</a> or <a href="../en/Apache_HTTP_Server.html" title="Apache HTTP Server">Apache</a> as a reverse proxy.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This does not replace the proxy component of JupyterHub which is responsible for routing requests to either the main hub or the single-user servers. Rather, the reverse proxy passes external requests to the JupyterHub proxy.</div>
<h3><span class="mw-headline" id="Proxy_other_web_services">Proxy other web services</span></h3>
<p>The Jupyter Server Proxy extension allows you to run other web services such as Code Server or RStudio alongside JupyterHub and provide authenticated web access to them. To use it, install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/python-jupyter-server-proxy/">python-jupyter-server-proxy</a></span><sup><small>AUR</small></sup> and configure it with the <code>/etc/jupyter/jupyter_notebook_config.py</code> file. For instance, to proxy <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/code-server/">code-server</a></span><sup><small>AUR</small></sup>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/jupyter/jupyter_notebook_config.py</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">c.ServerProxy.servers = {
  'code-server': {
    'command': [
      'code-server',
        '--auth=none',
        '--disable-telemetry',
        '--disable-update-check',
        '--bind-addr=localhost:{port}',
        '--user-data-dir=.config/Code - OSS/',
        '--extensions-dir=.vscode-oss/extensions/'
    ],
    'timeout': 20,
    'launcher_entry': {
      'title': 'VS Code'
    }
  }
}</pre>
<p>See the <a rel="nofollow" class="external text" href="https://jupyter-server-proxy.readthedocs.io/en/latest/">documentation</a> for more details about configuring the Jupyter Server Proxy.
</p>
<h3><span class="mw-headline" id="Access_to_GPUs">Access to GPUs</span></h3>
<p>If you receive errors when accessing GPUs (for instance, if <code>nvidia-smi</code> reports it cannot communicate with the NVIDIA driver), you must consider the hardening that is shipped with the JupyterHub <a rel="nofollow" class="external text" href="https://aur.archlinux.org/cgit/aur.git/tree/jupyterhub.service?h=jupyterhub">systemd unit file</a>.
To allow access to GPUs (and other hardware) broadly, you can add this to a <a href="../en/Systemd.html#Drop-in_files" class="mw-redirect" title="Drop-in file">drop-in file</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/jupyterhub.service.d/override.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
PrivateDevices=false</pre>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Categories</a>: <ul>
<li><a href="../en/Category:Science.html" title="Category:Science">Science</a></li>
<li><a href="../en/Category:Servers.html" title="Category:Servers">Servers</a></li>
</ul>
</div></div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" role="contentinfo" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=JupyterHub&amp;oldid=807130">https://wiki.archlinux.org/index.php?title=JupyterHub&amp;oldid=807130</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 30 April 2024, at 11:45.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki_88x31.png" srcset="/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul>
		<li>
		<button class="cdx-button cdx-button--icon-only vector-limited-width-toggle" id=""><span class="vector-icon mw-ui-icon-fullScreen mw-ui-icon-wikimedia-fullScreen"></span>

<span>Toggle limited content width</span>
</button>
</li>
	</ul>
</div>
</body>
</html>
